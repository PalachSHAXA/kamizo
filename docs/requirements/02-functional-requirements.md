# Функциональные требования UK CRM

## Модуль 1: Управление заявками

### 1.1 Создание заявок

**Каналы приема:**
- Telegram-бот (основной)
- Мобильное приложение жителя
- Веб-портал
- Телефон (через диспетчера)

**Обязательные поля:**
- Категория проблемы (визуальный выбор с иконками)
- Описание (текст + голосовое сообщение)
- Фото проблемы (до 5 шт.)
- Адрес/квартира (автозаполнение для авторизованных)
- Приоритет (авто или ручной)

**Автоматизация:**
- Автоопределение категории по фото (Phase 3 - AI)
- Автоназначение исполнителя по типу заявки
- Автоприоритизация по ключевым словам ("авария", "потоп")

### 1.2 Жизненный цикл заявки

```
Новая → Принята → В работе → Выполнена → Закрыта
           ↓                     ↓
       Отклонена            Оценена жителем
```

**Статусы:**
| Статус | Действие | Уведомление |
|--------|----------|-------------|
| Новая | Заявка создана | Push + Telegram жителю |
| Принята | Диспетчер подтвердил | Push жителю |
| Назначена | Исполнитель определен | Push исполнителю |
| В пути | GPS-статус исполнителя | Push жителю |
| В работе | Исполнитель начал | - |
| Выполнена | Фото-отчет загружен | Push жителю + запрос оценки |
| Закрыта | Житель подтвердил | - |
| Отклонена | С указанием причины | Push жителю |

### 1.3 SLA и эскалация

**Нормативы по категориям:**
| Категория | Реакция | Выполнение | Эскалация |
|-----------|---------|------------|-----------|
| Авария | 15 мин | 2 часа | → Руководитель |
| Срочная | 1 час | 24 часа | → Старший мастер |
| Обычная | 4 часа | 72 часа | → Диспетчер |
| Плановая | 24 часа | 7 дней | - |

**Автоматическая эскалация:**
- Предупреждение за 20% до истечения срока
- Эскалация при просрочке
- Уведомление руководства при повторных просрочках

---

## Модуль 2: Коммуникации

### 2.1 Telegram-бот (Основной канал)

**Функции для жителей:**
- Подача заявки (wizard-style)
- Проверка статуса заявки
- Передача показаний счетчиков
- Получение квитанций
- Оплата через Payme/Click
- Связь с диспетчером
- Опросы и голосования

**Технические требования:**
- Webhook-интеграция
- Inline-клавиатуры для быстрых действий
- Поддержка медиа (фото, документы)
- Многоязычный интерфейс (uz/ru)

### 2.2 Push-уведомления

**Типы уведомлений:**
| Событие | Получатель | Канал |
|---------|------------|-------|
| Статус заявки изменен | Житель | Push + Telegram |
| Новая заявка | Диспетчер | Push |
| Назначена заявка | Исполнитель | Push |
| Просрочка SLA | Руководитель | Push + Email |
| Напоминание об оплате | Житель | Telegram |
| Новость ЖК | Все жители | Push + Telegram |

### 2.3 Новости и объявления

**Возможности:**
- Публикация новостей по ЖК/дому
- Планирование публикаций
- Таргетинг по сегментам (дом, подъезд)
- Прикрепление файлов и изображений
- Подтверждение прочтения (опционально)

---

## Модуль 3: Платежи

### 3.1 Интеграция Payme

**API функции:**
- Создание счета
- Проверка статуса платежа
- Подписка на рекуррентные платежи
- Возврат средств
- Webhook для уведомлений

**Merchant API endpoints:**
```
POST /merchant/create - создание транзакции
POST /merchant/perform - выполнение платежа
POST /merchant/cancel - отмена
POST /merchant/check - проверка возможности
GET /merchant/statement - выписка
```

### 3.2 Интеграция Click

**API функции:**
- Card tokenization
- Recurring payments
- REST API для всех операций

### 3.3 Функции для жителей

- Просмотр текущего баланса
- История платежей
- Квитанции в PDF
- Настройка автоплатежа
- Частичная оплата
- Разделение платежа (по услугам)

### 3.4 Работа с задолженностью

**Автоматические напоминания:**
| День | Действие |
|------|----------|
| -7 | Напоминание о предстоящем платеже |
| +1 | Уведомление о задолженности |
| +7 | Повторное напоминание |
| +14 | Предупреждение о последствиях |
| +30 | Эскалация в УК |

---

## Модуль 4: Показания счетчиков

### 4.1 Ввод показаний

**Способы:**
- Telegram-бот
- Мобильное приложение
- Веб-портал
- Фото счетчика с OCR (Phase 3)

**Валидация:**
- Проверка на отрицательный расход
- Проверка на аномальный расход (>200% от среднего)
- Диапазон дат приема показаний

### 4.2 Типы счетчиков

- Холодная вода
- Горячая вода
- Электричество (день/ночь)
- Газ
- Отопление

### 4.3 IoT интеграция (Phase 3)

- Автоматический сбор с умных счетчиков
- Поддержка протоколов LoRaWAN, NB-IoT
- Алерты при аномалиях

---

## Модуль 5: Мобильное приложение жителя

### 5.1 Технология

**Рекомендация:** React Native или Flutter для cross-platform

**Альтернатива MVP:** PWA (Progressive Web App)
- Быстрый запуск
- Не требует публикации в сторах
- Push-уведомления через Service Worker

### 5.2 Основные экраны

1. **Главная** - баланс, активные заявки, новости
2. **Заявки** - список + создание новой
3. **Платежи** - баланс, оплата, история
4. **Показания** - ввод показаний счетчиков
5. **Профиль** - настройки, документы
6. **Чат** - связь с УК

### 5.3 UX требования

- Wizard-style формы (пошагово)
- Visual category selection с иконками
- Timeline-view статуса заявки
- Минимум действий для основных операций
- Большие touch targets (44px+)

---

## Модуль 6: Мобильное приложение персонала

### 6.1 Критические требования

**Offline-режим ОБЯЗАТЕЛЕН:**
- Local caching всех назначенных заявок
- Queue sync при восстановлении связи
- Индикатор состояния синхронизации

### 6.2 Функции

- Список назначенных заявок
- Детали заявки с историей
- Смена статуса (swipe-жесты)
- Фото до/после выполнения
- Навигация к объекту
- Автостатус "В пути" по GPS
- Чат с диспетчером

### 6.3 UX требования

- Mobile-first дизайн
- Large touch targets (44px+)
- Swipe-жесты для смены статусов
- Интеграция камеры
- Минимум текстового ввода

---

## Модуль 7: Веб-панель администратора

### 7.1 Дашборд

**KPI виджеты:**
- Активные заявки (по статусам)
- % выполнения в срок
- Средняя оценка жителей
- Сумма задолженностей
- Динамика за период

**Фильтры:**
- По ЖК / дому / подъезду
- По периоду
- По исполнителю
- По категории

### 7.2 Управление заявками

- Kanban-доска со статусами
- Drag-and-drop для смены статусов
- Bulk operations (массовое назначение)
- Фильтры и поиск
- Экспорт в Excel/PDF

### 7.3 Управление жителями

- Реестр квартир/лицевых счетов
- Карточка жителя с историей
- Импорт из Excel
- Сегментация для рассылок

### 7.4 Отчетность

**Стандартные отчеты:**
- Производительность исполнителей
- Анализ заявок по категориям
- Динамика задолженностей
- SLA compliance
- Оценки жителей

**Экспорт:** Excel, PDF, API

### 7.5 Настройки

- Управление пользователями и ролями
- Настройка категорий заявок
- Настройка SLA
- Шаблоны уведомлений
- Интеграции (Payme, Click, 1C)

# User Flows - UK CRM

## Роли пользователей

| Роль | Платформа | Ключевые задачи |
|------|-----------|-----------------|
| Админ УК | Web (Desktop-first) | Управление, аналитика, настройки |
| Диспетчер | Web (Desktop) | Обработка заявок, назначение |
| Персонал | Mobile (PWA) | Выполнение заявок, отчеты |
| Житель | Telegram + Mobile | Заявки, оплата, показания |

---

## Flow 1: Житель создает заявку через Telegram

```
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM BOT FLOW                            │
└─────────────────────────────────────────────────────────────────┘

[Житель] ──► /start или "Новая заявка"
                │
                ▼
┌─────────────────────────────────┐
│    Выберите категорию:          │
│                                 │
│  🔧 Сантехника    💡 Электрика  │
│  🛗 Лифт          🔔 Домофон    │
│  🧹 Уборка        📋 Другое     │
└─────────────────────────────────┘
                │
                ▼ [Выбор: 🔧 Сантехника]
┌─────────────────────────────────┐
│  Опишите проблему текстом       │
│  или отправьте голосовое        │
│  сообщение                      │
└─────────────────────────────────┘
                │
                ▼ [Текст: "Течет кран на кухне"]
┌─────────────────────────────────┐
│  Отправьте фото проблемы        │
│  (до 5 шт.)                     │
│                                 │
│  [📷 Добавить фото]             │
│  [⏭ Пропустить]                 │
└─────────────────────────────────┘
                │
                ▼ [Фото отправлено]
┌─────────────────────────────────┐
│  📋 Новая заявка                │
│                                 │
│  Категория: 🔧 Сантехника       │
│  Описание: Течет кран на кухне  │
│  Фото: 1 шт.                    │
│  Адрес: ул. Навои, д.5, кв.42   │
│                                 │
│  [✅ Отправить] [❌ Отменить]    │
└─────────────────────────────────┘
                │
                ▼ [Подтверждение]
┌─────────────────────────────────┐
│  ✅ Заявка #1234 создана!       │
│                                 │
│  Статус: Новая                  │
│  Вы получите уведомление        │
│  при изменении статуса          │
│                                 │
│  [📋 Мои заявки] [🏠 Меню]      │
└─────────────────────────────────┘
```

### Уведомления жителю

```
┌─────────────────────────────────┐
│  ✅ Заявка #1234                │
│                                 │
│  Статус изменен: Принята        │
│  Исполнитель: Иван Петров       │
│  Ожидаемое время: 2 часа        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  🔧 Заявка #1234                │
│                                 │
│  Статус изменен: В работе       │
│  Мастер прибыл по адресу        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  ✨ Заявка #1234 выполнена!     │
│                                 │
│  Оцените работу:                │
│  ⭐ ⭐ ⭐ ⭐ ⭐                    │
│  [Оставить отзыв]               │
└─────────────────────────────────┘
```

---

## Flow 2: Диспетчер обрабатывает заявку

```
┌─────────────────────────────────────────────────────────────────┐
│                    WEB ADMIN FLOW                               │
└─────────────────────────────────────────────────────────────────┘

[Диспетчер] ──► Входит в систему
                │
                ▼
┌─────────────────────────────────────────────────────────────────┐
│  🏠 Dashboard                                           [👤 Имя] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │
│  │  Новые  │ │В работе │ │Просрочено│ │ Сегодня │              │
│  │   12    │ │   8     │ │    2    │ │   24    │              │
│  │  🔴+3   │ │  ─      │ │  🔴     │ │  ✅     │              │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘              │
│                                                                 │
│  🔔 Новая заявка #1234 - Сантехника (2 мин назад)              │
└─────────────────────────────────────────────────────────────────┘
                │
                ▼ [Клик на уведомление]
┌─────────────────────────────────────────────────────────────────┐
│  Заявка #1234                                    [← Назад]      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Статус: 🔵 Новая            Приоритет: 🟡 Средний             │
│                                                                 │
│  ───────────────────────────────────────────────────────────── │
│                                                                 │
│  📍 ул. Навои, д.5, кв.42                                      │
│  👤 Алишер Каримов  +998 90 123 45 67                          │
│                                                                 │
│  🔧 Категория: Сантехника                                       │
│  📝 Описание: Течет кран на кухне                              │
│                                                                 │
│  📷 Фото:                                                       │
│  ┌─────┐                                                        │
│  │ 📷  │                                                        │
│  └─────┘                                                        │
│                                                                 │
│  ───────────────────────────────────────────────────────────── │
│                                                                 │
│  [✅ Принять]  [👤 Назначить]  [❌ Отклонить]                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                │
                ▼ [Клик "Назначить"]
┌─────────────────────────────────────────────────────────────────┐
│  Назначить исполнителя                              [✕ Закрыть] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Доступные сантехники:                                          │
│                                                                 │
│  ┌─────────────────────────────────────────────────┐           │
│  │ 👤 Иван Петров                                   │           │
│  │    📍 1.2 км от адреса                           │           │
│  │    📋 Активных заявок: 2                         │           │
│  │    ⭐ Рейтинг: 4.8                               │           │
│  │                                    [Назначить]   │           │
│  └─────────────────────────────────────────────────┘           │
│                                                                 │
│  ┌─────────────────────────────────────────────────┐           │
│  │ 👤 Сергей Ким                                    │           │
│  │    📍 3.5 км от адреса                           │           │
│  │    📋 Активных заявок: 4                         │           │
│  │    ⭐ Рейтинг: 4.5                               │           │
│  │                                    [Назначить]   │           │
│  └─────────────────────────────────────────────────┘           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                │
                ▼ [Назначен Иван Петров]
┌─────────────────────────────────────────────────────────────────┐
│  ✅ Исполнитель назначен                                        │
│                                                                 │
│  Заявка #1234 назначена Иван Петров                            │
│  Уведомление отправлено                                         │
└─────────────────────────────────────────────────────────────────┘
```

---

## Flow 3: Персонал выполняет заявку

```
┌─────────────────────────────────────────────────────────────────┐
│                    MOBILE APP FLOW (Staff)                      │
└─────────────────────────────────────────────────────────────────┘

[Персонал] ──► Push: "Новая заявка #1234"
                │
                ▼
┌─────────────────────────────────┐
│ ◀ Мои заявки             🔔     │
├─────────────────────────────────┤
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 🔴 НОВАЯ                    │ │
│ │ #1234 • Сантехника          │ │
│ │ 📍 ул. Навои, д.5, кв.42    │ │
│ │ ⏰ SLA: 2ч осталось         │ │
│ └─────────────────────────────┘ │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 🟡 В РАБОТЕ                 │ │
│ │ #1230 • Электрика           │ │
│ │ 📍 ул. Мирзо, д.12, кв.8    │ │
│ │ ⏰ SLA: 4ч осталось         │ │
│ └─────────────────────────────┘ │
│                                 │
└─────────────────────────────────┘
                │
                ▼ [Тап на заявку #1234]
┌─────────────────────────────────┐
│ ◀ Заявка #1234                  │
├─────────────────────────────────┤
│                                 │
│ 🔧 Сантехника                   │
│ Течет кран на кухне             │
│                                 │
│ ┌─────┐                         │
│ │ 📷  │ Фото проблемы           │
│ └─────┘                         │
│                                 │
│ ─────────────────────────────── │
│                                 │
│ 👤 Алишер Каримов               │
│ 📞 +998 90 123 45 67            │
│ 📍 ул. Навои, д.5, кв.42        │
│                                 │
│ [🗺 Маршрут]                    │
│                                 │
│ ─────────────────────────────── │
│                                 │
│ ┌─────────────────────────────┐ │
│ │    ◀ Свайп для статуса ▶    │ │
│ │                             │ │
│ │  🚗 В пути   🔧 В работе    │ │
│ └─────────────────────────────┘ │
│                                 │
└─────────────────────────────────┘
                │
                ▼ [Свайп → В пути]
                │
                ▼ [GPS автостатус или свайп → В работе]
                │
                ▼ [Работа выполнена]
┌─────────────────────────────────┐
│ ◀ Завершение заявки #1234       │
├─────────────────────────────────┤
│                                 │
│ Добавьте фото выполненной       │
│ работы:                         │
│                                 │
│ ┌─────┐ ┌─────┐ ┌─────┐        │
│ │ 📷+ │ │ 📷  │ │     │        │
│ └─────┘ └─────┘ └─────┘        │
│                                 │
│ Комментарий:                    │
│ ┌─────────────────────────────┐ │
│ │ Заменен кран, проверена     │ │
│ │ герметичность               │ │
│ └─────────────────────────────┘ │
│                                 │
│ Использованные материалы:       │
│ ┌─────────────────────────────┐ │
│ │ + Добавить материал         │ │
│ └─────────────────────────────┘ │
│                                 │
│ ┌─────────────────────────────┐ │
│ │      ✅ Завершить заявку     │ │
│ └─────────────────────────────┘ │
│                                 │
└─────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────┐
│  ✅ Заявка #1234 завершена!     │
│                                 │
│  Время выполнения: 45 мин       │
│  SLA: ✅ Выполнено в срок       │
│                                 │
│  [К списку заявок]              │
└─────────────────────────────────┘
```

---

## Flow 4: Житель оплачивает услуги

```
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM BOT - PAYMENT FLOW                  │
└─────────────────────────────────────────────────────────────────┘

[Житель] ──► "💰 Оплата" или /pay
                │
                ▼
┌─────────────────────────────────┐
│  💰 Ваш баланс                  │
│                                 │
│  К оплате: 450 000 сум          │
│                                 │
│  ─────────────────────────────  │
│  Коммунальные услуги:           │
│  • Обслуживание: 200 000        │
│  • Вода: 80 000                 │
│  • Электричество: 120 000       │
│  • Вывоз мусора: 50 000         │
│  ─────────────────────────────  │
│                                 │
│  [💳 Оплатить]                  │
│  [📄 Квитанция]                 │
│  [📊 История платежей]          │
└─────────────────────────────────┘
                │
                ▼ [Оплатить]
┌─────────────────────────────────┐
│  Выберите способ оплаты:        │
│                                 │
│  [💳 Payme]                     │
│  [💳 Click]                     │
│                                 │
└─────────────────────────────────┘
                │
                ▼ [Payme]
┌─────────────────────────────────┐
│  Сумма к оплате: 450 000 сум    │
│                                 │
│  Нажмите кнопку для перехода    │
│  к оплате в Payme               │
│                                 │
│  [🔗 Перейти к оплате]          │
└─────────────────────────────────┘
                │
                ▼ [Переход в Payme, оплата]
                │
                ▼ [Webhook от Payme - успех]
┌─────────────────────────────────┐
│  ✅ Оплата прошла успешно!      │
│                                 │
│  Сумма: 450 000 сум             │
│  Дата: 15.01.2025 14:32         │
│  Номер: PAY-123456789           │
│                                 │
│  Спасибо за своевременную       │
│  оплату! +100 баллов 🎉         │
│                                 │
│  [🏠 Главное меню]              │
└─────────────────────────────────┘
```

---

## Flow 5: Житель передает показания

```
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM BOT - METERS FLOW                   │
└─────────────────────────────────────────────────────────────────┘

[Житель] ──► "📊 Показания" или /meters
                │
                ▼
┌─────────────────────────────────┐
│  📊 Показания счетчиков         │
│                                 │
│  Период: Январь 2025            │
│  Срок подачи: до 25 января      │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  💧 Холодная вода               │
│  Предыдущее: 1234.5 м³          │
│  [Ввести показание]             │
│                                 │
│  🔥 Горячая вода                │
│  Предыдущее: 567.8 м³           │
│  [Ввести показание]             │
│                                 │
│  ⚡ Электричество               │
│  Предыдущее: 9876 кВт·ч         │
│  [✅ Передано: 10012 кВт·ч]     │
│                                 │
└─────────────────────────────────┘
                │
                ▼ [Ввести показание - Холодная вода]
┌─────────────────────────────────┐
│  💧 Холодная вода               │
│                                 │
│  Предыдущее: 1234.5 м³          │
│                                 │
│  Введите текущее показание:     │
│                                 │
│  Или отправьте фото счетчика    │
│  для автоматического            │
│  распознавания                  │
│                                 │
│  [📷 Отправить фото]            │
└─────────────────────────────────┘
                │
                ▼ [Ввод: 1245.2]
┌─────────────────────────────────┐
│  💧 Холодная вода               │
│                                 │
│  Предыдущее: 1234.5 м³          │
│  Текущее: 1245.2 м³             │
│  Расход: 10.7 м³                │
│                                 │
│  Все верно?                     │
│                                 │
│  [✅ Подтвердить] [✏️ Изменить] │
└─────────────────────────────────┘
                │
                ▼ [Подтвердить]
┌─────────────────────────────────┐
│  ✅ Показания приняты!          │
│                                 │
│  💧 Холодная вода: 1245.2 м³    │
│  Расход: 10.7 м³                │
│                                 │
│  +20 баллов за передачу         │
│  показаний 🎉                   │
│                                 │
│  [📊 Передать другие показания] │
│  [🏠 Главное меню]              │
└─────────────────────────────────┘
```

---

## Flow 6: Админ просматривает аналитику

```
┌─────────────────────────────────────────────────────────────────┐
│                    WEB ADMIN - ANALYTICS FLOW                   │
└─────────────────────────────────────────────────────────────────┘

[Админ] ──► Переходит в "Аналитика"
                │
                ▼
┌─────────────────────────────────────────────────────────────────┐
│  📊 Аналитика                                      Январь 2025 ▾│
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Фильтры: [Все ЖК ▾] [Все дома ▾] [Все категории ▾]           │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  KPI за период                                           │   │
│  │                                                          │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │
│  │  │ Заявок   │ │ SLA      │ │ Рейтинг  │ │ Собрано  │   │   │
│  │  │  324     │ │  87%     │ │  4.6 ⭐  │ │  92%     │   │   │
│  │  │ +12%     │ │ -3%      │ │ +0.2     │ │ +5%      │   │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌────────────────────────────┐ ┌────────────────────────────┐ │
│  │  Динамика заявок           │ │  По категориям             │ │
│  │  ┌────────────────────┐    │ │  ┌────────────────────┐    │ │
│  │  │    📈              │    │ │  │   🔧 Сантехника 35%│    │ │
│  │  │   /\    /\         │    │ │  │   💡 Электрика 25%│    │ │
│  │  │  /  \  /  \        │    │ │  │   🛗 Лифт 20%     │    │ │
│  │  │ /    \/    \       │    │ │  │   📋 Другое 20%   │    │ │
│  │  └────────────────────┘    │ │  └────────────────────┘    │ │
│  └────────────────────────────┘ └────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Проблемные дома (больше всего заявок)                  │   │
│  │                                                          │   │
│  │  1. ул. Навои, д.5       │████████████████│ 45 заявок   │   │
│  │  2. ул. Мирзо, д.12      │███████████│ 32 заявки        │   │
│  │  3. пр. Амира Темура, 7  │████████│ 28 заявок           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [📥 Скачать отчет]  [📧 Отправить на email]                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Состояния интерфейса

### Loading States

```
┌─────────────────────────────────┐
│                                 │
│         ◠◡◠ Загрузка...         │
│                                 │
└─────────────────────────────────┘
```

### Empty States

```
┌─────────────────────────────────┐
│                                 │
│         📭                      │
│                                 │
│    Нет активных заявок          │
│                                 │
│    Все заявки обработаны!       │
│                                 │
└─────────────────────────────────┘
```

### Error States

```
┌─────────────────────────────────┐
│                                 │
│         ⚠️                      │
│                                 │
│    Что-то пошло не так          │
│                                 │
│    Попробуйте позже или         │
│    обратитесь в поддержку       │
│                                 │
│    [🔄 Повторить]               │
│                                 │
└─────────────────────────────────┘
```

### Offline State (Mobile)

```
┌─────────────────────────────────┐
│  ⚡ Офлайн режим                │
├─────────────────────────────────┤
│                                 │
│  Данные будут синхронизированы  │
│  при подключении к интернету    │
│                                 │
│  📋 3 изменения ожидают         │
│     синхронизации               │
│                                 │
└─────────────────────────────────┘
```

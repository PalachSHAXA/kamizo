{"version":3,"file":"RequestsPage-1768934878736-BrvJKMg6.js","sources":["../../src/pages/shared/RequestsPage.tsx"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport { Search, MapPin, Loader2, Plus, X, ChevronRight, User, Building2, GitBranch } from 'lucide-react';\r\nimport { useDataStore } from '../../stores/dataStore';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { SPECIALIZATION_LABELS } from '../../types';\r\nimport { branchesApi, buildingsApi, usersApi } from '../../services/api';\r\nimport { formatAddress } from '../../utils/formatAddress';\r\nimport type { ExecutorSpecialization, RequestPriority } from '../../types';\r\n\r\nexport function RequestsPage() {\r\n  const { user } = useAuthStore();\r\n  const { requests, executors, assignRequest, addRequest, fetchRequests, fetchExecutors, isLoadingRequests } = useDataStore();\r\n  const [searchParams] = useSearchParams();\r\n  const statusFilter = searchParams.get('status') || 'all';\r\n  const [filter, setFilter] = useState(statusFilter);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [showAssignModal, setShowAssignModal] = useState<string | null>(null);\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n\r\n  // Check if user can create requests (manager, admin, director)\r\n  const canCreateRequest = ['manager', 'admin', 'director'].includes(user?.role || '');\r\n\r\n  // Update filter when URL changes\r\n  useEffect(() => {\r\n    setFilter(statusFilter);\r\n  }, [statusFilter]);\r\n\r\n  // Check if user is department head - they can only see their department's requests\r\n  const isDepartmentHead = user?.role === 'department_head';\r\n  const userSpecialization = user?.specialization;\r\n\r\n  // Filter requests by department if user is department head\r\n  const departmentRequests = useMemo(() => {\r\n    if (isDepartmentHead && userSpecialization) {\r\n      return requests.filter(r => r.category === userSpecialization);\r\n    }\r\n    return requests;\r\n  }, [requests, isDepartmentHead, userSpecialization]);\r\n\r\n  // Filter executors by department if user is department head\r\n  const departmentExecutors = useMemo(() => {\r\n    if (isDepartmentHead && userSpecialization) {\r\n      return executors.filter(e => e.specialization === userSpecialization);\r\n    }\r\n    return executors;\r\n  }, [executors, isDepartmentHead, userSpecialization]);\r\n\r\n  // Fetch requests and executors from D1 database on mount\r\n  useEffect(() => {\r\n    fetchRequests();\r\n    fetchExecutors();\r\n  }, [fetchRequests, fetchExecutors]);\r\n\r\n  // Refetch executors when assignment modal opens to ensure fresh data\r\n  useEffect(() => {\r\n    if (showAssignModal) {\r\n      fetchExecutors();\r\n    }\r\n  }, [showAssignModal, fetchExecutors]);\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'new': return <span className=\"badge badge-new\">Новая</span>;\r\n      case 'assigned': return <span className=\"badge bg-indigo-100 text-indigo-700\">Назначена</span>;\r\n      case 'accepted': return <span className=\"badge bg-cyan-100 text-cyan-700\">Принята</span>;\r\n      case 'in_progress': return <span className=\"badge badge-progress\">В работе</span>;\r\n      case 'pending_approval': return <span className=\"badge bg-purple-100 text-purple-700\">Ожидает подтверждения</span>;\r\n      case 'completed': return <span className=\"badge badge-done\">Выполнена</span>;\r\n      default: return <span className=\"badge\">{status}</span>;\r\n    }\r\n  };\r\n\r\n  // Filter by status and search query\r\n  const filteredRequests = departmentRequests.filter(r => {\r\n    let matchesStatus = false;\r\n\r\n    if (filter === 'all') {\r\n      matchesStatus = true;\r\n    } else if (filter === 'in_progress') {\r\n      // \"В работе\" includes assigned, accepted, and in_progress statuses\r\n      matchesStatus = ['assigned', 'accepted', 'in_progress'].includes(r.status);\r\n    } else {\r\n      matchesStatus = r.status === filter;\r\n    }\r\n\r\n    const matchesSearch = searchQuery === '' ||\r\n      r.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      r.residentName?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      r.number.toString().includes(searchQuery) ||\r\n      r.address?.toLowerCase().includes(searchQuery.toLowerCase());\r\n    return matchesStatus && matchesSearch;\r\n  });\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">\r\n            {isDepartmentHead ? 'Заявки отдела' : 'Заявки'}\r\n          </h1>\r\n          {isDepartmentHead && userSpecialization && (\r\n            <p className=\"text-gray-500 text-sm mt-1\">\r\n              Отдел: {SPECIALIZATION_LABELS[userSpecialization as ExecutorSpecialization]}\r\n            </p>\r\n          )}\r\n        </div>\r\n        {canCreateRequest && (\r\n          <button\r\n            onClick={() => setShowCreateModal(true)}\r\n            className=\"btn-primary flex items-center gap-2\"\r\n          >\r\n            <Plus className=\"w-5 h-5\" />\r\n            <span className=\"hidden sm:inline\">Создать заявку</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"glass-card p-4 flex items-center gap-4\">\r\n        <div className=\"relative flex-1\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Поиск по номеру, названию, адресу...\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            className=\"glass-input pl-10\"\r\n          />\r\n        </div>\r\n        <select\r\n          value={filter}\r\n          onChange={(e) => setFilter(e.target.value)}\r\n          className=\"glass-input w-48\"\r\n        >\r\n          <option value=\"all\">Все статусы</option>\r\n          <option value=\"new\">Новые</option>\r\n          <option value=\"assigned\">Назначенные</option>\r\n          <option value=\"accepted\">Принятые</option>\r\n          <option value=\"in_progress\">В работе</option>\r\n          <option value=\"pending_approval\">Ожидают подтверждения</option>\r\n          <option value=\"completed\">Выполненные</option>\r\n        </select>\r\n      </div>\r\n\r\n      {/* Requests List */}\r\n      {isLoadingRequests ? (\r\n        <div className=\"flex justify-center items-center py-12\">\r\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary-600\" />\r\n          <span className=\"ml-3 text-gray-600\">Загрузка заявок...</span>\r\n        </div>\r\n      ) : filteredRequests.length === 0 ? (\r\n        <div className=\"glass-card p-8 text-center text-gray-500\">\r\n          Заявки не найдены\r\n        </div>\r\n      ) : (\r\n      <div className=\"space-y-3\">\r\n        {filteredRequests.map((req) => (\r\n          <div key={req.id} className=\"glass-card p-5\">\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex gap-4\">\r\n                <div className={`w-3 h-3 mt-1.5 rounded-full ${req.priority === 'urgent' ? 'bg-red-500' : req.priority === 'high' ? 'bg-orange-500' : req.priority === 'medium' ? 'bg-amber-500' : 'bg-gray-400'}`}></div>\r\n                <div>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <span className=\"text-sm text-gray-500\">#{req.number}</span>\r\n                    <h3 className=\"font-semibold text-lg\">{req.title}</h3>\r\n                    {getStatusBadge(req.status)}\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600 mt-1\">\r\n                    <span className=\"font-medium\">{SPECIALIZATION_LABELS[req.category]}</span> • {req.residentName}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-4 mt-2 text-sm text-gray-500\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <MapPin className=\"w-4 h-4\" />\r\n                      {formatAddress(req.address, req.apartment)}\r\n                    </span>\r\n                  </div>\r\n                  {req.executorName && (\r\n                    <div className=\"mt-2 text-sm text-primary-600\">\r\n                      Исполнитель: {req.executorName}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                {req.status === 'new' && (\r\n                  <button\r\n                    onClick={() => setShowAssignModal(req.id)}\r\n                    className=\"btn-primary text-sm py-2 px-4\"\r\n                  >\r\n                    Назначить\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n      )}\r\n\r\n      {/* Assign Modal */}\r\n      {showAssignModal && (\r\n        <div className=\"modal-backdrop\">\r\n          <div className=\"modal-content p-6 w-full max-w-md mx-4\">\r\n            <h2 className=\"text-xl font-bold mb-4\">Назначить исполнителя</h2>\r\n            <div className=\"space-y-3\">\r\n              {departmentExecutors.length === 0 ? (\r\n                <p className=\"text-gray-500 text-center py-4\">Загрузка исполнителей...</p>\r\n              ) : (\r\n                departmentExecutors.map((executor) => (\r\n                  <button\r\n                    key={executor.id}\r\n                    onClick={() => {\r\n                      assignRequest(showAssignModal, executor.id);\r\n                      setShowAssignModal(null);\r\n                    }}\r\n                    className=\"w-full p-4 bg-white/30 hover:bg-white/50 rounded-xl text-left transition-colors\"\r\n                  >\r\n                    <div className=\"font-medium\">{executor.name}</div>\r\n                    <div className=\"text-sm text-gray-500\">\r\n                      {SPECIALIZATION_LABELS[executor.specialization]} • {executor.activeRequests} активных заявок\r\n                    </div>\r\n                  </button>\r\n                ))\r\n              )}\r\n            </div>\r\n            <button\r\n              onClick={() => setShowAssignModal(null)}\r\n              className=\"btn-secondary w-full mt-4\"\r\n            >\r\n              Отмена\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Create Request Modal */}\r\n      {showCreateModal && (\r\n        <CreateRequestModal\r\n          onClose={() => setShowCreateModal(false)}\r\n          onSubmit={async (data) => {\r\n            await addRequest(data);\r\n            setShowCreateModal(false);\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Types for resident selection\r\ninterface Branch {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n}\r\n\r\ninterface Building {\r\n  id: string;\r\n  name: string;\r\n  address: string;\r\n  branch_code: string;\r\n}\r\n\r\ninterface Resident {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  address: string;\r\n  apartment: string;\r\n  building_id: string;\r\n}\r\n\r\n// Create Request Modal for managers/admins\r\nfunction CreateRequestModal({\r\n  onClose,\r\n  onSubmit\r\n}: {\r\n  onClose: () => void;\r\n  onSubmit: (data: {\r\n    title: string;\r\n    description: string;\r\n    category: ExecutorSpecialization;\r\n    priority: RequestPriority;\r\n    residentId: string;\r\n    residentName: string;\r\n    residentPhone: string;\r\n    address: string;\r\n    apartment: string;\r\n    scheduledDate?: string;\r\n    scheduledTime?: string;\r\n  }) => void;\r\n}) {\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [category, setCategory] = useState<ExecutorSpecialization>('plumber');\r\n  const [priority, setPriority] = useState<RequestPriority>('medium');\r\n  const [scheduledDate, setScheduledDate] = useState('');\r\n  const [scheduledTime, setScheduledTime] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Cascading selection state\r\n  const [branches, setBranches] = useState<Branch[]>([]);\r\n  const [buildings, setBuildings] = useState<Building[]>([]);\r\n  const [residents, setResidents] = useState<Resident[]>([]);\r\n\r\n  const [selectedBranch, setSelectedBranch] = useState<string>('');\r\n  const [selectedBuilding, setSelectedBuilding] = useState<string>('');\r\n  const [selectedResident, setSelectedResident] = useState<Resident | null>(null);\r\n\r\n  const [loadingBranches, setLoadingBranches] = useState(false);\r\n  const [loadingBuildings, setLoadingBuildings] = useState(false);\r\n  const [loadingResidents, setLoadingResidents] = useState(false);\r\n\r\n  // Load branches on mount\r\n  useEffect(() => {\r\n    const loadBranches = async () => {\r\n      setLoadingBranches(true);\r\n      try {\r\n        const data = await branchesApi.getAll();\r\n        setBranches(data.branches || []);\r\n      } catch (error) {\r\n        console.error('Failed to load branches:', error);\r\n      } finally {\r\n        setLoadingBranches(false);\r\n      }\r\n    };\r\n    loadBranches();\r\n  }, []);\r\n\r\n  // Load buildings when branch changes\r\n  useEffect(() => {\r\n    if (!selectedBranch) {\r\n      setBuildings([]);\r\n      setSelectedBuilding('');\r\n      setResidents([]);\r\n      setSelectedResident(null);\r\n      return;\r\n    }\r\n\r\n    const loadBuildings = async () => {\r\n      setLoadingBuildings(true);\r\n      setSelectedBuilding('');\r\n      setResidents([]);\r\n      setSelectedResident(null);\r\n      try {\r\n        const data = await buildingsApi.getAll();\r\n        const filteredBuildings = (data.buildings || []).filter(\r\n          (b: Building) => b.branch_code === selectedBranch\r\n        );\r\n        setBuildings(filteredBuildings);\r\n      } catch (error) {\r\n        console.error('Failed to load buildings:', error);\r\n      } finally {\r\n        setLoadingBuildings(false);\r\n      }\r\n    };\r\n    loadBuildings();\r\n  }, [selectedBranch]);\r\n\r\n  // Load residents when building changes\r\n  useEffect(() => {\r\n    if (!selectedBuilding) {\r\n      setResidents([]);\r\n      setSelectedResident(null);\r\n      return;\r\n    }\r\n\r\n    const loadResidents = async () => {\r\n      setLoadingResidents(true);\r\n      setSelectedResident(null);\r\n      try {\r\n        const data = await usersApi.getAll({ role: 'resident', building_id: selectedBuilding, limit: 500 });\r\n        setResidents(data.users || []);\r\n      } catch (error) {\r\n        console.error('Failed to load residents:', error);\r\n      } finally {\r\n        setLoadingResidents(false);\r\n      }\r\n    };\r\n    loadResidents();\r\n  }, [selectedBuilding]);\r\n\r\n  const categories: { value: ExecutorSpecialization; label: string }[] = [\r\n    { value: 'plumber', label: 'Сантехник' },\r\n    { value: 'electrician', label: 'Электрик' },\r\n    { value: 'security', label: 'Охрана' },\r\n    { value: 'cleaning', label: 'Уборка' },\r\n    { value: 'elevator', label: 'Лифт' },\r\n    { value: 'intercom', label: 'Домофон' },\r\n    { value: 'carpenter', label: 'Плотник' },\r\n    { value: 'boiler', label: 'Котёл' },\r\n    { value: 'other', label: 'Другое' },\r\n  ];\r\n\r\n  const timeSlots = [\r\n    { value: '09:00-11:00', label: '09:00 - 11:00' },\r\n    { value: '11:00-13:00', label: '11:00 - 13:00' },\r\n    { value: '13:00-15:00', label: '13:00 - 15:00' },\r\n    { value: '15:00-17:00', label: '15:00 - 17:00' },\r\n    { value: '17:00-19:00', label: '17:00 - 19:00' },\r\n  ];\r\n\r\n  const getMinDate = () => {\r\n    const today = new Date();\r\n    return today.toISOString().split('T')[0];\r\n  };\r\n\r\n  const getMaxDate = () => {\r\n    const maxDate = new Date();\r\n    maxDate.setDate(maxDate.getDate() + 30);\r\n    return maxDate.toISOString().split('T')[0];\r\n  };\r\n\r\n  const handleResidentSelect = (residentId: string) => {\r\n    const resident = residents.find(r => r.id === residentId);\r\n    setSelectedResident(resident || null);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!title.trim() || !description.trim() || !selectedResident) return;\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      await onSubmit({\r\n        title,\r\n        description,\r\n        category,\r\n        priority,\r\n        residentId: selectedResident.id,\r\n        residentName: selectedResident.name,\r\n        residentPhone: selectedResident.phone || 'Не указан',\r\n        address: selectedResident.address || buildings.find(b => b.id === selectedBuilding)?.address || '',\r\n        apartment: selectedResident.apartment || '0',\r\n        scheduledDate: scheduledDate || undefined,\r\n        scheduledTime: scheduledTime || undefined,\r\n      });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const selectedBranchName = branches.find(b => b.code === selectedBranch)?.name;\r\n  const selectedBuildingData = buildings.find(b => b.id === selectedBuilding);\r\n\r\n  return (\r\n    <div className=\"modal-backdrop\">\r\n      <div className=\"modal-content p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h2 className=\"text-xl font-bold\">Создать заявку</h2>\r\n          <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-lg\">\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          {/* Category */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Категория *\r\n            </label>\r\n            <select\r\n              value={category}\r\n              onChange={(e) => setCategory(e.target.value as ExecutorSpecialization)}\r\n              className=\"glass-input w-full\"\r\n              required\r\n            >\r\n              {categories.map(cat => (\r\n                <option key={cat.value} value={cat.value}>{cat.label}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Title */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Заголовок *\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={title}\r\n              onChange={(e) => setTitle(e.target.value)}\r\n              className=\"glass-input w-full\"\r\n              placeholder=\"Кратко опишите проблему\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/* Description */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Описание *\r\n            </label>\r\n            <textarea\r\n              value={description}\r\n              onChange={(e) => setDescription(e.target.value)}\r\n              className=\"glass-input w-full min-h-[100px] resize-none\"\r\n              placeholder=\"Подробное описание проблемы\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/* Priority */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Приоритет\r\n            </label>\r\n            <div className=\"grid grid-cols-4 gap-2\">\r\n              {(['low', 'medium', 'high', 'urgent'] as RequestPriority[]).map((p) => (\r\n                <button\r\n                  key={p}\r\n                  type=\"button\"\r\n                  onClick={() => setPriority(p)}\r\n                  className={`py-2 px-3 rounded-lg text-sm font-medium transition-all ${\r\n                    priority === p\r\n                      ? p === 'urgent' ? 'bg-red-500 text-white' :\r\n                        p === 'high' ? 'bg-orange-500 text-white' :\r\n                        p === 'medium' ? 'bg-amber-500 text-white' :\r\n                        'bg-gray-500 text-white'\r\n                      : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                  }`}\r\n                >\r\n                  {p === 'low' ? 'Низкий' : p === 'medium' ? 'Средний' : p === 'high' ? 'Высокий' : 'Срочный'}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Resident Selection - Cascading */}\r\n          <div className=\"border-t pt-4 mt-4\">\r\n            <h3 className=\"font-medium text-gray-900 mb-3 flex items-center gap-2\">\r\n              <User className=\"w-5 h-5\" />\r\n              Выбор жителя\r\n            </h3>\r\n\r\n            {/* Branch Selection */}\r\n            <div className=\"mb-3\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1\">\r\n                <GitBranch className=\"w-4 h-4\" />\r\n                Филиал *\r\n              </label>\r\n              <select\r\n                value={selectedBranch}\r\n                onChange={(e) => setSelectedBranch(e.target.value)}\r\n                className=\"glass-input w-full\"\r\n                disabled={loadingBranches}\r\n              >\r\n                <option value=\"\">\r\n                  {loadingBranches ? 'Загрузка...' : 'Выберите филиал'}\r\n                </option>\r\n                {branches.map(branch => (\r\n                  <option key={branch.code} value={branch.code}>{branch.name}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            {/* Building Selection */}\r\n            <div className=\"mb-3\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1\">\r\n                <Building2 className=\"w-4 h-4\" />\r\n                Дом *\r\n              </label>\r\n              <select\r\n                value={selectedBuilding}\r\n                onChange={(e) => setSelectedBuilding(e.target.value)}\r\n                className=\"glass-input w-full\"\r\n                disabled={!selectedBranch || loadingBuildings}\r\n              >\r\n                <option value=\"\">\r\n                  {loadingBuildings ? 'Загрузка...' : !selectedBranch ? 'Сначала выберите филиал' : 'Выберите дом'}\r\n                </option>\r\n                {buildings.map(building => (\r\n                  <option key={building.id} value={building.id}>\r\n                    {building.name} - {building.address}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            {/* Resident Selection */}\r\n            <div className=\"mb-3\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1\">\r\n                <User className=\"w-4 h-4\" />\r\n                Житель *\r\n              </label>\r\n              <select\r\n                value={selectedResident?.id || ''}\r\n                onChange={(e) => handleResidentSelect(e.target.value)}\r\n                className=\"glass-input w-full\"\r\n                disabled={!selectedBuilding || loadingResidents}\r\n              >\r\n                <option value=\"\">\r\n                  {loadingResidents ? 'Загрузка...' : !selectedBuilding ? 'Сначала выберите дом' : 'Выберите жителя'}\r\n                </option>\r\n                {residents.map(resident => (\r\n                  <option key={resident.id} value={resident.id}>\r\n                    {resident.name} {resident.apartment ? `- кв. ${resident.apartment}` : ''}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            {/* Selected Resident Info */}\r\n            {selectedResident && (\r\n              <div className=\"bg-primary-50 border border-primary-200 rounded-xl p-4 mt-3\">\r\n                <div className=\"flex items-start gap-3\">\r\n                  <div className=\"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center\">\r\n                    <User className=\"w-5 h-5 text-primary-600\" />\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"font-semibold text-gray-900\">{selectedResident.name}</p>\r\n                    <p className=\"text-sm text-gray-600\">\r\n                      {selectedResident.phone || 'Телефон не указан'}\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-500 flex items-center gap-1 mt-1\">\r\n                      <MapPin className=\"w-3 h-3\" />\r\n                      {selectedBuildingData?.address || selectedResident.address}\r\n                      {selectedResident.apartment && `, кв. ${selectedResident.apartment}`}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Selection Path Display */}\r\n            {(selectedBranchName || selectedBuildingData) && (\r\n              <div className=\"flex items-center gap-1 text-xs text-gray-500 mt-2 flex-wrap\">\r\n                {selectedBranchName && (\r\n                  <>\r\n                    <span className=\"bg-gray-100 px-2 py-1 rounded\">{selectedBranchName}</span>\r\n                    {selectedBuildingData && <ChevronRight className=\"w-3 h-3\" />}\r\n                  </>\r\n                )}\r\n                {selectedBuildingData && (\r\n                  <>\r\n                    <span className=\"bg-gray-100 px-2 py-1 rounded\">{selectedBuildingData.name}</span>\r\n                    {selectedResident && <ChevronRight className=\"w-3 h-3\" />}\r\n                  </>\r\n                )}\r\n                {selectedResident && (\r\n                  <span className=\"bg-primary-100 text-primary-700 px-2 py-1 rounded\">\r\n                    {selectedResident.name}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Schedule */}\r\n          <div className=\"border-t pt-4 mt-4\">\r\n            <h3 className=\"font-medium text-gray-900 mb-3\">Желаемое время (опционально)</h3>\r\n            <div className=\"grid grid-cols-2 gap-3\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Дата\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={scheduledDate}\r\n                  onChange={(e) => setScheduledDate(e.target.value)}\r\n                  className=\"glass-input w-full\"\r\n                  min={getMinDate()}\r\n                  max={getMaxDate()}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Время\r\n                </label>\r\n                <select\r\n                  value={scheduledTime}\r\n                  onChange={(e) => setScheduledTime(e.target.value)}\r\n                  className=\"glass-input w-full\"\r\n                >\r\n                  <option value=\"\">Любое время</option>\r\n                  {timeSlots.map(slot => (\r\n                    <option key={slot.value} value={slot.value}>{slot.label}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex gap-3 pt-4 border-t\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"btn-secondary flex-1\"\r\n            >\r\n              Отмена\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={isSubmitting || !title.trim() || !description.trim() || !selectedResident}\r\n              className=\"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {isSubmitting ? 'Создание...' : 'Создать заявку'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["RequestsPage","user","useAuthStore","requests","executors","assignRequest","addRequest","fetchRequests","fetchExecutors","isLoadingRequests","useDataStore","searchParams","useSearchParams","statusFilter","filter","setFilter","useState","searchQuery","setSearchQuery","showAssignModal","setShowAssignModal","showCreateModal","setShowCreateModal","canCreateRequest","useEffect","isDepartmentHead","userSpecialization","departmentRequests","useMemo","r","departmentExecutors","e","getStatusBadge","status","jsx","filteredRequests","matchesStatus","matchesSearch","jsxs","SPECIALIZATION_LABELS","Plus","Search","Loader2","req","MapPin","formatAddress","executor","CreateRequestModal","data","onClose","onSubmit","title","setTitle","description","setDescription","category","setCategory","priority","setPriority","scheduledDate","setScheduledDate","scheduledTime","setScheduledTime","isSubmitting","setIsSubmitting","branches","setBranches","buildings","setBuildings","residents","setResidents","selectedBranch","setSelectedBranch","selectedBuilding","setSelectedBuilding","selectedResident","setSelectedResident","loadingBranches","setLoadingBranches","loadingBuildings","setLoadingBuildings","loadingResidents","setLoadingResidents","branchesApi","filteredBuildings","buildingsApi","b","usersApi","categories","timeSlots","getMinDate","getMaxDate","maxDate","handleResidentSelect","residentId","resident","handleSubmit","selectedBranchName","selectedBuildingData","X","cat","p","User","GitBranch","branch","Building2","building","Fragment","ChevronRight","slot"],"mappings":"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"}
{"version":3,"file":"ResidentContractPage-1768649091948-zIv3r474.js","sources":["../../src/components/ContractQRCode.tsx","../../src/pages/ResidentContractPage.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { Download, FileText, Eye, EyeOff, Loader2 } from 'lucide-react';\r\nimport { generateQRCode } from './LazyQRCode';\r\nimport { generateContractDocx } from '../utils/contractGenerator';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { ContractPreview } from './ContractPreview';\r\n\r\ninterface ContractQRCodeProps {\r\n  language: 'ru' | 'uz';\r\n}\r\n\r\nexport function ContractQRCode({ language }: ContractQRCodeProps) {\r\n  // Use user from store directly to get updates when contract is signed\r\n  const { user, markContractSigned } = useAuthStore();\r\n  const [showContract, setShowContract] = useState(false);\r\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\r\n  const [isDownloading, setIsDownloading] = useState(false);\r\n\r\n  // Check if contract is already signed - using store user for reactivity\r\n  const isContractSigned = !!user?.contractSignedAt;\r\n\r\n  // Generate QR code with resident's personal data\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    const generateQR = async () => {\r\n      // Compact format with Cyrillic - no decorative symbols\r\n      const residentData = [\r\n        `ФИО: ${user.name || 'Собственник'}`,\r\n        `Л/С: ${user.login}`,\r\n        user.address ? `Адрес: ${user.address}` : null,\r\n        user.apartment ? `Кв: ${user.apartment}` : null,\r\n        user.phone ? `Тел: ${user.phone}` : null,\r\n      ].filter(Boolean).join('\\n');\r\n\r\n      const url = await generateQRCode(residentData, {\r\n        width: 300,\r\n        margin: 1,\r\n        errorCorrectionLevel: 'M',\r\n        color: { dark: '#000000', light: '#ffffff' },\r\n      });\r\n      setQrCodeUrl(url);\r\n    };\r\n\r\n    generateQR();\r\n  }, [user]);\r\n\r\n  const handleDownloadContract = async () => {\r\n    if (!user || !qrCodeUrl || isDownloading) return;\r\n\r\n    setIsDownloading(true);\r\n    try {\r\n      await generateContractDocx(user, qrCodeUrl, language);\r\n      // Mark contract as signed in database (persists across devices) - only if not already signed\r\n      if (!isContractSigned) {\r\n        await markContractSigned();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error generating contract:', error);\r\n      alert(language === 'ru'\r\n        ? 'Ошибка при генерации договора'\r\n        : 'Shartnoma yaratishda xatolik');\r\n    } finally {\r\n      setIsDownloading(false);\r\n    }\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <div className=\"glass-card p-4 md:p-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center gap-3 mb-6\">\r\n        <div className={`w-12 h-12 bg-gradient-to-br ${isContractSigned ? 'from-green-400 to-green-500' : 'from-orange-400 to-orange-500'} rounded-xl flex items-center justify-center shadow-sm`}>\r\n          <FileText className=\"w-6 h-6 text-white\" />\r\n        </div>\r\n        <div>\r\n          <h3 className=\"font-bold text-lg text-gray-900\">\r\n            {language === 'ru' ? 'Договор с УК' : 'UK bilan shartnoma'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500\">\r\n            {isContractSigned\r\n              ? (language === 'ru' ? `Подписан ${new Date(user.contractSignedAt!).toLocaleDateString('ru-RU')}` : `Imzolangan ${new Date(user.contractSignedAt!).toLocaleDateString('uz-UZ')}`)\r\n              : (language === 'ru' ? 'Ваш уникальный QR-код' : 'Sizning noyob QR-kodingiz')\r\n            }\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* QR Code Display */}\r\n      <div className=\"bg-white border border-gray-200 rounded-xl p-6 mb-4 flex flex-col items-center\">\r\n        {qrCodeUrl ? (\r\n          <img src={qrCodeUrl} alt=\"QR Code\" className=\"w-40 h-40\" />\r\n        ) : (\r\n          <div className=\"w-40 h-40 bg-gray-100 rounded animate-pulse\" />\r\n        )}\r\n        <p className=\"text-sm text-gray-500 mt-3 text-center\">\r\n          {language === 'ru'\r\n            ? 'Сканируйте для просмотра данных'\r\n            : 'Ma\\'lumotlarni ko\\'rish uchun skanerlang'}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Resident Info */}\r\n      <div className=\"bg-gray-50 rounded-xl p-3 mb-4\">\r\n        <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n          <div>\r\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Житель:' : 'Aholi:'}</span>\r\n            <p className=\"font-medium text-gray-900\">{user.name || '—'}</p>\r\n          </div>\r\n          <div>\r\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Адрес:' : 'Manzil:'}</span>\r\n            <p className=\"font-medium text-gray-900\">\r\n              {user.address ? (\r\n                user.apartment ? `${user.address}, кв. ${user.apartment}` : user.address\r\n              ) : (\r\n                user.apartment ? `кв. ${user.apartment}` : '—'\r\n              )}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Action Buttons */}\r\n      <div className=\"grid grid-cols-2 gap-3\">\r\n        <button\r\n          onClick={() => setShowContract(!showContract)}\r\n          className=\"flex items-center justify-center gap-2 px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl text-sm font-medium text-gray-700 transition-colors touch-manipulation\"\r\n        >\r\n          {showContract ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\r\n          {showContract\r\n            ? (language === 'ru' ? 'Скрыть' : 'Yashirish')\r\n            : (language === 'ru' ? 'Посмотреть' : 'Ko\\'rish')\r\n          }\r\n        </button>\r\n        <button\r\n          onClick={handleDownloadContract}\r\n          disabled={isDownloading || !qrCodeUrl}\r\n          className={`flex items-center justify-center gap-2 px-4 py-3 ${isContractSigned ? 'bg-green-500 hover:bg-green-600' : 'bg-orange-400 hover:bg-orange-500'} disabled:bg-gray-300 disabled:cursor-not-allowed rounded-xl text-sm font-medium text-gray-900 transition-colors touch-manipulation`}\r\n        >\r\n          {isDownloading ? (\r\n            <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n          ) : (\r\n            <Download className=\"w-4 h-4\" />\r\n          )}\r\n          {isDownloading\r\n            ? (language === 'ru' ? 'Подготовка...' : 'Tayyorlanmoqda...')\r\n            : isContractSigned\r\n              ? (language === 'ru' ? 'Скачать договор' : 'Shartnomani yuklash')\r\n              : (language === 'ru' ? 'Подписать и скачать' : 'Imzolash va yuklash')\r\n          }\r\n        </button>\r\n      </div>\r\n\r\n      {/* Full Contract Preview */}\r\n      {showContract && (\r\n        <div className=\"mt-4\">\r\n          <ContractPreview user={user} qrCodeUrl={qrCodeUrl} language={language} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { User } from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useLanguageStore } from '../stores/languageStore';\r\nimport { ContractQRCode } from '../components/ContractQRCode';\r\n\r\nexport function ResidentContractPage() {\r\n  const { user } = useAuthStore();\r\n  const { language } = useLanguageStore();\r\n\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\r\n      {/* Header */}\r\n      <div>\r\n        <h1 className=\"text-xl md:text-2xl font-bold text-gray-900\">\r\n          {language === 'ru' ? 'Договор с УК' : 'UK bilan shartnoma'}\r\n        </h1>\r\n        <p className=\"text-sm text-gray-500 mt-1\">\r\n          {language === 'ru' ? 'Ваш договор и уникальный QR-код' : 'Sizning shartnomangiz va noyob QR-kodingiz'}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Contract QR Code - uses user from store directly */}\r\n      <ContractQRCode language={language} />\r\n\r\n      {/* User Info Card */}\r\n      <div className=\"glass-card p-4 md:p-6\">\r\n        <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center gap-2\">\r\n          <User className=\"w-5 h-5 text-gray-600\" />\r\n          {language === 'ru' ? 'Данные профиля' : 'Profil ma\\'lumotlari'}\r\n        </h3>\r\n        <div className=\"space-y-3 text-sm\">\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-500\">{language === 'ru' ? 'ФИО' : 'F.I.O'}</span>\r\n            <span className=\"font-medium text-gray-900\">{user.name}</span>\r\n          </div>\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Логин' : 'Login'}</span>\r\n            <span className=\"font-medium text-gray-900\">{user.login}</span>\r\n          </div>\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Телефон' : 'Telefon'}</span>\r\n            <span className=\"font-medium text-gray-900\">{user.phone || '-'}</span>\r\n          </div>\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Адрес' : 'Manzil'}</span>\r\n            <span className=\"font-medium text-gray-900\">{user.address || '-'}</span>\r\n          </div>\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Квартира' : 'Xonadon'}</span>\r\n            <span className=\"font-medium text-gray-900\">{user.apartment || '-'}</span>\r\n          </div>\r\n          {user.branch && (\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-gray-500\">{language === 'ru' ? 'Филиал' : 'Filial'}</span>\r\n              <span className=\"font-medium text-gray-900\">{user.branch}</span>\r\n            </div>\r\n          )}\r\n          {user.building && (\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-gray-500\">{language === 'ru' ? 'Дом' : 'Uy'}</span>\r\n              <span className=\"font-medium text-gray-900\">{user.building}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ContractQRCode","language","user","markContractSigned","useAuthStore","showContract","setShowContract","useState","qrCodeUrl","setQrCodeUrl","isDownloading","setIsDownloading","isContractSigned","useEffect","residentData","url","generateQRCode","handleDownloadContract","generateContractDocx","jsxs","jsx","FileText","EyeOff","Eye","Loader2","Download","ContractPreview","ResidentContractPage","useLanguageStore","User"],"mappings":"obAWO,SAASA,EAAe,CAAE,SAAAC,GAAiC,CAEhE,KAAM,CAAE,KAAAC,EAAM,mBAAAC,CAAA,EAAuBC,EAAA,EAC/B,CAACC,EAAcC,CAAe,EAAIC,EAAAA,SAAS,EAAK,EAChD,CAACC,EAAWC,CAAY,EAAIF,EAAAA,SAAiB,EAAE,EAC/C,CAACG,EAAeC,CAAgB,EAAIJ,EAAAA,SAAS,EAAK,EAGlDK,EAAmB,CAAC,CAACV,GAAM,iBAGjCW,EAAAA,UAAU,IAAM,CACd,GAAI,CAACX,EAAM,QAEQ,SAAY,CAE7B,MAAMY,EAAe,CACnB,QAAQZ,EAAK,MAAQ,aAAa,GAClC,QAAQA,EAAK,KAAK,GAClBA,EAAK,QAAU,UAAUA,EAAK,OAAO,GAAK,KAC1CA,EAAK,UAAY,OAAOA,EAAK,SAAS,GAAK,KAC3CA,EAAK,MAAQ,QAAQA,EAAK,KAAK,GAAK,IAAA,EACpC,OAAO,OAAO,EAAE,KAAK;AAAA,CAAI,EAErBa,EAAM,MAAMC,EAAeF,EAAc,CAC7C,MAAO,IACP,OAAQ,EACR,qBAAsB,IACtB,MAAO,CAAE,KAAM,UAAW,MAAO,SAAA,CAAU,CAC5C,EACDL,EAAaM,CAAG,CAClB,GAEA,CACF,EAAG,CAACb,CAAI,CAAC,EAET,MAAMe,EAAyB,SAAY,CACzC,GAAI,GAACf,GAAQ,CAACM,GAAaE,GAE3B,CAAAC,EAAiB,EAAI,EACrB,GAAI,CACF,MAAMO,EAAqBhB,EAAMM,EAAWP,CAAQ,EAE/CW,GACH,MAAMT,EAAA,CAEV,MAAgB,CAEd,MAAMF,IAAa,KACf,gCACA,8BAA8B,CACpC,QAAA,CACEU,EAAiB,EAAK,CACxB,EACF,EAEA,OAAKT,EAGHiB,EAAAA,KAAC,MAAA,CAAI,UAAU,wBAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAW,+BAA+BR,EAAmB,8BAAgC,+BAA+B,yDAC/H,SAAAQ,EAAAA,IAACC,EAAA,CAAS,UAAU,oBAAA,CAAqB,EAC3C,SACC,MAAA,CACC,SAAA,CAAAD,MAAC,MAAG,UAAU,kCACX,SAAAnB,IAAa,KAAO,eAAiB,qBACxC,EACAmB,EAAAA,IAAC,IAAA,CAAE,UAAU,wBACV,SAAAR,EACIX,IAAa,KAAO,YAAY,IAAI,KAAKC,EAAK,gBAAiB,EAAE,mBAAmB,OAAO,CAAC,GAAK,cAAc,IAAI,KAAKA,EAAK,gBAAiB,EAAE,mBAAmB,OAAO,CAAC,GAC3KD,IAAa,KAAO,wBAA0B,2BAAA,CAErD,CAAA,CAAA,CACF,CAAA,EACF,EAGAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,iFACZ,SAAA,CAAAX,EACCY,EAAAA,IAAC,MAAA,CAAI,IAAKZ,EAAW,IAAI,UAAU,UAAU,WAAA,CAAY,EAEzDY,EAAAA,IAAC,MAAA,CAAI,UAAU,8CAA8C,QAE9D,IAAA,CAAE,UAAU,yCACV,SAAAnB,IAAa,KACV,kCACA,wCAAA,CACN,CAAA,EACF,QAGC,MAAA,CAAI,UAAU,iCACb,SAAAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,UAAY,SAAS,QACzE,IAAA,CAAE,UAAU,4BAA6B,SAAAC,EAAK,MAAQ,GAAA,CAAI,CAAA,EAC7D,SACC,MAAA,CACC,SAAA,CAAAkB,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,SAAW,UAAU,EAC1EmB,EAAAA,IAAC,KAAE,UAAU,4BACV,WAAK,QACJlB,EAAK,UAAY,GAAGA,EAAK,OAAO,SAASA,EAAK,SAAS,GAAKA,EAAK,QAEjEA,EAAK,UAAY,OAAOA,EAAK,SAAS,GAAK,GAAA,CAE/C,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAGAiB,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,QAAS,IAAMb,EAAgB,CAACD,CAAY,EAC5C,UAAU,mKAET,SAAA,CAAAA,EAAee,EAAAA,IAACE,GAAO,UAAU,SAAA,CAAU,EAAKF,EAAAA,IAACG,EAAA,CAAI,UAAU,SAAA,CAAU,EACzElB,EACIJ,IAAa,KAAO,SAAW,YAC/BA,IAAa,KAAO,aAAe,SAAA,CAAA,CAAA,EAG1CkB,EAAAA,KAAC,SAAA,CACC,QAASF,EACT,SAAUP,GAAiB,CAACF,EAC5B,UAAW,oDAAoDI,EAAmB,kCAAoC,mCAAmC,sIAExJ,SAAA,CAAAF,EACCU,EAAAA,IAACI,GAAQ,UAAU,sBAAA,CAAuB,EAE1CJ,EAAAA,IAACK,EAAA,CAAS,UAAU,SAAA,CAAU,EAE/Bf,EACIT,IAAa,KAAO,gBAAkB,oBACvCW,EACGX,IAAa,KAAO,kBAAoB,sBACxCA,IAAa,KAAO,sBAAwB,qBAAA,CAAA,CAAA,CAErD,EACF,EAGCI,GACCe,EAAAA,IAAC,MAAA,CAAI,UAAU,OACb,eAACM,EAAA,CAAgB,KAAAxB,EAAY,UAAAM,EAAsB,SAAAP,CAAA,CAAoB,CAAA,CACzE,CAAA,EAEJ,EA7FgB,IA+FpB,CC7JO,SAAS0B,GAAuB,CACrC,KAAM,CAAE,KAAAzB,CAAA,EAASE,EAAA,EACX,CAAE,SAAAH,CAAA,EAAa2B,EAAA,EAErB,OAAK1B,EAKHiB,EAAAA,KAAC,MAAA,CAAI,UAAU,uCAEb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,MAAC,MAAG,UAAU,8CACX,SAAAnB,IAAa,KAAO,eAAiB,qBACxC,QACC,IAAA,CAAE,UAAU,6BACV,SAAAA,IAAa,KAAO,kCAAoC,4CAAA,CAC3D,CAAA,EACF,EAGAmB,MAACpB,GAAe,SAAAC,EAAoB,EAGpCkB,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,2DACZ,SAAA,CAAAC,EAAAA,IAACS,EAAA,CAAK,UAAU,uBAAA,CAAwB,EACvC5B,IAAa,KAAO,iBAAmB,qBAAA,EAC1C,EACAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,MAAQ,QAAQ,EACrEmB,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA6B,WAAK,IAAA,CAAK,CAAA,EACzD,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,QAAU,QAAQ,EACvEmB,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA6B,WAAK,KAAA,CAAM,CAAA,EAC1D,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,UAAY,UAAU,QAC1E,OAAA,CAAK,UAAU,4BAA6B,SAAAC,EAAK,OAAS,GAAA,CAAI,CAAA,EACjE,EACAiB,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,QAAU,SAAS,QACvE,OAAA,CAAK,UAAU,4BAA6B,SAAAC,EAAK,SAAW,GAAA,CAAI,CAAA,EACnE,EACAiB,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,WAAa,UAAU,QAC3E,OAAA,CAAK,UAAU,4BAA6B,SAAAC,EAAK,WAAa,GAAA,CAAI,CAAA,EACrE,EACCA,EAAK,QACJiB,OAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,SAAW,SAAS,EACzEmB,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA6B,WAAK,MAAA,CAAO,CAAA,EAC3D,EAEDlB,EAAK,UACJiB,OAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAAnB,IAAa,KAAO,MAAQ,KAAK,EAClEmB,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA6B,WAAK,QAAA,CAAS,CAAA,CAAA,CAC7D,CAAA,CAAA,CAEJ,CAAA,CAAA,CACF,CAAA,EACF,EA3DO,IA6DX"}
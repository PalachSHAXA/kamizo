{"version":3,"mappings":"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","names":["AnnouncementsPage","user","useAuthStore","announcements","addAnnouncement","deleteAnnouncement","updateAnnouncement","fetchAnnouncements","useDataStore","t","language","useLanguageStore","canManageAnnouncements","activeTab","setActiveTab","useState","showAddModal","setShowAddModal","showEditModal","setShowEditModal","editingAnnouncement","setEditingAnnouncement","newAnnouncement","setNewAnnouncement","targetType","setTargetType","selectedBranch","setSelectedBranch","selectedBuilding","setSelectedBuilding","customLogins","setCustomLogins","uploadedFileName","setUploadedFileName","fileInputRef","useRef","attachments","setAttachments","isUploadingAttachment","setIsUploadingAttachment","attachmentInputRef","buildings","setBuildings","useEffect","result","buildingsApi","branches","useMemo","branchMap","b","branchCode","branch","dateFilter","setDateFilter","filterByDate","items","now","today","weekAgo","monthAgo","a","createdAt","residentAnnouncements","employeeAnnouncements","currentAnnouncements","handleFileUpload","e","file","XLSX","reader","event","data","workbook","sheetName","sheet","jsonData","logins","row","value","buildTarget","getTargetDescription","building","resetTargeting","handleAttachmentUpload","files","newAttachments","uploadApi","prev","removeAttachment","index","_","i","getFileIcon","type","jsx","Image","FileText","File","formatFileSize","bytes","handleAddAnnouncement","target","handleDelete","id","getPriorityIcon","priority","AlertTriangle","AlertCircle","Info","getPriorityBadge","formatDate","dateStr","jsxs","Plus","Users","Briefcase","Filter","Megaphone","announcement","AnnouncementCard","X","Target","Building2","FileSpreadsheet","label","Icon","Upload","Paperclip","Fragment","attachment","p","onDelete","onEdit","canDelete","canEdit","showViewers","setShowViewers","viewers","setViewers","isLoadingViewers","setIsLoadingViewers","viewStats","setViewStats","viewCount","handleViewClick","announcementsApi","__vitePreload","n","Download","Clock","Eye","Trash2","viewer"],"ignoreList":[],"sources":["../../src/pages/AnnouncementsPage.tsx"],"sourcesContent":["import { useState, useMemo, useRef, useEffect } from 'react';\r\nimport { Plus, Megaphone, Users, Briefcase, X, AlertTriangle, AlertCircle, Info, Trash2, Eye, Clock, Building2, Upload, FileSpreadsheet, Target, Filter, Paperclip, File, Image, FileText, Download } from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useDataStore } from '../stores/dataStore';\r\nimport { useLanguageStore } from '../stores/languageStore';\r\nimport { buildingsApi, uploadApi } from '../services/api';\r\nimport type { Announcement, AnnouncementType, AnnouncementPriority, AnnouncementTargetType, AnnouncementTarget, FileAttachment } from '../types';\r\n\r\nexport function AnnouncementsPage() {\r\n  const { user } = useAuthStore();\r\n  const { announcements, addAnnouncement, deleteAnnouncement, updateAnnouncement, fetchAnnouncements } = useDataStore();\r\n  const { t, language } = useLanguageStore();\r\n\r\n  // Only admin, manager, director can create/edit announcements\r\n  const canManageAnnouncements = user?.role === 'admin' || user?.role === 'manager' || user?.role === 'director';\r\n\r\n  const [activeTab, setActiveTab] = useState<'residents' | 'employees'>('residents');\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n  const [editingAnnouncement, setEditingAnnouncement] = useState<Announcement | null>(null);\r\n  const [newAnnouncement, setNewAnnouncement] = useState({\r\n    title: '',\r\n    content: '',\r\n    type: 'residents' as AnnouncementType,\r\n    priority: 'normal' as AnnouncementPriority,\r\n    expiresAt: '',\r\n  });\r\n\r\n  // Targeting state\r\n  const [targetType, setTargetType] = useState<AnnouncementTargetType>('all');\r\n  const [selectedBranch, setSelectedBranch] = useState('');\r\n  const [selectedBuilding, setSelectedBuilding] = useState('');\r\n  const [customLogins, setCustomLogins] = useState<string[]>([]);\r\n  const [uploadedFileName, setUploadedFileName] = useState('');\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // File attachments state\r\n  const [attachments, setAttachments] = useState<FileAttachment[]>([]);\r\n  const [isUploadingAttachment, setIsUploadingAttachment] = useState(false);\r\n  const attachmentInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // Real buildings from API\r\n  const [buildings, setBuildings] = useState<any[]>([]);\r\n\r\n  // Fetch buildings on mount\r\n  useEffect(() => {\r\n    const loadBuildings = async () => {\r\n      try {\r\n        const result = await buildingsApi.getAll();\r\n        setBuildings(result.buildings || []);\r\n      } catch (error) {\r\n        console.error('Failed to load buildings:', error);\r\n      }\r\n    };\r\n    loadBuildings();\r\n    fetchAnnouncements(); // Also refresh announcements\r\n  }, [fetchAnnouncements]);\r\n\r\n  // Extract unique branches from buildings (using branch_code field)\r\n  const branches = useMemo(() => {\r\n    const branchMap = new Map<string, { id: string; name: string; buildingCount: number }>();\r\n    buildings.forEach(b => {\r\n      const branchCode = b.branch_code || b.branchCode || 'default';\r\n      if (!branchMap.has(branchCode)) {\r\n        branchMap.set(branchCode, {\r\n          id: branchCode,\r\n          name: branchCode === 'default' ? (language === 'ru' ? 'Основной филиал' : 'Asosiy filial') : branchCode,\r\n          buildingCount: 0\r\n        });\r\n      }\r\n      const branch = branchMap.get(branchCode)!;\r\n      branch.buildingCount++;\r\n    });\r\n    return Array.from(branchMap.values());\r\n  }, [buildings, language]);\r\n\r\n  // Date filter state\r\n  const [dateFilter, setDateFilter] = useState<'all' | 'today' | 'week' | 'month'>('all');\r\n\r\n  // Filter announcements by type and date\r\n  const filterByDate = (items: typeof announcements) => {\r\n    if (dateFilter === 'all') return items;\r\n\r\n    const now = new Date();\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);\r\n\r\n    return items.filter(a => {\r\n      const createdAt = new Date(a.createdAt);\r\n      switch (dateFilter) {\r\n        case 'today':\r\n          return createdAt >= today;\r\n        case 'week':\r\n          return createdAt >= weekAgo;\r\n        case 'month':\r\n          return createdAt >= monthAgo;\r\n        default:\r\n          return true;\r\n      }\r\n    });\r\n  };\r\n\r\n  const residentAnnouncements = useMemo(() =>\r\n    filterByDate(announcements.filter(a => a.type === 'residents' && a.isActive)),\r\n    [announcements, dateFilter]\r\n  );\r\n\r\n  const employeeAnnouncements = useMemo(() =>\r\n    filterByDate(announcements.filter(a => a.type === 'employees' && a.isActive)),\r\n    [announcements, dateFilter]\r\n  );\r\n\r\n  const currentAnnouncements = activeTab === 'residents' ? residentAnnouncements : employeeAnnouncements;\r\n\r\n  // Handle Excel file upload for custom targeting\r\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setUploadedFileName(file.name);\r\n\r\n    // Lazy load XLSX library\r\n    const XLSX = await import('xlsx');\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      try {\r\n        const data = event.target?.result;\r\n        const workbook = XLSX.read(data, { type: 'binary' });\r\n        const sheetName = workbook.SheetNames[0];\r\n        const sheet = workbook.Sheets[sheetName];\r\n        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 }) as any[][];\r\n\r\n        // Extract logins from first column (skip header)\r\n        const logins: string[] = [];\r\n        jsonData.slice(1).forEach(row => {\r\n          if (row[0]) {\r\n            const value = String(row[0]).trim();\r\n            if (value) logins.push(value);\r\n          }\r\n        });\r\n\r\n        setCustomLogins(logins);\r\n      } catch (err) {\r\n        console.error('Error parsing Excel file:', err);\r\n        alert(language === 'ru' ? 'Ошибка чтения файла' : 'Faylni o\\'qishda xato');\r\n      }\r\n    };\r\n    reader.readAsBinaryString(file);\r\n  };\r\n\r\n  // Build target object based on selections\r\n  const buildTarget = (): AnnouncementTarget | undefined => {\r\n    if (newAnnouncement.type !== 'residents') return undefined;\r\n\r\n    switch (targetType) {\r\n      case 'all':\r\n        return { type: 'all' };\r\n      case 'branch':\r\n        return selectedBranch ? { type: 'branch', branchId: selectedBranch } : undefined;\r\n      case 'building':\r\n        return selectedBuilding ? { type: 'building', buildingId: selectedBuilding } : undefined;\r\n      case 'custom':\r\n        return customLogins.length > 0 ? { type: 'custom', customLogins } : undefined;\r\n      default:\r\n        return { type: 'all' };\r\n    }\r\n  };\r\n\r\n  const getTargetDescription = (): string => {\r\n    if (newAnnouncement.type !== 'residents') return '';\r\n\r\n    switch (targetType) {\r\n      case 'all':\r\n        return language === 'ru' ? 'Все жители' : 'Barcha aholiga';\r\n      case 'branch':\r\n        const branch = branches.find(b => b.id === selectedBranch);\r\n        return branch ? branch.name : '';\r\n      case 'building':\r\n        const building = buildings.find(b => b.id === selectedBuilding);\r\n        return building ? building.name : '';\r\n      case 'custom':\r\n        return customLogins.length > 0\r\n          ? `${customLogins.length} ${language === 'ru' ? 'получателей' : 'qabul qiluvchi'}`\r\n          : '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const resetTargeting = () => {\r\n    setTargetType('all');\r\n    setSelectedBranch('');\r\n    setSelectedBuilding('');\r\n    setCustomLogins([]);\r\n    setUploadedFileName('');\r\n    if (fileInputRef.current) fileInputRef.current.value = '';\r\n  };\r\n\r\n  // Handle file attachment upload\r\n  const handleAttachmentUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    setIsUploadingAttachment(true);\r\n    try {\r\n      const newAttachments = await uploadApi.uploadFiles(Array.from(files));\r\n      setAttachments(prev => [...prev, ...newAttachments]);\r\n    } catch (error) {\r\n      console.error('Failed to upload attachments:', error);\r\n      alert(language === 'ru' ? 'Ошибка загрузки файла' : 'Fayl yuklashda xato');\r\n    } finally {\r\n      setIsUploadingAttachment(false);\r\n      if (attachmentInputRef.current) attachmentInputRef.current.value = '';\r\n    }\r\n  };\r\n\r\n  // Remove attachment\r\n  const removeAttachment = (index: number) => {\r\n    setAttachments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  // Get file icon based on type\r\n  const getFileIcon = (type: string) => {\r\n    if (type.startsWith('image/')) return <Image className=\"w-4 h-4\" />;\r\n    if (type.includes('pdf') || type.includes('word') || type.includes('document')) return <FileText className=\"w-4 h-4\" />;\r\n    return <File className=\"w-4 h-4\" />;\r\n  };\r\n\r\n  // Format file size\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes < 1024) return `${bytes} B`;\r\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\r\n    return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\r\n  };\r\n\r\n  const handleAddAnnouncement = async () => {\r\n    if (!newAnnouncement.title.trim() || !newAnnouncement.content.trim() || !user) return;\r\n\r\n    const target = buildTarget();\r\n\r\n    await addAnnouncement({\r\n      title: newAnnouncement.title,\r\n      content: newAnnouncement.content,\r\n      type: newAnnouncement.type,\r\n      priority: newAnnouncement.priority,\r\n      authorId: user.id,\r\n      authorName: user.name,\r\n      authorRole: user.role,\r\n      expiresAt: newAnnouncement.expiresAt || undefined,\r\n      target,\r\n      attachments: attachments.length > 0 ? attachments : undefined,\r\n    });\r\n\r\n    setNewAnnouncement({\r\n      title: '',\r\n      content: '',\r\n      type: 'residents',\r\n      priority: 'normal',\r\n      expiresAt: '',\r\n    });\r\n    resetTargeting();\r\n    setAttachments([]);\r\n    setShowAddModal(false);\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (confirm(language === 'ru' ? 'Удалить объявление?' : 'E\\'lonni o\\'chirishni tasdiqlaysizmi?')) {\r\n      await deleteAnnouncement(id);\r\n    }\r\n  };\r\n\r\n  const getPriorityIcon = (priority: AnnouncementPriority) => {\r\n    switch (priority) {\r\n      case 'urgent':\r\n        return <AlertTriangle className=\"w-4 h-4 text-red-500\" />;\r\n      case 'important':\r\n        return <AlertCircle className=\"w-4 h-4 text-amber-500\" />;\r\n      default:\r\n        return <Info className=\"w-4 h-4 text-blue-500\" />;\r\n    }\r\n  };\r\n\r\n  const getPriorityBadge = (priority: AnnouncementPriority) => {\r\n    switch (priority) {\r\n      case 'urgent':\r\n        return 'bg-red-100 text-red-700 border-red-200';\r\n      case 'important':\r\n        return 'bg-amber-100 text-amber-700 border-amber-200';\r\n      default:\r\n        return 'bg-blue-100 text-blue-700 border-blue-200';\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">{t('announcements.title')}</h1>\r\n          <p className=\"text-gray-500\">\r\n            {language === 'ru'\r\n              ? (canManageAnnouncements ? 'Создавайте объявления для жителей и сотрудников' : 'Объявления от управляющей компании')\r\n              : (canManageAnnouncements ? 'Aholi va xodimlar uchun e\\'lonlar yarating' : 'Boshqaruv kompaniyasidan e\\'lonlar')}\r\n          </p>\r\n        </div>\r\n        {/* Only admin, manager, director can create announcements */}\r\n        {canManageAnnouncements && (\r\n          <button\r\n            onClick={() => setShowAddModal(true)}\r\n            className=\"btn-primary flex items-center gap-2\"\r\n          >\r\n            <Plus className=\"w-5 h-5\" />\r\n            {t('announcements.add')}\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tabs and Date Filter */}\r\n      <div className=\"flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between\">\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            onClick={() => setActiveTab('residents')}\r\n            className={`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-colors ${\r\n              activeTab === 'residents'\r\n                ? 'bg-orange-400 text-gray-900'\r\n                : 'bg-white text-gray-600 hover:bg-gray-100'\r\n            }`}\r\n          >\r\n            <Users className=\"w-5 h-5\" />\r\n            {t('announcements.forResidents')}\r\n            {residentAnnouncements.length > 0 && (\r\n              <span className=\"ml-1 px-2 py-0.5 rounded-full bg-gray-900/10 text-xs\">\r\n                {residentAnnouncements.length}\r\n              </span>\r\n            )}\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab('employees')}\r\n            className={`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-colors ${\r\n              activeTab === 'employees'\r\n                ? 'bg-orange-400 text-gray-900'\r\n                : 'bg-white text-gray-600 hover:bg-gray-100'\r\n            }`}\r\n          >\r\n            <Briefcase className=\"w-5 h-5\" />\r\n            {t('announcements.forStaff')}\r\n            {employeeAnnouncements.length > 0 && (\r\n              <span className=\"ml-1 px-2 py-0.5 rounded-full bg-gray-900/10 text-xs\">\r\n                {employeeAnnouncements.length}\r\n              </span>\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Date Filter */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <Filter className=\"w-4 h-4 text-gray-400\" />\r\n          <select\r\n            value={dateFilter}\r\n            onChange={(e) => setDateFilter(e.target.value as typeof dateFilter)}\r\n            className=\"px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-sm text-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400\"\r\n          >\r\n            <option value=\"all\">{language === 'ru' ? 'Все время' : 'Barcha vaqt'}</option>\r\n            <option value=\"today\">{language === 'ru' ? 'Сегодня' : 'Bugun'}</option>\r\n            <option value=\"week\">{language === 'ru' ? 'Неделя' : 'Hafta'}</option>\r\n            <option value=\"month\">{language === 'ru' ? 'Месяц' : 'Oy'}</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Announcements List */}\r\n      <div className=\"space-y-4\">\r\n        {currentAnnouncements.length === 0 ? (\r\n          <div className=\"glass-card p-12 text-center\">\r\n            <Megaphone className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\r\n            <h3 className=\"text-lg font-medium text-gray-600 mb-2\">\r\n              {t('announcements.noAnnouncements')}\r\n            </h3>\r\n            <p className=\"text-gray-400\">{t('announcements.addFirst')}</p>\r\n          </div>\r\n        ) : (\r\n          currentAnnouncements.map((announcement) => (\r\n            <AnnouncementCard\r\n              key={announcement.id}\r\n              announcement={announcement}\r\n              onDelete={() => handleDelete(announcement.id)}\r\n              onEdit={() => {\r\n                setEditingAnnouncement(announcement);\r\n                setShowEditModal(true);\r\n              }}\r\n              formatDate={formatDate}\r\n              getPriorityIcon={getPriorityIcon}\r\n              getPriorityBadge={getPriorityBadge}\r\n              t={t}\r\n              canDelete={canManageAnnouncements && (user?.id === announcement.authorId || user?.role === 'admin')}\r\n              canEdit={canManageAnnouncements}\r\n              language={language}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      {/* Add Announcement Modal */}\r\n      {showAddModal && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"p-6 border-b border-gray-100 flex items-center justify-between\">\r\n              <h2 className=\"text-xl font-bold\">{t('announcements.add')}</h2>\r\n              <button\r\n                onClick={() => setShowAddModal(false)}\r\n                className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"p-6 space-y-4\">\r\n              {/* Type Selection */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('announcements.type')}\r\n                </label>\r\n                <div className=\"flex gap-2\">\r\n                  <button\r\n                    onClick={() => setNewAnnouncement({ ...newAnnouncement, type: 'residents' })}\r\n                    className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-medium transition-colors ${\r\n                      newAnnouncement.type === 'residents'\r\n                        ? 'bg-green-100 text-green-700 border-2 border-green-400'\r\n                        : 'bg-gray-100 text-gray-600 border-2 border-transparent'\r\n                    }`}\r\n                  >\r\n                    <Users className=\"w-5 h-5\" />\r\n                    {t('announcements.forResidents')}\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setNewAnnouncement({ ...newAnnouncement, type: 'employees' })}\r\n                    className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-medium transition-colors ${\r\n                      newAnnouncement.type === 'employees'\r\n                        ? 'bg-purple-100 text-purple-700 border-2 border-purple-400'\r\n                        : 'bg-gray-100 text-gray-600 border-2 border-transparent'\r\n                    }`}\r\n                  >\r\n                    <Briefcase className=\"w-5 h-5\" />\r\n                    {t('announcements.forStaff')}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Targeting (only for residents) */}\r\n              {newAnnouncement.type === 'residents' && (\r\n                <div className=\"border-2 border-dashed border-gray-200 rounded-xl p-4 space-y-3\">\r\n                  <div className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\r\n                    <Target className=\"w-4 h-4\" />\r\n                    {language === 'ru' ? 'Таргетирование' : 'Maqsadli auditoriya'}\r\n                  </div>\r\n\r\n                  {/* Target Type Selection */}\r\n                  <div className=\"grid grid-cols-4 gap-2\">\r\n                    {[\r\n                      { type: 'all' as AnnouncementTargetType, label: language === 'ru' ? 'Все' : 'Hammasi', icon: Users },\r\n                      { type: 'branch' as AnnouncementTargetType, label: language === 'ru' ? 'Филиал' : 'Filial', icon: Building2 },\r\n                      { type: 'building' as AnnouncementTargetType, label: language === 'ru' ? 'ЖК' : 'TJM', icon: Building2 },\r\n                      { type: 'custom' as AnnouncementTargetType, label: language === 'ru' ? 'Список' : 'Ro\\'yxat', icon: FileSpreadsheet },\r\n                    ].map(({ type, label, icon: Icon }) => (\r\n                      <button\r\n                        key={type}\r\n                        onClick={() => {\r\n                          setTargetType(type);\r\n                          if (type !== 'branch') setSelectedBranch('');\r\n                          if (type !== 'building') setSelectedBuilding('');\r\n                          if (type !== 'custom') {\r\n                            setCustomLogins([]);\r\n                            setUploadedFileName('');\r\n                          }\r\n                        }}\r\n                        className={`flex flex-col items-center gap-1 py-2 px-2 rounded-xl text-xs font-medium transition-colors ${\r\n                          targetType === type\r\n                            ? 'bg-primary-100 text-primary-700 border-2 border-primary-400'\r\n                            : 'bg-gray-50 text-gray-600 border-2 border-transparent hover:bg-gray-100'\r\n                        }`}\r\n                      >\r\n                        <Icon className=\"w-4 h-4\" />\r\n                        {label}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n\r\n                  {/* Branch Selection */}\r\n                  {targetType === 'branch' && (\r\n                    <select\r\n                      value={selectedBranch}\r\n                      onChange={(e) => setSelectedBranch(e.target.value)}\r\n                      className=\"glass-input\"\r\n                    >\r\n                      <option value=\"\">{language === 'ru' ? 'Выберите филиал...' : 'Filialni tanlang...'}</option>\r\n                      {branches.map(branch => (\r\n                        <option key={branch.id} value={branch.id}>\r\n                          {branch.name} ({branch.buildingCount} {language === 'ru' ? 'домов' : 'uy'})\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  )}\r\n\r\n                  {/* Building Selection */}\r\n                  {targetType === 'building' && (\r\n                    <select\r\n                      value={selectedBuilding}\r\n                      onChange={(e) => setSelectedBuilding(e.target.value)}\r\n                      className=\"glass-input\"\r\n                    >\r\n                      <option value=\"\">{language === 'ru' ? 'Выберите ЖК...' : 'TJM tanlang...'}</option>\r\n                      {buildings.map(building => (\r\n                        <option key={building.id} value={building.id}>\r\n                          {building.name} - {building.address}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  )}\r\n\r\n                  {/* Custom Upload */}\r\n                  {targetType === 'custom' && (\r\n                    <div className=\"space-y-2\">\r\n                      <input\r\n                        ref={fileInputRef}\r\n                        type=\"file\"\r\n                        accept=\".xlsx,.xls,.csv\"\r\n                        onChange={handleFileUpload}\r\n                        className=\"hidden\"\r\n                      />\r\n                      <button\r\n                        onClick={() => fileInputRef.current?.click()}\r\n                        className=\"w-full flex items-center justify-center gap-2 py-3 border-2 border-dashed border-gray-300 rounded-xl hover:border-primary-400 hover:bg-primary-50 transition-colors\"\r\n                      >\r\n                        <Upload className=\"w-5 h-5 text-gray-500\" />\r\n                        <span className=\"text-sm text-gray-600\">\r\n                          {uploadedFileName || (language === 'ru' ? 'Загрузить Excel файл' : 'Excel fayl yuklang')}\r\n                        </span>\r\n                      </button>\r\n                      {customLogins.length > 0 && (\r\n                        <div className=\"text-sm text-green-600 flex items-center gap-2\">\r\n                          <FileSpreadsheet className=\"w-4 h-4\" />\r\n                          {language === 'ru'\r\n                            ? `Загружено ${customLogins.length} лицевых счетов`\r\n                            : `${customLogins.length} ta shaxsiy hisob yuklandi`}\r\n                        </div>\r\n                      )}\r\n                      <p className=\"text-xs text-gray-400\">\r\n                        {language === 'ru'\r\n                          ? 'Файл должен содержать лицевые счета (логины) в первой колонке'\r\n                          : 'Fayl birinchi ustunda shaxsiy hisoblarni (loginlarni) o\\'z ichiga olishi kerak'}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Target Summary */}\r\n                  {getTargetDescription() && (\r\n                    <div className=\"flex items-center gap-2 p-2 bg-green-50 rounded-lg text-sm text-green-700\">\r\n                      <Target className=\"w-4 h-4\" />\r\n                      {getTargetDescription()}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Priority */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('announcements.priority')}\r\n                </label>\r\n                <div className=\"flex gap-2\">\r\n                  {(['normal', 'important', 'urgent'] as AnnouncementPriority[]).map((priority) => (\r\n                    <button\r\n                      key={priority}\r\n                      onClick={() => setNewAnnouncement({ ...newAnnouncement, priority })}\r\n                      className={`flex-1 py-2 px-3 rounded-xl font-medium text-sm transition-colors ${\r\n                        newAnnouncement.priority === priority\r\n                          ? getPriorityBadge(priority) + ' border-2'\r\n                          : 'bg-gray-100 text-gray-600 border-2 border-transparent'\r\n                      }`}\r\n                    >\r\n                      {t(`announcements.priority${priority.charAt(0).toUpperCase() + priority.slice(1)}`)}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Title */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('announcements.titleLabel')}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={newAnnouncement.title}\r\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, title: e.target.value })}\r\n                  className=\"glass-input\"\r\n                  placeholder={language === 'ru' ? 'Введите заголовок...' : 'Sarlavhani kiriting...'}\r\n                />\r\n              </div>\r\n\r\n              {/* Content */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('announcements.content')}\r\n                </label>\r\n                <textarea\r\n                  value={newAnnouncement.content}\r\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, content: e.target.value })}\r\n                  className=\"glass-input min-h-[120px] resize-none\"\r\n                  placeholder={language === 'ru' ? 'Введите содержание объявления...' : 'E\\'lon mazmunini kiriting...'}\r\n                />\r\n              </div>\r\n\r\n              {/* Expires At */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('announcements.expiresAt')}\r\n                </label>\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  value={newAnnouncement.expiresAt}\r\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, expiresAt: e.target.value })}\r\n                  className=\"glass-input\"\r\n                />\r\n              </div>\r\n\r\n              {/* File Attachments */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  <Paperclip className=\"w-4 h-4 inline mr-1\" />\r\n                  {language === 'ru' ? 'Вложения' : 'Ilovalar'}\r\n                </label>\r\n                <input\r\n                  ref={attachmentInputRef}\r\n                  type=\"file\"\r\n                  multiple\r\n                  accept=\"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt\"\r\n                  onChange={handleAttachmentUpload}\r\n                  className=\"hidden\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => attachmentInputRef.current?.click()}\r\n                  disabled={isUploadingAttachment}\r\n                  className=\"w-full flex items-center justify-center gap-2 py-3 border-2 border-dashed border-gray-300 rounded-xl hover:border-blue-400 hover:bg-blue-50 transition-colors disabled:opacity-50\"\r\n                >\r\n                  {isUploadingAttachment ? (\r\n                    <span className=\"text-sm text-gray-500\">{language === 'ru' ? 'Загрузка...' : 'Yuklanmoqda...'}</span>\r\n                  ) : (\r\n                    <>\r\n                      <Upload className=\"w-5 h-5 text-gray-500\" />\r\n                      <span className=\"text-sm text-gray-600\">\r\n                        {language === 'ru' ? 'Добавить файлы (до 5 МБ)' : 'Fayl qo\\'shish (5 MB gacha)'}\r\n                      </span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n\r\n                {/* Attachments List */}\r\n                {attachments.length > 0 && (\r\n                  <div className=\"mt-3 space-y-2\">\r\n                    {attachments.map((attachment, index) => (\r\n                      <div key={index} className=\"flex items-center gap-2 p-2 bg-gray-50 rounded-lg\">\r\n                        {getFileIcon(attachment.type)}\r\n                        <span className=\"flex-1 text-sm text-gray-700 truncate\">{attachment.name}</span>\r\n                        <span className=\"text-xs text-gray-400\">{formatFileSize(attachment.size)}</span>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => removeAttachment(index)}\r\n                          className=\"p-1 text-red-500 hover:bg-red-50 rounded\"\r\n                        >\r\n                          <X className=\"w-4 h-4\" />\r\n                        </button>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Actions */}\r\n              <div className=\"flex gap-3 pt-4\">\r\n                <button\r\n                  onClick={() => setShowAddModal(false)}\r\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\r\n                >\r\n                  {t('form.cancel')}\r\n                </button>\r\n                <button\r\n                  onClick={handleAddAnnouncement}\r\n                  disabled={!newAnnouncement.title.trim() || !newAnnouncement.content.trim()}\r\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-orange-400 text-gray-900 hover:bg-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  {t('form.add')}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Edit Announcement Modal */}\r\n      {showEditModal && editingAnnouncement && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"p-6 border-b border-gray-100 flex items-center justify-between\">\r\n              <h2 className=\"text-xl font-bold\">{language === 'ru' ? 'Редактировать объявление' : 'E\\'lonni tahrirlash'}</h2>\r\n              <button\r\n                onClick={() => { setShowEditModal(false); setEditingAnnouncement(null); }}\r\n                className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"p-6 space-y-4\">\r\n              {/* Title */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {t('announcements.titleLabel')}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={editingAnnouncement.title}\r\n                  onChange={(e) => setEditingAnnouncement({ ...editingAnnouncement, title: e.target.value })}\r\n                  className=\"glass-input\"\r\n                  placeholder={t('announcements.titlePlaceholder')}\r\n                />\r\n              </div>\r\n\r\n              {/* Content */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {t('announcements.contentLabel')}\r\n                </label>\r\n                <textarea\r\n                  value={editingAnnouncement.content}\r\n                  onChange={(e) => setEditingAnnouncement({ ...editingAnnouncement, content: e.target.value })}\r\n                  className=\"glass-input min-h-32\"\r\n                  placeholder={t('announcements.contentPlaceholder')}\r\n                  rows={4}\r\n                />\r\n              </div>\r\n\r\n              {/* Priority */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('announcements.priority')}\r\n                </label>\r\n                <div className=\"flex gap-2\">\r\n                  {(['normal', 'important', 'urgent'] as AnnouncementPriority[]).map((p) => (\r\n                    <button\r\n                      key={p}\r\n                      onClick={() => setEditingAnnouncement({ ...editingAnnouncement, priority: p })}\r\n                      className={`flex-1 py-2 px-3 rounded-xl text-sm font-medium transition-colors ${\r\n                        editingAnnouncement.priority === p\r\n                          ? p === 'urgent' ? 'bg-red-100 text-red-700 ring-2 ring-red-500'\r\n                            : p === 'important' ? 'bg-amber-100 text-amber-700 ring-2 ring-amber-500'\r\n                            : 'bg-blue-100 text-blue-700 ring-2 ring-blue-500'\r\n                          : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                      }`}\r\n                    >\r\n                      {t(`announcements.priority${p.charAt(0).toUpperCase() + p.slice(1)}`)}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Actions */}\r\n              <div className=\"flex gap-3 pt-4\">\r\n                <button\r\n                  onClick={() => { setShowEditModal(false); setEditingAnnouncement(null); }}\r\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\r\n                >\r\n                  {t('form.cancel')}\r\n                </button>\r\n                <button\r\n                  onClick={async () => {\r\n                    if (editingAnnouncement) {\r\n                      await updateAnnouncement(editingAnnouncement.id, {\r\n                        title: editingAnnouncement.title,\r\n                        content: editingAnnouncement.content,\r\n                        priority: editingAnnouncement.priority,\r\n                      });\r\n                      setShowEditModal(false);\r\n                      setEditingAnnouncement(null);\r\n                    }\r\n                  }}\r\n                  disabled={!editingAnnouncement.title.trim() || !editingAnnouncement.content.trim()}\r\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-orange-400 text-gray-900 hover:bg-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  {language === 'ru' ? 'Сохранить' : 'Saqlash'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Announcement Card Component with clickable view details\r\nfunction AnnouncementCard({\r\n  announcement,\r\n  onDelete,\r\n  onEdit,\r\n  formatDate,\r\n  getPriorityIcon,\r\n  getPriorityBadge,\r\n  t,\r\n  canDelete,\r\n  canEdit,\r\n  language,\r\n}: {\r\n  announcement: Announcement;\r\n  onDelete: () => void;\r\n  onEdit: () => void;\r\n  formatDate: (date: string) => string;\r\n  getPriorityIcon: (priority: AnnouncementPriority) => React.ReactNode;\r\n  getPriorityBadge: (priority: AnnouncementPriority) => string;\r\n  t: (key: string) => string;\r\n  canDelete: boolean;\r\n  canEdit?: boolean;\r\n  language: string;\r\n}) {\r\n  const [showViewers, setShowViewers] = useState(false);\r\n  const [viewers, setViewers] = useState<any[]>([]);\r\n  const [isLoadingViewers, setIsLoadingViewers] = useState(false);\r\n  const [viewStats, setViewStats] = useState<{ count: number; targetAudienceSize: number; viewPercentage: number } | null>(null);\r\n\r\n  const viewCount = announcement.viewCount ?? announcement.viewedBy.length;\r\n\r\n  const handleViewClick = async (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n\r\n    setShowViewers(true);\r\n    setIsLoadingViewers(true);\r\n\r\n    try {\r\n      const { announcementsApi } = await import('../services/api');\r\n      const result = await announcementsApi.getViews(announcement.id);\r\n      setViewers(result.viewers || []);\r\n      setViewStats({\r\n        count: result.count,\r\n        targetAudienceSize: result.targetAudienceSize,\r\n        viewPercentage: result.viewPercentage\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to load viewers:', error);\r\n    } finally {\r\n      setIsLoadingViewers(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"glass-card p-5 hover:shadow-lg transition-shadow\">\r\n        <div className=\"flex items-start justify-between gap-4\">\r\n          <div className=\"flex-1 min-w-0\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\r\n              <span className={`flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-medium border ${getPriorityBadge(announcement.priority)}`}>\r\n                {getPriorityIcon(announcement.priority)}\r\n                {t(`announcements.priority${announcement.priority.charAt(0).toUpperCase() + announcement.priority.slice(1)}`)}\r\n              </span>\r\n              <span className={`px-2 py-1 rounded-lg text-xs font-medium ${\r\n                announcement.type === 'residents'\r\n                  ? 'bg-green-100 text-green-700'\r\n                  : announcement.type === 'employees'\r\n                  ? 'bg-purple-100 text-purple-700'\r\n                  : 'bg-blue-100 text-blue-700'\r\n              }`}>\r\n                {announcement.type === 'residents'\r\n                  ? t('announcements.forResidents')\r\n                  : announcement.type === 'employees'\r\n                  ? t('announcements.forStaff')\r\n                  : (language === 'ru' ? 'Для всех' : 'Hammasi uchun')}\r\n              </span>\r\n              {/* Targeting info */}\r\n              {announcement.target && announcement.target.type !== 'all' && (\r\n                <span className=\"px-2 py-1 rounded-lg text-xs font-medium bg-gray-100 text-gray-600\">\r\n                  <Target className=\"w-3 h-3 inline mr-1\" />\r\n                  {announcement.target.type === 'building' && (language === 'ru' ? 'ЖК' : 'TJM')}\r\n                  {announcement.target.type === 'entrance' && (language === 'ru' ? 'Подъезд' : 'Kirish')}\r\n                  {announcement.target.type === 'floor' && (language === 'ru' ? 'Этаж' : 'Qavat')}\r\n                  {announcement.target.type === 'custom' && (language === 'ru' ? 'Список' : 'Ro\\'yxat')}\r\n                </span>\r\n              )}\r\n            </div>\r\n\r\n            {/* Title */}\r\n            <h3 className=\"font-semibold text-lg text-gray-900 mb-2\">{announcement.title}</h3>\r\n\r\n            {/* Content */}\r\n            <p className=\"text-gray-600 whitespace-pre-wrap\">{announcement.content}</p>\r\n\r\n            {/* Attachments */}\r\n            {announcement.attachments && announcement.attachments.length > 0 && (\r\n              <div className=\"mt-3 flex flex-wrap gap-2\">\r\n                {announcement.attachments.map((attachment, index) => (\r\n                  <a\r\n                    key={index}\r\n                    href={attachment.url}\r\n                    download={attachment.name}\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"flex items-center gap-2 px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm text-gray-700 transition-colors\"\r\n                    onClick={(e) => e.stopPropagation()}\r\n                  >\r\n                    {attachment.type.startsWith('image/') ? (\r\n                      <Image className=\"w-4 h-4 text-blue-500\" />\r\n                    ) : attachment.type.includes('pdf') ? (\r\n                      <FileText className=\"w-4 h-4 text-red-500\" />\r\n                    ) : (\r\n                      <File className=\"w-4 h-4 text-gray-500\" />\r\n                    )}\r\n                    <span className=\"truncate max-w-[150px]\">{attachment.name}</span>\r\n                    <Download className=\"w-4 h-4 text-gray-400\" />\r\n                  </a>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Meta */}\r\n            <div className=\"flex items-center gap-4 mt-4 text-sm text-gray-500 flex-wrap\">\r\n              <span className=\"flex items-center gap-1\">\r\n                <Clock className=\"w-4 h-4\" />\r\n                {formatDate(announcement.createdAt)}\r\n              </span>\r\n              {announcement.authorName && (\r\n                <span>\r\n                  {t('announcements.author')}: {announcement.authorName}\r\n                </span>\r\n              )}\r\n              {/* Clickable view count */}\r\n              <button\r\n                onClick={handleViewClick}\r\n                className={`flex items-center gap-1 ${viewCount > 0 ? 'text-blue-600 hover:text-blue-800 cursor-pointer hover:underline' : 'text-gray-400 cursor-default'}`}\r\n                disabled={viewCount === 0}\r\n              >\r\n                <Eye className=\"w-4 h-4\" />\r\n                {viewCount} {t('announcements.views')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Actions - only show for users with edit/delete permissions */}\r\n          {(canEdit || canDelete) && (\r\n            <div className=\"flex flex-col gap-1\">\r\n              {canEdit && (\r\n                <button\r\n                  onClick={(e) => { e.stopPropagation(); onEdit(); }}\r\n                  className=\"p-2 text-blue-500 hover:bg-blue-50 rounded-xl transition-colors\"\r\n                  title={language === 'ru' ? 'Редактировать' : 'Tahrirlash'}\r\n                >\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                  </svg>\r\n                </button>\r\n              )}\r\n              {canDelete && (\r\n                <button\r\n                  onClick={(e) => { e.stopPropagation(); onDelete(); }}\r\n                  className=\"p-2 text-red-500 hover:bg-red-50 rounded-xl transition-colors\"\r\n                  title={language === 'ru' ? 'Удалить' : 'O\\'chirish'}\r\n                >\r\n                  <Trash2 className=\"w-5 h-5\" />\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Viewers Modal with Statistics */}\r\n      {showViewers && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\" onClick={() => setShowViewers(false)}>\r\n          <div className=\"bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden\" onClick={e => e.stopPropagation()}>\r\n            <div className=\"p-4 border-b border-gray-100 flex items-center justify-between\">\r\n              <h3 className=\"font-semibold text-lg flex items-center gap-2\">\r\n                <Eye className=\"w-5 h-5 text-blue-500\" />\r\n                {language === 'ru' ? 'Статистика просмотров' : 'Ko\\'rishlar statistikasi'}\r\n              </h3>\r\n              <button onClick={() => setShowViewers(false)} className=\"p-2 hover:bg-gray-100 rounded-xl\">\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"p-4 max-h-[60vh] overflow-y-auto space-y-4\">\r\n              {isLoadingViewers ? (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  {language === 'ru' ? 'Загрузка...' : 'Yuklanmoqda...'}\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  {/* Statistics Summary */}\r\n                  {viewStats && (\r\n                    <div className=\"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 space-y-3\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-sm text-blue-700\">\r\n                          {language === 'ru' ? 'Просмотрели' : 'Ko\\'rganlar'}\r\n                        </span>\r\n                        <span className=\"font-bold text-blue-900\">\r\n                          {viewStats.count} / {viewStats.targetAudienceSize}\r\n                        </span>\r\n                      </div>\r\n                      {/* Progress bar */}\r\n                      <div className=\"w-full bg-blue-200 rounded-full h-3\">\r\n                        <div\r\n                          className=\"bg-blue-600 h-3 rounded-full transition-all duration-500\"\r\n                          style={{ width: `${Math.min(viewStats.viewPercentage, 100)}%` }}\r\n                        />\r\n                      </div>\r\n                      <div className=\"text-center\">\r\n                        <span className=\"text-2xl font-bold text-blue-900\">{viewStats.viewPercentage}%</span>\r\n                        <span className=\"text-sm text-blue-600 ml-2\">\r\n                          {language === 'ru' ? 'от целевой аудитории' : 'maqsadli auditoriyadan'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Viewers List */}\r\n                  {viewers.length === 0 ? (\r\n                    <div className=\"text-center py-4 text-gray-500\">\r\n                      {language === 'ru' ? 'Пока никто не просмотрел' : 'Hali hech kim ko\\'rmagan'}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-2\">\r\n                      <h4 className=\"text-sm font-medium text-gray-600\">\r\n                        {language === 'ru' ? 'Кто просмотрел:' : 'Kim ko\\'rgan:'}\r\n                      </h4>\r\n                      {viewers.map((viewer: any) => (\r\n                        <div key={viewer.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-xl\">\r\n                          <div>\r\n                            <p className=\"font-medium text-gray-900\">{viewer.name}</p>\r\n                            <p className=\"text-sm text-gray-500\">\r\n                              {viewer.apartment && `${language === 'ru' ? 'Кв.' : 'Xon.'} ${viewer.apartment}`}\r\n                              {viewer.address && ` • ${viewer.address}`}\r\n                            </p>\r\n                          </div>\r\n                          <span className=\"text-xs text-gray-400\">\r\n                            {new Date(viewer.viewed_at).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\r\n                              day: '2-digit',\r\n                              month: 'short',\r\n                              hour: '2-digit',\r\n                              minute: '2-digit'\r\n                            })}\r\n                          </span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"file":"AnnouncementsPage-1768652481688-BiV3Xtuy.js"}
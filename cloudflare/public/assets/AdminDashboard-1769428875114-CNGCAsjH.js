import{r as y,j as e,a7 as P,au as ie,S as I,J as ce,A as K,F as T,av as M,y as G,h as J,ad as oe,ac as me,aw as xe,m as X,q as B,N as he,a3 as ge}from"./react-vendor-1769428875114-t_MJ7TI5.js";import{R as Y,A as pe,C as ue,X as je,Y as ve,T as Z,L as Q,d as V,P as ye,b as fe,c as be}from"./LazyCharts-1769428875114-WGEgmUHK.js";import{u as Ne,e as we,S as Ce}from"./index-1769428875114-CG_16j_e.js";import{L as _e}from"./vendor-1769428875114-wOrLRiCI.js";import"./zustand-1769428875114-wNUYBKDB.js";import"./qr-scanner-1769428875114-B_vB3SDT.js";import"./charts-1769428875114--rEkoR91.js";function Pe(){const{requests:H,executors:g,getStats:ee}=Ne(),m=ee(),[p,U]=y.useState("overview"),[l,se]=y.useState(null),[W,q]=y.useState(!1),[f,te]=y.useState(()=>{const s=new Date;return s.setDate(s.getDate()-30),s.toISOString().slice(0,10)}),[b,le]=y.useState(()=>new Date().toISOString().slice(0,10)),N=H.filter(s=>s.status==="pending_approval"),w=N.filter(s=>{if(!s.completedAt)return!1;const d=new Date(s.completedAt).getTime();return(Date.now()-d)/(1e3*60*60)>24});y.useEffect(()=>{p==="marketplace"&&ae()},[p,f,b]);const ae=async()=>{q(!0);try{const s=await we(`/api/marketplace/admin/reports?start_date=${f}&end_date=${b}`);se(s)}catch{}finally{q(!1)}},re=async()=>{if(!l)return;const s=new _e.Workbook;s.creator="Kamizo",s.created=new Date;const d=t=>`${t.toLocaleString("ru-RU")} сум`,c={font:{bold:!0,size:11},alignment:{horizontal:"center",vertical:"middle"},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},o={alignment:{horizontal:"left",vertical:"middle"},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},n={alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},x={alignment:{horizontal:"right",vertical:"middle"},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}},a=s.addWorksheet("Сводный отчёт");a.columns=[{width:25},{width:35},{width:18},{width:22},{width:15}];const C=a.addRow(["ОТЧЁТ ПО МАРКЕТПЛЕЙСУ"]);a.mergeCells(`A${C.number}:E${C.number}`),C.getCell(1).style={font:{bold:!0,size:16},alignment:{horizontal:"center"}},a.addRow([]),a.addRow(["Период:",`${l.period.start_date} — ${l.period.end_date}`]),a.addRow(["Дата формирования:",new Date().toLocaleDateString("ru-RU")]),a.addRow([]);const _=a.addRow(["ОБЩАЯ СТАТИСТИКА"]);a.mergeCells(`A${_.number}:E${_.number}`),_.getCell(1).style={font:{bold:!0,size:12},alignment:{horizontal:"center"}},a.addRow([]),a.addRow(["Показатель","Значение"]).eachCell(t=>{t.style=c}),[["Всего заказов",l.overall.total_orders],["Доставлено заказов",l.overall.delivered_orders],["Отменено заказов",l.overall.cancelled_orders],["Общая выручка",d(l.overall.total_revenue)],["Доход от доставки",d(l.overall.total_delivery_fees)],["Средний рейтинг",`${l.overall.avg_rating.toFixed(1)} ⭐`],["Количество оценок",l.overall.rated_orders]].forEach(t=>{const i=a.addRow(t);i.getCell(1).style=o,i.getCell(2).style=n}),a.addRow([]),a.addRow([]);const R=a.addRow(["ТОП-10 ТОВАРОВ ПО ПРОДАЖАМ"]);a.mergeCells(`A${R.number}:E${R.number}`),R.getCell(1).style={font:{bold:!0,size:12},alignment:{horizontal:"center"}},a.addRow([]),a.addRow(["№","Название товара","Продано (шт)","Выручка","Заказов"]).eachCell(t=>{t.style=c}),l.top_products.forEach((t,i)=>{const r=a.addRow([i+1,t.product_name,t.total_sold,d(t.total_revenue),t.order_count]);r.getCell(1).style=n,r.getCell(2).style=o,r.getCell(3).style=n,r.getCell(4).style=x,r.getCell(5).style=n}),a.addRow([]),a.addRow([]);const k=a.addRow(["ПРОДАЖИ ПО КАТЕГОРИЯМ"]);a.mergeCells(`A${k.number}:E${k.number}`),k.getCell(1).style={font:{bold:!0,size:12},alignment:{horizontal:"center"}},a.addRow([]),a.addRow(["№","Категория","Продано (шт)","Выручка","Заказов"]).eachCell(t=>{t.style=c}),l.categories.forEach((t,i)=>{const r=a.addRow([i+1,t.category_name,t.total_sold,d(t.total_revenue),t.order_count]);r.getCell(1).style=n,r.getCell(2).style=o,r.getCell(3).style=n,r.getCell(4).style=x,r.getCell(5).style=n}),a.addRow([]),a.addRow([]);const S=a.addRow(["СТАТИСТИКА КУРЬЕРОВ"]);a.mergeCells(`A${S.number}:E${S.number}`),S.getCell(1).style={font:{bold:!0,size:12},alignment:{horizontal:"center"}},a.addRow([]),a.addRow(["№","Имя курьера","Доставлено заказов","Средний рейтинг"]).eachCell(t=>{t.style=c}),l.executor_stats.forEach((t,i)=>{const r=a.addRow([i+1,t.executor_name,t.delivered_count,`${t.avg_rating.toFixed(1)} ⭐`]);r.getCell(1).style=n,r.getCell(2).style=o,r.getCell(3).style=n,r.getCell(4).style=n}),a.addRow([]),a.addRow([]);const $=a.addRow(["ТОП-10 ПОКУПАТЕЛЕЙ"]);a.mergeCells(`A${$.number}:E${$.number}`),$.getCell(1).style={font:{bold:!0,size:12},alignment:{horizontal:"center"}},a.addRow([]),a.addRow(["№","Имя клиента","Телефон","Заказов","Сумма покупок"]).eachCell(t=>{t.style=c}),l.top_customers.forEach((t,i)=>{const r=a.addRow([i+1,t.user_name,t.user_phone,t.order_count,d(t.total_spent)]);r.getCell(1).style=n,r.getCell(2).style=o,r.getCell(3).style=o,r.getCell(4).style=n,r.getCell(5).style=x});const h=s.addWorksheet("По дням");h.columns=[{width:18},{width:22},{width:25}];const E=h.addRow(["ПРОДАЖИ ПО ДНЯМ"]);h.mergeCells(`A${E.number}:C${E.number}`),E.getCell(1).style={font:{bold:!0,size:14},alignment:{horizontal:"center"}},h.addRow([]),h.addRow(["Дата","Количество заказов","Выручка"]).eachCell(t=>{t.style=c}),l.daily_sales.forEach(t=>{const i=h.addRow([t.date,t.orders,d(t.revenue)]);i.getCell(1).style=n,i.getCell(2).style=n,i.getCell(3).style=x}),h.addRow([]);const A=h.addRow(["ИТОГО:",l.daily_sales.reduce((t,i)=>t+i.orders,0),d(l.daily_sales.reduce((t,i)=>t+i.revenue,0))]);A.getCell(1).style={...o,font:{bold:!0}},A.getCell(2).style={...n,font:{bold:!0}},A.getCell(3).style={...x,font:{bold:!0}};const u=s.addWorksheet("Товары");u.columns=[{width:6},{width:45},{width:16},{width:22},{width:12}];const F=u.addRow(["ДЕТАЛЬНЫЙ ОТЧЁТ ПО ТОВАРАМ"]);u.mergeCells(`A${F.number}:E${F.number}`),F.getCell(1).style={font:{bold:!0,size:14},alignment:{horizontal:"center"}},u.addRow([]),u.addRow(["№","Название товара","Продано (шт)","Выручка","Заказов"]).eachCell(t=>{t.style=c}),l.top_products.forEach((t,i)=>{const r=u.addRow([i+1,t.product_name,t.total_sold,d(t.total_revenue),t.order_count]);r.getCell(1).style=n,r.getCell(2).style=o,r.getCell(3).style=n,r.getCell(4).style=x,r.getCell(5).style=n});const j=s.addWorksheet("Покупатели");j.columns=[{width:6},{width:30},{width:18},{width:20},{width:25}];const z=j.addRow(["ДЕТАЛЬНЫЙ ОТЧЁТ ПО ПОКУПАТЕЛЯМ"]);j.mergeCells(`A${z.number}:E${z.number}`),z.getCell(1).style={font:{bold:!0,size:14},alignment:{horizontal:"center"}},j.addRow([]),j.addRow(["№","Имя клиента","Телефон","Количество заказов","Сумма покупок"]).eachCell(t=>{t.style=c}),l.top_customers.forEach((t,i)=>{const r=j.addRow([i+1,t.user_name,t.user_phone,t.order_count,d(t.total_spent)]);r.getCell(1).style=n,r.getCell(2).style=o,r.getCell(3).style=n,r.getCell(4).style=n,r.getCell(5).style=x});const v=s.addWorksheet("Курьеры");v.columns=[{width:6},{width:30},{width:22},{width:18}];const D=v.addRow(["ОТЧЁТ ПО КУРЬЕРАМ"]);v.mergeCells(`A${D.number}:D${D.number}`),D.getCell(1).style={font:{bold:!0,size:14},alignment:{horizontal:"center"}},v.addRow([]),v.addRow(["№","Имя курьера","Доставлено заказов","Средний рейтинг"]).eachCell(t=>{t.style=c}),l.executor_stats.forEach((t,i)=>{const r=v.addRow([i+1,t.executor_name,t.delivered_count,`${t.avg_rating.toFixed(1)} ⭐`]);r.getCell(1).style=n,r.getCell(2).style=o,r.getCell(3).style=n,r.getCell(4).style=n});const de=await s.xlsx.writeBuffer(),ne=new Blob([de],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),O=URL.createObjectURL(ne),L=document.createElement("a");L.href=O,L.download=`Отчёт_маркетплейс_${f}_${b}.xlsx`,L.click(),URL.revokeObjectURL(O)};return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 truncate",children:"Панель администратора"}),e.jsx("p",{className:"text-gray-500 text-sm md:text-base mt-0.5 md:mt-1",children:"Мониторинг системы"})]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2 flex-shrink-0 py-2 px-3 md:py-2.5 md:px-4 touch-manipulation",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Обновить"})]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>U("overview"),className:`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${p==="overview"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ie,{className:"w-4 h-4 inline mr-2"}),"Обзор"]}),e.jsxs("button",{onClick:()=>U("marketplace"),className:`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${p==="marketplace"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(I,{className:"w-4 h-4 inline mr-2"}),"Маркетплейс"]})]}),p==="overview"&&e.jsxs(e.Fragment,{children:[(w.length>0||N.length>0)&&e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[w.length>0&&e.jsx("div",{className:"glass-card p-3 md:p-4 border-2 border-red-400 bg-red-50/50 w-full text-left",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx(ce,{className:"w-5 h-5 md:w-6 md:h-6 text-red-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-red-800 text-sm md:text-base",children:[w.length," заявок >24ч"]}),e.jsx("div",{className:"text-xs md:text-sm text-red-600 hidden sm:block",children:"Ожидают подтверждения"})]})]})}),N.length>0&&w.length===0&&e.jsx("div",{className:"glass-card p-3 md:p-4 border-2 border-purple-400 bg-purple-50/50",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx(K,{className:"w-5 h-5 md:w-6 md:h-6 text-purple-600 flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"font-medium text-purple-800 text-sm md:text-base",children:[N.length," ожидают подтверждения"]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[e.jsx("div",{className:"glass-card p-3 md:p-5",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(T,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold",children:m.totalRequests}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"Всего"})]})]})}),e.jsx("div",{className:"glass-card p-3 md:p-5",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold",children:m.inProgress}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"В работе"})]})]})}),e.jsx("div",{className:"glass-card p-3 md:p-5",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-purple-400 to-violet-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold",children:m.pendingApproval}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"Ожидание"})]})]})}),e.jsx("div",{className:"glass-card p-3 md:p-5",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-green-400 to-emerald-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(G,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold",children:m.completedWeek}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"За неделю"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"glass-card p-4 md:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4",children:[e.jsxs("h3",{className:"font-semibold text-base md:text-lg flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-blue-500"}),"Исполнители"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[g.length," всего"]})]}),e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[g.slice(0,6).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 md:p-3 bg-white/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0",children:[e.jsx("div",{className:`w-2.5 h-2.5 md:w-3 md:h-3 rounded-full flex-shrink-0 ${s.status==="available"?"bg-green-500":s.status==="busy"?"bg-amber-500":"bg-gray-400"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm md:text-base truncate",children:s.name}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:Ce[s.specialization]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsx("div",{className:"font-semibold text-sm md:text-base",children:s.activeRequests}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500",children:"заявок"})]})]},s.id)),g.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4 text-sm",children:"Нет исполнителей"})]})]}),e.jsxs("div",{className:"glass-card p-4 md:p-5",children:[e.jsxs("h3",{className:"font-semibold text-base md:text-lg mb-3 md:mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-purple-500"}),"Заявки по статусам"]}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:[{status:"new",label:"Новые",color:"bg-blue-500",gradientFrom:"from-blue-400",gradientTo:"to-blue-500"},{status:"assigned",label:"Назначенные",color:"bg-indigo-500",gradientFrom:"from-indigo-400",gradientTo:"to-indigo-500"},{status:"in_progress",label:"В работе",color:"bg-amber-500",gradientFrom:"from-amber-400",gradientTo:"to-amber-500"},{status:"pending_approval",label:"Ожидают",color:"bg-purple-500",gradientFrom:"from-purple-400",gradientTo:"to-purple-500"},{status:"completed",label:"Выполненные",color:"bg-green-500",gradientFrom:"from-green-400",gradientTo:"to-green-500"}].map(({status:s,label:d,gradientFrom:c,gradientTo:o})=>{const n=H.filter(a=>a.status===s).length,x=m.totalRequests>0?n/m.totalRequests*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs md:text-sm mb-1.5",children:[e.jsx("span",{className:"text-gray-700",children:d}),e.jsx("span",{className:"font-semibold",children:n})]}),e.jsx("div",{className:"h-2 md:h-2.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${c} ${o} transition-all duration-500`,style:{width:`${x}%`}})})]},s)})})]}),e.jsxs("div",{className:"glass-card p-4 md:p-5",children:[e.jsxs("h3",{className:"font-semibold text-base md:text-lg mb-3 md:mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-500",children:"★"}),"Лучшие исполнители"]}),e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[[...g].sort((s,d)=>d.completedCount-s.completedCount).slice(0,5).map((s,d)=>e.jsx("div",{className:"flex items-center p-2 md:p-3 bg-white/30 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center font-bold text-white text-sm flex-shrink-0 ${d===0?"bg-orange-500":d===1?"bg-gray-400":d===2?"bg-amber-600":"bg-gray-300"}`,children:d+1}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-sm md:text-base truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-2 text-xs md:text-sm text-gray-500",children:[e.jsxs("span",{children:["★ ",s.rating]}),e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsxs("span",{className:"hidden sm:inline",children:[s.completedCount," заявок"]}),e.jsx("span",{className:"sm:hidden",children:s.completedCount})]})]})]})},s.id)),g.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4 text-sm",children:"Нет данных"})]})]}),e.jsxs("div",{className:"glass-card p-4 md:p-5",children:[e.jsxs("h3",{className:"font-semibold text-base md:text-lg mb-3 md:mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-green-500"}),"Сводка"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-500 text-xs md:text-sm",children:"Всего заявок"}),e.jsx("div",{className:"font-bold text-xl md:text-2xl",children:m.totalRequests})]}),e.jsxs("div",{className:"bg-white/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-500 text-xs md:text-sm",children:"Исполнителей"}),e.jsx("div",{className:"font-bold text-xl md:text-2xl",children:g.length})]}),e.jsxs("div",{className:"bg-white/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-500 text-xs md:text-sm",children:"Выполнено"}),e.jsx("div",{className:"font-bold text-xl md:text-2xl text-green-600",children:m.completedWeek})]}),e.jsxs("div",{className:"bg-white/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-500 text-xs md:text-sm",children:"Активных"}),e.jsx("div",{className:"font-bold text-xl md:text-2xl text-amber-600",children:m.inProgress})]})]})]})]})]}),p==="marketplace"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Период:"}),e.jsx("input",{type:"date",value:f,onChange:s=>te(s.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-lg text-sm"}),e.jsx("span",{className:"text-gray-400",children:"—"}),e.jsx("input",{type:"date",value:b,onChange:s=>le(s.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-lg text-sm"})]}),e.jsxs("button",{onClick:re,disabled:!l||W,className:"btn-primary flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Скачать Excel"]})]})}),W?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx(P,{className:"w-8 h-8 animate-spin text-orange-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Загрузка..."})]}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx(I,{className:"w-8 h-8 text-blue-500"})}),e.jsx("div",{className:"text-2xl font-bold",children:l.overall.total_orders}),e.jsx("div",{className:"text-sm text-gray-500",children:"Всего заказов"}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsxs("span",{className:"text-green-600",children:[l.overall.delivered_orders," доставлено"]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"|"}),e.jsxs("span",{className:"text-red-600",children:[l.overall.cancelled_orders," отменено"]})]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx(xe,{className:"w-8 h-8 text-green-500"})}),e.jsx("div",{className:"text-2xl font-bold",children:l.overall.total_revenue.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-500",children:"Выручка (сум)"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Доставка: ",l.overall.total_delivery_fees.toLocaleString()," сум"]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx(X,{className:"w-8 h-8 text-yellow-500"})}),e.jsx("div",{className:"text-2xl font-bold",children:l.overall.avg_rating.toFixed(1)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Средний рейтинг"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[l.overall.rated_orders," оценок"]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx(B,{className:"w-8 h-8 text-purple-500"})}),e.jsx("div",{className:"text-2xl font-bold",children:l.top_products.reduce((s,d)=>s+d.total_sold,0)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Продано (шт)"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[l.top_products.length," товаров"]})]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-blue-500"}),"Динамика продаж"]}),e.jsx(Y,{width:"100%",height:280,children:e.jsxs(pe,{data:l.daily_sales,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})}),e.jsx(ue,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(je,{dataKey:"date",tick:{fontSize:10},tickFormatter:s=>new Date(s).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}),e.jsx(ve,{tick:{fontSize:12}}),e.jsx(Z,{formatter:(s,d)=>[d==="revenue"?`${s.toLocaleString()} сум`:s,d==="revenue"?"Выручка":"Заказов"],labelFormatter:s=>new Date(s).toLocaleDateString("ru-RU")}),e.jsx(Q,{}),e.jsx(V,{type:"monotone",dataKey:"revenue",stroke:"#10B981",strokeWidth:2,fill:"url(#colorRevenue)",name:"Выручка"}),e.jsx(V,{type:"monotone",dataKey:"orders",stroke:"#3B82F6",strokeWidth:2,fill:"none",name:"Заказов"})]})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-purple-500"}),"Топ товаров"]}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[l.top_products.slice(0,10).map((s,d)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center font-bold text-purple-600",children:d+1}),s.image_url?e.jsx("img",{src:s.image_url,alt:"",className:"w-10 h-10 object-cover rounded-lg"}):e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:s.product_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.total_sold," шт • ",s.order_count," заказов"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-sm text-green-600",children:s.total_revenue.toLocaleString()}),e.jsx("div",{className:"text-xs text-gray-400",children:"сум"})]})]},s.product_id)),l.top_products.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8",children:"Нет данных"})]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-orange-500"}),"По категориям"]}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[l.categories.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:s.category_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.total_sold," шт • ",s.order_count," заказов"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-sm text-green-600",children:s.total_revenue.toLocaleString()}),e.jsx("div",{className:"text-xs text-gray-400",children:"сум"})]})]},s.category_name)),l.categories.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8",children:"Нет данных"})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-blue-500"}),"Топ покупателей"]}),e.jsxs("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:[l.top_customers.map((s,d)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center font-bold text-blue-600",children:d+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:s.user_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.user_phone})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-sm",children:[s.order_count," заказов"]}),e.jsxs("div",{className:"text-xs text-green-600",children:[s.total_spent.toLocaleString()," сум"]})]})]},s.user_id)),l.top_customers.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8",children:"Нет данных"})]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-green-500"}),"Курьеры"]}),e.jsxs("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:[l.executor_stats.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white font-bold",children:s.executor_name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:s.executor_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.delivered_count," доставок"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s.avg_rating.toFixed(1)})]})]},s.executor_id)),l.executor_stats.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8",children:"Нет данных"})]})]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-purple-500"}),"Заказы по статусам"]}),e.jsx(Y,{width:"100%",height:240,children:e.jsxs(ye,{children:[e.jsx(fe,{data:l.orders_by_status.map(s=>({name:{new:"Новые",confirmed:"Подтверждённые",preparing:"Готовятся",ready:"Готовы",delivering:"В доставке",delivered:"Доставлены",cancelled:"Отменены"}[s.status]||s.status,value:s.count,color:{new:"#3B82F6",confirmed:"#8B5CF6",preparing:"#F59E0B",ready:"#06B6D4",delivering:"#F97316",delivered:"#10B981",cancelled:"#EF4444"}[s.status]||"#9CA3AF"})),cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,dataKey:"value",label:({name:s,percent:d})=>`${s} ${(d*100).toFixed(0)}%`,children:l.orders_by_status.map((s,d)=>e.jsx(be,{fill:{new:"#3B82F6",confirmed:"#8B5CF6",preparing:"#F59E0B",ready:"#06B6D4",delivering:"#F97316",delivered:"#10B981",cancelled:"#EF4444"}[s.status]||"#9CA3AF"},`cell-${d}`))}),e.jsx(Z,{}),e.jsx(Q,{})]})})]})]}):e.jsx("div",{className:"text-center text-gray-400 py-20",children:"Нет данных"})]})]})}export{Pe as AdminDashboard};
//# sourceMappingURL=AdminDashboard-1769428875114-CNGCAsjH.js.map

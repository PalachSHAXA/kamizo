{"version":3,"mappings":";0/CAEA,MAAMA,GAAU,GAGVC,GAAW,IAAM,aAAa,QAAQ,YAAY,EAgBlDC,OAAmB,IACnBC,OAAsB,IAGtBC,EAAY,CAChB,MAAO,GAAK,IACZ,OAAQ,GAAK,IACb,KAAM,IAAS,GACjB,EAGA,SAASC,GAAaC,EAAuB,CAC3C,MAAMC,EAAQL,GAAa,IAAII,CAAG,EAClC,OAAKC,EAEa,KAAK,MAAQA,EAAM,UAAYA,EAAM,KAErDL,GAAa,OAAOI,CAAG,EAChB,MAEFC,EAAM,KAPM,IAQrB,CAGA,SAASC,GAAYF,EAAaG,EAASC,EAAmB,CAC5DR,GAAa,IAAII,EAAK,CAAE,KAAAG,EAAM,UAAW,KAAK,MAAO,IAAAC,EAAK,CAC5D,CAGO,SAASC,EAAgBC,EAAwB,CACtD,GAAI,CAACA,EAAS,CACZV,GAAa,QACb,MACF,CACA,UAAWI,KAAOJ,GAAa,OACzBI,EAAI,SAASM,CAAO,GACtBV,GAAa,OAAOI,CAAG,CAG7B,CAGA,MAAMO,GAAc,IAGpB,eAAsBC,EACpBC,EACAC,EAAuB,GACvBC,EAAkBJ,GACN,CACZ,MAAMK,EAAQjB,GAAA,EAERkB,EAAuB,CAC3B,eAAgB,mBAChB,GAAID,EAAQ,CAAE,cAAiB,UAAUA,CAAK,IAAO,GACrD,GAAGF,EAAQ,SAIPI,EAAa,IAAI,gBACjBC,EAAY,WAAW,IAAMD,EAAW,QAASH,CAAO,EAE9D,GAAI,CACF,MAAMK,EAAW,MAAM,MAAM,GAAGtB,EAAO,GAAGe,CAAQ,GAAI,CACpD,GAAGC,EACH,QAAAG,EACA,OAAQC,EAAW,OACpB,EAEKX,EAAO,MAAMa,EAAS,OAE5B,GAAI,CAACA,EAAS,GACZ,MAAM,IAAI,MAAMb,EAAK,OAAS,WAAW,EAG3C,OAAOA,CACT,OAASc,EAAO,CACd,MAAIA,aAAiB,OAASA,EAAM,OAAS,aACrC,IAAI,MAAM,yDAAyD,EAErEA,CACR,SACE,aAAaF,CAAS,CACxB,CACF,CAGA,eAAeG,EACbT,EACAL,EAAcN,EAAU,MACZ,CACZ,MAAMqB,EAAWV,EAGXW,EAASrB,GAAaoB,CAAQ,EACpC,GAAIC,EAAQ,OAAOA,EAGnB,MAAMC,EAAUxB,GAAgB,IAAIsB,CAAQ,EAC5C,GAAIE,EAAS,OAAOA,EAGpB,MAAMC,EAAUd,EAAcC,CAAQ,EAAE,KAAKN,IAC3CD,GAASiB,EAAUhB,EAAMC,CAAG,EAC5BP,GAAgB,OAAOsB,CAAQ,EACxBhB,EACR,EAAE,MAAMoB,GAAO,CACd,MAAA1B,GAAgB,OAAOsB,CAAQ,EACzBI,CACR,CAAC,EAED,OAAA1B,GAAgB,IAAIsB,EAAUG,CAAO,EAC9BA,CACT,CAGA,eAAeE,EACbf,EACAC,EAAuB,GACE,CACzB,GAAI,CAEF,MAAO,CAAE,QAAS,GAAM,KADX,MAAMF,EAAcC,EAAUC,CAAO,CAC1B,CAC1B,OAASO,EAAY,CACnB,MAAO,CAAE,QAAS,GAAO,MAAOA,EAAM,SAAW,YACnD,CACF,CAGA,SAASQ,GAAcC,EAAgB,CACrC,OAAKA,GACE,CACL,GAAGA,EAEH,kBAAmBA,EAAK,qBAAuBA,EAAK,kBACpD,iBAAkBA,EAAK,oBAAsBA,EAAK,iBAClD,WAAYA,EAAK,aAAeA,EAAK,WACrC,UAAWA,EAAK,YAAcA,EAAK,UACnC,aAAcA,EAAK,eAAiBA,EAAK,aAG7C,CAGO,MAAMC,GAAU,CACrB,MAAO,MAAOC,EAAeC,IAAqB,CAChD,MAAM1B,EAAO,MAAMK,EAAyC,kBAAmB,CAC7E,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,MAAAoB,EAAO,SAAAC,EAAU,EACzC,EACD,oBAAa,QAAQ,aAAc1B,EAAK,KAAK,EAEtC,CAAE,GAAGA,EAAM,KAAMsB,GAActB,EAAK,IAAI,EACjD,EAEA,OAAQ,IAAM,CACZ,aAAa,WAAW,YAAY,CACtC,EAEA,SAAU,MAAO2B,GAeRtB,EAA0B,qBAAsB,CACrD,OAAQ,OACR,KAAM,KAAK,UAAUsB,CAAQ,EAC9B,EAGH,aAAc,MAAOC,GAYZvB,EAA+C,0BAA2B,CAC/E,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,MAAAuB,EAAO,EAC/B,CAEL,EAGaC,GAAW,CACtB,MAAO,SAAY,CACjB,MAAM7B,EAAO,MAAMK,EAA0B,eAAe,EAC5D,MAAO,CAAE,KAAMiB,GAActB,EAAK,IAAI,EACxC,EAEA,SAAU,MAAO8B,GAAkE,CACjF,MAAM9B,EAAO,MAAMK,EAA0B,gBAAiB,CAC5D,OAAQ,QACR,KAAM,KAAK,UAAUyB,CAAO,EAC7B,EACD,MAAO,CAAE,KAAMR,GAActB,EAAK,IAAI,EACxC,EAEA,eAAgB,MAAO+B,EAAyBC,IACvC3B,EAA+D,yBAA0B,CAC9F,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,iBAAkB0B,EAAiB,aAAcC,EAAa,EACtF,EAGH,mBAAoB,SACX3B,EAA8D,gCAAiC,CACpG,OAAQ,OACT,EAGH,oBAAqB,MAAO4B,EAAgBD,IACnC3B,EAAiC,cAAc4B,CAAM,YAAa,CACvE,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,aAAcD,EAAa,EACnD,EAGH,OAAQ,MAAOE,GAAsE,CACnF,MAAMC,EAAS,IAAI,gBACfD,GAAS,MAAMC,EAAO,OAAO,OAAQD,EAAQ,IAAI,EACjDA,GAAS,aAAaC,EAAO,OAAO,cAAeD,EAAQ,WAAW,EACtEA,GAAS,OAAOC,EAAO,OAAO,QAASD,EAAQ,MAAM,UAAU,EACnE,MAAME,EAAQD,EAAO,WACrB,OAAO9B,EAA+C,aAAa+B,EAAQ,IAAMA,EAAQ,EAAE,EAAE,CAC/F,EAEA,OAAQ,MAAOH,GACN5B,EAAiC,cAAc4B,CAAM,GAAI,CAC9D,OAAQ,SACT,CAEL,EAGaI,EAAc,CAEzB,cAAe,SACNtB,EAA+B,gBAAiBpB,EAAU,MAAM,EAKzE,OAAQ,MAAOY,GAAiE,CAC9E,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,MAAM4B,EAAO,OAAO,OAAQ,OAAO5B,EAAQ,IAAI,CAAC,EACzDA,GAAS,OAAO4B,EAAO,OAAO,QAAS,OAAO5B,EAAQ,KAAK,CAAC,EAC5DA,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,MAAM,EAC3D,MAAM6B,EAAQD,EAAO,WACrB,OAAO9B,EACL,oBAAoB+B,EAAQ,IAAMA,EAAQ,EAAE,GAEhD,EAEA,eAAgB,MAAOE,GACdvB,EAA+B,6BAA6BuB,CAAU,GAAI3C,EAAU,MAAM,EAGnG,OAAQ,MAAO4C,GAaNlC,EAA6B,gBAAiB,CACnD,OAAQ,OACR,KAAM,KAAK,UAAUkC,CAAO,EAC7B,EAGH,OAAQ,MAAOC,EAAmBV,IAazBzB,EAA6B,iBAAiBmC,CAAS,GAAI,CAChE,OAAQ,QACR,KAAM,KAAK,UAAUV,CAAO,EAC7B,EAGH,OAAQ,MAAOU,GACNnC,EAAiC,iBAAiBmC,CAAS,GAAI,CACpE,OAAQ,SACT,EAGH,OAAQ,MAAOC,GACNpC,EAAgC,8BAA8B,mBAAmBoC,CAAW,CAAC,EAAE,CAE1G,EAGaC,EAAa,CAExB,cAAe,SACNrC,EAAkC,yBAAyB,EAIpE,gBAAiB,SACRA,EAAkD,4BAA4B,EAGvF,gBAAiB,MAAOL,GAUfK,EAA+B,0BAA2B,CAC/D,OAAQ,OACR,KAAM,KAAK,UAAUL,CAAI,EAC1B,EAGH,gBAAiB,MAAO2C,EAAY3C,IAC3BK,EAAiC,2BAA2BsC,CAAE,GAAI,CACvE,OAAQ,QACR,KAAM,KAAK,UAAU3C,CAAI,EAC1B,EAGH,gBAAiB,MAAO2C,GACftC,EAAiC,2BAA2BsC,CAAE,GAAI,CACvE,OAAQ,SACT,EAIH,WAAY,MAAOC,GAAyB,CAC1C,MAAMC,EAAMD,EAAc,oCAAoCA,CAAW,GAAK,uBAC9E,OAAOvC,EAA+BwC,CAAG,CAC3C,EAEA,aAAc,MAAO7C,GAUZK,EAA4B,uBAAwB,CACzD,OAAQ,OACR,KAAM,KAAK,UAAUL,CAAI,EAC1B,EAGH,aAAc,MAAO2C,EAAY3C,IASxBK,EAAiC,wBAAwBsC,CAAE,GAAI,CACpE,OAAQ,QACR,KAAM,KAAK,UAAU3C,CAAI,EAC1B,EAGH,aAAc,MAAO2C,GACZtC,EAAiC,wBAAwBsC,CAAE,GAAI,CACpE,OAAQ,SACT,CAEL,EAGaG,GAAgB,CAC3B,OAAQ,SACC/B,EAA4B,mBAAoBpB,EAAU,KAAK,EAGxE,QAAS,MAAOoD,GACPhC,EAAyB,oBAAoBgC,CAAM,GAAIpD,EAAU,KAAK,EAG/E,OAAQ,MAAOqD,GAcN3C,EAA0B,mBAAoB,CACnD,OAAQ,OACR,KAAM,KAAK,UAAU2C,CAAI,EAC1B,EAGH,OAAQ,MAAOD,EAAgBE,IACtB5C,EAAiC,oBAAoB0C,CAAM,UAAW,CAC3E,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAE,EAAQ,EAChC,EAGH,OAAQ,MAAOF,GACN1C,EAAiC,oBAAoB0C,CAAM,GAAI,CACpE,OAAQ,SACT,EAGH,SAAU,MAAOG,GACR7C,EAA6E,4BAA6B,CAC/G,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAU6C,EAAS,EAC3C,EAGH,IAAK,MAAOH,GACH1C,EAA6C,oBAAoB0C,CAAM,OAAQ,CACpF,OAAQ,OACT,EAGH,QAAS,MAAOA,GACP1C,EAA4B,oBAAoB0C,CAAM,OAAO,CAExE,EAGaI,GAAU,CACrB,YAAa,SACJ9C,EAAgC,oBAAoB,EAG7D,cAAe,MAAO+C,GAMb/C,EAA6B,qBAAsB,CACxD,OAAQ,OACR,KAAM,KAAK,UAAU+C,CAAO,EAC7B,EAGH,YAAa,MAAOC,EAAmBC,EAAQ,GAAIC,IAAoB,CACrE,MAAMpB,EAAS,IAAI,gBAAgB,CAAE,MAAO,OAAOmB,CAAK,EAAG,EAC3D,OAAIC,GAAQpB,EAAO,OAAO,SAAUoB,CAAM,EACnClD,EAAgC,sBAAsBgD,CAAS,aAAalB,CAAM,EAAE,CAC7F,EAEA,YAAa,MAAOkB,EAAmBG,IAC9BnD,EAA6B,sBAAsBgD,CAAS,YAAa,CAC9E,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,QAAAG,EAAS,EACjC,EAGH,SAAU,MAAOH,GACRhD,EAAiC,sBAAsBgD,CAAS,QAAS,CAC9E,OAAQ,OACT,EAIH,gBAAiB,MAAOA,EAAmBI,IAClCpD,EAAiC,sBAAsBgD,CAAS,aAAaI,CAAS,QAAS,CACpG,OAAQ,OACT,EAIH,0BAA2B,SAClBpD,EAAgB,6BAA8B,CACnD,OAAQ,OACT,EAIH,sBAAuB,SACdA,EAAgC,yCAAyC,EAIlF,eAAgB,SACPA,EAAqC,wBAAwB,CAExE,EAGaqD,GAAmB,CAC9B,OAAQ,SACC3C,EAAoC,qBAAsBpB,EAAU,KAAK,EAGlF,OAAQ,MAAOgE,GAaT,CACJ,MAAMC,EAAS,MAAMvD,EAA2B,qBAAsB,CACpE,OAAQ,OACR,KAAM,KAAK,UAAUsD,CAAY,EAClC,EACD,OAAAzD,EAAgB,oBAAoB,EAC7B0D,CACT,EAEA,OAAQ,MAAOC,GAA2B,CACxC,MAAMD,EAAS,MAAMvD,EAAiC,sBAAsBwD,CAAc,GAAI,CAC5F,OAAQ,SACT,EACD,OAAA3D,EAAgB,oBAAoB,EAC7B0D,CACT,EAGA,OAAQ,MAAOC,EAAwB7D,IAYjC,CACJ,MAAM4D,EAAS,MAAMvD,EAAkC,sBAAsBwD,CAAc,GAAI,CAC7F,OAAQ,MACR,KAAM,KAAK,UAAU7D,CAAI,EAC1B,EACD,OAAAE,EAAgB,oBAAoB,EAC7B0D,CACT,EAGA,aAAc,MAAOC,GACZxD,EAAiC,sBAAsBwD,CAAc,QAAS,CACnF,OAAQ,OACT,EAIH,SAAU,MAAOA,GACRxD,EAMJ,sBAAsBwD,CAAc,QAAQ,CAEnD,EAGaC,GAAY,CAEvB,WAAY,MAAOC,GAAmF,CACpG,MAAMC,EAAW,IAAI,SACrBA,EAAS,OAAO,OAAQD,CAAI,EAE5B,MAAMtD,EAAQ,aAAa,QAAQ,YAAY,EACzCI,EAAW,MAAM,MAAM,GAAGtB,EAAO,cAAe,CACpD,OAAQ,OACR,QAASkB,EAAQ,CAAE,cAAiB,UAAUA,CAAK,IAAO,GAC1D,KAAMuD,CAAA,CACP,EAED,GAAI,CAACnD,EAAS,GAAI,CAChB,MAAMoD,EAAY,MAAMpD,EAAS,OACjC,MAAM,IAAI,MAAMoD,EAAU,OAAS,eAAe,CACpD,CAGA,OADa,MAAMpD,EAAS,QAChB,IACd,EAGA,YAAa,MAAOqD,GACF,MAAM,QAAQ,IAAIA,EAAM,IAAIH,GAAQD,GAAU,WAAWC,CAAI,CAAC,CAAC,CAGnF,EAGaI,GAAc,CACzB,OAAQ,SACCpD,EAA+B,gBAAiBpB,EAAU,IAAI,EAGvE,QAAS,MAAOgD,GACPtC,EAA4B,iBAAiBsC,CAAE,EAAE,CAE5D,EAGayB,GAAe,CAC1B,OAAQ,SAECrD,EAAgC,iBAAkBpB,EAAU,IAAI,EAGzE,QAAS,MAAOgD,GACP5B,EAAiE,kBAAkB4B,CAAE,GAAIhD,EAAU,IAAI,EAGhH,OAAQ,MAAO0E,GAqCT,CACJ,MAAMT,EAAS,MAAMvD,EAA8B,iBAAkB,CACnE,OAAQ,OACR,KAAM,KAAK,UAAUgE,CAAQ,EAC9B,EAED,OAAAnE,EAAgB,gBAAgB,EACzB0D,CACT,EAEA,OAAQ,MAAOjB,EAAYb,IAuCpB,CACL,MAAM8B,EAAS,MAAMvD,EAA8B,kBAAkBsC,CAAE,GAAI,CACzE,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAED,OAAA5B,EAAgB,gBAAgB,EACzB0D,CACT,EAEA,OAAQ,MAAOjB,GAAe,CAC5B,MAAMiB,EAAS,MAAMvD,EAAiC,kBAAkBsC,CAAE,GAAI,CAC5E,OAAQ,SACT,EAED,OAAAzC,EAAgB,gBAAgB,EACzB0D,CACT,CACF,EAGaU,GAAe,CAC1B,cAAe,MAAOC,GACblE,EAAiC,kBAAkBkE,CAAU,YAAY,EAGlF,OAAQ,MAAOA,EAAoBC,IAc1BnE,EAA8B,kBAAkBkE,CAAU,aAAc,CAC7E,OAAQ,OACR,KAAM,KAAK,UAAUC,CAAQ,EAC9B,EAGH,OAAQ,MAAO7B,EAAYb,IAelBzB,EAA8B,kBAAkBsC,CAAE,GAAI,CAC3D,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,OAAQ,MAAOa,GACNtC,EAAiC,kBAAkBsC,CAAE,GAAI,CAC9D,OAAQ,SACT,CAEL,EAGa8B,GAAuB,CAClC,cAAe,MAAOF,GACblE,EAAiC,kBAAkBkE,CAAU,YAAY,EAGlF,OAAQ,MAAOA,EAAoBG,IAO1BrE,EAA8B,kBAAkBkE,CAAU,aAAc,CAC7E,OAAQ,OACR,KAAM,KAAK,UAAUG,CAAQ,EAC9B,EAGH,OAAQ,MAAO/B,GACNtC,EAAiC,2BAA2BsC,CAAE,GAAI,CACvE,OAAQ,SACT,CAEL,EAGagC,GAAgB,CAC3B,cAAe,MAAOJ,EAAoBhE,IAKpC,CACJ,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,YAAY4B,EAAO,OAAO,cAAe5B,EAAQ,UAAU,EACpEA,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,MAAM,EACvDA,GAAS,MAAM4B,EAAO,OAAO,OAAQ5B,EAAQ,KAAK,UAAU,EAC5DA,GAAS,OAAO4B,EAAO,OAAO,QAAS5B,EAAQ,MAAM,UAAU,EACnE,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EACL,kBAAkBkE,CAAU,cAAcnC,CAAK,GAEnD,EAEA,QAAS,MAAOO,GACPtC,EAAoE,mBAAmBsC,CAAE,EAAE,EAGpG,OAAQ,MAAO4B,EAAoBK,IAY1BvE,EAA+B,kBAAkBkE,CAAU,cAAe,CAC/E,OAAQ,OACR,KAAM,KAAK,UAAUK,CAAS,EAC/B,EAGH,OAAQ,MAAOjC,EAAYb,IAWlBzB,EAA+B,mBAAmBsC,CAAE,GAAI,CAC7D,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,OAAQ,MAAOa,GACNtC,EAAiC,mBAAmBsC,CAAE,GAAI,CAC/D,OAAQ,SACT,CAEL,EAGakC,EAAY,CACvB,OAAQ,MAAOtE,GAAgF,CAC7F,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,MAAM4B,EAAO,OAAO,OAAQ5B,EAAQ,IAAI,EACjDA,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,MAAM,EACvDA,GAAS,MAAM4B,EAAO,OAAO,OAAQ5B,EAAQ,KAAK,UAAU,EAC5DA,GAAS,OAAO4B,EAAO,OAAO,QAAS5B,EAAQ,MAAM,UAAU,EACnE,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EACL,cAAc+B,CAAK,GAEvB,EAEA,QAAS,MAAOO,GACPtC,EAA8C,eAAesC,CAAE,EAAE,EAG1E,OAAQ,MAAOmC,GAWNzE,EAA2B,cAAe,CAC/C,OAAQ,OACR,KAAM,KAAK,UAAUyE,CAAK,EAC3B,EAGH,OAAQ,MAAOnC,EAAYb,IAUlBzB,EAA2B,eAAesC,CAAE,GAAI,CACrD,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,OAAQ,MAAOa,GACNtC,EAAiC,eAAesC,CAAE,GAAI,CAC3D,OAAQ,SACT,EAGH,gBAAiB,MAAOoC,EAAiBnC,EAAqB5C,IAKrDK,EAAiC,eAAe0E,CAAO,eAAenC,CAAW,GAAI,CAC1F,OAAQ,OACR,KAAM,KAAK,UAAU5C,GAAQ,EAAE,EAChC,EAGH,oBAAqB,MAAO+E,EAAiBnC,IACpCvC,EAAiC,eAAe0E,CAAO,eAAenC,CAAW,GAAI,CAC1F,OAAQ,SACT,CAEL,EAGaoC,GAAsB,CACjC,cAAe,MAAOT,EAAoBhE,IAKpC,CACJ,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,MAAM,EACvDA,GAAS,SAAS4B,EAAO,OAAO,WAAY,MAAM,EAClD5B,GAAS,MAAM4B,EAAO,OAAO,OAAQ5B,EAAQ,KAAK,UAAU,EAC5DA,GAAS,OAAO4B,EAAO,OAAO,QAAS5B,EAAQ,MAAM,UAAU,EACnE,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EACL,kBAAkBkE,CAAU,YAAYnC,CAAK,GAEjD,EAEA,QAAS,MAAOO,GACPtC,EAA6B,iBAAiBsC,CAAE,EAAE,EAG3D,OAAQ,MAAOsC,GAWN5E,EAA6B,gBAAiB,CACnD,OAAQ,OACR,KAAM,KAAK,UAAU4E,CAAO,EAC7B,EAGH,OAAQ,MAAOtC,EAAYb,IAOlBzB,EAA6B,iBAAiBsC,CAAE,GAAI,CACzD,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,WAAY,MAAOvB,GAAwD,CACzE,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,SAAS4B,EAAO,OAAO,WAAY5B,EAAQ,QAAQ,UAAU,EACtEA,GAAS,YAAY4B,EAAO,OAAO,cAAe5B,EAAQ,UAAU,EACxE,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EAA+B,wBAAwB+B,CAAK,EAAE,CACvE,CACF,EAGa8C,GAAkB,CAC7B,eAAgB,MAAOtC,EAAqBrC,IAAqC,CAC/E,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,WAAa,QAAW4B,EAAO,OAAO,YAAa5B,EAAQ,SAAS,UAAU,EAC3F,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EAAiC,mBAAmBuC,CAAW,aAAaR,CAAK,EAAE,CAC5F,EAEA,QAAS,MAAOO,GACPtC,EAA8B,kBAAkBsC,CAAE,EAAE,EAG7D,OAAQ,MAAOC,EAAqBuC,IAe3B9E,EAA8B,mBAAmBuC,CAAW,aAAc,CAC/E,OAAQ,OACR,KAAM,KAAK,UAAUuC,CAAQ,EAC9B,EAGH,OAAQ,MAAOxC,EAAYb,IAalBzB,EAA8B,kBAAkBsC,CAAE,GAAI,CAC3D,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,OAAQ,MAAOa,GACNtC,EAAiC,kBAAkBsC,CAAE,GAAI,CAC9D,OAAQ,SACT,EAGH,QAAS,MAAOA,EAAY3C,IACnBK,EAAiC,kBAAkBsC,CAAE,YAAa,CACvE,OAAQ,OACR,KAAM,KAAK,UAAU3C,CAAI,EAC1B,CAEL,EAGaoF,EAAY,CACvB,eAAgB,MAAOxC,EAAqBrC,IAAoD,CAC9F,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,MAAM4B,EAAO,OAAO,OAAQ5B,EAAQ,IAAI,EACjDA,GAAS,WAAa,QAAW4B,EAAO,OAAO,YAAa5B,EAAQ,SAAS,UAAU,EAC3F,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EAA8B,mBAAmBuC,CAAW,UAAUR,CAAK,EAAE,CACtF,EAEA,cAAe,MAAOmC,EAAoBhE,IAAoD,CAC5F,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,MAAM4B,EAAO,OAAO,OAAQ5B,EAAQ,IAAI,EACjDA,GAAS,WAAa,QAAW4B,EAAO,OAAO,YAAa5B,EAAQ,SAAS,UAAU,EAC3F,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EAA8B,kBAAkBkE,CAAU,UAAUnC,CAAK,EAAE,CACpF,EAEA,QAAS,MAAOO,GACPtC,EAA4C,eAAesC,CAAE,EAAE,EAGxE,OAAQ,MAAO0C,GAeNhF,EAA2B,cAAe,CAC/C,OAAQ,OACR,KAAM,KAAK,UAAUgF,CAAK,EAC3B,EAGH,OAAQ,MAAO1C,EAAYb,IAalBzB,EAA2B,eAAesC,CAAE,GAAI,CACrD,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,OAAQ,MAAOa,GACNtC,EAAiC,eAAesC,CAAE,GAAI,CAC3D,OAAQ,SACT,EAGH,aAAc,MAAOA,EAAYM,IACxB5C,EAAiC,eAAesC,CAAE,gBAAiB,CACxE,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAM,EAAQ,EAChC,CAEL,EAGaqC,GAAmB,CAC9B,WAAY,MAAOC,EAAiBhF,IAAmE,CACrG,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,OAAO4B,EAAO,OAAO,QAAS5B,EAAQ,MAAM,UAAU,EAC/DA,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,OAAO,UAAU,EAClEA,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,MAAM,EAC3D,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EAAgC,eAAekF,CAAO,YAAYnD,CAAK,EAAE,CAClF,EAEA,eAAgB,MAAOmD,GACdlF,EAAoC,eAAekF,CAAO,eAAe,EAGlF,OAAQ,MAAOA,EAAiBC,IAMvBnF,EAA6B,eAAekF,CAAO,YAAa,CACrE,OAAQ,OACR,KAAM,KAAK,UAAUC,CAAO,EAC7B,EAGH,OAAQ,MAAOC,EAAmBzF,IACzBK,EAAiC,uBAAuBoF,CAAS,UAAW,CACjF,OAAQ,OACR,KAAM,KAAK,UAAUzF,CAAI,EAC1B,CAEL,EAGa0F,GAAU,CACrB,OAAQ,SAECrF,EAIJ,YAAa,CAAE,MAAO,WAAY,EAIvC,QAAS,MAAO4B,GAEP5B,EAA0B,aAAa4B,CAAM,GAAI,CAAE,MAAO,WAAY,EAI/E,OAAQ,MAAOjC,GAQNK,EAA0B,qBAAsB,CACrD,OAAQ,OACR,KAAM,KAAK,UAAUL,CAAI,EAC1B,EAGH,OAAQ,MAAOiC,EAAgBjC,IAQtBK,EAA0B,aAAa4B,CAAM,GAAI,CACtD,OAAQ,QACR,KAAM,KAAK,UAAUjC,CAAI,EAC1B,EAIH,OAAQ,MAAOiC,GACN5B,EAAiC,aAAa4B,CAAM,GAAI,CAC7D,OAAQ,SACT,EAIH,kBAAmB,SACV5B,EAIJ,gCAAiC,CAClC,OAAQ,OACT,CAEL,EAGasF,GAAe,CAC1B,OAAQ,MAAOC,EAAU,KAGhBvF,EAFKuF,EAAU,0BAA4B,iBAEL,CAAE,MAAO,WAAY,EAIpE,QAAS,MAAOC,GAEPxF,EAA8B,kBAAkBwF,CAAU,GAAI,CAAE,MAAO,WAAY,EAG5F,aAAc,MAAOA,EAAoBC,IAChCzF,EAA8B,kBAAkBwF,CAAU,UAAW,CAC1E,OAAQ,QACR,KAAM,KAAK,UAAU,CAAE,OAAAC,EAAQ,EAChC,EAIH,SAAU,MAAOD,GACRxF,EASJ,kBAAkBwF,CAAU,QAAQ,CAE3C,EAGaE,EAAc,CACzB,OAAQ,MAAOD,EAAiBE,IAAsB,CACpD,MAAM7D,EAAS,IAAI,gBACf2D,GAAQ3D,EAAO,OAAO,SAAU2D,CAAM,EACtCE,GAAU7D,EAAO,OAAO,WAAY6D,CAAQ,EAChD,MAAMC,EAAc9D,EAAO,WAE3B,OAAOpB,EAA+B,gBAAgBkF,EAAc,IAAMA,EAAc,EAAE,GAAItG,EAAU,KAAK,CAC/G,EAEA,OAAQ,MAAOwB,GAST,CACJ,MAAMyC,EAAS,MAAMvD,EAA6B,gBAAiB,CACjE,OAAQ,OACR,KAAM,KAAK,UAAUc,CAAO,EAC7B,EACD,OAAAjB,EAAgB,eAAe,EACxB0D,CACT,EAEA,OAAQ,MAAOsC,EAAmBpE,IAK5B,CACJ,MAAM8B,EAAS,MAAMvD,EAAiC,iBAAiB6F,CAAS,GAAI,CAClF,OAAQ,QACR,KAAM,KAAK,UAAUpE,CAAO,EAC7B,EACD,OAAA5B,EAAgB,eAAe,EACxB0D,CACT,EAEA,OAAQ,MAAOsC,EAAmBL,IAAuB,CACvD,MAAMjC,EAAS,MAAMvD,EAA6B,iBAAiB6F,CAAS,UAAW,CACrF,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,YAAaL,EAAY,EACjD,EACD,OAAA3F,EAAgB,eAAe,EACxB0D,CACT,EAEA,OAAQ,MAAOsC,GAAsB,CACnC,MAAMtC,EAAS,MAAMvD,EAAiC,iBAAiB6F,CAAS,UAAW,CACzF,OAAQ,OACT,EACD,OAAAhG,EAAgB,eAAe,EACxB0D,CACT,EAEA,MAAO,MAAOsC,GAAsB,CAClC,MAAMtC,EAAS,MAAMvD,EAAiC,iBAAiB6F,CAAS,SAAU,CACxF,OAAQ,OACT,EACD,OAAAhG,EAAgB,eAAe,EACxB0D,CACT,EAEA,SAAU,MAAOsC,IACfhG,EAAgB,eAAe,EACxBG,EAAiC,iBAAiB6F,CAAS,YAAa,CAC7E,OAAQ,OACT,GAGH,MAAO,MAAOA,GAAsB,CAClC,MAAMtC,EAAS,MAAMvD,EAA+C,iBAAiB6F,CAAS,SAAU,CACtG,OAAQ,OACT,EACD,OAAAhG,EAAgB,eAAe,EACxB0D,CACT,EAEA,OAAQ,MAAOsC,GAAsB,CACnC,MAAMtC,EAAS,MAAMvD,EAAwE,iBAAiB6F,CAAS,UAAW,CAChI,OAAQ,OACT,EACD,OAAAhG,EAAgB,eAAe,EACxB0D,CACT,EAGA,QAAS,MAAOsC,EAAmBC,EAAiBC,IAAsB,CACxE,MAAMxC,EAAS,MAAMvD,EAAiC,iBAAiB6F,CAAS,WAAY,CAC1F,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAC,EAAQ,SAAAC,EAAU,EAC1C,EACD,OAAAlG,EAAgB,eAAe,EACxB0D,CACT,EAGA,OAAQ,MAAOsC,EAAmBjD,IAAmB,CACnD,MAAMW,EAAS,MAAMvD,EAAiC,iBAAiB6F,CAAS,UAAW,CACzF,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAjD,EAAQ,EAChC,EACD,OAAA/C,EAAgB,eAAe,EACxB0D,CACT,EAGA,KAAM,MAAOsC,EAAmBC,EAAgBC,IACvC/F,EAAiC,iBAAiB6F,CAAS,QAAS,CACzE,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAC,EAAQ,SAAAC,EAAU,EAC1C,EAIH,OAAQ,MAAOF,EAAmBjD,IAAmB,CACnD,MAAMW,EAAS,MAAMvD,EAAiC,iBAAiB6F,CAAS,UAAW,CACzF,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAjD,EAAQ,EAChC,EACD,OAAA/C,EAAgB,eAAe,EACxB0D,CACT,EAGA,QAAS,MAAOsC,EAAmBjD,IAAmB,CACpD,MAAMW,EAAS,MAAMvD,EAAiC,iBAAiB6F,CAAS,WAAY,CAC1F,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAjD,EAAQ,EAChC,EACD,OAAA/C,EAAgB,eAAe,EACxB0D,CACT,EAGA,iBAAkB,MAAOsC,EAAmBlG,IAMnCK,EAAgC,iBAAiB6F,CAAS,cAAe,CAC9E,OAAQ,OACR,KAAM,KAAK,UAAUlG,CAAI,EAC1B,EAGH,eAAgB,MAAOkG,GACd7F,EAAmC,iBAAiB6F,CAAS,aAAa,CAErF,EAGaG,GAAgB,CAE3B,WAAY,SACHhG,EAAmC,0BAA0B,EAItE,QAAS,MAAOiG,EAAsBC,EAAmBC,IAChDnG,EAAgC,4BAA4BiG,CAAY,WAAY,CACzF,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAAC,EAAU,cAAeC,EAAc,EAC/D,CAEL,EA8EaC,GAAsB,CACjC,OAAQ,MAAOC,GAENrG,EAAgC,yBADzBqG,EAAa,eAAiB,EACyB,EAAE,EAGzE,QAAS,MAAO/D,GACPtC,EAA6B,0BAA0BsC,CAAE,EAAE,EAGpE,OAAQ,MAAOgE,GAUNtG,EAA6B,yBAA0B,CAC5D,OAAQ,OACR,KAAM,KAAK,UAAUsG,CAAO,EAC7B,EAGH,OAAQ,MAAOhE,EAAYb,IAUlBzB,EAA6B,0BAA0BsC,CAAE,GAAI,CAClE,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,OAAQ,MAAOa,GACNtC,EAAiC,0BAA0BsC,CAAE,GAAI,CACtE,OAAQ,SACT,CAEL,EAGaiE,GAAuB,CAClC,OAAQ,MAAOrG,GAMT,CACJ,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,MAAM,EACvDA,GAAS,WAAW4B,EAAO,OAAO,aAAc5B,EAAQ,SAAS,EACjEA,GAAS,UAAU4B,EAAO,OAAO,YAAa5B,EAAQ,QAAQ,EAC9DA,GAAS,MAAM4B,EAAO,OAAO,OAAQ5B,EAAQ,KAAK,UAAU,EAC5DA,GAAS,OAAO4B,EAAO,OAAO,QAAS5B,EAAQ,MAAM,UAAU,EACnE,MAAM6B,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAO9B,EAAiC,0BAA0B+B,CAAK,EAAE,CAC3E,EAEA,QAAS,MAAOO,GACPtC,EAA8B,2BAA2BsC,CAAE,EAAE,EAGtE,OAAQ,MAAOkE,GAQNxG,EAA8B,0BAA2B,CAC9D,OAAQ,OACR,KAAM,KAAK,UAAUwG,CAAQ,EAC9B,EAGH,OAAQ,MAAOlE,EAAYb,IASlBzB,EAA8B,2BAA2BsC,CAAE,GAAI,CACpE,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAGH,OAAQ,MAAOa,GACNtC,EAAiC,2BAA2BsC,CAAE,GAAI,CACvE,OAAQ,SACT,EAGH,SAAU,MAAOA,EAAY3C,IAOpBK,EAA8B,2BAA2BsC,CAAE,YAAa,CAC7E,OAAQ,OACR,KAAM,KAAK,UAAU3C,CAAI,EAC1B,EAGH,SAAU,MAAO2C,EAAY3C,IACpBK,EAA8B,2BAA2BsC,CAAE,YAAa,CAC7E,OAAQ,OACR,KAAM,KAAK,UAAU3C,GAAQ,EAAE,EAChC,CAEL,EAGa8G,GAAmB,CAC9B,eAAgB,MAAOC,GACd1G,EAA6B,2BAA2B0G,CAAU,QAAQ,EAGnF,KAAM,MAAOA,EAAoB/G,IAIxBK,EAA0B,2BAA2B0G,CAAU,SAAU,CAC9E,OAAQ,OACR,KAAM,KAAK,UAAU/G,CAAI,EAC1B,EAGH,WAAY,MAAO+G,GACV1G,EAAiC,2BAA2B0G,CAAU,SAAU,CACrF,OAAQ,SACT,CAEL,EAGaC,GAA2B,CACtC,SAAU,MAAOD,GACR1G,EAAkC,2BAA2B0G,CAAU,YAAa,CACzF,OAAQ,OACT,EAGH,WAAY,MAAOA,GACV1G,EAAiC,2BAA2B0G,CAAU,YAAa,CACxF,OAAQ,SACT,EAGH,kBAAmB,MAAOA,EAAoB9E,IACrC5B,EAAiC,2BAA2B0G,CAAU,eAAe9E,CAAM,GAAI,CACpG,OAAQ,OACT,CAEL,EAGagF,GAAsB,CACjC,eAAgB,MAAOF,GACd1G,EAAgC,2BAA2B0G,CAAU,WAAW,EAGzF,OAAQ,MAAOA,EAAoBX,IAQ1B/F,EAA8B,2BAA2B0G,CAAU,YAAa,CACrF,OAAQ,OACR,KAAM,KAAK,UAAUX,CAAQ,EAC9B,CAEL,EAGac,GAA2B,CACtC,OAAQ,MAAOC,GAEN9G,EAAqC,8BAD9B8G,EAAa,eAAiB,EACmC,EAAE,EAGnF,WAAY,MAAOxE,GACVtC,EAAiC,+BAA+BsC,CAAE,QAAS,CAChF,OAAQ,OACT,EAGH,cAAe,SACNtC,EAAiC,uCAAwC,CAC9E,OAAQ,OACT,CAEL,EAGa+G,GAAsB,CACjC,OAAQ,SACC/G,EAA8C,wBAAwB,EAG/E,OAAQ,MAAOgH,GACNhH,EAAiC,yBAA0B,CAChE,OAAQ,QACR,KAAM,KAAK,UAAUgH,CAAQ,EAC9B,CAEL,EAoBaC,EAAkB,CAC7B,OAAQ,MAAO/G,GAKT,CACJ,MAAM4B,EAAS,IAAI,gBACf5B,GAAS,YAAY4B,EAAO,OAAO,cAAe5B,EAAQ,UAAU,EACpEA,GAAS,QAAQ4B,EAAO,OAAO,SAAU5B,EAAQ,MAAM,EACvDA,GAAS,aAAa4B,EAAO,OAAO,eAAgB5B,EAAQ,WAAW,EACvEA,GAAS,YAAY4B,EAAO,OAAO,cAAe,MAAM,EAC5D,MAAMC,EAAQD,EAAO,WAAa,IAAIA,EAAO,UAAU,GAAK,GAC5D,OAAOd,EAAwC,gBAAgBe,CAAK,EAAE,EAAE,KAAKmF,IAAM,CACjF,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,UAAYA,EAAE,KAC5B,MAAOA,EAAE,OACT,CACJ,EAEA,QAAS,MAAO5E,GACPtB,EAAuB,iBAAiBsB,CAAE,EAAE,EAAE,KAAK,IAAM,CAC9D,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,OAAQ,MAAO6E,GAUNnG,EAAuB,gBAAiB,CAC7C,OAAQ,OACR,KAAM,KAAK,UAAUmG,CAAO,EAC7B,EAAE,KAAK,IAAM,CACZ,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,OAAQ,MAAO7E,EAAYb,IAClBT,EAAuB,iBAAiBsB,CAAE,GAAI,CACnD,OAAQ,QACR,KAAM,KAAK,UAAUb,CAAO,EAC7B,EAAE,KAAKyF,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,SAAWA,EAAE,KAC3B,MAAOA,EAAE,OACT,EAGJ,OAAQ,MAAO5E,GACNtB,EAAwC,iBAAiBsB,CAAE,GAAI,CACpE,OAAQ,SACT,EAIH,OAAQ,MAAOA,GACNtB,EAAuB,iBAAiBsB,CAAE,UAAW,CAAE,OAAQ,OAAQ,EAAE,KAAK,IAAM,CACzF,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,QAAS,MAAOA,GACPtB,EAAuB,iBAAiBsB,CAAE,WAAY,CAAE,OAAQ,OAAQ,EAAE,KAAK,IAAM,CAC1F,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,OAAQ,MAAOA,EAAYM,IAClB5B,EAAuB,iBAAiBsB,CAAE,UAAW,CAC1D,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAM,EAAQ,EAChC,EAAE,KAAKsE,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,SAAWA,EAAE,KAC3B,MAAOA,EAAE,OACT,EAGJ,iBAAkB,MAAO5E,GAChBtB,EAAuB,iBAAiBsB,CAAE,sBAAuB,CAAE,OAAQ,OAAQ,EAAE,KAAK,IAAM,CACrG,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,gBAAiB,MAAOA,EAAY8E,IAC3BpG,EAAuB,iBAAiBsB,CAAE,oBAAqB,CACpE,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAA8E,EAAU,EAClC,EAAE,KAAKF,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,SAAWA,EAAE,KAC3B,MAAOA,EAAE,OACT,EAGJ,WAAY,MAAO5E,GACVtB,EAAuB,iBAAiBsB,CAAE,eAAgB,CAAE,OAAQ,OAAQ,EAAE,KAAK,IAAM,CAC9F,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,YAAa,MAAOA,GACXtB,EAAuB,iBAAiBsB,CAAE,gBAAiB,CAAE,OAAQ,OAAQ,EAAE,KAAK,IAAM,CAC/F,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,eAAgB,MAAOA,GACdtB,EAAuB,iBAAiBsB,CAAE,mBAAoB,CAAE,OAAQ,OAAQ,EAAE,KAAK,IAAM,CAClG,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,SAAW,EAAE,KAC3B,MAAO,EAAE,OACT,EAGJ,iBAAkB,MAAOA,GAChBtB,EAAuB,iBAAiBsB,CAAE,qBAAsB,CAAE,OAAQ,OAAQ,EAAE,KAAK,IAAM,CACpG,QAAS,EAAE,QACX,KAAM,EAAE,KACR,MAAO,EAAE,OACT,EAGJ,gBAAiB,MAAOA,EAAY+E,IAC3BrG,EAAuB,iBAAiBsB,CAAE,oBAAqB,CACpE,OAAQ,OACR,KAAM+E,EAAa,KAAK,UAAUA,CAAU,EAAI,OACjD,EAAE,KAAKH,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,KACR,MAAOA,EAAE,OACT,EAGJ,OAAQ,MAAO5E,EAAYM,IAClB5B,EAAuB,iBAAiBsB,CAAE,UAAW,CAC1D,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAM,EAAQ,EAChC,EAAE,KAAKsE,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,SAAWA,EAAE,KAC3B,MAAOA,EAAE,OACT,EAGJ,YAAa,MAAOI,GACXtG,EAAuB,iBAAiBsG,CAAS,WAAW,EAAE,KAAK,IAAM,CAC9E,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,UAAY,EAAE,KAC5B,MAAO,EAAE,OACT,EAIJ,gBAAiB,MAAOA,GAAuC,CAC7D,MAAMlH,EAAQ,aAAa,QAAQ,YAAY,EAI/C,OAHiB,MAAM,MAAM,iBAAiBkH,CAAS,iBAAkB,CACvE,QAASlH,EAAQ,CAAE,cAAiB,UAAUA,CAAK,IAAO,EAAC,CAC5D,GACe,MAClB,EAGA,qBAAuBkH,GAAsB,CAC3C,OAAO,KAAK,iBAAiBA,CAAS,iBAAkB,QAAQ,CAClE,EAGA,oBAAqB,MAAOA,GAAsB,CAChD,MAAMC,EAAO,MAAMN,EAAgB,gBAAgBK,CAAS,EAGtDE,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAM,QAAU,OACvB,SAAS,KAAK,YAAYA,CAAM,EAEhC,MAAMC,EAAMD,EAAO,iBAAmBA,EAAO,eAAe,SACxDC,IACFA,EAAI,OACJA,EAAI,MAAMF,CAAI,EACdE,EAAI,QAGJ,WAAW,IAAM,CACfD,EAAO,eAAe,QAEtB,WAAW,IAAM,CACf,SAAS,KAAK,YAAYA,CAAM,CAClC,EAAG,GAAI,CACT,EAAG,GAAG,EAEV,CACF,EAGaE,GAA0B,CACrC,KAAM,MAAOJ,EAAmBF,KAE9BvH,EAAgB,eAAe,EAExBmB,EAAuB,iBAAiBsG,CAAS,kBAAmB,CACzE,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,UAAWF,EAAU,EAC7C,EAAE,KAAKF,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,SAAWA,EAAE,KAC3B,MAAOA,EAAE,OACT,GAGJ,UAAW,MAAOI,GACTtG,EAA+C,iBAAiBsG,CAAS,oBAAoB,CAExG,EAGaK,GAAwB,CACnC,KAAM,MAAOL,EAAmBM,EAAsBjI,IAW7CqB,EACL,iBAAiBsG,CAAS,WAAWM,CAAY,QACjD,CACE,OAAQ,OACR,KAAM,KAAK,UAAUjI,CAAI,EAC3B,EACA,KAAKuH,IAAM,CACX,QAASA,EAAE,QACX,KAAMA,EAAE,KACR,MAAOA,EAAE,OACT,EAGJ,WAAY,MAAOI,EAAmBO,IAAqB,CACzD,MAAM9F,EAAQ8F,EAAU,aAAaA,CAAO,GAAK,GACjD,OAAO7G,EAAqC,iBAAiBsG,CAAS,YAAYvF,CAAK,EAAE,EAAE,KAAKmF,IAAM,CACpG,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,OAASA,EAAE,MAAQ,GACjC,MAAOA,EAAE,OACT,CACJ,EAEA,eAAgB,MAAOI,GACdtG,EAA2C,iBAAiBsG,CAAS,eAAe,EAAE,KAAK,IAAM,CACtG,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,aAAe,EAAE,MAAQ,GACvC,MAAO,EAAE,OACT,CAEN,EAGaQ,GAAgB,CAC3B,QAAS,MAAOnI,GAOPqB,EAAuB,4BAA6B,CACzD,OAAQ,OACR,KAAM,KAAK,UAAUrB,CAAI,EAC1B,EAAE,KAAK,IAAM,CACZ,QAAS,EAAE,QACX,KAAM,EAAE,KACR,MAAO,EAAE,OACT,EAGJ,OAAQ,MAAOoI,EAAepF,IACrB3B,EAAyD,2BAA4B,CAC1F,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,MAAA+G,EAAO,KAAApF,EAAM,EACrC,EAAE,KAAKuE,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,KACR,MAAOA,EAAE,OACT,CAEN,EAGac,GAA6B,CACxC,IAAK,MAAO9D,GACHlD,EAAuB,mCAAmCkD,CAAU,EAAE,EAAE,KAAK,IAAM,CACxF,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,UAAY,EAAE,KAC5B,MAAO,EAAE,OACT,EAGJ,OAAQ,MAAOA,EAAoB8C,IAC1BhG,EAAuB,mCAAmCkD,CAAU,GAAI,CAC7E,OAAQ,QACR,KAAM,KAAK,UAAU8C,CAAQ,EAC9B,EAAE,KAAKE,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,UAAYA,EAAE,KAC5B,MAAOA,EAAE,OACT,CAEN,EAGae,GAAwB,CACnC,cAAe,MAAO/D,GACblD,EAA2C,0CAA0CkD,CAAU,EAAE,EAAE,KAAK,IAAM,CACnH,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,aAAe,EAAE,MAAQ,GACvC,MAAO,EAAE,OACT,EAGJ,OAAQ,MAAOgE,GAUNlH,EAAuB,6BAA8B,CAC1D,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,YAAakH,EAAK,WAClB,aAAcA,EAAK,YACnB,iBAAkBA,EAAK,gBACvB,SAAUA,EAAK,QACf,WAAYA,EAAK,UACjB,aAAcA,EAAK,WAAa,KAAK,UAAUA,EAAK,UAAU,EAAI,KAClE,gBAAiBA,EAAK,gBAAkB,IACxC,WAAYA,EAAK,WAAa,EAC/B,EACF,EAAE,KAAK,IAAM,CACZ,QAAS,EAAE,QACX,KAAM,EAAE,MAAM,YAAc,EAAE,KAC9B,MAAO,EAAE,OACT,EAGJ,OAAQ,MAAO5F,EAAY6F,IAClBnH,EAAuB,8BAA8BsB,CAAE,UAAW,CACvE,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,YAAa6F,EAAY,EACjD,EAAE,KAAKjB,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,YAAcA,EAAE,KAC9B,MAAOA,EAAE,OACT,CAEN,EAGakB,GAA2B,CACtC,IAAK,MAAOd,EAAmBe,EAAoBC,IAC1CtH,EAAuB,iBAAiBsG,CAAS,mBAAoB,CAC1E,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAAe,EAAU,WAAAC,EAAY,EAC9C,EAAE,KAAKpB,IAAM,CACZ,QAASA,EAAE,QACX,KAAMA,EAAE,MAAM,SAAWA,EAAE,KAC3B,MAAOA,EAAE,OACT,CAEN,EA8DaqB,GAAc,CAEzB,OAAQ,SACCvH,EAAqD,eAAe,EAAE,KAAKkG,IAAM,CACtF,QAASA,EAAE,QACX,KAAMA,EAAE,KACR,MAAOA,EAAE,OACT,EAIJ,IAAK,MAAO1H,GACHwB,EAAkC,iBAAiBxB,CAAG,EAAE,EAAE,KAAK,IAAM,CAC1E,QAAS,EAAE,QACX,KAAM,EAAE,KACR,MAAO,EAAE,OACT,EAIJ,OAAQ,MAAOA,EAAagJ,IACnBxH,EAAwC,iBAAiBxB,CAAG,GAAI,CACrE,OAAQ,MACR,KAAM,KAAK,UAAU,CAAE,MAAAgJ,EAAO,EAC/B,EAIH,WAAY,MAAOxB,GACVhG,EAAwC,gBAAiB,CAC9D,OAAQ,OACR,KAAM,KAAK,UAAUgG,CAAQ,EAC9B,CAEL,uzBC3uEayB,EAAeC,GAAA,EAC1BC,GACE,CAACC,EAAKC,KAAS,CACb,KAAM,KACN,MAAO,KACP,UAAW,GACX,MAAO,KACP,gBAAiB,GAEjB,MAAO,MAAOC,EAAkBzH,IAAqB,CACnD,MAAM0H,EAAkBD,EAAS,OAC3BE,EAAqB3H,EAAS,OACpCuH,EAAI,CAAE,UAAW,GAAM,MAAO,KAAM,EAGpC,GAAI,CACF,MAAMjJ,EAAO,MAAMwB,GAAQ,MAAM4H,EAAiBC,CAAkB,EACpE,OAAAJ,EAAI,CACF,KAAMjJ,EAAK,KACX,MAAOA,EAAK,MACZ,UAAW,GACX,MAAO,KACR,EACM,EACT,OAASsJ,EAAmB,CAE1B,MAAMC,EAAUD,aAAoB,MAAQA,EAAS,QAAU,4BAC/D,OAAAL,EAAI,CACF,UAAW,GACX,MAAOM,CAAA,CACR,EACM,EACT,CACF,EAEA,OAAQ,IAAM,CACZ/H,GAAQ,SACRyH,EAAI,CAAE,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,CAC9C,EAEA,SAAU,MAAOtH,GAAa,CAC5BsH,EAAI,CAAE,UAAW,GAAM,MAAO,KAAM,EACpC,GAAI,CACF,aAAMzH,GAAQ,SAASG,CAAQ,EAC/BsH,EAAI,CAAE,UAAW,GAAO,EACjB,EACT,OAASnI,EAAgB,CAEvB,OAAAmI,EAAI,CAAE,UAAW,GAAO,MAAQnI,EAAgB,QAAS,EAClD,EACT,CACF,EAEA,aAAc,MAAOc,GAAU,CAC7BqH,EAAI,CAAE,UAAW,GAAM,MAAO,KAAM,EACpC,GAAI,CACF,MAAMrF,EAAS,MAAMpC,GAAQ,aAAaI,CAAK,EAC/C,OAAAqH,EAAI,CAAE,UAAW,GAAO,EACjBrF,CACT,OAAS9C,EAAgB,CAEvB,OAAAmI,EAAI,CAAE,UAAW,GAAO,MAAQnI,EAAgB,QAAS,EAClD,CAAE,QAAS,GAAI,QAAS,EAAC,CAClC,CACF,EAEA,cAAe,MAAOgB,GAAY,CAChCmH,EAAI,CAAE,UAAW,GAAM,MAAO,KAAM,EACpC,GAAI,CACF,MAAMjJ,EAAO,MAAM6B,GAAS,SAASC,CAAO,EAC5C,OAAAmH,EAAI,CAAE,KAAMjJ,EAAK,KAAM,UAAW,GAAO,EAClC,EACT,OAASc,EAAgB,CAEvB,OAAAmI,EAAI,CAAE,UAAW,GAAO,MAAQnI,EAAgB,QAAS,EAClD,EACT,CACF,EAEA,eAAgB,MAAOiB,EAAiBC,IAAgB,CACtDiH,EAAI,CAAE,UAAW,GAAM,MAAO,KAAM,EACpC,GAAI,CACF,MAAMrF,EAAS,MAAM/B,GAAS,eAAeE,EAAiBC,CAAW,EAEnEwH,EAAcN,IAAM,KAC1B,OAAIM,GAAe5F,EAAO,oBACxBqF,EAAI,CACF,KAAM,CAAE,GAAGO,EAAa,kBAAmB5F,EAAO,qBAClD,UAAW,GACZ,EAEDqF,EAAI,CAAE,UAAW,GAAO,EAEnB,EACT,OAASnI,EAAgB,CAEvB,OAAAmI,EAAI,CAAE,UAAW,GAAO,MAAQnI,EAAgB,QAAS,EAClD,EACT,CACF,EAEA,oBAAqB,MAAOmB,EAAQD,IAAgB,CAClDiH,EAAI,CAAE,UAAW,GAAM,MAAO,KAAM,EACpC,GAAI,CACF,aAAMpH,GAAS,oBAAoBI,EAAQD,CAAW,EACtDiH,EAAI,CAAE,UAAW,GAAO,EACjB,EACT,OAASnI,EAAgB,CAEvB,OAAAmI,EAAI,CAAE,UAAW,GAAO,MAAQnI,EAAgB,QAAS,EAClD,EACT,CACF,EAEA,mBAAoB,SAAY,CAC9B,GAAI,CACF,MAAM8C,EAAS,MAAM/B,GAAS,qBAExB2H,EAAcN,IAAM,KAC1B,OAAIM,GAAe5F,EAAO,oBACxBqF,EAAI,CACF,KAAM,CAAE,GAAGO,EAAa,iBAAkB5F,EAAO,mBAAmB,CACrE,EAEI,EACT,MAAyB,CAEvB,MAAO,EACT,CACF,EAEA,YAAa,SAAY,CAEvB,GADcsF,IAAM,MAGpB,GAAI,CACF,MAAMlJ,EAAO,MAAM6B,GAAS,QAC5BoH,EAAI,CAAE,KAAMjJ,EAAK,KAAM,CACzB,MAAgB,CAGdkJ,EAAA,EAAM,QACR,CACF,EAGA,YAAa,CAACzH,EAAeC,EAAkBH,IAAe,CAI5DC,GAAQ,SAAS,CACf,MAAAC,EACA,SAAAC,EACA,KAAMH,EAAK,KACX,KAAMA,EAAK,KACX,MAAOA,EAAK,MACZ,QAASA,EAAK,QACd,UAAWA,EAAK,UAChB,YAAcA,EAAa,WAC3B,SAAWA,EAAa,SACxB,MAAQA,EAAa,MACrB,OAASA,EAAa,OACtB,SAAWA,EAAa,SACzB,EAAE,KAAK,IAAM,CAEd,CAAC,EAAE,MAAOH,GAAQ,CAElB,CAAC,EAED6H,EAAKQ,IAAW,CACd,gBAAiB,CACf,GAAGA,EAAM,gBACT,CAAChI,CAAK,EAAG,CAAE,SAAAC,EAAU,KAAAH,CAAA,CAAK,CAC5B,EACA,CAGJ,EAEA,WAAaE,GAAkB,CAC7BwH,EAAKQ,GAAU,CACb,MAAMC,EAAW,CAAE,GAAGD,EAAM,iBAC5B,cAAOC,EAASjI,CAAK,EACd,CAAE,gBAAiBiI,CAAA,CAC5B,CAAC,CACH,EAEA,mBAAoB,CAACjI,EAAeO,IAAwB,CAC1DiH,EAAKQ,GACCA,EAAM,gBAAgBhI,CAAK,EACtB,CACL,gBAAiB,CACf,GAAGgI,EAAM,gBACT,CAAChI,CAAK,EAAG,CACP,GAAGgI,EAAM,gBAAgBhI,CAAK,EAC9B,SAAUO,CAAA,CACZ,CACF,EAGGyH,CACR,CACH,EAEA,kBAAmB,CAAChI,EAAeK,IAA2B,CAC5DmH,EAAKQ,GACCA,EAAM,gBAAgBhI,CAAK,EACtB,CACL,gBAAiB,CACf,GAAGgI,EAAM,gBACT,CAAChI,CAAK,EAAG,CACP,GAAGgI,EAAM,gBAAgBhI,CAAK,EAC9B,KAAM,CAAE,GAAGgI,EAAM,gBAAgBhI,CAAK,EAAE,KAAM,GAAGK,CAAA,CAAQ,CAC3D,CACF,EAIA2H,EAAM,MAAM,QAAUhI,EACjB,CAAE,KAAM,CAAE,GAAGgI,EAAM,KAAM,GAAG3H,EAAQ,EAEtC2H,CACR,CACH,EAEA,gBAAkBhI,GACFyH,EAAA,EACD,gBAAgBzH,CAAK,GAAG,UAAY,IACnD,GAEF,CACE,KAAM,kBACN,QAAS,EACT,WAAagI,IAAW,CACtB,KAAMA,EAAM,KACZ,MAAOA,EAAM,QAKf,mBAAoB,IAAM,CAACA,EAAO3I,IAAU,CAC1C,GAAI,CAAAA,EAIJ,GAAI2I,GAAO,MAAM,GAAI,CAGnB,MAAME,EAAeF,EAAM,KAAK,GAC5BA,EAAM,QAAUE,IAKlBF,EAAM,MAAQE,GAEhB,aAAa,QAAQ,aAAcA,CAAY,CAEjD,MAAWF,GAAO,QAGhB,aAAa,WAAW,YAAY,EACpCA,EAAM,MAAQ,KAElB,EACF,CAEJ,EChMMG,GAAsBC,IAA0B,CACpD,GAAIA,EAAE,GACN,KAAMA,EAAE,KACR,QAASA,EAAE,QACX,KAAMA,EAAE,KACR,gBAAiBA,EAAE,iBACnB,WAAYA,EAAE,YACd,eAAgBA,EAAE,gBAClB,OAAQA,EAAE,QAAU,EACpB,UAAWA,EAAE,iBAAmB,EAChC,gBAAiBA,EAAE,kBAAoB,EACvC,UAAWA,EAAE,YAAc,EAC3B,WAAYA,EAAE,aAAe,EAC7B,WAAYA,EAAE,aAAe,EAC7B,SAAUA,EAAE,UACZ,UAAWA,EAAE,YAAc,EAC3B,cAAeA,EAAE,eACjB,aAAcA,EAAE,eAAiB,WACjC,SAAUA,EAAE,WAAa,OACzB,aAAcA,EAAE,eAAiB,GACjC,eAAgBA,EAAE,iBAAmB,GACrC,YAAa,CAAC,CAACA,EAAE,aACjB,cAAeA,EAAE,gBAAkB,EACnC,OAAQ,CAAC,CAACA,EAAE,QACZ,YAAaA,EAAE,cAAgB,UAC/B,YAAa,CAAC,CAACA,EAAE,cACjB,gBAAiBA,EAAE,mBAAqB,UACxC,aAAcA,EAAE,eAAiB,UACjC,YAAa,CAAC,CAACA,EAAE,aACjB,qBAAsB,CAAC,CAACA,EAAE,uBAC1B,aAAc,CAAC,CAACA,EAAE,cAClB,cAAe,CAAC,CAACA,EAAE,gBACnB,cAAeA,EAAE,gBAAkB,EACnC,cAAe,CAAC,CAACA,EAAE,eACnB,UAAWA,EAAE,WACb,YAAaA,EAAE,aACf,oBAAqBA,EAAE,sBACvB,eAAgBA,EAAE,gBAClB,gBAAiBA,EAAE,kBACnB,cAAeA,EAAE,gBAAkB,EACnC,YAAaA,EAAE,cAAgB,EAC/B,UAAWA,EAAE,YAAc,EAC3B,eAAgBA,EAAE,iBAAmB,EACrC,eAAgBA,EAAE,iBAAmB,EACrC,YAAaA,EAAE,cAAgB,EAC/B,aAAcA,EAAE,eAAiB,EACjC,iBAAkBA,EAAE,mBAAqB,EACzC,oBAAqBA,EAAE,uBAAyB,EAChD,UAAW,GACX,UAAWA,EAAE,WACb,UAAWA,EAAE,UACf,GAEMC,GAAsB,IAAsB,CAChD,GAAI,EAAE,GACN,WAAY,EAAE,YACd,OAAQ,EAAE,OACV,WAAY,EAAE,aAAe,EAC7B,SAAU,EAAE,UACZ,eAAgB,EAAE,gBAClB,aAAc,EAAE,cAChB,YAAa,CAAC,CAAC,EAAE,aACjB,WAAY,EAAE,YACd,aAAc,EAAE,cAChB,aAAc,EAAE,cAChB,iBAAkB,EAAE,kBACpB,cAAe,EAAE,eACjB,eAAgB,EAAE,gBAClB,MAAO,EAAE,KACX,GAEMC,GAAuBC,IAAuB,CAClD,GAAIA,EAAE,GACN,WAAYA,EAAE,YACd,WAAYA,EAAE,YACd,OAAQA,EAAE,OACV,MAAOA,EAAE,OAAS,EAClB,MAAOA,EAAE,OAAS,EAClB,UAAWA,EAAE,YAAc,EAC3B,WAAYA,EAAE,aAAe,EAC7B,YAAaA,EAAE,aACf,YAAaA,EAAE,aACf,WAAYA,EAAE,YACd,cAAeA,EAAE,eACjB,WAAY,CAAC,CAACA,EAAE,YAChB,UAAW,CAAC,CAACA,EAAE,WACf,WAAY,CAAC,CAACA,EAAE,YAChB,WAAY,CAAC,CAACA,EAAE,YAChB,cAAeA,EAAE,eACjB,cAAeA,EAAE,gBAAkB,UACnC,eAAgBA,EAAE,gBAClB,mBAAoBA,EAAE,oBACtB,iBAAkBA,EAAE,kBACpB,OAAQA,EAAE,QAAU,WACpB,aAAc,CAAC,CAACA,EAAE,cAClB,eAAgBA,EAAE,gBAClB,OAAQ,GACR,kBAAmBA,EAAE,oBACrB,eAAgBA,EAAE,iBAClB,MAAOA,EAAE,MACT,UAAWA,EAAE,WACb,UAAWA,EAAE,UACf,GAEMC,GAAmBC,IAAmB,CAC1C,GAAIA,EAAE,GACN,KAAMA,EAAE,MAAQ,aAChB,SAAUA,EAAE,UACZ,UAAWA,EAAE,WACb,WAAYA,EAAE,YACd,SAAUA,EAAE,UACZ,YAAaA,EAAE,aACf,IAAKA,EAAE,IACP,IAAKA,EAAE,IACP,KAAMA,EAAE,KACR,aAAcA,EAAE,cAChB,aAAcA,EAAE,cAChB,eAAgBA,EAAE,gBAClB,eAAgBA,EAAE,gBAClB,iBAAkBA,EAAE,mBACpB,mBAAoBA,EAAE,qBACtB,UAAWA,EAAE,WACb,WAAYA,EAAE,YACd,oBAAqBA,EAAE,qBACvB,cAAeA,EAAE,eACjB,MAAOA,EAAE,MACT,gBAAiBA,EAAE,iBACnB,MAAOA,EAAE,MACT,iBAAkBA,EAAE,mBAAqB,QACzC,cAAeA,EAAE,gBAAkB,QACnC,eAAgBA,EAAE,iBAAmB,IACrC,kBAAmBA,EAAE,mBACrB,sBAAuBA,EAAE,wBACzB,aAAcA,EAAE,cAAgB,KAAK,MAAMA,EAAE,aAAa,EAAI,GAC9D,mBAAoBA,EAAE,qBAAuB,KAAK,MAAMA,EAAE,oBAAoB,EAAI,GAClF,SAAUA,EAAE,YAAc,IAASA,EAAE,YAAc,EACnD,WAAY,CAAC,CAACA,EAAE,YAChB,WAAYA,EAAE,YACd,WAAYA,EAAE,YACd,SAAUA,EAAE,UACZ,QAASA,EAAE,SACX,YAAaA,EAAE,aACf,KAAMA,EAAE,KAAO,KAAK,MAAMA,EAAE,IAAI,EAAI,GACpC,MAAOA,EAAE,MACT,UAAWA,EAAE,WACb,UAAWA,EAAE,UACf,GAEMC,GAAqBH,IAA6B,CACtD,GAAIA,EAAE,GACN,OAAQA,EAAE,OACV,YAAaA,EAAE,aACf,WAAYA,EAAE,YACd,eAAgBA,EAAE,iBAClB,UAAWA,EAAE,WACb,gBAAiBA,EAAE,iBACnB,QAASA,EAAE,QACX,UAAWA,EAAE,YAAc,EAC3B,eAAgBA,EAAE,iBAAmB,EACrC,gBAAiBA,EAAE,kBAAoB,EACvC,QAASA,EAAE,SAAW,EACtB,YAAaA,EAAE,cAAgB,EAC/B,cAAeA,EAAE,gBAAkB,EACnC,gBAAiBA,EAAE,kBACnB,kBAAmBA,EAAE,oBACrB,eAAgBA,EAAE,iBAClB,iBAAkBA,EAAE,mBACpB,aAAcA,EAAE,eAChB,WAAY,CAAC,CAACA,EAAE,YAChB,eAAgBA,EAAE,gBAClB,eAAgBA,EAAE,iBAClB,YAAa,CAAC,CAACA,EAAE,aACjB,gBAAiBA,EAAE,iBACnB,eAAgBA,EAAE,gBAClB,OAAQA,EAAE,QAAU,SACpB,SAAUA,EAAE,UACZ,aAAcA,EAAE,cAChB,MAAOA,EAAE,MACT,UAAWA,EAAE,WACb,UAAWA,EAAE,UACf,GAEMI,GAAmBC,IAAmB,CAC1C,GAAIA,EAAE,GACN,YAAaA,EAAE,aACf,WAAYA,EAAE,YACd,KAAMA,EAAE,KACR,aAAcA,EAAE,cAChB,MAAOA,EAAE,MACT,MAAOA,EAAE,MACT,YAAaA,EAAE,aACf,iBAAkBA,EAAE,kBACpB,qBAAsBA,EAAE,uBACxB,WAAYA,EAAE,YACd,SAAUA,EAAE,iBACZ,aAAcA,EAAE,eAAiB,EACjC,aAAcA,EAAE,eAAiB,EACjC,gBAAiBA,EAAE,kBACnB,SAAUA,EAAE,YAAc,IAASA,EAAE,YAAc,EACnD,SAAU,CAAC,CAACA,EAAE,UACd,WAAYA,EAAE,YACd,MAAOA,EAAE,MACT,UAAWA,EAAE,WACb,UAAWA,EAAE,UACf,GAEMC,GAA0B/C,IAA0B,CACxD,GAAIA,EAAE,GACN,QAASA,EAAE,SACX,MAAOA,EAAE,MACT,cAAeA,EAAE,eACjB,YAAaA,EAAE,YACf,YAAaA,EAAE,aACf,OAAQA,EAAE,OACV,YAAaA,EAAE,aACf,YAAaA,EAAE,aACf,WAAY,CAAC,CAACA,EAAE,YAChB,WAAYA,EAAE,YACd,WAAYA,EAAE,YACd,SAAUA,EAAE,UACZ,OAAQA,EAAE,OACV,gBAAiBA,EAAE,iBACnB,MAAOA,EAAE,MACT,UAAWA,EAAE,UACf,GAEMgD,GAAsBhD,IAAsB,CAChD,GAAIA,EAAE,GACN,YAAaA,EAAE,aACf,QAASA,EAAE,SACX,SAAUA,EAAE,UACZ,UAAWA,EAAE,WACb,WAAYA,EAAE,YACd,SAAUA,EAAE,UACZ,UAAWA,EAAE,WACb,aAAcA,EAAE,eAAiB,QACjC,gBAAiBA,EAAE,kBACnB,iBAAkBA,EAAE,mBAAqB,YACzC,iBAAkBA,EAAE,kBACpB,oBAAqBA,EAAE,sBACvB,MAAOA,EAAE,MACT,gBAAiBA,EAAE,iBACnB,MAAOA,EAAE,MACT,SAAUA,EAAE,YAAc,IAASA,EAAE,YAAc,EACnD,YAAaA,EAAE,cACf,aAAcA,EAAE,eAChB,eAAgBA,EAAE,iBAClB,eAAgBA,EAAE,gBAClB,eAAgBA,EAAE,gBAClB,MAAOA,EAAE,MACT,UAAWA,EAAE,WACb,UAAWA,EAAE,UACf,GAEaiD,GAAczB,GAAA,EACzBC,GACE,CAACC,EAAKC,KAAS,CAEb,UAAW,GACX,UAAW,GACX,WAAY,GACZ,OAAQ,GACR,cAAe,GACf,OAAQ,GACR,UAAW,GACX,iBAAkB,GAGlB,mBAAoB,GACpB,mBAAoB,GACpB,oBAAqB,GACrB,gBAAiB,GACjB,kBAAmB,GACnB,mBAAoB,GACpB,gBAAiB,GAIjB,eAAgB,SAAY,CAE1BD,EAAI,CAAE,mBAAoB,GAAM,EAChC,GAAI,CAGF,MAAMwB,IAFW,MAAMrG,GAAa,UAER,WAAa,IAAI,IAAIwF,EAAkB,EAEnEX,EAAI,CAAE,UAAAwB,EAAW,mBAAoB,GAAO,CAC9C,MAAgB,CAEdxB,EAAI,CAAE,mBAAoB,GAAO,CACnC,CACF,EAEA,kBAAmB,MAAOtG,GAAe,CACvC,GAAI,CACF,MAAM9B,EAAW,MAAMuD,GAAa,QAAQzB,CAAE,EAC9C,GAAI,CAAC9B,EAAS,SAAU,OAAO,KAE/B,MAAMwD,EAAWuF,GAAmB/I,EAAS,QAAQ,EAC/C6J,GAAa7J,EAAS,WAAa,IAAI,IAAIiJ,EAAkB,EAC7Da,EAAY9J,EAAS,WAAa,GAGxC,OAAAoI,EAAKQ,GAAU,CACb,MAAMmB,EAAmBnB,EAAM,UAAU,KAAMI,GAAMA,EAAE,KAAOlH,CAAE,EAC5D8G,EAAM,UAAU,IAAKI,GAAOA,EAAE,KAAOlH,EAAK,CAAE,GAAG0B,EAAU,UAAAsG,CAAA,EAAcd,CAAE,EACzE,CAAC,GAAGJ,EAAM,UAAW,CAAE,GAAGpF,EAAU,UAAAsG,EAAW,EAI7CE,EAAmB,CAAC,GADHpB,EAAM,UAAU,OAAQqB,GAAMA,EAAE,aAAenI,CAAE,EAC3B,GAAG+H,CAAS,EAEzD,MAAO,CAAE,UAAWE,EAAkB,UAAWC,CAAA,CACnD,CAAC,EAEM,CAAE,SAAU,CAAE,GAAGxG,EAAU,UAAAsG,CAAA,EAAa,UAAAD,EAAW,UAAAC,CAAA,CAC5D,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,YAAa,MAAOI,GAAiB,CACnC,GAAI,CACF,MAAMlK,EAAW,MAAMuD,GAAa,OAAO2G,CAAmB,EAC9D,GAAIlK,EAAS,SAAU,CACrB,MAAMmK,EAAcpB,GAAmB/I,EAAS,QAAQ,EACxD,OAAAoI,EAAKQ,IAAW,CAAE,UAAW,CAAC,GAAGA,EAAM,UAAWuB,CAAW,GAAI,EAC1DA,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,eAAgB,MAAOrI,EAAI3C,IAAS,CAClC,GAAI,CACF,MAAMoE,GAAa,OAAOzB,EAAI3C,CAAW,EAEzCiJ,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKI,GAC9BA,EAAE,KAAOlH,EAAK,CAAE,GAAGkH,EAAG,GAAG7J,EAAM,UAAW,IAAI,OAAO,eAAkB6J,CAAA,CACzE,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,eAAgB,MAAOlH,GAAO,CAC5B,GAAI,CACF,MAAMyB,GAAa,OAAOzB,CAAE,EAC5BsG,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,OAAQI,GAAMA,EAAE,KAAOlH,CAAE,EACpD,UAAW8G,EAAM,UAAU,OAAQqB,GAAMA,EAAE,aAAenI,CAAE,EAC5D,WAAY8G,EAAM,WAAW,OAAQO,GAAMA,EAAE,aAAerH,CAAE,EAC9D,iBAAkB8G,EAAM,iBAAiB,OAAQwB,GAAMA,EAAE,aAAetI,CAAE,GAC1E,CACJ,OAAS7B,EAAY,CAEnB,MAAM,IAAI,MAAMA,EAAM,SAAW,4BAA4B,CAC/D,CACF,EAEA,gBAAkB6B,GACTuG,EAAA,EAAM,UAAU,KAAMW,GAAMA,EAAE,KAAOlH,CAAE,EAGhD,qBAAuBA,GAAO,CAC5B,MAAM0B,EAAW6E,IAAM,UAAU,KAAMW,GAAMA,EAAE,KAAOlH,CAAE,EACxD,GAAI,CAAC0B,EAAU,OAEf,MAAM6G,EAAahC,IAAM,WAAW,OAAQc,GAAMA,EAAE,aAAerH,CAAE,EAC/DwI,EAAWjC,IAAM,iBAAiB,OAAQ+B,GAAMA,EAAE,aAAetI,CAAE,EACnEyI,EAAYlC,IAAM,UAAU,OAAQ3B,GACxC2D,EAAW,KAAMlB,GAAMA,EAAE,KAAOzC,EAAE,WAAW,GAG/C,MAAO,CACL,GAAGlD,EACH,gBAAiB6G,EAAW,QAAU7G,EAAS,gBAC/C,eAAgB+G,EAAU,QAAU/G,EAAS,eAC7C,YAAa6E,IAAM,OAAO,OAAQgB,GAChCA,EAAE,aAAa,KAAMmB,GAAQH,EAAW,KAAMlB,GAAMA,EAAE,KAAOqB,CAAG,CAAC,GACjE,QAAUhH,EAAS,YACrB,UAAW8G,EAAS,OAAO,CAACG,EAAKtB,IAAMsB,EAAMtB,EAAE,YAAa,CAAC,GAAK3F,EAAS,UAC3E,iBAAkB6G,EAAW,OAAQlB,GAAMA,EAAE,SAAW,QAAQ,EAAE,QAAU3F,EAAS,iBAEzF,EAIA,oBAAqB,MAAOE,EAAYgH,IAAY,CAClD,GAAI,CACF,MAAM1K,EAAW,MAAM4D,GAAqB,OAAOF,EAAY,CAC7D,KAAMgH,EAAQ,KACd,KAAMA,EAAQ,KACd,QAASA,EAAQ,QACjB,SAAUA,EAAQ,SAClB,UAAWA,EAAQ,UACpB,EACD,GAAI1K,EAAS,SAAU,CAErB,MAAM2K,EAA2B,CAC/B,GAAGD,EACH,GAAI1K,EAAS,SAAS,GACtB,WAAA0D,EACA,WAAY1D,EAAS,SAAS,aAAe,IAAI,OAAO,aAAY,EAEtEoI,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKI,GAC9BA,EAAE,KAAOtF,EACL,CAAE,GAAGsF,EAAG,UAAW,CAAC,GAAIA,EAAE,WAAa,GAAK2B,CAAM,GAClD3B,CAAA,CACN,EACA,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,uBAAwB,MAAOtF,EAAYkH,IAAU,CACnD,GAAI,CACF,MAAMhH,GAAqB,OAAOgH,CAAK,EACvCxC,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKI,GAC9BA,EAAE,KAAOtF,EACL,CAAE,GAAGsF,EAAG,WAAYA,EAAE,WAAa,IAAI,OAAQ6B,GAAMA,EAAE,KAAOD,CAAK,GACnE5B,CAAA,CACN,EACA,CACJ,MAAgB,CAEhB,CACF,EAIA,yBAA0B,MAAOtF,GAAuB,CACtD0E,EAAI,CAAE,mBAAoB,GAAM,EAChC,GAAI,CAEF,MAAMyB,IADW,MAAMpG,GAAa,cAAcC,CAAU,GAChC,WAAa,IAAI,IAAIuF,EAAkB,EAGnE,OAAAb,EAAKQ,IAEI,CAAE,UAAW,CAAC,GADEA,EAAM,UAAU,OAAQqB,GAAMA,EAAE,aAAevG,CAAU,EACxC,GAAGmG,CAAS,EAAG,mBAAoB,IAC5E,EAEMA,CACT,MAAgB,CAEd,OAAAzB,EAAI,CAAE,mBAAoB,GAAO,EAC1B,EACT,CACF,EAEA,YAAa,MAAO0C,GAAiB,CACnC,GAAI,CACF,MAAM9K,EAAW,MAAMyD,GAAa,OAAOqH,EAAa,WAAY,CAClE,OAAQA,EAAa,OACrB,WAAYA,EAAa,WACzB,SAAUA,EAAa,SACvB,eAAgBA,EAAa,eAC7B,aAAcA,EAAa,aAC3B,YAAaA,EAAa,YAC1B,WAAYA,EAAa,WACzB,aAAcA,EAAa,aAC3B,aAAcA,EAAa,aAC3B,iBAAkBA,EAAa,iBAC/B,cAAeA,EAAa,cAC5B,MAAOA,EAAa,MACrB,EACD,GAAI9K,EAAS,SAAU,CACrB,MAAM+K,EAAc9B,GAAmBjJ,EAAS,QAAQ,EACxD,OAAAoI,EAAKQ,IAAW,CAAE,UAAW,CAAC,GAAGA,EAAM,UAAWmC,CAAW,GAAI,EAC1DA,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,eAAgB,MAAOjJ,EAAI3C,IAAS,CAClC,GAAI,CACF,MAAMsE,GAAa,OAAO3B,EAAI3C,CAAI,EAClCiJ,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKqB,GAC9BA,EAAE,KAAOnI,EAAK,CAAE,GAAGmI,EAAG,GAAG9K,GAAS8K,CAAA,CACpC,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,eAAgB,MAAOnI,GAAO,CAC5B,GAAI,CACF,MAAM2B,GAAa,OAAO3B,CAAE,EAC5BsG,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,OAAQqB,GAAMA,EAAE,KAAOnI,CAAE,EACpD,WAAY8G,EAAM,WAAW,OAAQO,GAAMA,EAAE,aAAerH,CAAE,GAC9D,CACJ,MAAgB,CAEhB,CACF,EAEA,uBAAyB4B,GAChB2E,EAAA,EAAM,UAAU,OAAQ4B,GAAMA,EAAE,aAAevG,CAAU,EAKlE,0BAA2B,MAAOA,EAAoBhE,IAAuD,CAC3G0I,EAAI,CAAE,oBAAqB,GAAM,EACjC,GAAI,CAEF,MAAMiC,IADW,MAAMvG,GAAc,cAAcJ,EAAYhE,CAAO,GACzC,YAAc,IAAI,IAAIwJ,EAAmB,EAGtE,OAAAd,EAAKQ,IAEI,CAAE,WAAY,CAAC,GADEA,EAAM,WAAW,OAAQO,GAAMA,EAAE,aAAezF,CAAU,EACxC,GAAG2G,CAAU,EAAG,oBAAqB,IAChF,EAEMA,CACT,MAAgB,CAEd,OAAAjC,EAAI,CAAE,oBAAqB,GAAO,EAC3B,EACT,CACF,EAEA,mBAAoB,MAAOtG,GAAe,CACxC,GAAI,CACF,MAAM9B,EAAW,MAAM8D,GAAc,QAAQhC,CAAE,EAC/C,GAAI,CAAC9B,EAAS,UAAW,OAAO,KAEhC,MAAM+D,EAAYmF,GAAoBlJ,EAAS,SAAS,EAClDgL,GAAUhL,EAAS,QAAU,IAAI,IAAIoJ,EAAe,EACpDhF,EAAUpE,EAAS,gBAAkBsJ,GAAkBtJ,EAAS,eAAe,EAAI,KAGzF,OAAAoI,EAAKQ,IAKI,CAAE,WAJiBA,EAAM,WAAW,KAAMO,GAAMA,EAAE,KAAOrH,CAAE,EAC9D8G,EAAM,WAAW,IAAKO,GAAOA,EAAE,KAAOrH,EAAKiC,EAAYoF,CAAE,EACzD,CAAC,GAAGP,EAAM,WAAY7E,CAAS,CAEd,EACtB,EAEM,CAAE,UAAAA,EAAW,OAAAiH,EAAQ,QAAA5G,CAAA,CAC9B,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,aAAc,MAAO6G,GAAkB,CACrC,GAAI,CACF,MAAMjL,EAAW,MAAM8D,GAAc,OAAOmH,EAAc,WAAY,CACpE,OAAQA,EAAc,OACtB,WAAYA,EAAc,WAC1B,MAAOA,EAAc,MACrB,UAAWA,EAAc,UACzB,WAAYA,EAAc,WAC1B,YAAaA,EAAc,YAC3B,MAAOA,EAAc,MACrB,WAAYA,EAAc,WAC1B,UAAWA,EAAc,UACzB,OAAQA,EAAc,OACvB,EACD,GAAIjL,EAAS,UAAW,CACtB,MAAMkL,EAAehC,GAAoBlJ,EAAS,SAAS,EAC3D,OAAAoI,EAAKQ,IAAW,CAAE,WAAY,CAAC,GAAGA,EAAM,WAAYsC,CAAY,GAAI,EAC7DA,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,gBAAiB,MAAOpJ,EAAI3C,IAAS,CACnC,GAAI,CACF,MAAM2E,GAAc,OAAOhC,EAAI3C,CAAW,EAC1CiJ,EAAKQ,IAAW,CACd,WAAYA,EAAM,WAAW,IAAK,GAChC,EAAE,KAAO9G,EAAK,CAAE,GAAG,EAAG,GAAG3C,EAAM,UAAW,IAAI,OAAO,eAAkB,EACzE,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,gBAAiB,MAAO2C,GAAO,CAC7B,GAAI,CACF,MAAMgC,GAAc,OAAOhC,CAAE,EAC7BsG,EAAKQ,IAAW,CACd,WAAYA,EAAM,WAAW,OAAQO,GAAMA,EAAE,KAAOrH,CAAE,EACtD,OAAQ8G,EAAM,OAAO,OAAQY,GAAMA,EAAE,cAAgB1H,CAAE,EACvD,UAAW8G,EAAM,UAAU,OAAQlC,GAAMA,EAAE,cAAgB5E,CAAE,EAC7D,iBAAkB8G,EAAM,iBAAiB,OAAQwB,GAAMA,EAAE,cAAgBtI,CAAE,GAC3E,CACJ,MAAgB,CAEhB,CACF,EAEA,wBAA0B4B,GACjB2E,EAAA,EAAM,WAAW,OAAQc,GAAMA,EAAE,aAAezF,CAAU,EAGnE,wBAA0ByH,GACjB9C,EAAA,EAAM,WAAW,OAAQc,GAAMA,EAAE,aAAegC,CAAU,EAGnE,iBAAmBrJ,GACVuG,EAAA,EAAM,WAAW,KAAMc,GAAMA,EAAE,KAAOrH,CAAE,EAKjD,uBAAwB,MAAOC,EAAqBrC,IAAoD,CACtG0I,EAAI,CAAE,gBAAiB,GAAM,EAC7B,GAAI,CAEF,MAAMgD,IADW,MAAM7G,EAAU,eAAexC,EAAarC,CAAO,GAC3C,QAAU,IAAI,IAAI6J,EAAe,EAG1D,OAAAnB,EAAKQ,IAEI,CAAE,OAAQ,CAAC,GADEA,EAAM,OAAO,OAAQY,GAAMA,EAAE,cAAgBzH,CAAW,EAC1C,GAAGqJ,CAAM,EAAG,gBAAiB,IAChE,EAEMA,CACT,MAAgB,CAEd,OAAAhD,EAAI,CAAE,gBAAiB,GAAO,EACvB,EACT,CACF,EAEA,sBAAuB,MAAO1E,EAAoBhE,IAAoD,CACpG0I,EAAI,CAAE,gBAAiB,GAAM,EAC7B,GAAI,CAEF,MAAMgD,IADW,MAAM7G,EAAU,cAAcb,EAAYhE,CAAO,GACzC,QAAU,IAAI,IAAI6J,EAAe,EAG1D,OAAAnB,EAAKQ,IAEI,CAAE,OAAQ,CAAC,GADEA,EAAM,OAAO,OAAQY,GAAMA,EAAE,aAAe9F,CAAU,EACxC,GAAG0H,CAAM,EAAG,gBAAiB,IAChE,EAEMA,CACT,MAAgB,CAEd,OAAAhD,EAAI,CAAE,gBAAiB,GAAO,EACvB,EACT,CACF,EAEA,eAAgB,MAAOtG,GAAe,CACpC,GAAI,CACF,MAAM9B,EAAW,MAAMuE,EAAU,QAAQzC,CAAE,EAC3C,GAAI,CAAC9B,EAAS,MAAO,OAAO,KAE5B,MAAMwE,EAAQ+E,GAAgBvJ,EAAS,KAAK,EACtCqL,GAAYrL,EAAS,UAAY,IAAI,IAAIyJ,EAAsB,EAGrE,OAAArB,EAAKQ,GAAU,CACb,MAAM0C,EAAgB1C,EAAM,OAAO,KAAMY,GAAMA,EAAE,KAAO1H,CAAE,EACtD8G,EAAM,OAAO,IAAKY,GAAOA,EAAE,KAAO1H,EAAK0C,EAAQgF,CAAE,EACjD,CAAC,GAAGZ,EAAM,OAAQpE,CAAK,EAGrB+G,EAAgB3C,EAAM,cAAc,OAAQlC,GAAMA,EAAE,UAAY5E,CAAE,EACxE,MAAO,CAAE,OAAQwJ,EAAe,cAAe,CAAC,GAAGC,EAAe,GAAGF,CAAQ,EAC/E,CAAC,EAEM,CAAE,MAAA7G,EAAO,SAAA6G,CAAA,CAClB,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,SAAU,MAAOG,GAAc,CAC7B,GAAI,CACF,MAAMxL,EAAW,MAAMuE,EAAU,OAAO,CACtC,YAAaiH,EAAU,YACvB,WAAYA,EAAU,WACtB,KAAMA,EAAU,KAChB,SAAUA,EAAU,SACpB,aAAcA,EAAU,aACxB,MAAOA,EAAU,MACjB,MAAOA,EAAU,MACjB,YAAaA,EAAU,YACvB,SAAUA,EAAU,SACpB,aAAcA,EAAU,aACxB,iBAAkBA,EAAU,iBAC5B,qBAAsBA,EAAU,qBAChC,WAAYA,EAAU,WACvB,EACD,GAAIxL,EAAS,MAAO,CAClB,MAAMyL,EAAWlC,GAAgBvJ,EAAS,KAAK,EAC/C,OAAAoI,EAAKQ,IAAW,CAAE,OAAQ,CAAC,GAAGA,EAAM,OAAQ6C,CAAQ,GAAI,EACjDA,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,YAAa,MAAO3J,EAAI3C,IAAS,CAC/B,GAAI,CACF,MAAMoF,EAAU,OAAOzC,EAAI3C,CAAW,EACtCiJ,EAAKQ,IAAW,CACd,OAAQA,EAAM,OAAO,IAAKY,GACxBA,EAAE,KAAO1H,EAAK,CAAE,GAAG0H,EAAG,GAAGrK,EAAM,UAAW,IAAI,OAAO,eAAkBqK,CAAA,CACzE,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,YAAa,MAAO1H,GAAO,CACzB,GAAI,CACF,MAAMyC,EAAU,OAAOzC,CAAE,EACzBsG,EAAKQ,IAAW,CACd,OAAQA,EAAM,OAAO,OAAQY,GAAMA,EAAE,KAAO1H,CAAE,EAC9C,cAAe8G,EAAM,cAAc,OAAQlC,GAAMA,EAAE,UAAY5E,CAAE,GACjE,CACJ,MAAgB,CAEhB,CACF,EAEA,kBAAmB,MAAOA,EAAIM,IAAW,CACvC,GAAI,CACF,MAAMmC,EAAU,aAAazC,EAAIM,CAAM,EACvCgG,EAAKQ,IAAW,CACd,OAAQA,EAAM,OAAO,IAAKY,GACxBA,EAAE,KAAO1H,EAAK,CAAE,GAAG0H,EAAG,SAAU,IAAUA,CAAA,CAC5C,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,qBAAuBzH,GACdsG,EAAA,EAAM,OAAO,OAAQmB,GAAMA,EAAE,cAAgBzH,CAAW,EAGjE,0BAA4B2B,GACnB2E,EAAA,EAAM,OAAO,OAAQmB,GAAMA,EAAE,aAAe9F,GAAc8F,EAAE,QAAQ,EAK7E,mBAAoB,MAAO9E,EAAiBhF,IAAkD,CAC5F,GAAI,CAEF,MAAM2L,IADW,MAAM5G,GAAiB,WAAWC,EAAShF,CAAO,GACxC,UAAY,IAAI,IAAI+J,EAAsB,EAGrE,OAAArB,EAAKQ,IAEI,CAAE,cAAe,CAAC,GADHA,EAAM,cAAc,OAAQlC,GAAMA,EAAE,UAAYhC,CAAO,EAClC,GAAG2G,CAAQ,GACvD,EAEMA,CACT,MAAgB,CAEd,MAAO,EACT,CACF,EAEA,mBAAoB,MAAO3G,EAASgH,IAAgB,CAClD,GAAI,CACF,MAAM1L,EAAW,MAAMyE,GAAiB,OAAOC,EAASgH,CAAW,EACnE,GAAI1L,EAAS,QAAS,CACpB,MAAM2L,EAAalC,GAAuBzJ,EAAS,OAAO,EAG1D,OAAAoI,EAAKQ,IAAW,CACd,cAAe,CAAC,GAAGA,EAAM,cAAe+C,CAAU,EAClD,OAAQ/C,EAAM,OAAO,IAAKY,GACxBA,EAAE,KAAO9E,EACL,CACE,GAAG8E,EACH,aAAckC,EAAY,MAC1B,gBAAiBA,EAAY,aAAe,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,GAEnFlC,CAAA,CACN,EACA,EAEKmC,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,mBAAoB,MAAO/G,EAAWgH,EAAUC,IAAoB,CAClE,GAAI,CACF,MAAMpH,GAAiB,OAAOG,EAAW,CAAE,SAAAgH,EAAU,gBAAAC,EAAiB,EAEtEzD,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,IAAKlC,GACtCA,EAAE,KAAO9B,EACL,CAAE,GAAG8B,EAAG,WAAYkF,EAAU,OAAQA,EAAW,WAAa,WAAY,gBAAAC,GAC1EnF,CAAA,CACN,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,iBAAmBhC,GACV2D,EAAA,EACJ,cAAc,OAAQ3B,GAAMA,EAAE,UAAYhC,CAAO,EACjD,KAAK,CAACyE,EAAGH,IAAM,IAAI,KAAKA,EAAE,WAAW,EAAE,UAAY,IAAI,KAAKG,EAAE,WAAW,EAAE,SAAS,EAGzF,eAAiBzE,GAAY,CAC3B,MAAM2G,EAAWhD,IAAM,iBAAiB3D,CAAO,EAC/C,OAAO2G,EAAS,OAAS,EAAIA,EAAS,CAAC,EAAI,MAC7C,EAIA,YAAa,MAAO3L,GAAiD,CACnE0I,EAAI,CAAE,gBAAiB,GAAM,EAC7B,GAAI,CAEF,MAAM4C,IADW,MAAMhH,EAAU,OAAOtE,CAAO,GACtB,QAAU,IAAI,IAAI0J,EAAe,EAC1D,OAAAhB,EAAI,CAAE,OAAA4C,EAAQ,gBAAiB,GAAO,EAC/BA,CACT,MAAgB,CAEd,OAAA5C,EAAI,CAAE,gBAAiB,GAAO,EACvB,EACT,CACF,EAEA,eAAgB,MAAOtG,GAAe,CACpC,GAAI,CACF,MAAM9B,EAAW,MAAMgE,EAAU,QAAQlC,CAAE,EAC3C,GAAI,CAAC9B,EAAS,MAAO,OAAO,KAE5B,MAAMiE,EAAQmF,GAAgBpJ,EAAS,KAAK,EACtCqK,GAAcrK,EAAS,YAAc,IAAI,IAAIkJ,EAAmB,EAGtE,OAAAd,EAAKQ,IAII,CAAE,OAHaA,EAAM,OAAO,KAAMS,GAAMA,EAAE,KAAOvH,CAAE,EACtD8G,EAAM,OAAO,IAAKS,GAAOA,EAAE,KAAOvH,EAAKmC,EAAQoF,CAAE,EACjD,CAAC,GAAGT,EAAM,OAAQ3E,CAAK,CACV,EAClB,EAEM,CAAE,MAAAA,EAAO,WAAAoG,CAAA,CAClB,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,SAAU,MAAOyB,GAAc,CAC7B,GAAI,CACF,MAAM9L,EAAW,MAAMgE,EAAU,OAAO,CACtC,KAAM8H,EAAU,KAChB,SAAUA,EAAU,SACpB,UAAWA,EAAU,UACrB,WAAYA,EAAU,WACtB,SAAUA,EAAU,SACpB,MAAOA,EAAU,MACjB,MAAOA,EAAU,MACjB,cAAeA,EAAU,cACzB,eAAgBA,EAAU,eAC3B,EACD,GAAI9L,EAAS,MAAO,CAClB,MAAM+L,EAAW3C,GAAgBpJ,EAAS,KAAK,EAC/C,OAAAoI,EAAKQ,IAAW,CAAE,OAAQ,CAAC,GAAGA,EAAM,OAAQmD,CAAQ,GAAI,EACjDA,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,YAAa,MAAOjK,EAAI3C,IAAS,CAC/B,GAAI,CACF,MAAM6E,EAAU,OAAOlC,EAAI3C,CAAW,EACtCiJ,EAAKQ,IAAW,CACd,OAAQA,EAAM,OAAO,IAAKS,GACxBA,EAAE,KAAOvH,EAAK,CAAE,GAAGuH,EAAG,GAAGlK,EAAM,UAAW,IAAI,OAAO,eAAkBkK,CAAA,CACzE,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,YAAa,MAAOvH,GAAO,CACzB,GAAI,CACF,MAAMkC,EAAU,OAAOlC,CAAE,EACzBsG,EAAKQ,IAAW,CACd,OAAQA,EAAM,OAAO,OAAQS,GAAMA,EAAE,KAAOvH,CAAE,GAC9C,CACJ,MAAgB,CAEhB,CACF,EAEA,qBAAsB,MAAOoC,EAASnC,EAAa5C,IAAS,CAC1D,GAAI,CACF,MAAM6E,EAAU,gBAAgBE,EAASnC,EAAa5C,CAAI,EAE1DiJ,EAAKQ,IAAW,CACd,OAAQA,EAAM,OAAO,IAAK,GACxB,EAAE,KAAO1E,EACL,CAAE,GAAG,EAAG,aAAc,CAAC,GAAI,EAAE,cAAgB,GAAKnC,CAAW,GAC7D,EACN,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,yBAA0B,MAAOmC,EAASnC,IAAgB,CACxD,GAAI,CACF,MAAMiC,EAAU,oBAAoBE,EAASnC,CAAW,EACxDqG,EAAKQ,IAAW,CACd,OAAQA,EAAM,OAAO,IAAKS,GACxBA,EAAE,KAAOnF,EACL,CAAE,GAAGmF,EAAG,cAAeA,EAAE,cAAgB,IAAI,OAAQvH,GAAOA,IAAOC,CAAW,GAC9EsH,CAAA,CACN,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,aAAevH,GACNuG,EAAA,EAAM,OAAO,KAAMgB,GAAMA,EAAE,KAAOvH,CAAE,EAG7C,qBAAuBC,GACdsG,EAAA,EAAM,OAAO,OAAQgB,GAAMA,EAAE,cAAc,SAAStH,CAAW,CAAC,EAGzE,aAAeR,GAAU,CACvB,MAAMyK,EAAazK,EAAM,cACzB,OAAO8G,EAAA,EAAM,OAAO,OACjBgB,GACCA,EAAE,UAAU,cAAc,SAAS2C,CAAU,GAC7C3C,EAAE,OAAO,SAAS9H,CAAK,GACvB8H,EAAE,OAAO,cAAc,SAAS2C,CAAU,EAEhD,EAIA,0BAA2B,MAAOjK,EAAqBrC,IAAqC,CAC1F0I,EAAI,CAAE,mBAAoB,GAAM,EAChC,GAAI,CAEF,MAAMmC,IADW,MAAMlG,GAAgB,eAAetC,EAAarC,CAAO,GAC9C,WAAa,IAAI,IAAIgK,EAAkB,EAGnE,OAAAtB,EAAKQ,IAEI,CAAE,UAAW,CAAC,GADEA,EAAM,UAAU,OAAQlC,GAAMA,EAAE,cAAgB3E,CAAW,EAC1C,GAAGwI,CAAS,EAAG,mBAAoB,IAC5E,EAEMA,CACT,MAAgB,CAEd,OAAAnC,EAAI,CAAE,mBAAoB,GAAO,EAC1B,EACT,CACF,EAEA,kBAAmB,MAAOtG,GAAe,CACvC,GAAI,CACF,MAAM9B,EAAW,MAAMqE,GAAgB,QAAQvC,CAAE,EACjD,GAAI,CAAC9B,EAAS,SAAU,OAAO,KAE/B,MAAMsE,EAAWoF,GAAmB1J,EAAS,QAAQ,EAGrD,OAAAoI,EAAKQ,IAII,CAAE,UAHgBA,EAAM,UAAU,KAAMlC,GAAMA,EAAE,KAAO5E,CAAE,EAC5D8G,EAAM,UAAU,IAAKlC,GAAOA,EAAE,KAAO5E,EAAKwC,EAAWoC,CAAE,EACvD,CAAC,GAAGkC,EAAM,UAAWtE,CAAQ,CACb,EACrB,EAEMA,CACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,YAAa,MAAOvC,EAAakK,IAAiB,CAChD,GAAI,CACF,MAAMjM,EAAW,MAAMqE,GAAgB,OAAOtC,EAAa,CACzD,SAAUkK,EAAa,SACvB,UAAWA,EAAa,UACxB,WAAYA,EAAa,WACzB,SAAUA,EAAa,SACvB,UAAWA,EAAa,UACxB,aAAcA,EAAa,aAC3B,gBAAiBA,EAAa,gBAC9B,iBAAkBA,EAAa,iBAC/B,iBAAkBA,EAAa,iBAC/B,MAAOA,EAAa,MACpB,MAAOA,EAAa,MACpB,YAAaA,EAAa,YAC1B,QAASA,EAAa,QACvB,EACD,GAAIjM,EAAS,SAAU,CACrB,MAAMkM,EAAcxC,GAAmB1J,EAAS,QAAQ,EACxD,OAAAoI,EAAKQ,IAAW,CAAE,UAAW,CAAC,GAAGA,EAAM,UAAWsD,CAAW,GAAI,EAC1DA,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,eAAgB,MAAOpK,EAAI3C,IAAS,CAClC,GAAI,CACF,MAAMkF,GAAgB,OAAOvC,EAAI3C,CAAW,EAC5CiJ,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKlC,GAC9BA,EAAE,KAAO5E,EAAK,CAAE,GAAG4E,EAAG,GAAGvH,EAAM,UAAW,IAAI,OAAO,eAAkBuH,CAAA,CACzE,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,eAAgB,MAAO5E,GAAO,CAC5B,GAAI,CACF,MAAMuC,GAAgB,OAAOvC,CAAE,EAC/BsG,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,OAAQlC,GAAMA,EAAE,KAAO5E,CAAE,GACpD,CACJ,MAAgB,CAEhB,CACF,EAEA,gBAAiB,MAAOA,EAAI3C,IAAS,CACnC,GAAI,CACF,MAAMkF,GAAgB,QAAQvC,EAAI3C,CAAI,EACtCiJ,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKlC,GAC9BA,EAAE,KAAO5E,EAAK,CAAE,GAAG4E,EAAG,SAAU,GAAO,aAAcvH,EAAK,aAAc,eAAgBA,EAAK,QAAWuH,CAAA,CAC1G,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,wBAA0B3E,GACjBsG,EAAA,EAAM,UAAU,OAAQ3B,GAAMA,EAAE,cAAgB3E,CAAW,EAKpE,wBAAyB,MAAO2B,EAAoBhE,IAAqD,CACvG0I,EAAI,CAAE,kBAAmB,GAAM,EAC/B,GAAI,CAEF,MAAMkC,IADW,MAAMnG,GAAoB,cAAcT,EAAYhE,CAAO,GACjD,UAAY,IAAI,IAAI4J,EAAiB,EAGhE,OAAAlB,EAAKQ,IAEI,CAAE,iBAAkB,CAAC,GADNA,EAAM,iBAAiB,OAAQO,GAAMA,EAAE,aAAezF,CAAU,EACxC,GAAG4G,CAAQ,EAAG,kBAAmB,IAChF,EAEMA,CACT,MAAgB,CAEd,OAAAlC,EAAI,CAAE,kBAAmB,GAAO,EACzB,EACT,CACF,EAEA,mBAAoB,MAAO+D,GAAgB,CACzC,GAAI,CACF,MAAMnM,EAAW,MAAMmE,GAAoB,OAAO,CAChD,YAAagI,EAAY,YACzB,WAAYA,EAAY,WACxB,eAAgBA,EAAY,eAC5B,UAAWA,EAAY,UACvB,gBAAiBA,EAAY,gBAC7B,UAAWA,EAAY,UACvB,eAAgBA,EAAY,eAC5B,QAASA,EAAY,QACrB,YAAaA,EAAY,YAC1B,EACD,GAAInM,EAAS,QAAS,CACpB,MAAMoM,EAAa9C,GAAkBtJ,EAAS,OAAO,EACrD,OAAAoI,EAAKQ,IAAW,CAAE,iBAAkB,CAAC,GAAGA,EAAM,iBAAkBwD,CAAU,GAAI,EACvEA,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,sBAAuB,MAAOtK,EAAI3C,IAAS,CACzC,GAAI,CACF,MAAMgF,GAAoB,OAAOrC,EAAI3C,CAAW,EAChDiJ,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAK,GAC5C,EAAE,KAAO9G,EAAK,CAAE,GAAG,EAAG,GAAG3C,EAAM,UAAW,IAAI,OAAO,eAAkB,EACzE,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,uBAAyB2C,GAChBuG,EAAA,EAAM,iBAAiB,KAAMc,GAAMA,EAAE,KAAOrH,CAAE,EAGvD,8BAAgCC,GACvBsG,EAAA,EAAM,iBAAiB,KAAMc,GAAMA,EAAE,cAAgBpH,CAAW,EAGzE,8BAAgC2B,GACvB2E,EAAA,EAAM,iBAAiB,OAAQc,GAAMA,EAAE,aAAezF,CAAU,EAGzE,aAAc,MAAOhE,GAAwD,CAC3E,GAAI,CAEF,QADiB,MAAMyE,GAAoB,WAAWzE,CAAO,GAC5C,SAAW,IAAI,IAAI4J,EAAiB,CACvD,MAAgB,CAEd,MAAO,EACT,CACF,EAEA,WAAY,CAAC+C,EAAU,IACdhE,IACJ,iBAAiB,OAAQc,GAAMA,EAAE,YAAckD,CAAO,EACtD,KAAK,CAAClD,EAAGH,IAAMA,EAAE,YAAcG,EAAE,WAAW,EAIjD,iBAAkB,IAAM,CACtB,KAAM,CAAE,UAAAS,EAAW,WAAAS,EAAY,UAAAE,EAAW,OAAAS,EAAQ,iBAAAsB,CAAA,EAAqBjE,EAAA,EACjEkE,EAAYD,EAAiB,OAAO,CAAC7B,EAAKtB,IAAMsB,EAAMtB,EAAE,YAAa,CAAC,EACtEqD,EAAuB5C,EAAU,OAAO,CAACa,EAAKzB,IAAMyB,EAAMzB,EAAE,eAAgB,CAAC,EAEnF,MAAO,CACL,eAAgBY,EAAU,OAC1B,gBAAiBS,EAAW,OAC5B,eAAgBE,EAAU,OAC1B,YAAaS,EAAO,OACpB,UAAAuB,EACA,kBAAmB3C,EAAU,OAAS,EAAI4C,EAAuB5C,EAAU,OAAS,EAExF,IAEF,CACE,KAAM,iBACN,QAAS,EAGT,WAAY,KAAO,IAKnB,QAAS,CAAC6C,EAAyBC,IAAqB,CACtD,MAAM9D,EAAQ6D,EAIRE,EAA8BC,GAA4B,CAC9D,GAAI,CAACA,EAAS,MAAO,GAGrB,MAAMC,EAAUD,EAAQ,MAAM,oDAAoD,EAClF,GAAIC,EAGF,OAFaA,EAAQ,CAAC,GAAKA,EAAQ,CAAC,GAAG,cAE5B,QAAQ,MAAO,GAAG,EAAE,QAAQ,MAAO,GAAG,EAInD,MAAMC,EAAUF,EAAQ,MAAM,sCAAsC,EACpE,OAAIE,EACUA,EAAQ,CAAC,EAAE,cACZ,QAAQ,MAAO,GAAG,EAAE,QAAQ,MAAO,GAAG,EAG5C,EACT,EAEA,GAAIlE,EAAM,UAAW,CAEnB,MAAMmE,MAAc,IACpBnE,EAAM,UAAYA,EAAM,UAAU,IAAI,CAACpF,EAAUwJ,IAAU,CACzD,IAAIC,EAAkB,CAAE,GAAGzJ,CAAA,EAiB3B,IAdI,CAACyJ,EAAgB,IAAMF,EAAQ,IAAIE,EAAgB,EAAE,KACvDA,EAAgB,GAAK,YAAY,KAAK,KAAK,IAAID,CAAK,IAEtDD,EAAQ,IAAIE,EAAgB,EAAE,EAGzBA,EAAgB,aACnBA,EAAgB,WAAaA,EAAgB,MAAM,SAAS,UAAU,EAAI,KAC7CA,EAAgB,MAAM,SAAS,UAAU,EAAI,KAC7CA,EAAgB,MAAM,SAAS,SAAS,EAAI,KAC5C,MAI3B,CAACA,EAAgB,eAAgB,CACnC,MAAMC,EAAkBP,EAA2BM,EAAgB,SAAW,EAAE,EAChFA,EAAgB,eAAiBC,GAAmB,GAAGF,EAAQ,CAAC,GAClE,CAEA,OAAOC,CACT,CAAC,CACH,CACA,OAAOrE,CACT,EACF,CAEJ,ykCCx1CMuE,GAAmB,0FAGzB,SAASC,GAAsBC,EAAmC,CAChE,MAAMC,EAAU,IAAI,QAAQ,EAAKD,EAAa,OAAS,GAAM,CAAC,EACxDE,GAAUF,EAAeC,GAAS,QAAQ,KAAM,GAAG,EAAE,QAAQ,KAAM,GAAG,EACtEE,EAAU,OAAO,KAAKD,CAAM,EAC5BE,EAAc,IAAI,WAAWD,EAAQ,MAAM,EACjD,QAASE,EAAI,EAAGA,EAAIF,EAAQ,OAAQ,EAAEE,EACpCD,EAAYC,CAAC,EAAIF,EAAQ,WAAWE,CAAC,EAEvC,OAAOD,EAAY,MACrB,CAEA,MAAME,EAAwB,CAK5B,aAAc,CAJNC,GAAA,kBAAqC,WACrCA,GAAA,sBAAmD,MACnDA,GAAA,wBAA4C,MAG9C,iBAAkB,SACpB,KAAK,WAAa,aAAa,YAEjC,KAAK,mBACP,CAGA,MAAc,mBAAmC,CAC/C,GAAI,kBAAmB,UACrB,GAAI,CACF,KAAK,eAAiB,MAAM,UAAU,cAAc,MAIpD,KAAK,iBAAmB,MAAM,KAAK,eAAe,YAAY,kBAC1D,KAAK,gBAGX,MAAgB,CAEhB,CAEJ,CAGA,aAAuB,CACrB,MAAO,iBAAkB,QAAU,kBAAmB,WAAa,gBAAiB,MACtF,CAGA,iCAA2C,CACzC,MAAO,iBAAkB,MAC3B,CAGA,eAAwC,CACtC,OAAO,KAAK,UACd,CAGA,cAAwB,CACtB,OAAO,KAAK,mBAAqB,IACnC,CAGA,MAAM,mBAAsC,CAC1C,GAAI,CAAC,KAAK,kCAER,MAAO,GAGT,GAAI,CACF,MAAMC,EAAa,MAAM,aAAa,oBACtC,YAAK,WAAaA,EACXA,IAAe,SACxB,MAAgB,CAEd,MAAO,EACT,CACF,CAGA,MAAM,WAA8C,CA+BlD,GA1BI,CAAC,KAAK,eAUN,KAAK,aAAe,WAIlB,CAFY,MAAM,KAAK,sBASxB,KAAK,gBAER,MAAM,KAAK,oBAGT,CAAC,KAAK,gBAER,OAAO,KAIT,GAAI,CAEF,MAAMC,EAAc,MAAM,KAAK,eAAe,YAAY,kBAC1D,OAAIA,EAEF,KAAK,iBAAmBA,EAIxB,KAAK,iBAAmB,MAAM,KAAK,eAAe,YAAY,UAAU,CACtE,gBAAiB,GACjB,qBAAsBV,GAAsBD,EAAgB,EAC7D,EAQH,MAAM,KAAK,yBAAyB,KAAK,gBAAgB,EAElD,KAAK,gBACd,MAAgB,CAOd,OAAO,IACT,CACF,CAGA,MAAM,aAAgC,CACpC,GAAI,CAAC,KAAK,iBACR,MAAO,GAGT,GAAI,CACF,aAAM,KAAK,iBAAiB,cAG5B,MAAM,KAAK,+BAEX,KAAK,iBAAmB,KAEjB,EACT,MAAgB,CAEd,MAAO,EACT,CACF,CAGA,MAAc,yBAAyBY,EAA+C,CACpF,GAAI,CACF,MAAMC,EAAmBD,EAAa,SAOhChL,EAAS,MAAMvD,EAAW,sBAAuB,CACrD,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,SAAUwO,EAAiB,SAC3B,KAAMA,EAAiB,KACxB,EACF,CAEH,OAAS/N,EAAO,CAGd,MAAMA,CACR,CACF,CAGA,MAAc,8BAA8C,CAC1D,GAAI,CACF,MAAMT,EAAW,wBAAyB,CACxC,OAAQ,OACT,CAEH,MAAgB,CAEhB,CACF,CAGA,iBAA2C,CACzC,OAAO,KAAK,gBACd,CAGA,MAAM,KAAKE,EAAgE,CAOzE,GANI,CAAC,KAAK,eAMN,KAAK,aAAe,WAElB,CADY,MAAM,KAAK,oBAGzB,OAAO,KAIX,GAAI,CACF,MAAMuO,EAAe,IAAI,aAAavO,EAAQ,MAAO,CACnD,KAAMA,EAAQ,KACd,KAAMA,EAAQ,MAAQ,eACtB,IAAKA,EAAQ,IACb,mBAAoBA,EAAQ,oBAAsB,GAClD,KAAMA,EAAQ,KACf,EAGD,OAAAuO,EAAa,QAAWC,GAAU,CAChCA,EAAM,iBACN,OAAO,QAGHxO,EAAQ,MAAM,MAChB,OAAO,SAAS,KAAOA,EAAQ,KAAK,KAGtCuO,EAAa,OACf,EAEOA,CACT,MAAgB,CAEd,OAAO,IACT,CACF,CAGA,MAAM,uBAAuBE,EAAgCC,EAAsB/I,EAAkC,CACnH,MAAM,KAAK,KAAK,CACd,MAAO,sBACP,KAAM,UAAU8I,CAAa,KAAKC,CAAY,yEAC9C,IAAK,qBAAqB/I,CAAS,GACnC,mBAAoB,GACpB,KAAM,CACJ,UAAAA,EACA,IAAK,IACP,CACD,CACH,CAGA,MAAM,yBAAyBgJ,EAAe3F,EAAiB1F,EAAuC,CACpG,MAAM,KAAK,KAAK,CACd,MAAO,MAAMqL,CAAK,GAClB,KAAM3F,EACN,IAAK,gBAAgB1F,CAAc,GACnC,mBAAoB,GACpB,KAAM,CACJ,eAAAA,EACA,IAAK,IACP,CACD,CACH,CAGA,MAAM,cAAcqL,EAAeC,EAAcC,EAAcvL,EAAuC,CACpG,MAAM,KAAK,KAAK,CACd,MAAO,sBACP,KAAM,GAAGqL,CAAK;AAAA,EAAKC,CAAI,MAAMC,CAAI,GACjC,IAAK,WAAWvL,CAAc,GAC9B,mBAAoB,GACpB,KAAM,CACJ,eAAAA,EACA,IAAK,YACP,CACD,CACH,CAGA,MAAM,iBAAiB8D,EAAmB0H,EAAwC,CAChF,MAAM,KAAK,KAAK,CACd,MAAO,8BACP,KAAM,mCAAmCA,CAAe,mCACxD,IAAK,eAAe1H,CAAS,GAC7B,mBAAoB,GACpB,KAAM,CACJ,IAAK,YACP,CACD,CACH,CAGA,MAAM,iBAAiBA,EAAmB0H,EAAwC,CAChF,MAAM,KAAK,KAAK,CACd,MAAO,2BACP,KAAM,wCAAwCA,CAAe,8BAC7D,IAAK,eAAe1H,CAAS,GAC7B,mBAAoB,GACpB,KAAM,CACJ,IAAK,YACP,CACD,CACH,CAGA,MAAM,qBAAqBA,EAAmB2H,EAAkC,CAC9E,MAAM,KAAK,KAAK,CACd,MAAO,iCACP,KAAM,YAAYA,CAAS,8DAC3B,IAAK,mBAAmB3H,CAAS,GACjC,mBAAoB,GACpB,KAAM,CACJ,IAAK,YACP,CACD,CACH,CAGA,MAAM,oBAAoBA,EAAmB0H,EAAwC,CACnF,MAAM,KAAK,KAAK,CACd,MAAO,6BACP,KAAM,kCAAkCA,CAAe,gBACvD,IAAK,kBAAkB1H,CAAS,GAChC,mBAAoB,GACpB,KAAM,CACJ,IAAK,YACP,CACD,CACH,CAGA,MAAM,mBAAmBuH,EAAe1L,EAAiBK,EAAwB0L,EAAwC,SAAyB,CAChJ,MAAMC,EAAOD,IAAa,SAAW,KAAO,KAC5C,MAAM,KAAK,KAAK,CACd,MAAO,GAAGC,CAAI,IAAIN,CAAK,GACvB,KAAM1L,EAAQ,OAAS,IAAMA,EAAQ,UAAU,EAAG,GAAG,EAAI,MAAQA,EACjE,IAAK,gBAAgBK,CAAc,GACnC,mBAAoB0L,IAAa,SACjC,KAAM,CACJ,eAAA1L,EACA,SAAA0L,EACA,IAAK,iBACL,KAAM,eACR,CACD,CACH,CAGA,MAAM,sBAAsBP,EAAgCE,EAAehJ,EAAkC,CAC3G,MAAM,KAAK,KAAK,CACd,MAAO,4BACP,KAAM,UAAU8I,CAAa,KAAKE,CAAK,GACvC,IAAK,oBAAoBhJ,CAAS,GAClC,mBAAoB,GACpB,KAAM,CACJ,UAAAA,EACA,IAAK,IACP,CACD,CACH,CAGA,MAAM,qBAAqB8I,EAAgCC,EAAsB/I,EAAkC,CACjH,MAAM,KAAK,KAAK,CACd,MAAO,qBACP,KAAM,UAAU8I,CAAa,KAAKC,CAAY,gBAC9C,IAAK,mBAAmB/I,CAAS,GACjC,mBAAoB,GACpB,KAAM,CACJ,UAAAA,EACA,IAAK,IACP,CACD,CACH,CACF,CAGO,MAAMuJ,GAAoB,IAAIjB,GChQ/BkB,GAAa,IAAM,KAAK,SAAS,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,EAGzDC,GAA4B,IAAuB,CACvD,MAAMC,MAAU,KACVC,EAAa,IAAI,KAAKD,EAAI,UAAY,MAAc,GAAK,GAAI,EAEnE,MAAO,CACL,GAAI,cACJ,WAAY,YACZ,aAAc,uBACd,cAAe,gBACf,kBAAmB,KACnB,gBAAiB,sBACjB,YAAa,QACb,YAAa,aACb,aAAc,gBACd,WAAY,OACZ,QAAS,uBACT,OAAQ,SACR,UAAWA,EAAI,cACf,WAAYC,EAAW,cACvB,QAAS,IACT,YAAa,EACb,UAAWD,EAAI,cACf,UAAWA,EAAI,aAAY,CAE/B,EAGME,GAA+B,CACnC,YAAa,eACb,WAAY,YACZ,eAAgB,iCAChB,aAAc,oBACd,YAAa,SACb,kBAAmB,QACnB,gBAAiB,QACjB,WAAY,GACZ,YAAa,GACb,iBAAkB,GAClB,eAAgB,GAChB,iBAAkB,GAClB,mBAAoB,GACpB,kBAAmB,EACrB,EAEaC,EAAehH,GAAA,EAC1BC,GACE,CAACC,EAAKC,KAAS,CACb,UAAW,GACX,SAAU,GACV,cAAe,GACf,aAAc,GACd,SAAU4G,GACV,iBAAkB,GAClB,cAAe,GACf,cAAe,GACf,SAAU,GACV,iBAAkB,CAACH,IAA2B,EAC9C,gBAAiB,GACjB,mBAAoB,GACpB,kBAAmB,GACnB,mBAAoB,GACpB,kBAAmB,GACnB,oBAAqB,GAGrB,cAAe,MAAO7J,EAAiBE,IAAsB,CAC3DiD,EAAI,CAAE,kBAAmB,GAAM,EAC/B,GAAI,CAIF,MAAM+G,IAHW,MAAMjK,EAAY,OAAOD,EAAQE,CAAQ,GAEhC,UAAY,IACK,IAAKuB,IAAY,CAC1D,GAAIA,EAAE,GAEN,OAAQA,EAAE,gBAAkBA,EAAE,QAAU,IAAIA,EAAE,IAAI,UAAU,EAAG,CAAC,EAAE,eAAiB,QAAQ,GAC3F,MAAOA,EAAE,MACT,YAAaA,EAAE,aAAe,GAC9B,SAAUA,EAAE,YACZ,OAAQA,EAAE,OACV,SAAUA,EAAE,UAAY,SACxB,WAAYA,EAAE,YACd,aAAcA,EAAE,eAAiB,cACjC,cAAeA,EAAE,gBAAkB,GACnC,QAASA,EAAE,SAAW,GACtB,UAAWA,EAAE,WAAa,GAC1B,WAAYA,EAAE,YACd,aAAcA,EAAE,cAChB,cAAeA,EAAE,eACjB,WAAYA,EAAE,YACd,cAAeA,EAAE,aAAeA,EAAE,aAAa,MAAM,GAAG,EAAE,CAAC,EAAI,OAC/D,cAAeA,EAAE,aAAeA,EAAE,aAAa,MAAM,GAAG,EAAE,CAAC,GAAG,UAAU,EAAG,CAAC,EAAI,OAChF,UAAWA,EAAE,WACb,WAAYA,EAAE,YACd,WAAYA,EAAE,YACd,UAAWA,EAAE,WACb,YAAaA,EAAE,aACf,WAAYA,EAAE,YACd,OAAQA,EAAE,OACV,SAAUA,EAAE,SACZ,aAAcA,EAAE,cAChB,WAAYA,EAAE,YACd,aAAcA,EAAE,cAEhB,SAAUA,EAAE,YAAc,GAAKA,EAAE,YAAc,GAC/C,SAAUA,EAAE,UACZ,gBAAiBA,EAAE,mBAAqB,GACxC,EAIF0B,EAAKQ,GAAU,CACb,MAAM/J,EAAkB+J,EAAM,SAAS,UAAYlC,EAAE,GAAG,WAAW,OAAO,CAAC,EAM3E,MAAO,CAAE,SAJc,CACrB,GAAG7H,EACH,GAAGsQ,EAAe,OAAOC,GAAU,CAACvQ,EAAgB,KAAKuL,GAAKA,EAAE,KAAOgF,EAAO,EAAE,CAAC,GAEhD,kBAAmB,GACxD,CAAC,CACH,MAAgB,CAEdhH,EAAI,CAAE,kBAAmB,GAAO,CAClC,CACF,EAGA,eAAgB,MAAOrD,EAAU,KAAU,CAEzCqD,EAAI,CAAE,mBAAoB,GAAM,EAChC,GAAI,CAIF,MAAMiH,GAHW,MAAMvK,GAAa,OAAOC,CAAO,GAGL,UAAU,IAAKkF,IAAY,CACtE,GAAIA,EAAE,GACN,KAAMA,EAAE,KACR,MAAOA,EAAE,MACT,MAAOA,EAAE,MACT,eAAgBA,EAAE,eAClB,OAAQA,EAAE,QAAU,UACpB,OAAQA,EAAE,QAAU,EACpB,eAAgBA,EAAE,iBAAmB,EACrC,eAAgBA,EAAE,iBAAmB,EACrC,cAAeA,EAAE,gBAAkB,EACnC,kBAAmBA,EAAE,qBAAuB,EAC5C,UAAWA,EAAE,YACb,EAEF7B,EAAI,CAAE,UAAWiH,EAAiB,mBAAoB,GAAO,CAC/D,MAAgB,CAEdjH,EAAI,CAAE,mBAAoB,GAAO,CACnC,CACF,EAGA,cAAe,MAAOkH,EAAW,KAAU,CACzClH,EAAI,CAAE,kBAAmB,GAAM,EAC/B,GAAI,CAMF,MAAMmH,GAJWD,EACb,MAAM9N,EAAY,SAClB,MAAMA,EAAY,iBAEqB,SAAS,IAAKgO,IAAY,CACnE,GAAIA,EAAE,GACN,QAASA,EAAE,QACX,UAAWA,EAAE,YAAc,GAC3B,WAAYA,EAAE,aAAe,GAC7B,UAAWA,EAAE,WAAa,GAC1B,QAASA,EAAE,SAAW,GACtB,YAAaA,EAAE,aACf,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,KAAMA,EAAE,MAAQ,OAChB,KAAOA,EAAE,cAAgB,MACzB,UAAYA,EAAE,YAAc,aAC5B,YAAaA,EAAE,cAAgB,OAC/B,YAAaA,EAAE,cAAgB,OAC/B,MAAOA,EAAE,OAAS,OAClB,UAAWA,EAAE,WACb,UAAWA,EAAE,YAAc,QAC3B,EACFpH,EAAI,CAAE,SAAUmH,EAAgB,kBAAmB,GAAO,CAC5D,MAAgB,CAEdnH,EAAI,CAAE,kBAAmB,GAAO,CAClC,CACF,EAGA,gBAAiB,SAAY,CAC3BA,EAAI,CAAE,oBAAqB,GAAM,EACjC,GAAI,CAGF,MAAMqH,IAFW,MAAMxN,GAAc,UACd,OAAS,IACa,IAAKyN,IAAY,CAC5D,GAAIA,EAAE,GACN,WAAYA,EAAE,QACd,aAAcA,EAAE,eAAiB,GACjC,cAAeA,EAAE,gBAAkB,GACnC,kBAAmBA,EAAE,oBAAsB,GAC3C,gBAAiBA,EAAE,kBAAoB,GACvC,YAAaA,EAAE,aACf,YAAaA,EAAE,cAAgB,OAC/B,aAAcA,EAAE,eAAiB,OACjC,oBAAqBA,EAAE,uBAAyB,OAChD,WAAYA,EAAE,YACd,UAAWA,EAAE,WACb,WAAYA,EAAE,YACd,QAASA,EAAE,SACX,YAAaA,EAAE,cAAgB,EAC/B,QAASA,EAAE,SACX,OAAQA,EAAE,OACV,MAAOA,EAAE,OAAS,OAClB,UAAWA,EAAE,WACb,UAAWA,EAAE,YAAc,OAC3B,UAAWA,EAAE,YAAc,OAC3B,UAAWA,EAAE,YAAc,OAC3B,iBAAkBA,EAAE,gBAAkB,QACtC,EACFtH,EAAI,CAAE,iBAAkBqH,EAAa,oBAAqB,GAAO,CACnE,MAAgB,CAEdrH,EAAI,CAAE,oBAAqB,GAAO,CACpC,CACF,EAGA,sBAAuB,MAAOjJ,GAAS,CACrC,GAAI,CAgBF,MAAMuQ,GAfW,MAAMzN,GAAc,OAAO,CAC1C,aAAc9C,EAAK,YACnB,aAAcA,EAAK,YACnB,cAAeA,EAAK,aACpB,sBAAuBA,EAAK,oBAC5B,YAAaA,EAAK,WAClB,WAAYA,EAAK,UACjB,YAAaA,EAAK,WAClB,cAAeA,EAAK,aACpB,eAAgBA,EAAK,cACrB,mBAAoBA,EAAK,kBACzB,iBAAkBA,EAAK,gBACvB,MAAOA,EAAK,MACb,GAEkB,KACbwQ,EAA2B,CAC/B,GAAID,EAAE,GACN,WAAYA,EAAE,SAAWvQ,EAAK,WAC9B,aAAcuQ,EAAE,eAAiBvQ,EAAK,aACtC,cAAeuQ,EAAE,gBAAkBvQ,EAAK,cACxC,kBAAmBuQ,EAAE,oBAAsBvQ,EAAK,kBAChD,gBAAiBuQ,EAAE,kBAAoBvQ,EAAK,gBAC5C,YAAauQ,EAAE,aACf,YAAaA,EAAE,cAAgB,OAC/B,aAAcA,EAAE,eAAiB,OACjC,oBAAqBA,EAAE,uBAAyB,OAChD,WAAYA,EAAE,YACd,UAAWA,EAAE,WACb,WAAYA,EAAE,YACd,QAASA,EAAE,SACX,YAAaA,EAAE,cAAgB,EAC/B,QAASA,EAAE,SACX,OAAQA,EAAE,OACV,MAAOA,EAAE,OAAS,OAClB,UAAWA,EAAE,YAGf,OAAAtH,EAAKQ,IAAW,CACd,iBAAkB,CAAC+G,EAAS,GAAG/G,EAAM,gBAAgB,GACrD,EAEK+G,CACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,sBAAuB,MAAO7N,EAAI8N,EAAWC,EAAeC,EAAe1N,IAAW,CACpF,GAAI,CACF,MAAMH,GAAc,OAAOH,EAAIM,CAAM,EACrCgG,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAKzG,GAC5CA,EAAK,KAAOL,EACR,CACE,GAAGK,EACH,OAAQ,UACR,UAAW,IAAI,OAAO,cACtB,UAAAyN,EACA,cAAAC,EACA,cAAAC,EACA,iBAAkB1N,EAClB,UAAW,IAAI,OAAO,aAAY,EAEpCD,CAAA,CACN,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,mBAAoB,CAACL,EAAIiO,IAA+B,CAMtD,IAAI5N,EADUkG,EAAA,EACG,iBAAiB,KAAMqH,GAAMA,EAAE,KAAO5N,CAAE,EAsBzD,GAlBI,CAACK,GAAQ4N,IAEX5N,EAAO,CAAE,GAAG4N,EAAU,YAAa,EAAG,OAAQ,UAG9C3H,EAAKQ,IAAW,CACd,iBAAkB,CAACzG,EAAO,GAAGyG,EAAM,gBAAgB,GACnD,GAWA,CAACzG,GAAQA,EAAK,SAAW,SAE3B,MAAO,GAGT,MAAM4M,MAAU,KAChB,GAAIA,EAAM,IAAI,KAAK5M,EAAK,UAAU,EAGhC,OAAAiG,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAK8G,GAC5CA,EAAE,KAAO5N,EAAK,CAAE,GAAG4N,EAAG,OAAQ,UAAoB,UAAWX,EAAI,eAAkBW,CAAA,CACrF,EACA,EACK,GAGT,MAAMM,EAAU7N,EAAK,YAAc,EAC7B8N,EAAYD,GAAW7N,EAAK,QAAU,OAAS,SAQrD,OAAAiG,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAK8G,GAC5CA,EAAE,KAAO5N,EACL,CACE,GAAG4N,EACH,YAAaM,EACb,OAAQC,EACR,WAAYlB,EAAI,cAChB,UAAWA,EAAI,aAAY,EAE7BW,CAAA,CACN,EACA,EAGK,EACT,EAEA,wBAA0BrN,GAAY,CAIpC,MAAM0M,MAAU,KAGhB,GAAI1M,EAAQ,WAAW,SAAS,EAE9B,GAAI,CACF,MAAM6N,EAAa7N,EAAQ,UAAU,CAAC,EAEhC8N,EAAU,KAAKD,CAAU,EAEzBE,EAAQ,IAAI,WAAWD,EAAQ,MAAM,EAC3C,QAASzC,EAAI,EAAGA,EAAIyC,EAAQ,OAAQzC,IAClC0C,EAAM1C,CAAC,EAAIyC,EAAQ,WAAWzC,CAAC,EAIjC,MAAM2C,EADU,IAAI,YAAY,OAAO,EACX,OAAOD,CAAK,EAClCE,EAAY,KAAK,MAAMD,CAAW,EAIlClO,EAAwB,CAC5B,GAAImO,EAAU,EACd,WAAY,aACZ,aAAcA,EAAU,GACxB,cAAeA,EAAU,GACzB,kBAAmBA,EAAU,GAC7B,gBAAiBA,EAAU,GAC3B,YAAaA,EAAU,GACvB,YAAaA,EAAU,IAAM,OAC7B,aAAcA,EAAU,IAAM,OAC9B,oBAAqBA,EAAU,IAAM,OACrC,WAAYA,EAAU,GACtB,UAAW,IAAI,KAAKA,EAAU,EAAE,EAAE,cAClC,WAAY,IAAI,KAAKA,EAAU,EAAE,EAAE,cACnC,QAASA,EAAU,GACnB,YAAa,EACb,QAAAjO,EACA,OAAQ,SACR,UAAW,IAAI,KAAKiO,EAAU,EAAE,EAAE,aAAY,EAIhD,GAAIvB,EAAI,UAAYuB,EAAU,GAE5B,MAAO,CAAE,MAAO,GAAO,KAAAnO,EAAM,MAAO,WAItC,GAAI4M,EAAI,UAAYuB,EAAU,GAE5B,MAAO,CAAE,MAAO,GAAO,KAAAnO,EAAM,MAAO,iBAKtC,MAAMoO,EADQlI,EAAA,EACU,iBAAiB,UAAYqH,EAAE,KAAOY,EAAU,CAAC,EACnEE,EAAYD,EAAU,OAAS,EAAIA,EAAU,CAAC,EAAI,KAExD,GAAIC,EAAW,CASb,GAAIA,EAAU,SAAW,UAEvB,MAAO,CAAE,MAAO,GAAO,KAAM,CAAE,GAAGrO,EAAM,GAAGqO,CAAA,EAAa,MAAO,WAGjE,GAAIA,EAAU,SAAW,QAAUA,EAAU,aAAeF,EAAU,GAEpE,MAAO,CAAE,MAAO,GAAO,KAAM,CAAE,GAAGnO,EAAM,GAAGqO,CAAA,EAAa,MAAO,gBAIjErO,EAAK,YAAcqO,EAAU,YAC7BrO,EAAK,OAASqO,EAAU,MAC1B,CAGA,MAAO,CAAE,MAAO,GAAM,KAAArO,EACxB,MAAc,CAEZ,MAAO,CAAE,MAAO,GAAO,MAAO,UAChC,CAeF,MAAMA,EAXQkG,EAAA,EAWK,iBAAiB,KAAMqH,GAAMA,EAAE,UAAYrN,CAAO,EAErE,OAAKF,EAgBD4M,EAAM,IAAI,KAAK5M,EAAK,UAAU,GAG5BA,EAAK,SAAW,UAClBiG,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAK,GAC5C,EAAE,KAAOzG,EAAK,GAAK,CAAE,GAAG,EAAG,OAAQ,UAAoB,UAAW4M,EAAI,eAAkB,EAC1F,EACA,EAEG,CAAE,MAAO,GAAO,KAAA5M,EAAM,MAAO,YAIlC4M,EAAM,IAAI,KAAK5M,EAAK,SAAS,EAExB,CAAE,MAAO,GAAO,KAAAA,EAAM,MAAO,iBAIlCA,EAAK,SAAW,UAEX,CAAE,MAAO,GAAO,KAAAA,EAAM,MAAO,WAGlCA,EAAK,SAAW,OAEX,CAAE,MAAO,GAAO,KAAAA,EAAM,MAAO,gBAGlCA,EAAK,SAAW,UAEX,CAAE,MAAO,GAAO,KAAAA,EAAM,MAAO,WAIlCA,EAAK,aAAeA,EAAK,QAEpB,CAAE,MAAO,GAAO,KAAAA,EAAM,MAAO,oBAI/B,CAAE,MAAO,GAAM,KAAAA,CAAA,EAxDb,CAAE,MAAO,GAAO,MAAO,UAyDlC,EAEA,8BAAgCV,GAAe,CAE7C,MAAMsN,MAAU,KAMhB,OALc1G,EAAA,EACY,iBAAiB,KACxCqH,GAAMA,EAAE,aAAejO,GAAciO,EAAE,SAAW,UAAYX,EAAM,IAAI,KAAKW,EAAE,UAAU,IAI1FtH,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAK,GAC5C,EAAE,aAAenH,GAAc,EAAE,SAAW,UAAYsN,EAAM,IAAI,KAAK,EAAE,UAAU,EAC/E,CAAE,GAAG,EAAG,OAAQ,UAAoB,UAAWA,EAAI,eACnD,EACN,EACA,EAGG1G,EAAA,EAAM,iBAAiB,OAAQqH,GAAMA,EAAE,aAAejO,CAAU,CACzE,EAEA,uBAAwB,IAAM,CAE5B,MAAMsN,MAAU,KAMhB,OALc1G,EAAA,EACY,iBAAiB,KACxCqH,GAAMA,EAAE,SAAW,UAAYX,EAAM,IAAI,KAAKW,EAAE,UAAU,IAI3DtH,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAK8G,GAC5CA,EAAE,SAAW,UAAYX,EAAM,IAAI,KAAKW,EAAE,UAAU,EAChD,CAAE,GAAGA,EAAG,OAAQ,UAAoB,UAAWX,EAAI,eACnDW,CAAA,CACN,EACA,EAGGrH,IAAM,gBACf,EAEA,kBAAoBoI,GAAY,CAC9B,MAAMC,EAAyB,CAC7B,GAAGD,EACH,GAAI5B,GAAA,EACJ,UAAW,IAAI,OAAO,aAAY,EAEpCzG,EAAKQ,IAAW,CACd,gBAAiB,CAAC8H,EAAQ,GAAG9H,EAAM,eAAe,EAAE,MAAM,EAAG,GAAG,GAChE,CACJ,EAEA,mBAAqB+H,GAAiB,CACpC,MAAMC,EAAOvI,IAAM,gBACnB,OAAIsI,EACKC,EAAK,OAAQC,GAAMA,EAAE,eAAiBF,CAAY,EAEpDC,CACT,EAEA,oBAAqB,IAAM,CACzB,MAAMhI,EAAQP,EAAA,EACR0G,MAAU,KACV+B,EAAa,IAAI,KAAK/B,EAAI,cAAeA,EAAI,WAAYA,EAAI,SAAS,EAGtEgC,EAAQnI,EAAM,iBAAiB,IAAK8G,GACxCA,EAAE,SAAW,UAAYX,EAAM,IAAI,KAAKW,EAAE,UAAU,EAChD,CAAE,GAAGA,EAAG,OAAQ,WAChBA,CAAA,EAGAsB,EAAcD,EAAM,OAAQrB,GAAMA,EAAE,SAAW,QAAQ,EACvDuB,EAAYrI,EAAM,gBAAgB,OACrCiI,GAAM,IAAI,KAAKA,EAAE,SAAS,GAAKC,GAAcD,EAAE,SAAW,iBAC3D,OACIK,EAAeH,EAAM,OACxBrB,GAAM,IAAI,KAAKA,EAAE,SAAS,GAAKoB,CAAA,EAChC,OAEIK,EAAgB,CACpB,QAASH,EAAY,OAAQtB,GAAMA,EAAE,cAAgB,SAAS,EAAE,OAChE,MAAOsB,EAAY,OAAQtB,GAAMA,EAAE,cAAgB,OAAO,EAAE,OAC5D,KAAMsB,EAAY,OAAQtB,GAAMA,EAAE,cAAgB,MAAM,EAAE,OAC1D,MAAOsB,EAAY,OAAQtB,GAAMA,EAAE,cAAgB,OAAO,EAAE,QAGxD0B,EAAcxI,EAAM,gBAAgB,MAAM,EAAG,EAAE,EAErD,MAAO,CACL,YAAaoI,EAAY,OACzB,eAAgBC,EAChB,kBAAmBC,EACnB,cAAAC,EACA,YAAAC,CAAA,CAEJ,EAGA,WAAY,MAAOC,GAAgB,CAEjC,MAAMC,EAAS,QAAQzC,GAAA,CAAY,GAC7BE,EAAM,IAAI,OAAO,cAGjBwC,EAA6B,CACjC,GAAID,EACJ,QAASD,EAAY,QACrB,UAAWA,EAAY,UACvB,WAAYA,EAAY,WACxB,UAAWA,EAAY,UACvB,QAASA,EAAY,QACrB,YAAaA,EAAY,YACzB,MAAOA,EAAY,OAAS,GAC5B,MAAOA,EAAY,OAAS,GAC5B,MAAOA,EAAY,OAAS,GAC5B,KAAMA,EAAY,KAClB,KAAMA,EAAY,MAAQ,MAC1B,UAAWA,EAAY,WAAa,aACpC,YAAaA,EAAY,YACzB,YAAaA,EAAY,YACzB,MAAOA,EAAY,MACnB,UAAWtC,CAAA,EAIb3G,EAAKQ,IAAW,CAAE,SAAU,CAAC,GAAGA,EAAM,SAAU2I,CAAiB,GAAI,EAErE,GAAI,CAiBF,MAAM/B,GAfW,MAAMhO,EAAY,OAAO,CACxC,aAAc6P,EAAY,YAC1B,MAAOA,EAAY,MACnB,MAAOA,EAAY,MACnB,MAAOA,EAAY,MACnB,KAAMA,EAAY,KAClB,aAAcA,EAAY,KAC1B,WAAYA,EAAY,UACxB,aAAcA,EAAY,YAC1B,aAAcA,EAAY,YAC1B,MAAOA,EAAY,MACnB,WAAY,GACb,GAGkB,QACbG,EAAuB,CAC3B,GAAIhC,EAAE,GACN,QAASA,EAAE,QACX,UAAWA,EAAE,YAAc6B,EAAY,UACvC,WAAY7B,EAAE,aAAe6B,EAAY,WACzC,UAAW7B,EAAE,WAAa6B,EAAY,UACtC,QAAS7B,EAAE,SAAW6B,EAAY,QAClC,YAAa7B,EAAE,aACf,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,KAAMA,EAAE,MAAQ,OAChB,KAAOA,EAAE,cAAgB,MACzB,UAAYA,EAAE,YAAc,aAC5B,YAAaA,EAAE,cAAgB,OAC/B,YAAaA,EAAE,cAAgB,OAC/B,MAAOA,EAAE,OAAS,OAClB,UAAWA,EAAE,YAAcT,EAC3B,UAAWS,EAAE,YAAc,QAI7B,OAAApH,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAK6I,GAC5BA,EAAI,KAAOH,EAASE,EAAcC,CAAA,CACpC,EACA,EAEKD,CACT,MAAgB,CAGd,OAAApJ,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAAQ4G,GAAMA,EAAE,KAAO8B,CAAM,GACtD,EACK,IACT,CACF,EAEA,cAAe,MAAOxP,EAAI3C,IAAS,CAEjC,MAAMuS,EAAkBrJ,IAAM,SAAS,KAAMmH,GAAMA,EAAE,KAAO1N,CAAE,EAC9D,GAAK4P,EAGL,CAAAtJ,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAK4G,GAC5BA,EAAE,KAAO1N,EAAK,CAAE,GAAG0N,EAAG,GAAGrQ,EAAM,UAAW,IAAI,OAAO,eAAkBqQ,CAAA,CACzE,EACA,EAEF,GAAI,CAEF,MAAMhO,EAAY,OAAOM,EAAI,CAC3B,aAAc3C,EAAK,YACnB,MAAOA,EAAK,MACZ,MAAOA,EAAK,MACZ,MAAOA,EAAK,MACZ,KAAMA,EAAK,KACX,aAAcA,EAAK,KACnB,WAAYA,EAAK,UACjB,aAAcA,EAAK,YACnB,aAAcA,EAAK,YACnB,MAAOA,EAAK,MACb,CACH,MAAgB,CAGdiJ,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAK4G,GAC5BA,EAAE,KAAO1N,EAAK4P,EAAkBlC,CAAA,CAClC,EACA,CACJ,EACF,EAEA,cAAe,MAAO1N,GAAO,CAE3B,MAAM6P,EAAiBtJ,IAAM,SAAS,KAAMmH,GAAMA,EAAE,KAAO1N,CAAE,EAG7DsG,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAAQ4G,GAAMA,EAAE,KAAO1N,CAAE,GAClD,EAEF,GAAI,CAEF,MAAMN,EAAY,OAAOM,CAAE,CAC7B,MAAgB,CAGV6P,GACFvJ,EAAKQ,IAAW,CACd,SAAU,CAAC,GAAGA,EAAM,SAAU+I,CAAc,GAC5C,CAEN,CACF,EAEA,mBAAqBzN,GACZmE,EAAA,EAAM,SAAS,OAAQmH,GAAMA,EAAE,UAAYtL,CAAO,EAG3D,qBAAsB,MAAOtC,GAAgB,CAC3C,GAAI,CAEF,MAAM5B,EAAW,MAAMwB,EAAY,OAAOI,CAAW,EACrD,GAAI5B,EAAS,UAAYA,EAAS,SAAS,OAAS,EAAG,CACrD,MAAMwP,EAAIxP,EAAS,SAAS,CAAC,EAC7B,MAAO,CACL,GAAIwP,EAAE,GACN,QAASA,EAAE,QACX,UAAWA,EAAE,YAAc,GAC3B,WAAYA,EAAE,aAAe,GAC7B,UAAWA,EAAE,WAAa,GAC1B,QAASA,EAAE,SAAW,GACtB,YAAaA,EAAE,aACf,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,KAAMA,EAAE,MAAQ,OAChB,KAAOA,EAAE,cAAgB,MACzB,UAAYA,EAAE,YAAc,aAC5B,YAAaA,EAAE,cAAgB,OAC/B,YAAaA,EAAE,cAAgB,OAC/B,MAAOA,EAAE,OAAS,OAClB,UAAWA,EAAE,WACb,UAAWA,EAAE,YAAc,OAE/B,CACA,MACF,MAAgB,CAGd,MAAMoC,EAAahQ,EAAY,cAAc,QAAQ,OAAQ,EAAE,EAC/D,OAAOyG,EAAA,EAAM,SAAS,KAAMmH,GAC1BA,EAAE,YAAY,cAAc,QAAQ,OAAQ,EAAE,IAAMoC,CAAA,CAExD,CACF,EAEA,sBAAuB,MAAOhQ,GAAgB,CAC5C,GAAI,CACF,MAAM5B,EAAW,MAAMwB,EAAY,OAAOI,CAAW,EACrD,OAAI5B,EAAS,UAAYA,EAAS,SAAS,OAAS,EAC3CA,EAAS,SAAS,IAAKwP,IAAY,CACxC,GAAIA,EAAE,GACN,QAASA,EAAE,QACX,UAAWA,EAAE,YAAc,GAC3B,WAAYA,EAAE,aAAe,GAC7B,UAAWA,EAAE,WAAa,GAC1B,QAASA,EAAE,SAAW,GACtB,YAAaA,EAAE,aACf,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,MAAOA,EAAE,OAAS,GAClB,KAAMA,EAAE,MAAQ,OAChB,KAAOA,EAAE,cAAgB,MACzB,UAAYA,EAAE,YAAc,aAC5B,YAAaA,EAAE,cAAgB,OAC/B,YAAaA,EAAE,cAAgB,OAC/B,MAAOA,EAAE,OAAS,OAClB,UAAWA,EAAE,WACb,UAAWA,EAAE,YAAc,QAChB,EAER,EACT,MAAgB,CAEd,MAAO,EACT,CACF,EAGA,gBAAiB,MAAOqC,GAAqB,CAC3C,GAAI,CACF,KAAM,CAAE,iBAAAhP,CAAA,EAAqB,MAAAiP,EAAA,iCAAAjP,CAAA,QAAM,2BAAAkP,CAAA,EAAwB,wBAAAlP,CAAA,WAGrDmP,EAASH,EAAiB,OAC1BI,EAAU,CACd,MAAOJ,EAAiB,MACxB,QAASA,EAAiB,QAC1B,KAAMA,EAAiB,KACvB,SAAUA,EAAiB,SAC3B,WAAYA,EAAiB,UAC7B,YAAaG,GAAQ,KACrB,cAAeA,GAAQ,SACvB,mBAAoBA,GAAQ,WAC5B,gBAAiBA,GAAQ,SACzB,aAAcA,GAAQ,MACtB,cAAeA,GAAQ,cAAc,KAAK,GAAG,EAC7C,YAAaH,EAAiB,aAG1B9O,EAAS,MAAMF,EAAiB,OAAOoP,CAAO,EAGpD,aAAM5J,EAAA,EAAM,qBAG0B,CACpC,GAAGwJ,EACH,GAAK9O,EAAe,IAAM8L,GAAA,EAC1B,UAAW,IAAI,OAAO,cACtB,SAAU,GACV,SAAU,EAAC,CAKf,MAAgB,CAGd,MAAMqD,EAAgC,CACpC,GAAGL,EACH,GAAIhD,GAAA,EACJ,UAAW,IAAI,OAAO,cACtB,SAAU,GACV,SAAU,EAAC,EAEb,OAAAzG,EAAKQ,IAAW,CAAE,cAAe,CAACsJ,EAAiB,GAAGtJ,EAAM,aAAa,GAAI,EACtEsJ,CACT,CACF,EAEA,mBAAoB,MAAOpQ,EAAI3C,IAAS,CAEtCiJ,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,IAAK,GACtC,EAAE,KAAO9G,EAAK,CAAE,GAAG,EAAG,GAAG3C,GAAS,EACpC,EACA,EAGF,GAAI,CACF,KAAM,CAAE,iBAAA0D,CAAA,EAAqB,MAAAiP,EAAA,iCAAAjP,CAAA,QAAM,2BAAAkP,CAAA,EAAwB,wBAAAlP,CAAA,WAC3D,MAAMA,EAAiB,OAAOf,EAAI,CAChC,MAAO3C,EAAK,MACZ,QAASA,EAAK,QACd,KAAMA,EAAK,KACX,SAAUA,EAAK,SACf,YAAaA,EAAK,QAAQ,KAC1B,mBAAoBA,EAAK,QAAQ,WACjC,gBAAiBA,EAAK,QAAQ,SAC9B,aAAcA,EAAK,QAAQ,MAC3B,cAAeA,EAAK,QAAQ,cAAc,KAAK,GAAG,EAClD,WAAYA,EAAK,UAClB,CAEH,MAAgB,CAEhB,CACF,EAEA,mBAAoB,MAAO2C,GAAO,CAChC,GAAI,CACF,KAAM,CAAE,iBAAAe,CAAA,EAAqB,MAAAiP,EAAA,iCAAAjP,CAAA,QAAM,2BAAAkP,CAAA,EAAwB,wBAAAlP,CAAA,WAC3D,MAAMA,EAAiB,OAAOf,CAAE,CAElC,MAAgB,CAEhB,CACAsG,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,OAAQO,GAAMA,EAAE,KAAOrH,CAAE,GAC5D,CACJ,EAEA,yBAA0B,MAAOkB,EAAgB5B,IAAW,CAE1D,MAAM+Q,EAAuB,sBAAsB/Q,CAAM,GACnDgR,EAAoB,KAAK,MAAM,aAAa,QAAQD,CAAoB,GAAK,IAAI,EAClFC,EAAkB,SAASpP,CAAc,IAC5CoP,EAAkB,KAAKpP,CAAc,EACrC,aAAa,QAAQmP,EAAsB,KAAK,UAAUC,CAAiB,CAAC,GAI9EhK,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,IAAKO,GACtCA,EAAE,KAAOnG,GAAkB,CAACmG,EAAE,SAAS,SAAS/H,CAAM,EAClD,CAAE,GAAG+H,EAAG,SAAU,CAAC,GAAGA,EAAE,SAAU/H,CAAM,GACxC+H,CAAA,CACN,EACA,EAGF,GAAI,CACF,KAAM,CAAE,iBAAAtG,CAAA,EAAqB,MAAAiP,EAAA,iCAAAjP,CAAA,QAAM,2BAAAkP,CAAA,EAAwB,wBAAAlP,CAAA,WAC3D,MAAMA,EAAiB,aAAaG,CAAc,CAEpD,MAAgB,CAEhB,CACF,EAEA,6BAA8B,CAACqP,EAAmB3O,EAAqBC,EAAmB2O,EAAgBC,IAAoB,CAC5H,MAAMxD,MAAU,KAChB,OAAO1G,EAAA,EAAM,cAAc,OAAQc,GAAM,CAGvC,GADKA,EAAE,OAAS,aAAeA,EAAE,OAAS,OAAU,CAACA,EAAE,UACnDA,EAAE,WAAa,IAAI,KAAKA,EAAE,SAAS,GAAK4F,EAAK,MAAO,GAGxD,GAAI,CAAC5F,EAAE,QAAUA,EAAE,OAAO,OAAS,MAAO,MAAO,GAGjD,OAAQA,EAAE,OAAO,MACf,IAAK,WAEH,OAAOzF,GAAcyF,EAAE,OAAO,aAAezF,EAE/C,IAAK,WAEH,OAAOA,IAAeyF,EAAE,OAAO,YAAcxF,IAAawF,EAAE,OAAO,SAErE,IAAK,QAEH,OAAOzF,IAAeyF,EAAE,OAAO,YACxBxF,IAAawF,EAAE,OAAO,UACtBmJ,IAAUnJ,EAAE,OAAO,MAE5B,IAAK,SAEH,OAAOA,EAAE,OAAO,cAAc,SAASkJ,CAAS,GAAK,GAEvD,IAAK,SAIH,MAAO,CAACE,GAAUpJ,EAAE,OAAO,WAAaoJ,EAE1C,QACE,MAAO,GAEb,CAAC,CACH,EAEA,6BAA8B,IAAM,CAClC,MAAMxD,MAAU,KAChB,OAAO1G,EAAA,EAAM,cAAc,OAAQc,IAChCA,EAAE,OAAS,aAAeA,EAAE,OAAS,QACtCA,EAAE,WACD,CAACA,EAAE,WAAa,IAAI,KAAKA,EAAE,SAAS,EAAI4F,EAAA,CAE7C,EAEA,yBAA2ByD,GAClBnK,EAAA,EAAM,cAAc,OAAQc,GAAMA,EAAE,WAAaqJ,CAAQ,EAGlE,mBAAoB,SAAY,CAC9B,GAAI,CACF,KAAM,CAAE,iBAAA3P,CAAA,EAAqB,MAAAiP,EAAA,iCAAAjP,CAAA,QAAM,2BAAAkP,CAAA,EAAwB,wBAAAlP,CAAA,WACrDE,EAAS,MAAMF,EAAiB,SAEhCzB,EADY,KAAK,MAAM,aAAa,QAAQ,iBAAiB,GAAK,IAAI,GAClD,OAAO,MAAM,GAEjCqR,GAAiC1P,EAAO,eAAiB,IAAI,IAAKoG,GAAW,CAEjF,MAAMuJ,EAAevJ,EAAE,iBAAmB,IAAQA,EAAE,iBAAmB,EAGjEwJ,EAAqB,GAM3B,GALID,GAAgBtR,GAClBuR,EAAS,KAAKvR,CAAM,EAIlBA,EAAQ,CACV,MAAM+Q,EAAuB,sBAAsB/Q,CAAM,GACrB,KAAK,MAAM,aAAa,QAAQ+Q,CAAoB,GAAK,IAAI,EAC3E,SAAShJ,EAAE,EAAE,GAAK,CAACwJ,EAAS,SAASvR,CAAM,GAC/DuR,EAAS,KAAKvR,CAAM,CAExB,CAGA,IAAIwR,EACJ,GAAIzJ,EAAE,YACJ,GAAI,CACFyJ,EAAc,OAAOzJ,EAAE,aAAgB,SACnC,KAAK,MAAMA,EAAE,WAAW,EACxBA,EAAE,WACR,MAAQ,CACNyJ,EAAc,MAChB,CAIF,MAAMC,EAAY1J,EAAE,OAAS,QAAU,YAAcA,EAAE,KACvD,MAAO,CACL,GAAIA,EAAE,GACN,MAAOA,EAAE,MACT,QAASA,EAAE,QACX,KAAM0J,EACN,SAAU1J,EAAE,UAAY,SACxB,SAAUA,EAAE,YAAc,GAC1B,WAAYA,EAAE,aAAe,GAC7B,WAAY,UACZ,UAAWA,EAAE,WACb,UAAWA,EAAE,WACb,SAAUA,EAAE,YAAc,EAC1B,SAAAwJ,EACA,UAAWxJ,EAAE,YAAc,EAC3B,YAAAyJ,EACA,OAAQzJ,EAAE,YAAc,CACtB,KAAMA,EAAE,YACR,SAAUA,EAAE,cACZ,WAAYA,EAAE,mBACd,SAAUA,EAAE,gBACZ,MAAOA,EAAE,aACT,aAAcA,EAAE,eAAe,MAAM,GAAG,EAAE,OAAO,OAAO,GACtD,OAER,CAAC,EAEDf,EAAI,CAAE,cAAAqK,EAAe,CAEvB,MAAgB,CAEhB,CACF,EAGA,aAAc,SAAY,CACxB,GAAI,CACF,KAAM,CAACK,EAAeC,CAAU,EAAI,MAAM,QAAQ,IAAI,CACpDlR,EAAW,gBACXA,EAAW,YAAW,CACvB,EACDuG,EAAI,CACF,iBAAkB0K,EAAc,YAAc,GAC9C,cAAeC,EAAW,SAAW,EAAC,CACvC,CAEH,MAAgB,CAEhB,CACF,EAGA,eAAgB,SAAY,CAC1B,GAAI,CACF,MAAM/S,EAAW,MAAM6B,EAAW,kBAClCuG,EAAI,CACF,iBAAkBpI,EAAS,YAAc,GACzC,cAAeA,EAAS,SAAW,EAAC,CACrC,CAEH,MAAgB,CAEhB,CACF,EAEA,mBAAoB,MAAOiL,GAAkB,CAC3C,GAAI,CACF,MAAMjL,EAAW,MAAM6B,EAAW,gBAAgB,CAChD,KAAMoJ,EAAc,KACpB,QAASA,EAAc,QACvB,UAAWA,EAAc,UACzB,UAAWA,EAAc,UACzB,WAAYA,EAAc,WAC1B,WAAYA,EAAc,WAC1B,cAAeA,EAAc,SAC7B,UAAWA,EAAc,WAAa,SACvC,EAGD,OAAIjL,EAAS,WACXoI,EAAKQ,IAAW,CAAE,iBAAkB,CAAC,GAAGA,EAAM,iBAAkB5I,EAAS,SAAS,GAAI,EAC/EA,EAAS,WAGX,IACT,OAASC,EAAY,CAGnB,MAAMA,CACR,CACF,EAEA,sBAAuB,MAAO6B,EAAI3C,IAAS,CACzC,GAAI,CACF,MAAM0C,EAAW,gBAAgBC,EAAI3C,CAAI,EACzCiJ,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,IAAK,GAC5C,EAAE,KAAO9G,EAAK,CAAE,GAAG,EAAG,GAAG3C,GAAS,EACpC,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,sBAAuB,MAAO2C,GAAO,CACnC,GAAI,CACF,MAAMD,EAAW,gBAAgBC,CAAE,EACnCsG,EAAKQ,IAAW,CACd,iBAAkBA,EAAM,iBAAiB,OAAQO,GAAMA,EAAE,KAAOrH,CAAE,EAClE,cAAe8G,EAAM,cAAc,OAAQlC,GAAMA,EAAE,cAAgB5E,CAAE,GACrE,CACJ,MAAgB,CAEhB,CACF,EAEA,2BAA6BoC,GACpBmE,EAAA,EAAM,iBAAiB,OAAQc,GAAMA,EAAE,UAAYjF,CAAO,EAGnE,gBAAiB,MAAO8O,GAAe,CACrC,GAAI,CACF,MAAMhT,EAAW,MAAM6B,EAAW,aAAa,CAC7C,YAAamR,EAAW,YACxB,WAAYA,EAAW,WACvB,aAAcA,EAAW,aACzB,YAAaA,EAAW,YACxB,aAAcA,EAAW,aACzB,OAAQA,EAAW,OACnB,SAAUA,EAAW,SACrB,MAAOA,EAAW,MACnB,EAED,OAAIhT,EAAS,QACXoI,EAAKQ,IAAW,CAAE,cAAe,CAAC5I,EAAS,OAAQ,GAAG4I,EAAM,aAAa,GAAI,EACtE5I,EAAS,QAEX,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,mBAAoB,MAAO8B,EAAI3C,IAAS,CACtC,GAAI,CACF,MAAM0C,EAAW,aAAaC,EAAI3C,CAAI,EACtCiJ,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,IAAKlC,GACtCA,EAAE,KAAO5E,EAAK,CAAE,GAAG4E,EAAG,GAAGvH,GAASuH,CAAA,CACpC,EACA,CACJ,MAAgB,CAEhB,CACF,EAEA,mBAAoB,MAAO5E,GAAO,CAChC,GAAI,CACF,MAAMD,EAAW,aAAaC,CAAE,EAChCsG,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,OAAQlC,GAAMA,EAAE,KAAO5E,CAAE,GAC5D,CACJ,MAAgB,CAEhB,CACF,EAEA,4BAA8BC,GACrBsG,EAAA,EAAM,cAAc,OAAQ3B,GAAMA,EAAE,cAAgB3E,CAAW,EAGxE,YAAa,MAAOkR,GAAiB,CACnC,GAAI,CAEF,MAAMjT,EAAW,MAAMW,GAAQ,SAAS,CACtC,MAAOsS,EAAa,MACpB,SAAUA,EAAa,SACvB,KAAMA,EAAa,KACnB,KAAMA,EAAa,MAAQ,WAC3B,MAAOA,EAAa,MACpB,eAAgBA,EAAa,eAC9B,EAED,GAAIjT,EAAS,KAAM,CACjB,MAAMkT,EAAwB,CAC5B,GAAIlT,EAAS,KAAK,GAClB,KAAMA,EAAS,KAAK,KACpB,MAAOA,EAAS,KAAK,OAASiT,EAAa,MAC3C,MAAOjT,EAAS,KAAK,MACrB,eAAgBA,EAAS,KAAK,gBAAkBiT,EAAa,eAC7D,UAAW,IAAI,OAAO,cACtB,OAAQ,EACR,eAAgB,EAChB,eAAgB,EAChB,cAAe,EACf,kBAAmB,EACnB,OAAQ,WAIV,OAAA7K,EAAKQ,IAAW,CAAE,UAAW,CAAC,GAAGA,EAAM,UAAWsK,CAAW,GAAI,EAGjE7K,EAAA,EAAM,iBAEC6K,CACT,CACA,OAAO,IACT,OAASjT,EAAY,CAEnB,MAAMA,CACR,CACF,EAEA,eAAgB,CAAC6B,EAAI3C,IAAS,CAC5BiJ,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKqB,GAC9BA,EAAE,KAAOnI,EAAK,CAAE,GAAGmI,EAAG,GAAG9K,GAAS8K,CAAA,CACpC,EACA,CACJ,EAEA,eAAgB,MAAOnI,GAAO,CAC5B,GAAI,CACF,MAAMd,GAAS,OAAOc,CAAE,EACxBsG,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,OAAQqB,GAAMA,EAAE,KAAOnI,CAAE,GACpD,CACJ,OAAS7B,EAAO,CAEd,MAAMA,CACR,CACF,EAEA,iBAAmB+E,GAAe,CAChC,KAAM,CAAE,SAAAmO,CAAA,EAAa9K,EAAA,EACf+K,EAAmBD,EAAS,OAAOzM,GAAKA,EAAE,aAAe1B,CAAU,EACnEqO,EAAYD,EAAiB,OAAO1M,GAAKA,EAAE,SAAW,WAAW,EACjEqI,MAAU,KACVuE,EAAU,IAAI,KAAKvE,EAAI,UAAY,MAAc,GAAK,GAAI,EAC1DwE,EAAW,IAAI,KAAKxE,EAAI,UAAY,IAAU,GAAK,GAAK,GAAI,EAE5DyE,EAAWH,EAAU,OAAO3M,GAAKA,EAAE,YAAc,IAAI,KAAKA,EAAE,UAAU,GAAK4M,CAAO,EAAE,OACpFG,EAAYJ,EAAU,OAAO3M,GAAKA,EAAE,YAAc,IAAI,KAAKA,EAAE,UAAU,GAAK6M,CAAQ,EAAE,OAEtFG,EAAUL,EAAU,OAAO3M,GAAKA,EAAE,MAAM,EAAE,IAAIA,GAAKA,EAAE,MAAO,EAC5DiN,EAAYD,EAAQ,OAAS,EAAIA,EAAQ,OAAO,CAACvK,EAAGH,IAAMG,EAAIH,EAAG,CAAC,EAAI0K,EAAQ,OAAS,EAEvFE,EAAQP,EAAU,OAAO3M,GAAKA,EAAE,YAAY,EAAE,IAAIA,GAAKA,EAAE,YAAa,EACtEmN,EAAUD,EAAM,OAAS,EAAI,KAAK,MAAMA,EAAM,OAAO,CAACzK,EAAGH,IAAMG,EAAIH,EAAG,CAAC,EAAI4K,EAAM,OAAS,EAAE,EAAI,EAEtG,MAAO,CACL,cAAeR,EAAiB,OAChC,kBAAmBC,EAAU,OAC7B,UAAW,KAAK,MAAMM,EAAY,EAAE,EAAI,GACxC,QAAAE,EACA,SAAAL,EACA,UAAAC,CAAA,CAEJ,EAEA,WAAY,MAAOK,GAAgB,CAEjC,MAAMxC,EAAS,QAAQzC,GAAA,CAAY,GAC7BkF,EAAa,IAAIzC,EAAO,UAAU,EAAG,EAAE,EAAE,aAAa,GACtDvC,EAAM,IAAI,OAAO,cAGjBiF,EAA6B,CACjC,GAAI1C,EACJ,OAAQyC,EACR,MAAOD,EAAY,MACnB,YAAaA,EAAY,aAAe,GACxC,SAAUA,EAAY,SACtB,OAAQ,MACR,SAAUA,EAAY,UAAY,SAClC,WAAYA,EAAY,WACxB,aAAcA,EAAY,aAC1B,cAAeA,EAAY,cAC3B,QAASA,EAAY,QACrB,UAAWA,EAAY,UACvB,WAAYA,EAAY,WACxB,cAAeA,EAAY,cAC3B,cAAeA,EAAY,cAC3B,UAAW/E,CAAA,EAIb3G,EAAKQ,IAAW,CAAE,SAAU,CAACoL,EAAmB,GAAGpL,EAAM,QAAQ,GAAI,EAGrEP,EAAA,EAAM,gBAAgB,CACpB,OAAQ,UACR,KAAM,kBACN,MAAO,eACP,QAAS,UAAU0L,CAAU,KAAKD,EAAY,KAAK,GACnD,UAAWxC,CAAA,CACZ,EAED,GAAI,CAgBF,MAAM9R,GAdW,MAAM0F,EAAY,OAAO,CACxC,YAAa4O,EAAY,SACzB,MAAOA,EAAY,MACnB,YAAaA,EAAY,YACzB,SAAUA,EAAY,SACtB,YAAaA,EAAY,WACzB,aAAcA,EAAY,eAAiBA,EAAY,cACnD,GAAGA,EAAY,aAAa,IAAIA,EAAY,aAAa,MACzD,OAEJ,YAAaA,EAAY,WAC1B,GAG2B,QACtBG,EAAuB,CAC3B,GAAIzU,EAAW,GACf,OAAQA,EAAW,gBAAkBA,EAAW,OAChD,MAAOA,EAAW,MAClB,YAAaA,EAAW,YACxB,SAAUA,EAAW,YACrB,OAAQA,EAAW,OACnB,SAAUA,EAAW,UAAY,SACjC,WAAYA,EAAW,YACvB,aAAcA,EAAW,cACzB,cAAeA,EAAW,eAC1B,QAASA,EAAW,QACpB,UAAWA,EAAW,UACtB,UAAWA,EAAW,YAIxB,OAAA4I,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAO4K,EAAS2C,EAAcvN,CAAA,CAClC,EACA,EAGF2B,EAAA,EAAM,eAAe,CACnB,OAAQyL,EAAY,WACpB,SAAUA,EAAY,aACtB,SAAU,WACV,OAAQ,gBACR,QAAS,WAAWG,EAAY,MAAM,KAAKA,EAAY,KAAK,GAC5D,UAAWA,EAAY,GACxB,EAEMA,CACT,MAAgB,CAGd,OAAA7L,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAAQlC,GAAMA,EAAE,KAAO4K,CAAM,GACtD,EACK,IACT,CACF,EAEA,cAAe,MAAOjM,EAAWL,IAAe,CAC9C,MAAM4D,EAAQP,EAAA,EACR6L,EAAWtL,EAAM,UAAU,KAAKqB,GAAKA,EAAE,KAAOjF,CAAU,EACxD1E,EAAUsI,EAAM,SAAS,KAAKlC,GAAKA,EAAE,KAAOrB,CAAS,EAE3D,GAAI,CAAC/E,EAEH,OAGF,KAAM,CAAE,KAAAI,CAAA,EAASuH,EAAa,WACxBkM,EAAezT,GAAM,OAAS,YAAcA,GAAM,KAAOsE,EACzDoJ,EAAe8F,GAAU,MAAQ,cACjCE,EAAgBF,GAAU,OAAS,GAGnCG,EAAkB,CAAE,GAAG/T,CAAA,EACvBgU,EAAmBJ,EAAW,CAAE,GAAGA,GAAa,KAGtD9L,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CACE,GAAGqB,EACH,OAAQ,WACR,WAAA1B,EACA,aAAAoJ,EACA,cAAAgG,EACA,eAAgBF,GAAU,QAAU,EACpC,WAAY,IAAI,OAAO,aAAY,EAErCxN,CAAA,EAEN,UAAWkC,EAAM,UAAU,IAAKqB,GAC9BA,EAAE,KAAOjF,EACL,CAAE,GAAGiF,EAAG,OAAQ,OAAiB,gBAAiBA,EAAE,gBAAkB,GAAK,GAC3EA,CAAA,CACN,EACA,EAGEkK,GACF9L,EAAA,EAAM,gBAAgB,CACpB,OAAQ,WACR,KAAM,mBACN,MAAO,0BACP,QAAS,GAAG+F,CAAY,iBAAiB9N,EAAQ,MAAM,KAAKA,EAAQ,KAAK,GACzE,UAAA+E,CAAA,CACD,EACDgD,EAAA,EAAM,eAAe,CACnB,OAAQrD,EACR,SAAUoJ,EACV,SAAU,WACV,OAAQ,cACR,QAAS,WAAW9N,EAAQ,MAAM,KAAKA,EAAQ,KAAK,GACpD,UAAA+E,CAAA,CACD,IAEDgD,EAAA,EAAM,gBAAgB,CACpB,OAAQrD,EACR,KAAM,mBACN,MAAO,yBACP,QAAS,yBAAyB1E,EAAQ,MAAM,KAAKA,EAAQ,KAAK,GAClE,UAAA+E,CAAA,CACD,EACDgD,EAAA,EAAM,eAAe,CACnB,OAAQ3H,GAAM,IAAM,SACpB,SAAUA,GAAM,MAAQ,UACxB,SAAUA,GAAM,MAAQ,UACxB,OAAQ,uBACR,QAAS,WAAWJ,EAAQ,MAAM,cAAc8N,CAAY,GAC5D,UAAA/I,CAAA,CACD,GAGH,GAAI,CAEF,MAAMH,EAAY,OAAOG,EAAWL,CAAU,CAChD,MAAgB,CAGdoD,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EAAYgP,EAAkB3N,CAAA,EAEzC,UAAW4N,EACP1L,EAAM,UAAU,IAAKqB,GACnBA,EAAE,KAAOjF,EAAasP,EAAmBrK,CAAA,EAE3CrB,EAAM,WACV,CACJ,CACF,EAEA,cAAe,MAAOvD,GAAc,CAElC,MAAM/E,EADQ+H,EAAA,EACQ,SAAS,KAAK3B,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAI,CAAC/E,EAAS,OAGd,MAAM+T,EAAkB,CAAE,GAAG/T,CAAA,EAG7B8H,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CAAE,GAAGqB,EAAG,OAAQ,WAAqB,WAAY,IAAI,OAAO,eAC5DA,CAAA,CACN,EACA,EAGF2B,EAAA,EAAM,gBAAgB,CACpB,OAAQ/H,EAAQ,WAChB,KAAM,mBACN,MAAO,iBACP,QAAS,eAAeA,EAAQ,YAAY,wBAAwBA,EAAQ,MAAM,GAClF,UAAA+E,CAAA,CACD,EACDgD,EAAA,EAAM,gBAAgB,CACpB,OAAQ,UACR,KAAM,mBACN,MAAO,8BACP,QAAS,GAAG/H,EAAQ,YAAY,mBAAmBA,EAAQ,MAAM,GACjE,UAAA+E,CAAA,CACD,EACDgD,EAAA,EAAM,eAAe,CACnB,OAAQ/H,EAAQ,WAChB,SAAUA,EAAQ,aAClB,SAAU,WACV,OAAQ,gBACR,QAAS,WAAWA,EAAQ,MAAM,GAClC,UAAA+E,CAAA,CACD,EAED,GAAI,CAEF,MAAMH,EAAY,OAAOG,CAAS,CACpC,MAAgB,CAGd+C,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EAAYgP,EAAkB3N,CAAA,CACzC,EACA,CACJ,CACF,EAEA,UAAW,MAAOrB,GAAc,CAC9B,MAAMuD,EAAQP,EAAA,EACR/H,EAAUsI,EAAM,SAAS,KAAKlC,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAI,CAAC/E,EAAS,OAGd,MAAM0E,EAAa1E,EAAQ,WAC3B,GAAI0E,GACoB4D,EAAM,SAAS,KACnClC,GAAKA,EAAE,aAAe1B,GAAc0B,EAAE,SAAW,eAAiBA,EAAE,KAAOrB,CAAA,EAI3E,OAKJ,MAAMgP,EAAkB,CAAE,GAAG/T,CAAA,EAG7B8H,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CAAE,GAAGqB,EAAG,OAAQ,cAAwB,UAAW,IAAI,OAAO,eAC9DA,CAAA,CACN,EACA,EAGF2B,EAAA,EAAM,gBAAgB,CACpB,OAAQ/H,EAAQ,WAChB,KAAM,kBACN,MAAO,gBACP,QAAS,eAAeA,EAAQ,YAAY,4BAA4BA,EAAQ,MAAM,GACtF,UAAA+E,CAAA,CACD,EACDgD,EAAA,EAAM,eAAe,CACnB,OAAQ/H,EAAQ,WAChB,SAAUA,EAAQ,aAClB,SAAU,WACV,OAAQ,eACR,QAAS,WAAWA,EAAQ,MAAM,GAClC,UAAA+E,CAAA,CACD,EAED,GAAI,CAEF,MAAMH,EAAY,MAAMG,CAAS,CACnC,MAAgB,CAGd+C,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EAAYgP,EAAkB3N,CAAA,CACzC,EACA,CACJ,CACF,EAEA,UAAW,MAAOrB,GAAc,CAE9B,MAAM/E,EADQ+H,EAAA,EACQ,SAAS,KAAK3B,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAI,GAAC/E,GAAWA,EAAQ,SAAW,eAAiBA,EAAQ,UAE5D,GAAI,CAEF,MAAM4E,EAAY,MAAMG,CAAS,EAGjC+C,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CAAE,GAAGqB,EAAG,SAAU,GAAM,SAAU,IAAI,OAAO,eAC7CA,CAAA,CACN,EACA,EAGF2B,EAAA,EAAM,eAAe,CACnB,OAAQ/H,EAAQ,WAChB,SAAUA,EAAQ,aAClB,SAAU,WACV,OAAQ,sBACR,QAAS,WAAWA,EAAQ,MAAM,GAClC,UAAA+E,CAAA,CACD,CACH,MAAgB,CAEhB,CACF,EAEA,WAAY,MAAOA,GAAc,CAE/B,MAAM/E,EADQ+H,EAAA,EACQ,SAAS,KAAK3B,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAI,GAAC/E,GAAWA,EAAQ,SAAW,eAAiB,CAACA,EAAQ,UAE7D,GAAI,CAKF,MAAMiU,GAHS,MAAMrP,EAAY,OAAOG,CAAS,GAGlB,iBAAoB/E,EAAQ,iBAAmB,EAG9E8H,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CAAE,GAAGqB,EAAG,SAAU,GAAO,SAAU,OAAW,gBAAA6N,GAC9C7N,CAAA,CACN,EACA,EAGF2B,EAAA,EAAM,eAAe,CACnB,OAAQ/H,EAAQ,WAChB,SAAUA,EAAQ,aAClB,SAAU,WACV,OAAQ,oBACR,QAAS,WAAWA,EAAQ,MAAM,GAClC,UAAA+E,CAAA,CACD,CACH,MAAgB,CAEhB,CACF,EAEA,aAAc,MAAOA,EAAWmP,IAAiB,CAE/C,MAAMlU,EADQ+H,EAAA,EACQ,SAAS,KAAK3B,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAI,CAAC/E,EAAS,OAEd,MAAMmU,EAAc,CAAC,CAACnU,EAAQ,gBAE9B,GAAI,CAEF,MAAM4E,EAAY,SAASG,CAAS,EAEpC+C,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CACE,GAAGqB,EACH,OAAQ,mBACR,YAAa,IAAI,OAAO,cACxB,aAAA8N,EAEA,SAAU,OACV,SAAU,OACV,WAAY,OACZ,gBAAiB,QAEnB9N,CAAA,CACN,EACA,EAGF,MAAMgO,EAAgBD,EAClB,2CAA2CnU,EAAQ,MAAM,yCACzD,0CAA0CA,EAAQ,MAAM,wCAE5D+H,EAAA,EAAM,gBAAgB,CACpB,OAAQ/H,EAAQ,WAChB,KAAM,oBACN,MAAOmU,EAAc,oBAAsB,mBAC3C,QAASC,EACT,UAAArP,CAAA,CACD,EAGD,KAAM,CAAE,KAAA3E,CAAA,EAASuH,EAAa,WAC1BvH,GAAM,KAAOJ,EAAQ,YAEvBsO,GAAkB,uBAChBtO,EAAQ,OACRA,EAAQ,cAAgB,cACxB+E,CAAA,EAIJgD,EAAA,EAAM,gBAAgB,CACpB,OAAQ,UACR,KAAM,oBACN,MAAO,mBACP,QAAS,GAAG/H,EAAQ,YAAY,qBAAqBA,EAAQ,MAAM,oCACnE,UAAA+E,CAAA,CACD,EAEDgD,EAAA,EAAM,eAAe,CACnB,OAAQ/H,EAAQ,WAChB,SAAUA,EAAQ,aAClB,SAAU,WACV,OAAQ,kBACR,QAAS,WAAWA,EAAQ,MAAM,mBAAmB,KAAK,MAAMkU,EAAe,EAAE,CAAC,OAClF,UAAAnP,CAAA,CACD,CACH,MAAgB,CAEhB,CACF,EAEA,eAAgB,MAAOA,EAAWC,EAAQC,IAAa,CACrD,MAAMqD,EAAQP,EAAA,EACR/H,EAAUsI,EAAM,SAAS,KAAKlC,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAK/E,EAEL,GAAI,CAmBF,GAjBA,MAAM4E,EAAY,QAAQG,EAAWC,EAAQC,CAAQ,EAErD6C,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CACE,GAAGqB,EACH,OAAQ,YACR,WAAY,IAAI,OAAO,cACvB,OAAApB,EACA,SAAAC,CAAA,EAEFmB,CAAA,CACN,EACA,EAGEpG,EAAQ,YACOsI,EAAM,UAAU,QAAUqB,EAAE,KAAO3J,EAAQ,UAAU,EACxD,CAIZ,MAAMoT,EAAU,CAAC,GAHS9K,EAAM,SAAS,UAClClC,EAAE,aAAepG,EAAQ,YAAcoG,EAAE,SAAW,aAErB,OAASA,EAAE,QAAU,CAAC,EAAGpB,CAAM,EAC/DqP,EAAYjB,EAAQ,OAAO,CAACvK,EAAGH,IAAMG,EAAIH,EAAG,CAAC,EAAI0K,EAAQ,OAE/DtL,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKqB,GAC9BA,EAAE,KAAO3J,EAAQ,WACb,CACE,GAAG2J,EACH,eAAgBA,EAAE,eAAiB,EACnC,OAAQ,KAAK,MAAM0K,EAAY,EAAE,EAAI,GACrC,cAAe1K,EAAE,cAAgB,KAEnCA,CAAA,CACN,EACA,CACJ,CAGF5B,EAAA,EAAM,gBAAgB,CACpB,OAAQ/H,EAAQ,WAChB,KAAM,mBACN,MAAO,sBACP,QAAS,WAAWA,EAAQ,MAAM,0BAA0BgF,CAAM,KAClE,UAAAD,CAAA,CACD,EAEDgD,EAAA,EAAM,eAAe,CACnB,OAAQ/H,EAAQ,WAChB,SAAUA,EAAQ,aAClB,SAAU,WACV,OAAQ,wBACR,QAAS,WAAWA,EAAQ,MAAM,aAAagF,CAAM,KACrD,UAAAD,CAAA,CACD,CACH,MAAgB,CAEhB,CACF,EAEA,cAAe,MAAOA,EAAWjD,IAAW,CAE1C,MAAM9B,EADQ+H,EAAA,EACQ,SAAS,KAAK3B,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAK/E,EAEL,GAAI,CAEF,MAAM4E,EAAY,OAAOG,EAAWjD,CAAM,EAE1C,MAAMwS,GAAqBtU,EAAQ,gBAAkB,GAAK,EAG1D8H,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CACE,GAAGqB,EACH,OAAQ,cACR,YAAa,OACb,aAAc,OACd,WAAY,IAAI,OAAO,cACvB,gBAAiBtE,EACjB,eAAgBwS,CAAA,EAElBlO,CAAA,CACN,EACA,EAGF2B,EAAA,EAAM,eAAe,CACnB,OAAQ/H,EAAQ,WAChB,SAAUA,EAAQ,aAClB,SAAU,WACV,OAAQ,sBACR,QAAS,WAAWA,EAAQ,MAAM,cAAc8B,CAAM,GACtD,UAAAiD,CAAA,CACD,CACH,MAAgB,CAEhB,CACF,EAEA,cAAe,MAAOA,EAAWwP,EAAazS,IAAW,CACvD,MAAMwG,EAAQP,EAAA,EACR/H,EAAUsI,EAAM,SAAS,KAAKlC,GAAKA,EAAE,KAAOrB,CAAS,EAC3D,GAAI,CAAC/E,EAAS,OAEd,KAAM,CAAE,KAAAI,CAAA,EAASuH,EAAa,WACxB6M,EAAgBpU,GAAM,MAAQ,UAK9BqU,EAAoB,CAAC,MAAO,WAAY,UAAU,EAAE,SAASzU,EAAQ,MAAM,EAC3E0U,EAAmB1U,EAAQ,SAAW,YAO5C,GALIuU,IAAgB,YAAc,CAACE,IAK9BF,IAAgB,WAAaA,IAAgB,UAAY,CAACG,EAE7D,OAGF,MAAMC,EAAqB3U,EAAQ,WAGnC,GAAI,CACF,MAAM4E,EAAY,OAAOG,EAAWjD,CAAM,CAC5C,MAAgB,CAGhB,CAiBA,GAfAgG,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CACE,GAAGqB,EACH,OAAQ,YACR,YAAa,IAAI,OAAO,cACxB,YAAAmO,EACA,mBAAoBzS,CAAA,EAEtBsE,CAAA,CACN,EACA,EAGEuO,EAAoB,CACtB,MAAMC,EAActM,EAAM,SAAS,OACjClC,GAAKA,EAAE,aAAeuO,GAAsB,CAAC,WAAY,WAAY,aAAa,EAAE,SAASvO,EAAE,MAAM,GAAKA,EAAE,KAAOrB,CAAA,EACnH,OAEF+C,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKqB,GAC9BA,EAAE,KAAOgL,EACL,CAAE,GAAGhL,EAAG,eAAgBiL,EAAa,OAAQA,EAAc,EAAI,OAAS,aACxEjL,CAAA,CACN,EACA,CACJ,CAGA,MAAMkL,EAA+C,CACnD,SAAU,SACV,SAAU,cACV,QAAS,WACT,MAAO,iBAILN,IAAgB,YAClBxM,EAAA,EAAM,gBAAgB,CACpB,OAAQ/H,EAAQ,WAChB,KAAM,oBACN,MAAO,kBACP,QAAS,WAAWA,EAAQ,MAAM,4BAA4B8B,CAAM,GACpE,UAAAiD,CAAA,CACD,EAIC4P,GAAsBJ,IAAgB,YACxCxM,EAAA,EAAM,gBAAgB,CACpB,OAAQ4M,EACR,KAAM,oBACN,MAAO,kBACP,QAAS,WAAW3U,EAAQ,MAAM,kBAAkB6U,EAAgBN,CAAW,CAAC,cAAczS,CAAM,GACpG,UAAAiD,CAAA,CACD,GAICwP,IAAgB,YAAcA,IAAgB,aAChDxM,EAAA,EAAM,gBAAgB,CACpB,OAAQ,WACR,KAAM,oBACN,MAAO,kBACP,QAAS,GAAG8M,EAAgBN,CAAW,CAAC,oBAAoBvU,EAAQ,MAAM,cAAc8B,CAAM,GAC9F,UAAAiD,CAAA,CACD,EAIHgD,EAAA,EAAM,eAAe,CACnB,OAAQ3H,GAAM,IAAM,SACpB,SAAUoU,EACV,SAAUD,EACV,OAAQ,iBACR,QAAS,WAAWvU,EAAQ,MAAM,KAAK8B,CAAM,GAC7C,UAAAiD,CAAA,CACD,CACH,EAEA,eAAgB,MAAOA,EAAWjD,IAAW,CAE3C,MAAMwG,EAAQP,EAAA,EACR/H,EAAUsI,EAAM,SAAS,KAAKlC,GAAKA,EAAE,KAAOrB,CAAS,EAI3D,GAHI,CAAC/E,GAGD,CAAC,CAAC,WAAY,WAAY,aAAa,EAAE,SAASA,EAAQ,MAAM,EAElE,OAGF,MAAM2U,EAAqB3U,EAAQ,WAC7B8N,EAAe9N,EAAQ,aAGvB+T,EAAkB,CAAE,GAAG/T,CAAA,EAsB7B,GAnBA8H,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EACL,CACE,GAAGqB,EACH,OAAQ,MACR,WAAY,OACZ,aAAc,OACd,cAAe,OACf,eAAgB,OAChB,WAAY,OACZ,WAAY,OACZ,UAAW,QAEbA,CAAA,CACN,EACA,EAGEuO,EAAoB,CACtB,MAAMC,EAActM,EAAM,SAAS,OACjClC,GAAKA,EAAE,aAAeuO,GAAsB,CAAC,WAAY,WAAY,aAAa,EAAE,SAASvO,EAAE,MAAM,GAAKA,EAAE,KAAOrB,CAAA,EACnH,OAEF+C,EAAKQ,IAAW,CACd,UAAWA,EAAM,UAAU,IAAKqB,GAC9BA,EAAE,KAAOgL,EACL,CAAE,GAAGhL,EAAG,eAAgBiL,EAAa,OAAQA,EAAc,EAAI,OAAS,aACxEjL,CAAA,CACN,EACA,CACJ,CAGA5B,EAAA,EAAM,gBAAgB,CACpB,OAAQ/H,EAAQ,WAChB,KAAM,mBACN,MAAO,wBACP,QAAS,eAAe8N,CAAY,yBAAyB9N,EAAQ,MAAM,iCAC3E,UAAA+E,CAAA,CACD,EAGDgD,EAAA,EAAM,gBAAgB,CACpB,OAAQ,WACR,KAAM,mBACN,MAAO,kCACP,QAAS,GAAG+F,CAAY,yBAAyB9N,EAAQ,MAAM,cAAc8B,CAAM,sCACnF,UAAAiD,CAAA,CACD,EAGDgD,EAAA,EAAM,eAAe,CACnB,OAAQ4M,GAAsB,SAC9B,SAAU7G,GAAgB,cAC1B,SAAU,WACV,OAAQ,sBACR,QAAS,WAAW9N,EAAQ,MAAM,KAAK8B,CAAM,GAC7C,UAAAiD,CAAA,CACD,EAED,GAAI,CAEF,MAAMH,EAAY,QAAQG,EAAWjD,CAAM,CAC7C,OAASnC,EAAO,CAGd,MAAAmI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOrB,EAAYgP,EAAkB3N,CAAA,CACzC,EACA,EAEIzG,CACR,CACF,EAEA,sBAAwBwB,GACf4G,IAAM,SAAS,OAAO3B,GAAKA,EAAE,aAAejF,CAAU,EAG/D,sBAAwBuD,GACfqD,IAAM,SAAS,OAAO3B,GAAKA,EAAE,aAAe1B,CAAU,EAG/D,gBAAkBiJ,GAAiB,CACjC,MAAMmH,EAAgC,CACpC,GAAGnH,EACH,GAAIY,GAAA,EACJ,KAAM,GACN,UAAW,IAAI,OAAO,aAAY,EAGpCzG,EAAKQ,IAAW,CACd,cAAe,CAACwM,EAAiB,GAAGxM,EAAM,aAAa,EAAE,MAAM,EAAG,GAAG,GACrE,CACJ,EAEA,uBAAyB9G,GAAO,CAC9BsG,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,IAAKyM,GACtCA,EAAE,KAAOvT,EAAK,CAAE,GAAGuT,EAAG,KAAM,IAASA,CAAA,CACvC,EACA,CACJ,EAEA,2BAA6BjU,GAAW,CACtCgH,EAAKQ,IAAW,CACd,cAAeA,EAAM,cAAc,IAAKyM,GACtCA,EAAE,SAAWjU,EAAS,CAAE,GAAGiU,EAAG,KAAM,IAASA,CAAA,CAC/C,EACA,CACJ,EAEA,eAAiBjU,GACRiH,EAAA,EAAM,cAAc,OAAO,GAAK,EAAE,SAAWjH,GAAU,CAAC,EAAE,IAAI,EAAE,OAGzE,eAAiBkU,GAAQ,CACvB,MAAM5E,EAAsB,CAC1B,GAAG4E,EACH,GAAIzG,GAAA,EACJ,UAAW,IAAI,OAAO,aAAY,EAEpCzG,EAAKQ,IAAW,CACd,aAAc,CAAC8H,EAAQ,GAAG9H,EAAM,YAAY,EAAE,MAAM,EAAG,GAAG,GAC1D,CACJ,EAEA,SAAU,IAAM,CACd,KAAM,CAAE,SAAAuK,EAAU,UAAAoC,CAAA,EAAclN,EAAA,EAC1B0G,MAAU,KACVyG,EAAQ,IAAI,KAAKzG,EAAI,cAAeA,EAAI,WAAYA,EAAI,SAAS,EACjEuE,EAAU,IAAI,KAAKkC,EAAM,UAAY,MAAc,GAAK,GAAI,EAE5DC,EAAoBtC,EAAS,OAAOzM,GAAKA,EAAE,SAAW,aAAeA,EAAE,UAAU,EACjFgP,EAAiBD,EAAkB,OAAO/O,GAC9C,IAAI,KAAKA,EAAE,UAAW,GAAK8O,CAAA,EAC3B,OACIG,EAAgBF,EAAkB,OAAO/O,GAC7C,IAAI,KAAKA,EAAE,UAAW,GAAK4M,CAAA,EAC3B,OAEF,IAAIsC,EAAY,EACZC,EAAQ,EACZJ,EAAkB,QAAQ/O,GAAK,CACzBA,EAAE,eACJkP,GAAalP,EAAE,aACfmP,IAEJ,CAAC,EACD,MAAMC,EAAoBD,EAAQ,EAAI,KAAK,MAAMD,EAAYC,EAAQ,EAAE,EAAI,EAE3E,MAAO,CACL,cAAe1C,EAAS,OACxB,YAAaA,EAAS,UAAYzM,EAAE,SAAW,KAAK,EAAE,OACtD,WAAYyM,EAAS,OAAOzM,GAAK,CAAC,WAAY,WAAY,aAAa,EAAE,SAASA,EAAE,MAAM,CAAC,EAAE,OAC7F,gBAAiByM,EAAS,UAAYzM,EAAE,SAAW,kBAAkB,EAAE,OACvE,eAAAgP,EACA,cAAAC,EACA,kBAAAG,EACA,gBAAiBP,EAAU,UAAYtL,EAAE,SAAW,SAAS,EAAE,OAC/D,eAAgBsL,EAAU,OAE9B,EAEA,aAAc,IAAM,CAClB,KAAM,CAAE,SAAApC,CAAA,EAAa9K,EAAA,EACf0G,MAAU,KACVgH,EAAO,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAI,EAChDC,EAAyB,GAE/B,QAAStI,EAAI,EAAGA,GAAK,EAAGA,IAAK,CAC3B,MAAMY,EAAO,IAAI,KAAKS,CAAG,EACzBT,EAAK,QAAQA,EAAK,UAAYZ,CAAC,EAC/B,MAAMuI,EAAW,IAAI,KAAK3H,EAAK,cAAeA,EAAK,WAAYA,EAAK,SAAS,EACvE4H,EAAS,IAAI,KAAKD,EAAS,UAAY,KAAU,GAAK,GAAI,EAE1DE,EAAUhD,EAAS,OAAOzM,GAAK,CACnC,MAAM0P,EAAY,IAAI,KAAK1P,EAAE,SAAS,EACtC,OAAO0P,GAAaH,GAAYG,EAAYF,CAC9C,CAAC,EAAE,OAEG7C,EAAYF,EAAS,OAAOzM,GAAK,CACrC,GAAI,CAACA,EAAE,WAAY,MAAO,GAC1B,MAAM2P,EAAa,IAAI,KAAK3P,EAAE,UAAU,EACxC,OAAO2P,GAAcJ,GAAYI,EAAaH,CAChD,CAAC,EAAE,OAEHF,EAAU,KAAK,CACb,KAAMC,EAAS,cACf,KAAMF,EAAKzH,EAAK,WAAa,EAAI,EAAIA,EAAK,SAAW,CAAC,EACtD,QAAA6H,EACA,UAAA9C,CAAA,CACD,CACH,CAEA,OAAO2C,CACT,EAEA,cAAe,SAAY,CACzB,GAAI,CACF,KAAM,CAAE,YAAAjO,CAAA,EAAgB,MAAA+J,EAAA,4BAAA/J,CAAA,QAAM,2BAAAgK,CAAA,EAAwB,mBAAAhK,CAAA,WAChD/H,EAAW,MAAM+H,EAAY,SACnC,GAAI/H,EAAS,SAAWA,EAAS,MAAM,SAAU,CAC/C,MAAMsW,EAActW,EAAS,KAAK,SAElCoI,EAAKQ,IAAW,CACd,SAAU,CACR,GAAGA,EAAM,SACT,YAAa0N,EAAY,aAAe1N,EAAM,SAAS,YACvD,WAAY0N,EAAY,YAAc1N,EAAM,SAAS,WACrD,eAAgB0N,EAAY,gBAAkB1N,EAAM,SAAS,eAC7D,aAAc0N,EAAY,cAAgB1N,EAAM,SAAS,aACzD,YAAa0N,EAAY,aAAe1N,EAAM,SAAS,YACvD,kBAAmB0N,EAAY,mBAAqB1N,EAAM,SAAS,kBACnE,gBAAiB0N,EAAY,iBAAmB1N,EAAM,SAAS,gBAC/D,WAAY0N,EAAY,YAAc1N,EAAM,SAAS,WACrD,YAAa0N,EAAY,aAAe1N,EAAM,SAAS,YACvD,iBAAkB0N,EAAY,kBAAoB1N,EAAM,SAAS,iBACjE,eAAgB0N,EAAY,gBAAkB1N,EAAM,SAAS,eAC7D,iBAAkB0N,EAAY,kBAAoB1N,EAAM,SAAS,iBACjE,mBAAoB0N,EAAY,oBAAsB1N,EAAM,SAAS,mBACrE,kBAAmB0N,EAAY,mBAAqB1N,EAAM,SAAS,kBACrE,EACA,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,eAAgB,MAAO2N,GAAgB,CAErCnO,EAAKQ,IAAW,CACd,SAAU,CAAE,GAAGA,EAAM,SAAU,GAAG2N,CAAA,CAAY,EAC9C,EAGF,GAAI,CACF,KAAM,CAAE,YAAAxO,CAAA,EAAgB,MAAA+J,EAAA,4BAAA/J,CAAA,QAAM,2BAAAgK,CAAA,EAAwB,mBAAAhK,CAAA,WACtD,MAAMA,EAAY,WAAWwO,CAAW,CAC1C,MAAgB,CAGhB,CACF,EAGA,wBAAyB,SAAY,CACnC,GAAI,CACF,KAAM,CAAE,cAAA/Q,CAAA,EAAkB,MAAAsM,EAAA,8BAAAtM,CAAA,QAAM,2BAAAuM,CAAA,EAAwB,qBAAAvM,CAAA,WAKlDgR,IAJW,MAAMhR,EAAc,cACR,aAAe,IAGe,IAAKkB,IAAY,CAC1E,GAAIA,EAAE,GACN,UAAWA,EAAE,WACb,cAAeA,EAAE,gBAAkBA,EAAE,eAAiB,IAAIA,EAAE,YAAY,UAAU,EAAG,CAAC,CAAC,GACvF,UAAWA,EAAE,UACb,YAAaA,EAAE,aACf,cAAeA,EAAE,eACjB,YAAaA,EAAE,aACf,cAAeA,EAAE,eACjB,cAAeA,EAAE,eACjB,YAAaA,EAAE,aACf,YAAaA,EAAE,aACf,aAAcA,EAAE,cAChB,aAAcA,EAAE,cAChB,OAAQA,EAAE,OACV,WAAYA,EAAE,YACd,OAAQA,EAAE,OACV,aAAcA,EAAE,cAChB,UAAWA,EAAE,WACb,YAAaA,EAAE,aACf,UAAWA,EAAE,YACb,EAEF0B,EAAI,CAAE,mBAAoBoO,EAAmB,CAC/C,MAAgB,CAEhB,CACF,EAEA,wBAAyB,MAAOrX,GAAS,CAEvC,MAAMmB,EADQ+H,EAAA,EACQ,SAAS,QAAU3B,EAAE,KAAOvH,EAAK,SAAS,EAChE,GAAI,CAACmB,EAAS,OAAO,KAErB,KAAM,CAAE,KAAAI,CAAA,EAASuH,EAAa,WAC9B,GAAI,CAACvH,EAAM,OAAO,KAElB,GAAI,CACF,KAAM,CAAE,YAAAwE,GAAgB,6CAAM,8BAAwB,mBAAAuR,CAAA,WAChDzW,EAAW,MAAMkF,EAAY,iBAAiB/F,EAAK,UAAW,CAClE,cAAeA,EAAK,aACpB,cAAeA,EAAK,aACpB,OAAQA,EAAK,OACb,YAAaA,EAAK,WACnB,EAED,GAAIa,EAAS,WAAY,CACvB,MAAM0G,EAAI1G,EAAS,WACb0W,EAAmC,CACvC,GAAIhQ,EAAE,GACN,UAAWA,EAAE,WACb,cAAepG,EAAQ,OACvB,UAAWoG,EAAE,UACb,YAAaA,EAAE,aACf,cAAeA,EAAE,eACjB,YAAaA,EAAE,aACf,cAAeA,EAAE,eACjB,cAAeA,EAAE,eACjB,YAAaA,EAAE,aACf,YAAaA,EAAE,aACf,aAAcA,EAAE,cAChB,aAAcA,EAAE,cAChB,OAAQA,EAAE,OACV,WAAYA,EAAE,YACd,OAAQ,UACR,UAAWA,EAAE,WACb,UAAWA,EAAE,YAGf,OAAA0B,EAAKQ,IAAW,CACd,mBAAoB,CAAC8N,EAAe,GAAG9N,EAAM,kBAAkB,GAC/D,EAEK8N,CACT,CACA,OAAO,IACT,MAAgB,CAEd,OAAO,IACT,CACF,EAEA,2BAA4B,MAAOjR,EAAcC,EAAUC,IAAiB,CAE1E,MAAMgR,EADQtO,EAAA,EACW,mBAAmB,KAAK3B,GAAKA,EAAE,KAAOjB,CAAY,EAC3E,GAAI,GAACkR,GAAcA,EAAW,SAAW,WAEzC,GAAI,CACF,KAAM,CAAE,cAAAnR,CAAA,EAAkB,MAAAsM,EAAA,8BAAAtM,CAAA,QAAM,2BAAAuM,CAAA,EAAwB,qBAAAvM,CAAA,YACvC,MAAMA,EAAc,QAAQC,EAAcC,EAAUC,CAAY,GAEpE,aAEXyC,EAAKQ,IAAW,CACd,mBAAoBA,EAAM,mBAAmB,IAAKlC,GAChDA,EAAE,KAAOjB,EACL,CACE,GAAGiB,EACH,OAAQhB,EAAW,WAAsB,WACzC,YAAa,IAAI,OAAO,cACxB,aAAAC,CAAA,EAEFe,CAAA,CACN,EACA,EAGEhB,IACF0C,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,IAAKlC,GAC5BA,EAAE,KAAOiQ,EAAW,UAChB,CACE,GAAGjQ,EACH,cAAeiQ,EAAW,aAC1B,cAAeA,EAAW,cAE5BjQ,CAAA,CACN,EACA,EAGF2B,EAAA,EAAM,iBAGZ,MAAgB,CAEhB,CACF,EAEA,+BAAiChD,GACxBgD,IAAM,mBAAmB,OAAO3B,GAAKA,EAAE,YAAcrB,CAAS,EAGvE,4BAA8BjE,GACrBiH,EAAA,EAAM,mBAAmB,OAC9B3B,GAAKA,EAAE,cAAgBtF,GAAUsF,EAAE,SAAW,WAIlD,8BAAgCrB,GACvBgD,EAAA,EAAM,mBAAmB,KAC9B3B,GAAKA,EAAE,YAAcrB,GAAaqB,EAAE,SAAW,WAInD,iCAAmCrB,GAAc,CAE/C,MAAMuR,EAAY,KAAK,MAAQ,MAC/B,OAAOvO,EAAA,EAAM,mBAAmB,KAC9B3B,GAAKA,EAAE,YAAcrB,GAChBqB,EAAE,SAAW,YACbA,EAAE,aACF,IAAI,KAAKA,EAAE,WAAW,EAAE,UAAYkQ,CAAA,CAE7C,IAEF,CACE,KAAM,kBAGN,WAAahO,IAAW,CAEtB,SAAUA,EAAM,SAEhB,cAAeA,EAAM,cAAc,MAAM,EAAG,GAAG,IAEjD,MAAO,CAAC6D,EAAgBoK,IAAiB,CACvC,MAAMC,EAAYrK,EAEZsK,EAAWjI,GAAA,EAEjB,MAAO,CACL,GAAG+H,EACH,SAAUC,EAAU,UAAYD,EAAa,SAC7C,cAAeC,EAAU,eAAiB,GAE1C,SAAU,GACV,cAAe,GACf,SAAU,GACV,iBAAkB,CAACC,CAAQ,EAC3B,UAAW,GACX,mBAAoB,GACpB,iBAAkB,GAClB,cAAe,EAAC,CAEpB,EACF,CAEJ,EAII,OAAO,OAAW,KACpB,OAAO,iBAAiB,UAAY7I,GAAU,CAC5C,GAAIA,EAAM,MAAQ,mBAAqBA,EAAM,SAC3C,GAAI,CACF,MAAM8I,EAAS,KAAK,MAAM9I,EAAM,QAAQ,EACpC8I,EAAO,OAAO,kBAEhB9H,EAAa,SAAS,CAAE,iBAAkB8H,EAAO,MAAM,iBAAkB,CAE7E,MAAY,CAEZ,CAEJ,CAAC,EC/mFH,MAAMC,GAAyD,CAC7D,GAAI,CAEF,WAAY,YACZ,eAAgB,cAGhB,aAAc,iBACd,aAAc,QACd,gBAAiB,SACjB,aAAc,QACd,aAAc,4BACd,cAAe,QAGf,gBAAiB,UACjB,eAAgB,SAChB,gBAAiB,cACjB,gBAAiB,SACjB,gBAAiB,SACjB,eAAgB,kBAChB,cAAe,SACf,eAAgB,YAChB,iBAAkB,aAClB,iBAAkB,aAClB,eAAgB,SAChB,cAAe,UACf,WAAY,MACZ,cAAe,iBACf,mBAAoB,eACpB,eAAgB,gBAChB,aAAc,eACd,iBAAkB,mBAClB,gBAAiB,WAGjB,oBAAqB,mBACrB,kBAAmB,wBACnB,wBAAyB,eACzB,uBAAwB,WACxB,4BAA6B,wBAC7B,0BAA2B,sBAC3B,2BAA4B,mBAC5B,uBAAwB,gBACxB,2BAA4B,mBAC5B,oBAAqB,MAGrB,iBAAkB,YAClB,mBAAoB,gBACpB,mBAAoB,cACpB,iBAAkB,WAClB,sBAAuB,cACvB,mBAAoB,oBACpB,wBAAyB,8BAGzB,qBAAsB,WACtB,gBAAiB,SACjB,mBAAoB,UACpB,eAAgB,kBAChB,eAAgB,uBAChB,qBAAsB,YACtB,kBAAmB,WAGnB,eAAgB,kBAChB,iBAAkB,QAClB,uBAAwB,mBACxB,sBAAuB,wCAGvB,aAAc,QACd,kBAAmB,YACnB,kBAAmB,UACnB,qBAAsB,WACtB,0BAA2B,wBAC3B,mBAAoB,YACpB,mBAAoB,WAGpB,eAAgB,SAChB,kBAAmB,UACnB,gBAAiB,UACjB,kBAAmB,UAGnB,YAAa,MACb,aAAc,UACd,eAAgB,QAChB,iBAAkB,WAClB,aAAc,QACd,gBAAiB,SACjB,sBAAuB,gBACvB,gBAAiB,gBACjB,cAAe,SACf,WAAY,WACZ,YAAa,YACb,YAAa,SACb,YAAa,aACb,cAAe,eACf,eAAgB,qBAChB,mBAAoB,mBAGpB,cAAe,gBACf,cAAe,QACf,eAAgB,aAChB,eAAgB,YAChB,gBAAiB,iBAGjB,mBAAoB,QACpB,yBAA0B,cAC1B,wBAAyB,aACzB,iBAAkB,eAClB,oBAAqB,OAGrB,aAAc,MACd,gBAAiB,UACjB,cAAe,gBACf,cAAe,WACf,iBAAkB,WAClB,iBAAkB,cAClB,gBAAiB,aAGjB,eAAgB,iBAChB,sBAAuB,oBACvB,sBAAuB,mBACvB,kBAAmB,kDACnB,kBAAmB,SACnB,mBAAoB,WACpB,iBAAkB,UAClB,sBAAuB,gBACvB,eAAgB,KAChB,yBAA0B,mBAC1B,eAAgB,WAChB,mBAAoB,kBACpB,uBAAwB,iBACxB,mBAAoB,mBACpB,gBAAiB,UACjB,uBAAwB,WACxB,mBAAoB,6BACpB,oBAAqB,eACrB,sBAAuB,oBACvB,iBAAkB,cAClB,kBAAmB,cACnB,gBAAiB,QACjB,kBAAmB,SACnB,eAAgB,wBAChB,wBAAyB,sBACzB,0BAA2B,8BAC3B,6BAA8B,6BAC9B,uBAAwB,uBACxB,4BAA6B,+DAC7B,uBAAwB,kBAGxB,sBAAuB,eACvB,iBAAkB,mBAClB,oBAAqB,UACrB,iBAAkB,UAClB,qBAAsB,eACtB,gBAAiB,cACjB,oBAAqB,0BACrB,wBAAyB,iDACzB,aAAc,SACd,mBAAoB,YACpB,qBAAsB,mBACtB,eAAgB,QAChB,gBAAiB,QACjB,oBAAqB,SACrB,sBAAuB,QACvB,uBAAwB,QAGxB,sBAAuB,aACvB,6BAA8B,cAC9B,yBAA0B,kBAC1B,oBAAqB,sBACrB,gCAAiC,sBACjC,yBAA0B,6BAC1B,2BAA4B,YAC5B,wBAAyB,aACzB,qBAAsB,MACtB,yBAA0B,YAC1B,0BAA2B,8BAC3B,+BAAgC,UAChC,kCAAmC,SACnC,+BAAgC,UAChC,sBAAuB,aACvB,uBAAwB,QACxB,0BAA2B,UAC3B,gCAAiC,iBACjC,iCAAkC,iBAClC,sBAAuB,uBACvB,oBAAqB,QAGrB,iBAAkB,mBAClB,oBAAqB,oCACrB,kBAAmB,mBACnB,sBAAuB,oBACvB,uBAAwB,2BAGxB,wBAAyB,WACzB,qCAAsC,eACtC,qCAAsC,aACtC,qCAAsC,kBACtC,8BAA+B,cAC/B,gCAAiC,sBACjC,oCAAqC,qBACrC,qCAAsC,iBACtC,oCAAqC,qBACrC,4BAA6B,WAG7B,yBAA0B,SAC1B,0BAA2B,QAC3B,yBAA0B,YAG1B,wBAAyB,eACzB,wBAAyB,eACzB,wBAAyB,eACzB,wBAAyB,aACzB,gCAAiC,cACjC,oCAAqC,sBACrC,sCAAuC,uBACvC,+BAAgC,oBAChC,+BAAgC,4BAChC,oCAAqC,uBACrC,gCAAiC,oBACjC,sCAAuC,WACvC,kCAAmC,uBACnC,4BAA6B,iBAC7B,mCAAoC,uCACpC,+BAAgC,8BAChC,2BAA4B,2CAC5B,0BAA2B,0BAC3B,4BAA6B,qBAG7B,0BAA2B,wBAC3B,4BAA6B,aAC7B,6BAA8B,YAC9B,0BAA2B,UAC3B,2BAA4B,4BAC5B,8BAA+B,oBAG/B,wBAAyB,0BACzB,sBAAuB,KACvB,0BAA2B,SAC3B,0BAA2B,eAC3B,wBAAyB,mBACzB,2BAA4B,uBAC5B,6BAA8B,iBAC9B,8BAA+B,oBAC/B,iCAAkC,uBAClC,2BAA4B,qBAC5B,0BAA2B,gBAC3B,4BAA6B,qBAC7B,0BAA2B,mBAC3B,6BAA8B,eAC9B,6BAA8B,6BAG9B,yBAA0B,yBAC1B,4BAA6B,UAC7B,4BAA6B,aAC7B,0BAA2B,SAC3B,iCAAkC,mBAClC,oCAAqC,sBACrC,iCAAkC,UAClC,4BAA6B,KAC7B,gCAAiC,SACjC,gCAAiC,eACjC,6BAA8B,YAG9B,0BAA2B,oBAC3B,6BAA8B,wBAC9B,6BAA8B,cAC9B,yBAA0B,qBAC1B,2BAA4B,oBAC5B,6BAA8B,YAG9B,2BAA4B,WAC5B,0BAA2B,YAC3B,8BAA+B,sBAC/B,+BAAgC,sBAChC,kCAAmC,qBACnC,0BAA2B,oBAC3B,+BAAgC,YAChC,8BAA+B,eAC/B,iCAAkC,YAGlC,0BAA2B,8BAC3B,+BAAgC,wBAChC,oCAAqC,6BACrC,6BAA8B,sBAC9B,iCAAkC,4BAClC,mCAAoC,8BACpC,gCAAiC,0BAGjC,0BAA2B,qBAC3B,+BAAgC,iBAChC,wCAAyC,uBACzC,oCAAqC,0BACrC,oCAAqC,yBACrC,2BAA4B,aAC5B,4CAA6C,+BAC7C,sCAAuC,yBACvC,+BAAgC,uBAChC,4CAA6C,sCAG7C,0BAA2B,sBAC3B,6BAA8B,gBAC9B,+BAAgC,gBAChC,gCAAiC,sBACjC,iCAAkC,wBAGlC,mBAAoB,gBACpB,sBAAuB,iBACvB,wBAAyB,8CACzB,yBAA0B,4BAC1B,mBAAoB,mBACpB,gBAAiB,UACjB,kBAAmB,yBACnB,oBAAqB,mBACrB,oBAAqB,2CACrB,mBAAoB,mBACpB,uBAAwB,8DACxB,qBAAsB,wBACtB,mBAAoB,gCACpB,cAAe,UACf,eAAgB,UAGhB,aAAc,gBACd,eAAgB,WAChB,uBAAwB,eACxB,gBAAiB,cACjB,gBAAiB,SACjB,eAAgB,YAChB,mBAAoB,WACpB,gBAAiB,SAGjB,iBAAkB,SAClB,eAAgB,kBAChB,gBAAiB,uBACjB,kBAAmB,iBACnB,mBAAoB,QACpB,gBAAiB,WACjB,kBAAmB,SACnB,qBAAsB,YACtB,sBAAuB,UACvB,qBAAsB,UACtB,uBAAwB,kBACxB,oBAAqB,yBAGrB,cAAe,eACf,YAAa,wBACb,aAAc,gBACd,eAAgB,UAChB,aAAc,mBACd,cAAe,UACf,cAAe,QACf,cAAe,qBACf,iBAAkB,yBAGlB,gBAAiB,gBACjB,iBAAkB,cAClB,kBAAmB,SACnB,eAAgB,gBAChB,sBAAuB,mBACvB,qBAAsB,kBAGtB,kBAAmB,mBACnB,mBAAoB,gBACpB,mBAAoB,eACpB,mBAAoB,SACpB,qBAAsB,cACtB,qBAAsB,kBACtB,yBAA0B,mBAG1B,iBAAkB,kBAClB,mBAAoB,UACpB,mBAAoB,YACpB,mBAAoB,UACpB,iBAAkB,iBAClB,kBAAmB,mBACnB,sBAAuB,cACvB,gBAAiB,eACjB,kBAAmB,WACnB,qBAAsB,QACtB,mBAAoB,SAGpB,mBAAoB,qBACpB,oBAAqB,oBACrB,oBAAqB,eACrB,sBAAuB,WACvB,oBAAqB,SACrB,qBAAsB,WACtB,qBAAsB,WACtB,sBAAuB,aACvB,kBAAmB,aAGnB,cAAe,aACf,kBAAmB,YACnB,iBAAkB,YAClB,kBAAmB,WACnB,eAAgB,UAChB,gBAAiB,gBACjB,gBAAiB,6BAGjB,iBAAkB,aAClB,iBAAkB,UAClB,oBAAqB,SACrB,oBAAqB,iBACrB,sBAAuB,4BACvB,oBAAqB,mBAGrB,aAAc,MACd,eAAgB,YAChB,kBAAmB,kBACnB,mBAAoB,uBACpB,YAAa,YACb,kBAAmB,gBACnB,yBAA0B,kBAG1B,cAAe,kBACf,mBAAoB,cACpB,mBAAoB,eACpB,eAAgB,gBAChB,eAAgB,UAChB,gBAAiB,QACjB,aAAc,cACd,iBAAkB,qBAClB,iBAAkB,uBAClB,iBAAkB,kBAClB,kBAAmB,mBAGnB,gBAAiB,kBACjB,eAAgB,cAChB,mBAAoB,kBACpB,gBAAiB,mBACjB,kBAAmB,qBACnB,kBAAmB,YACnB,gBAAiB,mBACjB,eAAgB,mBAGhB,gBAAiB,YACjB,cAAe,qBACf,gBAAiB,QACjB,gBAAiB,QACjB,gBAAiB,SACjB,gBAAiB,OACjB,gBAAiB,WACjB,qBAAsB,+BACtB,iBAAkB,kBAGlB,iBAAkB,UAClB,kBAAmB,iBACnB,kBAAmB,SACnB,kBAAmB,WACnB,mBAAoB,qBACpB,qBAAsB,cACtB,mBAAoB,iBACpB,oBAAqB,cACrB,gBAAiB,YAGjB,gBAAiB,cACjB,uBAAwB,qBACxB,0BAA2B,eAC3B,oBAAqB,kBACrB,uBAAwB,kBACxB,gBAAiB,UACjB,uBAAwB,YACxB,mBAAoB,SACpB,0BAA2B,iBAC3B,sBAAuB,eACvB,0BAA2B,qBAC3B,0BAA2B,yBAC3B,qBAAsB,mBAGtB,gBAAiB,mBACjB,gBAAiB,cACjB,qBAAsB,yBACtB,kBAAmB,kBACnB,iBAAkB,aAClB,iBAAkB,mBAGlB,iBAAkB,uBAClB,iBAAkB,WAClB,cAAe,KACf,aAAc,MACd,eAAgB,cAGhB,aAAc,UACd,iBAAkB,QAClB,eAAgB,aAChB,gBAAiB,cACjB,kBAAmB,cACnB,eAAgB,cAElB,GAAI,CAEF,WAAY,YACZ,eAAgB,aAGhB,aAAc,iBACd,aAAc,QACd,gBAAiB,QACjB,aAAc,SACd,aAAc,6BACd,cAAe,UAGf,gBAAiB,mBACjB,eAAgB,WAChB,gBAAiB,aACjB,gBAAiB,QACjB,gBAAiB,UACjB,eAAgB,mBAChB,cAAe,aACf,eAAgB,aAChB,iBAAkB,aAClB,iBAAkB,oBAClB,eAAgB,YAChB,cAAe,SACf,WAAY,UACZ,cAAe,mBACf,mBAAoB,mBACpB,eAAgB,mBAChB,aAAc,aACd,iBAAkB,iBAClB,gBAAiB,aAGjB,oBAAqB,iBACrB,kBAAmB,uBACnB,wBAAyB,iBACzB,uBAAwB,YACxB,4BAA6B,wBAC7B,0BAA2B,4BAC3B,2BAA4B,oBAC5B,uBAAwB,sBACxB,2BAA4B,mBAC5B,oBAAqB,UAGrB,iBAAkB,YAClB,mBAAoB,kBACpB,mBAAoB,UACpB,iBAAkB,cAClB,sBAAuB,kBACvB,mBAAoB,qBACpB,wBAAyB,iCAGzB,qBAAsB,SACtB,gBAAiB,OACjB,mBAAoB,SACpB,eAAgB,oBAChB,eAAgB,mBAChB,qBAAsB,aACtB,kBAAmB,OAGnB,eAAgB,iBAChB,iBAAkB,OAClB,uBAAwB,kBACxB,sBAAuB,mDAGvB,aAAc,QACd,kBAAmB,cACnB,kBAAmB,iBACnB,qBAAsB,YACtB,0BAA2B,wBAC3B,mBAAoB,aACpB,mBAAoB,iBAGpB,eAAgB,OAChB,kBAAmB,QACnB,gBAAiB,SACjB,kBAAmB,cAGnB,YAAa,SACb,aAAc,UACd,eAAgB,SAChB,iBAAkB,WAClB,aAAc,QACd,gBAAiB,QACjB,sBAAuB,gBACvB,gBAAiB,WACjB,cAAe,eACf,WAAY,WACZ,YAAa,UACb,YAAa,SACb,YAAa,YACb,cAAe,cACf,eAAgB,gCAChB,mBAAoB,sBAGpB,cAAe,iBACf,cAAe,QACf,eAAgB,iBAChB,eAAgB,WAChB,gBAAiB,cAGjB,mBAAoB,SACpB,yBAA0B,mBAC1B,wBAAyB,kBACzB,iBAAkB,mBAClB,oBAAqB,MAGrB,aAAc,UACd,gBAAiB,YACjB,cAAe,aACf,cAAe,UACf,iBAAkB,YAClB,iBAAkB,iBAClB,gBAAiB,gBAGjB,eAAgB,mBAChB,sBAAuB,oBACvB,sBAAuB,wBACvB,kBAAmB,wDACnB,kBAAmB,OACnB,mBAAoB,QACpB,iBAAkB,WAClB,sBAAuB,iBACvB,eAAgB,QAChB,yBAA0B,uBAC1B,eAAgB,QAChB,mBAAoB,iBACpB,uBAAwB,eACxB,mBAAoB,qBACpB,gBAAiB,OACjB,uBAAwB,OACxB,mBAAoB,8BACpB,oBAAqB,iBACrB,sBAAuB,uBACvB,iBAAkB,gBAClB,kBAAmB,iBACnB,gBAAiB,QACjB,kBAAmB,UACnB,eAAgB,sBAChB,wBAAyB,sBACzB,0BAA2B,6BAC3B,6BAA8B,uBAC9B,uBAAwB,yBACxB,4BAA6B,oEAC7B,uBAAwB,kBAGxB,sBAAuB,mBACvB,iBAAkB,gBAClB,oBAAqB,cACrB,iBAAkB,WAClB,qBAAsB,iBACtB,gBAAiB,iBACjB,oBAAqB,+BACrB,wBAAyB,mDACzB,aAAc,QACd,mBAAoB,cACpB,qBAAsB,sBACtB,eAAgB,SAChB,gBAAiB,SACjB,oBAAqB,SACrB,sBAAuB,SACvB,uBAAwB,UAGxB,sBAAuB,WACvB,6BAA8B,UAC9B,yBAA0B,aAC1B,oBAAqB,iBACrB,gCAAiC,qBACjC,yBAA0B,4BAC1B,2BAA4B,WAC5B,wBAAyB,UACzB,qBAAsB,OACtB,yBAA0B,WAC1B,0BAA2B,kCAC3B,+BAAgC,QAChC,kCAAmC,QACnC,+BAAgC,cAChC,sBAAuB,aACvB,uBAAwB,UACxB,0BAA2B,aAC3B,gCAAiC,oBACjC,iCAAkC,kBAClC,sBAAuB,sBACvB,oBAAqB,QAGrB,iBAAkB,0BAClB,oBAAqB,4CACrB,kBAAmB,sBACnB,sBAAuB,yBACvB,uBAAwB,gCAGxB,wBAAyB,WACzB,qCAAsC,gBACtC,qCAAsC,eACtC,qCAAsC,oBACtC,8BAA+B,cAC/B,gCAAiC,sBACjC,oCAAqC,0BACrC,qCAAsC,mBACtC,oCAAqC,yBACrC,4BAA6B,gBAG7B,yBAA0B,SAC1B,0BAA2B,YAC3B,yBAA0B,UAG1B,wBAAyB,iBACzB,wBAAyB,cACzB,wBAAyB,eACzB,wBAAyB,QACzB,gCAAiC,eACjC,oCAAqC,qBACrC,sCAAuC,wBACvC,+BAAgC,oBAChC,+BAAgC,kCAChC,oCAAqC,4BACrC,gCAAiC,mBACjC,sCAAuC,SACvC,kCAAmC,4BACnC,4BAA6B,yBAC7B,mCAAoC,8CACpC,+BAAgC,qBAChC,2BAA4B,2CAC5B,0BAA2B,2BAC3B,4BAA6B,mBAG7B,0BAA2B,uBAC3B,4BAA6B,cAC7B,6BAA8B,oBAC9B,0BAA2B,OAC3B,2BAA4B,sBAC5B,8BAA+B,oBAG/B,wBAAyB,yBACzB,sBAAuB,SACvB,0BAA2B,SAC3B,0BAA2B,UAC3B,wBAAyB,qBACzB,2BAA4B,4BAC5B,6BAA8B,sBAC9B,8BAA+B,oBAC/B,iCAAkC,0BAClC,2BAA4B,sBAC5B,0BAA2B,eAC3B,4BAA6B,iBAC7B,0BAA2B,gBAC3B,6BAA8B,gBAC9B,6BAA8B,oCAG9B,yBAA0B,yBAC1B,4BAA6B,gBAC7B,4BAA6B,kBAC7B,0BAA2B,SAC3B,iCAAkC,eAClC,oCAAqC,iBACrC,iCAAkC,WAClC,4BAA6B,SAC7B,gCAAiC,SACjC,gCAAiC,UACjC,6BAA8B,QAG9B,0BAA2B,wBAC3B,6BAA8B,qBAC9B,6BAA8B,cAC9B,yBAA0B,uBAC1B,2BAA4B,uBAC5B,6BAA8B,YAG9B,2BAA4B,aAC5B,0BAA2B,YAC3B,8BAA+B,uBAC/B,+BAAgC,uBAChC,kCAAmC,2BACnC,0BAA2B,2BAC3B,+BAAgC,WAChC,8BAA+B,cAC/B,iCAAkC,cAGlC,0BAA2B,4BAC3B,+BAAgC,uBAChC,oCAAqC,+BACrC,6BAA8B,sBAC9B,iCAAkC,yBAClC,mCAAoC,qCACpC,gCAAiC,+BAGjC,0BAA2B,wBAC3B,+BAAgC,eAChC,wCAAyC,sBACzC,oCAAqC,mBACrC,oCAAqC,iBACrC,2BAA4B,aAC5B,4CAA6C,4BAC7C,sCAAuC,yBACvC,+BAAgC,wBAChC,4CAA6C,gCAG7C,0BAA2B,oBAC3B,6BAA8B,oBAC9B,+BAAgC,eAChC,gCAAiC,0BACjC,iCAAkC,yBAGlC,mBAAoB,iBACpB,sBAAuB,iBACvB,wBAAyB,gDACzB,yBAA0B,6BAC1B,mBAAoB,mBACpB,gBAAiB,YACjB,kBAAmB,yBACnB,oBAAqB,iBACrB,oBAAqB,gDACrB,mBAAoB,iBACpB,uBAAwB,sEACxB,qBAAsB,0BACtB,mBAAoB,kCACpB,cAAe,SACf,eAAgB,eAGhB,aAAc,gBACd,eAAgB,UAChB,uBAAwB,mBACxB,gBAAiB,UACjB,gBAAiB,QACjB,eAAgB,YAChB,mBAAoB,WACpB,gBAAiB,UAGjB,iBAAkB,UAClB,eAAgB,gBAChB,gBAAiB,oBACjB,kBAAmB,mBACnB,mBAAoB,SACpB,gBAAiB,OACjB,kBAAmB,WACnB,qBAAsB,YACtB,sBAAuB,cACvB,qBAAsB,UACtB,uBAAwB,oBACxB,oBAAqB,2BAGrB,cAAe,aACf,YAAa,mBACb,aAAc,aACd,eAAgB,YAChB,aAAc,eACd,cAAe,UACf,cAAe,QACf,cAAe,cACf,iBAAkB,uBAGlB,gBAAiB,mBACjB,iBAAkB,eAClB,kBAAmB,SACnB,eAAgB,OAChB,sBAAuB,gBACvB,qBAAsB,qBAGtB,kBAAmB,iBACnB,mBAAoB,kBACpB,mBAAoB,gBACpB,mBAAoB,QACpB,qBAAsB,UACtB,qBAAsB,SACtB,yBAA0B,sBAG1B,iBAAkB,mBAClB,mBAAoB,YACpB,mBAAoB,aACpB,mBAAoB,aACpB,iBAAkB,iBAClB,kBAAmB,mBACnB,sBAAuB,gBACvB,gBAAiB,gBACjB,kBAAmB,UACnB,qBAAsB,OACtB,mBAAoB,cAGpB,mBAAoB,oBACpB,oBAAqB,eACrB,oBAAqB,gBACrB,sBAAuB,YACvB,oBAAqB,UACrB,qBAAsB,YACtB,qBAAsB,aACtB,sBAAuB,eACvB,kBAAmB,cAGnB,cAAe,aACf,kBAAmB,aACnB,iBAAkB,WAClB,kBAAmB,QACnB,eAAgB,UAChB,gBAAiB,gBACjB,gBAAiB,iCAGjB,iBAAkB,SAClB,iBAAkB,QAClB,oBAAqB,SACrB,oBAAqB,WACrB,sBAAuB,+BACvB,oBAAqB,iBAGrB,aAAc,OACd,eAAgB,SAChB,kBAAmB,cACnB,mBAAoB,kBACpB,YAAa,WACb,kBAAmB,gBACnB,yBAA0B,oBAG1B,cAAe,iBACf,mBAAoB,eACpB,mBAAoB,cACpB,eAAgB,iBAChB,eAAgB,OAChB,gBAAiB,kBACjB,aAAc,cACd,iBAAkB,sBAClB,iBAAkB,kBAClB,iBAAkB,kBAClB,kBAAmB,iBAGnB,gBAAiB,iBACjB,eAAgB,aAChB,mBAAoB,oBACpB,gBAAiB,cACjB,kBAAmB,gBACnB,kBAAmB,sBACnB,gBAAiB,kBACjB,eAAgB,qBAGhB,gBAAiB,YACjB,cAAe,qBACf,gBAAiB,QACjB,gBAAiB,QACjB,gBAAiB,QACjB,gBAAiB,OACjB,gBAAiB,QACjB,qBAAsB,gCACtB,iBAAkB,0BAGlB,iBAAkB,YAClB,kBAAmB,mBACnB,kBAAmB,QACnB,kBAAmB,aACnB,mBAAoB,kBACpB,qBAAsB,oBACtB,mBAAoB,gBACpB,oBAAqB,cACrB,gBAAiB,WAGjB,gBAAiB,kBACjB,uBAAwB,2BACxB,0BAA2B,gBAC3B,oBAAqB,gBACrB,uBAAwB,wBACxB,gBAAiB,UACjB,uBAAwB,iBACxB,mBAAoB,QACpB,0BAA2B,cAC3B,sBAAuB,cACvB,0BAA2B,qBAC3B,0BAA2B,qCAC3B,qBAAsB,mBAGtB,gBAAiB,oBACjB,gBAAiB,gBACjB,qBAAsB,+BACtB,kBAAmB,qBACnB,iBAAkB,YAClB,iBAAkB,0BAGlB,iBAAkB,yBAClB,iBAAkB,eAClB,cAAe,KACf,aAAc,OACd,eAAgB,wBAGhB,aAAc,QACd,iBAAkB,QAClB,eAAgB,YAChB,gBAAiB,aACjB,kBAAmB,eACnB,eAAgB,YAEpB,EAEaC,GAAmBhP,GAAA,EAC9BC,GACE,CAACC,EAAKC,KAAS,CACb,SAAU,KACV,YAAc8O,GAAS/O,EAAI,CAAE,SAAU+O,EAAM,EAC7C,EAAInY,GAAQ,CACV,KAAM,CAAE,SAAAoY,CAAA,EAAa/O,EAAA,EACrB,OAAO4O,GAAaG,CAAQ,EAAEpY,CAAG,GAAKA,CACxC,IAEF,CACE,KAAM,mBACR,CAEJ,ECziCMqY,EAAqBlY,GAAuB,CAEhD,MAAMmY,EAAY,CAACtP,EAAYuP,EAAoB,KAAO,CACxD,GAAIvP,GAAU,KAA6B,OAAOuP,EAClD,GAAI,OAAOvP,GAAU,SACnB,GAAI,CAAE,OAAO,KAAK,MAAMA,CAAK,CAAG,MAAQ,CAAE,OAAOuP,CAAc,CAEjE,OAAOvP,CACT,EAGMwP,EAAiBC,IAAe,CACpC,GAAIA,EAAK,GACT,KAAMA,EAAK,KACX,MAAOA,EAAK,MACZ,YAAaA,EAAK,YAClB,UAAWA,EAAK,UAChB,SAAUA,EAAK,gBAAkBA,EAAK,UAAY,EAClD,aAAcA,EAAK,oBAAsBA,EAAK,cAAgB,EAC9D,aAAcA,EAAK,oBAAsBA,EAAK,cAAgB,EAC9D,MAAOA,EAAK,YAAcA,EAAK,OAAS,EACxC,WAAYA,EAAK,YACjB,SAAUA,EAAK,SACf,UAAWH,EAAUG,EAAK,UAAW,EAAE,IAInCC,EAAqBC,IAAc,CACvC,GAAIA,EAAI,GACR,SAAUA,EAAI,WAAaA,EAAI,SAC/B,aAAcA,EAAI,aAAeA,EAAI,YAAcA,EAAI,gBAAkBA,EAAI,cAAgB,EAC7F,WAAYA,EAAI,aAAeA,EAAI,YAAc,EACjD,UAAWA,EAAI,YAAcA,EAAI,YAAcA,EAAI,OAAO,QAAU,GACpE,OAAQA,EAAI,QAAU,GACtB,MAAOA,EAAI,OAASA,EAAI,QAAU,EAAC,GAGrC,MAAO,CACL,GAAIxY,EAAK,GACT,OAAQA,EAAK,OACb,WAAYA,EAAK,aAAeA,EAAK,WACrC,gBAAiBA,EAAK,kBAAoBA,EAAK,gBAC/C,cAAeA,EAAK,gBAAkBA,EAAK,cAC3C,YAAaA,EAAK,cAAgBA,EAAK,YACvC,cAAeA,EAAK,gBAAkBA,EAAK,cAC3C,OAAQA,EAAK,OACb,OAAQA,EAAK,OACb,gBAAiBmY,EAAUnY,EAAK,kBAAoBA,EAAK,gBAAiB,EAAE,EAAE,IAAIuY,CAAiB,EACnG,mBAAoBvY,EAAK,uBAAyBA,EAAK,mBACvD,kBAAmBA,EAAK,qBAAuBA,EAAK,kBACpD,SAAUA,EAAK,SACf,aAAcA,EAAK,aAAemY,EAAUnY,EAAK,aAAc,EAAE,GAAG,IAAIqY,CAAa,EACrF,UAAWF,EAAUnY,EAAK,UAAW,EAAE,EACvC,eAAgBmY,EAAUnY,EAAK,iBAAmBA,EAAK,eAAgB,EAAE,EACzE,eAAgBmY,EAAUnY,EAAK,iBAAmBA,EAAK,eAAgB,EAAE,EACzE,mBAAoBA,EAAK,sBAAwBA,EAAK,oBAAsB,EAC5E,mBAAoBmY,EAAUnY,EAAK,qBAAuBA,EAAK,mBAAoB,EAAE,EACrF,cAAe,GAAQA,EAAK,gBAAkBA,EAAK,eACnD,qBAAsBA,EAAK,uBAAyBA,EAAK,sBAAwB,EACjF,YAAaA,EAAK,cAAgBA,EAAK,YACvC,kBAAmBA,EAAK,oBAAsBA,EAAK,kBACnD,qBAAsBA,EAAK,yBAA2BA,EAAK,qBAC3D,oBAAqBA,EAAK,uBAAyBA,EAAK,oBACxD,eAAgBA,EAAK,kBAAoBA,EAAK,eAC9C,eAAgBA,EAAK,kBAAoBA,EAAK,eAC9C,mBAAoBA,EAAK,sBAAwBA,EAAK,mBACtD,WAAYA,EAAK,aAAeA,EAAK,WACrC,oBAAqBA,EAAK,uBAAyBA,EAAK,oBACxD,mBAAoBA,EAAK,sBAAwBA,EAAK,mBACtD,YAAaA,EAAK,cAAgBA,EAAK,YACvC,mBAAoBA,EAAK,qBAAuBA,EAAK,mBACrD,cAAemY,EAAUnY,EAAK,gBAAkBA,EAAK,cAAe,EAAE,EACtE,iBAAkBmY,EAAUnY,EAAK,mBAAqBA,EAAK,iBAAkB,EAAE,EAC/E,UAAWA,EAAK,YAAcA,EAAK,UAEvC,EAoBMyY,GAAwBzY,IAAyC,CACrE,GAAIA,EAAK,GACT,UAAWA,EAAK,WAChB,aAAcA,EAAK,eACnB,QAASA,EAAK,SACd,UAAWA,EAAK,WAChB,YAAaA,EAAK,aAClB,gBAAiBA,EAAK,iBACtB,eAAgBA,EAAK,gBACrB,OAAQA,EAAK,OACb,mBAAoBA,EAAK,oBACzB,YAAa,EAAQA,EAAK,aAC1B,QAASA,EAAK,SACd,SAAUA,EAAK,UACf,SAAU,EAAQA,EAAK,UACvB,eAAgBA,EAAK,gBACvB,GAiBM0Y,GAAsB1Y,IAA4C,CACtE,GAAIA,EAAK,GACT,UAAWA,EAAK,WAChB,OAAQA,EAAK,OACb,YAAaA,EAAK,aAClB,QAASA,EAAK,QACd,aAAcA,EAAK,cACnB,WAAYA,EAAK,qBAAuB,CACtC,OAAQA,EAAK,qBACb,KAAMA,EAAK,mBAAqB,GAChC,KAAMA,EAAK,mBAAqB,GAChC,SAAUA,EAAK,iBAAmB,GAClC,cAAeA,EAAK,mBAAqB,IACvC,OACJ,YAAa,KAAK,MAAMA,EAAK,aAAe,IAAI,CAClD,GAkBM2Y,GAAuB3Y,IAAuC,CAClE,GAAIA,EAAK,GACT,OAAQA,EAAK,QACb,MAAOA,EAAK,MACZ,KAAMA,EAAK,KACX,QAASA,EAAK,QACd,UAAWA,EAAK,WAChB,aAAcA,EAAK,eACnB,SAAUA,EAAK,SACf,YAAaA,EAAK,aAClB,UAAWA,EAAK,WAChB,UAAWA,EAAK,WAChB,OAAQ,EAAQA,EAAK,QACrB,WAAYA,EAAK,WACnB,GAiBM4Y,GAAwB5Y,IAAyC,CACrE,GAAIA,EAAK,GACT,WAAYA,EAAK,YACjB,YAAaA,EAAK,aAClB,gBAAiBA,EAAK,iBACtB,UAAWA,EAAK,WAChB,eAAgBA,EAAK,gBACrB,QAASA,EAAK,SACd,UAAWA,EAAK,WAChB,WAAY,KAAK,MAAMA,EAAK,cAAgB,IAAI,EAChD,WAAY,EAAQA,EAAK,YACzB,WAAYA,EAAK,YACjB,WAAYA,EAAK,WACnB,GAgBM6Y,GAA8B7Y,IAA4D,CAC9F,WAAYA,EAAK,YACjB,WAAYA,EAAK,YACjB,qBAAsBA,EAAK,uBAC3B,yBAA0BA,EAAK,4BAC/B,oBAAqBA,EAAK,sBAC1B,wBAAyB,EAAQA,EAAK,0BACtC,kBAAmB,EAAQA,EAAK,mBAChC,mBAAoBA,EAAK,qBACzB,oBAAqB,KAAK,MAAMA,EAAK,uBAAyB,SAAS,EACvE,qBAAsB,KAAK,MAAMA,EAAK,uBAAyB,oBAAoB,CACrF,GAGM8Y,GAAuE,CAC3E,WAAY,YACZ,qBAAsB,GACtB,yBAA0B,EAC1B,oBAAqB,GACrB,wBAAyB,GACzB,kBAAmB,GACnB,mBAAoB,QACpB,oBAAqB,CAAC,GAAI,CAAC,EAC3B,qBAAsB,CAAC,SAAU,MAAM,CACzC,EAmIaC,GAAkBhQ,GAAA,EAC7BC,GACE,CAACC,EAAKC,KAAS,CACb,SAAU,GACV,YAAa,GACb,UAAW,GACX,WAAY,GACZ,YAAa,GACb,iBAAkB,GAClB,QAAS,GACT,MAAO,KAIP,cAAe,SAAY,CACzBD,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CAEF,MAAMpI,EAAW,MAAMyG,EAAgB,OAAO,CAAE,WAAY,GAAM,EAClE,GAAIzG,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMmY,EAAW,MAAM,QAAQnY,EAAS,IAAI,EAAIA,EAAS,KAAK,IAAIqX,CAAiB,EAAI,GACvFjP,EAAI,CAAE,SAAA+P,EAAU,QAAS,GAAO,CAClC,MACE/P,EAAI,CAAE,MAAOpI,EAAS,OAAS,2BAA4B,QAAS,GAAO,CAE/E,MAAgB,CACdoI,EAAI,CAAE,MAAO,gBAAiB,QAAS,GAAO,CAChD,CACF,EAEA,wBAAyB,MAAO1E,GAAe,CAC7C0E,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CACF,MAAMpI,EAAW,MAAMyG,EAAgB,OAAO,CAAE,WAAA/C,EAAY,EAC5D,GAAI1D,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMoY,EAAc,MAAM,QAAQpY,EAAS,IAAI,EAAIA,EAAS,KAAK,IAAIqX,CAAiB,EAAI,GAC1FjP,EAAKQ,IAGI,CAAE,SAAU,CAAC,GADEA,EAAM,SAAS,OAAOY,GAAKA,EAAE,aAAe9F,CAAU,EACtC,GAAG0U,CAAW,EAAG,QAAS,IACjE,CACH,MACEhQ,EAAI,CAAE,MAAOpI,EAAS,OAAS,2BAA4B,QAAS,GAAO,CAE/E,MAAgB,CACdoI,EAAI,CAAE,MAAO,gBAAiB,QAAS,GAAO,CAChD,CACF,EAEA,2BAA4B,MAAO1E,GAAe,CAChD,GAAI,CACF,MAAM1D,EAAW,MAAMyH,GAAsB,cAAc/D,CAAU,EACrE,GAAI1D,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMqY,EAAW,MAAM,QAAQrY,EAAS,IAAI,EAAIA,EAAS,KAAK,IAAI+X,EAAoB,EAAI,GAC1F3P,EAAKQ,IAEI,CAAE,YAAa,CAAC,GADJA,EAAM,YAAY,OAAO0P,GAAKA,EAAE,aAAe5U,CAAU,EACtC,GAAG2U,CAAQ,GAClD,CACH,CACF,MAAgB,CAEhB,CACF,EAIA,cAAe,MAAOlZ,GAAS,CAC7BiJ,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CACF,MAAMpI,EAAW,MAAMyG,EAAgB,OAAO,CAC5C,WAAYtH,EAAK,WACjB,gBAAiBA,EAAK,gBACtB,cAAeA,EAAK,gBAAkB,aAAe,KAAOA,EAAK,cACjE,OAAQA,EAAK,OACb,SAAUA,EAAK,SACf,YAAaA,EAAK,YAClB,YAAaA,EAAK,YAAY,IAAIsY,IAAS,CACzC,MAAOA,EAAK,MACZ,YAAaA,EAAK,YAClB,UAAWA,EAAK,WAChB,EACH,EACD,GAAIzX,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/C,OAAAoI,EAAKQ,IAAW,CAAE,SAAU,CAAC,GAAGA,EAAM,SAAUjC,CAAO,EAAG,QAAS,IAAQ,EACpEA,CACT,KACE,OAAAyB,EAAI,CAAE,MAAOpI,EAAS,OAAS,2BAA4B,QAAS,GAAO,EACrE,IAAI,MAAMA,EAAS,OAAS,0BAA0B,CAEhE,OAASC,EAAO,CACd,MAAAmI,EAAI,CAAE,MAAO,gBAAiB,QAAS,GAAO,EACxCnI,CACR,CACF,EAEA,cAAe,MAAO6B,EAAI3C,IAAS,CACjCiJ,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CAEF,MAAM6J,EAAmC,GACrC9S,EAAK,WAAa,SAAW8S,EAAQ,SAAW9S,EAAK,UACrDA,EAAK,cAAgB,SAAW8S,EAAQ,aAAe,KAAK,UAAU9S,EAAK,WAAW,GACtFA,EAAK,YAAc,SAAW8S,EAAQ,UAAY,KAAK,UAAU9S,EAAK,SAAS,GAC/EA,EAAK,iBAAmB,SAAW8S,EAAQ,gBAAkB,KAAK,UAAU9S,EAAK,cAAc,GAEnG,MAAMa,EAAW,MAAMyG,EAAgB,OAAO3E,EAAImQ,CAAO,EACzD,GAAIjS,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1H,EAAK6E,EAAU6C,CAAC,EAC3D,QAAS,IACT,CACJ,MACEpB,EAAI,CAAE,MAAOpI,EAAS,OAAS,2BAA4B,QAAS,GAAO,CAE/E,MAAgB,CACdoI,EAAI,CAAE,MAAO,gBAAiB,QAAS,GAAO,CAChD,CACF,EAEA,cAAe,MAAOtG,GAAO,CAC3BsG,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CACF,MAAM3B,EAAgB,OAAO3E,CAAE,EAC/BsG,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAAOY,GAAKA,EAAE,KAAO1H,CAAE,EAChD,YAAa8G,EAAM,YAAY,OAAO4G,GAAKA,EAAE,YAAc1N,CAAE,EAC7D,QAAS,IACT,CACJ,MAAgB,CACdsG,EAAI,CAAE,MAAO,gBAAiB,QAAS,GAAO,CAChD,CACF,EAEA,WAAatG,GACJuG,IAAM,SAAS,KAAKmB,GAAKA,EAAE,KAAO1H,CAAE,EAG7C,sBAAwB4B,GACf2E,IAAM,SAAS,OAAOmB,GAAKA,EAAE,aAAe9F,CAAU,EAG/D,uBAAyB6U,GAChBlQ,IAAM,SAAS,OAAOmB,GAAKA,EAAE,cAAgB+O,CAAW,EAGjE,6BAA+BnX,GACtBiH,EAAA,EAAM,SAAS,OAAOmB,GAEtB,CAAC,qBAAsB,qBAAsB,aAAa,EAAE,SAASA,EAAE,MAAM,EAM9EA,EAAE,eAAe,SAAW,EACvB,GAIFA,EAAE,eAAe,SAASpI,CAAM,EAV9B,EAWV,EAKH,oBAAqB,MAAO0F,GAAc,CACxC,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,OAAOK,CAAS,EACvD,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,eAAgB,MAAO1C,GAAc,CACnC,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,QAAQK,CAAS,EACxD,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,cAAe,MAAO1C,EAAW1E,IAAW,CAC1C,GAAI,CACF,MAAMpC,EAAW,MAAMyG,EAAgB,OAAOK,EAAW1E,CAAM,EAC/D,GAAIpC,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,iBAAkB,MAAO1C,GAAc,CACrC,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,iBAAiBK,CAAS,EACjE,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,gBAAiB,MAAO1C,EAAW0R,IAAqB,CACtD,GAAI,CACF,MAAMxY,EAAW,MAAMyG,EAAgB,gBAAgBK,EAAW0R,CAAgB,EAClF,GAAIxY,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,WAAY,MAAO1C,GAAc,CAC/B,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,WAAWK,CAAS,EAC3D,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,YAAa,MAAO1C,GAAc,CAChC,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,YAAYK,CAAS,EAC5D,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,eAAgB,MAAO1C,GAAc,CACnC,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,eAAeK,CAAS,EAC/D,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,iBAAkB,MAAO1C,GAAc,CACrC,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,iBAAiBK,CAAS,EACjE,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMyY,EAAWZ,GAAmB7X,EAAS,IAAI,EACjD,OAAAoI,EAAKQ,IAAW,CACd,UAAW,CAAC,GAAGA,EAAM,UAAW6P,CAAQ,GACxC,EACKA,CACT,CACA,MAAM,IAAI,MAAM,6BAA6B,CAC/C,OAASxY,EAAO,CAEd,MAAMA,CACR,CACF,EAEA,gBAAiB,MAAO6G,GAAc,CACpC,GAAI,CACF,MAAM9G,EAAW,MAAMyG,EAAgB,gBAAgBK,CAAS,EAChE,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAEA,cAAe,MAAO1C,EAAW1E,IAAW,CAC1C,GAAI,CACF,MAAMpC,EAAW,MAAMyG,EAAgB,OAAOK,EAAW1E,CAAM,EAC/D,GAAIpC,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAIA,gBAAiB,MAAO1C,EAAWF,IAAa,CAC9C,GAAI,CAEF,OADiB,MAAMM,GAAwB,KAAKJ,EAAWF,CAAQ,GAC1D,SAEX,MAAMyB,EAAA,EAAM,gBAEP,CAAE,QAAS,GACpB,OAASpI,EAAY,CAGnB,MAAO,CAAE,QAAS,GAAO,MADJA,GAAO,SAAW,mEACP,CAClC,CACF,EAEA,sBAAuB,MAAO6G,GAAc,CAC1C,GAAI,CACF,MAAM9G,EAAW,MAAMkH,GAAwB,UAAUJ,CAAS,EAClE,OAAI9G,EAAS,SAAWA,EAAS,MACxBA,EAAS,KAAK,UAAY,IAGrC,MAAgB,CAEd,OAAO,IACT,CACF,EAIA,iBAAkB,MAAO8G,EAAWM,EAAcC,EAASqR,EAAWC,EAAQC,EAAkBC,IAAY,CAC1G,GAAI,CAEF,GAAIF,IAAW,YACb,MAAM,IAAI,MAAM,4CAA4C,EAI9D,MAAMG,EAAYF,EAAiB,SAAW,MAAQ,MACrCA,EAAiB,SAAW,YAAc,YAC1CA,EAAiB,SAAW,QAAU,QAAU,QAE3D5Y,EAAW,MAAMmH,GAAsB,KAAKL,EAAWM,EAAc,CACzE,QAAAC,EACA,UAAAqR,EACA,OAAAC,EACA,mBAAoBG,EACpB,YAAaF,EAAiB,YAC9B,YAAaA,EAAiB,YAC9B,gBAAiBA,EAAiB,gBAClC,eAAgBA,EAAiB,eACjC,QAAAC,CAAA,CACD,EAGKE,EAAyB,CAC7B,GAAI,OAAO,aACX,UAAAjS,EACA,aAAAM,EACA,QAAAC,EACA,UAAAqR,EACA,OAAAC,EACA,mBAAoBG,EACpB,YAAaF,EAAiB,YAC9B,YAAaA,EAAiB,YAC9B,gBAAiBA,EAAiB,gBAClC,eAAgBA,EAAiB,eACjC,QAAS,IAAI,OAAO,cACpB,SAAU5Y,EAAS,MAAM,UAAY,GACrC,SAAU,IAGZ,OAAAoI,EAAKQ,IAAW,CACd,YAAa,CAAC,GAAGA,EAAM,YAAamQ,CAAU,EAE9C,SAAUnQ,EAAM,SAAS,IAAIY,GACvBA,EAAE,KAAO1C,GAAa,CAAC0C,EAAE,mBAAmB,SAASnC,CAAO,EACvD,CACL,GAAGmC,EACH,mBAAoB,CAAC,GAAGA,EAAE,mBAAoBnC,CAAO,GAGlDmC,CACR,GACD,EAEKuP,CACT,OAAS9Y,EAAO,CAEd,MAAMA,CACR,CACF,EAEA,cAAe,CAAC6G,EAAWM,EAAcC,IAChCgB,EAAA,EAAM,YACV,UAAYmH,EAAE,YAAc1I,GAAa0I,EAAE,eAAiBpI,GAAgBoI,EAAE,UAAYnI,CAAO,EACjG,KAAK,CAAC,EAAG2B,IAAM,IAAI,KAAKA,EAAE,OAAO,EAAE,UAAY,IAAI,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,CAAC,EAGpF,uBAAwB,MAAOlC,GAAsB,CACnD,GAAI,CACF,MAAM9G,EAAW,MAAMmH,GAAsB,WAAWL,CAAS,EACjE,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMgZ,EAAShZ,EAAS,KAAe,IAAI4X,EAAoB,EAG/D,OAAAxP,EAAKQ,GAAU,CACb,MAAMqQ,EAAc,IAAI,IAAIrQ,EAAM,YAAY,IAAI4G,GAAKA,EAAE,EAAE,CAAC,EACtD0J,EAAWF,EAAM,OAAOxJ,GAAK,CAACyJ,EAAY,IAAIzJ,EAAE,EAAE,CAAC,EACzD,MAAO,CACL,YAAa,CAAC,GAAG5G,EAAM,YAAa,GAAGsQ,CAAQ,EAEnD,CAAC,EAEMF,CACT,CACA,MAAO,EACT,MAAgB,CAEd,MAAO,EACT,CACF,EAIA,WAAY,MAAO5X,EAAQ+X,EAAOC,EAAStS,EAAWM,IAAiB,CACrE,GAAI,CAEF,MAAMiS,EAAaD,IAAY,eAAiB,cAAgBA,EAC1DpZ,EAAW,MAAMsH,GAAc,QAAQ,CAC3C,OAAAlG,EAAQ,MAAA+X,EACR,QAASE,EACT,UAAAvS,EAAW,aAAAM,CAAA,CACZ,EACD,GAAIpH,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMsZ,EAAYxB,GAAoB9X,EAAS,IAAI,EACnD,OAAAoI,EAAKQ,IAAW,CAAE,WAAY,CAAC,GAAGA,EAAM,WAAY0Q,CAAS,GAAI,EAC1DA,CACT,CACA,MAAM,IAAI,MAAM,uBAAuB,CACzC,OAASrZ,EAAO,CAEd,MAAMA,CACR,CACF,EAEA,UAAW,MAAOsH,EAAOpF,IAAS,CAChC,GAAI,CACF,MAAMnC,EAAW,MAAMsH,GAAc,OAAOC,EAAOpF,CAAI,EACvD,OAAInC,EAAS,SAAWA,EAAS,MAAM,UACrCoI,EAAKQ,IAAW,CACd,WAAYA,EAAM,WAAW,IAAI,GAC/B,EAAE,KAAOrB,EAAQ,CAAE,GAAG,EAAG,OAAQ,GAAM,WAAY,IAAI,OAAO,eAAkB,EAClF,EACA,EACK,KAGTa,EAAKQ,IAAW,CACd,WAAYA,EAAM,WAAW,IAAI,GAC/B,EAAE,KAAOrB,EAAQ,CAAE,GAAG,EAAG,SAAU,EAAE,SAAW,GAAM,EACxD,EACA,EACK,GACT,MAAgB,CAEd,MAAO,EACT,CACF,EAEA,aAAc,CAACnG,EAAQgY,IAAY,CACjC,MAAMrK,MAAU,KAChB,OAAO1G,EAAA,EAAM,WAAW,QAEpBgB,EAAE,SAAWjI,GACbiI,EAAE,UAAY+P,GACd,CAAC/P,EAAE,QACH,IAAI,KAAKA,EAAE,SAAS,EAAI0F,GACxB1F,EAAE,SAAWA,EAAE,YAErB,EAIA,0BAA2B,CAACvC,EAAWM,IAAiB,CACtD,MAAMT,EAAU0B,IAAM,WAAWvB,CAAS,EAC1C,GAAI,CAACH,EACH,MAAO,CACL,SAAU,EACV,aAAc,EACd,aAAc,EACd,WAAY,EACZ,WAAY,EACZ,WAAY,GACZ,aAAc,IAIlB,MAAM8Q,EAAO9Q,EAAQ,YAAY,KAAK+G,GAAKA,EAAE,KAAOtG,CAAY,EAChE,GAAI,CAACqQ,EACH,MAAO,CACL,SAAU,EACV,aAAc,EACd,aAAc,EACd,WAAY,EACZ,WAAY,EACZ,WAAY,GACZ,aAAc,IAKlB,MAAM8B,EAAW,OAAO9B,EAAK,UAAa,SAAWA,EAAK,SAAYA,EAAK,UAAkB,QAAU,EACjG+B,EAAe,OAAO/B,EAAK,cAAiB,SAAWA,EAAK,aAAgBA,EAAK,cAAsB,QAAU,EACjHgC,EAAe,OAAOhC,EAAK,cAAiB,SAAWA,EAAK,aAAgBA,EAAK,cAAsB,QAAU,EACjHiC,EAAaH,EAAWC,EAAeC,EAEvCE,EAAaD,EAAa,EAAKH,EAAWG,EAAc,IAAM,EAE9DE,EAAmB,CACvB,gBAAiB,GACjB,mBAAoB,GACpB,WAAY,MACZ,eAAgB,GAChB,UAAW,KACXnC,EAAK,SAAS,EAEVoC,EAAeF,EAAaC,EAC5BE,EAAaD,GAAgBlT,EAAQ,cAE3C,MAAO,CACL,SAAA4S,EACA,aAAAC,EACA,aAAAC,EACA,WAAAC,EACA,WAAAC,EACA,WAAAG,EACA,aAAAD,CAAA,CAEJ,EAEA,uBAAyB/S,GAAc,CACrC,MAAMH,EAAU0B,IAAM,WAAWvB,CAAS,EAC1C,GAAI,CAACH,EACH,MAAO,CAAE,aAAc,EAAG,MAAO,EAAG,QAAS,EAAG,cAAe,IAGjE,MAAMoT,EAAepT,EAAQ,oBAAoB,QAAU,EACrDqT,EAAQrT,EAAQ,oBAAsBA,EAAQ,gBAAgB,QAAU,EACxEsT,EAAUD,EAAQ,EAAKD,EAAeC,EAAS,IAAM,EAErDE,EAAgBvT,EAAQ,gBAAgB,eAAiB,GACzDwT,EAAgBxT,EAAQ,eAAkBsT,GAAWC,EAE3D,MAAO,CAAE,aAAAH,EAAc,MAAAC,EAAO,QAAAC,EAAS,cAAAE,CAAA,CACzC,EAIA,oBAAsBzW,GAAe,CACnC,MAAM0W,EAAW/R,IAAM,iBAAiB,KAAK,GAAK,EAAE,aAAe3E,CAAU,EAC7E,OAAI0W,GACG,CAAE,GAAGnC,GAAyB,WAAAvU,CAAA,CACvC,EAEA,sBAAuB,MAAOA,GAAe,CAC3C,GAAI,CACF,MAAM1D,EAAW,MAAMwH,GAA2B,IAAI9D,CAAU,EAChE,GAAI1D,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMwG,EAAWwR,GAA2BhY,EAAS,IAAI,EACzD,OAAAoI,EAAKQ,GACcA,EAAM,iBAAiB,KAAKyR,GAAKA,EAAE,aAAe3W,CAAU,EAEpE,CACL,iBAAkBkF,EAAM,iBAAiB,IAAIyR,GAC3CA,EAAE,aAAe3W,EAAa8C,EAAW6T,CAAA,CAC3C,EAGG,CAAE,iBAAkB,CAAC,GAAGzR,EAAM,iBAAkBpC,CAAQ,EAChE,EACMA,CACT,CACA,MAAO,CAAE,GAAGyR,GAAyB,WAAAvU,CAAA,CACvC,MAAgB,CAEd,MAAO,CAAE,GAAGuU,GAAyB,WAAAvU,CAAA,CACvC,CACF,EAEA,uBAAwB,MAAOA,EAAY8C,IAAa,CACtD,GAAI,CAEF,MAAMyL,EAAmC,GACrCzL,EAAS,aAAe,SAAWyL,EAAQ,YAAczL,EAAS,YAClEA,EAAS,uBAAyB,SAAWyL,EAAQ,uBAAyBzL,EAAS,sBACvFA,EAAS,2BAA6B,SAAWyL,EAAQ,4BAA8BzL,EAAS,0BAChGA,EAAS,sBAAwB,SAAWyL,EAAQ,sBAAwBzL,EAAS,qBACrFA,EAAS,0BAA4B,SAAWyL,EAAQ,0BAA4BzL,EAAS,yBAC7FA,EAAS,oBAAsB,SAAWyL,EAAQ,mBAAqBzL,EAAS,mBAChFA,EAAS,qBAAuB,SAAWyL,EAAQ,qBAAuBzL,EAAS,oBACnFA,EAAS,sBAAwB,SAAWyL,EAAQ,sBAAwB,KAAK,UAAUzL,EAAS,mBAAmB,GACvHA,EAAS,uBAAyB,SAAWyL,EAAQ,sBAAwB,KAAK,UAAUzL,EAAS,oBAAoB,GAE7H,MAAMxG,EAAW,MAAMwH,GAA2B,OAAO9D,EAAYuO,CAAO,EAC5E,GAAIjS,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMsa,EAAkBtC,GAA2BhY,EAAS,IAAI,EAChEoI,EAAKQ,GACcA,EAAM,iBAAiB,KAAKyR,GAAKA,EAAE,aAAe3W,CAAU,EAEpE,CACL,iBAAkBkF,EAAM,iBAAiB,IAAIyR,GAC3CA,EAAE,aAAe3W,EAAa4W,EAAkBD,CAAA,CAClD,EAGG,CAAE,iBAAkB,CAAC,GAAGzR,EAAM,iBAAkB0R,CAAe,EACvE,CACH,CACF,MAAgB,CAEhB,CACF,EAIA,cAAe,MAAO5S,GAAS,CAC7B,GAAI,CAEF,MAAM1H,EAAW,MAAMyH,GAAsB,OAAO,CAClD,WAAYC,EAAK,WACjB,YAAaA,EAAK,YAClB,gBAAiBA,EAAK,gBACtB,UAAWA,EAAK,UAChB,eAAgBA,EAAK,eACrB,QAASA,EAAK,QACd,UAAWA,EAAK,UAChB,WAAYA,EAAK,YAAc,EAAC,CACjC,EACD,GAAI1H,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMua,EAAaxC,GAAqB/X,EAAS,IAAI,EACrD,OAAAoI,EAAKQ,IAAW,CAAE,YAAa,CAAC,GAAGA,EAAM,YAAa2R,CAAU,GAAI,EAC7DA,CACT,CACA,MAAM,IAAI,MAAM,8BAA8B,CAChD,OAASta,EAAO,CAEd,MAAMA,CACR,CACF,EAEA,iBAAkB,MAAO6B,EAAI3C,IAAS,CAEpCiJ,EAAKQ,IAAW,CACd,YAAaA,EAAM,YAAY,OAAS0P,EAAE,KAAOxW,EAAK,CAAE,GAAGwW,EAAG,GAAGnZ,CAAA,EAASmZ,CAAC,GAC3E,CACJ,EAEA,yBAA2B5U,GAClB2E,IAAM,YAAY,OAAOiQ,GAAKA,EAAE,aAAe5U,CAAU,EAGlE,qBAAuBQ,GACdmE,EAAA,EAAM,YAAY,QAClBiQ,EAAE,UAAYpU,GAAWoU,EAAE,YAAY,SAASpU,CAAO,GAIhE,iBAAkB,MAAOpC,EAAI6F,IAAe,CAC1C,GAAI,CACF,MAAM3H,EAAW,MAAMyH,GAAsB,OAAO3F,EAAI6F,CAAU,EAClE,GAAI3H,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAMua,EAAaxC,GAAqB/X,EAAS,IAAI,EACrDoI,EAAKQ,IAAW,CACd,YAAaA,EAAM,YAAY,OAAS0P,EAAE,KAAOxW,EAAKyY,EAAajC,CAAC,GACpE,CACJ,CACF,MAAgB,CAEhB,CACF,EAIA,kBAAmB,MAAOxR,EAAWe,EAAUC,IAAe,CAC5D,GAAI,CACF,MAAM9H,EAAW,MAAM4H,GAAyB,IAAId,EAAWe,EAAUC,CAAU,EACnF,GAAI9H,EAAS,SAAWA,EAAS,KAAM,CACrC,MAAM2G,EAAU0Q,EAAkBrX,EAAS,IAAI,EAC/CoI,EAAKQ,IAAW,CACd,SAAUA,EAAM,SAAS,OAASY,EAAE,KAAO1C,EAAYH,EAAU6C,CAAC,GAClE,CACJ,CACF,MAAgB,CAEhB,CACF,EAIA,yBAA2B1C,GAClBuB,IAAM,YAAY,OAAOmH,GAAKA,EAAE,YAAc1I,CAAS,EAGhE,2BAA4B,MAAOA,GAAc,CAC/C,GAAI,CACF,MAAM9G,EAAW,MAAMmH,GAAsB,eAAeL,CAAS,EACrE,GAAI9G,EAAS,SAAWA,EAAS,KAAM,CAErC,MAAMwa,GADY,MAAM,QAAQxa,EAAS,IAAI,EAAIA,EAAS,KAAO,IACvC,IAAI4X,EAAoB,EAElD,OAAAxP,EAAKQ,IAEI,CAAE,YAAa,CAAC,GADFA,EAAM,YAAY,OAAO4G,GAAKA,EAAE,YAAc1I,CAAS,EACpC,GAAG0T,CAAO,GACnD,EACMA,CACT,CACA,MAAO,EACT,MAAgB,CAEd,MAAO,EACT,CACF,EAEA,uBAAyB1T,GAAc,CACrC,MAAMH,EAAU0B,IAAM,WAAWvB,CAAS,EAC1C,GAAI,CAACH,EAAS,MAAM,IAAI,MAAM,mBAAmB,EAEjD,MAAMqS,EAAQ3Q,IAAM,yBAAyBvB,CAAS,EAChD2R,EAAWpQ,IAAM,UAAU,KAAK+B,GAAKA,EAAE,YAActD,CAAS,EAE9D2T,EAAe,IAAI,IAAIzB,EAAM,IAAIxJ,GAAKA,EAAE,OAAO,CAAC,EAAE,KAClDkL,EAAc1B,EAAM,OAAOxJ,GAAKA,EAAE,WAAW,EAAE,OAErD,MAAO,CACL,QAAA7I,EACA,MAAAqS,EACA,SAAAP,EACA,oBAAqB,CACnB,WAAYO,EAAM,OAClB,YAAA0B,EACA,aAAAD,CAAA,CACF,CAEJ,IAEF,CACE,KAAM,qBACN,WAAa7R,IAAW,CAEtB,WAAYA,EAAM,WAClB,iBAAkBA,EAAM,kBAC1B,CACF,CAEJ,EC3pCO,SAAS+R,GAAQ,CAAE,KAAAC,EAAO,MAAsB,CACrD,MAAMC,EAAc,CAClB,GAAI,UACJ,GAAI,YACJ,GAAI,YACJ,GAAI,6BAGN,OACEC,MAAC,OACC,IAAI,eACJ,IAAI,SACJ,UAAW,GAAGD,EAAYD,CAAI,CAAC,mBAGrC,CCGO,SAASG,GAAQ,CAAE,SAAAC,EAAU,OAAAC,EAAQ,QAAAC,GAAyB,CACnE,MAAMC,EAAWC,GAAA,EACX,CAAE,KAAA1a,CAAA,EAASuH,EAAA,EACX,CAAE,EAAAoT,EAAG,SAAAjE,CAAA,EAAaF,GAAA,EAClB,CAAE,SAAA/D,EAAU,cAAAV,EAAe,UAAA8C,EAAW,6BAAA+F,CAAA,EAAiCpM,EAAA,EACvE,CAAE,SAAAiJ,CAAA,EAAaD,GAAA,EAGf,CAACqD,EAAiBC,CAAkB,EAAIC,WAAS,CAAC,EAGlDC,EAAuBC,cAAY,SAAY,CACnD,GAAKjb,GAEA,CAAC,QAAS,UAAW,UAAU,EAAE,SAASA,EAAK,IAAI,EAExD,GAAI,CACF,MAAMV,EAAW,MAAMsC,GAAQ,iBAC/BkZ,EAAmBxb,EAAS,cAAgB,CAAC,CAC/C,MAAgB,CAEhB,CACF,EAAG,CAACU,CAAI,CAAC,EAGTkb,YAAU,IAAM,CACdF,EAAA,EACA,MAAMG,EAAW,YAAYH,EAAsB,GAAK,EACxD,MAAO,IAAM,cAAcG,CAAQ,CACrC,EAAG,CAACH,CAAoB,CAAC,EAGzB,MAAMI,EAAgBC,UAAQ,IAAM,CAClC,GAAI,CAACrb,EAAM,OAAO,KAClB,MAAMqO,MAAU,KACViN,EAAc,IAAI,KAAKjN,EAAI,UAAY,MAAc,GAAK,GAAI,EAG9DkN,EAAmB9D,EAAS,OAAO3O,GAAK,CAC5C,GAAIA,EAAE,SAAW,YAAa,MAAO,GAGrC,GAAIA,EAAE,SAAW,sBAAwBA,EAAE,SAAW,cACpD,MAAO,GAIT,GAAI,CAACA,EAAE,kBAAmB,MAAO,GACjC,MAAM0S,EAAc,IAAI,KAAK1S,EAAE,iBAAiB,EAChD,OAAO0S,GAAenN,GAAOmN,GAAeF,CAC9C,CAAC,EAED,GAAIC,EAAiB,SAAW,EAAG,OAAO,KAG1C,MAAME,EAAkBF,EAAiB,KAAKzS,GAC5CA,EAAE,SAAW,eAAiBA,EAAE,SAAW,sBAIvC4S,EAAsBH,EAAiB,KAAKzS,GAChDA,EAAE,SAAW,iBACbA,EAAE,SAAW,qBACbA,EAAE,SAAW,sBACbA,EAAE,SAAW,qBAGf,OAAI2S,EAAwB,SACxBC,EAA4B,YACzB,UACT,EAAG,CAAC1b,EAAMyX,CAAQ,CAAC,EAGbkE,EAASN,UAAQ,IAAM,CAC3B,GAAI,CAACrb,EAAM,MAAO,GAGlB,GAAIA,EAAK,OAAS,WAAY,CAC5B,MAAM4b,EAAkB/G,EAAU,QAAUtL,EAAE,QAAUvJ,EAAK,KAAK,EAC5D6b,EAAmBD,GAAiB,gBAAkB5b,EAAK,eAG3D8b,EAAyBrJ,EAAS,OAAOzM,GAC7CA,EAAE,SAAW,OAASA,EAAE,WAAa6V,CAAA,EACrC,OAGIE,EAAwBtJ,EAAS,OAAOzM,GAC5CA,EAAE,aAAe4V,GAAiB,KAAO5V,EAAE,SAAW,YAAcA,EAAE,SAAW,aACjF,OAIIgW,EADwBpB,EAAA,EACyB,UACrD,CAACnS,EAAE,UAAU,SAASzI,EAAK,EAAE,GAC7B,OAEF,MAAO,CACL,IAAK8b,EAAyBC,EAC9B,iBAAkBC,CAAA,CAEtB,CAGA,GAAIhc,EAAK,OAAS,WAAY,CAE5B,MAAMic,EAAsBxJ,EAAS,OAAOzM,GAC1CA,EAAE,aAAehG,EAAK,IAAM,CAAC,CAAC,YAAa,SAAU,WAAW,EAAE,SAASgG,EAAE,MAAM,GACnF,OAGIgW,EAA2BjK,EAAc,OAAOtJ,GACpDA,EAAE,UAAY,CAACA,EAAE,UAAU,SAASzI,EAAK,EAAE,IAAMyI,EAAE,OAAS,aAAeA,EAAE,OAAS,QACtF,OAGI4F,MAAU,KACViN,EAAc,IAAI,KAAKjN,EAAI,UAAY,MAAc,GAAK,GAAI,EAC9D6N,EAAwBzE,EAAS,OAAO3O,GAAK,CAEjD,GADIA,EAAE,SAAW,aACb,CAACA,EAAE,kBAAmB,MAAO,GACjC,MAAM0S,EAAc,IAAI,KAAK1S,EAAE,iBAAiB,EAChD,OAAO0S,GAAenN,GAAOmN,GAAeF,CAC9C,CAAC,EAAE,OAEH,MAAO,CACL,IAAKW,EACL,iBAAkBD,EAClB,YAAaE,EACb,QAASrB,CAAA,CAEb,CAGA,GAAI7a,EAAK,OAAS,WAAaA,EAAK,OAAS,SAAWA,EAAK,OAAS,mBAAqBA,EAAK,OAAS,WAAY,CAEnH,MAAMmc,EAAmB1J,EAAS,UAAYzM,EAAE,SAAW,KAAK,EAAE,OAG5DqI,MAAU,KACViN,EAAc,IAAI,KAAKjN,EAAI,UAAY,MAAc,GAAK,GAAI,EAC9D6N,EAAwBzE,EAAS,OAAO3O,GAAK,CAEjD,GADIA,EAAE,SAAW,aACb,CAACA,EAAE,kBAAmB,MAAO,GACjC,MAAM0S,EAAc,IAAI,KAAK1S,EAAE,iBAAiB,EAChD,OAAO0S,GAAenN,GAAOmN,GAAeF,CAC9C,CAAC,EAAE,OAEH,MAAO,CACL,YAAaa,EACb,YAAaD,EACb,QAASrB,CAAA,CAEb,CAEA,MAAO,EACT,EAAG,CAAC7a,EAAMyS,EAAUV,EAAe8C,EAAW+F,EAA8BC,EAAiBpD,CAAQ,CAAC,EA+HhG2E,GA5Hc,IAAM,CAExB,GAAIpc,GAAM,eAAiB,aACzB,MAAO,CACL,CAAE,KAAM,IAAK,KAAMqc,GAAiB,MAAO3F,IAAa,KAAO,iBAAmB,oBAAqB,EAG3G,GAAI1W,GAAM,eAAiB,iBACzB,MAAO,CACL,CAAE,KAAM,IAAK,KAAMsc,GAAQ,MAAO5F,IAAa,KAAO,mBAAqB,wBAAwB,EAIvG,GAAI1W,GAAM,OAAS,WAAY,CAE7B,MAAMuc,EAAY,CAChB,CAAE,KAAM,IAAK,KAAMC,GAAU,MAAO9F,IAAa,KAAO,SAAW,YACnE,CAAE,KAAM,YAAa,KAAM+F,GAAc,MAAO/F,IAAa,KAAO,aAAe,UACnF,CAAE,KAAM,kBAAmB,KAAMgG,GAAK,MAAOhG,IAAa,KAAO,aAAe,gBAAgB,EAIlG,OAAI1W,GAAM,iBAAmB,YAC3Buc,EAAU,KAAK,CAAE,KAAM,cAAe,KAAMI,GAAQ,MAAOjG,IAAa,KAAO,YAAc,YAAa,EAGrG,CACL,GAAG6F,EACH,CAAE,KAAM,SAAU,KAAMK,GAAW,MAAOlG,IAAa,KAAO,aAAe,cAC7E,CAAE,KAAM,iBAAkB,KAAMmG,EAAW,MAAOnG,IAAa,KAAO,aAAe,YACrF,CAAE,KAAM,aAAc,KAAMoG,GAAe,MAAOpG,IAAa,KAAO,WAAa,cACnF,CAAE,KAAM,cAAe,KAAMqG,EAAO,MAAOrG,IAAa,KAAO,UAAY,cAC3E,CAAE,KAAM,WAAY,KAAMsG,GAAY,MAAOtG,IAAa,KAAO,UAAY,aAAa,CAE9F,CACA,OAAI1W,GAAM,OAAS,WACV,CACL,CAAE,KAAM,IAAK,KAAMid,GAAM,MAAOtC,EAAE,cAAc,GAChD,CAAE,KAAM,QAAS,KAAMuC,GAAe,MAAOxG,IAAa,KAAO,gBAAkB,gBACnF,CAAE,KAAM,YAAa,KAAMgG,GAAK,MAAOhG,IAAa,KAAO,WAAa,yBACxE,CAAE,KAAM,gBAAiB,KAAMiG,GAAQ,MAAOjG,IAAa,KAAO,kBAAoB,kBACtF,CAAE,KAAM,iBAAkB,KAAMmG,EAAW,MAAOlC,EAAE,qBAAqB,GACzE,CAAE,KAAM,YAAa,KAAMwC,GAAM,MAAOxC,EAAE,gBAAgB,GAC1D,CAAE,KAAM,mBAAoB,KAAMyC,GAAO,MAAO1G,IAAa,KAAO,oBAAsB,sBAC1F,CAAE,KAAM,kBAAmB,KAAM2G,GAAM,MAAO3G,IAAa,KAAO,UAAY,YAC9E,CAAE,KAAM,YAAa,KAAM4G,GAAY,MAAO5G,IAAa,KAAO,UAAY,YAAY,EAG1F1W,GAAM,OAAS,UAAYA,GAAM,OAAS,mBACrC,CACL,CAAE,KAAM,IAAK,KAAMud,GAAK,MAAO5C,EAAE,kBAAkB,EAAE,EAGrD3a,GAAM,OAAS,QACV,CACL,CAAE,KAAM,IAAK,KAAMwd,GAAQ,MAAO7C,EAAE,gBAAgB,GACpD,CAAE,KAAM,YAAa,KAAM6B,GAAU,MAAO7B,EAAE,cAAc,GAC5D,CAAE,KAAM,QAAS,KAAMuC,GAAe,MAAOxG,IAAa,KAAO,OAAS,WAC1E,CAAE,KAAM,QAAS,KAAMqG,EAAO,MAAOrG,IAAa,KAAO,WAAa,YACtE,CAAE,KAAM,aAAc,KAAMqG,EAAO,MAAOpC,EAAE,eAAe,GAC3D,CAAE,KAAM,kBAAmB,KAAM+B,GAAK,MAAOhG,IAAa,KAAO,aAAe,iBAChF,CAAE,KAAM,aAAc,KAAM+G,GAAW,MAAO9C,EAAE,eAAe,GAC/D,CAAE,KAAM,eAAgB,KAAM+C,GAAQ,MAAO/C,EAAE,gBAAgB,GAC/D,CAAE,KAAM,YAAa,KAAMwC,GAAM,MAAOxC,EAAE,gBAAgB,GAC1D,CAAE,KAAM,iBAAkB,KAAMkC,EAAW,MAAOlC,EAAE,qBAAqB,GACzE,CAAE,KAAM,aAAc,KAAMmC,GAAe,MAAOnC,EAAE,eAAe,GACnE,CAAE,KAAM,WAAY,KAAMiC,GAAW,MAAOjC,EAAE,aAAa,GAC3D,CAAE,KAAM,YAAa,KAAMgD,GAAU,MAAOhD,EAAE,cAAc,EAAE,EAI9D3a,GAAM,OAAS,WACV,CACL,CAAE,KAAM,IAAK,KAAMqc,GAAiB,MAAO3F,IAAa,KAAO,iBAAmB,oBAClF,CAAE,KAAM,YAAa,KAAM8F,GAAU,MAAO7B,EAAE,cAAc,GAC5D,CAAE,KAAM,QAAS,KAAMuC,GAAe,MAAOxG,IAAa,KAAO,OAAS,WAC1E,CAAE,KAAM,QAAS,KAAMqG,EAAO,MAAOrG,IAAa,KAAO,aAAe,YACxE,CAAE,KAAM,aAAc,KAAMqG,EAAO,MAAOpC,EAAE,eAAe,GAC3D,CAAE,KAAM,aAAc,KAAM8C,GAAW,MAAO9C,EAAE,eAAe,GAC/D,CAAE,KAAM,kBAAmB,KAAM+B,GAAK,MAAOhG,IAAa,KAAO,aAAe,iBAChF,CAAE,KAAM,gBAAiB,KAAMiG,GAAQ,MAAOjG,IAAa,KAAO,oBAAsB,yBACxF,CAAE,KAAM,WAAY,KAAM6G,GAAK,MAAO7G,IAAa,KAAO,SAAW,SACrE,CAAE,KAAM,YAAa,KAAMyG,GAAM,MAAOxC,EAAE,gBAAgB,GAC1D,CAAE,KAAM,iBAAkB,KAAMkC,EAAW,MAAOlC,EAAE,qBAAqB,GACzE,CAAE,KAAM,WAAY,KAAMqC,GAAY,MAAOtG,IAAa,KAAO,UAAY,WAC7E,CAAE,KAAM,WAAY,KAAMkG,GAAW,MAAOjC,EAAE,aAAa,GAC3D,CAAE,KAAM,YAAa,KAAMgD,GAAU,MAAOhD,EAAE,cAAc,EAAE,EAI9D3a,GAAM,OAAS,kBACV,CACL,CAAE,KAAM,IAAK,KAAMqc,GAAiB,MAAO3F,IAAa,KAAO,YAAc,mBAC7E,CAAE,KAAM,YAAa,KAAM8F,GAAU,MAAO9F,IAAa,KAAO,SAAW,YAC3E,CAAE,KAAM,aAAc,KAAMgH,GAAQ,MAAOhH,IAAa,KAAO,aAAe,YAC9E,CAAE,KAAM,kBAAmB,KAAMgG,GAAK,MAAOhG,IAAa,KAAO,aAAe,iBAChF,CAAE,KAAM,iBAAkB,KAAMmG,EAAW,MAAOlC,EAAE,qBAAqB,GACzE,CAAE,KAAM,aAAc,KAAMmC,GAAe,MAAOnC,EAAE,eAAe,GACnE,CAAE,KAAM,cAAe,KAAMoC,EAAO,MAAOrG,IAAa,KAAO,UAAY,cAC3E,CAAE,KAAM,WAAY,KAAMsG,GAAY,MAAOtG,IAAa,KAAO,UAAY,UAAU,EAIpF,CACL,CAAE,KAAM,IAAK,KAAM2F,GAAiB,MAAO1B,EAAE,eAAe,GAC5D,CAAE,KAAM,YAAa,KAAM6B,GAAU,MAAO7B,EAAE,cAAc,GAC5D,CAAE,KAAM,QAAS,KAAMuC,GAAe,MAAOxG,IAAa,KAAO,OAAS,WAC1E,CAAE,KAAM,aAAc,KAAMgH,GAAQ,MAAO/C,EAAE,eAAe,GAC5D,CAAE,KAAM,aAAc,KAAMoC,EAAO,MAAOpC,EAAE,eAAe,GAC3D,CAAE,KAAM,kBAAmB,KAAM+B,GAAK,MAAOhG,IAAa,KAAO,aAAe,iBAChF,CAAE,KAAM,gBAAiB,KAAMiG,GAAQ,MAAOjG,IAAa,KAAO,oBAAsB,yBACxF,CAAE,KAAM,WAAY,KAAM6G,GAAK,MAAO5C,EAAE,aAAa,GACrD,CAAE,KAAM,aAAc,KAAM8C,GAAW,MAAO9C,EAAE,eAAe,GAC/D,CAAE,KAAM,eAAgB,KAAM+C,GAAQ,MAAO/C,EAAE,gBAAgB,GAC/D,CAAE,KAAM,YAAa,KAAMwC,GAAM,MAAOxC,EAAE,gBAAgB,GAC1D,CAAE,KAAM,iBAAkB,KAAMkC,EAAW,MAAOlC,EAAE,qBAAqB,GACzE,CAAE,KAAM,aAAc,KAAMmC,GAAe,MAAOnC,EAAE,eAAe,GACnE,CAAE,KAAM,cAAe,KAAMoC,EAAO,MAAOrG,IAAa,KAAO,cAAgB,cAC/E,CAAE,KAAM,WAAY,KAAMsG,GAAY,MAAOtG,IAAa,KAAO,UAAY,cAC7E,CAAE,KAAM,WAAY,KAAMkG,GAAW,MAAOjC,EAAE,aAAa,GAC3D,CAAE,KAAM,YAAa,KAAMgD,GAAU,MAAOhD,EAAE,cAAc,EAAE,CAElE,GAEiB,EAEXiD,EAAiB,IAAM,CAEvB,OAAO,WAAa,KACtBpD,EAAA,CAEJ,EAEA,OACEqD,OAAAC,WAAA,CAEE,UAAA1D,MAAC,OACC,UAAW,mBAAmBG,EAAS,OAAS,EAAE,GAClD,QAASC,CAAA,UAGV,OAAI,UAAW,WAAWD,EAAS,OAAS,EAAE,GAC7C,UAAAH,MAAC,OAAI,UAAU,aACb,SAAAyD,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAACH,GAAA,CAAQ,KAAK,KAAK,SAClB,OACC,UAAAG,MAAC,OAAI,UAAU,0BAA0B,qBAAS,EAClDA,MAAC,OAAI,UAAU,wBAAwB,eAAG,GAC5C,GACF,EAEAA,MAAC,UACC,QAASI,EACT,UAAU,6CAEV,SAAAJ,MAAC2D,GAAA,CAAU,UAAU,UAAU,GACjC,EACF,EACF,QAEC,OAAI,UAAU,8BACZ,SAAA3B,EAAS,IAAKrF,GAAwF,CACrG,MAAMiH,EAAarC,EAAO5E,EAAK,IAA2B,GAAK,EAEzDkH,EAAgBlH,EAAK,OAAS,YAC9BmH,EAAaD,GAAiB7C,EAC/BA,IAAkB,SAAW,cAAgBA,IAAkB,YAAc,eAAiB,aAC/F,aACE+C,EAAgB,CAACF,GAAiB7C,IAAkB,SAE1D,cACG,OACE,UAAArE,EAAK,WACJqD,MAAC,OAAI,UAAU,qCAAqC,EAEtDyD,OAACO,GAAA,CACC,GAAIrH,EAAK,KACT,QAAS6G,EACT,UAAW,gBAAgBnD,EAAS,WAAa1D,EAAK,KAAO,SAAW,EAAE,GAE1E,UAAA8G,OAAC,OAAI,UAAU,WACb,UAAAzD,MAACrD,EAAK,KAAL,CAAU,UAAU,UAAU,EAC9BiH,EAAa,GACZ5D,MAAC,QAAK,UAAW,yHAAyH8D,CAAU,iBAAiBC,EAAgB,gBAAkB,EAAE,GACtM,SAAAH,EAAa,GAAK,MAAQA,CAAA,CAC7B,GAEJ,EACA5D,MAAC,QAAK,UAAU,SAAU,WAAK,MAAM,EACpC4D,EAAa,GACZ5D,MAAC,QAAK,UAAW,oDAAoD8D,CAAU,gBAC5E,SAAAF,EAAa,GAAK,MAAQA,CAAA,CAC7B,IAEJ,GAvBQjH,EAAK,IAwBf,CAEJ,CAAC,EACH,EAEA8G,OAAC,OAAI,UAAU,yCAEX,WAAA7d,GAAM,OAAS,YAAcA,GAAM,OAAS,UAAYA,GAAM,OAAS,qBACvE6d,OAACO,GAAA,CACC,GAAG,WACH,QAASR,EACT,UAAW,gBAAgBnD,EAAS,WAAa,WAAa,SAAW,EAAE,GAE3E,UAAAL,MAACiE,GAAA,CAAK,UAAU,UAAU,EAC1BjE,MAAC,QAAM,SAAA1D,IAAa,KAAO,cAAgB,kBAAkB,KAGjEmH,OAAC,UAAO,QAASvD,EAAU,UAAU,mDACnC,UAAAF,MAACkE,GAAA,CAAO,UAAU,UAAU,EAC5BlE,MAAC,QAAM,SAAA1D,IAAa,KAAO,QAAU,UAAU,GACjD,GACF,GACF,GACF,CAEJ,CCpYO,SAAS6H,GAAa,CAAE,YAAAC,EAAa,YAAAC,GAAkC,CAC5E,KAAM,CAAE,KAAAze,CAAA,EAASuH,EAAA,EACXmX,EAAWC,GAAA,EACX,CAACC,EAAmBC,CAAoB,EAAI9D,WAAS,EAAK,EAC1D,CAAE,cAAA+D,EAAe,uBAAAC,EAAwB,2BAAAC,EAA4B,6BAAAC,EAA8B,6BAAArE,EAA8B,SAAAsE,CAAA,EAAa1Q,EAAA,EAC9I,CAAE,SAAAiJ,CAAA,EAAaD,GAAA,EAGf2H,EAAanf,GAAM,MAAM,gBAAkB,YAAcA,GAAM,MAAM,gBAAkB,SAGvFof,EAAoB/D,UAAQ,IAC3Brb,EACEmf,EACHF,EAA6Bjf,EAAK,OAAS,GAAIA,EAAK,YAAc,GAAIA,EAAK,UAAY,GAAIA,EAAK,OAAS,GAAIA,EAAK,QAAU,EAAE,EAC9H4a,EAAA,EAHc,GAIjB,CAAC5a,EAAMmf,EAAYF,EAA8BrE,CAA4B,CAAC,EAE3EoB,EAA2BoD,EAAkB,OAAO3W,GAAK,CAACA,EAAE,UAAU,SAASzI,GAAM,IAAM,EAAE,CAAC,EAAE,OAGhGqf,EAAmBhE,UAAQ,IAAM,CACrC,MAAMiE,MAAc,KACdhE,EAAc,IAAI,KAAKgE,EAAQ,UAAY,MAAc,GAAK,GAAI,EACxE,OAAO7H,EAAS,OAAO3O,GAAK,CAC1B,GAAI,CAACA,EAAE,kBAAmB,MAAO,GACjC,MAAM0S,EAAc,IAAI,KAAK1S,EAAE,iBAAiB,EAChD,OAAO0S,GAAe8D,GAAW9D,GAAeF,GAAexS,EAAE,SAAW,WAC9E,CAAC,CACH,EAAG,CAAC2O,CAAQ,CAAC,EAGP8H,EAAelE,UAAQ,IACvB,CAAC8D,GAAc,CAACnf,EAAa,GACuF,CACtH,CACE,GAAI,WACJ,MAAO,iBACP,YAAa,6BACb,KAAMud,GACN,KAAM,WACN,UAAW,CAAC,CAACvd,EAAK,mBAEpB,CACE,GAAI,QACJ,MAAO,kBACP,YAAa,0BACb,KAAMod,GACN,KAAM,WACN,UAAW,CAAC,EAAEpd,EAAK,OAASA,EAAK,MAAM,QAAU,IAEnD,CACE,GAAI,WACJ,MAAO,oBACP,YAAa,kCACb,KAAMwc,GACN,KAAM,YACN,UAAW,CAAC,CAACxc,EAAK,kBAEpB,CACE,GAAI,UACJ,MAAO,qBACP,YAAa,iCACb,KAAM0c,GACN,KAAM,YACN,UAAWwC,EAAS,QAAUpQ,EAAE,UAAY9O,EAAK,EAAE,EACrD,EAGD,CAACmf,EAAYnf,EAAMkf,CAAQ,CAAC,EAEzBM,EAAoBD,EAAa,UAAY,CAAC5E,EAAE,SAAS,EAAE,OAG3D8E,EAAiBzD,EAA2BqD,EAAiB,OAE7DK,EAAoBZ,EAAc,OAAOnK,GAAKA,EAAE,SAAW3U,GAAM,EAAE,EAAE,MAAM,EAAG,EAAE,EAEhF2f,EAAcC,GAAoB,CACtC,MAAMhS,EAAO,IAAI,KAAKgS,CAAO,EAEvBC,MADU,OACG,UAAYjS,EAAK,UAC9BkS,EAAW,KAAK,MAAMD,EAAS,GAAK,EACpCE,GAAY,KAAK,MAAMF,EAAS,IAAO,EAE7C,OAAIC,EAAW,EAAU,aACrBA,EAAW,GAAW,GAAGA,CAAQ,OACjCC,GAAY,GAAW,GAAGA,EAAS,KAChCnS,EAAK,mBAAmB,QAAS,CAAE,IAAK,UAAW,MAAO,UAAW,CAC9E,EAEMoS,EAAuBC,GAAiB,CAC5C,OAAQA,EAAA,CACN,IAAK,kBAAmB,MAAO,KAC/B,IAAK,mBAAoB,MAAO,KAChC,IAAK,mBAAoB,MAAO,IAChC,IAAK,kBAAmB,MAAO,KAC/B,IAAK,oBAAqB,MAAO,IACjC,IAAK,mBAAoB,MAAO,IAChC,IAAK,mBAAoB,MAAO,IAChC,IAAK,oBAAqB,MAAO,KACjC,IAAK,mBAAoB,MAAO,KAChC,QAAS,MAAO,KAEpB,EAGMC,EAA0BzB,EAAczC,EAA2BqD,EAAiB,OAASG,EAEnG,OACE3B,OAAAC,WAAA,CACE,UAAAD,OAAC,UAAO,UAAU,gBAChB,UAAAA,OAAC,UAAO,QAASW,EAAa,UAAU,4CACtC,UAAApE,MAAC+F,GAAA,CAAK,UAAU,UAAU,EAEzBV,EAAiB,GAChBrF,MAAC,QAAK,UAAU,qHACb,SAAAqF,EAAiB,EAAI,KAAOA,CAAA,CAC/B,GAEJ,EAEA5B,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAACH,GAAA,CAAQ,KAAK,KAAK,EACnBG,MAAC,QAAK,UAAU,kCAAkC,qBAAS,GAC7D,EAEAyD,OAAC,UACC,QAAS,IAAMgB,EAAqB,CAACD,CAAiB,EACtD,UAAU,4CAEV,UAAAxE,MAACgG,GAAA,CAAK,UAAU,UAAU,EACzBF,EAA0B,GACzB9F,MAAC,QAAK,UAAU,+GACb,SAAA8F,EAA0B,EAAI,KAAOA,CAAA,CACxC,IAEJ,EACF,EAGCtB,GAAqByB,gBACpBxC,OAAC,OAAI,UAAU,uBACb,UAAAzD,MAAC,OACC,UAAU,4BACV,MAAO,CAAE,OAAQ,KACjB,QAAS,IAAMyE,EAAqB,EAAK,IAE3ChB,OAAC,OACC,UAAU,wGACV,MAAO,CAAE,OAAQ,MAAO,UAAW,QAEnC,UAAAA,OAAC,OAAI,UAAU,4EACb,UAAAzD,MAAC,MAAG,UAAU,wBAAwB,uBAAW,EAChDqE,EAAc,GACbrE,MAAC,UACC,QAAS,IAAMpa,GAAQgf,EAA2Bhf,EAAK,EAAE,EACzD,UAAU,wBACX,0BAED,EAEJ,EACA6d,OAAC,OAAI,UAAU,kBAAkB,MAAO,CAAE,UAAW,qBAElD,UAAAsB,GAAcI,EAAa,OAAS,GACnC1B,OAAC,OAAI,UAAU,2BACb,UAAAzD,MAAC,OAAI,UAAU,kDACb,SAAAyD,OAAC,KAAE,UAAU,6DACX,UAAAzD,MAACkG,GAAA,CAAY,UAAU,UAAU,EAAE,WAC1Bd,EAAkB,IAAED,EAAa,OAAO,KACnD,EACF,EACCA,EAAa,IAAKgB,GACjB1C,OAAC,OAEC,QAAS,IAAM,CAAEgB,EAAqB,EAAK,EAAGH,EAAS6B,EAAK,IAAI,CAAG,EACnE,UAAW,wFAAwFA,EAAK,UAAY,iBAAmB,gBAAgB,GAEvJ,UAAAnG,MAAC,OAAI,UAAW,uEAAuEmG,EAAK,UAAY,eAAiB,cAAc,GACrI,SAAAnG,MAACmG,EAAK,KAAL,CAAU,UAAW,WAAWA,EAAK,UAAY,iBAAmB,gBAAgB,GAAI,EAC3F,EACA1C,OAAC,OAAI,UAAU,iBACb,UAAAzD,MAAC,KAAE,UAAW,uBAAuBmG,EAAK,UAAY,8BAAgC,eAAe,GAClG,SAAAA,EAAK,MACR,EACAnG,MAAC,KAAE,UAAU,wBAAyB,WAAK,YAAY,GACzD,EACCmG,EAAK,UACJnG,MAACkG,GAAA,CAAY,UAAU,uCAAuC,EAE9DlG,MAAC,QAAK,UAAU,kDAAkD,IAhB/DmG,EAAK,GAmBb,GACH,EAIDvE,EAA2B,GAC1B6B,OAAC,OAAI,UAAU,2BACb,UAAAzD,MAAC,OAAI,UAAU,gDACb,SAAAyD,OAAC,KAAE,UAAU,4DACX,UAAAzD,MAACyC,EAAA,CAAU,UAAU,UAAU,EAAE,eACpBb,EAAyB,KACxC,EACF,EACCoD,EAAkB,OAAO3W,GAAK,CAACA,EAAE,UAAU,SAASzI,GAAM,IAAM,EAAE,CAAC,EAAE,MAAM,EAAG,CAAC,EAAE,IAAKoC,GACrFyb,OAAC,OAEC,QAAS,IAAM,CAAEgB,EAAqB,EAAK,EAAGH,EAAS,gBAAgB,CAAG,EAC1E,UAAU,qGAEV,UAAAtE,MAAC,OAAI,UAAU,kFACb,eAACyC,EAAA,CAAU,UAAU,wBAAwB,EAC/C,EACAgB,OAAC,OAAI,UAAU,iBACb,UAAAzD,MAAC,KAAE,UAAU,+BAAgC,SAAAhY,EAAa,MAAM,EAChEgY,MAAC,KAAE,UAAU,qCAAsC,WAAa,QAAQ,GAC1E,EACAA,MAAC,QAAK,UAAU,iDAAiD,IAX5DhY,EAAa,GAarB,GACH,EAIDid,EAAiB,OAAS,GACzBxB,OAAC,OAAI,UAAU,2BACb,UAAAzD,MAAC,OAAI,UAAU,oDACb,SAAAyD,OAAC,KAAE,UAAU,8DACX,UAAAzD,MAAC2C,EAAA,CAAM,UAAU,UAAU,EAAE,aAClBsC,EAAiB,OAAO,KACrC,EACF,EACCA,EAAiB,MAAM,EAAG,CAAC,EAAE,IAAKpZ,GACjC4X,OAAC,OAEC,QAAS,IAAM,CAAEgB,EAAqB,EAAK,EAAGH,EAAS,WAAW,CAAG,EACrE,UAAU,uGAEV,UAAAtE,MAAC,OAAI,UAAU,oFACb,eAAC2C,EAAA,CAAM,UAAU,0BAA0B,EAC7C,EACAc,OAAC,OAAI,UAAU,iBACb,UAAAzD,MAAC,KAAE,UAAU,+BAA+B,yBAAa,EACzDA,MAAC,KAAE,UAAU,wBACV,SAAAnU,EAAQ,kBACL,IAAI,KAAKA,EAAQ,iBAAiB,EAAE,mBAAmB,QAAS,CAAE,IAAK,UAAW,MAAO,QAAS,KAAM,UAAW,OAAQ,UAAW,EACtI,kBACN,GACF,EACAmU,MAAC,QAAK,UAAU,mDAAmD,IAf9DnU,EAAQ,GAiBhB,GACH,EAIDyZ,EAAkB,SAAW,GAAK1D,IAA6B,GAAKqD,EAAiB,SAAW,GAAKG,IAAsB,EAC1H3B,OAAC,OAAI,UAAU,gCACb,UAAAzD,MAACgG,GAAA,CAAK,UAAU,uCAAuC,EACvDhG,MAAC,KAAE,2BAAe,GACpB,EACEsF,EAAkB,OAAS,GAC7B7B,OAAAC,WAAA,CACE,UAAA1D,MAAC,OAAI,UAAU,gDACb,SAAAA,MAAC,KAAE,UAAU,oCAAoC,uBAAW,EAC9D,EACCsF,EAAkB,IAAKnS,GACtB6M,MAAC,OAEC,QAAS,IAAM,CACR7M,EAAa,MAChBwR,EAAuBxR,EAAa,EAAE,CAE1C,EACA,UAAW,gCAAiCA,EAAa,KAAsB,WAAf,YAAyB,GAEzF,SAAAsQ,OAAC,OAAI,UAAU,aACb,UAAAzD,MAAC,QAAK,UAAU,UAAW,SAAA4F,EAAoBzS,EAAa,IAAI,EAAE,EAClEsQ,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAzD,MAAC,MAAG,UAAU,+BAAgC,SAAA7M,EAAa,MAAM,QAChE,QAAK,UAAU,sCAAuC,SAAAoS,EAAWpS,EAAa,SAAS,EAAE,GAC5F,EACA6M,MAAC,KAAE,UAAU,4CAA6C,WAAa,QAAQ,GACjF,GACF,GAjBK7M,EAAa,GAmBrB,GACH,GAEJ,EACA6M,MAAC,OAAI,UAAU,0CACb,SAAAA,MAAC,UACC,QAAS,IAAMyE,EAAqB,EAAK,EACzC,UAAU,gDACX,oBAED,CACF,IACF,EACF,EACA,SAAS,KACX,EACF,CAEJ,CC9CO,MAAM2B,GAA6I,CACxJ,WAAY,CACV,MAAO,eACP,QAAS,iBACT,KAAM,KACN,YAAa,8CACb,cAAe,oEAEjB,iBAAkB,CAChB,MAAO,SACP,QAAS,WACT,KAAM,KACN,YAAa,sCACb,cAAe,mDAEjB,SAAU,CACR,MAAO,eACP,QAAS,eACT,KAAM,KACN,YAAa,8BACb,cAAe,0CAEjB,MAAO,CACL,MAAO,YACP,QAAS,cACT,KAAM,KACN,YAAa,2BACb,cAAe,yCAEjB,cAAe,CACb,MAAO,uBACP,QAAS,6BACT,KAAM,QACN,YAAa,iCACb,cAAe,sDAEjB,gBAAiB,CACf,MAAO,kBACP,QAAS,wBACT,KAAM,KACN,YAAa,kCACb,cAAe,2CAEnB,EAUaC,GAAwC,CAEnD,CAAE,GAAI,UAAW,KAAM,aAAc,KAAM,KAAM,YAAa,iCAC9D,CAAE,GAAI,cAAe,KAAM,YAAa,KAAM,KAAM,YAAa,gCACjE,CAAE,GAAI,WAAY,KAAM,SAAU,KAAM,MAAO,YAAa,oCAC5D,CAAE,GAAI,WAAY,KAAM,SAAU,KAAM,KAAM,YAAa,iCAE3D,CAAE,GAAI,WAAY,KAAM,OAAQ,KAAM,KAAM,YAAa,gCACzD,CAAE,GAAI,WAAY,KAAM,UAAW,KAAM,KAAM,YAAa,6BAC5D,CAAE,GAAI,YAAa,KAAM,mBAAoB,KAAM,KAAM,YAAa,+BACtE,CAAE,GAAI,SAAU,KAAM,QAAS,KAAM,KAAM,YAAa,gCACxD,CAAE,GAAI,KAAM,KAAM,cAAe,KAAM,KAAM,YAAa,oCAC1D,CAAE,GAAI,QAAS,KAAM,SAAU,KAAM,KAAM,YAAa,gBAC1D,EAGaC,GAAgE,CAC3E,QAAS,YACT,YAAa,WACb,SAAU,SACV,SAAU,UACV,SAAU,WACV,SAAU,WACV,UAAW,SACX,OAAQ,YACR,GAAI,iBACJ,MAAO,QACT,EAEaC,GAA+C,CAC1D,IAAK,QACL,SAAU,YACV,SAAU,UACV,YAAa,WACb,iBAAkB,wBAClB,UAAW,YACX,UAAW,UACb,EAEaC,GAAmD,CAC9D,IAAK,SACL,OAAQ,UACR,KAAM,UACN,OAAQ,SACV,EA2SaC,GAOR,CACH,gBAAiB,CACf,MAAO,sBACP,QAAS,uBACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,mDACb,cAAe,qDAEjB,cAAe,CACb,MAAO,oBACP,QAAS,0BACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,yCACb,cAAe,0CAEjB,aAAc,CACZ,MAAO,qBACP,QAAS,oBACT,iBAAkB,aAClB,kBAAmB,GACnB,YAAa,4CACb,cAAe,uCAEjB,gBAAiB,CACf,MAAO,kBACP,QAAS,cACT,iBAAkB,aAClB,kBAAmB,GACnB,YAAa,sCACb,cAAe,kCAEjB,oBAAqB,CACnB,MAAO,qBACP,QAAS,wBACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,yCACb,cAAe,kEAEjB,kBAAmB,CACjB,MAAO,qBACP,QAAS,cACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,kCACb,cAAe,6BAEjB,iBAAkB,CAChB,MAAO,uBACP,QAAS,sBACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,oCACb,cAAe,wCAEjB,gBAAiB,CACf,MAAO,mBACP,QAAS,0BACT,iBAAkB,aAClB,kBAAmB,GACnB,YAAa,qCACb,cAAe,yCAEjB,YAAa,CACX,MAAO,kBACP,QAAS,mBACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,uCACb,cAAe,oCAEjB,SAAU,CACR,MAAO,wBACP,QAAS,aACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,qCACb,cAAe,6BAEjB,QAAS,CACP,MAAO,WACP,QAAS,eACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,qCACb,cAAe,sCAEjB,MAAO,CACL,MAAO,SACP,QAAS,SACT,iBAAkB,kBAClB,kBAAmB,GACnB,YAAa,iBACb,cAAe,mBAEnB,EAGaC,GAA4G,CACvH,gBAAiB,CAAE,MAAO,8BAA+B,QAAS,2BAA6B,QAAS,IACxG,mBAAoB,CAAE,MAAO,sCAAuC,QAAS,4BAA8B,QAAS,IACpH,WAAY,CAAE,MAAO,oBAAqB,QAAS,sBAAuB,QAAS,OACnF,eAAgB,CAAE,MAAO,qBAAsB,QAAS,qBAAuB,QAAS,IACxF,UAAW,CAAE,MAAO,qBAAsB,QAAS,qBAAsB,QAAS,IACpF,EAGaC,GAAkG,CAC7G,MAAO,CAAE,MAAO,WAAY,QAAS,WAAY,MAAO,QACxD,mBAAoB,CAAE,MAAO,eAAgB,QAAS,gBAAiB,MAAO,UAC9E,mBAAoB,CAAE,MAAO,aAAc,QAAS,eAAgB,MAAO,QAC3E,mBAAoB,CAAE,MAAO,kBAAmB,QAAS,oBAAqB,MAAO,UACrF,YAAa,CAAE,MAAO,cAAe,QAAS,cAAe,MAAO,SACpE,cAAe,CAAE,MAAO,sBAAuB,QAAS,sBAAuB,MAAO,UACtF,kBAAmB,CAAE,MAAO,qBAAsB,QAAS,0BAA4B,MAAO,UAC9F,mBAAoB,CAAE,MAAO,iBAAkB,QAAS,mBAAoB,MAAO,QACnF,kBAAmB,CAAE,MAAO,qBAAsB,QAAS,yBAA0B,MAAO,WAC5F,UAAW,CAAE,MAAO,WAAY,QAAS,gBAAiB,MAAO,MACnE,EA8vCaC,GAAqE,CAChF,MAAO,YACP,MAAO,YACP,SAAU,aACV,MAAO,UACP,OAAQ,aACR,MAAO,WACT,EAgOaC,GAA+E,CAC1F,IAAK,CAAE,MAAO,sBAAuB,QAAS,oBAC9C,WAAY,CAAE,MAAO,WAAY,QAAS,aAC1C,MAAO,CAAE,MAAO,WAAY,QAAS,iBACrC,MAAO,CAAE,MAAO,SAAU,QAAS,SACrC,EAEaC,GAAwG,CACnH,WAAY,CAAE,MAAO,YAAa,QAAS,iBAAkB,KAAM,MACnE,aAAc,CAAE,MAAO,WAAY,QAAS,gBAAiB,KAAM,MACnE,QAAS,CAAE,MAAO,YAAa,QAAS,SAAU,KAAM,KAC1D,EAqHaC,GAA6F,CACxG,QAAS,CAAE,MAAO,SAAU,QAAS,SAAU,KAAM,MACrD,MAAO,CAAE,MAAO,QAAS,QAAS,SAAU,KAAM,MAClD,KAAM,CAAE,MAAO,QAAS,QAAS,QAAS,KAAM,MAChD,MAAO,CAAE,MAAO,SAAU,QAAS,SAAU,KAAM,KACrD,EAEaC,GAAyH,CACpI,WAAY,CACV,MAAO,cACP,QAAS,eACT,YAAa,qCACb,cAAe,yCAEjB,IAAK,CACH,MAAO,UACP,QAAS,SACT,YAAa,yBACb,cAAe,8BAEjB,KAAM,CACJ,MAAO,YACP,QAAS,WACT,YAAa,mBACb,cAAe,qBAEjB,OAAQ,CACN,MAAO,YACP,QAAS,gBACT,YAAa,0BACb,cAAe,kCAEnB,EAEaC,GAA2G,CACtH,OAAQ,CAAE,MAAO,UAAW,QAAS,OAAQ,MAAO,SACpD,QAAS,CAAE,MAAO,QAAS,QAAS,kBAAmB,MAAO,QAC9D,KAAM,CAAE,MAAO,cAAe,QAAS,cAAe,MAAO,QAC7D,QAAS,CAAE,MAAO,UAAW,QAAS,iBAAkB,MAAO,MACjE,EA8EaC,GAAyF,CACpG,UAAW,CAAE,MAAO,oBAAqB,QAAS,kBAClD,UAAW,CAAE,MAAO,gCAAiC,QAAS,oBAC9D,YAAa,CAAE,MAAO,eAAgB,QAAS,mBAC/C,iBAAkB,CAAE,MAAO,4BAA6B,QAAS,sBACjE,MAAO,CAAE,MAAO,iBAAkB,QAAS,eAC7C,EAEaC,GAA+G,CAC1H,QAAS,CAAE,MAAO,iBAAkB,QAAS,mBAAoB,MAAO,UACxE,SAAU,CAAE,MAAO,UAAW,QAAS,gBAAiB,MAAO,SAC/D,SAAU,CAAE,MAAO,YAAa,QAAS,aAAc,MAAO,OAC9D,QAAS,CAAE,MAAO,aAAc,QAAS,iBAAkB,MAAO,OACpE,ECr+EMC,GAAqC,CACzC,CACE,GAAI,kBACJ,MAAO,iBACP,YAAa,iDACb,KAAMpH,MAACqH,GAAA,CAAK,UAAU,yBAAyB,EAC/C,MAAO,WAEP,cAAgBzhB,GAAS,CAAC,CAACA,GAAM,mBAEnC,CACE,GAAI,YACJ,MAAO,0BACP,YAAa,qCACb,KAAMoa,MAACgD,GAAA,CAAM,UAAU,wBAAwB,EAC/C,MAAO,WACP,cAAgBpd,GAAS,CAAC,CAACA,GAAM,OAASA,EAAK,MAAM,OAAS,GAEhE,CACE,GAAI,gBACJ,MAAO,oBACP,YAAa,wCACb,KAAMoa,MAACoC,GAAA,CAAS,UAAU,yBAAyB,EACnD,MAAO,IAEP,cAAgBxc,GAAS,CAAC,CAACA,GAAM,kBAEnC,CACE,GAAI,cACJ,MAAO,sBACP,YAAa,8CACb,KAAMoa,MAACsC,GAAA,CAAI,UAAU,0BAA0B,EAC/C,MAAO,YACP,cAAe,CAAC1c,EAAMkf,IAAaA,EAAS,KAAKpQ,GAAKA,EAAE,UAAY9O,GAAM,EAAE,EAEhF,EAEO,SAAS0hB,IAAS,CACvB,KAAM,CAAE,KAAA1hB,CAAA,EAASuH,EAAA,EACX,CAAE,cAAAuX,EAAe,SAAArM,EAAU,SAAAyM,EAAU,eAAAyC,EAAgB,uBAAA5C,EAAwB,2BAAAC,EAA4B,6BAAAC,EAA8B,6BAAArE,CAAA,EAAiCpM,EAAA,EACxK,CAAE,SAAAiJ,CAAA,EAAaD,GAAA,EACfkH,EAAWC,GAAA,EACX,CAACC,EAAmBC,CAAoB,EAAI9D,WAAS,EAAK,EAC1D,CAAC6G,EAAaC,CAAc,EAAI9G,WAAS,IAAI,IAAM,EACnD+G,EAAmBC,SAAoB,IAAI,GAAK,EAChD,CAACC,EAAaC,CAAc,EAAIlH,WAAS,EAAE,EAC3C,CAACmH,EAAmBC,CAAoB,EAAIpH,WAAS,EAAK,EAI1DoE,EAAanf,GAAM,MAAM,gBAAkB,YAAcA,GAAM,MAAM,gBAAkB,SAEvFoiB,EAAepiB,GAAM,OAAS,UAAYA,GAAM,OAAS,mBACzDqiB,EAAyBlD,EAC3BqC,GAAiB,OAAOjB,GAAQ,CAACA,EAAK,cAAcvgB,EAAMkf,CAAQ,CAAC,EACnE,GAGEE,EAAoBD,EACtBF,EAA6Bjf,GAAM,OAAS,GAAIA,GAAM,YAAc,GAAIA,GAAM,UAAY,GAAIA,GAAM,OAAS,GAAIA,GAAM,QAAU,EAAE,EACnI4a,EAAA,EACEoB,EAA2BoD,EAAkB,OAAO3W,GAAK,CAACA,EAAE,SAAS,SAASzI,GAAM,IAAM,EAAE,CAAC,EAAE,OAG/Fsf,MAAc,KACdhE,EAAc,IAAI,KAAKgE,EAAQ,UAAY,MAAc,GAAK,GAAI,EAClED,EAAmB5H,EAAS,OAAO3O,GAAK,CAC5C,GAAI,CAACA,EAAE,kBAAmB,MAAO,GACjC,MAAM0S,GAAc,IAAI,KAAK1S,EAAE,iBAAiB,EAChD,OAAO0S,IAAe8D,GAAW9D,IAAeF,GAAexS,EAAE,SAAW,WAC9E,CAAC,EACKwZ,EAAsBjD,EAAiB,OAEvCkD,GAAmBhC,GAAyB,CAChD1B,EAAqB,EAAK,EAC1BH,EAAS6B,EAAK,KAAK,CACrB,EAGArF,YAAU,IAAM,CACd,MAAMsH,EAAQ,YAAY,IAAM,CAC9BX,EAAe,IAAI,IAAM,CAC3B,EAAG,GAAI,EACP,MAAO,IAAM,cAAcW,CAAK,CAClC,EAAG,EAAE,EAGLtH,YAAU,IAAM,CACd,GAAI,CAAClb,EAAM,OAEX,MAAMyiB,EAAwB,IAAM,CAClC,MAAMxa,EAAcV,EAAa,WAAW,KACtC,CAAE,SAAUmb,GAAiB,UAAWC,GAAkB,gBAAiBC,EAAA,EAAWpU,EAAa,WAEzG,GAAI,CAACvG,EAAa,OAElB,MAAMoG,MAAU,KACVwU,GAAkB,IAAI,KAAKxU,EAAI,UAAY,IAAU,GAAI,EACzDyU,GAAmB,IAAI,KAAKzU,EAAI,UAAY,IAAS,GAAI,EAGtCqU,GAAgB,OAAO1c,GAAK,CAEnD,GADI,CAACA,EAAE,eAAiB,CAACA,EAAE,eACvB,CAAC,CAAC,WAAY,UAAU,EAAE,SAASA,EAAE,MAAM,EAAG,MAAO,GAGzD,GAAIiC,EAAY,OAAS,WAAY,CACnC,MAAMuL,GAAWmP,GAAiB,SAAUpZ,GAAE,QAAUtB,EAAY,KAAK,EACzE,OAAOjC,EAAE,aAAewN,IAAU,EACpC,CAEA,OAAIvL,EAAY,OAAS,WAChBjC,EAAE,aAAeiC,EAAY,GAE/B,EACT,CAAC,EAEgB,QAAQrI,GAAW,CAGlC,MAAMmjB,GADUnjB,EAAQ,cACE,MAAM,GAAG,EAAE,CAAC,EAChC,CAACojB,GAAOC,EAAO,EAAIF,GAAU,MAAM,GAAG,EAAE,IAAI,MAAM,EAElDG,GAAoB,IAAI,KAAKtjB,EAAQ,aAAc,EACzDsjB,GAAkB,SAASF,GAAOC,GAAS,EAAG,CAAC,EAE/C,MAAME,GAAc,GAAGvjB,EAAQ,EAAE,SAC3BwjB,GAAe,GAAGxjB,EAAQ,EAAE,QAGlC,GAAIsjB,GAAoB7U,GAAO6U,IAAqBL,IAAmB,CAACf,EAAiB,QAAQ,IAAIqB,EAAW,EAAG,CACjH,MAAME,GAAe,KAAK,OAAOH,GAAkB,UAAY7U,EAAI,WAAa,GAAK,EAErFuU,GAAO,CACL,OAAQ3a,EAAY,GACpB,KAAM,mBACN,MAAO,sBAAsBob,EAAY,OACzC,QAAS,WAAWzjB,EAAQ,MAAM,KAAKA,EAAQ,KAAK,sBAAsBmjB,EAAS,KAAKnjB,EAAQ,OAAO,SAASA,EAAQ,SAAS,GACjI,UAAWA,EAAQ,GACpB,EAEDkiB,EAAiB,QAAQ,IAAIqB,EAAW,CAC1C,CAGA,GAAID,GAAoB7U,GAAO6U,IAAqBJ,IAAoB,CAAChB,EAAiB,QAAQ,IAAIsB,EAAY,EAAG,CACnH,MAAMC,GAAe,KAAK,OAAOH,GAAkB,UAAY7U,EAAI,WAAa,GAAK,EAEjFgV,IAAgB,GAAK,CAACvB,EAAiB,QAAQ,IAAIqB,EAAW,GAChEP,GAAO,CACL,OAAQ3a,EAAY,GACpB,KAAM,mBACN,MAAO,iBAAiBob,EAAY,QACpC,QAAS,WAAWzjB,EAAQ,MAAM,qBAAqByjB,EAAY,kBAAkBzjB,EAAQ,OAAO,SAASA,EAAQ,SAAS,GAC9H,UAAWA,EAAQ,GACpB,EAGHkiB,EAAiB,QAAQ,IAAIsB,EAAY,CAC3C,CACF,CAAC,CACH,EAGAX,EAAA,EACA,MAAMa,GAAgB,YAAYb,EAAuB,GAAK,EAC9D,MAAO,IAAM,cAAca,EAAa,CAC1C,EAAG,CAACtjB,GAAM,EAAE,CAAC,EAEb,MAAMye,GAAcze,EAAO2hB,EAAe3hB,EAAK,EAAE,EAAI,EAC/CujB,GAAkB9E,GAAc4D,EAAuB,OAASrG,EAA2BsG,EAC3F5C,GAAoBZ,EAAc,OAAOnK,GAAKA,EAAE,SAAW3U,GAAM,EAAE,EAAE,MAAM,EAAG,EAAE,EAGhFwjB,GAAoB,IACjB5B,EAAY,mBAAmB,QAAS,CAC7C,KAAM,UACN,OAAQ,UACR,OAAQ,UACT,EAGG6B,GAAoB,IACjB7B,EAAY,mBAAmB,QAAS,CAC7C,QAAS,QACT,IAAK,UACL,MAAO,QACR,EAGG8B,GAAe,IAAM,CACzB,OAAQ1jB,GAAM,MACZ,IAAK,QAAS,MAAO,gBACrB,IAAK,UAAW,MAAO,WACvB,IAAK,kBAAmB,MAAO,gBAAgB0gB,GAAsB1gB,GAAM,cAAwC,GAAK,EAAE,GAAG,OAC7H,IAAK,WAAY,OAAO0gB,GAAsB1gB,GAAM,cAAwC,GAAK,cACjG,IAAK,WAAY,MAAO,SACxB,QAAS,MAAO,eAEpB,EAEM2f,GAAcC,GAAoB,CACtC,MAAMhS,GAAO,IAAI,KAAKgS,CAAO,EAEvBC,OADU,OACG,UAAYjS,GAAK,UAC9BkS,GAAW,KAAK,MAAMD,GAAS,GAAK,EACpCE,GAAY,KAAK,MAAMF,GAAS,IAAO,EACvC8D,EAAW,KAAK,MAAM9D,GAAS,KAAQ,EAE7C,OAAIC,GAAW,EAAU,aACrBA,GAAW,GAAW,GAAGA,EAAQ,aACjCC,GAAY,GAAW,GAAGA,EAAS,WACnC4D,EAAW,EAAU,GAAGA,CAAQ,YAC7B/V,GAAK,mBAAmB,OAAO,CACxC,EAEMoS,GAAuBC,GAAiB,CAC5C,OAAQA,EAAA,CACN,IAAK,kBAAmB,MAAO,KAC/B,IAAK,mBAAoB,MAAO,KAChC,IAAK,mBAAoB,MAAO,IAChC,IAAK,kBAAmB,MAAO,KAC/B,IAAK,oBAAqB,MAAO,IACjC,IAAK,mBAAoB,MAAO,IAChC,IAAK,mBAAoB,MAAO,IAChC,IAAK,oBAAqB,MAAO,KACjC,IAAK,mBAAoB,MAAO,KAChC,QAAS,MAAO,KAEpB,EAGM2D,GAAgB5B,EAAY,OAC9BvP,EAAS,UACPzM,EAAE,MAAM,cAAc,SAASgc,EAAY,aAAa,GACxDhc,EAAE,YAAY,cAAc,SAASgc,EAAY,aAAa,GAC9Dhc,EAAE,OAAO,WAAW,SAASgc,CAAW,GACxChc,EAAE,aAAa,cAAc,SAASgc,EAAY,aAAa,GAC/Dhc,EAAE,QAAQ,cAAc,SAASgc,EAAY,aAAa,GAC1D,MAAM,EAAG,CAAC,EACZ,GAGE6B,GAAmB,IAAM,CACzB7jB,GAAM,OAAS,YAEjB0e,EAAS,GAAG,EAEZ,OAAO,cAAc,IAAI,YAAY,cAAc,CAAC,GAC3C1e,GAAM,OAAS,WAExB0e,EAAS,GAAG,EAGZA,EAAS,WAAW,CAExB,EAEA,OACEb,OAAC,UAAO,UAAU,4FAChB,UAAAzD,MAAC,OAAI,UAAU,0BAEZ,UAACgI,GACFvE,OAAC,OAAI,UAAU,WACb,UAAAzD,MAAC0J,GAAA,CAAO,UAAU,iEAAiE,EACnF1J,MAAC,SACC,KAAK,OACL,YAAY,kBACZ,MAAO4H,EACP,SAAWzY,GAAM,CACf0Y,EAAe1Y,EAAE,OAAO,KAAK,EAC7B4Y,EAAqB5Y,EAAE,OAAO,MAAM,OAAO,OAAS,CAAC,CACvD,EACA,QAAS,IAAMyY,EAAY,QAAUG,EAAqB,EAAI,EAC9D,UAAU,2BAGXD,GAAqB7B,gBACpBxC,OAAC,OAAI,UAAU,wBACb,UAAAzD,MAAC,OACC,UAAU,gBACV,QAAS,IAAM+H,EAAqB,EAAK,IAE3C/H,MAAC,OACC,UAAU,sGACV,MAAO,CAAE,OAAQ,OAEhB,YAAc,SAAW,EACxByD,OAAC,OAAI,UAAU,gCACb,UAAAzD,MAAC0J,GAAA,CAAO,UAAU,qCAAqC,EACvD1J,MAAC,KAAE,6BAAiB,GACtB,SAEC,OACC,UAAAyD,OAAC,OAAI,UAAU,gDAAgD,sBACnD+F,GAAc,OAAO,WACjC,EACCA,GAAc,IAAKhkB,GAClBie,OAAC,OAEC,QAAS,IAAM,CACba,EAAS,WAAW,EACpByD,EAAqB,EAAK,EAC1BF,EAAe,EAAE,CACnB,EACA,UAAU,+DAEV,UAAApE,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,QAAK,UAAU,wBAAwB,cAAEje,EAAQ,QAAO,EACzDwa,MAAC,QAAK,UAAU,sBAAuB,WAAQ,MAAM,GACvD,EACAyD,OAAC,OAAI,UAAU,6BAA8B,UAAAje,EAAQ,QAAQ,SAAOA,EAAQ,WAAU,QACrF,OAAI,UAAU,+BACb,SAAAwa,MAAC,QAAK,UAAW,oCACfxa,EAAQ,SAAW,MAAQ,4BAC3BA,EAAQ,SAAW,cAAgB,8BACnCA,EAAQ,SAAW,YAAc,8BACjC,2BACF,GACG,SAAAA,EAAQ,SAAW,MAAQ,QAC3BA,EAAQ,SAAW,cAAgB,WACnCA,EAAQ,SAAW,YAAc,YACjCA,EAAQ,OACX,EACF,IAzBKA,EAAQ,GA2BhB,GACH,GAEJ,EACF,EACA,SAAS,KACX,EACF,EAEF,EACAie,OAAC,OAAI,UAAU,0BAEb,UAAAA,OAAC,UACC,QAASgG,GACT,UAAU,uIACV,MAAM,uBAEN,UAAAzJ,MAAC2J,GAAA,CAAM,UAAU,2BAA2B,EAC5ClG,OAAC,OAAI,UAAU,aACb,UAAAzD,MAAC,OAAI,UAAU,gDAAiD,SAAAoJ,GAAA,EAAoB,EACpFpJ,MAAC,OAAI,UAAU,wBAAyB,aAAkB,CAAE,GAC9D,KAIFA,MAAC,OAAI,UAAU,WACb,SAAAyD,OAAC,UACC,QAAS,IAAMgB,EAAqB,CAACD,CAAiB,EACtD,UAAU,4CAEV,UAAAxE,MAACgG,GAAA,CAAK,UAAU,wBAAwB,EACvCmD,GAAkB,GACjBnJ,MAAC,QAAK,UAAU,+GACb,SAAAmJ,GAAkB,EAAI,KAAOA,EAAA,CAChC,KAGN,EAEA1F,OAAC,OAAI,UAAU,aACb,UAAAzD,MAAC,OAAI,UAAU,sBAAuB,SAAApa,GAAM,KAAK,EACjDoa,MAAC,OAAI,UAAU,wBAAyB,aAAa,CAAE,GACzD,GACF,EAGCwE,GAAqByB,gBACpBxC,OAAC,OAAI,UAAU,uBAEb,UAAAzD,MAAC,OACC,UAAU,4BACV,MAAO,CAAE,OAAQ,KACjB,QAAS,IAAMyE,EAAqB,EAAK,IAG3ChB,OAAC,OACC,UAAU,iHACV,MAAO,CAAE,OAAQ,MAAO,UAAW,uBAGnC,UAAAA,OAAC,OAAI,UAAU,4EACb,UAAAzD,MAAC,MAAG,UAAU,wBAAwB,uBAAW,EAChDqE,GAAc,GACbrE,MAAC,UACC,QAAS,IAAMpa,GAAQgf,EAA2Bhf,EAAK,EAAE,EACzD,UAAU,4CACX,0BAED,EAEJ,EAGCqiB,EAAuB,OAAS,GAC/BxE,OAAC,OAAI,UAAU,2BACb,UAAAzD,MAAC,OAAI,UAAU,kDACb,SAAAA,MAAC,KAAE,UAAU,qCAAqC,gCAAoB,EACxE,EACCiI,EAAuB,IAAK9B,GAC3BnG,MAAC,OAEC,QAAS,IAAMmI,GAAgBhC,CAAI,EACnC,UAAU,+EAEV,SAAA1C,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAAC,OAAI,UAAU,oFACZ,SAAAmG,EAAK,KACR,EACA1C,OAAC,OAAI,UAAU,iBACb,UAAAzD,MAAC,MAAG,UAAU,oCAAqC,SAAAmG,EAAK,MAAM,EAC9DnG,MAAC,KAAE,UAAU,+BAAgC,WAAK,YAAY,GAChE,EACAA,MAAC4J,GAAA,CAAa,UAAU,sCAAsC,GAChE,GAbKzD,EAAK,GAeb,GACH,EAIDvE,EAA2B,GAC1B6B,OAAC,OAAI,UAAU,2BACb,UAAAzD,MAAC,OAAI,UAAU,gDACb,SAAAyD,OAAC,KAAE,UAAU,4DACX,UAAAzD,MAACyC,EAAA,CAAU,UAAU,UAAU,EAAE,eACpBb,EAAyB,KACxC,EACF,EACCoD,EAAkB,OAAO3W,GAAK,CAACA,EAAE,SAAS,SAASzI,GAAM,IAAM,EAAE,CAAC,EAAE,MAAM,EAAG,CAAC,EAAE,IAAKoC,GACpFgY,MAAC,OAEC,QAAS,IAAM,CACbyE,EAAqB,EAAK,EAC1BH,EAASS,EAAa,iBAAmB,sBAAsB,CACjE,EACA,UAAU,6FAEV,SAAAtB,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAAC,OAAI,UAAU,oFACb,eAACyC,EAAA,CAAU,UAAU,wBAAwB,EAC/C,EACAgB,OAAC,OAAI,UAAU,iBACb,UAAAzD,MAAC,MAAG,UAAU,6CAA8C,SAAAhY,EAAa,MAAM,EAC/EgY,MAAC,KAAE,UAAU,4CAA6C,WAAa,QAAQ,GACjF,EACAA,MAAC,QAAK,UAAU,iDAAiD,GACnE,GAhBKhY,EAAa,GAkBrB,GACH,EAIDkgB,EAAsB,GACrBzE,OAAC,OAAI,UAAU,2BACb,UAAAzD,MAAC,OAAI,UAAU,oDACb,SAAAyD,OAAC,KAAE,UAAU,8DACX,UAAAzD,MAAC2C,EAAA,CAAM,UAAU,UAAU,EAAE,aAClBuF,EAAoB,KACjC,EACF,EACCjD,EAAiB,MAAM,EAAG,CAAC,EAAE,IAAKpZ,GACjCmU,MAAC,OAEC,QAAS,IAAM,CACbyE,EAAqB,EAAK,EAC1BH,EAASS,EAAa,YAAc,iBAAiB,CACvD,EACA,UAAU,+FAEV,SAAAtB,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAAC,OAAI,UAAU,sFACb,eAAC2C,EAAA,CAAM,UAAU,0BAA0B,EAC7C,EACAc,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,MAAG,UAAU,6CAA6C,2BAC1C5X,EAAQ,iBACzB,EACAmU,MAAC,KAAE,UAAU,+BACV,SAAAnU,EAAQ,kBAAoB,IAAI,KAAKA,EAAQ,iBAAiB,EAAE,mBAAmB,QAAS,CAAE,IAAK,UAAW,MAAO,QAAS,KAAM,UAAW,OAAQ,UAAW,EAAI,kBACzK,GACF,EACAmU,MAAC,QAAK,UAAU,mDAAmD,GACrE,GApBKnU,EAAQ,GAsBhB,GACH,EAIFmU,MAAC,OAAI,UAAU,yBAAyB,MAAO,CAAE,UAAW,SACzD,SAAAsF,GAAkB,SAAW,GAAK2C,EAAuB,SAAW,GAAKrG,IAA6B,GAAKsG,IAAwB,EAClIzE,OAAC,OAAI,UAAU,gCACb,UAAAzD,MAACgG,GAAA,CAAK,UAAU,uCAAuC,EACvDhG,MAAC,KAAE,2BAAe,GACpB,EACEsF,GAAkB,SAAW,EAC/B,KAEAA,GAAkB,IAAKnS,GACrB6M,MAAC,OAEC,QAAS,IAAM,CACR7M,EAAa,MAChBwR,EAAuBxR,EAAa,EAAE,CAE1C,EACA,UAAW,kFACRA,EAAa,KAAsB,WAAf,YACvB,GAEA,SAAAsQ,OAAC,OAAI,UAAU,aACb,UAAAzD,MAAC,QAAK,UAAU,yBAA0B,SAAA4F,GAAoBzS,EAAa,IAAI,EAAE,EACjFsQ,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAzD,MAAC,MAAG,UAAW,uBAAwB7M,EAAa,KAAyB,gBAAlB,eAAiC,GACzF,SAAAA,EAAa,MAChB,EACC,CAACA,EAAa,MACb6M,MAAC,QAAK,UAAU,wDAAwD,GAE5E,EACAA,MAAC,KAAE,UAAU,4CACV,WAAa,QAChB,QACC,KAAE,UAAU,6BACV,SAAAuF,GAAWpS,EAAa,SAAS,EACpC,GACF,GACF,GA5BKA,EAAa,GA8BrB,EAEL,EAGCmS,GAAkB,OAAS,GAC1BtF,MAAC,OAAI,UAAU,0CACb,SAAAA,MAAC,UACC,QAAS,IAAMyE,EAAqB,EAAK,EACzC,UAAU,+DACX,oBAED,CACF,IAEJ,EACF,EACA,SAAS,KACX,EACF,CAEJ,CChkBA,MAAMoF,GAAc,IAAmB,CACrC,GAAI,CACF,MAAMC,EAAS,eAAe,QAAQ,iBAAiB,EACvD,OAAOA,EAAS,IAAI,IAAI,KAAK,MAAMA,CAAM,CAAC,EAAI,IAAI,GACpD,MAAQ,CACN,WAAW,GACb,CACF,EAEMC,GAAe/iB,GAAe,CAClC,GAAI,CACF,MAAMgjB,EAAQH,GAAA,EACdG,EAAM,IAAIhjB,CAAE,EACZ,eAAe,QAAQ,kBAAmB,KAAK,UAAU,CAAC,GAAGgjB,CAAK,CAAC,CAAC,CACtE,MAAQ,CAER,CACF,EAEO,SAASC,IAAwB,CACtC,KAAM,CAAE,KAAArkB,CAAA,EAASuH,EAAA,EACX,CACJ,cAAAwK,EACA,6BAAAkN,EACA,yBAAAqF,EACA,SAAA7R,CAAA,EACEjE,EAAA,EAEE,CAAC+V,EAAQC,CAAS,EAAIzJ,WAAsB,EAAE,EAC9C0J,EAAe1C,SAAO,EAAK,EAGjC7G,YAAU,IAAM,CAId,GAFIuJ,EAAa,SAEb,CAACzkB,GAAQA,EAAK,OAAS,WACzB,OAOF,MAAM0kB,EAAwBzF,EAC5Bjf,EAAK,MACLA,EAAK,WACLA,EAAK,SACLA,EAAK,MACLA,EAAK,QAKD2kB,EAAWV,GAAA,EAcXW,EAXsBF,EAAsB,OAAOjc,GAAK,CAC5D,MAAMoc,EAAWpc,EAAE,WAAa,UAAYA,EAAE,WAAa,YACrDqc,EAAY,CAACrc,EAAE,SAAS,SAASzI,EAAK,EAAE,EACxC+kB,EAAW,CAACJ,EAAS,IAAI,gBAAgBlc,EAAE,EAAE,EAAE,EAErD,OAAOoc,GAAYC,GAAaC,CAClC,CAAC,EAKkD,IAAItc,GAAK,CAC1D,MAAMuc,EAAY,mCAAmC,KAAKvc,EAAE,MAAQ,IAAMA,EAAE,OAAO,EAEnF,OAAA0b,GAAY,gBAAgB1b,EAAE,EAAE,EAAE,EAE3B,CACL,GAAI,gBAAgBA,EAAE,EAAE,GACxB,KAAMuc,EAAY,uBAAyB,sBAC3C,MAAOvc,EAAE,MACT,QAASA,EAAE,QAAQ,OAAS,IAAMA,EAAE,QAAQ,UAAU,EAAG,GAAG,EAAI,MAAQA,EAAE,QAC1E,YAAa,UACb,SAAU,IAAM,CACd6b,EAAyB7b,EAAE,GAAIzI,EAAK,EAAE,CACxC,EAEJ,CAAC,EAEG4kB,EAAU,OAAS,GAErBJ,KAAkB,CAAC,GAAGS,EAAM,GAAGL,CAAS,CAAC,EAG3CH,EAAa,QAAU,EACzB,EAAG,CAACzkB,EAAM+R,EAAekN,EAA8BqF,CAAwB,CAAC,EAGhFpJ,YAAU,IAAM,CACd,GAAI,CAAClb,GAAQA,EAAK,OAAS,WACzB,OAGF,MAAM2kB,EAAWV,GAAA,EAWXW,EARkBnS,EAAS,OAAOzM,GACtCA,EAAE,aAAehG,EAAK,IACtBgG,EAAE,SAAW,oBACb,CAAC2e,EAAS,IAAI,qBAAqB3e,EAAE,EAAE,EAAE,GAKI,IAAIA,IACjDme,GAAY,qBAAqBne,EAAE,EAAE,EAAE,EAEhC,CACL,GAAI,qBAAqBA,EAAE,EAAE,GAC7B,KAAM,oBACN,MAAO,oBACP,QAAS,UAAUA,EAAE,MAAM,KAAKA,EAAE,cAAgB,aAAa,yEAC/D,YAAa,iBACb,SAAU,IAAM,CAEd,eAAe,QAAQ,0BAA2BA,EAAE,EAAE,EAGlD,OAAO,SAAS,WAAa,IAC/B,OAAO,SAAS,KAAO,IAGvB,OAAO,cAAc,IAAI,YAAY,kBAAmB,CAAE,OAAQ,CAAE,UAAWA,EAAE,GAAG,CAAG,CAAC,CAE5F,GAEH,EAEG4e,EAAU,OAAS,GAErBJ,KAAkB,CAAC,GAAGS,EAAM,GAAGL,CAAS,CAAC,CAE7C,EAAG,CAAC5kB,EAAMyS,CAAQ,CAAC,EAEnB,MAAMyS,EAAejK,cAAa7Z,GAAe,CAC/CojB,KAAkBS,EAAK,UAAYvb,EAAE,KAAOtI,CAAE,CAAC,CACjD,EAAG,EAAE,EAEC+jB,EAAWlK,cAAamK,GAAiC,CAC7D,MAAMhkB,EAAK,UAAU,KAAK,KAAK,GAC/BojB,EAAUS,GAAQ,CAAC,GAAGA,EAAM,CAAE,GAAGG,EAAO,GAAAhkB,CAAA,CAAI,CAAC,CAC/C,EAAG,EAAE,EAEL,MAAO,CACL,OAAAmjB,EACA,aAAAW,EACA,SAAAC,CAAA,CAEJ,CCjKA,MAAME,OAA8C,IAE7C,SAASC,GAAwBC,EAA+B,CACrE,OAAAF,GAAc,IAAIE,CAAQ,EACnB,IAAMF,GAAc,OAAOE,CAAQ,CAC5C,CAEA,SAASC,GAAgBxd,EAAc,CACrCqd,GAAc,QAAQE,GAAYA,EAASvd,CAAO,CAAC,CACrD,CAIA,MAAMyd,OAAmD,IAOzD,SAASC,GAAqBzP,EAAiB,CAC7CwP,GAAoB,QAAQF,GAAYA,EAAStP,CAAU,CAAC,CAC9D,CAaO,SAAS0P,IAAmB,CACjC,KAAM,CAAE,KAAA3lB,EAAM,MAAAd,CAAA,EAAUqI,EAAA,EAClB,CAAE,cAAAqe,EAAe,eAAAC,EAAgB,mBAAAC,EAAoB,wBAAAC,CAAA,EAA4BvX,EAAA,EACjF,CAAE,cAAAwX,CAAA,EAAkBxO,GAAA,EAEpByO,EAAQlE,SAAyB,IAAI,EACrCmE,EAAsBnE,SAA8B,IAAI,EACxDoE,EAAoBpE,SAAO,CAAC,EAC5BqE,EAAuBrE,SAA8B,IAAI,EACzDsE,EAActE,SAAe,CAAC,EAE9BuE,EAAyB,GACzBC,EAAgB,IAChBC,EAAqB,IAErBC,EAAWxL,cAAY,SAAY,CACvC,GAAI,CAACjb,EAAM,OAGX,MAAMqO,EAAM,KAAK,MACjB,GAAI,EAAAA,EAAMgY,EAAY,QAAUE,GAGhC,CAAAF,EAAY,QAAUhY,EAEtB,GAAI,CAEF,MAAMqY,EAA4B,CAACd,GAAe,EAE9C,CAAC,UAAW,QAAS,WAAY,aAAc,iBAAiB,EAAE,SAAS5lB,EAAK,IAAI,GACtF0mB,EAAS,KAAKb,GAAgB,EAGhC,MAAM,QAAQ,IAAIa,CAAQ,CAC5B,MAAgB,CAEhB,EACF,EAAG,CAAC1mB,EAAM4lB,EAAeC,CAAc,CAAC,EAElCc,EAAe1L,cAAY,SAAY,CAC3C,GAAKjb,EACL,GAAI,CAEF,MAAMgmB,EAAA,CACR,MAAgB,CAEhB,CACF,EAAG,CAAChmB,EAAMgmB,CAAa,CAAC,EAElBY,EAAiB3L,cAAY,IAAM,CACnCmL,EAAqB,SACvB,cAAcA,EAAqB,OAAO,EAG5CA,EAAqB,QAAU,YAAY,IAAM,CAC3CH,EAAM,SAAS,aAAe,UAAU,MAE1CA,EAAM,QAAQ,KAAK,KAAK,UAAU,CAAE,KAAM,OAAQ,CAAC,CAEvD,EAAGO,CAAkB,CACvB,EAAG,EAAE,EAECK,EAAgB5L,cAAY,IAAM,CAClCmL,EAAqB,UACvB,cAAcA,EAAqB,OAAO,EAC1CA,EAAqB,QAAU,KAEnC,EAAG,EAAE,EAECU,EAAU7L,cAAY,IAAM,CAChC,GAAI,CAACjb,GAAQ,CAACd,EAAO,OAGjB+mB,EAAM,UACRA,EAAM,QAAQ,QACdA,EAAM,QAAU,MAOlB,MAAMc,EAAQ,GADG,OAAO,SAAS,WAAa,SAAW,OAAS,KACzC,KAAK,OAAO,SAAS,IAAI,iBAAiB7nB,CAAK,GAExE,GAAI,CACF,MAAM8nB,EAAK,IAAI,UAAUD,CAAK,EAC9Bd,EAAM,QAAUe,EAEhBA,EAAG,OAAS,IAAM,CAEhBb,EAAkB,QAAU,EAC5BS,EAAA,CACF,EAEAI,EAAG,UAAY,MAAOxZ,GAAU,CAC9B,GAAI,CACF,MAAMxF,EAAU,KAAK,MAAMwF,EAAM,IAAI,EAGrC,OAAQxF,EAAQ,MACd,IAAK,YAGH,MAAMye,EAAA,EACN,MAAME,EAAA,EACN,MAEF,IAAK,OAEH,MAEF,IAAK,iBAEH,MAAMF,EAAA,EACN,MAEF,IAAK,iBAKH,GAHA,MAAME,EAAA,EAGF3e,EAAQ,MAAM,UAAYA,EAAQ,KAAK,SAAS,OAAS,EAAG,CAC9D,MAAMif,EAAgBjf,EAAQ,KAAK,SAAS,KAAMc,GAChDA,EAAE,SAAW,eAAiBA,EAAE,SAAW,sBAEzCme,GACF,MAAM/Y,GAAkB,KAAK,CAC3B,MAAO,sBACP,KAAM+Y,EAAc,SAAW,cAC3B,mDACA,mDACJ,IAAK,WAAWA,EAAc,EAAE,GAChC,mBAAoB,GACpB,KAAM,CAAE,IAAK,YAAY,CAC1B,CAEL,CACA,MAEF,IAAK,sBAEH,MAAMnB,EAAA,EACN,MAEF,IAAK,eAEHN,GAAgBxd,EAAQ,MAAM,SAAWA,EAAQ,IAAI,EACrD,MAEF,IAAK,YAEHwd,GAAgB,CAAE,KAAM,OAAQ,GAAGxd,EAAQ,KAAM,EACjD,MAEF,IAAK,kBAEC,CAAC,UAAW,QAAS,WAAY,aAAc,iBAAiB,EAAE,SAAShI,EAAK,IAAI,GACtF,MAAM6lB,EAAA,EAER,MAEF,IAAK,oBAEH,MAAME,EAAA,EACF/d,EAAQ,MAAM,YAChB0d,GAAqB1d,EAAQ,KAAK,UAAU,EAE9C,MAEF,SAGJ,MAAgB,CAEhB,CACF,EAEAgf,EAAG,QAAWznB,GAAU,CAExB,EAEAynB,EAAG,QAAWxZ,GAAU,CAMtB,GAJAqZ,EAAA,EACAZ,EAAM,QAAU,KAGZE,EAAkB,QAAUG,EAAwB,CACtD,MAAMY,EAAQ,KAAK,IAAI,IAAO,KAAK,IAAI,EAAGf,EAAkB,OAAO,EAAG,GAAK,EAG3ED,EAAoB,QAAU,WAAW,IAAM,CAC7CC,EAAkB,UAClBW,EAAA,CACF,EAAGI,CAAK,CACV,CAIF,CACF,MAAgB,CAEhB,CACF,EAAG,CAAClnB,EAAMd,EAAOunB,EAAUE,EAAcC,EAAgBC,EAAed,CAAuB,CAAC,EAEhG7K,mBAAU,IAAM,CACd,GAAI,CAAClb,GAAQ,CAACd,EAAO,CAEf+mB,EAAM,UACRA,EAAM,QAAQ,QACdA,EAAM,QAAU,MAElBY,EAAA,EACA,MACF,CAGA,OAAAJ,EAAA,EACAE,EAAA,EAGAG,EAAA,EAGO,IAAM,CACPb,EAAM,UACRA,EAAM,QAAQ,QACdA,EAAM,QAAU,MAEdC,EAAoB,SACtB,aAAaA,EAAoB,OAAO,EAE1CW,EAAA,CACF,CACF,EAAG,CAAC7mB,EAAMd,EAAO4nB,EAASL,EAAUE,EAAcE,CAAa,CAAC,EAGhE3L,YAAU,IAAM,CACd,MAAMiM,EAAyB,IAAM,CAC9B,SAAS,SAEZV,EAAA,EACAE,EAAA,GAGI,CAACV,EAAM,SAAWA,EAAM,QAAQ,aAAe,UAAU,UAC3DE,EAAkB,QAAU,EAC5BW,EAAA,GAGN,EAEA,gBAAS,iBAAiB,mBAAoBK,CAAsB,EAC7D,IAAM,CACX,SAAS,oBAAoB,mBAAoBA,CAAsB,CACzE,CACF,EAAG,CAACL,EAASL,EAAUE,CAAY,CAAC,EAQ7B,CAAE,QALO1L,cAAY,IAAM,CAChCwL,EAAA,EACAE,EAAA,CACF,EAAG,CAACF,EAAUE,CAAY,CAAC,CAElB,CACX,CCjSO,SAASS,GAAkB,CAChC,KAAAnH,EACA,MAAAtS,EACA,QAAA3F,EACA,QAAAwS,EACA,SAAA6M,EACA,YAAAC,EACA,UAAAC,EAAY,CACd,EAA2B,CACzB,KAAM,CAACC,EAAWC,CAAY,EAAI1M,WAAS,EAAK,EAEhDG,YAAU,IAAM,CACd,GAAIqM,EAAY,EAAG,CACjB,MAAM/E,EAAQ,WAAW,IAAMkF,EAAA,EAAeH,CAAS,EACvD,MAAO,IAAM,aAAa/E,CAAK,CACjC,CACF,EAAG,CAAC+E,CAAS,CAAC,EAEd,MAAMG,EAAc,IAAM,CACxBD,EAAa,EAAI,EACjB,WAAW,IAAMjN,EAAA,EAAW,GAAG,CACjC,EAEMmN,EAAe,IAAM,CACrBN,GACFA,EAAA,EAEFK,EAAA,CACF,EAEME,EAAU,IAAM,CACpB,OAAQ3H,EAAA,CACN,IAAK,sBACH,OAAO7F,MAACyN,GAAA,CAAc,UAAU,uBAAuB,EACzD,IAAK,uBACH,OAAOzN,MAAC2C,EAAA,CAAM,UAAU,wBAAwB,EAClD,IAAK,oBACH,OAAO3C,MAACkG,GAAA,CAAY,UAAU,yBAAyB,EACzD,QACE,OAAOlG,MAACgG,GAAA,CAAK,UAAU,0BAA0B,EAEvD,EAEM0H,EAAa,IAAM,CACvB,OAAQ7H,EAAA,CACN,IAAK,sBACH,MAAO,4DACT,IAAK,uBACH,MAAO,8DACT,IAAK,oBACH,MAAO,iEACT,QACE,MAAO,iEAEb,EAEM8H,EAAoB,IAAM,CAC9B,OAAQ9H,EAAA,CACN,IAAK,sBACH,MAAO,yCACT,IAAK,uBACH,MAAO,2CACT,IAAK,oBACH,MAAO,6CACT,QACE,MAAO,+CAEb,EAEA,OACE7F,MAAC,OAAI,UAAU,0FACb,SAAAyD,OAAC,OACC,UAAW;AAAA;AAAA,YAEPiK,GAAY;AAAA,YACZN,EAAY,gDAAkD,4CAA4C;AAAA,UAI9G,UAAApN,MAAC,UACC,QAASsN,EACT,UAAU,8EAEV,SAAAtN,MAAC4N,GAAA,CAAE,UAAU,wBAAwB,IAIvC5N,MAAC,OAAI,UAAU,2BACb,SAAAA,MAAC,OAAI,UAAU,6EACZ,SAAAwN,EAAA,CAAQ,CACX,EACF,EAGAxN,MAAC,MAAG,UAAU,mDACX,SAAAzM,EACH,EAGAyM,MAAC,KAAE,UAAU,iDACV,SAAApS,EACH,EAGA6V,OAAC,OAAI,UAAU,sBACZ,UAAAwJ,GAAYC,GACXlN,MAAC,UACC,QAASuN,EACT,UAAW,+DAA+DI,EAAA,CAAmB,GAE5F,SAAAT,CAAA,GAGLlN,MAAC,UACC,QAASsN,EACT,UAAU,2FACX,oBAED,EACF,KAEJ,CAEJ,CAiBO,SAASO,GAAa,CAAE,OAAA1D,EAAQ,UAAA2D,GAAgC,CACrE,MAAMC,EAAe5D,EAAO,CAAC,EAE7B,OAAK4D,EAGH/N,MAACgN,GAAA,CACC,KAAMe,EAAa,KACnB,MAAOA,EAAa,MACpB,QAASA,EAAa,QACtB,YAAaA,EAAa,YAC1B,SAAUA,EAAa,SACvB,QAAS,IAAMD,EAAUC,EAAa,EAAE,IATlB,IAY5B,CCpJO,MAAMC,GAAqBC,OAChC,CAAC,CAAE,QAAAC,EAAU,GAAqB,SAAAC,EAAW,kBAAqB,CAChE,KAAM,CAACC,EAAOC,CAAQ,EAAI1N,WAA2B,CACnD,IAAK,GACL,OAAQ,EACR,WAAY,EACZ,WAAY,EACb,EACK,CAAC2N,EAAYC,CAAa,EAAI5N,WAAS,EAAK,EA8ElD,GA5EAG,YAAU,IAAM,CACd,GAAI,CAACoN,EAAS,OAGd,IAAIM,EAAa,EACbC,EAAW,YAAY,MACvBC,EAEJ,MAAMC,EAAa,IAAM,CACvBH,IACA,MAAMhH,EAAc,YAAY,MAEhC,GAAIA,GAAeiH,EAAW,IAAM,CAClC,MAAMG,EAAM,KAAK,MAAOJ,EAAa,KAAShH,EAAciH,EAAS,EACrED,EAAa,EACbC,EAAWjH,EAEX6G,EAASxD,IAAS,CAAE,GAAGA,EAAM,IAAA+D,GAAM,CACrC,CAEAF,EAAmB,sBAAsBC,CAAU,CACrD,EAEAD,EAAmB,sBAAsBC,CAAU,EAGnD,MAAME,EAAiB,YAAY,IAAM,CACvC,GAAI,WAAY,YAAa,CAC3B,MAAMC,EAAO,YAAoB,OAC3BC,EAAS,KAAK,MAAMD,EAAI,eAAiB,KAAO,IAAI,EAC1DT,MAAkB,CAAE,GAAGxD,EAAM,OAAQkE,GAAS,CAChD,CACF,EAAG,GAAI,EAGDC,EAAiB,YAAY,IAAM,CACvC,GAAK,OAAe,YAAa,CAE/B,MAAMC,EADY,OAAe,YAAY,cACd,OAAQvgB,GAAWA,EAAE,KAAK,WAAW,SAAS,CAAC,EAE9E,GAAIugB,EAAc,OAAS,EAAG,CAC5B,MAAMC,EAAgBD,EAAc,OAAO,CAACtf,EAAajB,IAAWiB,EAAMjB,EAAE,IAAK,CAAC,EAAIugB,EAAc,OACpGZ,EAASxD,IAAS,CAAE,GAAGA,EAAM,WAAY,KAAK,MAAMqE,CAAa,GAAI,CACvE,CACF,CACF,EAAG,GAAI,EAGDC,EAAgB,OAAO,MAC7B,IAAIC,EAAyB,GAE7B,cAAO,MAAQ,SAAUC,IAAS,CAChC,MAAM1G,EAAY,YAAY,MACxBzjB,EAAW,MAAMiqB,EAAc,GAAGE,CAAI,EACtCC,EAAW,YAAY,MAAQ3G,EAGrC,GAAI,OAAO0G,EAAK,CAAC,GAAM,UAAYA,EAAK,CAAC,EAAE,SAAS,OAAO,EAAG,CAC5DD,EAAa,KAAKE,CAAQ,EACtBF,EAAa,OAAS,KAAIA,EAAeA,EAAa,MAAM,GAAG,GAEnE,MAAMG,EAAaH,EAAa,OAAO,CAACzf,EAAKoG,IAAMpG,EAAMoG,EAAG,CAAC,EAAIqZ,EAAa,OAC9Ef,EAASxD,IAAS,CAAE,GAAGA,EAAM,WAAY,KAAK,MAAM0E,CAAU,GAAI,CACpE,CAEA,OAAOrqB,CACT,EAEO,IAAM,CACX,qBAAqBwpB,CAAgB,EACrC,cAAcG,CAAc,EAC5B,cAAcG,CAAc,EAC5B,OAAO,MAAQG,CACjB,CACF,EAAG,CAACjB,CAAO,CAAC,EAER,CAACA,EAAS,OAAO,KAErB,MAAMsB,EAAkB,CACtB,WAAY,eACZ,YAAa,gBACb,cAAe,kBACf,eAAgB,oBAGZC,EAAiB,CAACC,EAAgCxiB,IAA0B,CAQhF,MAAMyiB,EAPa,CACjB,IAAK,CAAE,KAAM,GAAI,QAAS,IAC1B,OAAQ,CAAE,KAAM,IAAK,QAAS,KAC9B,WAAY,CAAE,KAAM,GAAI,QAAS,KACjC,WAAY,CAAE,KAAM,IAAK,QAAS,IAAI,EAGXD,CAAM,EACnC,OAAIA,IAAW,MAETxiB,GAASyiB,EAAU,KAAa,iBAChCziB,GAASyiB,EAAU,QAAgB,kBAChC,eAGHziB,GAASyiB,EAAU,KAAa,iBAChCziB,GAASyiB,EAAU,QAAgB,kBAChC,cAEX,EAEA,OACElM,OAAC,OACC,UAAW,SAAS+L,EAAgBrB,CAAQ,CAAC,kHAC3CG,EAAa,OAAS,WACxB,GAGA,UAAAtO,MAAC,UACC,QAAS,IAAMuO,EAAc,CAACD,CAAU,EACxC,UAAU,gGACV,MAAM,sBAEN,SAAAtO,MAAC4P,GAAA,CAAI,UAAU,UAAU,IAI1BtB,GACC7K,OAAC,OAAI,UAAU,8BAEb,UAAAA,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAAC4P,GAAA,CAAI,UAAU,0BAA0B,QACxC,QAAK,UAAU,gBAAgB,eAAG,GACrC,EACA5P,MAAC,QAAK,UAAW,uBAAuByP,EAAe,MAAOrB,EAAM,GAAG,CAAC,GACrE,SAAAA,EAAM,IACT,GACF,EAGCA,EAAM,OAAS,GACd3K,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAAC6P,GAAA,CAAW,UAAU,wBAAwB,QAC7C,QAAK,UAAU,gBAAgB,kBAAM,GACxC,EACApM,OAAC,QAAK,UAAW,uBAAuBgM,EAAe,SAAUrB,EAAM,MAAM,CAAC,GAC3E,UAAAA,EAAM,OAAO,OAChB,GACF,EAIDA,EAAM,WAAa,GAClB3K,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAAC2J,GAAA,CAAM,UAAU,yBAAyB,QACzC,QAAK,UAAU,gBAAgB,kBAAM,GACxC,EACAlG,OAAC,QAAK,UAAW,uBAAuBgM,EAAe,aAAcrB,EAAM,UAAU,CAAC,GACnF,UAAAA,EAAM,WAAW,OACpB,GACF,EAIDA,EAAM,WAAa,GAClB3K,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAzD,MAAC4P,GAAA,CAAI,UAAU,0BAA0B,QACxC,QAAK,UAAU,gBAAgB,eAAG,GACrC,EACAnM,OAAC,QAAK,UAAW,uBAAuBgM,EAAe,aAAcrB,EAAM,UAAU,CAAC,GACnF,UAAAA,EAAM,WAAW,OACpB,GACF,QAID,OAAI,UAAU,gCACb,SAAApO,MAAC,OAAI,UAAU,0BACZ,SAAAoO,EAAM,KAAO,IAAMA,EAAM,YAAc,IAAMA,EAAM,YAAc,IAChE3K,OAAAC,WAAA,CACE,UAAA1D,MAACkG,GAAA,CAAY,UAAU,yBAAyB,QAC/C,QAAK,UAAU,6BAA6B,qBAAS,GACxD,EACEkI,EAAM,KAAO,IAAMA,EAAM,YAAc,KAAOA,EAAM,YAAc,IACpE3K,OAAAC,WAAA,CACE,UAAA1D,MAAC8P,GAAA,CAAY,UAAU,0BAA0B,QAChD,QAAK,UAAU,8BAA8B,gBAAI,GACpD,EAEArM,OAAAC,WAAA,CACE,UAAA1D,MAAC8P,GAAA,CAAY,UAAU,uBAAuB,QAC7C,QAAK,UAAU,2BAA2B,gBAAI,GACjD,EAEJ,EACF,EAGArM,OAAC,OAAI,UAAU,2CACb,UAAAzD,MAAC,UACC,QAAS,IAAM,CACR,OAAe,YACF,OAAe,YAGnC,EACA,UAAU,0GACX,oBAGDA,MAAC,UACC,QAAS,IAAM,CACR,OAAe,aACjB,OAAe,YAAY,OAEhC,EACA,UAAU,0GACX,kBAED,EACF,GACF,IAIR,CACF,EAEAgO,GAAmB,YAAc,qBC1PjC,MAAM+B,GAAa,IACjB/P,MAAC,OAAI,UAAU,wCACb,SAAAA,MAACgQ,GAAA,CAAQ,UAAU,qCAAqC,EAC1D,EAIIC,GAAmBC,OAAK,IAAAlZ,EAAA,IAAM,OAAO,8CAA8B,sCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,kBAAmB,CAAC,EACjHyhB,GAA0BD,OAAK,IAAAlZ,EAAA,IAAM,OAAO,qDAAqC,oCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,yBAA0B,CAAC,EACtI0hB,GAAoBF,OAAK,IAAAlZ,EAAA,IAAM,OAAO,+CAA+B,kCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,mBAAoB,CAAC,EACpH2hB,GAAuBH,OAAK,IAAAlZ,EAAA,IAAM,OAAO,kDAAkC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,sBAAuB,CAAC,EAC7H4hB,GAAoBJ,OAAK,IAAAlZ,EAAA,IAAM,OAAO,+CAA+B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,mBAAoB,CAAC,EACpH6hB,GAA4BL,OAAK,IAAAlZ,EAAA,IAAM,OAAO,uDAAuC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,2BAA4B,CAAC,EAC5I8hB,GAAoBN,OAAK,IAAAlZ,EAAA,IAAM,OAAO,+CAA+B,mCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,mBAAoB,CAAC,EACpH+hB,GAAiBP,OAAK,IAAAlZ,EAAA,IAAM,OAAO,4CAA4B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,gBAAiB,CAAC,EAC3GgiB,GAAoBR,OAAK,IAAAlZ,EAAA,IAAM,OAAO,+CAA+B,uCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,mBAAoB,CAAC,EACpHiiB,GAAgBT,OAAK,IAAAlZ,EAAA,IAAM,OAAO,2CAA2B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,eAAgB,CAAC,EACxGkiB,GAAoBV,OAAK,IAAAlZ,EAAA,IAAM,OAAO,+CAA+B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,mBAAoB,CAAC,EACpHmiB,GAAeX,OAAK,IAAAlZ,EAAA,IAAM,OAAO,0CAA0B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,cAAe,CAAC,EACrGoiB,GAA4BZ,OAAK,IAAAlZ,EAAA,IAAM,OAAO,uDAAuC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,2BAA4B,CAAC,EAC5IqiB,GAAuBb,OAAK,IAAAlZ,EAAA,IAAM,OAAO,kDAAkC,oCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,sBAAuB,CAAC,EAC7HsiB,GAA4Bd,OAAK,IAAAlZ,EAAA,IAAM,OAAO,uDAAuC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,2BAA4B,CAAC,EAC5IuiB,GAAiBf,OAAK,IAAAlZ,EAAA,IAAM,OAAO,4CAA4B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,gBAAiB,CAAC,EAC3GwiB,GAAgBhB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,2CAA2B,gCAAC,EAC9Dma,GAAoBjB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,+CAA+B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,mBAAoB,CAAC,EACpH0iB,GAAuBlB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,kDAAkC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,sBAAuB,CAAC,EAC7H2iB,GAAoBnB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,+CAA+B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,mBAAoB,CAAC,EACpH4iB,GAA0BpB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,qDAAqC,oCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,yBAA0B,CAAC,EACtI6iB,GAAqBrB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,gDAAgC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,oBAAqB,CAAC,EACvH8iB,GAAyBtB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,oDAAoC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,wBAAyB,CAAC,EACnI+iB,GAAgBvB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,2CAA2B,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,eAAgB,CAAC,EACxGgjB,GAAWxB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,sCAAsB,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,UAAW,CAAC,EACzFijB,GAAsBzB,OAAK,IAAAlZ,EAAA,IAAM,OAAO,iDAAiC,uCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,qBAAsB,CAAC,EAC1HkjB,GAAuB1B,OAAK,IAAAlZ,EAAA,IAAM,OAAO,kDAAkC,uCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,sBAAuB,CAAC,EAC7HmjB,GAA6B3B,OAAK,IAAAlZ,EAAA,IAAM,OAAO,wDAAwC,gCAAC,EACxF8a,GAAsB5B,OAAK,IAAAlZ,EAAA,IAAM,OAAO,iDAAiC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,qBAAsB,CAAC,EAC1HqjB,GAAyB7B,OAAK,IAAAlZ,EAAA,IAAM,OAAO,oDAAoC,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,wBAAyB,CAAC,EACnIsjB,GAAc9B,OAAK,IAAAlZ,EAAA,IAAM,OAAO,yCAAyB,iCAAE,KAAKtI,IAAM,CAAE,QAASA,EAAE,aAAc,CAAC,EAClGujB,GAAkB/B,OAAK,UAAM,OAAO,6CAAoC,iCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,iBAAkB,CAAC,EACrHwjB,GAAgBhC,OAAK,UAAM,OAAO,2CAAkC,iCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,eAAgB,CAAC,EAC/GyjB,GAAejC,OAAK,UAAM,OAAO,0CAAiC,mCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,cAAe,CAAC,EAC5G0jB,GAAclC,OAAK,UAAM,OAAO,yCAAiC,iCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,aAAc,CAAC,EAC1G2jB,GAAWnC,OAAK,UAAM,OAAO,sCAA4B,iCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,UAAW,CAAC,EAC/F4jB,GAAcpC,OAAK,UAAM,OAAO,yCAA+B,iCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,aAAc,CAAC,EACxG6jB,GAAerC,OAAK,UAAM,OAAO,0CAAgC,iCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,cAAe,CAAC,EAC3G8jB,GAAiBtC,OAAK,UAAM,OAAO,4CAAkC,qCAAE,KAAKxhB,IAAM,CAAE,QAASA,EAAE,gBAAiB,CAAC,EAEhH,SAAS+jB,IAAS,CACvB,MAAMpS,EAAWC,GAAA,EACX,CAAE,KAAA1a,EAAM,OAAA8sB,CAAA,EAAWvlB,EAAA,EACnB,CAACwlB,EAAaC,CAAc,EAAIjS,WAAS,EAAK,EAC9C,CAAE,eAAA4G,EAAgB,mBAAAmE,CAAA,EAAuBtX,EAAA,EACzCiQ,EAAcze,EAAO2hB,EAAe3hB,EAAK,EAAE,EAAI,EAG/C,CAAE,OAAAukB,EAAQ,aAAAW,CAAA,EAAiBb,GAAA,EAGjCsB,GAAA,EAGAzK,YAAU,IAAM,CACd4K,EAAA,CACF,EAAG,CAACA,CAAkB,CAAC,EAGvB5K,YAAU,IAAM,CACd8R,EAAe,EAAK,CACtB,EAAG,CAACvS,EAAS,QAAQ,CAAC,EAGtB,MAAMwS,EAAe,IAAM,CAEzB,GAAIjtB,GAAM,eAAiB,aACzB,aAAQksB,GAAA,EAAoB,EAE9B,GAAIlsB,GAAM,eAAiB,iBACzB,aAAQmsB,GAAA,EAAuB,EAGjC,OAAQnsB,GAAM,MACZ,IAAK,QACH,aAAQ6qB,GAAA,EAAe,EACzB,IAAK,WACH,aAAQC,GAAA,EAAkB,EAC5B,IAAK,kBACH,aAAQP,GAAA,EAAwB,EAClC,IAAK,WACH,aAAQC,GAAA,EAAkB,EAC5B,IAAK,WACH,aAAQI,GAAA,EAAkB,EAC5B,IAAK,SACL,IAAK,mBACH,aAAQyB,GAAA,EAAgB,EAC1B,QACE,aAAQhC,GAAA,EAAiB,EAE/B,EAGM6C,EAAuB,IACvBltB,GAAM,OAAS,iBACTkrB,GAAA,EAA0B,EAEhClrB,GAAM,OAAS,iBACT2qB,GAAA,EAA0B,QAE5BK,GAAA,EAAkB,EAItBmC,EAAkB,IAClBntB,GAAM,OAAS,iBACTmrB,GAAA,EAAqB,QAEvBF,GAAA,EAAa,EAIjBmC,EAAqB,IACrBptB,GAAM,OAAS,iBACT0rB,GAAA,EAAwB,QAE1BE,GAAA,EAAuB,EAGjC,OACE/N,OAAC,OAAI,UAAU,yBACb,UAAAzD,MAACC,GAAA,CACC,SAAUyS,EACV,OAAQC,EACR,QAAS,IAAMC,EAAe,EAAK,IAIrC5S,MAACmE,GAAA,CACC,YAAa,IAAMyO,EAAe,EAAI,EACtC,YAAAvO,CAAA,GAGFZ,OAAC,OAAI,UAAU,eAEb,UAAAzD,MAAC,OAAI,UAAU,cACb,SAAAA,MAACsH,KAAO,EACV,EAEAtH,MAAC,QAAK,UAAU,0BACd,SAAAA,MAACiT,WAAA,CAAS,SAAUjT,MAAC+P,GAAA,EAAW,EAC9B,SAAAtM,OAACyP,GAAA,CACC,UAAAlT,MAACmT,EAAA,CAAM,KAAK,IAAI,QAASN,IAAgB,QACxCM,EAAA,CAAM,KAAK,YAAY,QAASnT,MAACmS,KAAa,EAAI,QAClDgB,EAAA,CAAM,KAAK,aAAa,QAASnT,MAACyR,KAAc,EAAI,QACpD0B,EAAA,CAAM,KAAK,aAAa,QAASnT,MAACkS,KAAc,EAAI,QACpDiB,EAAA,CAAM,KAAK,WAAW,QAASnT,MAACoS,KAAY,EAAI,QAChDe,EAAA,CAAM,KAAK,aAAa,QAASnT,MAAC2Q,KAAc,EAAI,QACpDwC,EAAA,CAAM,KAAK,eAAe,QAASnT,MAACiR,KAAe,EAAI,QACvDkC,EAAA,CAAM,KAAK,YAAY,QAASJ,IAAmB,QACnDI,EAAA,CAAM,KAAK,iBAAiB,QAASL,IAAwB,QAC7DK,EAAA,CAAM,KAAK,YAAY,QAASnT,MAACqQ,KAAqB,EAAI,QAC1D8C,EAAA,CAAM,KAAK,SAAS,QAASnT,MAACsQ,KAAkB,EAAI,QACpD6C,EAAA,CAAM,KAAK,kBAAkB,QAASnT,MAACgR,KAA0B,EAAI,QACrEmC,EAAA,CAAM,KAAK,YAAY,QAASnT,MAACoR,KAAqB,EAAI,QAC1D+B,EAAA,CAAM,KAAK,kBAAkB,QAASnT,MAACqR,KAAkB,EAAI,QAC7D8B,EAAA,CAAM,KAAK,gBAAgB,QAASH,IAAsB,QAC1DG,EAAA,CAAM,KAAK,cAAc,QAASnT,MAACuR,KAAmB,EAAI,QAC1D4B,EAAA,CAAM,KAAK,QAAQ,QAASnT,MAAC0R,KAAS,EAAI,QAC1CyB,EAAA,CAAM,KAAK,WAAW,QAASnT,MAAC2R,KAAoB,EAAI,QACxDwB,EAAA,CAAM,KAAK,YAAY,QAASnT,MAAC4R,KAAqB,EAAI,QAC1DuB,EAAA,CAAM,KAAK,mBAAmB,QAASnT,MAAC6R,KAA2B,EAAI,QACvEsB,EAAA,CAAM,KAAK,cAAc,QAASnT,MAACmR,KAAkB,EAAI,QACzDgC,EAAA,CAAM,KAAK,WAAW,QAASnT,MAACgS,KAAY,EAAI,QAChDmB,EAAA,CAAM,KAAK,aAAa,QAASnT,MAACkR,KAAc,EAAI,QACpDiC,EAAA,CAAM,KAAK,QAAQ,QAASnT,MAACqS,KAAS,EAAI,QAC1Cc,EAAA,CAAM,KAAK,WAAW,QAASnT,MAACsS,KAAY,EAAI,QAChDa,EAAA,CAAM,KAAK,YAAY,QAASnT,MAACuS,KAAa,EAAI,QAClDY,EAAA,CAAM,KAAK,cAAc,QAASnT,MAACwS,KAAe,EAAI,GACzD,EACF,EACF,GACF,EAGAxS,MAAC6N,GAAA,CAAa,OAAA1D,EAAgB,UAAWW,CAAA,CAAc,QAGtDkD,GAAA,EAAmB,GACtB,CAEJ,CCnMA,MAAMoF,GAAgB,CACpB,CAAE,MAAO,QAAS,SAAU,SAAU,KAAM,QAAS,QAAS,gBAAiB,QAAS,gBAAiB,KAAMhQ,GAAQ,MAAO,cAC9H,CAAE,MAAO,WAAY,SAAU,SAAU,KAAM,WAAY,QAAS,WAAY,QAAS,WAAY,KAAMiQ,GAAW,MAAO,eAC7H,CAAE,MAAO,UAAW,SAAU,SAAU,KAAM,UAAW,QAAS,cAAe,QAAS,eAAgB,KAAMC,GAAS,MAAO,eAChI,CAAE,MAAO,kBAAmB,SAAU,SAAU,KAAM,kBAAmB,QAAS,eAAgB,QAAS,mBAAsB,KAAMC,GAAO,MAAO,iBACrJ,CAAE,MAAO,WAAY,SAAU,SAAU,KAAM,WAAY,QAAS,SAAU,QAAS,QAAS,KAAM5Q,EAAO,MAAO,gBACpH,CAAE,MAAO,WAAY,SAAU,SAAU,KAAM,WAAY,QAAS,cAAe,QAAS,UAAW,KAAMW,GAAQ,MAAO,gBAC5H,CAAE,MAAO,aAAc,SAAU,SAAU,KAAM,aAAc,QAAS,YAAa,QAAS,aAAc,KAAMD,GAAW,MAAO,iBACpI,CAAE,MAAO,WAAY,SAAU,SAAU,KAAM,WAAY,QAAS,WAAY,QAAS,YAAc,KAAMmQ,GAAa,MAAO,gBACjI,CAAE,MAAO,iBAAkB,SAAU,SAAU,KAAM,iBAAkB,QAAS,gBAAiB,QAAS,qBAAsB,KAAMtR,GAAQ,MAAO,eACrJ,CAAE,MAAO,aAAc,SAAU,SAAU,KAAM,aAAc,QAAS,gBAAiB,QAAS,kBAAmB,KAAMO,EAAW,MAAO,cAC/I,EAEO,SAASgR,IAAY,CAC1B,KAAM,CAAE,MAAA3tB,EAAO,UAAW4tB,EAAa,MAAOC,CAAA,EAAcxmB,EAAA,EACtD,CAAE,SAAAmP,EAAU,YAAAsX,EAAa,EAAArT,CAAA,EAAMnE,GAAA,EAE/B,CAACyX,EAAYC,CAAa,EAAInT,WAAS,EAAE,EACzC,CAAC5a,EAAUguB,CAAW,EAAIpT,WAAS,EAAE,EACrC,CAACqT,EAAcC,CAAe,EAAItT,WAAS,EAAK,EAChD,CAACxb,EAAO+uB,CAAQ,EAAIvT,WAAS,EAAE,EAC/B,CAACwT,EAAeC,CAAgB,EAAIzT,WAAS,EAAK,EAClD,CAAC0T,EAAgBC,CAAiB,EAAI3T,WAAS,EAAK,EACpD,CAAC4T,EAAgBC,CAAiB,EAAI7T,WAAS,EAAK,EACpD8T,EAAiB9M,SAAuB,IAAI,EAE5C+M,EAA+D,CACnE,CAAE,KAAM,KAAM,MAAO,KAAM,KAAM,QACjC,CAAE,KAAM,KAAM,MAAO,KAAM,KAAM,OAAO,EAIpCC,EAAoB,IAAM,CAC9B,GAAIF,EAAe,QAAS,CAC1B,KAAM,CAAE,UAAAG,EAAW,aAAAC,EAAc,aAAAC,CAAA,EAAiBL,EAAe,QAE7DG,EAAYE,GAAgBD,EAAe,IAC7CL,EAAkB,EAAI,CAE1B,CACF,EAGA1T,YAAU,IAAM,CACVuT,IACFG,EAAkB,EAAK,EAEvB,WAAW,IAAM,CACf,GAAIC,EAAe,QAAS,CAC1B,KAAM,CAAE,aAAAI,EAAc,aAAAC,CAAA,EAAiBL,EAAe,QAClDK,GAAgBD,GAClBL,EAAkB,EAAI,CAE1B,CACF,EAAG,GAAG,EAEV,EAAG,CAACH,CAAc,CAAC,EAEnB,MAAMU,EAAoB,IAAM,CAC9BX,EAAiB,EAAI,EACrBE,EAAkB,EAAK,CACzB,EAEMU,EAAe,MAAO7lB,GAAuB,CAIjD,GAHAA,EAAE,iBACF+kB,EAAS,EAAE,EAEP,CAACC,EAAe,CAClBD,EAAS5X,IAAa,KAAO,8CAAgD,+CAA+C,EAC5H,MACF,CAEA,GAAI,CACc,MAAMxW,EAAM+tB,EAAY9tB,CAAQ,GAE9CmuB,EAAS5X,IAAa,KAAO,4BAA8B,4BAA8B,CAG7F,MAAQ,CACN4X,EAAS5X,IAAa,KAAO,mBAAqB,kBAAkB,CACtE,CACF,EAEM2Y,EAAe9vB,GAASwuB,EAE9B,OACElQ,OAAC,OAAI,UAAU,6EAEb,UAAAzD,MAAC,OAAI,UAAU,8BACb,SAAAA,MAAC,OAAI,UAAU,gFACZ,SAAA0U,EAAU,IAAKrY,GACdoH,OAAC,UAEC,QAAS,IAAMmQ,EAAYvX,EAAK,IAAI,EACpC,UAAW,2GACTC,IAAaD,EAAK,KACd,8BACA,iCACN,GAEA,UAAA2D,MAAC,QAAM,WAAK,KAAK,EACjBA,MAAC,QAAM,SAAA3D,EAAK,MAAM,IATbA,EAAK,KAWb,EACH,EACF,EAGA2D,MAAC,OAAI,UAAU,4EAA4E,EAC3FA,MAAC,OAAI,UAAU,gFAAgF,EAC/FA,MAAC,OAAI,UAAU,6EAA6E,EAE5FyD,OAAC,OAAI,UAAU,sDAEb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAzD,MAAC,OAAI,UAAU,2BACb,eAACH,GAAA,CAAQ,KAAK,KAAK,EACrB,EACAG,MAAC,MAAG,UAAU,+CAA+C,kBAAM,QAClE,KAAE,UAAU,kDAAmD,SAAA1D,IAAa,KAAO,oBAAsB,oBAAoB,GAChI,EAGAmH,OAAC,QAAK,SAAUuR,EAAc,UAAU,yBACtC,UAAAvR,OAAC,OACC,UAAAzD,MAAC,SAAM,UAAU,yDAA0D,SAAAO,EAAE,YAAY,EAAE,EAC3FP,MAAC,SACC,KAAK,OACL,MAAO6T,EACP,SAAW1kB,GAAM2kB,EAAc3kB,EAAE,OAAO,KAAK,EAC7C,YAAamN,IAAa,KAAO,gBAAkB,iBACnD,UAAU,wBACV,SAAQ,IACV,EACF,SAEC,OACC,UAAA0D,MAAC,SAAM,UAAU,yDAA0D,SAAAO,EAAE,eAAe,EAAE,EAC9FkD,OAAC,OAAI,UAAU,WACb,UAAAzD,MAAC,SACC,KAAMgU,EAAe,OAAS,WAC9B,MAAOjuB,EACP,SAAWoJ,GAAM4kB,EAAY5kB,EAAE,OAAO,KAAK,EAC3C,YAAamN,IAAa,KAAO,iBAAmB,iBACpD,UAAU,8BACV,SAAQ,KAEV0D,MAAC,UACC,KAAK,SACL,QAAU7Q,GAAM,CACdA,EAAE,iBACFA,EAAE,kBACF8kB,EAAgB,CAACD,CAAY,CAC/B,EACA,UAAU,+HACV,aAAYA,EAAe,gBAAkB,kBAE5C,SAAAA,QAAgBkB,GAAA,CAAO,UAAU,UAAU,EAAKlV,MAACmV,GAAA,CAAI,UAAU,UAAU,GAC5E,EACF,GACF,EAECF,GACCxR,OAAC,OAAI,UAAU,8FACb,UAAAzD,MAAC8P,GAAA,CAAY,UAAU,wBAAwB,EAC9CmF,CAAA,EACH,EAIFxR,OAAC,OAAI,UAAU,yBACb,UAAAzD,MAAC,UACC,KAAK,SACL,QAAS,IAAM,CACRmU,EAGHC,EAAiB,EAAK,EAFtBE,EAAkB,EAAI,CAI1B,EACA,UAAW,8JACTH,EACI,kCACA,qDACN,GAEC,SAAAA,GAAiBnU,MAACoV,GAAA,CAAM,UAAU,sCAAsC,UAE1E,OAAI,UAAU,wBACZ,SAAA9Y,IAAa,KACZmH,OAAAC,WAAA,CAAE,mCACuB,IACvB1D,MAAC,UACC,KAAK,SACL,QAAS,IAAMsU,EAAkB,EAAI,EACrC,UAAU,iFACX,6BAED,EACF,EAEA7Q,OAAAC,WAAA,CAAE,gBACI,IACJ1D,MAAC,UACC,KAAK,SACL,QAAS,IAAMsU,EAAkB,EAAI,EACrC,UAAU,iFACX,4BAGA,IAAI,uBACP,EAEJ,GACF,EAEAtU,MAAC,UACC,KAAK,SACL,SAAU0T,GAAe,CAACS,EAC1B,UAAU,uFAET,WAAe7X,IAAa,KAAO,UAAY,YAAeiE,EAAE,YAAY,GAC/E,EACF,EAGAkD,OAAC,OAAI,UAAU,qCACb,UAAAzD,MAAC,KAAE,UAAU,yCACV,SAAA1D,IAAa,KAAO,+BAAiC,0BACxD,QACC,OAAI,UAAU,yBACZ,SAAA8W,GAAc,IAAK9pB,GAAY,CAC9B,MAAM+rB,EAAO/rB,EAAQ,KACrB,OACEma,OAAC,UAEC,KAAK,SACL,QAAS,IAAM,CACbqQ,EAAcxqB,EAAQ,KAAK,EAC3ByqB,EAAYzqB,EAAQ,QAAQ,EACvB6qB,GACHG,EAAkB,EAAI,CAE1B,EACA,UAAU,8IAEV,UAAAtU,MAAC,OAAI,UAAW,WAAW1W,EAAQ,KAAK,6DACtC,SAAA0W,MAACqV,EAAA,CAAK,UAAU,qBAAqB,EACvC,EACArV,MAAC,QAAK,UAAU,6CACb,aAAa,KAAO1W,EAAQ,QAAUA,EAAQ,QACjD,IAhBKA,EAAQ,MAmBnB,CAAC,EACH,GACF,GACF,EAGC+qB,SACE,OAAI,UAAU,0FACb,SAAA5Q,OAAC,OAAI,UAAU,kHAEb,UAAAA,OAAC,OAAI,UAAU,wEACb,UAAAA,OAAC,OAAI,UAAU,mCACb,UAAAzD,MAAC,OAAI,UAAU,kGACb,eAACoC,GAAA,CAAS,UAAU,wCAAwC,EAC9D,QACC,MAAG,UAAU,0DACX,SAAA9F,IAAa,KAAO,mBAAqB,iBAC5C,GACF,EACA0D,MAAC,UACC,QAAS,IAAMsU,EAAkB,EAAK,EACtC,UAAU,2FAEV,SAAAtU,MAAC4N,GAAA,CAAE,UAAU,wBAAwB,GACvC,EACF,EAGA5N,MAAC,OACC,IAAKyU,EACL,SAAUE,EACV,UAAU,0EAET,SAAArY,IAAa,KACZmH,OAAC,OAAI,UAAU,YACb,UAAAzD,MAAC,MAAG,UAAU,sBAAsB,4BAAgB,EACpDA,MAAC,KAAE,UAAU,cAAc,2DAA+C,EAE1EA,MAAC,MAAG,UAAU,qBAAqB,8BAAkB,EACrDA,MAAC,KAAE,sRAA0Q,EAC7QA,MAAC,KAAE,oIAAwH,EAC3HA,MAAC,KAAE,4HAAgH,EAEnHA,MAAC,MAAG,UAAU,qBAAqB,6BAAiB,EACpDA,MAAC,KAAE,mHAAuG,EAC1GyD,OAAC,MAAG,UAAU,2BACZ,UAAAzD,MAAC,MAAG,uEAA2D,EAC/DA,MAAC,MAAG,0DAA8C,EAClDA,MAAC,MAAG,qEAAyD,EAC7DA,MAAC,MAAG,+DAAmD,EACvDA,MAAC,MAAG,6CAAiC,EACrCA,MAAC,MAAG,gEAAoD,EACxDA,MAAC,MAAG,iDAAqC,GAC3C,EAEAA,MAAC,MAAG,UAAU,qBAAqB,yCAA6B,EAChEA,MAAC,KAAE,uCAA2B,EAC9ByD,OAAC,MAAG,UAAU,2BACZ,UAAAzD,MAAC,MAAG,kEAAsD,EAC1DA,MAAC,MAAG,qEAAyD,EAC7DA,MAAC,MAAG,uDAA2C,EAC/CA,MAAC,MAAG,6DAAiD,GACvD,EACAA,MAAC,KAAE,UAAU,OAAO,oCAAwB,EAC5CyD,OAAC,MAAG,UAAU,2BACZ,UAAAzD,MAAC,MAAG,2DAA+C,EACnDA,MAAC,MAAG,iEAAqD,EACzDA,MAAC,MAAG,uDAA2C,EAC/CA,MAAC,MAAG,gEAAoD,GAC1D,EAEAA,MAAC,MAAG,UAAU,qBAAqB,yCAA6B,EAChEA,MAAC,KAAE,iGAAqF,EACxFA,MAAC,KAAE,4FAAgF,EACnFA,MAAC,KAAE,uHAA2G,EAE9GA,MAAC,MAAG,UAAU,qBAAqB,qCAAyB,EAC5DA,MAAC,KAAE,6JAAiJ,EACpJA,MAAC,KAAE,wHAA4G,EAE/GA,MAAC,MAAG,UAAU,qBAAqB,kCAAsB,EACzDA,MAAC,KAAE,uHAA2G,EAC9GA,MAAC,KAAE,wIAA4H,EAE/HA,MAAC,MAAG,UAAU,qBAAqB,wCAA4B,EAC/DA,MAAC,KAAE,sDAA0C,EAC7CA,MAAC,KAAE,6HAAiH,EAEpHA,MAAC,MAAG,UAAU,qBAAqB,uCAA2B,EAC9DA,MAAC,KAAE,4IAAgI,EACnIA,MAAC,KAAE,uHAA2G,EAE9GA,MAAC,OAAI,UAAU,4DACb,eAAC,KAAE,UAAU,8BAA8B,wEAE3C,EACF,GACF,EAEAyD,OAAC,OAAI,UAAU,YACb,UAAAzD,MAAC,MAAG,UAAU,sBAAsB,0BAAc,EAClDA,MAAC,KAAE,UAAU,cAAc,2EAA+D,EAE1FA,MAAC,MAAG,UAAU,qBAAqB,8BAAkB,EACrDA,MAAC,KAAE,mUAAuT,EAC1TA,MAAC,KAAE,uIAA2H,EAC9HA,MAAC,KAAE,2IAA+H,EAElIA,MAAC,MAAG,UAAU,qBAAqB,8BAAkB,EACrDA,MAAC,KAAE,4HAAgH,EACnHyD,OAAC,MAAG,UAAU,2BACZ,UAAAzD,MAAC,MAAG,4DAAgD,EACpDA,MAAC,MAAG,6EAAiE,EACrEA,MAAC,MAAG,kEAAsD,EAC1DA,MAAC,MAAG,8EAAkE,EACtEA,MAAC,MAAG,uCAA2B,EAC/BA,MAAC,MAAG,wEAA4D,EAChEA,MAAC,MAAG,wDAA4C,GAClD,EAEAA,MAAC,MAAG,UAAU,qBAAqB,mDAAuC,EAC1EA,MAAC,KAAE,wCAA4B,EAC/ByD,OAAC,MAAG,UAAU,2BACZ,UAAAzD,MAAC,MAAG,kFAAsE,EAC1EA,MAAC,MAAG,0EAA8D,EAClEA,MAAC,MAAG,iEAAqD,EACzDA,MAAC,MAAG,qDAAyC,GAC/C,EACAA,MAAC,KAAE,UAAU,OAAO,4CAAgC,EACpDyD,OAAC,MAAG,UAAU,2BACZ,UAAAzD,MAAC,MAAG,mEAAuD,EAC3DA,MAAC,MAAG,+DAAmD,EACvDA,MAAC,MAAG,oEAAwD,EAC5DA,MAAC,MAAG,+DAAmD,GACzD,EAEAA,MAAC,MAAG,UAAU,qBAAqB,qCAAyB,EAC5DA,MAAC,KAAE,wGAA4F,EAC/FA,MAAC,KAAE,kGAAsF,EACzFA,MAAC,KAAE,qIAAyH,EAE5HA,MAAC,MAAG,UAAU,qBAAqB,wCAA4B,EAC/DA,MAAC,KAAE,iJAAqI,EACxIA,MAAC,KAAE,4FAAgF,EAEnFA,MAAC,MAAG,UAAU,qBAAqB,kCAAsB,EACzDA,MAAC,KAAE,+GAAmG,EACtGA,MAAC,KAAE,gJAAoI,EAEvIA,MAAC,MAAG,UAAU,qBAAqB,0CAA8B,EACjEA,MAAC,KAAE,oEAAwD,EAC3DA,MAAC,KAAE,8HAAkH,EAErHA,MAAC,MAAG,UAAU,qBAAqB,+BAAmB,EACtDA,MAAC,KAAE,uJAA2I,EAC9IA,MAAC,KAAE,4IAAgI,EAEnIA,MAAC,OAAI,UAAU,4DACb,eAAC,KAAE,UAAU,8BAA8B,gFAE3C,EACF,GACF,UAKH,OAAI,UAAU,kEACb,SAAAyD,OAAC,OAAI,UAAU,yFACb,UAAAzD,MAAC,KAAE,UAAW,+CAA+CuU,EAAiB,iBAAmB,eAAe,GAC7G,SAAAA,EACIjY,IAAa,KAAO,0BAA4B,4BAChDA,IAAa,KAAO,gCAAkC,kCAE7D,EACAmH,OAAC,OAAI,UAAU,sBACb,UAAAzD,MAAC,UACC,QAAS,IAAMsU,EAAkB,EAAK,EACtC,UAAU,gKAET,SAAAhY,IAAa,KAAO,UAAY,WAEnC0D,MAAC,UACC,QAAS+U,EACT,SAAU,CAACR,EACX,UAAW,0HACTA,EACI,uEACA,8CACN,GAEC,SAAAjY,IAAa,KAAO,UAAY,gBACnC,EACF,GACF,EACF,GACF,EACF,GAEJ,CAEJ,CCzcO,SAASgZ,IAAyB,CACvC,KAAM,CAACC,EAAMC,CAAO,EAAI7U,WAAS,EAAK,EAChC,CAAC8U,EAAWC,CAAY,EAAI/U,WAAS,EAAK,EAC1C,CAACgV,EAAeC,CAAgB,EAAIjV,WAAS,EAAK,EAClD,CAAE,KAAA/a,CAAA,EAASuH,EAAA,EAEjB2T,YAAU,IAAM,CAEd,GAAI,CAAChN,GAAkB,kCACrB,OAGF,MAAMf,EAAae,GAAkB,gBAC/B+hB,EAAe,yBAAyBjwB,GAAM,IAAM,MAAM,GAC1DkwB,EAAe,aAAa,QAAQD,CAAY,EAChDE,EAAoBD,EAAe,SAASA,CAAY,EAAI,EAC5DE,GAAsB,KAAK,MAAQD,IAAsB,IAAO,GAAK,GAAK,IAOhF,GAFmBhjB,IAAe,YAAc,CAAC+iB,GAAgBE,EAAqB,GAEtE,CAEd,MAAM5N,EAAQ,WAAW,IAAMoN,EAAQ,EAAI,EAAG,GAAI,EAClD,MAAO,IAAM,aAAapN,CAAK,CACjC,CACF,EAAG,CAACxiB,GAAM,EAAE,CAAC,EAEb,MAAMqwB,EAAc,SAAY,CAC9BL,EAAiB,EAAI,EACrB,GAAI,CAEF,MAAM3iB,EAAe,MAAMa,GAAkB,YAG7C,GAAI,kBAAmB,UACrB,GAAI,CAEF,MADuB,MAAM,UAAU,cAAc,OAChC,iBAAiB,2BAA4B,CAChE,KAAMb,EACF,oFACA,wEACJ,KAAM,eACN,MAAO,eACP,IAAK,uBACL,mBAAoB,GACrB,CACH,MAAkB,CAGhB,MAAMa,GAAkB,KAAK,CAC3B,MAAO,2BACP,KAAM,wEACN,mBAAoB,GACrB,CACH,MACUb,GAEM,MAAMa,GAAkB,qBAEtC,MAAMA,GAAkB,KAAK,CAC3B,MAAO,wBACP,KAAM,wEACN,mBAAoB,GACrB,CAGP,MAAgB,CAEhB,SACE8hB,EAAiB,EAAK,EACtBJ,EAAQ,EAAK,EACbE,EAAa,EAAI,CACnB,CACF,EAEMQ,EAAgB,IAAM,CAC1B,MAAML,EAAe,yBAAyBjwB,GAAM,IAAM,MAAM,GAChE,aAAa,QAAQiwB,EAAc,KAAK,MAAM,UAAU,EACxDL,EAAQ,EAAK,EACbE,EAAa,EAAI,CACnB,EAEA,MAAI,CAACH,GAAQE,EACJ,KAIPzV,MAAC,OAAI,UAAU,oHACb,SAAAA,MAAC,OAAI,UAAU,2DACb,SAAAyD,OAAC,OAAI,UAAU,yBACb,UAAAzD,MAAC,OAAI,UAAU,sFACb,eAACgG,GAAA,CAAK,UAAU,0BAA0B,EAC5C,EACAvC,OAAC,OAAI,UAAU,iBACb,UAAAzD,MAAC,MAAG,UAAU,8BAA8B,iCAAqB,EACjEA,MAAC,KAAE,UAAU,6BAA6B,0GAE1C,EACAyD,OAAC,OAAI,UAAU,kBACb,UAAAzD,MAAC,UACC,QAASiW,EACT,SAAUN,EACV,UAAU,sJAET,WACClS,OAAAC,WAAA,CACE,UAAA1D,MAACgQ,GAAA,CAAQ,UAAU,uBAAuB,EAAE,gBAE9C,EAEA,cAGJhQ,MAAC,UACC,QAASkW,EACT,UAAU,qGACX,kBAED,EACF,GACF,EACAlW,MAAC,UACC,QAASkW,EACT,UAAU,wCAEV,SAAAlW,MAAC4N,GAAA,CAAE,UAAU,UAAU,GACzB,EACF,EACF,EACF,CAEJ,CC9GO,MAAMuI,WAAsBC,WAAwB,CACzD,YAAYC,EAAc,CACxB,MAAMA,CAAK,EA6FbvjB,GAAA,mBAAc,IAAM,CAClB,KAAK,SAAS,CACZ,SAAU,GACV,MAAO,KACP,UAAW,KACZ,CACH,GAEAA,GAAA,oBAAe,IAAM,CACnB,OAAO,SAAS,QAClB,GAEAA,GAAA,oBAAe,IAAM,CACnB,OAAO,SAAS,KAAO,GACzB,GA1GE,KAAK,MAAQ,CACX,SAAU,GACV,MAAO,KACP,UAAW,KACX,WAAY,EAEhB,CAEA,OAAO,yBAAyB3N,EAA8B,CAC5D,MAAO,CACL,SAAU,GACV,MAAAA,CAAA,CAEJ,CAEA,kBAAkBA,EAAcmxB,EAAsB,CAEpD,KAAK,SAASzL,IAAS,CACrB,UAAAyL,EACA,WAAYzL,EAAK,WAAa,GAC9B,EASF,KAAK,SAAS1lB,EAAOmxB,CAAS,EAG9B,KAAK,MAAM,UAAUnxB,EAAOmxB,CAAS,EAInC,KAAK,iBAAiBnxB,EAAOmxB,CAAS,CAE1C,CAEA,SAASnxB,EAAcmxB,EAAsB,CAE3C,GAAI,CACF,MAAMC,EAAW,CACf,UAAW,IAAI,OAAO,cACtB,QAASpxB,EAAM,QACf,MAAOA,EAAM,MACb,eAAgBmxB,EAAU,eAC1B,UAAW,UAAU,UACrB,IAAK,OAAO,SAAS,MAGjBxgB,EAAO,KAAK,MAAM,aAAa,QAAQ,YAAY,GAAK,IAAI,EAClEA,EAAK,KAAKygB,CAAQ,EAGdzgB,EAAK,OAAS,IAChBA,EAAK,QAGP,aAAa,QAAQ,aAAc,KAAK,UAAUA,CAAI,CAAC,CACzD,MAAc,CAEd,CACF,CAEA,MAAM,iBAAiB3Q,EAAcmxB,EAAsB,CACzD,GAAI,CAEF,MAAM,MAAM,uCAAwC,CAClD,OAAQ,OACR,QAAS,CACP,eAAgB,oBAElB,KAAM,KAAK,UAAU,CACnB,MAAO,CACL,QAASnxB,EAAM,QACf,MAAOA,EAAM,MACb,KAAMA,EAAM,MAEd,eAAgBmxB,EAAU,eAC1B,UAAW,IAAI,OAAO,cACtB,UAAW,UAAU,UACrB,IAAK,OAAO,SAAS,KACrB,OAAQ,aAAa,QAAQ,SAAS,EACvC,EACF,CACH,MAAc,CAEd,CACF,CAkBA,QAAS,CACP,OAAI,KAAK,MAAM,SAET,KAAK,MAAM,SACN,KAAK,MAAM,eAKjB,OAAI,UAAU,gEACb,SAAAtW,MAAC,OAAI,UAAU,mBACb,SAAAyD,OAAC,OAAI,UAAU,oCAEb,UAAAzD,MAAC,OAAI,UAAU,wCACb,SAAAA,MAAC,OAAI,UAAU,8BACb,SAAAA,MAACyN,GAAA,CAAc,UAAU,yBAAyB,EACpD,EACF,QAGC,MAAG,UAAU,oDAAoD,oCAElE,QAGC,KAAE,UAAU,iCAAiC,iFAE9C,EAGC,GA6BDhK,OAAC,OAAI,UAAU,kCACb,UAAAA,OAAC,UACC,QAAS,KAAK,YACd,UAAU,sIAEV,UAAAzD,MAACwW,GAAA,CAAU,UAAU,UAAU,EAAE,uBAInC/S,OAAC,UACC,QAAS,KAAK,aACd,UAAU,mIAEV,UAAAzD,MAAC6C,GAAA,CAAK,UAAU,UAAU,EAAE,gBAI9BY,OAAC,UACC,QAAS,KAAK,aACd,UAAU,mIAEV,UAAAzD,MAACwW,GAAA,CAAU,UAAU,UAAU,EAAE,kBAEnC,EACF,EAGC,KAAK,MAAM,WAAa,SACtB,OAAI,UAAU,4DACb,SAAA/S,OAAC,KAAE,UAAU,sCAAsC,oCACzB,KAAK,MAAM,WAAW,6CAEhD,EACF,QAID,KAAE,UAAU,yCAAyC,0FAEtD,GACF,EACF,EACF,EAIG,KAAK,MAAM,QACpB,CACF,CC7OA,SAASgT,IAAM,CACb,KAAM,CAAE,KAAA7wB,CAAA,EAASuH,EAAA,EACX,CAAE,eAAAupB,CAAA,EAAmB7nB,GAAA,EACrB,CAAE,eAAA4c,EAAgB,cAAAD,EAAe,cAAAmL,CAAA,EAAkBviB,EAAA,EAGzD0M,mBAAU,IAAM,CACVlb,IAEF8wB,EAAA,EAGI,CAAC,QAAS,UAAW,kBAAmB,YAAY,EAAE,SAAS9wB,EAAK,IAAI,GAC1E6lB,EAAA,EAIFD,EAAA,EAGI5lB,EAAK,OAAS,YAChB+wB,EAAA,EAGN,EAAG,CAAC/wB,EAAM8wB,EAAgBjL,EAAgBD,EAAemL,CAAa,CAAC,EAGrE3W,MAACmW,GAAA,CACC,SAAAnW,MAAC4W,GAAA,CACE,WACCnT,OAAAC,WAAA,CACE,UAAA1D,MAACyS,GAAA,EAAO,QACP6C,GAAA,EAAuB,GAC1B,EAEAtV,MAACyT,GAAA,EAAU,EAEf,EACF,CAEJ,CC7CAoD,cAAW,SAAS,eAAe,MAAM,CAAE,EAAE,OAC3C7W,MAAC8W,aAAA,CACC,SAAA9W,MAACyW,GAAA,EAAI,EACP,CACF","names":["API_URL","getToken","requestCache","pendingRequests","CACHE_TTL","getCached","key","entry","setCache","data","ttl","invalidateCache","pattern","API_TIMEOUT","apiRequest","endpoint","options","timeout","token","headers","controller","timeoutId","response","error","cachedGet","cacheKey","cached","pending","request","err","apiRequestWrapped","transformUser","user","authApi","login","password","userData","users","usersApi","updates","currentPassword","newPassword","userId","filters","params","query","vehiclesApi","residentId","vehicle","vehicleId","plateNumber","rentalsApi","id","apartmentId","url","guestCodesApi","codeId","code","reason","qrToken","chatApi","channel","channelId","limit","before","content","messageId","announcementsApi","announcement","result","announcementId","uploadApi","file","formData","errorData","files","branchesApi","buildingsApi","building","entrancesApi","buildingId","entrance","buildingDocumentsApi","document","apartmentsApi","apartment","ownersApi","owner","ownerId","personalAccountsApi","account","crmResidentsApi","resident","metersApi","meter","meterReadingsApi","meterId","reading","readingId","teamApi","executorsApi","showAll","executorId","status","requestsApi","category","queryString","requestId","rating","feedback","rescheduleApi","rescheduleId","accepted","responseNote","trainingPartnersApi","activeOnly","partner","trainingProposalsApi","proposal","trainingVotesApi","proposalId","trainingRegistrationsApi","trainingFeedbackApi","trainingNotificationsApi","unreadOnly","trainingSettingsApi","settings","meetingsFullApi","r","meeting","optionId","signerData","meetingId","html","iframe","doc","meetingScheduleVotesApi","meetingAgendaVotesApi","agendaItemId","voterId","meetingOtpApi","otpId","meetingBuildingSettingsApi","meetingVotingUnitsApi","unit","verifiedBy","meetingEligibleVotersApi","voterIds","totalCount","settingsApi","value","useAuthStore","create","persist","set","get","loginStr","normalizedLogin","normalizedPassword","apiError","message","currentUser","state","newUsers","correctToken","mapBuildingFromApi","b","mapEntranceFromApi","mapApartmentFromApi","a","mapOwnerFromApi","o","mapAccountFromApi","mapMeterFromApi","m","mapMeterReadingFromApi","mapResidentFromApi","useCRMStore","buildings","entrances","documents","updatedBuildings","updatedEntrances","e","buildingData","newBuilding","p","apartments","accounts","residents","aId","sum","docData","newDoc","docId","d","entranceData","newEntrance","owners","apartmentData","newApartment","entranceId","meters","readings","updatedMeters","otherReadings","meterData","newMeter","readingData","newReading","approved","rejectionReason","ownerData","newOwner","lowerQuery","residentData","newResident","accountData","newAccount","minDebt","personalAccounts","totalDebt","totalCollectionRates","persistedState","_version","extractBuildingFromAddress","address","uzMatch","ruMatch","seenIds","index","updatedBuilding","extractedNumber","VAPID_PUBLIC_KEY","urlBase64ToUint8Array","base64String","padding","base64","rawData","outputArray","i","PushNotificationService","__publicField","permission","existingSub","subscription","subscriptionData","notification","event","requestNumber","executorName","title","date","time","buildingAddress","hoursLeft","priority","icon","pushNotifications","generateId","createDemoGuestAccessCode","now","validUntil","defaultSettings","useDataStore","mappedRequests","apiReq","mappedExecutors","forStaff","mappedVehicles","v","mappedCodes","c","newCode","revokedBy","revokedByName","revokedByRole","fullCode","newUses","newStatus","base64Data","decoded","bytes","utf8Decoded","tokenData","usedCodes","localCode","logData","newLog","accessCodeId","logs","l","todayStart","codes","activeCodes","usedToday","createdToday","byVisitorType","recentScans","vehicleData","tempId","optimisticVehicle","realVehicle","veh","originalVehicle","deletedVehicle","normalized","announcementData","__vitePreload","api","target","apiData","newAnnouncement","readAnnouncementsKey","readAnnouncements","userLogin","floor","branch","authorId","announcements","viewedByUser","viewedBy","attachments","typeForUI","apartmentsRes","recordsRes","recordData","executorData","newExecutor","requests","executorRequests","completed","weekAgo","monthAgo","thisWeek","thisMonth","ratings","avgRating","times","avgTime","requestData","tempNumber","optimisticRequest","realRequest","executor","isSelfAssign","executorPhone","originalRequest","originalExecutor","totalPausedTime","workDuration","wasRejected","notifyMessage","newRating","newRejectionCount","cancelledBy","cancellerName","canResidentCancel","canManagerCancel","previousExecutorId","activeCount","cancellerLabels","newNotification","n","log","executors","today","completedRequests","completedToday","completedWeek","totalTime","count","avgCompletionTime","days","chartData","dayStart","dayEnd","created","createdAt","approvedAt","apiSettings","newSettings","mappedReschedules","requestsApi2","newReschedule","reschedule","oneDayAgo","currentState","persisted","demoCode","parsed","translations","useLanguageStore","lang","language","mapMeetingFromApi","parseJson","defaultValue","mapAgendaItem","item","mapScheduleOption","opt","mapVoteRecordFromApi","mapProtocolFromApi","mapOTPRecordFromApi","mapVotingUnitFromApi","mapBuildingSettingsFromApi","defaultBuildingSettings","useMeetingStore","meetings","newMeetings","newUnits","u","organizerId","selectedOptionId","protocol","voterName","choice","verificationData","comment","apiMethod","voteRecord","votes","existingIds","newVotes","phone","purpose","apiPurpose","otpRecord","votesFor","votesAgainst","votesAbstain","totalVotes","percentFor","thresholdPercent","thresholdMet","isApproved","participated","total","percent","quorumPercent","quorumReached","existing","s","updatedSettings","votingUnit","records","uniqueVoters","otpVerified","AppLogo","size","sizeClasses","jsx","Sidebar","onLogout","isOpen","onClose","location","useLocation","t","getAnnouncementsForEmployees","chatUnreadCount","setChatUnreadCount","useState","fetchChatUnreadCount","useCallback","useEffect","interval","meetingStatus","useMemo","weekFromNow","relevantMeetings","meetingDate","hasActiveVoting","hasConfirmedMeeting","badges","currentExecutor","mySpecialization","availableRequestsCount","assignedRequestsCount","unreadAnnouncementsCount","activeRequestsCount","upcomingMeetingsCount","newRequestsCount","navItems","LayoutDashboard","Ticket","baseItems","FileText","CalendarDays","Car","QrCode","BarChart3","Megaphone","GraduationCap","Users","StickyNote","Home","MessageCircle","Vote","Phone","Star","ScrollText","Key","Shield","Building2","Wrench","Settings","handleNavClick","jsxs","Fragment","CloseIcon","badgeCount","isMeetingsTab","badgeColor","shouldAnimate","Link","User","LogOut","MobileHeader","onMenuClick","unreadCount","navigate","useNavigate","showNotifications","setShowNotifications","notifications","markNotificationAsRead","markAllNotificationsAsRead","getAnnouncementsForResidents","vehicles","isResident","userAnnouncements","upcomingMeetings","nowDate","pendingTasks","pendingTasksCount","totalMenuBadge","userNotifications","formatTime","dateStr","diffMs","diffMins","diffHours","getNotificationIcon","type","totalNotificationsBadge","Menu","Bell","createPortal","CheckCircle","task","CHAT_CHANNEL_LABELS","SERVICE_CATEGORIES","SPECIALIZATION_LABELS","STATUS_LABELS","PRIORITY_LABELS","AGENDA_ITEM_TYPES","DECISION_THRESHOLD_LABELS","MEETING_STATUS_LABELS","BUILDING_TYPE_LABELS","VEHICLE_TYPE_LABELS","VEHICLE_OWNER_TYPE_LABELS","VISITOR_TYPE_LABELS","ACCESS_TYPE_LABELS","GUEST_ACCESS_STATUS_LABELS","RESCHEDULE_REASON_LABELS","RESCHEDULE_STATUS_LABELS","ONBOARDING_TASKS","Lock","Header","getUnreadCount","currentTime","setCurrentTime","sentRemindersRef","useRef","searchQuery","setSearchQuery","showSearchResults","setShowSearchResults","isRentalUser","pendingOnboardingTasks","unreadMeetingsCount","handleTaskClick","timer","checkUpcomingRequests","currentRequests","currentExecutors","notify","tenMinutesLater","fiveMinutesLater","startTime","hours","minutes","scheduledDateTime","reminderKey","reminder5Key","minutesUntil","reminderTimer","totalBadgeCount","formatCurrentTime","formatCurrentDate","getRoleLabel","diffDays","searchResults","handleClockClick","Search","Clock","ChevronRight","getShownIds","stored","saveShownId","shown","usePopupNotifications","markAnnouncementAsViewed","popups","setPopups","processedRef","relevantAnnouncements","shownIds","newPopups","isUrgent","notViewed","notShown","isMeeting","prev","dismissPopup","addPopup","popup","chatListeners","subscribeToChatMessages","listener","emitChatMessage","rescheduleListeners","emitRescheduleUpdate","useWebSocketSync","fetchRequests","fetchExecutors","fetchAnnouncements","fetchPendingReschedules","fetchMeetings","wsRef","reconnectTimeoutRef","reconnectAttempts","heartbeatIntervalRef","lastSyncRef","MAX_RECONNECT_ATTEMPTS","SYNC_DEBOUNCE","HEARTBEAT_INTERVAL","syncData","promises","syncMeetings","startHeartbeat","stopHeartbeat","connect","wsUrl","ws","activeMeeting","delay","handleVisibilityChange","PopupNotification","onAction","actionLabel","autoClose","isClosing","setIsClosing","handleClose","handleAction","getIcon","AlertTriangle","getBgColor","getActionBtnColor","X","PopupManager","onDismiss","currentPopup","PerformanceMonitor","memo","enabled","position","stats","setStats","isExpanded","setIsExpanded","frameCount","lastTime","animationFrameId","measureFPS","fps","memoryInterval","mem","usedMB","renderInterval","renderMetrics","avgRenderTime","originalFetch","apiLatencies","args","duration","avgLatency","positionClasses","getStatusColor","metric","threshold","Zap","TrendingUp","AlertCircle","PageLoader","Loader2","ManagerDashboard","lazy","DepartmentHeadDashboard","ExecutorDashboard","ExecutorSchedulePage","ExecutorStatsPage","ExecutorAnnouncementsPage","ResidentDashboard","AdminDashboard","DirectorDashboard","BuildingsPage","AnnouncementsPage","MeetingsPage","ResidentAnnouncementsPage","ResidentMeetingsPage","ResidentRateEmployeesPage","WorkOrdersPage","TrainingsPage","ColleaguesSection","ResidentVehiclesPage","VehicleSearchPage","ResidentGuestAccessPage","GuardQRScannerPage","ManagerGuestAccessPage","ResidentsPage","ChatPage","ResidentProfilePage","ResidentContractPage","ResidentUsefulContactsPage","AdvertiserDashboard","CouponCheckerDashboard","NotepadPage","TenantDashboard","ExecutorsPage","RequestsPage","RentalsPage","TeamPage","ReportsPage","SettingsPage","MonitoringPage","Layout","logout","sidebarOpen","setSidebarOpen","getDashboard","getAnnouncementsPage","getMeetingsPage","getGuestAccessPage","Suspense","Routes","Route","DEMO_ACCOUNTS","Briefcase","UserCog","Crown","ShieldCheck","LoginPage","authLoading","authError","setLanguage","loginValue","setLoginValue","setPassword","showPassword","setShowPassword","setError","agreedToTerms","setAgreedToTerms","showOfferModal","setShowOfferModal","canAcceptOffer","setCanAcceptOffer","offerScrollRef","languages","handleOfferScroll","scrollTop","scrollHeight","clientHeight","handleAcceptOffer","handleSubmit","displayError","EyeOff","Eye","Check","Icon","PushNotificationPrompt","show","setShow","dismissed","setDismissed","isSubscribing","setIsSubscribing","dismissedKey","wasDismissed","lastDismissedTime","daysSinceDismissed","handleAllow","handleDismiss","ErrorBoundary","Component","props","errorInfo","errorLog","RefreshCw","App","fetchBuildings","fetchVehicles","BrowserRouter","createRoot","StrictMode"],"ignoreList":[],"sources":["../../src/services/api.ts","../../src/stores/authStore.ts","../../src/stores/crmStore.ts","../../src/services/pushNotifications.ts","../../src/stores/dataStore.ts","../../src/stores/languageStore.ts","../../src/stores/meetingStore.ts","../../src/components/common/AppLogo.tsx","../../src/components/layout/Sidebar.tsx","../../src/components/layout/MobileHeader.tsx","../../src/types/index.ts","../../src/components/layout/Header.tsx","../../src/hooks/usePopupNotifications.ts","../../src/hooks/useWebSocketSync.ts","../../src/components/PopupNotification.tsx","../../src/components/PerformanceMonitor.tsx","../../src/components/layout/Layout.tsx","../../src/pages/LoginPage.tsx","../../src/components/PushNotificationPrompt.tsx","../../src/components/ErrorBoundary.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["// API Client for UK CRM\n\nconst API_URL = '';\n\n// Get auth token from localStorage\nconst getToken = () => localStorage.getItem('auth_token');\n\n// Response wrapper type for consistent API handling\ninterface ApiResponse<T> {\n  success: boolean;\n  data?: T;\n  error?: string;\n}\n\n// === REQUEST CACHE & DEDUPLICATION ===\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n  ttl: number;\n}\n\nconst requestCache = new Map<string, CacheEntry<unknown>>();\nconst pendingRequests = new Map<string, Promise<unknown>>();\n\n// Cache TTL values (ms)\nconst CACHE_TTL = {\n  SHORT: 10 * 1000,     // 10 sec - for frequently changing data (requests list)\n  MEDIUM: 60 * 1000,    // 1 min - for moderately changing data (executors)\n  LONG: 2 * 60 * 1000,  // 2 min - for buildings (reduced from 5 min for better sync)\n} as const;\n\n// Get cached data if valid\nfunction getCached<T>(key: string): T | null {\n  const entry = requestCache.get(key) as CacheEntry<T> | undefined;\n  if (!entry) return null;\n\n  const isExpired = Date.now() - entry.timestamp > entry.ttl;\n  if (isExpired) {\n    requestCache.delete(key);\n    return null;\n  }\n  return entry.data;\n}\n\n// Set cache with TTL\nfunction setCache<T>(key: string, data: T, ttl: number): void {\n  requestCache.set(key, { data, timestamp: Date.now(), ttl });\n}\n\n// Clear specific cache entries\nexport function invalidateCache(pattern?: string): void {\n  if (!pattern) {\n    requestCache.clear();\n    return;\n  }\n  for (const key of requestCache.keys()) {\n    if (key.includes(pattern)) {\n      requestCache.delete(key);\n    }\n  }\n}\n\n// Default timeout for API requests (30 seconds)\nconst API_TIMEOUT = 30000;\n\n// Helper for API requests - returns raw data for backward compatibility\nexport async function apiRequest<T>(\n  endpoint: string,\n  options: RequestInit = {},\n  timeout: number = API_TIMEOUT\n): Promise<T> {\n  const token = getToken();\n\n  const headers: HeadersInit = {\n    'Content-Type': 'application/json',\n    ...(token ? { 'Authorization': `Bearer ${token}` } : {}),\n    ...options.headers,\n  };\n\n  // Create abort controller for timeout\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n  try {\n    const response = await fetch(`${API_URL}${endpoint}`, {\n      ...options,\n      headers,\n      signal: controller.signal,\n    });\n\n    const data = await response.json();\n\n    if (!response.ok) {\n      throw new Error(data.error || 'API Error');\n    }\n\n    return data;\n  } catch (error) {\n    if (error instanceof Error && error.name === 'AbortError') {\n      throw new Error('   .  .');\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\n// Cached GET request with deduplication\nasync function cachedGet<T>(\n  endpoint: string,\n  ttl: number = CACHE_TTL.SHORT\n): Promise<T> {\n  const cacheKey = endpoint;\n\n  // Return cached data if available\n  const cached = getCached<T>(cacheKey);\n  if (cached) return cached;\n\n  // Deduplicate: if same request is in flight, wait for it\n  const pending = pendingRequests.get(cacheKey);\n  if (pending) return pending as Promise<T>;\n\n  // Make the request\n  const request = apiRequest<T>(endpoint).then(data => {\n    setCache(cacheKey, data, ttl);\n    pendingRequests.delete(cacheKey);\n    return data;\n  }).catch(err => {\n    pendingRequests.delete(cacheKey);\n    throw err;\n  });\n\n  pendingRequests.set(cacheKey, request);\n  return request;\n}\n\n// Helper for API requests - returns wrapped response { success, data, error }\nasync function apiRequestWrapped<T>(\n  endpoint: string,\n  options: RequestInit = {}\n): Promise<ApiResponse<T>> {\n  try {\n    const data = await apiRequest<T>(endpoint, options);\n    return { success: true, data };\n  } catch (error: any) {\n    return { success: false, error: error.message || 'API Error' };\n  }\n}\n\n// Transform user object from snake_case (API) to camelCase (frontend)\nfunction transformUser(user: any): any {\n  if (!user) return user;\n  return {\n    ...user,\n    // Map snake_case to camelCase for onboarding fields\n    passwordChangedAt: user.password_changed_at || user.passwordChangedAt,\n    contractSignedAt: user.contract_signed_at || user.contractSignedAt,\n    buildingId: user.building_id || user.buildingId,\n    totalArea: user.total_area || user.totalArea,\n    signatureKey: user.signature_key || user.signatureKey,\n    // Keep original fields too for backward compatibility\n  };\n}\n\n// Auth API\nexport const authApi = {\n  login: async (login: string, password: string) => {\n    const data = await apiRequest<{ user: any; token: string }>('/api/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({ login, password }),\n    });\n    localStorage.setItem('auth_token', data.token);\n    // Transform user fields from snake_case to camelCase\n    return { ...data, user: transformUser(data.user) };\n  },\n\n  logout: () => {\n    localStorage.removeItem('auth_token');\n  },\n\n  register: async (userData: {\n    login: string;\n    password: string;\n    name: string;\n    role: string;\n    phone?: string;\n    address?: string;\n    apartment?: string;\n    specialization?: string;\n    building_id?: string;\n    entrance?: string;\n    floor?: string;\n    branch?: string;\n    building?: string;\n  }) => {\n    return apiRequest<{ user: any }>('/api/auth/register', {\n      method: 'POST',\n      body: JSON.stringify(userData),\n    });\n  },\n\n  registerBulk: async (users: Array<{\n    login: string;\n    password: string;\n    name: string;\n    role: string;\n    phone?: string;\n    address?: string;\n    apartment?: string;\n    building_id?: string;\n    entrance?: string;\n    floor?: string;\n  }>) => {\n    return apiRequest<{ created: any[]; updated: any[] }>('/api/auth/register-bulk', {\n      method: 'POST',\n      body: JSON.stringify({ users }),\n    });\n  },\n};\n\n// Users API\nexport const usersApi = {\n  getMe: async () => {\n    const data = await apiRequest<{ user: any }>('/api/users/me');\n    return { user: transformUser(data.user) };\n  },\n\n  updateMe: async (updates: { phone?: string; name?: string; language?: string }) => {\n    const data = await apiRequest<{ user: any }>('/api/users/me', {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n    return { user: transformUser(data.user) };\n  },\n\n  changePassword: async (currentPassword: string, newPassword: string) => {\n    return apiRequest<{ success: boolean; password_changed_at?: string }>('/api/users/me/password', {\n      method: 'POST',\n      body: JSON.stringify({ current_password: currentPassword, new_password: newPassword }),\n    });\n  },\n\n  markContractSigned: async () => {\n    return apiRequest<{ success: boolean; contract_signed_at?: string }>('/api/users/me/contract-signed', {\n      method: 'POST',\n    });\n  },\n\n  adminChangePassword: async (userId: string, newPassword: string) => {\n    return apiRequest<{ success: boolean }>(`/api/users/${userId}/password`, {\n      method: 'POST',\n      body: JSON.stringify({ new_password: newPassword }),\n    });\n  },\n\n  getAll: async (filters?: { role?: string; building_id?: string; limit?: number }) => {\n    const params = new URLSearchParams();\n    if (filters?.role) params.append('role', filters.role);\n    if (filters?.building_id) params.append('building_id', filters.building_id);\n    if (filters?.limit) params.append('limit', filters.limit.toString());\n    const query = params.toString();\n    return apiRequest<{ users: any[]; pagination?: any }>(`/api/users${query ? '?' + query : ''}`);\n  },\n\n  delete: async (userId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/users/${userId}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Vehicles API\nexport const vehiclesApi = {\n  // Get current user's vehicles only\n  getMyVehicles: async () => {\n    return cachedGet<{ vehicles: any[] }>('/api/vehicles', CACHE_TTL.MEDIUM);\n  },\n\n  // Get ALL vehicles with pagination (for staff: admin, manager, executor, department_head)\n  //   5000+ \n  getAll: async (options?: { page?: number; limit?: number; search?: string }) => {\n    const params = new URLSearchParams();\n    if (options?.page) params.append('page', String(options.page));\n    if (options?.limit) params.append('limit', String(options.limit));\n    if (options?.search) params.append('search', options.search);\n    const query = params.toString();\n    return apiRequest<{ vehicles: any[]; pagination?: { page: number; limit: number; total: number; totalPages: number } }>(\n      `/api/vehicles/all${query ? '?' + query : ''}`\n    );\n  },\n\n  getForResident: async (residentId: string) => {\n    return cachedGet<{ vehicles: any[] }>(`/api/vehicles?resident_id=${residentId}`, CACHE_TTL.MEDIUM);\n  },\n\n  create: async (vehicle: {\n    plate_number: string;\n    brand?: string;\n    model?: string;\n    color?: string;\n    year?: number;\n    vehicle_type?: string;\n    owner_type?: string;\n    company_name?: string;\n    parking_spot?: string;\n    notes?: string;\n    is_primary?: boolean;\n  }) => {\n    return apiRequest<{ vehicle: any }>('/api/vehicles', {\n      method: 'POST',\n      body: JSON.stringify(vehicle),\n    });\n  },\n\n  update: async (vehicleId: string, updates: {\n    plate_number?: string;\n    brand?: string;\n    model?: string;\n    color?: string;\n    year?: number;\n    vehicle_type?: string;\n    owner_type?: string;\n    company_name?: string;\n    parking_spot?: string;\n    notes?: string;\n    is_primary?: boolean;\n  }) => {\n    return apiRequest<{ vehicle: any }>(`/api/vehicles/${vehicleId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (vehicleId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/vehicles/${vehicleId}`, {\n      method: 'DELETE',\n    });\n  },\n\n  search: async (plateNumber: string) => {\n    return apiRequest<{ vehicles: any[] }>(`/api/vehicles/search?plate=${encodeURIComponent(plateNumber)}`);\n  },\n};\n\n// Rentals API\nexport const rentalsApi = {\n  // Apartments\n  getApartments: async () => {\n    return apiRequest<{ apartments: any[] }>('/api/rentals/apartments');\n  },\n\n  // Get my apartments (for tenants/commercial_owners)\n  getMyApartments: async () => {\n    return apiRequest<{ apartments: any[]; records: any[] }>('/api/rentals/my-apartments');\n  },\n\n  createApartment: async (data: {\n    name: string;\n    address: string;\n    apartment?: string;\n    ownerName?: string;\n    ownerPhone?: string;\n    ownerLogin: string;\n    ownerPassword: string;\n    ownerType?: 'tenant' | 'commercial_owner';\n  }) => {\n    return apiRequest<{ apartment: any }>('/api/rentals/apartments', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n\n  updateApartment: async (id: string, data: { name?: string; address?: string; apartment?: string; isActive?: boolean }) => {\n    return apiRequest<{ success: boolean }>(`/api/rentals/apartments/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(data),\n    });\n  },\n\n  deleteApartment: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/rentals/apartments/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  // Records\n  getRecords: async (apartmentId?: string) => {\n    const url = apartmentId ? `/api/rentals/records?apartmentId=${apartmentId}` : '/api/rentals/records';\n    return apiRequest<{ records: any[] }>(url);\n  },\n\n  createRecord: async (data: {\n    apartmentId: string;\n    guestNames: string;\n    passportInfo?: string;\n    checkInDate: string;\n    checkOutDate: string;\n    amount?: number;\n    currency?: string;\n    notes?: string;\n  }) => {\n    return apiRequest<{ record: any }>('/api/rentals/records', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n\n  updateRecord: async (id: string, data: {\n    guestNames?: string;\n    passportInfo?: string;\n    checkInDate?: string;\n    checkOutDate?: string;\n    amount?: number;\n    currency?: string;\n    notes?: string;\n  }) => {\n    return apiRequest<{ success: boolean }>(`/api/rentals/records/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(data),\n    });\n  },\n\n  deleteRecord: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/rentals/records/${id}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Guest Codes API\nexport const guestCodesApi = {\n  getAll: async () => {\n    return cachedGet<{ codes: any[] }>('/api/guest-codes', CACHE_TTL.SHORT);\n  },\n\n  getById: async (codeId: string) => {\n    return cachedGet<{ code: any }>(`/api/guest-codes/${codeId}`, CACHE_TTL.SHORT);\n  },\n\n  create: async (code: {\n    visitor_type: string;\n    visitor_name?: string;\n    visitor_phone?: string;\n    visitor_vehicle_plate?: string;\n    access_type: string;\n    valid_from?: string;\n    valid_until?: string;\n    resident_name?: string;\n    resident_phone?: string;\n    resident_apartment?: string;\n    resident_address?: string;\n    notes?: string;\n  }) => {\n    return apiRequest<{ code: any }>('/api/guest-codes', {\n      method: 'POST',\n      body: JSON.stringify(code),\n    });\n  },\n\n  revoke: async (codeId: string, reason?: string) => {\n    return apiRequest<{ success: boolean }>(`/api/guest-codes/${codeId}/revoke`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    });\n  },\n\n  delete: async (codeId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/guest-codes/${codeId}`, {\n      method: 'DELETE',\n    });\n  },\n\n  validate: async (qrToken: string) => {\n    return apiRequest<{ valid: boolean; code?: any; error?: string; message?: string }>('/api/guest-codes/validate', {\n      method: 'POST',\n      body: JSON.stringify({ qr_token: qrToken }),\n    });\n  },\n\n  use: async (codeId: string) => {\n    return apiRequest<{ success: boolean; code?: any }>(`/api/guest-codes/${codeId}/use`, {\n      method: 'POST',\n    });\n  },\n\n  getLogs: async (codeId: string) => {\n    return apiRequest<{ logs: any[] }>(`/api/guest-codes/${codeId}/logs`);\n  },\n};\n\n// Chat API\nexport const chatApi = {\n  getChannels: async () => {\n    return apiRequest<{ channels: any[] }>('/api/chat/channels');\n  },\n\n  createChannel: async (channel: {\n    type: 'uk_general' | 'building_general' | 'admin_support' | 'private_support';\n    name: string;\n    description?: string;\n    building_id?: string;\n  }) => {\n    return apiRequest<{ channel: any }>('/api/chat/channels', {\n      method: 'POST',\n      body: JSON.stringify(channel),\n    });\n  },\n\n  getMessages: async (channelId: string, limit = 50, before?: string) => {\n    const params = new URLSearchParams({ limit: String(limit) });\n    if (before) params.append('before', before);\n    return apiRequest<{ messages: any[] }>(`/api/chat/channels/${channelId}/messages?${params}`);\n  },\n\n  sendMessage: async (channelId: string, content: string) => {\n    return apiRequest<{ message: any }>(`/api/chat/channels/${channelId}/messages`, {\n      method: 'POST',\n      body: JSON.stringify({ content }),\n    });\n  },\n\n  markRead: async (channelId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/chat/channels/${channelId}/read`, {\n      method: 'POST',\n    });\n  },\n\n  // Mark specific message as read (for delivery checkmarks)\n  markMessageRead: async (channelId: string, messageId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/chat/channels/${channelId}/messages/${messageId}/read`, {\n      method: 'POST',\n    });\n  },\n\n  // Get or create private support channel for current user (resident)\n  getOrCreateSupportChannel: async () => {\n    return apiRequest<any>('/api/chat/channels/support', {\n      method: 'POST',\n    });\n  },\n\n  // Get all private support channels (admin/manager only)\n  getAllSupportChannels: async () => {\n    return apiRequest<{ channels: any[] }>('/api/chat/channels?type=private_support');\n  },\n\n  // Get unread message count for sidebar badge\n  getUnreadCount: async () => {\n    return apiRequest<{ unread_count: number }>('/api/chat/unread-count');\n  },\n};\n\n// Announcements API\nexport const announcementsApi = {\n  getAll: async () => {\n    return cachedGet<{ announcements: any[] }>('/api/announcements', CACHE_TTL.SHORT);\n  },\n\n  create: async (announcement: {\n    title: string;\n    content: string;\n    type: 'residents' | 'employees' | 'staff' | 'all';\n    target_type?: 'all' | 'branch' | 'building' | 'entrance' | 'floor' | 'custom';\n    target_branch?: string;\n    target_building_id?: string;\n    target_entrance?: string;\n    target_floor?: string;\n    target_logins?: string;\n    priority?: 'normal' | 'important' | 'urgent';\n    expires_at?: string;\n    attachments?: { name: string; url: string; type: string; size: number }[];\n  }) => {\n    const result = await apiRequest<{ id: string }>('/api/announcements', {\n      method: 'POST',\n      body: JSON.stringify(announcement),\n    });\n    invalidateCache('/api/announcements');\n    return result;\n  },\n\n  delete: async (announcementId: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/announcements/${announcementId}`, {\n      method: 'DELETE',\n    });\n    invalidateCache('/api/announcements');\n    return result;\n  },\n\n  // Update announcement\n  update: async (announcementId: string, data: {\n    title?: string;\n    content?: string;\n    type?: 'residents' | 'employees' | 'all';\n    priority?: 'normal' | 'important' | 'urgent';\n    target_type?: string;\n    target_building_id?: string;\n    target_entrance?: string;\n    target_floor?: string;\n    target_logins?: string;\n    expires_at?: string;\n    attachments?: { name: string; url: string; type: string; size: number }[] | null;\n  }) => {\n    const result = await apiRequest<{ announcement: any }>(`/api/announcements/${announcementId}`, {\n      method: 'PUT',\n      body: JSON.stringify(data),\n    });\n    invalidateCache('/api/announcements');\n    return result;\n  },\n\n  // Mark announcement as viewed\n  markAsViewed: async (announcementId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/announcements/${announcementId}/view`, {\n      method: 'POST',\n    });\n  },\n\n  // Get views for an announcement (admin/manager can see viewers list and stats)\n  getViews: async (announcementId: string) => {\n    return apiRequest<{\n      count: number;\n      targetAudienceSize: number;\n      viewPercentage: number;\n      viewers: any[];\n      userViewed: boolean;\n    }>(`/api/announcements/${announcementId}/views`);\n  },\n};\n\n// File Upload API\nexport const uploadApi = {\n  // Upload a file and get a data URL back\n  uploadFile: async (file: File): Promise<{ name: string; url: string; type: string; size: number }> => {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    const token = localStorage.getItem('auth_token');\n    const response = await fetch(`${API_URL}/api/upload`, {\n      method: 'POST',\n      headers: token ? { 'Authorization': `Bearer ${token}` } : {},\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || 'Upload failed');\n    }\n\n    const data = await response.json();\n    return data.file;\n  },\n\n  // Upload multiple files\n  uploadFiles: async (files: File[]): Promise<{ name: string; url: string; type: string; size: number }[]> => {\n    const results = await Promise.all(files.map(file => uploadApi.uploadFile(file)));\n    return results;\n  },\n};\n\n// Branches API (CRM)\nexport const branchesApi = {\n  getAll: async () => {\n    return cachedGet<{ branches: any[] }>('/api/branches', CACHE_TTL.LONG);\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ branch: any }>(`/api/branches/${id}`);\n  },\n};\n\n// Buildings API (CRM)\nexport const buildingsApi = {\n  getAll: async () => {\n    // Buildings rarely change - use long cache\n    return cachedGet<{ buildings: any[] }>('/api/buildings', CACHE_TTL.LONG);\n  },\n\n  getById: async (id: string) => {\n    return cachedGet<{ building: any; entrances: any[]; documents: any[] }>(`/api/buildings/${id}`, CACHE_TTL.LONG);\n  },\n\n  create: async (building: {\n    name: string;\n    address: string;\n    zone?: string;\n    cadastralNumber?: string;\n    branchCode?: string;\n    buildingNumber?: string;\n    floors?: number;\n    entrances?: number;\n    totalApartments?: number;\n    totalArea?: number;\n    livingArea?: number;\n    commonArea?: number;\n    landArea?: number;\n    yearBuilt?: number;\n    yearRenovated?: number;\n    buildingType?: string;\n    roofType?: string;\n    wallMaterial?: string;\n    foundationType?: string;\n    hasElevator?: boolean;\n    elevatorCount?: number;\n    hasGas?: boolean;\n    heatingType?: string;\n    hasHotWater?: boolean;\n    waterSupplyType?: string;\n    sewerageType?: string;\n    hasIntercom?: boolean;\n    hasVideoSurveillance?: boolean;\n    hasConcierge?: boolean;\n    hasParkingLot?: boolean;\n    parkingSpaces?: number;\n    hasPlayground?: boolean;\n    managerId?: string;\n    managerName?: string;\n    monthlyBudget?: number;\n    reserveFund?: number;\n  }) => {\n    const result = await apiRequest<{ building: any }>('/api/buildings', {\n      method: 'POST',\n      body: JSON.stringify(building),\n    });\n    // Invalidate buildings cache after creation\n    invalidateCache('/api/buildings');\n    return result;\n  },\n\n  update: async (id: string, updates: Partial<{\n    name: string;\n    address: string;\n    zone: string;\n    cadastralNumber: string;\n    branchCode: string;\n    buildingNumber: string;\n    floors: number;\n    entrances: number;\n    totalApartments: number;\n    totalArea: number;\n    livingArea: number;\n    commonArea: number;\n    landArea: number;\n    yearBuilt: number;\n    yearRenovated: number;\n    buildingType: string;\n    roofType: string;\n    wallMaterial: string;\n    foundationType: string;\n    hasElevator: boolean;\n    elevatorCount: number;\n    hasGas: boolean;\n    heatingType: string;\n    hasHotWater: boolean;\n    waterSupplyType: string;\n    sewerageType: string;\n    hasIntercom: boolean;\n    hasVideoSurveillance: boolean;\n    hasConcierge: boolean;\n    hasParkingLot: boolean;\n    parkingSpaces: number;\n    hasPlayground: boolean;\n    managerId: string;\n    managerName: string;\n    monthlyBudget: number;\n    reserveFund: number;\n    totalDebt: number;\n    collectionRate: number;\n  }>) => {\n    const result = await apiRequest<{ building: any }>(`/api/buildings/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n    // Invalidate buildings cache after update\n    invalidateCache('/api/buildings');\n    return result;\n  },\n\n  delete: async (id: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/buildings/${id}`, {\n      method: 'DELETE',\n    });\n    // Invalidate buildings cache after deletion\n    invalidateCache('/api/buildings');\n    return result;\n  },\n};\n\n// Entrances API (CRM)\nexport const entrancesApi = {\n  getByBuilding: async (buildingId: string) => {\n    return apiRequest<{ entrances: any[] }>(`/api/buildings/${buildingId}/entrances`);\n  },\n\n  create: async (buildingId: string, entrance: {\n    number: number;\n    floorsFrom?: number;\n    floorsTo?: number;\n    apartmentsFrom?: number;\n    apartmentsTo?: number;\n    hasElevator?: boolean;\n    elevatorId?: string;\n    intercomType?: string;\n    intercomCode?: string;\n    cleaningSchedule?: string;\n    responsibleId?: string;\n    notes?: string;\n  }) => {\n    return apiRequest<{ entrance: any }>(`/api/buildings/${buildingId}/entrances`, {\n      method: 'POST',\n      body: JSON.stringify(entrance),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    number: number;\n    floorsFrom: number;\n    floorsTo: number;\n    apartmentsFrom: number;\n    apartmentsTo: number;\n    hasElevator: boolean;\n    elevatorId: string;\n    intercomType: string;\n    intercomCode: string;\n    cleaningSchedule: string;\n    responsibleId: string;\n    lastInspection: string;\n    notes: string;\n  }>) => {\n    return apiRequest<{ entrance: any }>(`/api/entrances/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/entrances/${id}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Building Documents API (CRM)\nexport const buildingDocumentsApi = {\n  getByBuilding: async (buildingId: string) => {\n    return apiRequest<{ documents: any[] }>(`/api/buildings/${buildingId}/documents`);\n  },\n\n  create: async (buildingId: string, document: {\n    name: string;\n    type?: string;\n    fileUrl: string;\n    fileSize?: number;\n    expiresAt?: string;\n  }) => {\n    return apiRequest<{ document: any }>(`/api/buildings/${buildingId}/documents`, {\n      method: 'POST',\n      body: JSON.stringify(document),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/building-documents/${id}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Apartments API (CRM)\nexport const apartmentsApi = {\n  getByBuilding: async (buildingId: string, options?: {\n    entranceId?: string;\n    status?: string;\n    page?: number;\n    limit?: number;\n  }) => {\n    const params = new URLSearchParams();\n    if (options?.entranceId) params.append('entrance_id', options.entranceId);\n    if (options?.status) params.append('status', options.status);\n    if (options?.page) params.append('page', options.page.toString());\n    if (options?.limit) params.append('limit', options.limit.toString());\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ apartments: any[]; pagination: { page: number; limit: number; total: number; pages: number } }>(\n      `/api/buildings/${buildingId}/apartments${query}`\n    );\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ apartment: any; owners: any[]; personalAccount: any }>(`/api/apartments/${id}`);\n  },\n\n  create: async (buildingId: string, apartment: {\n    number: string;\n    entranceId?: string;\n    floor?: number;\n    totalArea?: number;\n    livingArea?: number;\n    kitchenArea?: number;\n    rooms?: number;\n    hasBalcony?: boolean;\n    hasLoggia?: boolean;\n    status?: string;\n  }) => {\n    return apiRequest<{ apartment: any }>(`/api/buildings/${buildingId}/apartments`, {\n      method: 'POST',\n      body: JSON.stringify(apartment),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    entranceId: string;\n    number: string;\n    floor: number;\n    totalArea: number;\n    livingArea: number;\n    rooms: number;\n    status: string;\n    primaryOwnerId: string;\n    personalAccountId: string;\n  }>) => {\n    return apiRequest<{ apartment: any }>(`/api/apartments/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/apartments/${id}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Owners API (CRM)\nexport const ownersApi = {\n  getAll: async (options?: { type?: string; search?: string; page?: number; limit?: number }) => {\n    const params = new URLSearchParams();\n    if (options?.type) params.append('type', options.type);\n    if (options?.search) params.append('search', options.search);\n    if (options?.page) params.append('page', options.page.toString());\n    if (options?.limit) params.append('limit', options.limit.toString());\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ owners: any[]; pagination: { page: number; limit: number; total: number; pages: number } }>(\n      `/api/owners${query}`\n    );\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ owner: any; apartments: any[] }>(`/api/owners/${id}`);\n  },\n\n  create: async (owner: {\n    type?: string;\n    lastName?: string;\n    firstName?: string;\n    middleName?: string;\n    fullName?: string;\n    phone?: string;\n    email?: string;\n    ownershipType?: string;\n    ownershipShare?: number;\n  }) => {\n    return apiRequest<{ owner: any }>('/api/owners', {\n      method: 'POST',\n      body: JSON.stringify(owner),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    lastName: string;\n    firstName: string;\n    middleName: string;\n    fullName: string;\n    phone: string;\n    email: string;\n    isActive: boolean;\n    isVerified: boolean;\n  }>) => {\n    return apiRequest<{ owner: any }>(`/api/owners/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/owners/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  linkToApartment: async (ownerId: string, apartmentId: string, data?: {\n    ownershipShare?: number;\n    isPrimary?: boolean;\n    startDate?: string;\n  }) => {\n    return apiRequest<{ success: boolean }>(`/api/owners/${ownerId}/apartments/${apartmentId}`, {\n      method: 'POST',\n      body: JSON.stringify(data || {}),\n    });\n  },\n\n  unlinkFromApartment: async (ownerId: string, apartmentId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/owners/${ownerId}/apartments/${apartmentId}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Personal Accounts API (CRM)\nexport const personalAccountsApi = {\n  getByBuilding: async (buildingId: string, options?: {\n    status?: string;\n    hasDebt?: boolean;\n    page?: number;\n    limit?: number;\n  }) => {\n    const params = new URLSearchParams();\n    if (options?.status) params.append('status', options.status);\n    if (options?.hasDebt) params.append('has_debt', 'true');\n    if (options?.page) params.append('page', options.page.toString());\n    if (options?.limit) params.append('limit', options.limit.toString());\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ accounts: any[]; pagination: { page: number; limit: number; total: number; pages: number } }>(\n      `/api/buildings/${buildingId}/accounts${query}`\n    );\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ account: any }>(`/api/accounts/${id}`);\n  },\n\n  create: async (account: {\n    apartmentId: string;\n    buildingId: string;\n    primaryOwnerId?: string;\n    ownerName?: string;\n    apartmentNumber?: string;\n    totalArea?: number;\n    residentsCount?: number;\n    balance?: number;\n    currentDebt?: number;\n  }) => {\n    return apiRequest<{ account: any }>('/api/accounts', {\n      method: 'POST',\n      body: JSON.stringify(account),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    ownerName: string;\n    balance: number;\n    currentDebt: number;\n    penaltyAmount: number;\n    status: string;\n  }>) => {\n    return apiRequest<{ account: any }>(`/api/accounts/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  getDebtors: async (options?: { minDebt?: number; buildingId?: string }) => {\n    const params = new URLSearchParams();\n    if (options?.minDebt) params.append('min_debt', options.minDebt.toString());\n    if (options?.buildingId) params.append('building_id', options.buildingId);\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ debtors: any[] }>(`/api/accounts/debtors${query}`);\n  },\n};\n\n// CRM Residents API\nexport const crmResidentsApi = {\n  getByApartment: async (apartmentId: string, options?: { isActive?: boolean }) => {\n    const params = new URLSearchParams();\n    if (options?.isActive !== undefined) params.append('is_active', options.isActive.toString());\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ residents: any[] }>(`/api/apartments/${apartmentId}/residents${query}`);\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ resident: any }>(`/api/residents/${id}`);\n  },\n\n  create: async (apartmentId: string, resident: {\n    lastName?: string;\n    firstName?: string;\n    middleName?: string;\n    fullName?: string;\n    birthDate?: string;\n    residentType?: string;\n    relationToOwner?: string;\n    registrationType?: string;\n    registrationDate?: string;\n    phone?: string;\n    email?: string;\n    movedInDate?: string;\n    ownerId?: string;\n  }) => {\n    return apiRequest<{ resident: any }>(`/api/apartments/${apartmentId}/residents`, {\n      method: 'POST',\n      body: JSON.stringify(resident),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    lastName: string;\n    firstName: string;\n    middleName: string;\n    fullName: string;\n    birthDate: string;\n    residentType: string;\n    phone: string;\n    email: string;\n    isActive: boolean;\n    movedOutDate: string;\n    movedOutReason: string;\n  }>) => {\n    return apiRequest<{ resident: any }>(`/api/residents/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/residents/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  moveOut: async (id: string, data: { movedOutDate?: string; reason?: string }) => {\n    return apiRequest<{ success: boolean }>(`/api/residents/${id}/move-out`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n};\n\n// Meters API (CRM)\nexport const metersApi = {\n  getByApartment: async (apartmentId: string, options?: { type?: string; isActive?: boolean }) => {\n    const params = new URLSearchParams();\n    if (options?.type) params.append('type', options.type);\n    if (options?.isActive !== undefined) params.append('is_active', options.isActive.toString());\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ meters: any[] }>(`/api/apartments/${apartmentId}/meters${query}`);\n  },\n\n  getByBuilding: async (buildingId: string, options?: { type?: string; isCommon?: boolean }) => {\n    const params = new URLSearchParams();\n    if (options?.type) params.append('type', options.type);\n    if (options?.isCommon !== undefined) params.append('is_common', options.isCommon.toString());\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ meters: any[] }>(`/api/buildings/${buildingId}/meters${query}`);\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ meter: any; readings: any[] }>(`/api/meters/${id}`);\n  },\n\n  create: async (meter: {\n    apartmentId?: string;\n    buildingId?: string;\n    type: 'cold_water' | 'hot_water' | 'electricity' | 'gas' | 'heating';\n    isCommon?: boolean;\n    serialNumber: string;\n    model?: string;\n    brand?: string;\n    installDate?: string;\n    location?: string;\n    initialValue?: number;\n    verificationDate?: string;\n    nextVerificationDate?: string;\n    sealNumber?: string;\n  }) => {\n    return apiRequest<{ meter: any }>('/api/meters', {\n      method: 'POST',\n      body: JSON.stringify(meter),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    serialNumber: string;\n    model: string;\n    brand: string;\n    location: string;\n    verificationDate: string;\n    nextVerificationDate: string;\n    sealNumber: string;\n    isActive: boolean;\n    currentValue: number;\n    lastReadingDate: string;\n    notes: string;\n  }>) => {\n    return apiRequest<{ meter: any }>(`/api/meters/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/meters/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  decommission: async (id: string, reason?: string) => {\n    return apiRequest<{ success: boolean }>(`/api/meters/${id}/decommission`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    });\n  },\n};\n\n// Meter Readings API\nexport const meterReadingsApi = {\n  getByMeter: async (meterId: string, options?: { limit?: number; offset?: number; status?: string }) => {\n    const params = new URLSearchParams();\n    if (options?.limit) params.append('limit', options.limit.toString());\n    if (options?.offset) params.append('offset', options.offset.toString());\n    if (options?.status) params.append('status', options.status);\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ readings: any[] }>(`/api/meters/${meterId}/readings${query}`);\n  },\n\n  getLastReading: async (meterId: string) => {\n    return apiRequest<{ reading: any | null }>(`/api/meters/${meterId}/last-reading`);\n  },\n\n  submit: async (meterId: string, reading: {\n    value: number;\n    readingDate?: string;\n    photoUrl?: string;\n    notes?: string;\n  }) => {\n    return apiRequest<{ reading: any }>(`/api/meters/${meterId}/readings`, {\n      method: 'POST',\n      body: JSON.stringify(reading),\n    });\n  },\n\n  verify: async (readingId: string, data: { approved: boolean; rejectionReason?: string }) => {\n    return apiRequest<{ success: boolean }>(`/api/meter-readings/${readingId}/verify`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n};\n\n// Team API (Admin only - get all staff: managers, department heads, executors)\nexport const teamApi = {\n  getAll: async () => {\n    // Always fetch fresh data, no caching\n    return apiRequest<{\n      managers: any[];\n      departmentHeads: any[];\n      executors: any[];\n    }>('/api/team', { cache: 'no-store' });\n  },\n\n  // Get single staff member by ID (for live data refresh with password)\n  getById: async (userId: string) => {\n    // Always fetch fresh data, no caching\n    return apiRequest<{ user: any }>(`/api/team/${userId}`, { cache: 'no-store' });\n  },\n\n  // Create new staff member (uses auth/register endpoint)\n  create: async (data: {\n    login: string;\n    password: string;\n    name: string;\n    phone: string;\n    role: 'manager' | 'department_head' | 'executor';\n    specialization?: string;\n  }) => {\n    return apiRequest<{ user: any }>('/api/auth/register', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n\n  update: async (userId: string, data: {\n    name?: string;\n    phone?: string;\n    login?: string;\n    password?: string;\n    specialization?: string;\n    status?: string;\n  }) => {\n    return apiRequest<{ user: any }>(`/api/team/${userId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(data),\n    });\n  },\n\n  // Delete staff member\n  delete: async (userId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/team/${userId}`, {\n      method: 'DELETE',\n    });\n  },\n\n  // Reset passwords for all staff without password_plain (admin only, one-time operation)\n  resetAllPasswords: async () => {\n    return apiRequest<{\n      message: string;\n      updated: number;\n      staff: { id: string; login: string; name: string; password: string }[];\n    }>('/api/team/reset-all-passwords', {\n      method: 'POST',\n    });\n  },\n};\n\n// Executors API\nexport const executorsApi = {\n  getAll: async (showAll = false) => {\n    const url = showAll ? '/api/executors?all=true' : '/api/executors';\n    // No caching for executors - always fetch fresh data for accurate assignment\n    return apiRequest<{ executors: any[] }>(url, { cache: 'no-store' });\n  },\n\n  // Get single executor by ID (for live data refresh with password)\n  getById: async (executorId: string) => {\n    // Always fetch fresh data, no caching\n    return apiRequest<{ executor: any }>(`/api/executors/${executorId}`, { cache: 'no-store' });\n  },\n\n  updateStatus: async (executorId: string, status: 'available' | 'busy' | 'offline') => {\n    return apiRequest<{ executor: any }>(`/api/executors/${executorId}/status`, {\n      method: 'PATCH',\n      body: JSON.stringify({ status }),\n    });\n  },\n\n  // Get executor stats (rating, completed count, weekly, avg time)\n  getStats: async (executorId: string) => {\n    return apiRequest<{\n      stats: {\n        totalCompleted: number;\n        thisWeek: number;\n        thisMonth: number;\n        rating: number;\n        avgCompletionTime: number;\n        statusBreakdown: Array<{ status: string; count: number }>;\n      }\n    }>(`/api/executors/${executorId}/stats`);\n  },\n};\n\n// Requests API\nexport const requestsApi = {\n  getAll: async (status?: string, category?: string) => {\n    const params = new URLSearchParams();\n    if (status) params.append('status', status);\n    if (category) params.append('category', category);\n    const queryString = params.toString();\n    // Use cached GET with short TTL (10s) - requests change frequently\n    return cachedGet<{ requests: any[] }>(`/api/requests${queryString ? '?' + queryString : ''}`, CACHE_TTL.SHORT);\n  },\n\n  create: async (request: {\n    category_id: string;\n    title: string;\n    description?: string;\n    priority?: 'low' | 'medium' | 'high' | 'urgent';\n    access_info?: string;\n    scheduled_at?: string;\n    // For manual creation by managers/admins - specify resident\n    resident_id?: string;\n  }) => {\n    const result = await apiRequest<{ request: any }>('/api/requests', {\n      method: 'POST',\n      body: JSON.stringify(request),\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  update: async (requestId: string, updates: {\n    status?: string;\n    executor_id?: string;\n    rating?: number;\n    feedback?: string;\n  }) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  assign: async (requestId: string, executorId: string) => {\n    const result = await apiRequest<{ request: any }>(`/api/requests/${requestId}/assign`, {\n      method: 'POST',\n      body: JSON.stringify({ executor_id: executorId }),\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  accept: async (requestId: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/accept`, {\n      method: 'POST',\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  start: async (requestId: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/start`, {\n      method: 'POST',\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  complete: async (requestId: string) => {\n    invalidateCache('/api/requests');\n    return apiRequest<{ success: boolean }>(`/api/requests/${requestId}/complete`, {\n      method: 'POST',\n    });\n  },\n\n  pause: async (requestId: string) => {\n    const result = await apiRequest<{ success: boolean; request: any }>(`/api/requests/${requestId}/pause`, {\n      method: 'POST',\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  resume: async (requestId: string) => {\n    const result = await apiRequest<{ success: boolean; request: any; totalPausedTime: number }>(`/api/requests/${requestId}/resume`, {\n      method: 'POST',\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  // Resident approves completed work\n  approve: async (requestId: string, rating?: number, feedback?: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/approve`, {\n      method: 'POST',\n      body: JSON.stringify({ rating, feedback }),\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  // Resident rejects work (sends back to executor)\n  reject: async (requestId: string, reason: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/reject`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  // Legacy rate endpoint (for backward compatibility)\n  rate: async (requestId: string, rating: number, feedback?: string) => {\n    return apiRequest<{ success: boolean }>(`/api/requests/${requestId}/rate`, {\n      method: 'POST',\n      body: JSON.stringify({ rating, feedback }),\n    });\n  },\n\n  // Cancel request\n  cancel: async (requestId: string, reason: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/cancel`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  // Decline/Release request (executor releases the request back to queue)\n  decline: async (requestId: string, reason: string) => {\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/decline`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    });\n    invalidateCache('/api/requests');\n    return result;\n  },\n\n  // Reschedule requests\n  createReschedule: async (requestId: string, data: {\n    proposed_date: string;\n    proposed_time: string;\n    reason: string;\n    reason_text?: string;\n  }) => {\n    return apiRequest<{ reschedule: any }>(`/api/requests/${requestId}/reschedule`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n\n  getReschedules: async (requestId: string) => {\n    return apiRequest<{ reschedules: any[] }>(`/api/requests/${requestId}/reschedule`);\n  },\n};\n\n// Reschedule API (for pending reschedules)\nexport const rescheduleApi = {\n  // Get pending reschedules for current user\n  getPending: async () => {\n    return apiRequest<{ reschedules: any[] }>('/api/reschedule-requests');\n  },\n\n  // Respond to reschedule request\n  respond: async (rescheduleId: string, accepted: boolean, responseNote?: string) => {\n    return apiRequest<{ reschedule: any }>(`/api/reschedule-requests/${rescheduleId}/respond`, {\n      method: 'POST',\n      body: JSON.stringify({ accepted, response_note: responseNote }),\n    });\n  },\n};\n\n// Ratings API\nexport const ratingsApi = {\n  getForExecutor: async (executorId: string) => {\n    return apiRequest<{ ratings: any[]; average: any }>(`/api/ratings?executor_id=${executorId}`);\n  },\n\n  create: async (rating: {\n    executor_id: string;\n    quality: number;\n    speed: number;\n    politeness: number;\n    comment?: string;\n  }) => {\n    return apiRequest<{ rating: any }>('/api/ratings', {\n      method: 'POST',\n      body: JSON.stringify(rating),\n    });\n  },\n};\n\n// Categories API\nexport const categoriesApi = {\n  getAll: async () => {\n    return apiRequest<{ categories: any[] }>('/api/categories');\n  },\n};\n\n// Stats API\nexport const statsApi = {\n  getDashboard: async () => {\n    return apiRequest<any>('/api/stats/dashboard');\n  },\n};\n\n// Meetings API\nexport const meetingsApi = {\n  getAll: async () => {\n    return cachedGet<{ meetings: any[] }>('/api/meetings', CACHE_TTL.MEDIUM);\n  },\n\n  create: async (meeting: {\n    title: string;\n    description?: string;\n    date: string;\n    time: string;\n    location?: string;\n    type?: 'general' | 'emergency' | 'committee';\n    target_building_id?: string;\n  }) => {\n    return apiRequest<{ meeting: any }>('/api/meetings', {\n      method: 'POST',\n      body: JSON.stringify(meeting),\n    });\n  },\n\n  createVote: async (meetingId: string, vote: {\n    question: string;\n    options: string[];\n  }) => {\n    return apiRequest<{ vote: any }>(`/api/meetings/${meetingId}/votes`, {\n      method: 'POST',\n      body: JSON.stringify(vote),\n    });\n  },\n\n  submitVote: async (voteId: string, optionIndex: number) => {\n    return apiRequest<{ response: any }>(`/api/votes/${voteId}/respond`, {\n      method: 'POST',\n      body: JSON.stringify({ option_index: optionIndex }),\n    });\n  },\n};\n\n// ==================== TRAINING SYSTEM API ====================\n\n// Training Partners API\nexport const trainingPartnersApi = {\n  getAll: async (activeOnly?: boolean) => {\n    const query = activeOnly ? '?active=true' : '';\n    return apiRequest<{ partners: any[] }>(`/api/training/partners${query}`);\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ partner: any }>(`/api/training/partners/${id}`);\n  },\n\n  create: async (partner: {\n    name: string;\n    position?: string;\n    specialization?: string;\n    email?: string;\n    phone?: string;\n    bio?: string;\n    avatarUrl?: string;\n    isActive?: boolean;\n  }) => {\n    return apiRequest<{ partner: any }>('/api/training/partners', {\n      method: 'POST',\n      body: JSON.stringify(partner),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    name: string;\n    position: string;\n    specialization: string;\n    email: string;\n    phone: string;\n    bio: string;\n    avatarUrl: string;\n    isActive: boolean;\n  }>) => {\n    return apiRequest<{ partner: any }>(`/api/training/partners/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/training/partners/${id}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Training Proposals API\nexport const trainingProposalsApi = {\n  getAll: async (options?: {\n    status?: string;\n    partnerId?: string;\n    authorId?: string;\n    page?: number;\n    limit?: number;\n  }) => {\n    const params = new URLSearchParams();\n    if (options?.status) params.append('status', options.status);\n    if (options?.partnerId) params.append('partner_id', options.partnerId);\n    if (options?.authorId) params.append('author_id', options.authorId);\n    if (options?.page) params.append('page', options.page.toString());\n    if (options?.limit) params.append('limit', options.limit.toString());\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequest<{ proposals: any[] }>(`/api/training/proposals${query}`);\n  },\n\n  getById: async (id: string) => {\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}`);\n  },\n\n  create: async (proposal: {\n    topic: string;\n    description?: string;\n    partnerId: string;\n    format?: 'online' | 'offline' | 'any';\n    preferredTimeSlots?: string[];\n    isAuthorAnonymous?: boolean;\n  }) => {\n    return apiRequest<{ proposal: any }>('/api/training/proposals', {\n      method: 'POST',\n      body: JSON.stringify(proposal),\n    });\n  },\n\n  update: async (id: string, updates: Partial<{\n    topic: string;\n    description: string;\n    format: string;\n    status: string;\n    preferredTimeSlots: string[];\n    partnerResponse: 'accepted' | 'rejected';\n    partnerResponseNote: string;\n  }>) => {\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    });\n  },\n\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  schedule: async (id: string, data: {\n    scheduledDate: string;\n    scheduledTime: string;\n    scheduledLocation?: string;\n    scheduledLink?: string;\n    maxParticipants?: number;\n  }) => {\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}/schedule`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n\n  complete: async (id: string, data?: { actualParticipantsCount?: number }) => {\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}/complete`, {\n      method: 'POST',\n      body: JSON.stringify(data || {}),\n    });\n  },\n};\n\n// Training Votes API\nexport const trainingVotesApi = {\n  getForProposal: async (proposalId: string) => {\n    return apiRequest<{ votes: any[] }>(`/api/training/proposals/${proposalId}/votes`);\n  },\n\n  vote: async (proposalId: string, data: {\n    participationIntent?: 'definitely' | 'maybe' | 'support_only';\n    isAnonymous?: boolean;\n  }) => {\n    return apiRequest<{ vote: any }>(`/api/training/proposals/${proposalId}/votes`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n\n  removeVote: async (proposalId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${proposalId}/votes`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// Training Registrations API\nexport const trainingRegistrationsApi = {\n  register: async (proposalId: string) => {\n    return apiRequest<{ registration: any }>(`/api/training/proposals/${proposalId}/register`, {\n      method: 'POST',\n    });\n  },\n\n  unregister: async (proposalId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${proposalId}/register`, {\n      method: 'DELETE',\n    });\n  },\n\n  confirmAttendance: async (proposalId: string, userId: string) => {\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${proposalId}/attendance/${userId}`, {\n      method: 'POST',\n    });\n  },\n};\n\n// Training Feedback API\nexport const trainingFeedbackApi = {\n  getForProposal: async (proposalId: string) => {\n    return apiRequest<{ feedback: any[] }>(`/api/training/proposals/${proposalId}/feedback`);\n  },\n\n  submit: async (proposalId: string, feedback: {\n    rating: number;\n    contentRating?: number;\n    presenterRating?: number;\n    usefulnessRating?: number;\n    comment?: string;\n    isAnonymous?: boolean;\n  }) => {\n    return apiRequest<{ feedback: any }>(`/api/training/proposals/${proposalId}/feedback`, {\n      method: 'POST',\n      body: JSON.stringify(feedback),\n    });\n  },\n};\n\n// Training Notifications API\nexport const trainingNotificationsApi = {\n  getAll: async (unreadOnly?: boolean) => {\n    const query = unreadOnly ? '?unread=true' : '';\n    return apiRequest<{ notifications: any[] }>(`/api/training/notifications${query}`);\n  },\n\n  markAsRead: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/training/notifications/${id}/read`, {\n      method: 'POST',\n    });\n  },\n\n  markAllAsRead: async () => {\n    return apiRequest<{ success: boolean }>('/api/training/notifications/read-all', {\n      method: 'POST',\n    });\n  },\n};\n\n// Training Settings API\nexport const trainingSettingsApi = {\n  getAll: async () => {\n    return apiRequest<{ settings: Record<string, any> }>('/api/training/settings');\n  },\n\n  update: async (settings: Record<string, any>) => {\n    return apiRequest<{ success: boolean }>('/api/training/settings', {\n      method: 'PATCH',\n      body: JSON.stringify(settings),\n    });\n  },\n};\n\n// Training Stats API\nexport const trainingStatsApi = {\n  get: async () => {\n    return apiRequest<{ stats: {\n      totalProposals: number;\n      votingProposals: number;\n      scheduledTrainings: number;\n      completedTrainings: number;\n      totalVotes: number;\n      totalParticipants: number;\n      averageRating: number;\n    } }>('/api/training/stats');\n  },\n};\n\n// ==================== MEETING SYSTEM API ====================\n\n// Meetings API (Full OSS workflow) - Uses wrapped responses for meetingStore compatibility\nexport const meetingsFullApi = {\n  getAll: async (options?: {\n    buildingId?: string;\n    status?: string;\n    organizerId?: string;\n    onlyActive?: boolean; //  NEW: Filter for active meetings only\n  }) => {\n    const params = new URLSearchParams();\n    if (options?.buildingId) params.append('building_id', options.buildingId);\n    if (options?.status) params.append('status', options.status);\n    if (options?.organizerId) params.append('organizer_id', options.organizerId);\n    if (options?.onlyActive) params.append('only_active', 'true'); //  NEW\n    const query = params.toString() ? `?${params.toString()}` : '';\n    return apiRequestWrapped<{ meetings?: any[] }>(`/api/meetings${query}`).then(r => ({\n      success: r.success,\n      data: r.data?.meetings || r.data,\n      error: r.error\n    }));\n  },\n\n  getById: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}`).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  create: async (meeting: {\n    buildingId: string;\n    buildingAddress?: string;\n    organizerType?: 'uk' | 'resident' | 'initiative_group';\n    format?: 'online' | 'offline' | 'hybrid';\n    location?: string;\n    description?: string;\n    agendaItems: { title: string; description?: string; threshold?: string }[];\n    materials?: any[];\n  }) => {\n    return apiRequestWrapped<any>('/api/meetings', {\n      method: 'POST',\n      body: JSON.stringify(meeting),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  update: async (id: string, updates: any) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  delete: async (id: string) => {\n    return apiRequestWrapped<{ success: boolean }>(`/api/meetings/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  // Status transitions\n  submit: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/submit`, { method: 'POST' }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  approve: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/approve`, { method: 'POST' }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  reject: async (id: string, reason: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/reject`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  openSchedulePoll: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/open-schedule-poll`, { method: 'POST' }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  confirmSchedule: async (id: string, optionId?: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/confirm-schedule`, {\n      method: 'POST',\n      body: JSON.stringify({ optionId }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  openVoting: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/open-voting`, { method: 'POST' }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  closeVoting: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/close-voting`, { method: 'POST' }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  publishResults: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/publish-results`, { method: 'POST' }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  generateProtocol: async (id: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/generate-protocol`, { method: 'POST' }).then(r => ({\n      success: r.success,\n      data: r.data,\n      error: r.error\n    }));\n  },\n\n  approveProtocol: async (id: string, signerData?: { signerId: string; signerName: string; signerRole: string }) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/approve-protocol`, {\n      method: 'POST',\n      body: signerData ? JSON.stringify(signerData) : undefined,\n    }).then(r => ({\n      success: r.success,\n      data: r.data,\n      error: r.error\n    }));\n  },\n\n  cancel: async (id: string, reason: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${id}/cancel`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  getProtocol: async (meetingId: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/${meetingId}/protocol`).then(r => ({\n      success: r.success,\n      data: r.data?.protocol || r.data,\n      error: r.error\n    }));\n  },\n\n  // Get protocol as HTML (for PDF export)\n  getProtocolHtml: async (meetingId: string): Promise<string> => {\n    const token = localStorage.getItem('auth_token');\n    const response = await fetch(`/api/meetings/${meetingId}/protocol/html`, {\n      headers: token ? { 'Authorization': `Bearer ${token}` } : {},\n    });\n    return response.text();\n  },\n\n  // Open protocol in new tab for printing/PDF\n  openProtocolForPrint: (meetingId: string) => {\n    window.open(`/api/meetings/${meetingId}/protocol/html`, '_blank');\n  },\n\n  // Download protocol as PDF (uses browser print dialog)\n  downloadProtocolPdf: async (meetingId: string) => {\n    const html = await meetingsFullApi.getProtocolHtml(meetingId);\n\n    // Create iframe for printing\n    const iframe = document.createElement('iframe');\n    iframe.style.display = 'none';\n    document.body.appendChild(iframe);\n\n    const doc = iframe.contentDocument || iframe.contentWindow?.document;\n    if (doc) {\n      doc.open();\n      doc.write(html);\n      doc.close();\n\n      // Wait for content to load then print\n      setTimeout(() => {\n        iframe.contentWindow?.print();\n        // Remove iframe after printing dialog closes\n        setTimeout(() => {\n          document.body.removeChild(iframe);\n        }, 1000);\n      }, 500);\n    }\n  },\n};\n\n// Meeting Schedule Votes API\nexport const meetingScheduleVotesApi = {\n  vote: async (meetingId: string, optionId: string) => {\n    // Invalidate meetings cache to force fresh data after vote\n    invalidateCache('/api/meetings');\n\n    return apiRequestWrapped<any>(`/api/meetings/${meetingId}/schedule-votes`, {\n      method: 'POST',\n      body: JSON.stringify({ option_id: optionId }), // API expects snake_case\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n\n  getMyVote: async (meetingId: string) => {\n    return apiRequestWrapped<{ optionId: string | null }>(`/api/meetings/${meetingId}/schedule-votes/me`);\n  },\n};\n\n// Meeting Agenda Votes API\nexport const meetingAgendaVotesApi = {\n  vote: async (meetingId: string, agendaItemId: string, data: {\n    voterId: string;\n    voterName: string;\n    choice: 'for' | 'against' | 'abstain';\n    apartmentId?: string;\n    apartmentNumber?: string;\n    ownershipShare?: number;\n    verificationMethod?: 'login' | 'otp' | 'in_person' | 'proxy';\n    otpVerified?: boolean;\n    comment?: string; // /  \n  }) => {\n    return apiRequestWrapped<any>(\n      `/api/meetings/${meetingId}/agenda/${agendaItemId}/vote`,\n      {\n        method: 'POST',\n        body: JSON.stringify(data),\n      }\n    ).then(r => ({\n      success: r.success,\n      data: r.data,\n      error: r.error\n    }));\n  },\n\n  getMyVotes: async (meetingId: string, voterId?: string) => {\n    const query = voterId ? `?voter_id=${voterId}` : '';\n    return apiRequestWrapped<{ votes?: any[] }>(`/api/meetings/${meetingId}/votes/me${query}`).then(r => ({\n      success: r.success,\n      data: r.data?.votes || r.data || [],\n      error: r.error\n    }));\n  },\n\n  getVoteRecords: async (meetingId: string) => {\n    return apiRequestWrapped<{ voteRecords?: any[] }>(`/api/meetings/${meetingId}/vote-records`).then(r => ({\n      success: r.success,\n      data: r.data?.voteRecords || r.data || [],\n      error: r.error\n    }));\n  },\n};\n\n// Meeting OTP API\nexport const meetingOtpApi = {\n  request: async (data: {\n    userId: string;\n    phone: string;\n    purpose: 'schedule_vote' | 'agenda_vote' | 'protocol_sign';\n    meetingId?: string;\n    agendaItemId?: string;\n  }) => {\n    return apiRequestWrapped<any>('/api/meetings/otp/request', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    }).then(r => ({\n      success: r.success,\n      data: r.data,\n      error: r.error\n    }));\n  },\n\n  verify: async (otpId: string, code: string) => {\n    return apiRequestWrapped<{ verified: boolean; error?: string }>('/api/meetings/otp/verify', {\n      method: 'POST',\n      body: JSON.stringify({ otpId, code }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data,\n      error: r.error\n    }));\n  },\n};\n\n// Meeting Building Settings API\nexport const meetingBuildingSettingsApi = {\n  get: async (buildingId: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/building-settings/${buildingId}`).then(r => ({\n      success: r.success,\n      data: r.data?.settings || r.data,\n      error: r.error\n    }));\n  },\n\n  update: async (buildingId: string, settings: any) => {\n    return apiRequestWrapped<any>(`/api/meetings/building-settings/${buildingId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(settings),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.settings || r.data,\n      error: r.error\n    }));\n  },\n};\n\n// Meeting Voting Units API\nexport const meetingVotingUnitsApi = {\n  getByBuilding: async (buildingId: string) => {\n    return apiRequestWrapped<{ votingUnits?: any[] }>(`/api/meetings/voting-units?building_id=${buildingId}`).then(r => ({\n      success: r.success,\n      data: r.data?.votingUnits || r.data || [],\n      error: r.error\n    }));\n  },\n\n  create: async (unit: {\n    buildingId: string;\n    apartmentId?: string;\n    apartmentNumber: string;\n    ownerId?: string;\n    ownerName?: string;\n    coOwnerIds?: string[];\n    ownershipShare?: number;\n    totalArea?: number;\n  }) => {\n    return apiRequestWrapped<any>('/api/meetings/voting-units', {\n      method: 'POST',\n      body: JSON.stringify({\n        building_id: unit.buildingId,\n        apartment_id: unit.apartmentId,\n        apartment_number: unit.apartmentNumber,\n        owner_id: unit.ownerId,\n        owner_name: unit.ownerName,\n        co_owner_ids: unit.coOwnerIds ? JSON.stringify(unit.coOwnerIds) : '[]',\n        ownership_share: unit.ownershipShare || 100,\n        total_area: unit.totalArea || 0,\n      }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.votingUnit || r.data,\n      error: r.error\n    }));\n  },\n\n  verify: async (id: string, verifiedBy: string) => {\n    return apiRequestWrapped<any>(`/api/meetings/voting-units/${id}/verify`, {\n      method: 'POST',\n      body: JSON.stringify({ verified_by: verifiedBy }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.votingUnit || r.data,\n      error: r.error\n    }));\n  },\n};\n\n// Meeting Eligible Voters API\nexport const meetingEligibleVotersApi = {\n  set: async (meetingId: string, voterIds: string[], totalCount: number) => {\n    return apiRequestWrapped<any>(`/api/meetings/${meetingId}/eligible-voters`, {\n      method: 'POST',\n      body: JSON.stringify({ voterIds, totalCount }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.meeting || r.data,\n      error: r.error\n    }));\n  },\n};\n\n// Meeting Agenda Comments API (   )\nexport const meetingAgendaCommentsApi = {\n  //    \n  getByAgendaItem: async (agendaItemId: string) => {\n    return apiRequestWrapped<{ comments: any[] }>(`/api/agenda/${agendaItemId}/comments`).then(r => ({\n      success: r.success,\n      data: r.data?.comments || [],\n      error: r.error\n    }));\n  },\n\n  //  \n  create: async (agendaItemId: string, data: {\n    content: string;\n    apartmentNumber?: string;\n    includeInProtocol?: boolean;\n  }) => {\n    return apiRequestWrapped<any>(`/api/agenda/${agendaItemId}/comments`, {\n      method: 'POST',\n      body: JSON.stringify({\n        content: data.content,\n        apartment_number: data.apartmentNumber,\n        include_in_protocol: data.includeInProtocol !== false\n      }),\n    }).then(r => ({\n      success: r.success,\n      data: r.data?.comment || r.data,\n      error: r.error\n    }));\n  },\n\n  //   \n  delete: async (commentId: string) => {\n    return apiRequestWrapped<{ success: boolean }>(`/api/comments/${commentId}`, {\n      method: 'DELETE',\n    });\n  },\n};\n\n// ============================================\n// APP SETTINGS API\n// ============================================\n\nexport interface AppSettings {\n  companyName: string;\n  companyInn: string;\n  companyAddress: string;\n  companyPhone: string;\n  routingMode: 'manual' | 'auto' | 'hybrid';\n  workingHoursStart: string;\n  workingHoursEnd: string;\n  autoAssign: boolean;\n  notifyOnNew: boolean;\n  notifyOnComplete: boolean;\n  notifyOnRating: boolean;\n  smsNotifications: boolean;\n  emailNotifications: boolean;\n  pushNotifications: boolean;\n}\n\nexport const settingsApi = {\n  // Get all settings\n  getAll: async () => {\n    return apiRequestWrapped<{ settings: Record<string, any> }>('/api/settings').then(r => ({\n      success: r.success,\n      data: r.data,\n      error: r.error\n    }));\n  },\n\n  // Get single setting\n  get: async (key: string) => {\n    return apiRequestWrapped<{ value: any }>(`/api/settings/${key}`).then(r => ({\n      success: r.success,\n      data: r.data,\n      error: r.error\n    }));\n  },\n\n  // Update single setting\n  update: async (key: string, value: any) => {\n    return apiRequestWrapped<{ success: boolean }>(`/api/settings/${key}`, {\n      method: 'PUT',\n      body: JSON.stringify({ value }),\n    });\n  },\n\n  // Bulk update settings\n  updateMany: async (settings: Partial<AppSettings>) => {\n    return apiRequestWrapped<{ success: boolean }>('/api/settings', {\n      method: 'POST',\n      body: JSON.stringify(settings),\n    });\n  },\n};\n\n// ============================================\n// NOTIFICATIONS API\n// ============================================\n\nexport interface Notification {\n  id: string;\n  user_id: string;\n  type: string;\n  title: string;\n  body?: string;\n  data?: any;\n  is_read: boolean;\n  created_at: string;\n}\n\nexport const notificationsApi = {\n  // Get notifications for current user\n  getAll: async (limit = 50, unreadOnly = false) => {\n    const params = new URLSearchParams({ limit: String(limit) });\n    if (unreadOnly) params.set('unread', 'true');\n    return apiRequest<{ notifications: Notification[] }>(`/api/notifications?${params}`);\n  },\n\n  // Get unread count\n  getUnreadCount: async () => {\n    return apiRequest<{ count: number }>('/api/notifications/count');\n  },\n\n  // Create notification\n  create: async (data: {\n    user_id: string;\n    type: string;\n    title: string;\n    body?: string;\n    data?: any;\n  }) => {\n    return apiRequest<{ id: string; success: boolean }>('/api/notifications', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n\n  // Mark as read\n  markAsRead: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/notifications/${id}/read`, {\n      method: 'PATCH',\n    });\n  },\n\n  // Mark all as read\n  markAllAsRead: async () => {\n    return apiRequest<{ success: boolean }>('/api/notifications/read-all', {\n      method: 'POST',\n    });\n  },\n\n  // Delete\n  delete: async (id: string) => {\n    return apiRequest<{ success: boolean }>(`/api/notifications/${id}`, {\n      method: 'DELETE',\n    });\n  },\n\n  // Broadcast to multiple users\n  broadcast: async (data: {\n    user_ids: string[];\n    type: string;\n    title: string;\n    body?: string;\n    data?: any;\n  }) => {\n    return apiRequest<{ success: boolean; count: number }>('/api/notifications/broadcast', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  },\n};\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { User } from '../types';\nimport { authApi, usersApi } from '../services/api';\n\ninterface MockUserData {\n  password: string;\n  user: User;\n}\n\ninterface AuthState {\n  user: User | null;\n  token: string | null;\n  isLoading: boolean;\n  error: string | null;\n  // Legacy compatibility - to be removed after full migration\n  additionalUsers: Record<string, MockUserData>;\n  login: (loginStr: string, password: string) => Promise<boolean>;\n  logout: () => void;\n  register: (userData: {\n    login: string;\n    password: string;\n    name: string;\n    role: string;\n    phone?: string;\n    address?: string;\n    apartment?: string;\n    specialization?: string;\n  }) => Promise<boolean>;\n  registerBulk: (users: Array<{\n    login: string;\n    password: string;\n    name: string;\n    role: string;\n    phone?: string;\n    address?: string;\n    apartment?: string;\n  }>) => Promise<{ created: any[]; updated: any[] }>;\n  updateProfile: (updates: { phone?: string; name?: string }) => Promise<boolean>;\n  changePassword: (currentPassword: string, newPassword: string) => Promise<boolean>;\n  adminChangePassword: (userId: string, newPassword: string) => Promise<boolean>;\n  markContractSigned: () => Promise<boolean>;\n  refreshUser: () => Promise<void>;\n  // Legacy methods for backward compatibility\n  addMockUser: (login: string, password: string, user: User) => void;\n  removeUser: (login: string) => void;\n  updateUserPassword: (login: string, newPassword: string) => void;\n  updateUserProfile: (login: string, updates: Partial<User>) => void;\n  getUserPassword: (login: string) => string | null;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set, get) => ({\n      user: null,\n      token: null,\n      isLoading: false,\n      error: null,\n      additionalUsers: {},\n\n      login: async (loginStr: string, password: string) => {\n        const normalizedLogin = loginStr.trim();\n        const normalizedPassword = password.trim();\n        set({ isLoading: true, error: null });\n\n        // API login (all users are in database)\n        try {\n          const data = await authApi.login(normalizedLogin, normalizedPassword);\n          set({\n            user: data.user,\n            token: data.token,\n            isLoading: false,\n            error: null\n          });\n          return true;\n        } catch (apiError: unknown) {\n          // Login failed\n          const message = apiError instanceof Error ? apiError.message : '   ';\n          set({\n            isLoading: false,\n            error: message\n          });\n          return false;\n        }\n      },\n\n      logout: () => {\n        authApi.logout();\n        set({ user: null, token: null, error: null });\n      },\n\n      register: async (userData) => {\n        set({ isLoading: true, error: null });\n        try {\n          await authApi.register(userData);\n          set({ isLoading: false });\n          return true;\n        } catch (error: unknown) {\n          console.error('Register failed:', error);\n          set({ isLoading: false, error: (error as Error).message });\n          return false;\n        }\n      },\n\n      registerBulk: async (users) => {\n        set({ isLoading: true, error: null });\n        try {\n          const result = await authApi.registerBulk(users);\n          set({ isLoading: false });\n          return result;\n        } catch (error: unknown) {\n          console.error('Bulk register failed:', error);\n          set({ isLoading: false, error: (error as Error).message });\n          return { created: [], updated: [] };\n        }\n      },\n\n      updateProfile: async (updates) => {\n        set({ isLoading: true, error: null });\n        try {\n          const data = await usersApi.updateMe(updates);\n          set({ user: data.user, isLoading: false });\n          return true;\n        } catch (error: unknown) {\n          console.error('Update profile failed:', error);\n          set({ isLoading: false, error: (error as Error).message });\n          return false;\n        }\n      },\n\n      changePassword: async (currentPassword, newPassword) => {\n        set({ isLoading: true, error: null });\n        try {\n          const result = await usersApi.changePassword(currentPassword, newPassword);\n          // Update user with password_changed_at from server\n          const currentUser = get().user;\n          if (currentUser && result.password_changed_at) {\n            set({\n              user: { ...currentUser, passwordChangedAt: result.password_changed_at },\n              isLoading: false\n            });\n          } else {\n            set({ isLoading: false });\n          }\n          return true;\n        } catch (error: unknown) {\n          console.error('Change password failed:', error);\n          set({ isLoading: false, error: (error as Error).message });\n          return false;\n        }\n      },\n\n      adminChangePassword: async (userId, newPassword) => {\n        set({ isLoading: true, error: null });\n        try {\n          await usersApi.adminChangePassword(userId, newPassword);\n          set({ isLoading: false });\n          return true;\n        } catch (error: unknown) {\n          console.error('Admin change password failed:', error);\n          set({ isLoading: false, error: (error as Error).message });\n          return false;\n        }\n      },\n\n      markContractSigned: async () => {\n        try {\n          const result = await usersApi.markContractSigned();\n          // Update user with contract_signed_at from server\n          const currentUser = get().user;\n          if (currentUser && result.contract_signed_at) {\n            set({\n              user: { ...currentUser, contractSignedAt: result.contract_signed_at }\n            });\n          }\n          return true;\n        } catch (error: unknown) {\n          console.error('Mark contract signed failed:', error);\n          return false;\n        }\n      },\n\n      refreshUser: async () => {\n        const token = get().token;\n        if (!token) return;\n\n        try {\n          const data = await usersApi.getMe();\n          set({ user: data.user });\n        } catch (error) {\n          console.error('Refresh user failed:', error);\n          // If token is invalid, logout\n          get().logout();\n        }\n      },\n\n      // Legacy methods for backward compatibility (to be removed after full migration)\n      addMockUser: (login: string, password: string, user: User) => {\n        console.log('addMockUser called with:', { login, password, user });\n\n        // Also register via API with all fields including building info\n        authApi.register({\n          login,\n          password,\n          name: user.name,\n          role: user.role,\n          phone: user.phone,\n          address: user.address,\n          apartment: user.apartment,\n          building_id: (user as any).buildingId,\n          entrance: (user as any).entrance,\n          floor: (user as any).floor,\n          branch: (user as any).branch,\n          building: (user as any).building,\n        }).then(() => {\n          console.log('User registered via API successfully');\n        }).catch((err) => {\n          console.error('API register error:', err);\n        });\n\n        set((state) => ({\n          additionalUsers: {\n            ...state.additionalUsers,\n            [login]: { password, user }\n          }\n        }));\n\n        console.log('User added to local store');\n      },\n\n      removeUser: (login: string) => {\n        set((state) => {\n          const newUsers = { ...state.additionalUsers };\n          delete newUsers[login];\n          return { additionalUsers: newUsers };\n        });\n      },\n\n      updateUserPassword: (login: string, newPassword: string) => {\n        set((state) => {\n          if (state.additionalUsers[login]) {\n            return {\n              additionalUsers: {\n                ...state.additionalUsers,\n                [login]: {\n                  ...state.additionalUsers[login],\n                  password: newPassword\n                }\n              }\n            };\n          }\n          return state;\n        });\n      },\n\n      updateUserProfile: (login: string, updates: Partial<User>) => {\n        set((state) => {\n          if (state.additionalUsers[login]) {\n            return {\n              additionalUsers: {\n                ...state.additionalUsers,\n                [login]: {\n                  ...state.additionalUsers[login],\n                  user: { ...state.additionalUsers[login].user, ...updates }\n                }\n              }\n            };\n          }\n          // Also update current user if it's themselves\n          if (state.user?.login === login) {\n            return { user: { ...state.user, ...updates } };\n          }\n          return state;\n        });\n      },\n\n      getUserPassword: (login: string) => {\n        const state = get();\n        return state.additionalUsers[login]?.password || null;\n      },\n    }),\n    {\n      name: 'uk-auth-storage',\n      version: 3, // Increment to fix token/user.id mismatch\n      partialize: (state) => ({\n        user: state.user,\n        token: state.token,\n        // Do NOT persist additionalUsers - all users should come from API\n        // This ensures data is consistent across all browsers/devices\n      }),\n      // Sync token to localStorage when store is rehydrated (e.g., page refresh)\n      onRehydrateStorage: () => (state, error) => {\n        if (error) {\n          console.error('Rehydrate error:', error);\n          return;\n        }\n        if (state?.user?.id) {\n          // CRITICAL FIX: Ensure token always matches user.id\n          // This fixes 401 errors caused by token/user.id mismatch\n          const correctToken = state.user.id;\n          if (state.token !== correctToken) {\n            console.warn('Token mismatch detected, fixing...', {\n              oldToken: state.token,\n              newToken: correctToken\n            });\n            state.token = correctToken;\n          }\n          localStorage.setItem('auth_token', correctToken);\n          console.log('Token synced to localStorage on rehydrate:', correctToken);\n        } else if (state?.token) {\n          // No user but have token - clear it to avoid stale state\n          console.warn('Token exists but no user, clearing auth state');\n          localStorage.removeItem('auth_token');\n          state.token = null;\n        }\n      },\n    }\n  )\n);\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type {\n  BuildingFull,\n  BuildingDocument,\n  Entrance,\n  Apartment,\n  Meter,\n  MeterReading,\n  Owner,\n  Resident,\n  PersonalAccount,\n} from '../types';\nimport { buildingsApi, entrancesApi, buildingDocumentsApi, apartmentsApi, ownersApi, personalAccountsApi, crmResidentsApi, metersApi, meterReadingsApi } from '../services/api';\n\ninterface CRMState {\n  // Data\n  buildings: BuildingFull[];\n  entrances: Entrance[];\n  apartments: Apartment[];\n  meters: Meter[];\n  meterReadings: MeterReading[];\n  owners: Owner[];\n  residents: Resident[];\n  personalAccounts: PersonalAccount[];\n\n  // Loading states\n  isLoadingBuildings: boolean;\n  isLoadingEntrances: boolean;\n  isLoadingApartments: boolean;\n  isLoadingOwners: boolean;\n  isLoadingAccounts: boolean;\n  isLoadingResidents: boolean;\n  isLoadingMeters: boolean;\n\n  // API-driven building actions\n  fetchBuildings: () => Promise<void>;\n  fetchBuildingById: (id: string) => Promise<{ building: BuildingFull; entrances: Entrance[]; documents: BuildingDocument[] } | null>;\n  addBuilding: (building: Omit<BuildingFull, 'id' | 'createdAt' | 'updatedAt' | 'documents'>) => Promise<BuildingFull | null>;\n  updateBuilding: (id: string, data: Partial<BuildingFull>) => Promise<void>;\n  deleteBuilding: (id: string) => Promise<void>;\n  getBuildingById: (id: string) => BuildingFull | undefined;\n  getBuildingWithStats: (id: string) => BuildingFull | undefined;\n\n  // API-driven building document actions\n  addBuildingDocument: (buildingId: string, doc: Omit<BuildingDocument, 'id' | 'buildingId' | 'uploadedAt'>) => Promise<void>;\n  deleteBuildingDocument: (buildingId: string, docId: string) => Promise<void>;\n\n  // API-driven entrance actions\n  fetchEntrancesByBuilding: (buildingId: string) => Promise<Entrance[]>;\n  addEntrance: (entrance: Omit<Entrance, 'id'>) => Promise<Entrance | null>;\n  updateEntrance: (id: string, data: Partial<Entrance>) => Promise<void>;\n  deleteEntrance: (id: string) => Promise<void>;\n  getEntrancesByBuilding: (buildingId: string) => Entrance[];\n\n  // API-driven apartment actions\n  fetchApartmentsByBuilding: (buildingId: string, options?: { entranceId?: string; status?: string }) => Promise<Apartment[]>;\n  fetchApartmentById: (id: string) => Promise<{ apartment: Apartment; owners: Owner[]; account: PersonalAccount | null } | null>;\n  addApartment: (apartment: Omit<Apartment, 'id' | 'createdAt' | 'updatedAt' | 'meters'>) => Promise<Apartment | null>;\n  updateApartment: (id: string, data: Partial<Apartment>) => Promise<void>;\n  deleteApartment: (id: string) => Promise<void>;\n  getApartmentsByBuilding: (buildingId: string) => Apartment[];\n  getApartmentsByEntrance: (entranceId: string) => Apartment[];\n  getApartmentById: (id: string) => Apartment | undefined;\n\n  // API-driven meter actions\n  fetchMetersByApartment: (apartmentId: string, options?: { type?: string; isActive?: boolean }) => Promise<Meter[]>;\n  fetchMetersByBuilding: (buildingId: string, options?: { type?: string; isCommon?: boolean }) => Promise<Meter[]>;\n  fetchMeterById: (id: string) => Promise<{ meter: Meter; readings: MeterReading[] } | null>;\n  addMeter: (meter: Omit<Meter, 'id'>) => Promise<Meter | null>;\n  updateMeter: (id: string, data: Partial<Meter>) => Promise<void>;\n  deleteMeter: (id: string) => Promise<void>;\n  decommissionMeter: (id: string, reason?: string) => Promise<void>;\n  getMetersByApartment: (apartmentId: string) => Meter[];\n  getCommonMetersByBuilding: (buildingId: string) => Meter[];\n\n  // API-driven meter reading actions\n  fetchMeterReadings: (meterId: string, options?: { limit?: number; offset?: number }) => Promise<MeterReading[]>;\n  submitMeterReading: (meterId: string, reading: { value: number; readingDate?: string; photoUrl?: string }) => Promise<MeterReading | null>;\n  verifyMeterReading: (readingId: string, approved: boolean, rejectionReason?: string) => Promise<void>;\n  getMeterReadings: (meterId: string) => MeterReading[];\n  getLastReading: (meterId: string) => MeterReading | undefined;\n\n  // API-driven owner actions\n  fetchOwners: (options?: { type?: string; search?: string }) => Promise<Owner[]>;\n  fetchOwnerById: (id: string) => Promise<{ owner: Owner; apartments: Apartment[] } | null>;\n  addOwner: (owner: Omit<Owner, 'id' | 'createdAt' | 'updatedAt' | 'tags'>) => Promise<Owner | null>;\n  updateOwner: (id: string, data: Partial<Owner>) => Promise<void>;\n  deleteOwner: (id: string) => Promise<void>;\n  linkOwnerToApartment: (ownerId: string, apartmentId: string, data?: { ownershipShare?: number; isPrimary?: boolean }) => Promise<void>;\n  unlinkOwnerFromApartment: (ownerId: string, apartmentId: string) => Promise<void>;\n  getOwnerById: (id: string) => Owner | undefined;\n  getOwnersByApartment: (apartmentId: string) => Owner[];\n  searchOwners: (query: string) => Owner[];\n\n  // API-driven resident actions\n  fetchResidentsByApartment: (apartmentId: string, options?: { isActive?: boolean }) => Promise<Resident[]>;\n  fetchResidentById: (id: string) => Promise<Resident | null>;\n  addResident: (apartmentId: string, resident: Omit<Resident, 'id' | 'createdAt'>) => Promise<Resident | null>;\n  updateResident: (id: string, data: Partial<Resident>) => Promise<void>;\n  deleteResident: (id: string) => Promise<void>;\n  moveOutResident: (id: string, data: { movedOutDate?: string; reason?: string }) => Promise<void>;\n  getResidentsByApartment: (apartmentId: string) => Resident[];\n\n  // API-driven personal account actions\n  fetchAccountsByBuilding: (buildingId: string, options?: { status?: string; hasDebt?: boolean }) => Promise<PersonalAccount[]>;\n  addPersonalAccount: (account: Omit<PersonalAccount, 'id' | 'createdAt' | 'updatedAt'>) => Promise<PersonalAccount | null>;\n  updatePersonalAccount: (id: string, data: Partial<PersonalAccount>) => Promise<void>;\n  getPersonalAccountById: (id: string) => PersonalAccount | undefined;\n  getPersonalAccountByApartment: (apartmentId: string) => PersonalAccount | undefined;\n  getPersonalAccountsByBuilding: (buildingId: string) => PersonalAccount[];\n  fetchDebtors: (options?: { minDebt?: number; buildingId?: string }) => Promise<PersonalAccount[]>;\n  getDebtors: (minDebt?: number) => PersonalAccount[];\n\n  // Stats\n  getBuildingStats: () => {\n    totalBuildings: number;\n    totalApartments: number;\n    totalResidents: number;\n    totalOwners: number;\n    totalDebt: number;\n    avgCollectionRate: number;\n  };\n}\n\n// Helper to map API response to frontend type\nconst mapBuildingFromApi = (b: any): BuildingFull => ({\n  id: b.id,\n  name: b.name,\n  address: b.address,\n  zone: b.zone,\n  cadastralNumber: b.cadastral_number,\n  branchCode: b.branch_code,\n  buildingNumber: b.building_number,\n  floors: b.floors || 0,\n  entrances: b.entrances_count || 0,\n  totalApartments: b.apartments_count || 0,\n  totalArea: b.total_area || 0,\n  livingArea: b.living_area || 0,\n  commonArea: b.common_area || 0,\n  landArea: b.land_area,\n  yearBuilt: b.year_built || 0,\n  yearRenovated: b.year_renovated,\n  buildingType: b.building_type || 'monolith',\n  roofType: b.roof_type || 'flat',\n  wallMaterial: b.wall_material || '',\n  foundationType: b.foundation_type || '',\n  hasElevator: !!b.has_elevator,\n  elevatorCount: b.elevator_count || 0,\n  hasGas: !!b.has_gas,\n  heatingType: b.heating_type || 'central',\n  hasHotWater: !!b.has_hot_water,\n  waterSupplyType: b.water_supply_type || 'central',\n  sewerageType: b.sewerage_type || 'central',\n  hasIntercom: !!b.has_intercom,\n  hasVideoSurveillance: !!b.has_video_surveillance,\n  hasConcierge: !!b.has_concierge,\n  hasParkingLot: !!b.has_parking_lot,\n  parkingSpaces: b.parking_spaces || 0,\n  hasPlayground: !!b.has_playground,\n  managerId: b.manager_id,\n  managerName: b.manager_name,\n  managementStartDate: b.management_start_date,\n  contractNumber: b.contract_number,\n  contractEndDate: b.contract_end_date,\n  monthlyBudget: b.monthly_budget || 0,\n  reserveFund: b.reserve_fund || 0,\n  totalDebt: b.total_debt || 0,\n  collectionRate: b.collection_rate || 0,\n  residentsCount: b.residents_count || 0,\n  ownersCount: b.owners_count || 0,\n  tenantsCount: b.tenants_count || 0,\n  vacantApartments: b.vacant_apartments || 0,\n  activeRequestsCount: b.active_requests_count || 0,\n  documents: [],\n  createdAt: b.created_at,\n  updatedAt: b.updated_at,\n});\n\nconst mapEntranceFromApi = (e: any): Entrance => ({\n  id: e.id,\n  buildingId: e.building_id,\n  number: e.number,\n  floorsFrom: e.floors_from || 1,\n  floorsTo: e.floors_to,\n  apartmentsFrom: e.apartments_from,\n  apartmentsTo: e.apartments_to,\n  hasElevator: !!e.has_elevator,\n  elevatorId: e.elevator_id,\n  intercomType: e.intercom_type,\n  intercomCode: e.intercom_code,\n  cleaningSchedule: e.cleaning_schedule,\n  responsibleId: e.responsible_id,\n  lastInspection: e.last_inspection,\n  notes: e.notes,\n});\n\nconst mapApartmentFromApi = (a: any): Apartment => ({\n  id: a.id,\n  buildingId: a.building_id,\n  entranceId: a.entrance_id,\n  number: a.number,\n  floor: a.floor || 1,\n  rooms: a.rooms || 1,\n  totalArea: a.total_area || 0,\n  livingArea: a.living_area || 0,\n  kitchenArea: a.kitchen_area,\n  balconyArea: a.balcony_area,\n  loggiaArea: a.loggia_area,\n  ceilingHeight: a.ceiling_height,\n  hasBalcony: !!a.has_balcony,\n  hasLoggia: !!a.has_loggia,\n  hasStorage: !!a.has_storage,\n  hasParking: !!a.has_parking,\n  parkingNumber: a.parking_number,\n  ownershipType: a.ownership_type || 'private',\n  ownershipShare: a.ownership_share,\n  registrationNumber: a.registration_number,\n  registrationDate: a.registration_date,\n  status: a.status || 'occupied',\n  isCommercial: !!a.is_commercial,\n  commercialType: a.commercial_type,\n  meters: [],\n  personalAccountId: a.personal_account_id,\n  primaryOwnerId: a.primary_owner_id,\n  notes: a.notes,\n  createdAt: a.created_at,\n  updatedAt: a.updated_at,\n});\n\nconst mapOwnerFromApi = (o: any): Owner => ({\n  id: o.id,\n  type: o.type || 'individual',\n  lastName: o.last_name,\n  firstName: o.first_name,\n  middleName: o.middle_name,\n  fullName: o.full_name,\n  companyName: o.company_name,\n  inn: o.inn,\n  kpp: o.kpp,\n  ogrn: o.ogrn,\n  legalAddress: o.legal_address,\n  directorName: o.director_name,\n  passportSeries: o.passport_series,\n  passportNumber: o.passport_number,\n  passportIssuedBy: o.passport_issued_by,\n  passportIssuedDate: o.passport_issued_date,\n  birthDate: o.birth_date,\n  birthPlace: o.birth_place,\n  registrationAddress: o.registration_address,\n  actualAddress: o.actual_address,\n  phone: o.phone,\n  additionalPhone: o.additional_phone,\n  email: o.email,\n  preferredContact: o.preferred_contact || 'phone',\n  ownershipType: o.ownership_type || 'owner',\n  ownershipShare: o.ownership_share || 100,\n  ownershipDocument: o.ownership_document,\n  ownershipDocumentDate: o.ownership_document_date,\n  apartmentIds: o.apartment_ids ? JSON.parse(o.apartment_ids) : [],\n  personalAccountIds: o.personal_account_ids ? JSON.parse(o.personal_account_ids) : [],\n  isActive: o.is_active !== false && o.is_active !== 0,\n  isVerified: !!o.is_verified,\n  verifiedAt: o.verified_at,\n  verifiedBy: o.verified_by,\n  bankName: o.bank_name,\n  bankBik: o.bank_bik,\n  bankAccount: o.bank_account,\n  tags: o.tags ? JSON.parse(o.tags) : [],\n  notes: o.notes,\n  createdAt: o.created_at,\n  updatedAt: o.updated_at,\n});\n\nconst mapAccountFromApi = (a: any): PersonalAccount => ({\n  id: a.id,\n  number: a.number,\n  apartmentId: a.apartment_id,\n  buildingId: a.building_id,\n  primaryOwnerId: a.primary_owner_id,\n  ownerName: a.owner_name,\n  apartmentNumber: a.apartment_number,\n  address: a.address,\n  totalArea: a.total_area || 0,\n  residentsCount: a.residents_count || 0,\n  registeredCount: a.registered_count || 0,\n  balance: a.balance || 0,\n  currentDebt: a.current_debt || 0,\n  penaltyAmount: a.penalty_amount || 0,\n  lastPaymentDate: a.last_payment_date,\n  lastPaymentAmount: a.last_payment_amount,\n  lastChargeDate: a.last_charge_date,\n  lastChargeAmount: a.last_charge_amount,\n  tariffPlanId: a.tariff_plan_id,\n  hasSubsidy: !!a.has_subsidy,\n  subsidyPercent: a.subsidy_percent,\n  subsidyEndDate: a.subsidy_end_date,\n  hasDiscount: !!a.has_discount,\n  discountPercent: a.discount_percent,\n  discountReason: a.discount_reason,\n  status: a.status || 'active',\n  closedAt: a.closed_at,\n  closedReason: a.closed_reason,\n  notes: a.notes,\n  createdAt: a.created_at,\n  updatedAt: a.updated_at,\n});\n\nconst mapMeterFromApi = (m: any): Meter => ({\n  id: m.id,\n  apartmentId: m.apartment_id,\n  buildingId: m.building_id,\n  type: m.type,\n  serialNumber: m.serial_number,\n  model: m.model,\n  brand: m.brand,\n  installDate: m.install_date,\n  verificationDate: m.verification_date,\n  nextVerificationDate: m.next_verification_date,\n  sealNumber: m.seal_number,\n  location: m.install_location,\n  initialValue: m.initial_value || 0,\n  currentValue: m.current_value || 0,\n  lastReadingDate: m.last_reading_date,\n  isActive: m.is_active !== false && m.is_active !== 0,\n  isCommon: !!m.is_common,\n  tariffZone: m.tariff_zone,\n  notes: m.notes,\n  createdAt: m.created_at,\n  updatedAt: m.updated_at,\n});\n\nconst mapMeterReadingFromApi = (r: any): MeterReading => ({\n  id: r.id,\n  meterId: r.meter_id,\n  value: r.value,\n  previousValue: r.previous_value,\n  consumption: r.consumption,\n  readingDate: r.reading_date,\n  source: r.source,\n  submittedBy: r.submitted_by,\n  submittedAt: r.submitted_at,\n  isVerified: !!r.is_verified,\n  verifiedBy: r.verified_by,\n  verifiedAt: r.verified_at,\n  photoUrl: r.photo_url,\n  status: r.status,\n  rejectionReason: r.rejection_reason,\n  notes: r.notes,\n  createdAt: r.created_at,\n});\n\nconst mapResidentFromApi = (r: any): Resident => ({\n  id: r.id,\n  apartmentId: r.apartment_id,\n  ownerId: r.owner_id,\n  lastName: r.last_name,\n  firstName: r.first_name,\n  middleName: r.middle_name,\n  fullName: r.full_name,\n  birthDate: r.birth_date,\n  residentType: r.resident_type || 'owner',\n  relationToOwner: r.relation_to_owner,\n  registrationType: r.registration_type || 'permanent',\n  registrationDate: r.registration_date,\n  registrationEndDate: r.registration_end_date,\n  phone: r.phone,\n  additionalPhone: r.additional_phone,\n  email: r.email,\n  isActive: r.is_active !== false && r.is_active !== 0,\n  movedInDate: r.moved_in_date,\n  movedOutDate: r.moved_out_date,\n  movedOutReason: r.moved_out_reason,\n  passportSeries: r.passport_series,\n  passportNumber: r.passport_number,\n  notes: r.notes,\n  createdAt: r.created_at,\n  updatedAt: r.updated_at,\n});\n\nexport const useCRMStore = create<CRMState>()(\n  persist(\n    (set, get) => ({\n      // Initialize with empty arrays - will be loaded from API\n      buildings: [],\n      entrances: [],\n      apartments: [],\n      meters: [],\n      meterReadings: [],\n      owners: [],\n      residents: [],\n      personalAccounts: [],\n\n      // Loading states\n      isLoadingBuildings: false,\n      isLoadingEntrances: false,\n      isLoadingApartments: false,\n      isLoadingOwners: false,\n      isLoadingAccounts: false,\n      isLoadingResidents: false,\n      isLoadingMeters: false,\n\n      // ========== API-DRIVEN BUILDING ACTIONS ==========\n\n      fetchBuildings: async () => {\n        console.log('[fetchBuildings] Starting...');\n        set({ isLoadingBuildings: true });\n        try {\n          const response = await buildingsApi.getAll();\n          console.log('[fetchBuildings] API response:', response);\n          const buildings = (response.buildings || []).map(mapBuildingFromApi);\n          console.log('[fetchBuildings] Mapped buildings:', buildings.length);\n          set({ buildings, isLoadingBuildings: false });\n        } catch (error) {\n          console.error('[fetchBuildings] Failed:', error);\n          set({ isLoadingBuildings: false });\n        }\n      },\n\n      fetchBuildingById: async (id: string) => {\n        try {\n          const response = await buildingsApi.getById(id);\n          if (!response.building) return null;\n\n          const building = mapBuildingFromApi(response.building);\n          const entrances = (response.entrances || []).map(mapEntranceFromApi);\n          const documents = response.documents || [];\n\n          // Update local state with this building's data\n          set((state) => {\n            const updatedBuildings = state.buildings.some((b) => b.id === id)\n              ? state.buildings.map((b) => (b.id === id ? { ...building, documents } : b))\n              : [...state.buildings, { ...building, documents }];\n\n            // Merge entrances (replace for this building, keep others)\n            const otherEntrances = state.entrances.filter((e) => e.buildingId !== id);\n            const updatedEntrances = [...otherEntrances, ...entrances];\n\n            return { buildings: updatedBuildings, entrances: updatedEntrances };\n          });\n\n          return { building: { ...building, documents }, entrances, documents };\n        } catch (error) {\n          console.error('Failed to fetch building:', error);\n          return null;\n        }\n      },\n\n      addBuilding: async (buildingData) => {\n        try {\n          const response = await buildingsApi.create(buildingData as any);\n          if (response.building) {\n            const newBuilding = mapBuildingFromApi(response.building);\n            set((state) => ({ buildings: [...state.buildings, newBuilding] }));\n            return newBuilding;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create building:', error);\n          return null;\n        }\n      },\n\n      updateBuilding: async (id, data) => {\n        try {\n          await buildingsApi.update(id, data as any);\n          // Optimistic update\n          set((state) => ({\n            buildings: state.buildings.map((b) =>\n              b.id === id ? { ...b, ...data, updatedAt: new Date().toISOString() } : b\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to update building:', error);\n        }\n      },\n\n      deleteBuilding: async (id) => {\n        try {\n          await buildingsApi.delete(id);\n          set((state) => ({\n            buildings: state.buildings.filter((b) => b.id !== id),\n            entrances: state.entrances.filter((e) => e.buildingId !== id),\n            apartments: state.apartments.filter((a) => a.buildingId !== id),\n            personalAccounts: state.personalAccounts.filter((p) => p.buildingId !== id),\n          }));\n        } catch (error: any) {\n          console.error('Failed to delete building:', error);\n          throw new Error(error.message || '   ');\n        }\n      },\n\n      getBuildingById: (id) => {\n        return get().buildings.find((b) => b.id === id);\n      },\n\n      getBuildingWithStats: (id) => {\n        const building = get().buildings.find((b) => b.id === id);\n        if (!building) return undefined;\n\n        const apartments = get().apartments.filter((a) => a.buildingId === id);\n        const accounts = get().personalAccounts.filter((p) => p.buildingId === id);\n        const residents = get().residents.filter((r) =>\n          apartments.some((a) => a.id === r.apartmentId)\n        );\n\n        return {\n          ...building,\n          totalApartments: apartments.length || building.totalApartments,\n          residentsCount: residents.length || building.residentsCount,\n          ownersCount: get().owners.filter((o) =>\n            o.apartmentIds.some((aId) => apartments.some((a) => a.id === aId))\n          ).length || building.ownersCount,\n          totalDebt: accounts.reduce((sum, a) => sum + a.currentDebt, 0) || building.totalDebt,\n          vacantApartments: apartments.filter((a) => a.status === 'vacant').length || building.vacantApartments,\n        };\n      },\n\n      // ========== API-DRIVEN DOCUMENT ACTIONS ==========\n\n      addBuildingDocument: async (buildingId, docData) => {\n        try {\n          const response = await buildingDocumentsApi.create(buildingId, {\n            name: docData.name,\n            type: docData.type,\n            fileUrl: docData.fileUrl,\n            fileSize: docData.fileSize,\n            expiresAt: docData.expiresAt,\n          });\n          if (response.document) {\n            // Optimistic update\n            const newDoc: BuildingDocument = {\n              ...docData,\n              id: response.document.id,\n              buildingId,\n              uploadedAt: response.document.uploaded_at || new Date().toISOString(),\n            };\n            set((state) => ({\n              buildings: state.buildings.map((b) =>\n                b.id === buildingId\n                  ? { ...b, documents: [...(b.documents || []), newDoc] }\n                  : b\n              ),\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to add document:', error);\n        }\n      },\n\n      deleteBuildingDocument: async (buildingId, docId) => {\n        try {\n          await buildingDocumentsApi.delete(docId);\n          set((state) => ({\n            buildings: state.buildings.map((b) =>\n              b.id === buildingId\n                ? { ...b, documents: (b.documents || []).filter((d) => d.id !== docId) }\n                : b\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to delete document:', error);\n        }\n      },\n\n      // ========== API-DRIVEN ENTRANCE ACTIONS ==========\n\n      fetchEntrancesByBuilding: async (buildingId: string) => {\n        set({ isLoadingEntrances: true });\n        try {\n          const response = await entrancesApi.getByBuilding(buildingId);\n          const entrances = (response.entrances || []).map(mapEntranceFromApi);\n\n          // Replace entrances for this building, keep others\n          set((state) => {\n            const otherEntrances = state.entrances.filter((e) => e.buildingId !== buildingId);\n            return { entrances: [...otherEntrances, ...entrances], isLoadingEntrances: false };\n          });\n\n          return entrances;\n        } catch (error) {\n          console.error('Failed to fetch entrances:', error);\n          set({ isLoadingEntrances: false });\n          return [];\n        }\n      },\n\n      addEntrance: async (entranceData) => {\n        try {\n          const response = await entrancesApi.create(entranceData.buildingId, {\n            number: entranceData.number,\n            floorsFrom: entranceData.floorsFrom,\n            floorsTo: entranceData.floorsTo,\n            apartmentsFrom: entranceData.apartmentsFrom,\n            apartmentsTo: entranceData.apartmentsTo,\n            hasElevator: entranceData.hasElevator,\n            elevatorId: entranceData.elevatorId,\n            intercomType: entranceData.intercomType,\n            intercomCode: entranceData.intercomCode,\n            cleaningSchedule: entranceData.cleaningSchedule,\n            responsibleId: entranceData.responsibleId,\n            notes: entranceData.notes,\n          });\n          if (response.entrance) {\n            const newEntrance = mapEntranceFromApi(response.entrance);\n            set((state) => ({ entrances: [...state.entrances, newEntrance] }));\n            return newEntrance;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create entrance:', error);\n          return null;\n        }\n      },\n\n      updateEntrance: async (id, data) => {\n        try {\n          await entrancesApi.update(id, data);\n          set((state) => ({\n            entrances: state.entrances.map((e) =>\n              e.id === id ? { ...e, ...data } : e\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to update entrance:', error);\n        }\n      },\n\n      deleteEntrance: async (id) => {\n        try {\n          await entrancesApi.delete(id);\n          set((state) => ({\n            entrances: state.entrances.filter((e) => e.id !== id),\n            apartments: state.apartments.filter((a) => a.entranceId !== id),\n          }));\n        } catch (error) {\n          console.error('Failed to delete entrance:', error);\n        }\n      },\n\n      getEntrancesByBuilding: (buildingId) => {\n        return get().entrances.filter((e) => e.buildingId === buildingId);\n      },\n\n      // ========== API-DRIVEN APARTMENT ACTIONS ==========\n\n      fetchApartmentsByBuilding: async (buildingId: string, options?: { entranceId?: string; status?: string }) => {\n        set({ isLoadingApartments: true });\n        try {\n          const response = await apartmentsApi.getByBuilding(buildingId, options);\n          const apartments = (response.apartments || []).map(mapApartmentFromApi);\n\n          // Replace apartments for this building\n          set((state) => {\n            const otherApartments = state.apartments.filter((a) => a.buildingId !== buildingId);\n            return { apartments: [...otherApartments, ...apartments], isLoadingApartments: false };\n          });\n\n          return apartments;\n        } catch (error) {\n          console.error('Failed to fetch apartments:', error);\n          set({ isLoadingApartments: false });\n          return [];\n        }\n      },\n\n      fetchApartmentById: async (id: string) => {\n        try {\n          const response = await apartmentsApi.getById(id);\n          if (!response.apartment) return null;\n\n          const apartment = mapApartmentFromApi(response.apartment);\n          const owners = (response.owners || []).map(mapOwnerFromApi);\n          const account = response.personalAccount ? mapAccountFromApi(response.personalAccount) : null;\n\n          // Update local state\n          set((state) => {\n            const updatedApartments = state.apartments.some((a) => a.id === id)\n              ? state.apartments.map((a) => (a.id === id ? apartment : a))\n              : [...state.apartments, apartment];\n\n            return { apartments: updatedApartments };\n          });\n\n          return { apartment, owners, account };\n        } catch (error) {\n          console.error('Failed to fetch apartment:', error);\n          return null;\n        }\n      },\n\n      addApartment: async (apartmentData) => {\n        try {\n          const response = await apartmentsApi.create(apartmentData.buildingId, {\n            number: apartmentData.number,\n            entranceId: apartmentData.entranceId,\n            floor: apartmentData.floor,\n            totalArea: apartmentData.totalArea,\n            livingArea: apartmentData.livingArea,\n            kitchenArea: apartmentData.kitchenArea,\n            rooms: apartmentData.rooms,\n            hasBalcony: apartmentData.hasBalcony,\n            hasLoggia: apartmentData.hasLoggia,\n            status: apartmentData.status,\n          });\n          if (response.apartment) {\n            const newApartment = mapApartmentFromApi(response.apartment);\n            set((state) => ({ apartments: [...state.apartments, newApartment] }));\n            return newApartment;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create apartment:', error);\n          return null;\n        }\n      },\n\n      updateApartment: async (id, data) => {\n        try {\n          await apartmentsApi.update(id, data as any);\n          set((state) => ({\n            apartments: state.apartments.map((a) =>\n              a.id === id ? { ...a, ...data, updatedAt: new Date().toISOString() } : a\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to update apartment:', error);\n        }\n      },\n\n      deleteApartment: async (id) => {\n        try {\n          await apartmentsApi.delete(id);\n          set((state) => ({\n            apartments: state.apartments.filter((a) => a.id !== id),\n            meters: state.meters.filter((m) => m.apartmentId !== id),\n            residents: state.residents.filter((r) => r.apartmentId !== id),\n            personalAccounts: state.personalAccounts.filter((p) => p.apartmentId !== id),\n          }));\n        } catch (error) {\n          console.error('Failed to delete apartment:', error);\n        }\n      },\n\n      getApartmentsByBuilding: (buildingId) => {\n        return get().apartments.filter((a) => a.buildingId === buildingId);\n      },\n\n      getApartmentsByEntrance: (entranceId) => {\n        return get().apartments.filter((a) => a.entranceId === entranceId);\n      },\n\n      getApartmentById: (id) => {\n        return get().apartments.find((a) => a.id === id);\n      },\n\n      // ========== API-DRIVEN METER ACTIONS ==========\n\n      fetchMetersByApartment: async (apartmentId: string, options?: { type?: string; isActive?: boolean }) => {\n        set({ isLoadingMeters: true });\n        try {\n          const response = await metersApi.getByApartment(apartmentId, options);\n          const meters = (response.meters || []).map(mapMeterFromApi);\n\n          // Replace meters for this apartment\n          set((state) => {\n            const otherMeters = state.meters.filter((m) => m.apartmentId !== apartmentId);\n            return { meters: [...otherMeters, ...meters], isLoadingMeters: false };\n          });\n\n          return meters;\n        } catch (error) {\n          console.error('Failed to fetch meters:', error);\n          set({ isLoadingMeters: false });\n          return [];\n        }\n      },\n\n      fetchMetersByBuilding: async (buildingId: string, options?: { type?: string; isCommon?: boolean }) => {\n        set({ isLoadingMeters: true });\n        try {\n          const response = await metersApi.getByBuilding(buildingId, options);\n          const meters = (response.meters || []).map(mapMeterFromApi);\n\n          // Replace building meters\n          set((state) => {\n            const otherMeters = state.meters.filter((m) => m.buildingId !== buildingId);\n            return { meters: [...otherMeters, ...meters], isLoadingMeters: false };\n          });\n\n          return meters;\n        } catch (error) {\n          console.error('Failed to fetch building meters:', error);\n          set({ isLoadingMeters: false });\n          return [];\n        }\n      },\n\n      fetchMeterById: async (id: string) => {\n        try {\n          const response = await metersApi.getById(id);\n          if (!response.meter) return null;\n\n          const meter = mapMeterFromApi(response.meter);\n          const readings = (response.readings || []).map(mapMeterReadingFromApi);\n\n          // Update local state\n          set((state) => {\n            const updatedMeters = state.meters.some((m) => m.id === id)\n              ? state.meters.map((m) => (m.id === id ? meter : m))\n              : [...state.meters, meter];\n\n            // Replace readings for this meter\n            const otherReadings = state.meterReadings.filter((r) => r.meterId !== id);\n            return { meters: updatedMeters, meterReadings: [...otherReadings, ...readings] };\n          });\n\n          return { meter, readings };\n        } catch (error) {\n          console.error('Failed to fetch meter:', error);\n          return null;\n        }\n      },\n\n      addMeter: async (meterData) => {\n        try {\n          const response = await metersApi.create({\n            apartmentId: meterData.apartmentId,\n            buildingId: meterData.buildingId,\n            type: meterData.type as any,\n            isCommon: meterData.isCommon,\n            serialNumber: meterData.serialNumber,\n            model: meterData.model,\n            brand: meterData.brand,\n            installDate: meterData.installDate,\n            location: meterData.location,\n            initialValue: meterData.initialValue,\n            verificationDate: meterData.verificationDate,\n            nextVerificationDate: meterData.nextVerificationDate,\n            sealNumber: meterData.sealNumber,\n          });\n          if (response.meter) {\n            const newMeter = mapMeterFromApi(response.meter);\n            set((state) => ({ meters: [...state.meters, newMeter] }));\n            return newMeter;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create meter:', error);\n          return null;\n        }\n      },\n\n      updateMeter: async (id, data) => {\n        try {\n          await metersApi.update(id, data as any);\n          set((state) => ({\n            meters: state.meters.map((m) =>\n              m.id === id ? { ...m, ...data, updatedAt: new Date().toISOString() } : m\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to update meter:', error);\n        }\n      },\n\n      deleteMeter: async (id) => {\n        try {\n          await metersApi.delete(id);\n          set((state) => ({\n            meters: state.meters.filter((m) => m.id !== id),\n            meterReadings: state.meterReadings.filter((r) => r.meterId !== id),\n          }));\n        } catch (error) {\n          console.error('Failed to delete meter:', error);\n        }\n      },\n\n      decommissionMeter: async (id, reason) => {\n        try {\n          await metersApi.decommission(id, reason);\n          set((state) => ({\n            meters: state.meters.map((m) =>\n              m.id === id ? { ...m, isActive: false } : m\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to decommission meter:', error);\n        }\n      },\n\n      getMetersByApartment: (apartmentId) => {\n        return get().meters.filter((m) => m.apartmentId === apartmentId);\n      },\n\n      getCommonMetersByBuilding: (buildingId) => {\n        return get().meters.filter((m) => m.buildingId === buildingId && m.isCommon);\n      },\n\n      // ========== API-DRIVEN METER READING ACTIONS ==========\n\n      fetchMeterReadings: async (meterId: string, options?: { limit?: number; offset?: number }) => {\n        try {\n          const response = await meterReadingsApi.getByMeter(meterId, options);\n          const readings = (response.readings || []).map(mapMeterReadingFromApi);\n\n          // Replace readings for this meter\n          set((state) => {\n            const otherReadings = state.meterReadings.filter((r) => r.meterId !== meterId);\n            return { meterReadings: [...otherReadings, ...readings] };\n          });\n\n          return readings;\n        } catch (error) {\n          console.error('Failed to fetch meter readings:', error);\n          return [];\n        }\n      },\n\n      submitMeterReading: async (meterId, readingData) => {\n        try {\n          const response = await meterReadingsApi.submit(meterId, readingData);\n          if (response.reading) {\n            const newReading = mapMeterReadingFromApi(response.reading);\n\n            // Update meter's current value and add reading to state\n            set((state) => ({\n              meterReadings: [...state.meterReadings, newReading],\n              meters: state.meters.map((m) =>\n                m.id === meterId\n                  ? {\n                      ...m,\n                      currentValue: readingData.value,\n                      lastReadingDate: readingData.readingDate || new Date().toISOString().split('T')[0],\n                    }\n                  : m\n              ),\n            }));\n\n            return newReading;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to submit meter reading:', error);\n          return null;\n        }\n      },\n\n      verifyMeterReading: async (readingId, approved, rejectionReason) => {\n        try {\n          await meterReadingsApi.verify(readingId, { approved, rejectionReason });\n\n          set((state) => ({\n            meterReadings: state.meterReadings.map((r) =>\n              r.id === readingId\n                ? { ...r, isVerified: approved, status: approved ? 'approved' : 'rejected', rejectionReason }\n                : r\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to verify meter reading:', error);\n        }\n      },\n\n      getMeterReadings: (meterId) => {\n        return get()\n          .meterReadings.filter((r) => r.meterId === meterId)\n          .sort((a, b) => new Date(b.readingDate).getTime() - new Date(a.readingDate).getTime());\n      },\n\n      getLastReading: (meterId) => {\n        const readings = get().getMeterReadings(meterId);\n        return readings.length > 0 ? readings[0] : undefined;\n      },\n\n      // ========== API-DRIVEN OWNER ACTIONS ==========\n\n      fetchOwners: async (options?: { type?: string; search?: string }) => {\n        set({ isLoadingOwners: true });\n        try {\n          const response = await ownersApi.getAll(options);\n          const owners = (response.owners || []).map(mapOwnerFromApi);\n          set({ owners, isLoadingOwners: false });\n          return owners;\n        } catch (error) {\n          console.error('Failed to fetch owners:', error);\n          set({ isLoadingOwners: false });\n          return [];\n        }\n      },\n\n      fetchOwnerById: async (id: string) => {\n        try {\n          const response = await ownersApi.getById(id);\n          if (!response.owner) return null;\n\n          const owner = mapOwnerFromApi(response.owner);\n          const apartments = (response.apartments || []).map(mapApartmentFromApi);\n\n          // Update local state\n          set((state) => {\n            const updatedOwners = state.owners.some((o) => o.id === id)\n              ? state.owners.map((o) => (o.id === id ? owner : o))\n              : [...state.owners, owner];\n            return { owners: updatedOwners };\n          });\n\n          return { owner, apartments };\n        } catch (error) {\n          console.error('Failed to fetch owner:', error);\n          return null;\n        }\n      },\n\n      addOwner: async (ownerData) => {\n        try {\n          const response = await ownersApi.create({\n            type: ownerData.type,\n            lastName: ownerData.lastName,\n            firstName: ownerData.firstName,\n            middleName: ownerData.middleName,\n            fullName: ownerData.fullName,\n            phone: ownerData.phone,\n            email: ownerData.email,\n            ownershipType: ownerData.ownershipType,\n            ownershipShare: ownerData.ownershipShare,\n          });\n          if (response.owner) {\n            const newOwner = mapOwnerFromApi(response.owner);\n            set((state) => ({ owners: [...state.owners, newOwner] }));\n            return newOwner;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create owner:', error);\n          return null;\n        }\n      },\n\n      updateOwner: async (id, data) => {\n        try {\n          await ownersApi.update(id, data as any);\n          set((state) => ({\n            owners: state.owners.map((o) =>\n              o.id === id ? { ...o, ...data, updatedAt: new Date().toISOString() } : o\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to update owner:', error);\n        }\n      },\n\n      deleteOwner: async (id) => {\n        try {\n          await ownersApi.delete(id);\n          set((state) => ({\n            owners: state.owners.filter((o) => o.id !== id),\n          }));\n        } catch (error) {\n          console.error('Failed to delete owner:', error);\n        }\n      },\n\n      linkOwnerToApartment: async (ownerId, apartmentId, data) => {\n        try {\n          await ownersApi.linkToApartment(ownerId, apartmentId, data);\n          // Update local state - add apartment to owner's apartmentIds\n          set((state) => ({\n            owners: state.owners.map((o) =>\n              o.id === ownerId\n                ? { ...o, apartmentIds: [...(o.apartmentIds || []), apartmentId] }\n                : o\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to link owner to apartment:', error);\n        }\n      },\n\n      unlinkOwnerFromApartment: async (ownerId, apartmentId) => {\n        try {\n          await ownersApi.unlinkFromApartment(ownerId, apartmentId);\n          set((state) => ({\n            owners: state.owners.map((o) =>\n              o.id === ownerId\n                ? { ...o, apartmentIds: (o.apartmentIds || []).filter((id) => id !== apartmentId) }\n                : o\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to unlink owner from apartment:', error);\n        }\n      },\n\n      getOwnerById: (id) => {\n        return get().owners.find((o) => o.id === id);\n      },\n\n      getOwnersByApartment: (apartmentId) => {\n        return get().owners.filter((o) => o.apartmentIds?.includes(apartmentId));\n      },\n\n      searchOwners: (query) => {\n        const lowerQuery = query.toLowerCase();\n        return get().owners.filter(\n          (o) =>\n            o.fullName?.toLowerCase().includes(lowerQuery) ||\n            o.phone?.includes(query) ||\n            o.email?.toLowerCase().includes(lowerQuery)\n        );\n      },\n\n      // ========== API-DRIVEN RESIDENT ACTIONS ==========\n\n      fetchResidentsByApartment: async (apartmentId: string, options?: { isActive?: boolean }) => {\n        set({ isLoadingResidents: true });\n        try {\n          const response = await crmResidentsApi.getByApartment(apartmentId, options);\n          const residents = (response.residents || []).map(mapResidentFromApi);\n\n          // Replace residents for this apartment\n          set((state) => {\n            const otherResidents = state.residents.filter((r) => r.apartmentId !== apartmentId);\n            return { residents: [...otherResidents, ...residents], isLoadingResidents: false };\n          });\n\n          return residents;\n        } catch (error) {\n          console.error('Failed to fetch residents:', error);\n          set({ isLoadingResidents: false });\n          return [];\n        }\n      },\n\n      fetchResidentById: async (id: string) => {\n        try {\n          const response = await crmResidentsApi.getById(id);\n          if (!response.resident) return null;\n\n          const resident = mapResidentFromApi(response.resident);\n\n          // Update local state\n          set((state) => {\n            const updatedResidents = state.residents.some((r) => r.id === id)\n              ? state.residents.map((r) => (r.id === id ? resident : r))\n              : [...state.residents, resident];\n            return { residents: updatedResidents };\n          });\n\n          return resident;\n        } catch (error) {\n          console.error('Failed to fetch resident:', error);\n          return null;\n        }\n      },\n\n      addResident: async (apartmentId, residentData) => {\n        try {\n          const response = await crmResidentsApi.create(apartmentId, {\n            lastName: residentData.lastName,\n            firstName: residentData.firstName,\n            middleName: residentData.middleName,\n            fullName: residentData.fullName,\n            birthDate: residentData.birthDate,\n            residentType: residentData.residentType,\n            relationToOwner: residentData.relationToOwner,\n            registrationType: residentData.registrationType,\n            registrationDate: residentData.registrationDate,\n            phone: residentData.phone,\n            email: residentData.email,\n            movedInDate: residentData.movedInDate,\n            ownerId: residentData.ownerId,\n          });\n          if (response.resident) {\n            const newResident = mapResidentFromApi(response.resident);\n            set((state) => ({ residents: [...state.residents, newResident] }));\n            return newResident;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create resident:', error);\n          return null;\n        }\n      },\n\n      updateResident: async (id, data) => {\n        try {\n          await crmResidentsApi.update(id, data as any);\n          set((state) => ({\n            residents: state.residents.map((r) =>\n              r.id === id ? { ...r, ...data, updatedAt: new Date().toISOString() } : r\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to update resident:', error);\n        }\n      },\n\n      deleteResident: async (id) => {\n        try {\n          await crmResidentsApi.delete(id);\n          set((state) => ({\n            residents: state.residents.filter((r) => r.id !== id),\n          }));\n        } catch (error) {\n          console.error('Failed to delete resident:', error);\n        }\n      },\n\n      moveOutResident: async (id, data) => {\n        try {\n          await crmResidentsApi.moveOut(id, data);\n          set((state) => ({\n            residents: state.residents.map((r) =>\n              r.id === id ? { ...r, isActive: false, movedOutDate: data.movedOutDate, movedOutReason: data.reason } : r\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to move out resident:', error);\n        }\n      },\n\n      getResidentsByApartment: (apartmentId) => {\n        return get().residents.filter((r) => r.apartmentId === apartmentId);\n      },\n\n      // ========== API-DRIVEN PERSONAL ACCOUNT ACTIONS ==========\n\n      fetchAccountsByBuilding: async (buildingId: string, options?: { status?: string; hasDebt?: boolean }) => {\n        set({ isLoadingAccounts: true });\n        try {\n          const response = await personalAccountsApi.getByBuilding(buildingId, options);\n          const accounts = (response.accounts || []).map(mapAccountFromApi);\n\n          // Replace accounts for this building\n          set((state) => {\n            const otherAccounts = state.personalAccounts.filter((a) => a.buildingId !== buildingId);\n            return { personalAccounts: [...otherAccounts, ...accounts], isLoadingAccounts: false };\n          });\n\n          return accounts;\n        } catch (error) {\n          console.error('Failed to fetch accounts:', error);\n          set({ isLoadingAccounts: false });\n          return [];\n        }\n      },\n\n      addPersonalAccount: async (accountData) => {\n        try {\n          const response = await personalAccountsApi.create({\n            apartmentId: accountData.apartmentId,\n            buildingId: accountData.buildingId,\n            primaryOwnerId: accountData.primaryOwnerId,\n            ownerName: accountData.ownerName,\n            apartmentNumber: accountData.apartmentNumber,\n            totalArea: accountData.totalArea,\n            residentsCount: accountData.residentsCount,\n            balance: accountData.balance,\n            currentDebt: accountData.currentDebt,\n          });\n          if (response.account) {\n            const newAccount = mapAccountFromApi(response.account);\n            set((state) => ({ personalAccounts: [...state.personalAccounts, newAccount] }));\n            return newAccount;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create account:', error);\n          return null;\n        }\n      },\n\n      updatePersonalAccount: async (id, data) => {\n        try {\n          await personalAccountsApi.update(id, data as any);\n          set((state) => ({\n            personalAccounts: state.personalAccounts.map((a) =>\n              a.id === id ? { ...a, ...data, updatedAt: new Date().toISOString() } : a\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to update account:', error);\n        }\n      },\n\n      getPersonalAccountById: (id) => {\n        return get().personalAccounts.find((a) => a.id === id);\n      },\n\n      getPersonalAccountByApartment: (apartmentId) => {\n        return get().personalAccounts.find((a) => a.apartmentId === apartmentId);\n      },\n\n      getPersonalAccountsByBuilding: (buildingId) => {\n        return get().personalAccounts.filter((a) => a.buildingId === buildingId);\n      },\n\n      fetchDebtors: async (options?: { minDebt?: number; buildingId?: string }) => {\n        try {\n          const response = await personalAccountsApi.getDebtors(options);\n          return (response.debtors || []).map(mapAccountFromApi);\n        } catch (error) {\n          console.error('Failed to fetch debtors:', error);\n          return [];\n        }\n      },\n\n      getDebtors: (minDebt = 0) => {\n        return get()\n          .personalAccounts.filter((a) => a.currentDebt > minDebt)\n          .sort((a, b) => b.currentDebt - a.currentDebt);\n      },\n\n      // Stats\n      getBuildingStats: () => {\n        const { buildings, apartments, residents, owners, personalAccounts } = get();\n        const totalDebt = personalAccounts.reduce((sum, a) => sum + a.currentDebt, 0);\n        const totalCollectionRates = buildings.reduce((sum, b) => sum + b.collectionRate, 0);\n\n        return {\n          totalBuildings: buildings.length,\n          totalApartments: apartments.length,\n          totalResidents: residents.length,\n          totalOwners: owners.length,\n          totalDebt,\n          avgCollectionRate: buildings.length > 0 ? totalCollectionRates / buildings.length : 0,\n        };\n      },\n    }),\n    {\n      name: 'uk-crm-storage',\n      version: 4, // Increment to clear old cache - all data now comes from API\n      // Do NOT persist data that should come from API\n      // Only persist UI state if needed\n      partialize: () => ({\n        // All data now loaded from API - no local caching\n        // This ensures data is consistent across all browsers/devices\n      }),\n      // Migration to add branchCode and fix duplicate IDs\n      migrate: (persistedState: unknown, _version: number) => {\n        const state = persistedState as Partial<CRMState>;\n\n        // Helper function to extract building number from address\n        // Supports: \"8-\", \" 8\", \". 8\", \"8B-\", etc.\n        const extractBuildingFromAddress = (address: string): string => {\n          if (!address) return '';\n\n          // Uzbek format: \"8-\" or \" 8\"\n          const uzMatch = address.match(/(\\d+[--A-Za-z]?)-|\\s*(\\d+[--A-Za-z]?)/i);\n          if (uzMatch) {\n            const num = (uzMatch[1] || uzMatch[2]).toUpperCase();\n            // Convert Cyrillic to Latin:  -> B,  -> A\n            return num.replace(//gi, 'B').replace(//gi, 'A');\n          }\n\n          // Russian format: \" 8\", \". 8\"\n          const ruMatch = address.match(/(?:|\\.?)\\s*(\\d+[--A-Za-z]?)/i);\n          if (ruMatch) {\n            const num = ruMatch[1].toUpperCase();\n            return num.replace(//gi, 'B').replace(//gi, 'A');\n          }\n\n          return '';\n        };\n\n        if (state.buildings) {\n          // Ensure each building has unique ID, branchCode and buildingNumber\n          const seenIds = new Set<string>();\n          state.buildings = state.buildings.map((building, index) => {\n            let updatedBuilding = { ...building };\n\n            // Fix duplicate or missing IDs\n            if (!updatedBuilding.id || seenIds.has(updatedBuilding.id)) {\n              updatedBuilding.id = `building_${Date.now()}_${index}`;\n            }\n            seenIds.add(updatedBuilding.id);\n\n            // Add branchCode if missing\n            if (!updatedBuilding.branchCode) {\n              updatedBuilding.branchCode = updatedBuilding.name?.includes('') ? 'YS' :\n                                           updatedBuilding.name?.includes('') ? 'CH' :\n                                           updatedBuilding.name?.includes('') ? 'SR' :\n                                           'YS';\n            }\n\n            // Add buildingNumber if missing - try to extract from address first\n            if (!updatedBuilding.buildingNumber) {\n              const extractedNumber = extractBuildingFromAddress(updatedBuilding.address || '');\n              updatedBuilding.buildingNumber = extractedNumber || `${index + 1}A`;\n            }\n\n            return updatedBuilding;\n          });\n        }\n        return state as CRMState;\n      },\n    }\n  )\n);\n","// Browser Push Notifications Service with Web Push API\nimport { apiRequest } from './api';\n\nexport type PushNotificationType =\n  | 'request_completed'      //   -  \n  | 'announcement_urgent'    //    \n  | 'announcement_meeting'   //  \n  | 'request_assigned'       //   \n  | 'request_started'        //  \n  | 'chat_message'           //    \n  | 'meeting'                // /\n  | 'announcement';          // \n\ninterface PushNotificationOptions {\n  title: string;\n  body: string;\n  icon?: string;\n  tag?: string;\n  requireInteraction?: boolean; //   \n  data?: {\n    url?: string;\n    requestId?: string;\n    announcementId?: string;\n    channelId?: string;\n    meetingId?: string;\n    type?: PushNotificationType;\n    priority?: 'low' | 'normal' | 'urgent';\n  };\n}\n\n// VAPID public key for Web Push (must match server's public key)\nconst VAPID_PUBLIC_KEY = 'BMTJw9s4vAY9Bzb05L8--r0XUDirigcJ0_yTTGuCLZL2uk8693U82ef7LLlWyLf9T-3PucveTAjYS_I36uv7RY4';\n\n// Convert VAPID key to Uint8Array (for applicationServerKey)\nfunction urlBase64ToUint8Array(base64String: string): ArrayBuffer {\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray.buffer;\n}\n\nclass PushNotificationService {\n  private permission: NotificationPermission = 'default';\n  private swRegistration: ServiceWorkerRegistration | null = null;\n  private pushSubscription: PushSubscription | null = null;\n\n  constructor() {\n    if ('Notification' in window) {\n      this.permission = Notification.permission;\n    }\n    this.initServiceWorker();\n  }\n\n  // Initialize service worker connection\n  private async initServiceWorker(): Promise<void> {\n    if ('serviceWorker' in navigator) {\n      try {\n        this.swRegistration = await navigator.serviceWorker.ready;\n        console.log('[Push] Service Worker ready');\n\n        // Check existing subscription\n        this.pushSubscription = await this.swRegistration.pushManager.getSubscription();\n        if (this.pushSubscription) {\n          console.log('[Push] Existing subscription found');\n        }\n      } catch (error) {\n        console.error('[Push] Service Worker init failed:', error);\n      }\n    }\n  }\n\n  //   \n  isSupported(): boolean {\n    return 'Notification' in window && 'serviceWorker' in navigator && 'PushManager' in window;\n  }\n\n  //     \n  isBrowserNotificationsSupported(): boolean {\n    return 'Notification' in window;\n  }\n\n  //   \n  getPermission(): NotificationPermission {\n    return this.permission;\n  }\n\n  // ,     push\n  isSubscribed(): boolean {\n    return this.pushSubscription !== null;\n  }\n\n  //    \n  async requestPermission(): Promise<boolean> {\n    if (!this.isBrowserNotificationsSupported()) {\n      console.warn('Push notifications are not supported in this browser');\n      return false;\n    }\n\n    try {\n      const permission = await Notification.requestPermission();\n      this.permission = permission;\n      return permission === 'granted';\n    } catch (error) {\n      console.error('Failed to request notification permission:', error);\n      return false;\n    }\n  }\n\n  //   Web Push \n  async subscribe(): Promise<PushSubscription | null> {\n    console.log('[Push] Starting subscription process...');\n    console.log('[Push] isSupported:', this.isSupported());\n    console.log('[Push] Permission:', this.permission);\n\n    if (!this.isSupported()) {\n      console.warn('[Push] Web Push not supported in this browser');\n      // Check specific APIs\n      console.log('[Push] Notification API:', 'Notification' in window);\n      console.log('[Push] ServiceWorker API:', 'serviceWorker' in navigator);\n      console.log('[Push] PushManager API:', 'PushManager' in window);\n      return null;\n    }\n\n    // Request permission first\n    if (this.permission !== 'granted') {\n      console.log('[Push] Requesting permission...');\n      const granted = await this.requestPermission();\n      console.log('[Push] Permission result:', granted, 'Current permission:', this.permission);\n      if (!granted) {\n        console.warn('[Push] Permission not granted');\n        return null;\n      }\n    }\n\n    // Wait for service worker\n    if (!this.swRegistration) {\n      console.log('[Push] Waiting for Service Worker...');\n      await this.initServiceWorker();\n    }\n\n    if (!this.swRegistration) {\n      console.error('[Push] Service Worker not available after init');\n      return null;\n    }\n    console.log('[Push] Service Worker ready:', this.swRegistration.scope);\n\n    try {\n      // Check for existing subscription\n      const existingSub = await this.swRegistration.pushManager.getSubscription();\n      if (existingSub) {\n        console.log('[Push] Found existing subscription, using it');\n        this.pushSubscription = existingSub;\n      } else {\n        // Subscribe to push\n        console.log('[Push] Creating new subscription with VAPID key...');\n        this.pushSubscription = await this.swRegistration.pushManager.subscribe({\n          userVisibleOnly: true,\n          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n        });\n      }\n\n      console.log('[Push] Subscribed successfully!');\n      console.log('[Push] Endpoint:', this.pushSubscription.endpoint.substring(0, 60) + '...');\n\n      // Send subscription to server\n      console.log('[Push] Sending subscription to backend...');\n      await this.sendSubscriptionToServer(this.pushSubscription);\n\n      return this.pushSubscription;\n    } catch (error) {\n      console.error('[Push] Subscribe failed:', error);\n      // Log more details about the error\n      if (error instanceof Error) {\n        console.error('[Push] Error name:', error.name);\n        console.error('[Push] Error message:', error.message);\n      }\n      return null;\n    }\n  }\n\n  //   Web Push\n  async unsubscribe(): Promise<boolean> {\n    if (!this.pushSubscription) {\n      return true;\n    }\n\n    try {\n      await this.pushSubscription.unsubscribe();\n\n      // Remove from server\n      await this.removeSubscriptionFromServer();\n\n      this.pushSubscription = null;\n      console.log('[Push] Unsubscribed');\n      return true;\n    } catch (error) {\n      console.error('[Push] Unsubscribe failed:', error);\n      return false;\n    }\n  }\n\n  //    \n  private async sendSubscriptionToServer(subscription: PushSubscription): Promise<void> {\n    try {\n      const subscriptionData = subscription.toJSON();\n      console.log('[Push] Sending subscription to server:', {\n        endpoint: subscriptionData.endpoint?.substring(0, 60) + '...',\n        hasP256dh: !!subscriptionData.keys?.p256dh,\n        hasAuth: !!subscriptionData.keys?.auth\n      });\n\n      const result = await apiRequest('/api/push/subscribe', {\n        method: 'POST',\n        body: JSON.stringify({\n          endpoint: subscriptionData.endpoint,\n          keys: subscriptionData.keys\n        })\n      });\n      console.log('[Push] Subscription sent to server, result:', result);\n    } catch (error) {\n      console.error('[Push] Failed to send subscription to server:', error);\n      // Re-throw to let caller know about failure\n      throw error;\n    }\n  }\n\n  //    \n  private async removeSubscriptionFromServer(): Promise<void> {\n    try {\n      await apiRequest('/api/push/unsubscribe', {\n        method: 'POST'\n      });\n      console.log('[Push] Subscription removed from server');\n    } catch (error) {\n      console.error('[Push] Failed to remove subscription from server:', error);\n    }\n  }\n\n  //   \n  getSubscription(): PushSubscription | null {\n    return this.pushSubscription;\n  }\n\n  //  push-\n  async show(options: PushNotificationOptions): Promise<Notification | null> {\n    if (!this.isSupported()) {\n      console.warn('Push notifications are not supported');\n      return null;\n    }\n\n    //    , \n    if (this.permission !== 'granted') {\n      const granted = await this.requestPermission();\n      if (!granted) {\n        console.warn('Notification permission not granted');\n        return null;\n      }\n    }\n\n    try {\n      const notification = new Notification(options.title, {\n        body: options.body,\n        icon: options.icon || '/favicon.ico',\n        tag: options.tag,\n        requireInteraction: options.requireInteraction ?? true, //    \n        data: options.data,\n      });\n\n      //    \n      notification.onclick = (event) => {\n        event.preventDefault();\n        window.focus();\n\n        //   URL  data,   \n        if (options.data?.url) {\n          window.location.href = options.data.url;\n        }\n\n        notification.close();\n      };\n\n      return notification;\n    } catch (error) {\n      console.error('Failed to show notification:', error);\n      return null;\n    }\n  }\n\n  //     ( )\n  async notifyRequestCompleted(requestNumber: string | number, executorName: string, requestId: string): Promise<void> {\n    await this.show({\n      title: '  !',\n      body: ` ${requestNumber}: ${executorName}  . ,     .`,\n      tag: `request-completed-${requestId}`,\n      requireInteraction: true, //  -     \n      data: {\n        requestId,\n        url: '/', //    (dashboard)\n      },\n    });\n  }\n\n  //    \n  async notifyUrgentAnnouncement(title: string, message: string, announcementId: string): Promise<void> {\n    await this.show({\n      title: ` ${title}`,\n      body: message,\n      tag: `announcement-${announcementId}`,\n      requireInteraction: true,\n      data: {\n        announcementId,\n        url: '/',\n      },\n    });\n  }\n\n  //  \n  async notifyMeeting(title: string, date: string, time: string, announcementId: string): Promise<void> {\n    await this.show({\n      title: `  `,\n      body: `${title}\\n${date}  ${time}`,\n      tag: `meeting-${announcementId}`,\n      requireInteraction: true,\n      data: {\n        announcementId,\n        url: '/meetings',\n      },\n    });\n  }\n\n  //   \n  async notifyNewMeeting(meetingId: string, buildingAddress: string): Promise<void> {\n    await this.show({\n      title: '   ',\n      body: `    ${buildingAddress}.     !`,\n      tag: `new-meeting-${meetingId}`,\n      requireInteraction: true,\n      data: {\n        url: '/meetings',\n      },\n    });\n  }\n\n  //  \n  async notifyVotingOpen(meetingId: string, buildingAddress: string): Promise<void> {\n    await this.show({\n      title: '  !',\n      body: `     ${buildingAddress} .  !`,\n      tag: `voting-open-${meetingId}`,\n      requireInteraction: true,\n      data: {\n        url: '/meetings',\n      },\n    });\n  }\n\n  //   \n  async notifyVotingReminder(meetingId: string, hoursLeft: number): Promise<void> {\n    await this.show({\n      title: '   ',\n      body: ` ${hoursLeft}    .   !`,\n      tag: `voting-reminder-${meetingId}`,\n      requireInteraction: true,\n      data: {\n        url: '/meetings',\n      },\n    });\n  }\n\n  //  \n  async notifyProtocolReady(meetingId: string, buildingAddress: string): Promise<void> {\n    await this.show({\n      title: '   ',\n      body: `    ${buildingAddress} .`,\n      tag: `protocol-ready-${meetingId}`,\n      requireInteraction: false,\n      data: {\n        url: '/meetings',\n      },\n    });\n  }\n\n  //  \n  async notifyAnnouncement(title: string, content: string, announcementId: string, priority: 'low' | 'normal' | 'urgent' = 'normal'): Promise<void> {\n    const icon = priority === 'urgent' ? '' : '';\n    await this.show({\n      title: `${icon} ${title}`,\n      body: content.length > 200 ? content.substring(0, 200) + '...' : content,\n      tag: `announcement-${announcementId}`,\n      requireInteraction: priority === 'urgent',\n      data: {\n        announcementId,\n        priority,\n        url: '/announcements',\n        type: 'announcement'\n      },\n    });\n  }\n\n  //     ( )\n  async notifyRequestAssigned(requestNumber: string | number, title: string, requestId: string): Promise<void> {\n    await this.show({\n      title: '   ',\n      body: ` ${requestNumber}: ${title}`,\n      tag: `request-assigned-${requestId}`,\n      requireInteraction: true,\n      data: {\n        requestId,\n        url: '/',\n      },\n    });\n  }\n\n  //     ( )\n  async notifyRequestStarted(requestNumber: string | number, executorName: string, requestId: string): Promise<void> {\n    await this.show({\n      title: '  ',\n      body: ` ${requestNumber}: ${executorName}  `,\n      tag: `request-started-${requestId}`,\n      requireInteraction: false, //   \n      data: {\n        requestId,\n        url: '/',\n      },\n    });\n  }\n}\n\n// Singleton instance\nexport const pushNotifications = new PushNotificationService();\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { Executor, Request, ChartData, Notification, ActivityLog, CancelledBy, RentalApartment, RentalRecord, Announcement, Vehicle, GuestAccessCode, GuestAccessLog, GuestAccessStats, VisitorType, AccessType, UserRole, RescheduleRequest, RescheduleReason, RescheduleInitiator } from '../types';\nimport { useAuthStore } from './authStore';\nimport { requestsApi, executorsApi, vehiclesApi, guestCodesApi, authApi, usersApi, rentalsApi } from '../services/api';\nimport { pushNotifications } from '../services/pushNotifications';\n\n// Settings interface\ninterface AppSettings {\n  companyName: string;\n  companyInn: string;\n  companyAddress: string;\n  companyPhone: string;\n  routingMode: 'manual' | 'auto' | 'hybrid';\n  workingHoursStart: string;\n  workingHoursEnd: string;\n  autoAssign: boolean;\n  notifyOnNew: boolean;\n  notifyOnComplete: boolean;\n  notifyOnRating: boolean;\n  smsNotifications: boolean;\n  emailNotifications: boolean;\n  pushNotifications: boolean;\n}\n\ninterface DataState {\n  executors: Executor[];\n  requests: Request[];\n  notifications: Notification[];\n  activityLogs: ActivityLog[];\n  settings: AppSettings;\n  rentalApartments: RentalApartment[];\n  rentalRecords: RentalRecord[];\n  announcements: Announcement[];\n  vehicles: Vehicle[];\n  guestAccessCodes: GuestAccessCode[];\n  guestAccessLogs: GuestAccessLog[];\n  rescheduleRequests: RescheduleRequest[];\n\n  // API loading states\n  isLoadingRequests: boolean;\n  isLoadingExecutors: boolean;\n  isLoadingVehicles: boolean;\n  isLoadingGuestCodes: boolean;\n\n  // API fetch actions\n  fetchRequests: (status?: string, category?: string) => Promise<void>;\n  fetchExecutors: (showAll?: boolean) => Promise<void>;\n  fetchVehicles: (forStaff?: boolean) => Promise<void>;\n  fetchGuestCodes: () => Promise<void>;\n\n  // Guest Access actions\n  createGuestAccessCode: (data: {\n    residentId: string;\n    residentName: string;\n    residentPhone: string;\n    residentApartment: string;\n    residentAddress: string;\n    visitorType: VisitorType;\n    visitorName?: string;\n    visitorPhone?: string;\n    visitorVehiclePlate?: string;\n    accessType: AccessType;\n    validFrom?: string;\n    validUntil?: string;\n    notes?: string;\n  }) => Promise<GuestAccessCode | null>;\n  revokeGuestAccessCode: (id: string, revokedBy: string, revokedByName: string, revokedByRole: UserRole, reason: string) => Promise<void>;\n  useGuestAccessCode: (id: string, fullCode?: GuestAccessCode) => boolean;\n  validateGuestAccessCode: (qrToken: string) => { valid: boolean; code?: GuestAccessCode; error?: string };\n  getGuestAccessCodesByResident: (residentId: string) => GuestAccessCode[];\n  getAllGuestAccessCodes: () => GuestAccessCode[];\n  addGuestAccessLog: (log: Omit<GuestAccessLog, 'id' | 'timestamp'>) => void;\n  getGuestAccessLogs: (accessCodeId?: string) => GuestAccessLog[];\n  getGuestAccessStats: () => GuestAccessStats;\n\n  // Announcement actions\n  addAnnouncement: (announcement: Omit<Announcement, 'id' | 'createdAt' | 'isActive' | 'viewedBy'>) => Promise<Announcement | null>;\n  updateAnnouncement: (id: string, data: Partial<Announcement>) => void;\n  deleteAnnouncement: (id: string) => Promise<void>;\n  markAnnouncementAsViewed: (announcementId: string, userId: string) => void;\n  getAnnouncementsForResidents: (userLogin: string, buildingId?: string, entrance?: string, floor?: string, branch?: string) => Announcement[];\n  getAnnouncementsForEmployees: () => Announcement[];\n  getAnnouncementsByAuthor: (authorId: string) => Announcement[];\n  fetchAnnouncements: () => Promise<void>;\n\n  // Vehicle actions\n  addVehicle: (vehicle: Omit<Vehicle, 'id' | 'createdAt'>) => Promise<Vehicle | null>;\n  updateVehicle: (id: string, data: Partial<Vehicle>) => Promise<void>;\n  deleteVehicle: (id: string) => Promise<void>;\n  getVehiclesByOwner: (ownerId: string) => Vehicle[];\n  searchVehicleByPlate: (plateNumber: string) => Promise<Vehicle | undefined>;\n  searchVehiclesByPlate: (plateNumber: string) => Promise<Vehicle[]>;\n\n  // Rental actions\n  fetchRentals: () => Promise<void>;\n  fetchMyRentals: () => Promise<void>;  // For tenants/commercial_owners\n  addRentalApartment: (apartment: Omit<RentalApartment, 'id' | 'createdAt' | 'isActive'> & { password: string; ownerType?: 'tenant' | 'commercial_owner' }) => Promise<RentalApartment | null>;\n  updateRentalApartment: (id: string, data: Partial<RentalApartment>) => Promise<void>;\n  deleteRentalApartment: (id: string) => Promise<void>;\n  getRentalApartmentsByOwner: (ownerId: string) => RentalApartment[];\n  addRentalRecord: (record: Omit<RentalRecord, 'id' | 'createdAt'>) => Promise<RentalRecord | null>;\n  updateRentalRecord: (id: string, data: Partial<RentalRecord>) => Promise<void>;\n  deleteRentalRecord: (id: string) => Promise<void>;\n  getRentalRecordsByApartment: (apartmentId: string) => RentalRecord[];\n\n  // Executor actions\n  addExecutor: (executor: Omit<Executor, 'id' | 'createdAt' | 'rating' | 'completedCount' | 'activeRequests' | 'status' | 'totalEarnings' | 'avgCompletionTime'> & { password: string; role?: string }) => Promise<Executor | null>;\n  updateExecutor: (id: string, data: Partial<Executor>) => void;\n  deleteExecutor: (id: string) => Promise<void>;\n  getExecutorStats: (executorId: string) => {\n    totalRequests: number;\n    completedRequests: number;\n    avgRating: number;\n    avgTime: number;\n    thisWeek: number;\n    thisMonth: number;\n  };\n\n  // Request actions (API-backed)\n  addRequest: (request: Omit<Request, 'id' | 'number' | 'createdAt' | 'status'>) => Promise<Request | null>;\n  assignRequest: (requestId: string, executorId: string) => Promise<void>;\n  acceptRequest: (requestId: string) => Promise<void>;\n  startWork: (requestId: string) => Promise<void>;\n  pauseWork: (requestId: string) => Promise<void>;\n  resumeWork: (requestId: string) => Promise<void>;\n  completeWork: (requestId: string, workDuration: number) => Promise<void>;\n  approveRequest: (requestId: string, rating: number, feedback?: string) => Promise<void>;\n  rejectRequest: (requestId: string, reason: string) => Promise<void>;\n  cancelRequest: (requestId: string, cancelledBy: CancelledBy, reason: string) => Promise<void>;\n  declineRequest: (requestId: string, reason: string) => Promise<void>; // Executor declines assigned request\n  getRequestsByResident: (residentId: string) => Request[];\n  getRequestsByExecutor: (executorId: string) => Request[];\n\n  // Notification actions\n  addNotification: (notification: Omit<Notification, 'id' | 'createdAt' | 'read'>) => void;\n  markNotificationAsRead: (id: string) => void;\n  markAllNotificationsAsRead: (userId: string) => void;\n  getUnreadCount: (userId: string) => number;\n\n  // Activity log\n  addActivityLog: (log: Omit<ActivityLog, 'id' | 'timestamp'>) => void;\n\n  // Stats\n  getStats: () => {\n    totalRequests: number;\n    newRequests: number;\n    inProgress: number;\n    pendingApproval: number;\n    completedToday: number;\n    completedWeek: number;\n    avgCompletionTime: number;\n    executorsOnline: number;\n    executorsTotal: number;\n  };\n  getChartData: () => ChartData[];\n\n  // Settings actions\n  fetchSettings: () => Promise<void>;\n  updateSettings: (settings: Partial<AppSettings>) => Promise<void>;\n\n  // Reschedule actions\n  fetchPendingReschedules: () => Promise<void>;\n  createRescheduleRequest: (data: {\n    requestId: string;\n    proposedDate: string;\n    proposedTime: string;\n    reason: RescheduleReason;\n    reasonText?: string;\n  }) => Promise<RescheduleRequest | null>;\n  respondToRescheduleRequest: (rescheduleId: string, accepted: boolean, responseNote?: string) => Promise<void>;\n  getRescheduleRequestsByRequest: (requestId: string) => RescheduleRequest[];\n  getPendingRescheduleForUser: (userId: string) => RescheduleRequest[];\n  getActiveRescheduleForRequest: (requestId: string) => RescheduleRequest | undefined;\n  getConfirmedRescheduleForRequest: (requestId: string) => RescheduleRequest | undefined;\n}\n\nconst generateId = () => Math.random().toString(36).substr(2, 9);\n\n// Demo QR code for testing\nconst createDemoGuestAccessCode = (): GuestAccessCode => {\n  const now = new Date();\n  const validUntil = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000); // Valid for 7 days\n\n  return {\n    id: 'demo-code-1',\n    residentId: 'resident1',\n    residentName: '  ',\n    residentPhone: '+998901234567',\n    residentApartment: '42',\n    residentAddress: '. , 15',\n    visitorType: 'guest' as VisitorType,\n    visitorName: ' ',\n    visitorPhone: '+998901111111',\n    accessType: 'week' as AccessType,\n    qrToken: 'GA-demo-test-code123',\n    status: 'active',\n    validFrom: now.toISOString(),\n    validUntil: validUntil.toISOString(),\n    maxUses: 999,\n    currentUses: 0,\n    createdAt: now.toISOString(),\n    updatedAt: now.toISOString(),\n  };\n};\n\n// Default settings\nconst defaultSettings: AppSettings = {\n  companyName: ' ',\n  companyInn: '305123456',\n  companyAddress: '. ,  ',\n  companyPhone: '+998 71 123 45 67',\n  routingMode: 'hybrid',\n  workingHoursStart: '08:00',\n  workingHoursEnd: '20:00',\n  autoAssign: true,\n  notifyOnNew: true,\n  notifyOnComplete: true,\n  notifyOnRating: true,\n  smsNotifications: false,\n  emailNotifications: true,\n  pushNotifications: true,\n};\n\nexport const useDataStore = create<DataState>()(\n  persist(\n    (set, get) => ({\n      executors: [], // Start empty, will be loaded from API\n      requests: [], // Start with empty, will be loaded from API\n      notifications: [],\n      activityLogs: [],\n      settings: defaultSettings,\n      rentalApartments: [],\n      rentalRecords: [],\n      announcements: [],\n      vehicles: [],\n      guestAccessCodes: [createDemoGuestAccessCode()],\n      guestAccessLogs: [],\n      rescheduleRequests: [],\n      isLoadingRequests: false,\n      isLoadingExecutors: false,\n      isLoadingVehicles: false,\n      isLoadingGuestCodes: false,\n\n      // Fetch requests from D1 database via API\n      fetchRequests: async (status?: string, category?: string) => {\n        set({ isLoadingRequests: true });\n        try {\n          const response = await requestsApi.getAll(status, category);\n          // Map API response to Request type\n          const requests = response.requests || [];\n          const mappedRequests: Request[] = requests.map((r: any) => ({\n            id: r.id,\n            // Use prefixed request_number first, then number, then generate from id\n            number: r.request_number || r.number || `#${r.id?.substring(0, 6).toUpperCase() || '000000'}`,\n            title: r.title,\n            description: r.description || '',\n            category: r.category_id,\n            status: r.status,\n            priority: r.priority || 'medium',\n            residentId: r.resident_id,\n            residentName: r.resident_name || '',\n            residentPhone: r.resident_phone || '',\n            address: r.address || '',\n            apartment: r.apartment || '',\n            executorId: r.executor_id,\n            executorName: r.executor_name,\n            executorPhone: r.executor_phone,\n            accessInfo: r.access_info,\n            scheduledDate: r.scheduled_at ? r.scheduled_at.split('T')[0] : undefined,\n            scheduledTime: r.scheduled_at ? r.scheduled_at.split('T')[1]?.substring(0, 5) : undefined,\n            createdAt: r.created_at,\n            assignedAt: r.assigned_at,\n            acceptedAt: r.accepted_at,\n            startedAt: r.started_at,\n            completedAt: r.completed_at,\n            approvedAt: r.approved_at,\n            rating: r.rating,\n            feedback: r.feedback,\n            workDuration: r.work_duration,\n            buildingId: r.building_id,\n            buildingName: r.building_name,\n            // Pause fields from DB\n            isPaused: r.is_paused === 1 || r.is_paused === true,\n            pausedAt: r.paused_at,\n            totalPausedTime: r.total_paused_time || 0,\n          }));\n\n          // Keep pending/optimistic requests (temp-*) that are still being created\n          // This prevents losing requests that haven't been saved to API yet\n          set((state) => {\n            const pendingRequests = state.requests.filter(r => r.id.startsWith('temp-'));\n            // Merge: API data + pending requests (that aren't already in API response)\n            const mergedRequests = [\n              ...pendingRequests,\n              ...mappedRequests.filter(apiReq => !pendingRequests.some(p => p.id === apiReq.id))\n            ];\n            return { requests: mergedRequests, isLoadingRequests: false };\n          });\n        } catch (error) {\n          console.error('Failed to fetch requests:', error);\n          set({ isLoadingRequests: false });\n        }\n      },\n\n      // Fetch executors from D1 database via API\n      fetchExecutors: async (showAll = false) => {\n        console.log('[fetchExecutors] Starting fetch... showAll:', showAll);\n        set({ isLoadingExecutors: true });\n        try {\n          const response = await executorsApi.getAll(showAll);\n          console.log('[fetchExecutors] API response:', response);\n          // Map API response to Executor type\n          const mappedExecutors: Executor[] = response.executors.map((e: any) => ({\n            id: e.id,\n            name: e.name,\n            phone: e.phone,\n            login: e.login,\n            specialization: e.specialization,\n            status: e.status || 'offline',\n            rating: e.rating || 5.0,\n            completedCount: e.completed_count || 0,\n            activeRequests: e.active_requests || 0,\n            totalEarnings: e.total_earnings || 0,\n            avgCompletionTime: e.avg_completion_time || 0,\n            createdAt: e.created_at,\n          }));\n          console.log('[fetchExecutors] Mapped executors:', mappedExecutors);\n          set({ executors: mappedExecutors, isLoadingExecutors: false });\n        } catch (error) {\n          console.error('[fetchExecutors] Failed to fetch executors:', error);\n          set({ isLoadingExecutors: false });\n        }\n      },\n\n      // Fetch vehicles from D1 database via API\n      fetchVehicles: async (forStaff = false) => {\n        set({ isLoadingVehicles: true });\n        try {\n          // Use different endpoint based on whether we need all vehicles or just user's own\n          const response = forStaff\n            ? await vehiclesApi.getAll()  // /api/vehicles/all - all vehicles for staff\n            : await vehiclesApi.getMyVehicles();  // /api/vehicles - only user's vehicles\n          // Map API response to Vehicle type (API now returns all fields from DB + owner info)\n          const mappedVehicles: Vehicle[] = response.vehicles.map((v: any) => ({\n            id: v.id,\n            ownerId: v.user_id,\n            ownerName: v.owner_name || '',\n            ownerPhone: v.owner_phone || '',\n            apartment: v.apartment || '',\n            address: v.address || '',\n            plateNumber: v.plate_number,\n            brand: v.brand || '',\n            model: v.model || '',\n            color: v.color || '',\n            year: v.year || undefined,\n            type: (v.vehicle_type || 'car') as Vehicle['type'],\n            ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\n            companyName: v.company_name || undefined,\n            parkingSpot: v.parking_spot || undefined,\n            notes: v.notes || undefined,\n            createdAt: v.created_at,\n            updatedAt: v.updated_at || undefined,\n          }));\n          set({ vehicles: mappedVehicles, isLoadingVehicles: false });\n        } catch (error) {\n          console.error('Failed to fetch vehicles:', error);\n          set({ isLoadingVehicles: false });\n        }\n      },\n\n      // Fetch guest codes from D1 database via API\n      fetchGuestCodes: async () => {\n        set({ isLoadingGuestCodes: true });\n        try {\n          const response = await guestCodesApi.getAll();\n          const codes = response.codes || [];\n          const mappedCodes: GuestAccessCode[] = codes.map((c: any) => ({\n            id: c.id,\n            residentId: c.user_id,\n            residentName: c.resident_name || '',\n            residentPhone: c.resident_phone || '',\n            residentApartment: c.resident_apartment || '',\n            residentAddress: c.resident_address || '',\n            visitorType: c.visitor_type as VisitorType,\n            visitorName: c.visitor_name || undefined,\n            visitorPhone: c.visitor_phone || undefined,\n            visitorVehiclePlate: c.visitor_vehicle_plate || undefined,\n            accessType: c.access_type as AccessType,\n            validFrom: c.valid_from,\n            validUntil: c.valid_until,\n            maxUses: c.max_uses,\n            currentUses: c.current_uses || 0,\n            qrToken: c.qr_token,\n            status: c.status as 'active' | 'used' | 'expired' | 'revoked',\n            notes: c.notes || undefined,\n            createdAt: c.created_at,\n            updatedAt: c.updated_at || undefined,\n            revokedAt: c.revoked_at || undefined,\n            revokedBy: c.revoked_by || undefined,\n            revocationReason: c.revoked_reason || undefined,\n          }));\n          set({ guestAccessCodes: mappedCodes, isLoadingGuestCodes: false });\n        } catch (error) {\n          console.error('Failed to fetch guest codes:', error);\n          set({ isLoadingGuestCodes: false });\n        }\n      },\n\n      // Guest Access actions\n      createGuestAccessCode: async (data) => {\n        try {\n          const response = await guestCodesApi.create({\n            visitor_type: data.visitorType,\n            visitor_name: data.visitorName,\n            visitor_phone: data.visitorPhone,\n            visitor_vehicle_plate: data.visitorVehiclePlate,\n            access_type: data.accessType,\n            valid_from: data.validFrom,\n            valid_until: data.validUntil,\n            resident_name: data.residentName,\n            resident_phone: data.residentPhone,\n            resident_apartment: data.residentApartment,\n            resident_address: data.residentAddress,\n            notes: data.notes,\n          });\n\n          const c = response.code;\n          const newCode: GuestAccessCode = {\n            id: c.id,\n            residentId: c.user_id || data.residentId,\n            residentName: c.resident_name || data.residentName,\n            residentPhone: c.resident_phone || data.residentPhone,\n            residentApartment: c.resident_apartment || data.residentApartment,\n            residentAddress: c.resident_address || data.residentAddress,\n            visitorType: c.visitor_type as VisitorType,\n            visitorName: c.visitor_name || undefined,\n            visitorPhone: c.visitor_phone || undefined,\n            visitorVehiclePlate: c.visitor_vehicle_plate || undefined,\n            accessType: c.access_type as AccessType,\n            validFrom: c.valid_from,\n            validUntil: c.valid_until,\n            maxUses: c.max_uses,\n            currentUses: c.current_uses || 0,\n            qrToken: c.qr_token,\n            status: c.status as 'active' | 'used' | 'expired' | 'revoked',\n            notes: c.notes || undefined,\n            createdAt: c.created_at,\n          };\n\n          set((state) => ({\n            guestAccessCodes: [newCode, ...state.guestAccessCodes],\n          }));\n\n          return newCode;\n        } catch (error) {\n          console.error('Failed to create guest code:', error);\n          return null;\n        }\n      },\n\n      revokeGuestAccessCode: async (id, revokedBy, revokedByName, revokedByRole, reason) => {\n        try {\n          await guestCodesApi.revoke(id, reason);\n          set((state) => ({\n            guestAccessCodes: state.guestAccessCodes.map((code) =>\n              code.id === id\n                ? {\n                    ...code,\n                    status: 'revoked' as const,\n                    revokedAt: new Date().toISOString(),\n                    revokedBy,\n                    revokedByName,\n                    revokedByRole,\n                    revocationReason: reason,\n                    updatedAt: new Date().toISOString(),\n                  }\n                : code\n            ),\n          }));\n        } catch (error) {\n          console.error('Failed to revoke guest code:', error);\n        }\n      },\n\n      useGuestAccessCode: (id, fullCode?: GuestAccessCode) => {\n        console.log('=== USING GUEST ACCESS CODE ===');\n        console.log('Code ID:', id);\n        console.log('Full code provided:', !!fullCode);\n\n        const state = get();\n        let code = state.guestAccessCodes.find((c) => c.id === id);\n\n        // If code not found in local storage but fullCode provided (self-contained token)\n        // Add it to local storage for tracking\n        if (!code && fullCode) {\n          console.log('Code not in local storage, adding from self-contained token');\n          code = { ...fullCode, currentUses: 0, status: 'active' };\n\n          // Add to state\n          set((state) => ({\n            guestAccessCodes: [code!, ...state.guestAccessCodes],\n          }));\n        }\n\n        console.log('Found code:', code ? {\n          id: code.id,\n          status: code.status,\n          currentUses: code.currentUses,\n          maxUses: code.maxUses,\n          accessType: code.accessType\n        } : 'NOT FOUND');\n\n        if (!code || code.status !== 'active') {\n          console.log('Code not active or not found, returning false');\n          return false;\n        }\n\n        const now = new Date();\n        if (now > new Date(code.validUntil)) {\n          console.log('Code has expired');\n          // Code has expired\n          set((state) => ({\n            guestAccessCodes: state.guestAccessCodes.map((c) =>\n              c.id === id ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() } : c\n            ),\n          }));\n          return false;\n        }\n\n        const newUses = code.currentUses + 1;\n        const newStatus = newUses >= code.maxUses ? 'used' : 'active';\n\n        console.log('Updating code:');\n        console.log('  Old uses:', code.currentUses);\n        console.log('  New uses:', newUses);\n        console.log('  Max uses:', code.maxUses);\n        console.log('  New status:', newStatus);\n\n        set((state) => ({\n          guestAccessCodes: state.guestAccessCodes.map((c) =>\n            c.id === id\n              ? {\n                  ...c,\n                  currentUses: newUses,\n                  status: newStatus as 'active' | 'used',\n                  lastUsedAt: now.toISOString(),\n                  updatedAt: now.toISOString(),\n                }\n              : c\n          ),\n        }));\n\n        console.log('Code used successfully');\n        return true;\n      },\n\n      validateGuestAccessCode: (qrToken) => {\n        console.log('=== VALIDATING QR CODE ===');\n        console.log('Input token:', qrToken);\n\n        const now = new Date();\n\n        // Check if this is a self-contained token (starts with GAPASS:)\n        if (qrToken.startsWith('GAPASS:')) {\n          console.log('Detected self-contained GAPASS token');\n          try {\n            const base64Data = qrToken.substring(7); // Remove 'GAPASS:' prefix\n            // Decode base64 and then use TextDecoder to handle UTF-8 (Cyrillic, etc.)\n            const decoded = atob(base64Data);\n            // Convert string to Uint8Array\n            const bytes = new Uint8Array(decoded.length);\n            for (let i = 0; i < decoded.length; i++) {\n              bytes[i] = decoded.charCodeAt(i);\n            }\n            // Decode UTF-8 bytes to string\n            const decoder = new TextDecoder('utf-8');\n            const utf8Decoded = decoder.decode(bytes);\n            const tokenData = JSON.parse(utf8Decoded);\n            console.log('Decoded token data:', tokenData);\n\n            // Create a GuestAccessCode object from the token data\n            const code: GuestAccessCode = {\n              id: tokenData.i,\n              residentId: 'from-token',\n              residentName: tokenData.rn,\n              residentPhone: tokenData.rp,\n              residentApartment: tokenData.ra,\n              residentAddress: tokenData.rd,\n              visitorType: tokenData.vt as VisitorType,\n              visitorName: tokenData.vn || undefined,\n              visitorPhone: tokenData.vp || undefined,\n              visitorVehiclePlate: tokenData.vv || undefined,\n              accessType: tokenData.at as AccessType,\n              validFrom: new Date(tokenData.vf).toISOString(),\n              validUntil: new Date(tokenData.vu).toISOString(),\n              maxUses: tokenData.mx,\n              currentUses: 0, // We track usage locally for self-contained tokens\n              qrToken: qrToken,\n              status: 'active',\n              createdAt: new Date(tokenData.vf).toISOString(),\n            };\n\n            // Check if expired\n            if (now.getTime() > tokenData.vu) {\n              console.log('Self-contained code EXPIRED:', now.getTime(), '>', tokenData.vu);\n              return { valid: false, code, error: 'expired' };\n            }\n\n            // Check if not yet valid\n            if (now.getTime() < tokenData.vf) {\n              console.log('Self-contained code NOT YET VALID:', now.getTime(), '<', tokenData.vf);\n              return { valid: false, code, error: 'not_yet_valid' };\n            }\n\n            // Check if this code was already used (stored in local tracking)\n            const state = get();\n            const usedCodes = state.guestAccessCodes.filter(c => c.id === tokenData.i);\n            const localCode = usedCodes.length > 0 ? usedCodes[0] : null;\n\n            if (localCode) {\n              console.log('Found local tracking for this code:', {\n                id: localCode.id,\n                status: localCode.status,\n                currentUses: localCode.currentUses,\n                maxUses: localCode.maxUses\n              });\n\n              // Use local tracking for status\n              if (localCode.status === 'revoked') {\n                console.log('Code REVOKED (local)');\n                return { valid: false, code: { ...code, ...localCode }, error: 'revoked' };\n              }\n\n              if (localCode.status === 'used' || localCode.currentUses >= tokenData.mx) {\n                console.log('Code USED (local)');\n                return { valid: false, code: { ...code, ...localCode }, error: 'already_used' };\n              }\n\n              // Update code with local data\n              code.currentUses = localCode.currentUses;\n              code.status = localCode.status;\n            }\n\n            console.log('Self-contained code is VALID!');\n            return { valid: true, code };\n          } catch (err) {\n            console.error('Failed to decode GAPASS token:', err);\n            return { valid: false, error: 'invalid' };\n          }\n        }\n\n        // Legacy: check local storage for old-style tokens (GA-xxx-xxx)\n        const state = get();\n        console.log('Checking legacy token in local storage');\n        console.log('All codes:', state.guestAccessCodes.map(c => ({\n          id: c.id,\n          qrToken: c.qrToken.substring(0, 30) + '...',\n          status: c.status,\n          currentUses: c.currentUses,\n          maxUses: c.maxUses,\n          accessType: c.accessType\n        })));\n\n        const code = state.guestAccessCodes.find((c) => c.qrToken === qrToken);\n\n        if (!code) {\n          console.log('Code NOT FOUND for token:', qrToken);\n          return { valid: false, error: 'invalid' };\n        }\n\n        console.log('Found code:', {\n          id: code.id,\n          status: code.status,\n          currentUses: code.currentUses,\n          maxUses: code.maxUses,\n          accessType: code.accessType,\n          validFrom: code.validFrom,\n          validUntil: code.validUntil\n        });\n\n        // Check if expired\n        if (now > new Date(code.validUntil)) {\n          console.log('Code EXPIRED:', now, '>', new Date(code.validUntil));\n          // Update status if needed\n          if (code.status === 'active') {\n            set((state) => ({\n              guestAccessCodes: state.guestAccessCodes.map((c) =>\n                c.id === code.id ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() } : c\n              ),\n            }));\n          }\n          return { valid: false, code, error: 'expired' };\n        }\n\n        // Check if not yet valid\n        if (now < new Date(code.validFrom)) {\n          console.log('Code NOT YET VALID:', now, '<', new Date(code.validFrom));\n          return { valid: false, code, error: 'not_yet_valid' };\n        }\n\n        // Check status\n        if (code.status === 'revoked') {\n          console.log('Code REVOKED');\n          return { valid: false, code, error: 'revoked' };\n        }\n\n        if (code.status === 'used') {\n          console.log('Code status is USED');\n          return { valid: false, code, error: 'already_used' };\n        }\n\n        if (code.status === 'expired') {\n          console.log('Code status is EXPIRED');\n          return { valid: false, code, error: 'expired' };\n        }\n\n        // Check max uses\n        if (code.currentUses >= code.maxUses) {\n          console.log('Code MAX USES REACHED:', code.currentUses, '>=', code.maxUses);\n          return { valid: false, code, error: 'max_uses_reached' };\n        }\n\n        console.log('Code is VALID!');\n        return { valid: true, code };\n      },\n\n      getGuestAccessCodesByResident: (residentId) => {\n        // Update expired codes first\n        const now = new Date();\n        const state = get();\n        const needsUpdate = state.guestAccessCodes.some(\n          (c) => c.residentId === residentId && c.status === 'active' && now > new Date(c.validUntil)\n        );\n\n        if (needsUpdate) {\n          set((state) => ({\n            guestAccessCodes: state.guestAccessCodes.map((c) =>\n              c.residentId === residentId && c.status === 'active' && now > new Date(c.validUntil)\n                ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() }\n                : c\n            ),\n          }));\n        }\n\n        return get().guestAccessCodes.filter((c) => c.residentId === residentId);\n      },\n\n      getAllGuestAccessCodes: () => {\n        // Update expired codes\n        const now = new Date();\n        const state = get();\n        const needsUpdate = state.guestAccessCodes.some(\n          (c) => c.status === 'active' && now > new Date(c.validUntil)\n        );\n\n        if (needsUpdate) {\n          set((state) => ({\n            guestAccessCodes: state.guestAccessCodes.map((c) =>\n              c.status === 'active' && now > new Date(c.validUntil)\n                ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() }\n                : c\n            ),\n          }));\n        }\n\n        return get().guestAccessCodes;\n      },\n\n      addGuestAccessLog: (logData) => {\n        const newLog: GuestAccessLog = {\n          ...logData,\n          id: generateId(),\n          timestamp: new Date().toISOString(),\n        };\n        set((state) => ({\n          guestAccessLogs: [newLog, ...state.guestAccessLogs].slice(0, 500), // Keep last 500 logs\n        }));\n      },\n\n      getGuestAccessLogs: (accessCodeId) => {\n        const logs = get().guestAccessLogs;\n        if (accessCodeId) {\n          return logs.filter((l) => l.accessCodeId === accessCodeId);\n        }\n        return logs;\n      },\n\n      getGuestAccessStats: () => {\n        const state = get();\n        const now = new Date();\n        const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n\n        // Update expired codes first\n        const codes = state.guestAccessCodes.map((c) =>\n          c.status === 'active' && now > new Date(c.validUntil)\n            ? { ...c, status: 'expired' as const }\n            : c\n        );\n\n        const activeCodes = codes.filter((c) => c.status === 'active');\n        const usedToday = state.guestAccessLogs.filter(\n          (l) => new Date(l.timestamp) >= todayStart && l.action === 'entry_allowed'\n        ).length;\n        const createdToday = codes.filter(\n          (c) => new Date(c.createdAt) >= todayStart\n        ).length;\n\n        const byVisitorType = {\n          courier: activeCodes.filter((c) => c.visitorType === 'courier').length,\n          guest: activeCodes.filter((c) => c.visitorType === 'guest').length,\n          taxi: activeCodes.filter((c) => c.visitorType === 'taxi').length,\n          other: activeCodes.filter((c) => c.visitorType === 'other').length,\n        };\n\n        const recentScans = state.guestAccessLogs.slice(0, 10);\n\n        return {\n          totalActive: activeCodes.length,\n          totalUsedToday: usedToday,\n          totalCreatedToday: createdToday,\n          byVisitorType,\n          recentScans,\n        };\n      },\n\n      // Vehicle actions (API-backed with all fields) - OPTIMISTIC UPDATES\n      addVehicle: async (vehicleData) => {\n        // Generate temporary ID for optimistic update\n        const tempId = `temp-${generateId()}`;\n        const now = new Date().toISOString();\n\n        // Create optimistic vehicle immediately\n        const optimisticVehicle: Vehicle = {\n          id: tempId,\n          ownerId: vehicleData.ownerId,\n          ownerName: vehicleData.ownerName,\n          ownerPhone: vehicleData.ownerPhone,\n          apartment: vehicleData.apartment,\n          address: vehicleData.address,\n          plateNumber: vehicleData.plateNumber,\n          brand: vehicleData.brand || '',\n          model: vehicleData.model || '',\n          color: vehicleData.color || '',\n          year: vehicleData.year,\n          type: vehicleData.type || 'car',\n          ownerType: vehicleData.ownerType || 'individual',\n          companyName: vehicleData.companyName,\n          parkingSpot: vehicleData.parkingSpot,\n          notes: vehicleData.notes,\n          createdAt: now,\n        };\n\n        // Immediately add to UI (optimistic)\n        set((state) => ({ vehicles: [...state.vehicles, optimisticVehicle] }));\n\n        try {\n          // Call API in background\n          const response = await vehiclesApi.create({\n            plate_number: vehicleData.plateNumber,\n            brand: vehicleData.brand,\n            model: vehicleData.model,\n            color: vehicleData.color,\n            year: vehicleData.year,\n            vehicle_type: vehicleData.type,\n            owner_type: vehicleData.ownerType,\n            company_name: vehicleData.companyName,\n            parking_spot: vehicleData.parkingSpot,\n            notes: vehicleData.notes,\n            is_primary: false,\n          });\n\n          // Replace temp with real data from server\n          const v = response.vehicle;\n          const realVehicle: Vehicle = {\n            id: v.id,\n            ownerId: v.user_id,\n            ownerName: v.owner_name || vehicleData.ownerName,\n            ownerPhone: v.owner_phone || vehicleData.ownerPhone,\n            apartment: v.apartment || vehicleData.apartment,\n            address: v.address || vehicleData.address,\n            plateNumber: v.plate_number,\n            brand: v.brand || '',\n            model: v.model || '',\n            color: v.color || '',\n            year: v.year || undefined,\n            type: (v.vehicle_type || 'car') as Vehicle['type'],\n            ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\n            companyName: v.company_name || undefined,\n            parkingSpot: v.parking_spot || undefined,\n            notes: v.notes || undefined,\n            createdAt: v.created_at || now,\n            updatedAt: v.updated_at || undefined,\n          };\n\n          // Replace optimistic with real\n          set((state) => ({\n            vehicles: state.vehicles.map((veh) =>\n              veh.id === tempId ? realVehicle : veh\n            ),\n          }));\n\n          return realVehicle;\n        } catch (error) {\n          console.error('Failed to create vehicle:', error);\n          // Rollback on error\n          set((state) => ({\n            vehicles: state.vehicles.filter((v) => v.id !== tempId),\n          }));\n          return null;\n        }\n      },\n\n      updateVehicle: async (id, data) => {\n        // Save original for rollback\n        const originalVehicle = get().vehicles.find((v) => v.id === id);\n        if (!originalVehicle) return;\n\n        // Optimistic update immediately\n        set((state) => ({\n          vehicles: state.vehicles.map((v) =>\n            v.id === id ? { ...v, ...data, updatedAt: new Date().toISOString() } : v\n          ),\n        }));\n\n        try {\n          // Call API in background\n          await vehiclesApi.update(id, {\n            plate_number: data.plateNumber,\n            brand: data.brand,\n            model: data.model,\n            color: data.color,\n            year: data.year,\n            vehicle_type: data.type,\n            owner_type: data.ownerType,\n            company_name: data.companyName,\n            parking_spot: data.parkingSpot,\n            notes: data.notes,\n          });\n        } catch (error) {\n          console.error('Failed to update vehicle:', error);\n          // Rollback on error\n          set((state) => ({\n            vehicles: state.vehicles.map((v) =>\n              v.id === id ? originalVehicle : v\n            ),\n          }));\n        }\n      },\n\n      deleteVehicle: async (id) => {\n        // Save for rollback\n        const deletedVehicle = get().vehicles.find((v) => v.id === id);\n\n        // Optimistic delete immediately\n        set((state) => ({\n          vehicles: state.vehicles.filter((v) => v.id !== id),\n        }));\n\n        try {\n          // Call API in background\n          await vehiclesApi.delete(id);\n        } catch (error) {\n          console.error('Failed to delete vehicle:', error);\n          // Rollback on error - restore deleted vehicle\n          if (deletedVehicle) {\n            set((state) => ({\n              vehicles: [...state.vehicles, deletedVehicle],\n            }));\n          }\n        }\n      },\n\n      getVehiclesByOwner: (ownerId) => {\n        return get().vehicles.filter((v) => v.ownerId === ownerId);\n      },\n\n      searchVehicleByPlate: async (plateNumber) => {\n        try {\n          // Call API to search vehicles (returns all fields + owner info)\n          const response = await vehiclesApi.search(plateNumber);\n          if (response.vehicles && response.vehicles.length > 0) {\n            const v = response.vehicles[0];\n            return {\n              id: v.id,\n              ownerId: v.user_id,\n              ownerName: v.owner_name || '',\n              ownerPhone: v.owner_phone || '',\n              apartment: v.apartment || '',\n              address: v.address || '',\n              plateNumber: v.plate_number,\n              brand: v.brand || '',\n              model: v.model || '',\n              color: v.color || '',\n              year: v.year || undefined,\n              type: (v.vehicle_type || 'car') as Vehicle['type'],\n              ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\n              companyName: v.company_name || undefined,\n              parkingSpot: v.parking_spot || undefined,\n              notes: v.notes || undefined,\n              createdAt: v.created_at,\n              updatedAt: v.updated_at || undefined,\n            } as Vehicle;\n          }\n          return undefined;\n        } catch (error) {\n          console.error('Failed to search vehicle:', error);\n          // Fallback to local search\n          const normalized = plateNumber.toUpperCase().replace(/\\s+/g, '');\n          return get().vehicles.find((v) =>\n            v.plateNumber.toUpperCase().replace(/\\s+/g, '') === normalized\n          );\n        }\n      },\n\n      searchVehiclesByPlate: async (plateNumber) => {\n        try {\n          const response = await vehiclesApi.search(plateNumber);\n          if (response.vehicles && response.vehicles.length > 0) {\n            return response.vehicles.map((v: any) => ({\n              id: v.id,\n              ownerId: v.user_id,\n              ownerName: v.owner_name || '',\n              ownerPhone: v.owner_phone || '',\n              apartment: v.apartment || '',\n              address: v.address || '',\n              plateNumber: v.plate_number,\n              brand: v.brand || '',\n              model: v.model || '',\n              color: v.color || '',\n              year: v.year || undefined,\n              type: (v.vehicle_type || 'car') as Vehicle['type'],\n              ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\n              companyName: v.company_name || undefined,\n              parkingSpot: v.parking_spot || undefined,\n              notes: v.notes || undefined,\n              createdAt: v.created_at,\n              updatedAt: v.updated_at || undefined,\n            } as Vehicle));\n          }\n          return [];\n        } catch (error) {\n          console.error('Failed to search vehicles:', error);\n          return [];\n        }\n      },\n\n      // Announcement actions\n      addAnnouncement: async (announcementData) => {\n        try {\n          const { announcementsApi } = await import('../services/api');\n\n          // Build target for API\n          const target = announcementData.target;\n          const apiData = {\n            title: announcementData.title,\n            content: announcementData.content,\n            type: announcementData.type as 'residents' | 'employees' | 'all',\n            priority: announcementData.priority,\n            expires_at: announcementData.expiresAt,\n            target_type: target?.type,\n            target_branch: target?.branchId,\n            target_building_id: target?.buildingId,\n            target_entrance: target?.entrance,\n            target_floor: target?.floor,\n            target_logins: target?.customLogins?.join(','),\n            attachments: announcementData.attachments,\n          };\n\n          const result = await announcementsApi.create(apiData);\n\n          // Refetch announcements from server to avoid duplicates\n          await get().fetchAnnouncements();\n\n          // Return the created announcement info\n          const newAnnouncement: Announcement = {\n            ...announcementData,\n            id: (result as any).id || generateId(),\n            createdAt: new Date().toISOString(),\n            isActive: true,\n            viewedBy: [],\n          };\n\n          console.log('[DataStore] Announcement created via API:', newAnnouncement.id);\n          return newAnnouncement;\n        } catch (error) {\n          console.error('[DataStore] Failed to create announcement via API:', error);\n          // Fallback to local-only (for demo mode)\n          const newAnnouncement: Announcement = {\n            ...announcementData,\n            id: generateId(),\n            createdAt: new Date().toISOString(),\n            isActive: true,\n            viewedBy: [],\n          };\n          set((state) => ({ announcements: [newAnnouncement, ...state.announcements] }));\n          return newAnnouncement;\n        }\n      },\n\n      updateAnnouncement: async (id, data) => {\n        // Update local state immediately\n        set((state) => ({\n          announcements: state.announcements.map((a) =>\n            a.id === id ? { ...a, ...data } : a\n          ),\n        }));\n\n        // Sync with API\n        try {\n          const { announcementsApi } = await import('../services/api');\n          await announcementsApi.update(id, {\n            title: data.title,\n            content: data.content,\n            type: data.type,\n            priority: data.priority,\n            target_type: data.target?.type,\n            target_building_id: data.target?.buildingId,\n            target_entrance: data.target?.entrance,\n            target_floor: data.target?.floor,\n            target_logins: data.target?.customLogins?.join(','),\n            expires_at: data.expiresAt,\n          });\n          console.log('[DataStore] Announcement updated via API:', id);\n        } catch (error) {\n          console.error('[DataStore] Failed to update announcement via API:', error);\n        }\n      },\n\n      deleteAnnouncement: async (id) => {\n        try {\n          const { announcementsApi } = await import('../services/api');\n          await announcementsApi.delete(id);\n          console.log('[DataStore] Announcement deleted via API:', id);\n        } catch (error) {\n          console.error('[DataStore] Failed to delete announcement via API:', error);\n        }\n        set((state) => ({\n          announcements: state.announcements.filter((a) => a.id !== id),\n        }));\n      },\n\n      markAnnouncementAsViewed: async (announcementId, userId) => {\n        // Save to localStorage for persistence across page reloads (backup)\n        const readAnnouncementsKey = `read_announcements_${userId}`;\n        const readAnnouncements = JSON.parse(localStorage.getItem(readAnnouncementsKey) || '[]');\n        if (!readAnnouncements.includes(announcementId)) {\n          readAnnouncements.push(announcementId);\n          localStorage.setItem(readAnnouncementsKey, JSON.stringify(readAnnouncements));\n        }\n\n        // Update local state immediately\n        set((state) => ({\n          announcements: state.announcements.map((a) =>\n            a.id === announcementId && !a.viewedBy.includes(userId)\n              ? { ...a, viewedBy: [...a.viewedBy, userId] }\n              : a\n          ),\n        }));\n\n        // Sync with API in background\n        try {\n          const { announcementsApi } = await import('../services/api');\n          await announcementsApi.markAsViewed(announcementId);\n          console.log('[DataStore] Announcement view synced to API:', announcementId);\n        } catch (error) {\n          console.error('[DataStore] Failed to sync announcement view:', error);\n        }\n      },\n\n      getAnnouncementsForResidents: (userLogin: string, buildingId?: string, entrance?: string, floor?: string, branch?: string) => {\n        const now = new Date();\n        return get().announcements.filter((a) => {\n          // Basic filters - show 'residents' and 'all' types\n          if ((a.type !== 'residents' && a.type !== 'all') || !a.isActive) return false;\n          if (a.expiresAt && new Date(a.expiresAt) <= now) return false;\n\n          // If no targeting, show to all\n          if (!a.target || a.target.type === 'all') return true;\n\n          // Check targeting\n          switch (a.target.type) {\n            case 'building':\n              // Show if user's building matches\n              return buildingId && a.target.buildingId === buildingId;\n\n            case 'entrance':\n              // Show if user's building AND entrance match\n              return buildingId === a.target.buildingId && entrance === a.target.entrance;\n\n            case 'floor':\n              // Show if user's building, entrance AND floor match\n              return buildingId === a.target.buildingId &&\n                     entrance === a.target.entrance &&\n                     floor === a.target.floor;\n\n            case 'custom':\n              // Check if user's login is in the custom list\n              return a.target.customLogins?.includes(userLogin) || false;\n\n            case 'branch':\n              // Branch filtering is done on the server side\n              // If we got this announcement from API, it means user is in the target branch\n              // Only filter locally if branch is provided (for offline mode)\n              return !branch || a.target.branchId === branch;\n\n            default:\n              return true;\n          }\n        });\n      },\n\n      getAnnouncementsForEmployees: () => {\n        const now = new Date();\n        return get().announcements.filter((a) =>\n          (a.type === 'employees' || a.type === 'all') &&\n          a.isActive &&\n          (!a.expiresAt || new Date(a.expiresAt) > now)\n        );\n      },\n\n      getAnnouncementsByAuthor: (authorId) => {\n        return get().announcements.filter((a) => a.authorId === authorId);\n      },\n\n      fetchAnnouncements: async () => {\n        try {\n          const { announcementsApi } = await import('../services/api');\n          const result = await announcementsApi.getAll();\n          const authState = JSON.parse(localStorage.getItem('uk-auth-storage') || '{}');\n          const userId = authState?.state?.user?.id;\n\n          const announcements: Announcement[] = (result.announcements || []).map((a: any) => {\n            // Use API view_count and viewed_by_user if available\n            const viewedByUser = a.viewed_by_user === true || a.viewed_by_user === 1;\n\n            // Build viewedBy array - include current user if they viewed\n            const viewedBy: string[] = [];\n            if (viewedByUser && userId) {\n              viewedBy.push(userId);\n            }\n\n            // Also check localStorage as fallback\n            if (userId) {\n              const readAnnouncementsKey = `read_announcements_${userId}`;\n              const readAnnouncements: string[] = JSON.parse(localStorage.getItem(readAnnouncementsKey) || '[]');\n              if (readAnnouncements.includes(a.id) && !viewedBy.includes(userId)) {\n                viewedBy.push(userId);\n              }\n            }\n\n            // Parse attachments from JSON string\n            let attachments = undefined;\n            if (a.attachments) {\n              try {\n                attachments = typeof a.attachments === 'string'\n                  ? JSON.parse(a.attachments)\n                  : a.attachments;\n              } catch {\n                attachments = undefined;\n              }\n            }\n\n            // Map 'staff' from API back to 'employees' for UI compatibility\n            const typeForUI = a.type === 'staff' ? 'employees' : a.type;\n            return {\n              id: a.id,\n              title: a.title,\n              content: a.content,\n              type: typeForUI as 'residents' | 'employees' | 'all',\n              priority: a.priority || 'normal',\n              authorId: a.created_by || '',\n              authorName: a.author_name || '',\n              authorRole: 'manager' as const,\n              createdAt: a.created_at,\n              expiresAt: a.expires_at,\n              isActive: a.is_active === 1,\n              viewedBy,\n              viewCount: a.view_count || 0, // Total view count from API\n              attachments, // File attachments\n              target: a.target_type ? {\n                type: a.target_type,\n                branchId: a.target_branch,\n                buildingId: a.target_building_id,\n                entrance: a.target_entrance,\n                floor: a.target_floor,\n                customLogins: a.target_logins?.split(',').filter(Boolean),\n              } : undefined,\n            };\n          });\n\n          set({ announcements });\n          console.log('[DataStore] Fetched', announcements.length, 'announcements from API');\n        } catch (error) {\n          console.error('[DataStore] Failed to fetch announcements:', error);\n        }\n      },\n\n      // Rental apartment actions - now using real API\n      fetchRentals: async () => {\n        try {\n          const [apartmentsRes, recordsRes] = await Promise.all([\n            rentalsApi.getApartments(),\n            rentalsApi.getRecords(),\n          ]);\n          set({\n            rentalApartments: apartmentsRes.apartments || [],\n            rentalRecords: recordsRes.records || [],\n          });\n          console.log('[DataStore] Fetched', apartmentsRes.apartments?.length || 0, 'rental apartments from API');\n        } catch (error) {\n          console.error('[DataStore] Failed to fetch rentals:', error);\n        }\n      },\n\n      // For tenants/commercial_owners to fetch their own apartments\n      fetchMyRentals: async () => {\n        try {\n          const response = await rentalsApi.getMyApartments();\n          set({\n            rentalApartments: response.apartments || [],\n            rentalRecords: response.records || [],\n          });\n          console.log('[DataStore] Fetched', response.apartments?.length || 0, 'my rental apartments from API');\n        } catch (error) {\n          console.error('[DataStore] Failed to fetch my rentals:', error);\n        }\n      },\n\n      addRentalApartment: async (apartmentData) => {\n        try {\n          const response = await rentalsApi.createApartment({\n            name: apartmentData.name,\n            address: apartmentData.address,\n            apartment: apartmentData.apartment,\n            ownerName: apartmentData.ownerName,\n            ownerPhone: apartmentData.ownerPhone,\n            ownerLogin: apartmentData.ownerLogin,\n            ownerPassword: apartmentData.password,\n            ownerType: apartmentData.ownerType || 'tenant',\n          });\n\n          console.log('[DataStore] API response:', response);\n          if (response.apartment) {\n            set((state) => ({ rentalApartments: [...state.rentalApartments, response.apartment] }));\n            return response.apartment;\n          }\n          console.error('[DataStore] No apartment in response:', response);\n          return null;\n        } catch (error: any) {\n          console.error('[DataStore] Failed to create rental apartment:', error);\n          console.error('[DataStore] Error details:', error.message, error.stack);\n          throw error; // Re-throw to allow UI to show the error\n        }\n      },\n\n      updateRentalApartment: async (id, data) => {\n        try {\n          await rentalsApi.updateApartment(id, data);\n          set((state) => ({\n            rentalApartments: state.rentalApartments.map((a) =>\n              a.id === id ? { ...a, ...data } : a\n            ),\n          }));\n        } catch (error) {\n          console.error('[DataStore] Failed to update rental apartment:', error);\n        }\n      },\n\n      deleteRentalApartment: async (id) => {\n        try {\n          await rentalsApi.deleteApartment(id);\n          set((state) => ({\n            rentalApartments: state.rentalApartments.filter((a) => a.id !== id),\n            rentalRecords: state.rentalRecords.filter((r) => r.apartmentId !== id),\n          }));\n        } catch (error) {\n          console.error('[DataStore] Failed to delete rental apartment:', error);\n        }\n      },\n\n      getRentalApartmentsByOwner: (ownerId) => {\n        return get().rentalApartments.filter((a) => a.ownerId === ownerId);\n      },\n\n      addRentalRecord: async (recordData) => {\n        try {\n          const response = await rentalsApi.createRecord({\n            apartmentId: recordData.apartmentId,\n            guestNames: recordData.guestNames,\n            passportInfo: recordData.passportInfo,\n            checkInDate: recordData.checkInDate,\n            checkOutDate: recordData.checkOutDate,\n            amount: recordData.amount,\n            currency: recordData.currency,\n            notes: recordData.notes,\n          });\n\n          if (response.record) {\n            set((state) => ({ rentalRecords: [response.record, ...state.rentalRecords] }));\n            return response.record;\n          }\n          return null;\n        } catch (error) {\n          console.error('[DataStore] Failed to create rental record:', error);\n          return null;\n        }\n      },\n\n      updateRentalRecord: async (id, data) => {\n        try {\n          await rentalsApi.updateRecord(id, data);\n          set((state) => ({\n            rentalRecords: state.rentalRecords.map((r) =>\n              r.id === id ? { ...r, ...data } : r\n            ),\n          }));\n        } catch (error) {\n          console.error('[DataStore] Failed to update rental record:', error);\n        }\n      },\n\n      deleteRentalRecord: async (id) => {\n        try {\n          await rentalsApi.deleteRecord(id);\n          set((state) => ({\n            rentalRecords: state.rentalRecords.filter((r) => r.id !== id),\n          }));\n        } catch (error) {\n          console.error('[DataStore] Failed to delete rental record:', error);\n        }\n      },\n\n      getRentalRecordsByApartment: (apartmentId) => {\n        return get().rentalRecords.filter((r) => r.apartmentId === apartmentId);\n      },\n\n      addExecutor: async (executorData) => {\n        try {\n          // Call real API to register user\n          const response = await authApi.register({\n            login: executorData.login,\n            password: executorData.password,\n            name: executorData.name,\n            role: executorData.role || 'executor',\n            phone: executorData.phone,\n            specialization: executorData.specialization,\n          });\n\n          if (response.user) {\n            const newExecutor: Executor = {\n              id: response.user.id,\n              name: response.user.name,\n              phone: response.user.phone || executorData.phone,\n              login: response.user.login,\n              specialization: response.user.specialization || executorData.specialization,\n              createdAt: new Date().toISOString(),\n              rating: 5.0,\n              completedCount: 0,\n              activeRequests: 0,\n              totalEarnings: 0,\n              avgCompletionTime: 0,\n              status: 'offline',\n            };\n\n            // Add locally first for immediate UI update\n            set((state) => ({ executors: [...state.executors, newExecutor] }));\n\n            // Then refetch from server to ensure sync\n            get().fetchExecutors();\n\n            return newExecutor;\n          }\n          return null;\n        } catch (error: any) {\n          console.error('Failed to add executor:', error);\n          throw error; // Re-throw so UI can show error message\n        }\n      },\n\n      updateExecutor: (id, data) => {\n        set((state) => ({\n          executors: state.executors.map((e) =>\n            e.id === id ? { ...e, ...data } : e\n          ),\n        }));\n      },\n\n      deleteExecutor: async (id) => {\n        try {\n          await usersApi.delete(id);\n          set((state) => ({\n            executors: state.executors.filter((e) => e.id !== id),\n          }));\n        } catch (error) {\n          console.error('Failed to delete executor:', error);\n          throw error;\n        }\n      },\n\n      getExecutorStats: (executorId) => {\n        const { requests } = get();\n        const executorRequests = requests.filter(r => r.executorId === executorId);\n        const completed = executorRequests.filter(r => r.status === 'completed');\n        const now = new Date();\n        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n        const thisWeek = completed.filter(r => r.approvedAt && new Date(r.approvedAt) >= weekAgo).length;\n        const thisMonth = completed.filter(r => r.approvedAt && new Date(r.approvedAt) >= monthAgo).length;\n\n        const ratings = completed.filter(r => r.rating).map(r => r.rating!);\n        const avgRating = ratings.length > 0 ? ratings.reduce((a, b) => a + b, 0) / ratings.length : 5;\n\n        const times = completed.filter(r => r.workDuration).map(r => r.workDuration!);\n        const avgTime = times.length > 0 ? Math.round(times.reduce((a, b) => a + b, 0) / times.length / 60) : 0;\n\n        return {\n          totalRequests: executorRequests.length,\n          completedRequests: completed.length,\n          avgRating: Math.round(avgRating * 10) / 10,\n          avgTime,\n          thisWeek,\n          thisMonth,\n        };\n      },\n\n      addRequest: async (requestData) => {\n        // Generate temp ID and number for optimistic update\n        const tempId = `temp-${generateId()}`;\n        const tempNumber = `#${tempId.substring(5, 11).toUpperCase()}`;\n        const now = new Date().toISOString();\n\n        // Create optimistic request immediately\n        const optimisticRequest: Request = {\n          id: tempId,\n          number: tempNumber,\n          title: requestData.title,\n          description: requestData.description || '',\n          category: requestData.category,\n          status: 'new',\n          priority: requestData.priority || 'medium',\n          residentId: requestData.residentId,\n          residentName: requestData.residentName,\n          residentPhone: requestData.residentPhone,\n          address: requestData.address,\n          apartment: requestData.apartment,\n          accessInfo: requestData.accessInfo,\n          scheduledDate: requestData.scheduledDate,\n          scheduledTime: requestData.scheduledTime,\n          createdAt: now,\n        };\n\n        // Add to UI immediately (optimistic)\n        set((state) => ({ requests: [optimisticRequest, ...state.requests] }));\n\n        // Add notification for managers immediately\n        get().addNotification({\n          userId: 'manager',\n          type: 'request_created',\n          title: ' ',\n          message: ` ${tempNumber}: ${requestData.title}`,\n          requestId: tempId,\n        });\n\n        try {\n          // Call API in background\n          const response = await requestsApi.create({\n            category_id: requestData.category,\n            title: requestData.title,\n            description: requestData.description,\n            priority: requestData.priority,\n            access_info: requestData.accessInfo,\n            scheduled_at: requestData.scheduledDate && requestData.scheduledTime\n              ? `${requestData.scheduledDate}T${requestData.scheduledTime}:00`\n              : undefined,\n            // For manual creation by managers - pass the resident_id\n            resident_id: requestData.residentId,\n          });\n\n          // Replace temp with real data\n          const apiRequest = response.request;\n          const realRequest: Request = {\n            id: apiRequest.id,\n            number: apiRequest.request_number || apiRequest.number,\n            title: apiRequest.title,\n            description: apiRequest.description,\n            category: apiRequest.category_id,\n            status: apiRequest.status,\n            priority: apiRequest.priority || 'medium',\n            residentId: apiRequest.resident_id,\n            residentName: apiRequest.resident_name,\n            residentPhone: apiRequest.resident_phone,\n            address: apiRequest.address,\n            apartment: apiRequest.apartment,\n            createdAt: apiRequest.created_at,\n          };\n\n          // Replace optimistic with real\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === tempId ? realRequest : r\n            ),\n          }));\n\n          // Add activity log\n          get().addActivityLog({\n            userId: requestData.residentId,\n            userName: requestData.residentName,\n            userRole: 'resident',\n            action: ' ',\n            details: ` #${realRequest.number}: ${realRequest.title}`,\n            requestId: realRequest.id,\n          });\n\n          return realRequest;\n        } catch (error) {\n          console.error('Failed to create request:', error);\n          // Rollback on error\n          set((state) => ({\n            requests: state.requests.filter((r) => r.id !== tempId),\n          }));\n          return null;\n        }\n      },\n\n      assignRequest: async (requestId, executorId) => {\n        const state = get();\n        const executor = state.executors.find(e => e.id === executorId);\n        const request = state.requests.find(r => r.id === requestId);\n\n        if (!request) {\n          console.error('[assignRequest] Request not found in local state!');\n          return;\n        }\n\n        const { user } = useAuthStore.getState();\n        const isSelfAssign = user?.role === 'executor' && user?.id === executorId;\n        const executorName = executor?.name || '';\n        const executorPhone = executor?.phone || '';\n\n        // Save original state for rollback\n        const originalRequest = { ...request };\n        const originalExecutor = executor ? { ...executor } : null;\n\n        // OPTIMISTIC UPDATE - immediately update UI\n        set((state) => ({\n          requests: state.requests.map((r) =>\n            r.id === requestId\n              ? {\n                  ...r,\n                  status: 'assigned' as const,\n                  executorId,\n                  executorName,\n                  executorPhone,\n                  executorRating: executor?.rating || 5.0,\n                  assignedAt: new Date().toISOString(),\n                }\n              : r\n          ),\n          executors: state.executors.map((e) =>\n            e.id === executorId\n              ? { ...e, status: 'busy' as const, activeRequests: (e.activeRequests || 0) + 1 }\n              : e\n          ),\n        }));\n\n        // Send notifications immediately\n        if (isSelfAssign) {\n          get().addNotification({\n            userId: 'manager1',\n            type: 'request_assigned',\n            title: '  ',\n            message: `${executorName}   #${request.number}: ${request.title}`,\n            requestId,\n          });\n          get().addActivityLog({\n            userId: executorId,\n            userName: executorName,\n            userRole: 'executor',\n            action: ' ',\n            details: ` #${request.number}: ${request.title}`,\n            requestId,\n          });\n        } else {\n          get().addNotification({\n            userId: executorId,\n            type: 'request_assigned',\n            title: '  ',\n            message: `   #${request.number}: ${request.title}`,\n            requestId,\n          });\n          get().addActivityLog({\n            userId: user?.id || 'system',\n            userName: user?.name || '',\n            userRole: user?.role || 'manager',\n            action: ' ',\n            details: ` #${request.number}  ${executorName}`,\n            requestId,\n          });\n        }\n\n        try {\n          // Call API in background\n          await requestsApi.assign(requestId, executorId);\n        } catch (error) {\n          console.error('Failed to assign request:', error);\n          // Rollback on error\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId ? originalRequest : r\n            ),\n            executors: originalExecutor\n              ? state.executors.map((e) =>\n                  e.id === executorId ? originalExecutor : e\n                )\n              : state.executors,\n          }));\n        }\n      },\n\n      acceptRequest: async (requestId) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request) return;\n\n        // Save original for rollback\n        const originalRequest = { ...request };\n\n        // OPTIMISTIC UPDATE - immediately update UI\n        set((state) => ({\n          requests: state.requests.map((r) =>\n            r.id === requestId\n              ? { ...r, status: 'accepted' as const, acceptedAt: new Date().toISOString() }\n              : r\n          ),\n        }));\n\n        // Send notifications immediately\n        get().addNotification({\n          userId: request.residentId,\n          type: 'request_accepted',\n          title: ' ',\n          message: ` ${request.executorName}    #${request.number}`,\n          requestId,\n        });\n        get().addNotification({\n          userId: 'manager',\n          type: 'request_accepted',\n          title: '  ',\n          message: `${request.executorName}   #${request.number}`,\n          requestId,\n        });\n        get().addActivityLog({\n          userId: request.executorId!,\n          userName: request.executorName!,\n          userRole: 'executor',\n          action: ' ',\n          details: ` #${request.number}`,\n          requestId,\n        });\n\n        try {\n          // Call API in background\n          await requestsApi.accept(requestId);\n        } catch (error) {\n          console.error('Failed to accept request:', error);\n          // Rollback on error\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId ? originalRequest : r\n            ),\n          }));\n        }\n      },\n\n      startWork: async (requestId) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request) return;\n\n        // Check if executor already has a task in progress\n        const executorId = request.executorId;\n        if (executorId) {\n          const hasActiveWork = state.requests.some(\n            r => r.executorId === executorId && r.status === 'in_progress' && r.id !== requestId\n          );\n          if (hasActiveWork) {\n            console.error('Executor already has a task in progress. Complete it first.');\n            return;\n          }\n        }\n\n        // Save original for rollback\n        const originalRequest = { ...request };\n\n        // OPTIMISTIC UPDATE - immediately update UI\n        set((state) => ({\n          requests: state.requests.map((r) =>\n            r.id === requestId\n              ? { ...r, status: 'in_progress' as const, startedAt: new Date().toISOString() }\n              : r\n          ),\n        }));\n\n        // Send notifications immediately\n        get().addNotification({\n          userId: request.residentId,\n          type: 'request_started',\n          title: ' ',\n          message: ` ${request.executorName}     #${request.number}`,\n          requestId,\n        });\n        get().addActivityLog({\n          userId: request.executorId!,\n          userName: request.executorName!,\n          userRole: 'executor',\n          action: ' ',\n          details: ` #${request.number}`,\n          requestId,\n        });\n\n        try {\n          // Call API in background\n          await requestsApi.start(requestId);\n        } catch (error) {\n          console.error('Failed to start work:', error);\n          // Rollback on error\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId ? originalRequest : r\n            ),\n          }));\n        }\n      },\n\n      pauseWork: async (requestId) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request || request.status !== 'in_progress' || request.isPaused) return;\n\n        try {\n          // Call API to pause work in D1 database\n          await requestsApi.pause(requestId);\n\n          // Update local state\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId\n                ? { ...r, isPaused: true, pausedAt: new Date().toISOString() }\n                : r\n            ),\n          }));\n\n          // Activity log\n          get().addActivityLog({\n            userId: request.executorId!,\n            userName: request.executorName!,\n            userRole: 'executor',\n            action: ' ',\n            details: ` #${request.number}`,\n            requestId,\n          });\n        } catch (error) {\n          console.error('Failed to pause work:', error);\n        }\n      },\n\n      resumeWork: async (requestId) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request || request.status !== 'in_progress' || !request.isPaused) return;\n\n        try {\n          // Call API to resume work in D1 database\n          const result = await requestsApi.resume(requestId);\n\n          // Use totalPausedTime from server response for accuracy\n          const totalPausedTime = result.totalPausedTime || (request.totalPausedTime || 0);\n\n          // Update local state\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId\n                ? { ...r, isPaused: false, pausedAt: undefined, totalPausedTime }\n                : r\n            ),\n          }));\n\n          // Activity log\n          get().addActivityLog({\n            userId: request.executorId!,\n            userName: request.executorName!,\n            userRole: 'executor',\n            action: ' ',\n            details: ` #${request.number}`,\n            requestId,\n          });\n        } catch (error) {\n          console.error('Failed to resume work:', error);\n        }\n      },\n\n      completeWork: async (requestId, workDuration) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request) return;\n\n        const wasRejected = !!request.rejectionReason;\n\n        try {\n          // Call API to complete work in D1 database\n          await requestsApi.complete(requestId);\n\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId\n                ? {\n                    ...r,\n                    status: 'pending_approval' as const,\n                    completedAt: new Date().toISOString(),\n                    workDuration,\n                    // Clear pause and rejection info when work is completed\n                    isPaused: undefined,\n                    pausedAt: undefined,\n                    rejectedAt: undefined,\n                    rejectionReason: undefined,\n                  }\n                : r\n            ),\n          }));\n\n          // Different message if this is a re-submission after rejection\n          const notifyMessage = wasRejected\n            ? `     #${request.number}. ,   .`\n            : `     #${request.number}. ,  .`;\n\n          get().addNotification({\n            userId: request.residentId,\n            type: 'request_completed',\n            title: wasRejected ? ' ' : ' ',\n            message: notifyMessage,\n            requestId,\n          });\n\n          // Push-   ( -  )\n          const { user } = useAuthStore.getState();\n          if (user?.id === request.residentId) {\n            //     -  push\n            pushNotifications.notifyRequestCompleted(\n              request.number,\n              request.executorName || '',\n              requestId\n            );\n          }\n\n          get().addNotification({\n            userId: 'manager',\n            type: 'request_completed',\n            title: ' ',\n            message: `${request.executorName}   #${request.number}.   .`,\n            requestId,\n          });\n\n          get().addActivityLog({\n            userId: request.executorId!,\n            userName: request.executorName!,\n            userRole: 'executor',\n            action: ' ',\n            details: ` #${request.number},  : ${Math.round(workDuration / 60)} `,\n            requestId,\n          });\n        } catch (error) {\n          console.error('Failed to complete work:', error);\n        }\n      },\n\n      approveRequest: async (requestId, rating, feedback) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request) return;\n\n        try {\n          // Call API to approve request in D1 database\n          await requestsApi.approve(requestId, rating, feedback);\n\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId\n                ? {\n                    ...r,\n                    status: 'completed' as const,\n                    approvedAt: new Date().toISOString(),\n                    rating,\n                    feedback,\n                  }\n                : r\n            ),\n          }));\n\n          // Update executor stats (local)\n          if (request.executorId) {\n            const executor = state.executors.find(e => e.id === request.executorId);\n            if (executor) {\n              const completedRequests = state.requests.filter(\n                r => r.executorId === request.executorId && r.status === 'completed'\n              );\n              const ratings = [...completedRequests.map(r => r.rating || 5), rating];\n              const newRating = ratings.reduce((a, b) => a + b, 0) / ratings.length;\n\n              set((state) => ({\n                executors: state.executors.map((e) =>\n                  e.id === request.executorId\n                    ? {\n                        ...e,\n                        completedCount: e.completedCount + 1,\n                        rating: Math.round(newRating * 10) / 10,\n                        totalEarnings: e.totalEarnings + 100000,\n                      }\n                    : e\n                ),\n              }));\n            }\n          }\n\n          get().addNotification({\n            userId: request.executorId!,\n            type: 'request_approved',\n            title: ' ',\n            message: ` #${request.number} . : ${rating}/5`,\n            requestId,\n          });\n\n          get().addActivityLog({\n            userId: request.residentId,\n            userName: request.residentName,\n            userRole: 'resident',\n            action: ' ',\n            details: ` #${request.number}, : ${rating}/5`,\n            requestId,\n          });\n        } catch (error) {\n          console.error('Failed to approve request:', error);\n        }\n      },\n\n      rejectRequest: async (requestId, reason) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request) return;\n\n        try {\n          // Call API to reject request in D1 database\n          await requestsApi.reject(requestId, reason);\n\n          const newRejectionCount = (request.rejectionCount || 0) + 1;\n\n          // Return to in_progress status but keep rejection info visible\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId\n                ? {\n                    ...r,\n                    status: 'in_progress' as const,\n                    completedAt: undefined,\n                    workDuration: undefined,\n                    rejectedAt: new Date().toISOString(),\n                    rejectionReason: reason,\n                    rejectionCount: newRejectionCount,\n                  }\n                : r\n            ),\n          }));\n\n          // Activity log\n          get().addActivityLog({\n            userId: request.residentId,\n            userName: request.residentName,\n            userRole: 'resident',\n            action: ' ',\n            details: ` #${request.number}, : ${reason}`,\n            requestId,\n          });\n        } catch (error) {\n          console.error('Failed to reject request:', error);\n        }\n      },\n\n      cancelRequest: async (requestId, cancelledBy, reason) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request) return;\n\n        const { user } = useAuthStore.getState();\n        const cancellerName = user?.name || '';\n\n        // Check if cancellation is allowed\n        // Residents can cancel only before work starts (new, assigned, accepted)\n        // Managers/Admins can cancel any request not completed\n        const canResidentCancel = ['new', 'assigned', 'accepted'].includes(request.status);\n        const canManagerCancel = request.status !== 'completed';\n\n        if (cancelledBy === 'resident' && !canResidentCancel) {\n          console.error('Resident cannot cancel request in this status');\n          return;\n        }\n\n        if ((cancelledBy === 'manager' || cancelledBy === 'admin') && !canManagerCancel) {\n          console.error('Cannot cancel completed request');\n          return;\n        }\n\n        const previousExecutorId = request.executorId;\n\n        // Call API to persist cancellation\n        try {\n          await requestsApi.cancel(requestId, reason);\n        } catch (error) {\n          console.error('Failed to cancel request on server:', error);\n          // Continue with local update even if API fails\n        }\n\n        set((state) => ({\n          requests: state.requests.map((r) =>\n            r.id === requestId\n              ? {\n                  ...r,\n                  status: 'cancelled' as const,\n                  cancelledAt: new Date().toISOString(),\n                  cancelledBy,\n                  cancellationReason: reason,\n                }\n              : r\n          ),\n        }));\n\n        // Update executor's active request count if there was one\n        if (previousExecutorId) {\n          const activeCount = state.requests.filter(\n            r => r.executorId === previousExecutorId && ['assigned', 'accepted', 'in_progress'].includes(r.status) && r.id !== requestId\n          ).length;\n\n          set((state) => ({\n            executors: state.executors.map((e) =>\n              e.id === previousExecutorId\n                ? { ...e, activeRequests: activeCount, status: activeCount > 0 ? 'busy' : 'available' }\n                : e\n            ),\n          }));\n        }\n\n        // Notifications based on who cancelled\n        const cancellerLabels: Record<CancelledBy, string> = {\n          resident: '',\n          executor: '',\n          manager: '',\n          admin: '',\n        };\n\n        // Notify resident (if not cancelled by resident)\n        if (cancelledBy !== 'resident') {\n          get().addNotification({\n            userId: request.residentId,\n            type: 'request_cancelled',\n            title: ' ',\n            message: ` #${request.number}  . : ${reason}`,\n            requestId,\n          });\n        }\n\n        // Notify executor (if assigned and not cancelled by executor)\n        if (previousExecutorId && cancelledBy !== 'executor') {\n          get().addNotification({\n            userId: previousExecutorId,\n            type: 'request_cancelled',\n            title: ' ',\n            message: ` #${request.number}   ${cancellerLabels[cancelledBy]}. : ${reason}`,\n            requestId,\n          });\n        }\n\n        // Notify manager (if not cancelled by manager/admin)\n        if (cancelledBy === 'resident' || cancelledBy === 'executor') {\n          get().addNotification({\n            userId: 'manager1',\n            type: 'request_cancelled',\n            title: ' ',\n            message: `${cancellerLabels[cancelledBy]}   #${request.number}. : ${reason}`,\n            requestId,\n          });\n        }\n\n        // Activity log\n        get().addActivityLog({\n          userId: user?.id || 'system',\n          userName: cancellerName,\n          userRole: cancelledBy,\n          action: ' ',\n          details: ` #${request.number}: ${reason}`,\n          requestId,\n        });\n      },\n\n      declineRequest: async (requestId, reason) => {\n        // Executor declines/releases an assigned request - returns it to 'new' status\n        const state = get();\n        const request = state.requests.find(r => r.id === requestId);\n        if (!request) return;\n\n        // Can decline if assigned, accepted, or in_progress (for illness, etc.)\n        if (!['assigned', 'accepted', 'in_progress'].includes(request.status)) {\n          console.error('Cannot decline request in this status');\n          return;\n        }\n\n        const previousExecutorId = request.executorId;\n        const executorName = request.executorName;\n\n        // Save original state for rollback\n        const originalRequest = { ...request };\n\n        // OPTIMISTIC UPDATE - immediately update UI\n        set((state) => ({\n          requests: state.requests.map((r) =>\n            r.id === requestId\n              ? {\n                  ...r,\n                  status: 'new' as const,\n                  executorId: undefined,\n                  executorName: undefined,\n                  executorPhone: undefined,\n                  executorRating: undefined,\n                  assignedAt: undefined,\n                  acceptedAt: undefined,\n                  startedAt: undefined,\n                }\n              : r\n          ),\n        }));\n\n        // Update executor's active request count\n        if (previousExecutorId) {\n          const activeCount = state.requests.filter(\n            r => r.executorId === previousExecutorId && ['assigned', 'accepted', 'in_progress'].includes(r.status) && r.id !== requestId\n          ).length;\n\n          set((state) => ({\n            executors: state.executors.map((e) =>\n              e.id === previousExecutorId\n                ? { ...e, activeRequests: activeCount, status: activeCount > 0 ? 'busy' : 'available' }\n                : e\n            ),\n          }));\n        }\n\n        // Notify resident (local notification)\n        get().addNotification({\n          userId: request.residentId,\n          type: 'request_declined',\n          title: ' ',\n          message: ` ${executorName}    #${request.number}.    .`,\n          requestId,\n        });\n\n        // Notify manager (local notification)\n        get().addNotification({\n          userId: 'manager1',\n          type: 'request_declined',\n          title: '   ',\n          message: `${executorName}    #${request.number}. : ${reason}.    .`,\n          requestId,\n        });\n\n        // Activity log\n        get().addActivityLog({\n          userId: previousExecutorId || 'system',\n          userName: executorName || '',\n          userRole: 'executor',\n          action: '  ',\n          details: ` #${request.number}: ${reason}`,\n          requestId,\n        });\n\n        try {\n          // Call API to persist the change\n          await requestsApi.decline(requestId, reason);\n        } catch (error) {\n          console.error('Failed to decline request:', error);\n          // Rollback on error\n          set((state) => ({\n            requests: state.requests.map((r) =>\n              r.id === requestId ? originalRequest : r\n            ),\n          }));\n          // Re-throw to notify caller\n          throw error;\n        }\n      },\n\n      getRequestsByResident: (residentId) => {\n        return get().requests.filter(r => r.residentId === residentId);\n      },\n\n      getRequestsByExecutor: (executorId) => {\n        return get().requests.filter(r => r.executorId === executorId);\n      },\n\n      addNotification: (notification) => {\n        const newNotification: Notification = {\n          ...notification,\n          id: generateId(),\n          read: false,\n          createdAt: new Date().toISOString(),\n        };\n        // Limit notifications to 200 to prevent memory bloat\n        set((state) => ({\n          notifications: [newNotification, ...state.notifications].slice(0, 200),\n        }));\n      },\n\n      markNotificationAsRead: (id) => {\n        set((state) => ({\n          notifications: state.notifications.map((n) =>\n            n.id === id ? { ...n, read: true } : n\n          ),\n        }));\n      },\n\n      markAllNotificationsAsRead: (userId) => {\n        set((state) => ({\n          notifications: state.notifications.map((n) =>\n            n.userId === userId ? { ...n, read: true } : n\n          ),\n        }));\n      },\n\n      getUnreadCount: (userId) => {\n        return get().notifications.filter(n => n.userId === userId && !n.read).length;\n      },\n\n      addActivityLog: (log) => {\n        const newLog: ActivityLog = {\n          ...log,\n          id: generateId(),\n          timestamp: new Date().toISOString(),\n        };\n        set((state) => ({\n          activityLogs: [newLog, ...state.activityLogs].slice(0, 100),\n        }));\n      },\n\n      getStats: () => {\n        const { requests, executors } = get();\n        const now = new Date();\n        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n        const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n        const completedRequests = requests.filter(r => r.status === 'completed' && r.approvedAt);\n        const completedToday = completedRequests.filter(r =>\n          new Date(r.approvedAt!) >= today\n        ).length;\n        const completedWeek = completedRequests.filter(r =>\n          new Date(r.approvedAt!) >= weekAgo\n        ).length;\n\n        let totalTime = 0;\n        let count = 0;\n        completedRequests.forEach(r => {\n          if (r.workDuration) {\n            totalTime += r.workDuration;\n            count++;\n          }\n        });\n        const avgCompletionTime = count > 0 ? Math.round(totalTime / count / 60) : 0;\n\n        return {\n          totalRequests: requests.length,\n          newRequests: requests.filter(r => r.status === 'new').length,\n          inProgress: requests.filter(r => ['assigned', 'accepted', 'in_progress'].includes(r.status)).length,\n          pendingApproval: requests.filter(r => r.status === 'pending_approval').length,\n          completedToday,\n          completedWeek,\n          avgCompletionTime,\n          executorsOnline: executors.filter(e => e.status !== 'offline').length,\n          executorsTotal: executors.length,\n        };\n      },\n\n      getChartData: () => {\n        const { requests } = get();\n        const now = new Date();\n        const days = ['', '', '', '', '', '', ''];\n        const chartData: ChartData[] = [];\n\n        for (let i = 6; i >= 0; i--) {\n          const date = new Date(now);\n          date.setDate(date.getDate() - i);\n          const dayStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n          const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);\n\n          const created = requests.filter(r => {\n            const createdAt = new Date(r.createdAt);\n            return createdAt >= dayStart && createdAt < dayEnd;\n          }).length;\n\n          const completed = requests.filter(r => {\n            if (!r.approvedAt) return false;\n            const approvedAt = new Date(r.approvedAt);\n            return approvedAt >= dayStart && approvedAt < dayEnd;\n          }).length;\n\n          chartData.push({\n            date: dayStart.toISOString(),\n            name: days[date.getDay() === 0 ? 6 : date.getDay() - 1],\n            created,\n            completed,\n          });\n        }\n\n        return chartData;\n      },\n\n      fetchSettings: async () => {\n        try {\n          const { settingsApi } = await import('../services/api');\n          const response = await settingsApi.getAll();\n          if (response.success && response.data?.settings) {\n            const apiSettings = response.data.settings;\n            // Map API settings to local format\n            set((state) => ({\n              settings: {\n                ...state.settings,\n                companyName: apiSettings.companyName ?? state.settings.companyName,\n                companyInn: apiSettings.companyInn ?? state.settings.companyInn,\n                companyAddress: apiSettings.companyAddress ?? state.settings.companyAddress,\n                companyPhone: apiSettings.companyPhone ?? state.settings.companyPhone,\n                routingMode: apiSettings.routingMode ?? state.settings.routingMode,\n                workingHoursStart: apiSettings.workingHoursStart ?? state.settings.workingHoursStart,\n                workingHoursEnd: apiSettings.workingHoursEnd ?? state.settings.workingHoursEnd,\n                autoAssign: apiSettings.autoAssign ?? state.settings.autoAssign,\n                notifyOnNew: apiSettings.notifyOnNew ?? state.settings.notifyOnNew,\n                notifyOnComplete: apiSettings.notifyOnComplete ?? state.settings.notifyOnComplete,\n                notifyOnRating: apiSettings.notifyOnRating ?? state.settings.notifyOnRating,\n                smsNotifications: apiSettings.smsNotifications ?? state.settings.smsNotifications,\n                emailNotifications: apiSettings.emailNotifications ?? state.settings.emailNotifications,\n                pushNotifications: apiSettings.pushNotifications ?? state.settings.pushNotifications,\n              },\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to fetch settings:', error);\n        }\n      },\n\n      updateSettings: async (newSettings) => {\n        // Optimistically update local state\n        set((state) => ({\n          settings: { ...state.settings, ...newSettings },\n        }));\n\n        // Sync to API\n        try {\n          const { settingsApi } = await import('../services/api');\n          await settingsApi.updateMany(newSettings);\n        } catch (error) {\n          console.error('Failed to save settings to API:', error);\n          // Settings already updated locally, API will sync on next fetch\n        }\n      },\n\n      // Reschedule actions - using API for cross-user sync\n      fetchPendingReschedules: async () => {\n        try {\n          const { rescheduleApi } = await import('../services/api');\n          const response = await rescheduleApi.getPending();\n          const reschedules = response.reschedules || [];\n\n          // Map API response to RescheduleRequest type\n          const mappedReschedules: RescheduleRequest[] = reschedules.map((r: any) => ({\n            id: r.id,\n            requestId: r.request_id,\n            requestNumber: r.request_number || r.request_title || `#${r.request_id?.substring(0, 6)}`,\n            initiator: r.initiator as RescheduleInitiator,\n            initiatorId: r.initiator_id,\n            initiatorName: r.initiator_name,\n            recipientId: r.recipient_id,\n            recipientName: r.recipient_name,\n            recipientRole: r.recipient_role as 'resident' | 'executor',\n            currentDate: r.current_date,\n            currentTime: r.current_time,\n            proposedDate: r.proposed_date,\n            proposedTime: r.proposed_time,\n            reason: r.reason as RescheduleReason,\n            reasonText: r.reason_text,\n            status: r.status as 'pending' | 'accepted' | 'rejected' | 'expired',\n            responseNote: r.response_note,\n            createdAt: r.created_at,\n            respondedAt: r.responded_at,\n            expiresAt: r.expires_at,\n          }));\n\n          set({ rescheduleRequests: mappedReschedules });\n        } catch (error) {\n          console.error('Failed to fetch pending reschedules:', error);\n        }\n      },\n\n      createRescheduleRequest: async (data) => {\n        const state = get();\n        const request = state.requests.find(r => r.id === data.requestId);\n        if (!request) return null;\n\n        const { user } = useAuthStore.getState();\n        if (!user) return null;\n\n        try {\n          const { requestsApi } = await import('../services/api');\n          const response = await requestsApi.createReschedule(data.requestId, {\n            proposed_date: data.proposedDate,\n            proposed_time: data.proposedTime,\n            reason: data.reason,\n            reason_text: data.reasonText,\n          });\n\n          if (response.reschedule) {\n            const r = response.reschedule;\n            const newReschedule: RescheduleRequest = {\n              id: r.id,\n              requestId: r.request_id,\n              requestNumber: request.number,\n              initiator: r.initiator as RescheduleInitiator,\n              initiatorId: r.initiator_id,\n              initiatorName: r.initiator_name,\n              recipientId: r.recipient_id,\n              recipientName: r.recipient_name,\n              recipientRole: r.recipient_role as 'resident' | 'executor',\n              currentDate: r.current_date,\n              currentTime: r.current_time,\n              proposedDate: r.proposed_date,\n              proposedTime: r.proposed_time,\n              reason: r.reason as RescheduleReason,\n              reasonText: r.reason_text,\n              status: 'pending',\n              createdAt: r.created_at,\n              expiresAt: r.expires_at,\n            };\n\n            set((state) => ({\n              rescheduleRequests: [newReschedule, ...state.rescheduleRequests],\n            }));\n\n            return newReschedule;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to create reschedule request:', error);\n          return null;\n        }\n      },\n\n      respondToRescheduleRequest: async (rescheduleId, accepted, responseNote) => {\n        const state = get();\n        const reschedule = state.rescheduleRequests.find(r => r.id === rescheduleId);\n        if (!reschedule || reschedule.status !== 'pending') return;\n\n        try {\n          const { rescheduleApi } = await import('../services/api');\n          const response = await rescheduleApi.respond(rescheduleId, accepted, responseNote);\n\n          if (response.reschedule) {\n            // Update local state\n            set((state) => ({\n              rescheduleRequests: state.rescheduleRequests.map((r) =>\n                r.id === rescheduleId\n                  ? {\n                      ...r,\n                      status: accepted ? 'accepted' as const : 'rejected' as const,\n                      respondedAt: new Date().toISOString(),\n                      responseNote,\n                    }\n                  : r\n              ),\n            }));\n\n            // If accepted, update the request's scheduled date/time\n            if (accepted) {\n              set((state) => ({\n                requests: state.requests.map((r) =>\n                  r.id === reschedule.requestId\n                    ? {\n                        ...r,\n                        scheduledDate: reschedule.proposedDate,\n                        scheduledTime: reschedule.proposedTime,\n                      }\n                    : r\n                ),\n              }));\n\n              // Refresh requests to get updated data from server\n              get().fetchRequests();\n            }\n          }\n        } catch (error) {\n          console.error('Failed to respond to reschedule request:', error);\n        }\n      },\n\n      getRescheduleRequestsByRequest: (requestId) => {\n        return get().rescheduleRequests.filter(r => r.requestId === requestId);\n      },\n\n      getPendingRescheduleForUser: (userId) => {\n        return get().rescheduleRequests.filter(\n          r => r.recipientId === userId && r.status === 'pending'\n        );\n      },\n\n      getActiveRescheduleForRequest: (requestId) => {\n        return get().rescheduleRequests.find(\n          r => r.requestId === requestId && r.status === 'pending'\n        );\n      },\n\n      getConfirmedRescheduleForRequest: (requestId) => {\n        // Find recently accepted reschedule (within last 24 hours)\n        const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000;\n        return get().rescheduleRequests.find(\n          r => r.requestId === requestId &&\n               r.status === 'accepted' &&\n               r.respondedAt &&\n               new Date(r.respondedAt).getTime() > oneDayAgo\n        );\n      },\n    }),\n    {\n      name: 'uk-data-storage',\n      // MINIMAL PERSISTENCE - only settings that are truly local\n      // All data now comes from API (D1 database)\n      partialize: (state) => ({\n        // Only persist local UI settings that don't have API endpoints yet\n        settings: state.settings,\n        // Keep notifications for offline display\n        notifications: state.notifications.slice(0, 100),\n      }),\n      merge: (persistedState, currentState) => {\n        const persisted = persistedState as Partial<DataState>;\n        // Demo code for QR testing\n        const demoCode = createDemoGuestAccessCode();\n\n        return {\n          ...currentState,\n          settings: persisted.settings || currentState.settings,\n          notifications: persisted.notifications || [],\n          // All data starts empty - will be fetched from API\n          vehicles: [],\n          announcements: [],\n          requests: [],\n          guestAccessCodes: [demoCode],\n          executors: [], // Empty - will be fetched from API\n          rescheduleRequests: [],\n          rentalApartments: [],\n          rentalRecords: [],\n        };\n      },\n    }\n  )\n);\n\n// Cross-tab synchronization for localStorage changes\n// This ensures QR code status updates are synced between guard and resident\nif (typeof window !== 'undefined') {\n  window.addEventListener('storage', (event) => {\n    if (event.key === 'uk-data-storage' && event.newValue) {\n      try {\n        const parsed = JSON.parse(event.newValue);\n        if (parsed.state?.guestAccessCodes) {\n          // Update guestAccessCodes from another tab\n          useDataStore.setState({ guestAccessCodes: parsed.state.guestAccessCodes });\n        }\n      } catch (e) {\n        console.error('Failed to sync storage:', e);\n      }\n    }\n  });\n}\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport type Language = 'ru' | 'uz';\n\ninterface LanguageState {\n  language: Language;\n  setLanguage: (lang: Language) => void;\n  t: (key: string) => string;\n}\n\n// Translations\nconst translations: Record<Language, Record<string, string>> = {\n  ru: {\n    // App name\n    'app.name': 'My Helper',\n    'app.subtitle': 'CRM ',\n\n    // Auth\n    'auth.title': '  ',\n    'auth.login': '',\n    'auth.password': '',\n    'auth.enter': '',\n    'auth.error': '   ',\n    'auth.logout': '',\n\n    // Navigation\n    'nav.dashboard': '',\n    'nav.requests': '',\n    'nav.executors': '',\n    'nav.residents': '',\n    'nav.buildings': '',\n    'nav.activity': ' ',\n    'nav.reports': '',\n    'nav.settings': '',\n    'nav.monitoring': '',\n    'nav.myRequests': ' ',\n    'nav.services': '',\n    'nav.profile': '',\n    'nav.more': '',\n    'nav.rentals': ' ',\n    'nav.myApartments': ' ',\n    'nav.accounts': ' ',\n    'nav.owners': '',\n    'nav.workOrders': '  ',\n    'nav.trainings': '',\n\n    // Dashboard\n    'dashboard.manager': ' ',\n    'dashboard.admin': ' ',\n    'dashboard.newRequests': ' ',\n    'dashboard.inProgress': ' ',\n    'dashboard.pendingApproval': ' ',\n    'dashboard.completedWeek': '  ',\n    'dashboard.weeklyRequests': '  ',\n    'dashboard.byCategory': ' ',\n    'dashboard.recentRequests': ' ',\n    'dashboard.viewAll': '',\n\n    // Requests\n    'request.assign': '',\n    'request.reassign': '',\n    'request.executor': '',\n    'request.search': '...',\n    'request.allStatuses': ' ',\n    'request.notFound': '  ',\n    'request.changeFilters': '  ',\n\n    // Executors\n    'executor.available': '',\n    'executor.busy': '',\n    'executor.offline': '',\n    'executor.all': ' ',\n    'executor.add': ' ',\n    'executor.completed': '',\n    'executor.active': '',\n\n    // Residents\n    'resident.add': ' ',\n    'resident.total': '',\n    'resident.noResidents': '  ',\n    'resident.willAppear': '    ',\n\n    // Status\n    'status.new': '',\n    'status.assigned': '',\n    'status.accepted': '',\n    'status.in_progress': ' ',\n    'status.pending_approval': ' ',\n    'status.completed': '',\n    'status.cancelled': '',\n\n    // Priority\n    'priority.low': '',\n    'priority.medium': '',\n    'priority.high': '',\n    'priority.urgent': '',\n\n    // Forms\n    'form.name': '',\n    'form.phone': '',\n    'form.address': '',\n    'form.apartment': '',\n    'form.login': '',\n    'form.password': '',\n    'form.specialization': '',\n    'form.generate': '',\n    'form.cancel': '',\n    'form.add': '',\n    'form.save': '',\n    'form.done': '',\n    'form.copy': '',\n    'form.copied': '!',\n    'form.fillAll': '  ',\n    'form.credentials': '  ',\n\n    // Timer\n    'timer.start': ' ',\n    'timer.pause': '',\n    'timer.resume': '',\n    'timer.finish': '',\n    'timer.elapsed': ' ',\n\n    // Settings\n    'settings.general': '',\n    'settings.notifications': '',\n    'settings.integrations': '',\n    'settings.users': '',\n    'settings.language': '',\n\n    // Common\n    'common.all': '',\n    'common.delete': '',\n    'common.edit': '',\n    'common.view': '',\n    'common.refresh': '',\n    'common.loading': '...',\n    'common.noData': ' ',\n\n    // Rentals\n    'rental.title': ' ',\n    'rental.addApartment': ' ',\n    'rental.noApartments': '  ',\n    'rental.addFirst': '     ',\n    'rental.occupied': '',\n    'rental.available': '',\n    'rental.records': '',\n    'rental.currentGuest': ' ',\n    'rental.until': '',\n    'rental.deleteApartment': ' ',\n    'rental.owner': '',\n    'rental.addRecord': ' ',\n    'rental.rentalHistory': ' ',\n    'rental.noRecords': '  ',\n    'rental.active': '',\n    'rental.apartmentName': '',\n    'rental.ownerData': '  ()',\n    'rental.guestNames': ' ',\n    'rental.passportInfo': ' ',\n    'rental.checkIn': ' ',\n    'rental.checkOut': ' ',\n    'rental.amount': '',\n    'rental.currency': '',\n    'rental.notes': ' ()',\n    'rental.apartmentAdded': ' !',\n    'rental.ownerCredentials': '   :',\n    'rental.generateCredentials': ' /',\n    'rental.confirmDelete': ' ',\n    'rental.enterOwnerPassword': '      ',\n    'rental.wrongPassword': ' ',\n\n    // Tenant Dashboard\n    'tenant.myApartments': ' ',\n    'tenant.welcome': ' ',\n    'tenant.apartments': '',\n    'tenant.records': '',\n    'tenant.totalGuests': ' ',\n    'tenant.income': ' ()',\n    'tenant.noAssigned': '  ',\n    'tenant.contactManager': '     ',\n    'tenant.now': '',\n    'tenant.completed': '',\n    'tenant.moreRecords': '  ...',\n    'tenant.guest': '',\n    'tenant.guests': '',\n    'tenant.guestsMany': '',\n    'tenant.checkInLabel': '',\n    'tenant.checkOutLabel': '',\n\n    // Announcements\n    'announcements.title': '',\n    'announcements.forResidents': ' ',\n    'announcements.forStaff': ' ',\n    'announcements.add': ' ',\n    'announcements.noAnnouncements': '  ',\n    'announcements.addFirst': '  ',\n    'announcements.titleLabel': '',\n    'announcements.content': '',\n    'announcements.type': '',\n    'announcements.priority': '',\n    'announcements.expiresAt': '  ()',\n    'announcements.priorityNormal': '',\n    'announcements.priorityImportant': '',\n    'announcements.priorityUrgent': '',\n    'announcements.views': '',\n    'announcements.author': '',\n    'announcements.createdAt': '',\n    'announcements.myAnnouncements': ' ',\n    'announcements.allAnnouncements': ' ',\n    'announcements.noNew': '  ',\n    'announcements.new': '',\n\n    // Meetings - \n    'meetings.title': ' ',\n    'meetings.subtitle': '   ',\n    'meetings.create': ' ',\n    'meetings.noMeetings': '  ',\n    'meetings.createFirst': '  ',\n\n    // Meeting statuses\n    'meetings.status.draft': '',\n    'meetings.status.pending_moderation': ' ',\n    'meetings.status.schedule_poll_open': ' ',\n    'meetings.status.schedule_confirmed': ' ',\n    'meetings.status.voting_open': '',\n    'meetings.status.voting_closed': ' ',\n    'meetings.status.results_published': ' ',\n    'meetings.status.protocol_generated': ' ',\n    'meetings.status.protocol_approved': ' ',\n    'meetings.status.cancelled': '',\n\n    // Meeting format\n    'meetings.format.online': '',\n    'meetings.format.offline': '',\n    'meetings.format.hybrid': '',\n\n    // Meeting creation wizard\n    'meetings.wizard.step1': ' ',\n    'meetings.wizard.step2': ' ',\n    'meetings.wizard.step3': '  ',\n    'meetings.wizard.step4': '',\n    'meetings.wizard.organizerType': '',\n    'meetings.wizard.organizerResident': ' ()',\n    'meetings.wizard.organizerManagement': ' ',\n    'meetings.wizard.selectFormat': ' ',\n    'meetings.wizard.selectAgenda': '  ',\n    'meetings.wizard.addCustomQuestion': '  ',\n    'meetings.wizard.questionTitle': ' ',\n    'meetings.wizard.questionDescription': '',\n    'meetings.wizard.attachMaterials': ' ',\n    'meetings.wizard.threshold': ' ',\n    'meetings.wizard.scheduleDatetime': ' 3    ',\n    'meetings.wizard.autoGenerate': ' ',\n    'meetings.wizard.location': '  ( /)',\n    'meetings.wizard.publish': ' ',\n    'meetings.wizard.saveDraft': ' ',\n\n    // Schedule voting\n    'meetings.schedule.title': '  ',\n    'meetings.schedule.voteFor': '',\n    'meetings.schedule.yourVote': ' ',\n    'meetings.schedule.votes': '',\n    'meetings.schedule.endsAt': ' ',\n    'meetings.schedule.confirmed': ' ',\n\n    // Agenda voting\n    'meetings.voting.title': '  ',\n    'meetings.voting.for': '',\n    'meetings.voting.against': '',\n    'meetings.voting.abstain': '',\n    'meetings.voting.voted': ' ',\n    'meetings.voting.notVoted': '   ',\n    'meetings.voting.changeVote': ' ',\n    'meetings.voting.confirmVote': ' ',\n    'meetings.voting.verifyIdentity': ' ',\n    'meetings.voting.enterOTP': '   SMS',\n    'meetings.voting.sendOTP': ' ',\n    'meetings.voting.resendOTP': ' ',\n    'meetings.voting.otpSent': '  ',\n    'meetings.voting.otpInvalid': ' ',\n    'meetings.voting.otpExpired': ' ,  ',\n\n    // Results\n    'meetings.results.title': ' ',\n    'meetings.results.approved': '',\n    'meetings.results.rejected': ' ',\n    'meetings.results.quorum': '',\n    'meetings.results.quorumReached': ' ',\n    'meetings.results.quorumNotReached': '  ',\n    'meetings.results.participation': '',\n    'meetings.results.votesFor': '',\n    'meetings.results.votesAgainst': '',\n    'meetings.results.votesAbstain': '',\n    'meetings.results.threshold': '',\n\n    // Protocol\n    'meetings.protocol.title': ' ',\n    'meetings.protocol.generate': ' ',\n    'meetings.protocol.download': ' PDF',\n    'meetings.protocol.sign': ' ',\n    'meetings.protocol.signed': ' ',\n    'meetings.protocol.signedBy': '',\n\n    // Actions\n    'meetings.actions.approve': '',\n    'meetings.actions.reject': '',\n    'meetings.actions.openVoting': ' ',\n    'meetings.actions.closeVoting': ' ',\n    'meetings.actions.publishResults': ' ',\n    'meetings.actions.cancel': ' ',\n    'meetings.actions.viewDetails': '',\n    'meetings.actions.viewAgenda': ' ',\n    'meetings.actions.viewMaterials': '',\n\n    // Notifications\n    'meetings.notify.created': '  ',\n    'meetings.notify.scheduleVote': '  ',\n    'meetings.notify.scheduleConfirmed': '  ',\n    'meetings.notify.votingOpen': ' ',\n    'meetings.notify.votingReminder': '  ',\n    'meetings.notify.resultsPublished': '  ',\n    'meetings.notify.protocolReady': '  ',\n\n    // Settings\n    'meetings.settings.title': ' ',\n    'meetings.settings.votingUnit': ' ',\n    'meetings.settings.votingUnitApartment': '1  = 1 ',\n    'meetings.settings.votingUnitOwner': '1  = 1 ',\n    'meetings.settings.votingUnitShare': '  ',\n    'meetings.settings.quorum': ' (%)',\n    'meetings.settings.allowResidentInitiative': '  ',\n    'meetings.settings.requireModeration': '  ',\n    'meetings.settings.requireOTP': '  SMS',\n    'meetings.settings.showIntermediateResults': '  ',\n\n    // Evidence\n    'meetings.evidence.title': ' ',\n    'meetings.evidence.download': ' ',\n    'meetings.evidence.totalVotes': ' ',\n    'meetings.evidence.otpVerified': '  SMS',\n    'meetings.evidence.uniqueVoters': ' ',\n\n    // Login Page\n    'login.enterLogin': ' ',\n    'login.enterPassword': ' ',\n    'login.mustAcceptTerms': '    ',\n    'login.wrongCredentials': '   ',\n    'login.loginError': '  ',\n    'login.loading': '...',\n    'login.agreeWith': '   ',\n    'login.publicOffer': ' ',\n    'login.acceptFirst': '    ',\n    'login.offerTitle': ' ',\n    'login.scrollToAccept': '   ,    ',\n    'login.documentRead': '  ',\n    'login.scrollDown': '   ',\n    'login.close': '',\n    'login.accept': '',\n\n    // Roles\n    'role.admin': '',\n    'role.manager': '',\n    'role.department_head': ' ',\n    'role.executor': '',\n    'role.resident': '',\n    'role.plumber': '',\n    'role.electrician': '',\n    'role.security': '',\n\n    // Buildings / CRM\n    'building.title': '',\n    'building.add': ' ',\n    'building.edit': ' ',\n    'building.delete': ' ',\n    'building.address': '',\n    'building.name': '',\n    'building.floors': '',\n    'building.entrances': '',\n    'building.apartments': '',\n    'building.residents': '',\n    'building.noBuildings': '  ',\n    'building.addFirst': '  ',\n\n    // Owners\n    'owner.title': '',\n    'owner.add': ' ',\n    'owner.edit': '',\n    'owner.delete': '',\n    'owner.name': ' ',\n    'owner.phone': '',\n    'owner.email': 'Email',\n    'owner.share': ' ',\n    'owner.noOwners': '  ',\n\n    // Personal Accounts\n    'account.title': ' ',\n    'account.number': ' ',\n    'account.balance': '',\n    'account.debt': '',\n    'account.lastPayment': ' ',\n    'account.noAccounts': '  ',\n\n    // Work Orders\n    'workorder.title': '  ',\n    'workorder.create': ' ',\n    'workorder.number': ' ',\n    'workorder.status': '',\n    'workorder.executor': '',\n    'workorder.deadline': ' ',\n    'workorder.noWorkOrders': '  ',\n\n    // Activity Log\n    'activity.title': ' ',\n    'activity.created': '',\n    'activity.updated': '',\n    'activity.deleted': '',\n    'activity.login': '  ',\n    'activity.logout': '  ',\n    'activity.noActivity': ' ',\n    'activity.user': '',\n    'activity.action': '',\n    'activity.timestamp': '',\n    'activity.details': '',\n\n    // Monitoring\n    'monitoring.title': ' ',\n    'monitoring.health': ' ',\n    'monitoring.uptime': ' ',\n    'monitoring.requests': '',\n    'monitoring.errors': '',\n    'monitoring.latency': '',\n    'monitoring.healthy': '',\n    'monitoring.degraded': '',\n    'monitoring.down': '',\n\n    // Executor Stats\n    'stats.title': '',\n    'stats.completed': '',\n    'stats.thisWeek': ' ',\n    'stats.thisMonth': ' ',\n    'stats.rating': '',\n    'stats.avgTime': ' ',\n    'stats.noStats': '   ',\n\n    // Schedule\n    'schedule.title': '',\n    'schedule.today': '',\n    'schedule.tomorrow': '',\n    'schedule.thisWeek': '  ',\n    'schedule.noSchedule': '  ',\n    'schedule.addEvent': ' ',\n\n    // Chat\n    'chat.title': '',\n    'chat.support': '',\n    'chat.newMessage': ' ',\n    'chat.typeMessage': ' ...',\n    'chat.send': '',\n    'chat.noMessages': ' ',\n    'chat.startConversation': ' ',\n\n    // Guest Access\n    'guest.title': ' ',\n    'guest.createCode': ' ',\n    'guest.validUntil': ' ',\n    'guest.usages': '',\n    'guest.active': '',\n    'guest.expired': '',\n    'guest.used': '',\n    'guest.noGuests': '  ',\n    'guest.generate': ' QR-',\n    'guest.copyCode': ' ',\n    'guest.shareCode': ' ',\n\n    // QR Scanner\n    'scanner.title': ' QR-',\n    'scanner.scan': '',\n    'scanner.scanning': '...',\n    'scanner.valid': ' ',\n    'scanner.invalid': ' ',\n    'scanner.expired': ' ',\n    'scanner.allow': ' ',\n    'scanner.deny': ' ',\n\n    // Vehicles\n    'vehicle.title': '',\n    'vehicle.add': ' ',\n    'vehicle.plate': '',\n    'vehicle.brand': '',\n    'vehicle.model': '',\n    'vehicle.color': '',\n    'vehicle.owner': '',\n    'vehicle.noVehicles': '  ',\n    'vehicle.search': '  ',\n\n    // Contract\n    'contract.title': '',\n    'contract.number': ' ',\n    'contract.status': '',\n    'contract.signed': '',\n    'contract.pending': ' ',\n    'contract.startDate': ' ',\n    'contract.endDate': ' ',\n    'contract.download': ' PDF',\n    'contract.sign': '',\n\n    // Profile\n    'profile.title': ' ',\n    'profile.personalData': '  ',\n    'profile.personalAccount': ' ',\n    'profile.loginHint': '  ',\n    'profile.cannotChange': ' ',\n    'profile.phone': '',\n    'profile.notSpecified': ' ',\n    'profile.password': '',\n    'profile.currentPassword': ' ',\n    'profile.newPassword': ' ',\n    'profile.confirmPassword': ' ',\n    'profile.passwordChanged': '  ',\n    'profile.phoneSaved': ' ',\n\n    // Errors\n    'error.generic': ' ',\n    'error.network': ' ',\n    'error.unauthorized': ' ',\n    'error.forbidden': ' ',\n    'error.notFound': ' ',\n    'error.tryAgain': ' ',\n\n    // Confirmations\n    'confirm.delete': ' ',\n    'confirm.cancel': '',\n    'confirm.yes': '',\n    'confirm.no': '',\n    'confirm.sure': ' ?',\n\n    // Time\n    'time.today': '',\n    'time.yesterday': '',\n    'time.daysAgo': ' ',\n    'time.hoursAgo': ' ',\n    'time.minutesAgo': ' ',\n    'time.justNow': ' ',\n  },\n  uz: {\n    // App name\n    'app.name': 'My Helper',\n    'app.subtitle': 'CRM Tizimi',\n\n    // Auth\n    'auth.title': 'Tizimga kirish',\n    'auth.login': 'Login',\n    'auth.password': 'Parol',\n    'auth.enter': 'Kirish',\n    'auth.error': 'Login yoki parol noto\\'g\\'ri',\n    'auth.logout': 'Chiqish',\n\n    // Navigation\n    'nav.dashboard': 'Boshqaruv paneli',\n    'nav.requests': 'Arizalar',\n    'nav.executors': 'Ijrochilar',\n    'nav.residents': 'Aholi',\n    'nav.buildings': 'Binolar',\n    'nav.activity': 'Faoliyat jurnali',\n    'nav.reports': 'Hisobotlar',\n    'nav.settings': 'Sozlamalar',\n    'nav.monitoring': 'Monitoring',\n    'nav.myRequests': 'Mening arizalarim',\n    'nav.services': 'Xizmatlar',\n    'nav.profile': 'Profil',\n    'nav.more': 'Ko\\'proq',\n    'nav.rentals': 'Kvartira ijarasi',\n    'nav.myApartments': 'Mening kvartiram',\n    'nav.accounts': 'Shaxsiy hisoblar',\n    'nav.owners': 'Mulkdorlar',\n    'nav.workOrders': 'Ish buyruqlari',\n    'nav.trainings': 'Treninglar',\n\n    // Dashboard\n    'dashboard.manager': 'Menejer paneli',\n    'dashboard.admin': 'Administrator paneli',\n    'dashboard.newRequests': 'Yangi arizalar',\n    'dashboard.inProgress': 'Jarayonda',\n    'dashboard.pendingApproval': 'Tasdiqlash kutilmoqda',\n    'dashboard.completedWeek': 'Hafta davomida bajarilgan',\n    'dashboard.weeklyRequests': 'Haftalik arizalar',\n    'dashboard.byCategory': 'Kategoriya bo\\'yicha',\n    'dashboard.recentRequests': 'So\\'nggi arizalar',\n    'dashboard.viewAll': 'Hammasi',\n\n    // Requests\n    'request.assign': 'Tayinlash',\n    'request.reassign': 'Qayta tayinlash',\n    'request.executor': 'Ijrochi',\n    'request.search': 'Qidirish...',\n    'request.allStatuses': 'Barcha holatlar',\n    'request.notFound': 'Arizalar topilmadi',\n    'request.changeFilters': 'Filtrlarni o\\'zgartirib ko\\'ring',\n\n    // Executors\n    'executor.available': 'Mavjud',\n    'executor.busy': 'Band',\n    'executor.offline': 'Oflayn',\n    'executor.all': 'Barcha ijrochilar',\n    'executor.add': 'Ijrochi qo\\'shish',\n    'executor.completed': 'bajarilgan',\n    'executor.active': 'faol',\n\n    // Residents\n    'resident.add': 'Aholi qo\\'shish',\n    'resident.total': 'jami',\n    'resident.noResidents': 'Aholi hali yo\\'q',\n    'resident.willAppear': 'Arizalar yaratilgandan keyin aholi paydo bo\\'ladi',\n\n    // Status\n    'status.new': 'Yangi',\n    'status.assigned': 'Tayinlangan',\n    'status.accepted': 'Qabul qilingan',\n    'status.in_progress': 'Jarayonda',\n    'status.pending_approval': 'Tasdiqlash kutilmoqda',\n    'status.completed': 'Bajarilgan',\n    'status.cancelled': 'Bekor qilingan',\n\n    // Priority\n    'priority.low': 'Past',\n    'priority.medium': 'O\\'rta',\n    'priority.high': 'Yuqori',\n    'priority.urgent': 'Shoshilinch',\n\n    // Forms\n    'form.name': 'F.I.O.',\n    'form.phone': 'Telefon',\n    'form.address': 'Manzil',\n    'form.apartment': 'Kvartira',\n    'form.login': 'Login',\n    'form.password': 'Parol',\n    'form.specialization': 'Mutaxassislik',\n    'form.generate': 'Yaratish',\n    'form.cancel': 'Bekor qilish',\n    'form.add': 'Qo\\'shish',\n    'form.save': 'Saqlash',\n    'form.done': 'Tayyor',\n    'form.copy': 'Nusxalash',\n    'form.copied': 'Nusxalandi!',\n    'form.fillAll': 'Barcha maydonlarni to\\'ldiring',\n    'form.credentials': 'Kirish ma\\'lumotlari',\n\n    // Timer\n    'timer.start': 'Ishni boshlash',\n    'timer.pause': 'Pauza',\n    'timer.resume': 'Davom ettirish',\n    'timer.finish': 'Tugatish',\n    'timer.elapsed': 'O\\'tgan vaqt',\n\n    // Settings\n    'settings.general': 'Umumiy',\n    'settings.notifications': 'Bildirishnomalar',\n    'settings.integrations': 'Integratsiyalar',\n    'settings.users': 'Foydalanuvchilar',\n    'settings.language': 'Til',\n\n    // Common\n    'common.all': 'Hammasi',\n    'common.delete': 'O\\'chirish',\n    'common.edit': 'Tahrirlash',\n    'common.view': 'Ko\\'rish',\n    'common.refresh': 'Yangilash',\n    'common.loading': 'Yuklanmoqda...',\n    'common.noData': 'Ma\\'lumot yo\\'q',\n\n    // Rentals\n    'rental.title': 'Kvartira ijarasi',\n    'rental.addApartment': 'Kvartira qo\\'shish',\n    'rental.noApartments': 'Kvartiralar hali yo\\'q',\n    'rental.addFirst': 'Ijarani boshqarish uchun birinchi kvartirani qo\\'shing',\n    'rental.occupied': 'Band',\n    'rental.available': 'Bo\\'sh',\n    'rental.records': 'yozuvlar',\n    'rental.currentGuest': 'Hozirgi mehmon',\n    'rental.until': 'gacha',\n    'rental.deleteApartment': 'Kvartirani o\\'chirish',\n    'rental.owner': 'Egasi',\n    'rental.addRecord': 'Yozuv qo\\'shish',\n    'rental.rentalHistory': 'Ijara tarixi',\n    'rental.noRecords': 'Yozuvlar hali yo\\'q',\n    'rental.active': 'Faol',\n    'rental.apartmentName': 'Nomi',\n    'rental.ownerData': 'Egasi ma\\'lumotlari (tenant)',\n    'rental.guestNames': 'Mehmonlar ismi',\n    'rental.passportInfo': 'Pasport ma\\'lumotlari',\n    'rental.checkIn': 'Kirish sanasi',\n    'rental.checkOut': 'Chiqish sanasi',\n    'rental.amount': 'Summa',\n    'rental.currency': 'Valyuta',\n    'rental.notes': 'Izohlar (ixtiyoriy)',\n    'rental.apartmentAdded': 'Kvartira qo\\'shildi!',\n    'rental.ownerCredentials': 'Egasi kirish ma\\'lumotlari:',\n    'rental.generateCredentials': 'Login/parol yaratish',\n    'rental.confirmDelete': 'O\\'chirishni tasdiqlang',\n    'rental.enterOwnerPassword': 'O\\'chirishni tasdiqlash uchun kvartira egasining parolini kiriting',\n    'rental.wrongPassword': 'Parol noto\\'g\\'ri',\n\n    // Tenant Dashboard\n    'tenant.myApartments': 'Mening kvartiram',\n    'tenant.welcome': 'Xush kelibsiz',\n    'tenant.apartments': 'Kvartiralar',\n    'tenant.records': 'Yozuvlar',\n    'tenant.totalGuests': 'Jami mehmonlar',\n    'tenant.income': 'Daromad (so\\'m)',\n    'tenant.noAssigned': 'Tayinlangan kvartiralar yo\\'q',\n    'tenant.contactManager': 'Kvartira qo\\'shish uchun menejer bilan bog\\'laning',\n    'tenant.now': 'Hozir',\n    'tenant.completed': 'Tugallangan',\n    'tenant.moreRecords': 'Va yana yozuvlar...',\n    'tenant.guest': 'mehmon',\n    'tenant.guests': 'mehmon',\n    'tenant.guestsMany': 'mehmon',\n    'tenant.checkInLabel': 'Kirish',\n    'tenant.checkOutLabel': 'Chiqish',\n\n    // Announcements\n    'announcements.title': 'E\\'lonlar',\n    'announcements.forResidents': 'Aholiga',\n    'announcements.forStaff': 'Xodimlarga',\n    'announcements.add': 'E\\'lon qo\\'shish',\n    'announcements.noAnnouncements': 'E\\'lonlar hali yo\\'q',\n    'announcements.addFirst': 'Birinchi e\\'lonni qo\\'shing',\n    'announcements.titleLabel': 'Sarlavha',\n    'announcements.content': 'Mazmuni',\n    'announcements.type': 'Turi',\n    'announcements.priority': 'Muhimlik',\n    'announcements.expiresAt': 'Amal qilish muddati (ixtiyoriy)',\n    'announcements.priorityNormal': 'Oddiy',\n    'announcements.priorityImportant': 'Muhim',\n    'announcements.priorityUrgent': 'Shoshilinch',\n    'announcements.views': 'ko\\'rishlar',\n    'announcements.author': 'Muallif',\n    'announcements.createdAt': 'Yaratilgan',\n    'announcements.myAnnouncements': 'Mening e\\'lonlarim',\n    'announcements.allAnnouncements': 'Barcha e\\'lonlar',\n    'announcements.noNew': 'Yangi e\\'lonlar yo\\'q',\n    'announcements.new': 'Yangi',\n\n    // Meetings - Yig'ilishlar\n    'meetings.title': 'Aholining yig\\'ilishlari',\n    'meetings.subtitle': 'Yig\\'ilishlarni tashkil etish va o\\'tkazish',\n    'meetings.create': 'Yig\\'ilish chaqirish',\n    'meetings.noMeetings': 'Yig\\'ilishlar hali yo\\'q',\n    'meetings.createFirst': 'Birinchi yig\\'ilishni yarating',\n\n    // Meeting statuses\n    'meetings.status.draft': 'Qoralama',\n    'meetings.status.pending_moderation': 'Moderatsiyada',\n    'meetings.status.schedule_poll_open': 'Sana tanlash',\n    'meetings.status.schedule_confirmed': 'Sana tasdiqlangan',\n    'meetings.status.voting_open': 'Ovoz berish',\n    'meetings.status.voting_closed': 'Ovoz berish yopildi',\n    'meetings.status.results_published': 'Natijalar e\\'lon qilindi',\n    'meetings.status.protocol_generated': 'Bayonnoma tayyor',\n    'meetings.status.protocol_approved': 'Bayonnoma tasdiqlangan',\n    'meetings.status.cancelled': 'Bekor qilindi',\n\n    // Meeting format\n    'meetings.format.online': 'Onlayn',\n    'meetings.format.offline': 'Yuzma-yuz',\n    'meetings.format.hybrid': 'Aralash',\n\n    // Meeting creation wizard\n    'meetings.wizard.step1': 'Yig\\'ilish turi',\n    'meetings.wizard.step2': 'Kun tartibi',\n    'meetings.wizard.step3': 'Sana va vaqt',\n    'meetings.wizard.step4': 'Nashr',\n    'meetings.wizard.organizerType': 'Tashkilotchi',\n    'meetings.wizard.organizerResident': 'Aholi (tashabbusi)',\n    'meetings.wizard.organizerManagement': 'Boshqaruv kompaniyasi',\n    'meetings.wizard.selectFormat': 'O\\'tkazish formati',\n    'meetings.wizard.selectAgenda': 'Kun tartibi savollarini tanlang',\n    'meetings.wizard.addCustomQuestion': 'O\\'z savolingizni qo\\'shing',\n    'meetings.wizard.questionTitle': 'Savol sarlavhasi',\n    'meetings.wizard.questionDescription': 'Tavsif',\n    'meetings.wizard.attachMaterials': 'Materiallarni biriktiring',\n    'meetings.wizard.threshold': 'Qabul qilish chegarasi',\n    'meetings.wizard.scheduleDatetime': 'Sana va vaqtning 3 variantini taklif qiling',\n    'meetings.wizard.autoGenerate': 'Avtomatik yaratish',\n    'meetings.wizard.location': 'O\\'tkazish joyi (yuzma-yuz/aralash uchun)',\n    'meetings.wizard.publish': 'Tashabbusni e\\'lon qilish',\n    'meetings.wizard.saveDraft': 'Qoralama saqlash',\n\n    // Schedule voting\n    'meetings.schedule.title': 'Qulay sanani tanlang',\n    'meetings.schedule.voteFor': 'Ovoz berish',\n    'meetings.schedule.yourVote': 'Sizning ovozingiz',\n    'meetings.schedule.votes': 'ovoz',\n    'meetings.schedule.endsAt': 'Ovoz berish tugaydi',\n    'meetings.schedule.confirmed': 'Sana tasdiqlangan',\n\n    // Agenda voting\n    'meetings.voting.title': 'Savollarga ovoz berish',\n    'meetings.voting.for': 'Yoqlab',\n    'meetings.voting.against': 'Qarshi',\n    'meetings.voting.abstain': 'Betaraf',\n    'meetings.voting.voted': 'Siz ovoz berdingiz',\n    'meetings.voting.notVoted': 'Siz hali ovoz bermadingiz',\n    'meetings.voting.changeVote': 'Ovozni o\\'zgartirish',\n    'meetings.voting.confirmVote': 'Ovozni tasdiqlash',\n    'meetings.voting.verifyIdentity': 'Shaxsingizni tasdiqlang',\n    'meetings.voting.enterOTP': 'SMS kodini kiriting',\n    'meetings.voting.sendOTP': 'Kod yuborish',\n    'meetings.voting.resendOTP': 'Qayta yuborish',\n    'meetings.voting.otpSent': 'Kod yuborildi',\n    'meetings.voting.otpInvalid': 'Kod noto\\'g\\'ri',\n    'meetings.voting.otpExpired': 'Kod muddati tugadi, yangi so\\'rang',\n\n    // Results\n    'meetings.results.title': 'Ovoz berish natijalari',\n    'meetings.results.approved': 'Qabul qilindi',\n    'meetings.results.rejected': 'Qabul qilinmadi',\n    'meetings.results.quorum': 'Kvorum',\n    'meetings.results.quorumReached': 'Kvorum yetdi',\n    'meetings.results.quorumNotReached': 'Kvorum yetmadi',\n    'meetings.results.participation': 'Ishtirok',\n    'meetings.results.votesFor': 'Yoqlab',\n    'meetings.results.votesAgainst': 'Qarshi',\n    'meetings.results.votesAbstain': 'Betaraf',\n    'meetings.results.threshold': 'Kerak',\n\n    // Protocol\n    'meetings.protocol.title': 'Yig\\'ilish bayonnomasi',\n    'meetings.protocol.generate': 'Bayonnoma yaratish',\n    'meetings.protocol.download': 'PDF yuklash',\n    'meetings.protocol.sign': 'Bayonnomani imzolash',\n    'meetings.protocol.signed': 'Bayonnoma imzolangan',\n    'meetings.protocol.signedBy': 'Imzolagan',\n\n    // Actions\n    'meetings.actions.approve': 'Tasdiqlash',\n    'meetings.actions.reject': 'Rad etish',\n    'meetings.actions.openVoting': 'Ovoz berishni ochish',\n    'meetings.actions.closeVoting': 'Ovoz berishni yopish',\n    'meetings.actions.publishResults': 'Natijalarni e\\'lon qilish',\n    'meetings.actions.cancel': 'Yig\\'ilishni bekor qilish',\n    'meetings.actions.viewDetails': 'Batafsil',\n    'meetings.actions.viewAgenda': 'Kun tartibi',\n    'meetings.actions.viewMaterials': 'Materiallar',\n\n    // Notifications\n    'meetings.notify.created': 'Yangi yig\\'ilish boshlandi',\n    'meetings.notify.scheduleVote': 'Qulay sanani tanlang',\n    'meetings.notify.scheduleConfirmed': 'Yig\\'ilish sanasi tasdiqlandi',\n    'meetings.notify.votingOpen': 'Ovoz berish ochildi',\n    'meetings.notify.votingReminder': 'Ovoz berishni unutmang',\n    'meetings.notify.resultsPublished': 'Yig\\'ilish natijalari e\\'lon qilindi',\n    'meetings.notify.protocolReady': 'Yig\\'ilish bayonnomasi tayyor',\n\n    // Settings\n    'meetings.settings.title': 'Yig\\'ilish sozlamalari',\n    'meetings.settings.votingUnit': 'Ovoz birligi',\n    'meetings.settings.votingUnitApartment': '1 kvartira = 1 ovoz',\n    'meetings.settings.votingUnitOwner': '1 egasi = 1 ovoz',\n    'meetings.settings.votingUnitShare': 'Ulush bo\\'yicha',\n    'meetings.settings.quorum': 'Kvorum (%)',\n    'meetings.settings.allowResidentInitiative': 'Aholi tashabbusiga ruxsat',\n    'meetings.settings.requireModeration': 'UK moderatsiyasi kerak',\n    'meetings.settings.requireOTP': 'SMS orqali tasdiqlash',\n    'meetings.settings.showIntermediateResults': 'Oraliq natijalarni ko\\'rsatish',\n\n    // Evidence\n    'meetings.evidence.title': 'Dalillar hisoboti',\n    'meetings.evidence.download': 'Hisobotni yuklash',\n    'meetings.evidence.totalVotes': 'Jami ovozlar',\n    'meetings.evidence.otpVerified': 'SMS orqali tasdiqlangan',\n    'meetings.evidence.uniqueVoters': 'Noyob ovoz beruvchilar',\n\n    // Login Page\n    'login.enterLogin': 'Login kiriting',\n    'login.enterPassword': 'Parol kiriting',\n    'login.mustAcceptTerms': 'Ommaviy oferta shartlarini qabul qilish kerak',\n    'login.wrongCredentials': 'Login yoki parol noto\\'g\\'ri',\n    'login.loginError': 'Kirishda xatolik',\n    'login.loading': 'Kirish...',\n    'login.agreeWith': 'Men shartlarga roziman',\n    'login.publicOffer': 'ommaviy oferta',\n    'login.acceptFirst': 'Avval ommaviy oferta shartlarini qabul qiling',\n    'login.offerTitle': 'Ommaviy oferta',\n    'login.scrollToAccept': 'Oferta shartlarini qabul qilish uchun hujjat oxirigacha aylantiring',\n    'login.documentRead': 'Siz hujjatni o\\'qidingiz',\n    'login.scrollDown': 'O\\'qish uchun pastga aylantiring',\n    'login.close': 'Yopish',\n    'login.accept': 'Qabul qilish',\n\n    // Roles\n    'role.admin': 'Administrator',\n    'role.manager': 'Menejer',\n    'role.department_head': 'Bo\\'lim boshlig\\'i',\n    'role.executor': 'Ijrochi',\n    'role.resident': 'Aholi',\n    'role.plumber': 'Santexnik',\n    'role.electrician': 'Elektrik',\n    'role.security': 'Qorovul',\n\n    // Buildings / CRM\n    'building.title': 'Binolar',\n    'building.add': 'Bino qo\\'shish',\n    'building.edit': 'Binoni tahrirlash',\n    'building.delete': 'Binoni o\\'chirish',\n    'building.address': 'Manzil',\n    'building.name': 'Nomi',\n    'building.floors': 'Qavatlar',\n    'building.entrances': 'Kirishlar',\n    'building.apartments': 'Kvartiralar',\n    'building.residents': 'Aholisi',\n    'building.noBuildings': 'Binolar hali yo\\'q',\n    'building.addFirst': 'Birinchi binoni qo\\'shing',\n\n    // Owners\n    'owner.title': 'Mulkdorlar',\n    'owner.add': 'Mulkdor qo\\'shish',\n    'owner.edit': 'Tahrirlash',\n    'owner.delete': 'O\\'chirish',\n    'owner.name': 'Mulkdor ismi',\n    'owner.phone': 'Telefon',\n    'owner.email': 'Email',\n    'owner.share': 'Mulk ulushi',\n    'owner.noOwners': 'Mulkdorlar hali yo\\'q',\n\n    // Personal Accounts\n    'account.title': 'Shaxsiy hisoblar',\n    'account.number': 'Hisob raqami',\n    'account.balance': 'Balans',\n    'account.debt': 'Qarz',\n    'account.lastPayment': 'Oxirgi to\\'lov',\n    'account.noAccounts': 'Hisoblar hali yo\\'q',\n\n    // Work Orders\n    'workorder.title': 'Ish buyruqlari',\n    'workorder.create': 'Buyruq yaratish',\n    'workorder.number': 'Buyruq raqami',\n    'workorder.status': 'Holat',\n    'workorder.executor': 'Ijrochi',\n    'workorder.deadline': 'Muddat',\n    'workorder.noWorkOrders': 'Buyruqlar hali yo\\'q',\n\n    // Activity Log\n    'activity.title': 'Faoliyat jurnali',\n    'activity.created': 'Yaratildi',\n    'activity.updated': 'Yangilandi',\n    'activity.deleted': 'O\\'chirildi',\n    'activity.login': 'Tizimga kirish',\n    'activity.logout': 'Tizimdan chiqish',\n    'activity.noActivity': 'Yozuvlar yo\\'q',\n    'activity.user': 'Foydalanuvchi',\n    'activity.action': 'Harakat',\n    'activity.timestamp': 'Vaqt',\n    'activity.details': 'Tafsilotlar',\n\n    // Monitoring\n    'monitoring.title': 'Tizim monitoringi',\n    'monitoring.health': 'Tizim holati',\n    'monitoring.uptime': 'Ishlash vaqti',\n    'monitoring.requests': 'So\\'rovlar',\n    'monitoring.errors': 'Xatolar',\n    'monitoring.latency': 'Kechikish',\n    'monitoring.healthy': 'Ishlayapti',\n    'monitoring.degraded': 'Sekinlashish',\n    'monitoring.down': 'Mavjud emas',\n\n    // Executor Stats\n    'stats.title': 'Statistika',\n    'stats.completed': 'Bajarilgan',\n    'stats.thisWeek': 'Bu hafta',\n    'stats.thisMonth': 'Bu oy',\n    'stats.rating': 'Reyting',\n    'stats.avgTime': 'O\\'rtacha vaqt',\n    'stats.noStats': 'Ko\\'rsatish uchun ma\\'lumot yo\\'q',\n\n    // Schedule\n    'schedule.title': 'Jadval',\n    'schedule.today': 'Bugun',\n    'schedule.tomorrow': 'Ertaga',\n    'schedule.thisWeek': 'Bu hafta',\n    'schedule.noSchedule': 'Rejalashtirilgan ishlar yo\\'q',\n    'schedule.addEvent': 'Voqea qo\\'shish',\n\n    // Chat\n    'chat.title': 'Chat',\n    'chat.support': 'Yordam',\n    'chat.newMessage': 'Yangi xabar',\n    'chat.typeMessage': 'Xabar yozing...',\n    'chat.send': 'Yuborish',\n    'chat.noMessages': 'Xabarlar yo\\'q',\n    'chat.startConversation': 'Suhbatni boshlang',\n\n    // Guest Access\n    'guest.title': 'Mehmon kirishi',\n    'guest.createCode': 'Kod yaratish',\n    'guest.validUntil': 'Amal qiladi',\n    'guest.usages': 'Foydalanishlar',\n    'guest.active': 'Faol',\n    'guest.expired': 'Muddati tugagan',\n    'guest.used': 'Ishlatilgan',\n    'guest.noGuests': 'Mehmon kodlari yo\\'q',\n    'guest.generate': 'QR-kod yaratish',\n    'guest.copyCode': 'Kodni nusxalash',\n    'guest.shareCode': 'Kodni ulashish',\n\n    // QR Scanner\n    'scanner.title': 'QR-kod skaneri',\n    'scanner.scan': 'Skanerlash',\n    'scanner.scanning': 'Skanerlanmoqda...',\n    'scanner.valid': 'Kod to\\'g\\'ri',\n    'scanner.invalid': 'Kod noto\\'g\\'ri',\n    'scanner.expired': 'Kod muddati tugagan',\n    'scanner.allow': 'O\\'tishga ruxsat',\n    'scanner.deny': 'O\\'tishni taqiqlash',\n\n    // Vehicles\n    'vehicle.title': 'Transport',\n    'vehicle.add': 'Transport qo\\'shish',\n    'vehicle.plate': 'Raqam',\n    'vehicle.brand': 'Marka',\n    'vehicle.model': 'Model',\n    'vehicle.color': 'Rang',\n    'vehicle.owner': 'Egasi',\n    'vehicle.noVehicles': 'Transport ro\\'yxatdan o\\'tmagan',\n    'vehicle.search': 'Raqam bo\\'yicha qidirish',\n\n    // Contract\n    'contract.title': 'Shartnoma',\n    'contract.number': 'Shartnoma raqami',\n    'contract.status': 'Holat',\n    'contract.signed': 'Imzolangan',\n    'contract.pending': 'Imzo kutilmoqda',\n    'contract.startDate': 'Boshlanish sanasi',\n    'contract.endDate': 'Tugash sanasi',\n    'contract.download': 'PDF yuklash',\n    'contract.sign': 'Imzolash',\n\n    // Profile\n    'profile.title': 'Mening profilim',\n    'profile.personalData': 'Shaxsiy ma\\'lumotlaringiz',\n    'profile.personalAccount': 'Shaxsiy hisob',\n    'profile.loginHint': 'Kirish logini',\n    'profile.cannotChange': 'O\\'zgartirib bo\\'lmaydi',\n    'profile.phone': 'Telefon',\n    'profile.notSpecified': 'Ko\\'rsatilmagan',\n    'profile.password': 'Parol',\n    'profile.currentPassword': 'Joriy parol',\n    'profile.newPassword': 'Yangi parol',\n    'profile.confirmPassword': 'Parolni tasdiqlang',\n    'profile.passwordChanged': 'Parol muvaffaqiyatli o\\'zgartirildi',\n    'profile.phoneSaved': 'Telefon saqlandi',\n\n    // Errors\n    'error.generic': 'Xatolik yuz berdi',\n    'error.network': 'Tarmoq xatosi',\n    'error.unauthorized': 'Avtorizatsiya talab qilinadi',\n    'error.forbidden': 'Kirish taqiqlangan',\n    'error.notFound': 'Topilmadi',\n    'error.tryAgain': 'Keyinroq urinib ko\\'ring',\n\n    // Confirmations\n    'confirm.delete': 'O\\'chirishni tasdiqlang',\n    'confirm.cancel': 'Bekor qilish',\n    'confirm.yes': 'Ha',\n    'confirm.no': 'Yo\\'q',\n    'confirm.sure': 'Ishonchingiz komilmi?',\n\n    // Time\n    'time.today': 'Bugun',\n    'time.yesterday': 'Kecha',\n    'time.daysAgo': 'kun oldin',\n    'time.hoursAgo': 'soat oldin',\n    'time.minutesAgo': 'daqiqa oldin',\n    'time.justNow': 'Hozirgina',\n  }\n};\n\nexport const useLanguageStore = create<LanguageState>()(\n  persist(\n    (set, get) => ({\n      language: 'ru',\n      setLanguage: (lang) => set({ language: lang }),\n      t: (key) => {\n        const { language } = get();\n        return translations[language][key] || key;\n      },\n    }),\n    {\n      name: 'language-storage',\n    }\n  )\n);\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type {\n  Meeting,\n  MeetingFormat,\n  MeetingOrganizerType,\n  AgendaItem,\n  VoteRecord,\n  VoteChoice,\n  MeetingProtocol,\n  OTPRecord,\n  VotingUnit,\n  BuildingMeetingSettings,\n} from '../types';\nimport {\n  meetingsFullApi,\n  meetingScheduleVotesApi,\n  meetingAgendaVotesApi,\n  meetingOtpApi,\n  meetingBuildingSettingsApi,\n  meetingVotingUnitsApi,\n  meetingEligibleVotersApi,\n} from '../services/api';\n\n// ============ Mappers: snake_case (API) <-> camelCase (Frontend) ============\n\nconst mapMeetingFromApi = (data: any): Meeting => {\n  // Helper to safely parse JSON or return as-is if already parsed\n  const parseJson = (value: any, defaultValue: any = []) => {\n    if (value === null || value === undefined) return defaultValue;\n    if (typeof value === 'string') {\n      try { return JSON.parse(value); } catch { return defaultValue; }\n    }\n    return value; // Already an object/array\n  };\n\n  // Map agenda items from snake_case to camelCase\n  const mapAgendaItem = (item: any) => ({\n    id: item.id,\n    type: item.type,\n    title: item.title,\n    description: item.description,\n    threshold: item.threshold,\n    votesFor: item.votes_for_area || item.votesFor || 0,\n    votesAgainst: item.votes_against_area || item.votesAgainst || 0,\n    votesAbstain: item.votes_abstain_area || item.votesAbstain || 0,\n    order: item.item_order || item.order || 0,\n    isApproved: item.is_approved,\n    decision: item.decision,\n    materials: parseJson(item.materials, []),\n  });\n\n  // Map schedule options from snake_case to camelCase\n  const mapScheduleOption = (opt: any) => ({\n    id: opt.id,\n    dateTime: opt.date_time || opt.dateTime,\n    votesByShare: opt.vote_weight || opt.voteWeight || opt.votes_by_share || opt.votesByShare || 0,\n    voteWeight: opt.vote_weight || opt.voteWeight || 0,\n    voteCount: opt.vote_count || opt.voteCount || (opt.votes?.length ?? 0),\n    voters: opt.voters || [],\n    votes: opt.votes || opt.voters || [], // For backward compatibility with UI\n  });\n\n  return {\n    id: data.id,\n    number: data.number,\n    buildingId: data.building_id || data.buildingId,\n    buildingAddress: data.building_address || data.buildingAddress,\n    organizerType: data.organizer_type || data.organizerType,\n    organizerId: data.organizer_id || data.organizerId,\n    organizerName: data.organizer_name || data.organizerName,\n    format: data.format,\n    status: data.status,\n    scheduleOptions: parseJson(data.schedule_options || data.scheduleOptions, []).map(mapScheduleOption),\n    schedulePollEndsAt: data.schedule_poll_ends_at || data.schedulePollEndsAt,\n    confirmedDateTime: data.confirmed_date_time || data.confirmedDateTime,\n    location: data.location,\n    agendaItems: (data.agendaItems || parseJson(data.agenda_items, [])).map(mapAgendaItem),\n    materials: parseJson(data.materials, []),\n    votingSettings: parseJson(data.voting_settings || data.votingSettings, {}),\n    eligibleVoters: parseJson(data.eligible_voters || data.eligibleVoters, []),\n    totalEligibleCount: data.total_eligible_count || data.totalEligibleCount || 0,\n    participatedVoters: parseJson(data.participated_voters || data.participatedVoters, []),\n    quorumReached: Boolean(data.quorum_reached || data.quorumReached),\n    participationPercent: data.participation_percent || data.participationPercent || 0,\n    moderatedAt: data.moderated_at || data.moderatedAt,\n    moderationComment: data.moderation_comment || data.moderationComment,\n    schedulePollOpenedAt: data.schedule_poll_opened_at || data.schedulePollOpenedAt,\n    scheduleConfirmedAt: data.schedule_confirmed_at || data.scheduleConfirmedAt,\n    votingOpenedAt: data.voting_opened_at || data.votingOpenedAt,\n    votingClosedAt: data.voting_closed_at || data.votingClosedAt,\n    resultsPublishedAt: data.results_published_at || data.resultsPublishedAt,\n    protocolId: data.protocol_id || data.protocolId,\n    protocolGeneratedAt: data.protocol_generated_at || data.protocolGeneratedAt,\n    protocolApprovedAt: data.protocol_approved_at || data.protocolApprovedAt,\n    cancelledAt: data.cancelled_at || data.cancelledAt,\n    cancellationReason: data.cancellation_reason || data.cancellationReason,\n    remindersSent: parseJson(data.reminders_sent || data.remindersSent, []),\n    notificationLogs: parseJson(data.notification_logs || data.notificationLogs, []),\n    createdAt: data.created_at || data.createdAt,\n  };\n};\n\ninterface VoteRecordApiData {\n  id: string;\n  meeting_id: string;\n  agenda_item_id: string;\n  voter_id: string;\n  voter_name: string;\n  apartment_id?: string;\n  apartment_number?: string;\n  ownership_share?: number;\n  choice: VoteChoice;\n  verification_method: VoteRecord['verificationMethod'];\n  otp_verified: number;\n  voted_at: string;\n  vote_hash: string;\n  is_revote: number;\n  previous_vote_id?: string;\n}\n\nconst mapVoteRecordFromApi = (data: VoteRecordApiData): VoteRecord => ({\n  id: data.id,\n  meetingId: data.meeting_id,\n  agendaItemId: data.agenda_item_id,\n  voterId: data.voter_id,\n  voterName: data.voter_name,\n  apartmentId: data.apartment_id,\n  apartmentNumber: data.apartment_number,\n  ownershipShare: data.ownership_share,\n  choice: data.choice,\n  verificationMethod: data.verification_method,\n  otpVerified: Boolean(data.otp_verified),\n  votedAt: data.voted_at,\n  voteHash: data.vote_hash,\n  isRevote: Boolean(data.is_revote),\n  previousVoteId: data.previous_vote_id,\n});\n\ninterface ProtocolApiData {\n  id: string;\n  meeting_id: string;\n  number: string;\n  generated_at: string;\n  content: string;\n  protocol_hash: string;\n  signed_by_uk_user_id?: string;\n  signed_by_uk_name?: string;\n  signed_by_uk_role?: string;\n  signed_by_uk_at?: string;\n  signed_by_uk_hash?: string;\n  attachments: string;\n}\n\nconst mapProtocolFromApi = (data: ProtocolApiData): MeetingProtocol => ({\n  id: data.id,\n  meetingId: data.meeting_id,\n  number: data.number,\n  generatedAt: data.generated_at,\n  content: data.content,\n  protocolHash: data.protocol_hash,\n  signedByUK: data.signed_by_uk_user_id ? {\n    userId: data.signed_by_uk_user_id,\n    name: data.signed_by_uk_name || '',\n    role: data.signed_by_uk_role || '',\n    signedAt: data.signed_by_uk_at || '',\n    signatureHash: data.signed_by_uk_hash || '',\n  } : undefined,\n  attachments: JSON.parse(data.attachments || '[]'),\n});\n\ninterface OTPRecordApiData {\n  id: string;\n  user_id: string;\n  phone: string;\n  code: string;\n  purpose: OTPRecord['purpose'];\n  meeting_id?: string;\n  agenda_item_id?: string;\n  attempts: number;\n  max_attempts: number;\n  created_at: string;\n  expires_at: string;\n  is_used: number;\n  verified_at?: string;\n}\n\nconst mapOTPRecordFromApi = (data: OTPRecordApiData): OTPRecord => ({\n  id: data.id,\n  userId: data.user_id,\n  phone: data.phone,\n  code: data.code,\n  purpose: data.purpose,\n  meetingId: data.meeting_id,\n  agendaItemId: data.agenda_item_id,\n  attempts: data.attempts,\n  maxAttempts: data.max_attempts,\n  createdAt: data.created_at,\n  expiresAt: data.expires_at,\n  isUsed: Boolean(data.is_used),\n  verifiedAt: data.verified_at,\n});\n\ninterface VotingUnitApiData {\n  id: string;\n  building_id: string;\n  apartment_id?: string;\n  apartment_number: string;\n  total_area: number;\n  ownership_share: number;\n  owner_id: string;\n  owner_name: string;\n  co_owner_ids: string;\n  is_verified: number;\n  verified_at?: string;\n  verified_by?: string;\n}\n\nconst mapVotingUnitFromApi = (data: VotingUnitApiData): VotingUnit => ({\n  id: data.id,\n  buildingId: data.building_id,\n  apartmentId: data.apartment_id,\n  apartmentNumber: data.apartment_number,\n  totalArea: data.total_area,\n  ownershipShare: data.ownership_share,\n  ownerId: data.owner_id,\n  ownerName: data.owner_name,\n  coOwnerIds: JSON.parse(data.co_owner_ids || '[]'),\n  isVerified: Boolean(data.is_verified),\n  verifiedAt: data.verified_at,\n  verifiedBy: data.verified_by,\n});\n\ninterface BuildingSettingsApiData {\n  id: string;\n  building_id: string;\n  voting_unit: BuildingMeetingSettings['votingUnit'];\n  default_quorum_percent: number;\n  schedule_poll_duration_days: number;\n  voting_duration_hours: number;\n  allow_resident_initiative: number;\n  require_moderation: number;\n  default_meeting_time: string;\n  reminder_hours_before: string;\n  notification_channels: string;\n}\n\nconst mapBuildingSettingsFromApi = (data: BuildingSettingsApiData): BuildingMeetingSettings => ({\n  buildingId: data.building_id,\n  votingUnit: data.voting_unit,\n  defaultQuorumPercent: data.default_quorum_percent,\n  schedulePollDurationDays: data.schedule_poll_duration_days,\n  votingDurationHours: data.voting_duration_hours,\n  allowResidentInitiative: Boolean(data.allow_resident_initiative),\n  requireModeration: Boolean(data.require_moderation),\n  defaultMeetingTime: data.default_meeting_time,\n  reminderHoursBefore: JSON.parse(data.reminder_hours_before || '[48, 2]'),\n  notificationChannels: JSON.parse(data.notification_channels || '[\"in_app\", \"push\"]'),\n});\n\n// Default building meeting settings\nconst defaultBuildingSettings: Omit<BuildingMeetingSettings, 'buildingId'> = {\n  votingUnit: 'apartment',\n  defaultQuorumPercent: 50,\n  schedulePollDurationDays: 3,\n  votingDurationHours: 48,\n  allowResidentInitiative: true,\n  requireModeration: true,\n  defaultMeetingTime: '19:00',\n  reminderHoursBefore: [48, 2],\n  notificationChannels: ['in_app', 'push'],\n};\n\n// ============ Store Interface ============\n\ninterface MeetingState {\n  meetings: Meeting[];\n  voteRecords: VoteRecord[];\n  protocols: MeetingProtocol[];\n  otpRecords: OTPRecord[];\n  votingUnits: VotingUnit[];\n  buildingSettings: BuildingMeetingSettings[];\n  loading: boolean;\n  error: string | null;\n\n  // Data fetching\n  fetchMeetings: () => Promise<void>;\n  fetchMeetingsByBuilding: (buildingId: string) => Promise<void>;\n  fetchVotingUnitsByBuilding: (buildingId: string) => Promise<void>;\n\n  // Meeting CRUD\n  createMeeting: (data: {\n    buildingId: string;\n    buildingAddress: string;\n    organizerType: MeetingOrganizerType;\n    organizerId: string;\n    organizerName: string;\n    format: MeetingFormat;\n    agendaItems: Omit<AgendaItem, 'id' | 'votesFor' | 'votesAgainst' | 'votesAbstain' | 'order'>[];\n    location?: string;\n    description?: string;\n  }) => Promise<Meeting>;\n\n  updateMeeting: (id: string, data: Partial<Meeting>) => Promise<void>;\n  deleteMeeting: (id: string) => Promise<void>;\n  getMeeting: (id: string) => Meeting | undefined;\n  getMeetingsByBuilding: (buildingId: string) => Meeting[];\n  getMeetingsByOrganizer: (organizerId: string) => Meeting[];\n  getActiveMeetingsForResident: (userId: string) => Meeting[];\n\n  // Status transitions (state machine)\n  submitForModeration: (meetingId: string) => Promise<void>;\n  approveMeeting: (meetingId: string) => Promise<void>;\n  rejectMeeting: (meetingId: string, reason: string) => Promise<void>;\n  openSchedulePoll: (meetingId: string) => Promise<void>;\n  confirmSchedule: (meetingId: string, selectedOptionId?: string) => Promise<void>;\n  openVoting: (meetingId: string) => Promise<void>;\n  closeVoting: (meetingId: string) => Promise<void>;\n  publishResults: (meetingId: string) => Promise<void>;\n  generateProtocol: (meetingId: string) => Promise<MeetingProtocol>;\n  approveProtocol: (meetingId: string) => Promise<void>;\n  cancelMeeting: (meetingId: string, reason: string) => Promise<void>;\n\n  // Schedule voting\n  voteForSchedule: (meetingId: string, optionId: string) => Promise<{ success: boolean; error?: string }>;\n  getScheduleVoteByUser: (meetingId: string) => Promise<string | null>;\n\n  // Agenda voting\n  voteOnAgendaItem: (\n    meetingId: string,\n    agendaItemId: string,\n    voterId: string,\n    voterName: string,\n    choice: VoteChoice,\n    verificationData: {\n      method: VoteRecord['verificationMethod'];\n      otpVerified: boolean;\n      apartmentId?: string;\n      apartmentNumber?: string;\n      ownershipShare?: number;\n    },\n    comment?: string // /  \n  ) => Promise<VoteRecord>;\n\n  getVoteByUser: (meetingId: string, agendaItemId: string, voterId: string) => VoteRecord | undefined;\n  getUserVotesForMeeting: (meetingId: string, voterId: string) => Promise<VoteRecord[]>;\n\n  // OTP Management\n  requestOTP: (userId: string, phone: string, purpose: OTPRecord['purpose'], meetingId?: string, agendaItemId?: string) => Promise<OTPRecord>;\n  verifyOTP: (otpId: string, code: string) => Promise<boolean>;\n  getActiveOTP: (userId: string, purpose: OTPRecord['purpose']) => OTPRecord | undefined;\n\n  // Results calculation (local, based on cached data)\n  calculateAgendaItemResult: (meetingId: string, agendaItemId: string) => {\n    votesFor: number;\n    votesAgainst: number;\n    votesAbstain: number;\n    totalVotes: number;\n    percentFor: number;\n    isApproved: boolean;\n    thresholdMet: boolean;\n  };\n\n  calculateMeetingQuorum: (meetingId: string) => {\n    participated: number;\n    total: number;\n    percent: number;\n    quorumReached: boolean;\n  };\n\n  // Building settings\n  getBuildingSettings: (buildingId: string) => BuildingMeetingSettings;\n  fetchBuildingSettings: (buildingId: string) => Promise<BuildingMeetingSettings>;\n  updateBuildingSettings: (buildingId: string, settings: Partial<BuildingMeetingSettings>) => Promise<void>;\n\n  // Voting units (apartments)\n  addVotingUnit: (unit: Omit<VotingUnit, 'id'>) => Promise<VotingUnit>;\n  updateVotingUnit: (id: string, data: Partial<VotingUnit>) => Promise<void>;\n  getVotingUnitsByBuilding: (buildingId: string) => VotingUnit[];\n  getVotingUnitByOwner: (ownerId: string) => VotingUnit | undefined;\n  verifyVotingUnit: (id: string, verifiedBy: string) => Promise<void>;\n\n  // Eligible voters\n  setEligibleVoters: (meetingId: string, voterIds: string[], totalCount: number) => Promise<void>;\n\n  // Audit & Evidence\n  getVoteRecordsForMeeting: (meetingId: string) => VoteRecord[];\n  fetchVoteRecordsForMeeting: (meetingId: string) => Promise<VoteRecord[]>;\n  generateEvidenceReport: (meetingId: string) => {\n    meeting: Meeting;\n    votes: VoteRecord[];\n    protocol?: MeetingProtocol;\n    verificationSummary: {\n      totalVotes: number;\n      otpVerified: number;\n      uniqueVoters: number;\n    };\n  };\n}\n\n// ============ Store Implementation ============\n\nexport const useMeetingStore = create<MeetingState>()(\n  persist(\n    (set, get) => ({\n      meetings: [],\n      voteRecords: [],\n      protocols: [],\n      otpRecords: [],\n      votingUnits: [],\n      buildingSettings: [],\n      loading: false,\n      error: null,\n\n      // ========== Data Fetching ==========\n\n      fetchMeetings: async () => {\n        set({ loading: true, error: null });\n        try {\n          //  OPTIMIZED: Fetch only active meetings (reduces payload by ~90%)\n          const response = await meetingsFullApi.getAll({ onlyActive: true });\n          if (response.success && response.data) {\n            const meetings = Array.isArray(response.data) ? response.data.map(mapMeetingFromApi) : [];\n            set({ meetings, loading: false });\n          } else {\n            set({ error: response.error || 'Failed to fetch meetings', loading: false });\n          }\n        } catch (error) {\n          set({ error: 'Network error', loading: false });\n        }\n      },\n\n      fetchMeetingsByBuilding: async (buildingId) => {\n        set({ loading: true, error: null });\n        try {\n          const response = await meetingsFullApi.getAll({ buildingId });\n          if (response.success && response.data) {\n            const newMeetings = Array.isArray(response.data) ? response.data.map(mapMeetingFromApi) : [];\n            set((state) => {\n              // Update only meetings for this building\n              const otherMeetings = state.meetings.filter(m => m.buildingId !== buildingId);\n              return { meetings: [...otherMeetings, ...newMeetings], loading: false };\n            });\n          } else {\n            set({ error: response.error || 'Failed to fetch meetings', loading: false });\n          }\n        } catch (error) {\n          set({ error: 'Network error', loading: false });\n        }\n      },\n\n      fetchVotingUnitsByBuilding: async (buildingId) => {\n        try {\n          const response = await meetingVotingUnitsApi.getByBuilding(buildingId);\n          if (response.success && response.data) {\n            const newUnits = Array.isArray(response.data) ? response.data.map(mapVotingUnitFromApi) : [];\n            set((state) => {\n              const otherUnits = state.votingUnits.filter(u => u.buildingId !== buildingId);\n              return { votingUnits: [...otherUnits, ...newUnits] };\n            });\n          }\n        } catch (error) {\n          console.error('Failed to fetch voting units:', error);\n        }\n      },\n\n      // ========== Meeting CRUD ==========\n\n      createMeeting: async (data) => {\n        set({ loading: true, error: null });\n        try {\n          const response = await meetingsFullApi.create({\n            buildingId: data.buildingId,\n            buildingAddress: data.buildingAddress,\n            organizerType: data.organizerType === 'management' ? 'uk' : data.organizerType,\n            format: data.format,\n            location: data.location,\n            description: data.description,\n            agendaItems: data.agendaItems.map(item => ({\n              title: item.title,\n              description: item.description,\n              threshold: item.threshold,\n            })),\n          });\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({ meetings: [...state.meetings, meeting], loading: false }));\n            return meeting;\n          } else {\n            set({ error: response.error || 'Failed to create meeting', loading: false });\n            throw new Error(response.error || 'Failed to create meeting');\n          }\n        } catch (error) {\n          set({ error: 'Network error', loading: false });\n          throw error;\n        }\n      },\n\n      updateMeeting: async (id, data) => {\n        set({ loading: true, error: null });\n        try {\n          // Convert camelCase to snake_case for API\n          const apiData: Record<string, unknown> = {};\n          if (data.location !== undefined) apiData.location = data.location;\n          if (data.agendaItems !== undefined) apiData.agenda_items = JSON.stringify(data.agendaItems);\n          if (data.materials !== undefined) apiData.materials = JSON.stringify(data.materials);\n          if (data.votingSettings !== undefined) apiData.voting_settings = JSON.stringify(data.votingSettings);\n\n          const response = await meetingsFullApi.update(id, apiData);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === id ? meeting : m),\n              loading: false\n            }));\n          } else {\n            set({ error: response.error || 'Failed to update meeting', loading: false });\n          }\n        } catch (error) {\n          set({ error: 'Network error', loading: false });\n        }\n      },\n\n      deleteMeeting: async (id) => {\n        set({ loading: true, error: null });\n        try {\n          await meetingsFullApi.delete(id);\n          set((state) => ({\n            meetings: state.meetings.filter(m => m.id !== id),\n            voteRecords: state.voteRecords.filter(v => v.meetingId !== id),\n            loading: false\n          }));\n        } catch (error) {\n          set({ error: 'Network error', loading: false });\n        }\n      },\n\n      getMeeting: (id) => {\n        return get().meetings.find(m => m.id === id);\n      },\n\n      getMeetingsByBuilding: (buildingId) => {\n        return get().meetings.filter(m => m.buildingId === buildingId);\n      },\n\n      getMeetingsByOrganizer: (organizerId) => {\n        return get().meetings.filter(m => m.organizerId === organizerId);\n      },\n\n      getActiveMeetingsForResident: (userId) => {\n        return get().meetings.filter(m => {\n          // Check status first\n          if (!['schedule_poll_open', 'schedule_confirmed', 'voting_open'].includes(m.status)) {\n            return false;\n          }\n\n          // If eligibleVoters is empty, it means all residents of the building are eligible (general meeting)\n          // In this case, we can't filter by eligibleVoters, so we just show all active meetings\n          if (m.eligibleVoters.length === 0) {\n            return true;\n          }\n\n          // If eligibleVoters has entries, check if user is in the list\n          return m.eligibleVoters.includes(userId);\n        });\n      },\n\n      // ========== Status Transitions ==========\n\n      submitForModeration: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.submit(meetingId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to submit for moderation:', error);\n        }\n      },\n\n      approveMeeting: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.approve(meetingId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to approve meeting:', error);\n        }\n      },\n\n      rejectMeeting: async (meetingId, reason) => {\n        try {\n          const response = await meetingsFullApi.reject(meetingId, reason);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to reject meeting:', error);\n        }\n      },\n\n      openSchedulePoll: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.openSchedulePoll(meetingId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to open schedule poll:', error);\n        }\n      },\n\n      confirmSchedule: async (meetingId, selectedOptionId) => {\n        try {\n          const response = await meetingsFullApi.confirmSchedule(meetingId, selectedOptionId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to confirm schedule:', error);\n        }\n      },\n\n      openVoting: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.openVoting(meetingId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to open voting:', error);\n        }\n      },\n\n      closeVoting: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.closeVoting(meetingId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to close voting:', error);\n        }\n      },\n\n      publishResults: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.publishResults(meetingId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to publish results:', error);\n        }\n      },\n\n      generateProtocol: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.generateProtocol(meetingId);\n          if (response.success && response.data) {\n            const protocol = mapProtocolFromApi(response.data);\n            set((state) => ({\n              protocols: [...state.protocols, protocol]\n            }));\n            return protocol;\n          }\n          throw new Error('Failed to generate protocol');\n        } catch (error) {\n          console.error('Failed to generate protocol:', error);\n          throw error;\n        }\n      },\n\n      approveProtocol: async (meetingId) => {\n        try {\n          const response = await meetingsFullApi.approveProtocol(meetingId);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to approve protocol:', error);\n        }\n      },\n\n      cancelMeeting: async (meetingId, reason) => {\n        try {\n          const response = await meetingsFullApi.cancel(meetingId, reason);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to cancel meeting:', error);\n        }\n      },\n\n      // ========== Schedule Voting ==========\n\n      voteForSchedule: async (meetingId, optionId) => {\n        try {\n          const response = await meetingScheduleVotesApi.vote(meetingId, optionId);\n          if (response.success) {\n            // Refetch meetings to get accurate vote counts from server\n            await get().fetchMeetings();\n          }\n          return { success: true };\n        } catch (error: any) {\n          console.error('Failed to vote for schedule:', error);\n          const errorMessage = error?.message || '  .     .';\n          return { success: false, error: errorMessage };\n        }\n      },\n\n      getScheduleVoteByUser: async (meetingId) => {\n        try {\n          const response = await meetingScheduleVotesApi.getMyVote(meetingId);\n          if (response.success && response.data) {\n            return response.data.optionId || null;\n          }\n          return null;\n        } catch (error) {\n          console.error('Failed to get schedule vote:', error);\n          return null;\n        }\n      },\n\n      // ========== Agenda Voting ==========\n\n      voteOnAgendaItem: async (meetingId, agendaItemId, voterId, voterName, choice, verificationData, comment) => {\n        try {\n          // Validate choice - API only accepts 'for', 'against', 'abstain'\n          if (choice === 'not_voted') {\n            throw new Error('Cannot submit \"not_voted\" as a vote choice');\n          }\n\n          // Map verification method to API format\n          const apiMethod = verificationData.method === 'otp' ? 'otp' :\n                           verificationData.method === 'in_person' ? 'in_person' :\n                           verificationData.method === 'proxy' ? 'proxy' : 'login';\n\n          const response = await meetingAgendaVotesApi.vote(meetingId, agendaItemId, {\n            voterId,\n            voterName,\n            choice: choice as 'for' | 'against' | 'abstain',\n            verificationMethod: apiMethod,\n            otpVerified: verificationData.otpVerified,\n            apartmentId: verificationData.apartmentId,\n            apartmentNumber: verificationData.apartmentNumber,\n            ownershipShare: verificationData.ownershipShare,\n            comment, //   \n          });\n\n          // Create a temporary vote record based on the response\n          const voteRecord: VoteRecord = {\n            id: crypto.randomUUID(),\n            meetingId,\n            agendaItemId,\n            voterId,\n            voterName,\n            choice,\n            verificationMethod: apiMethod,\n            otpVerified: verificationData.otpVerified,\n            apartmentId: verificationData.apartmentId,\n            apartmentNumber: verificationData.apartmentNumber,\n            ownershipShare: verificationData.ownershipShare,\n            votedAt: new Date().toISOString(),\n            voteHash: response.data?.voteHash || '',\n            isRevote: false,\n          };\n\n          set((state) => ({\n            voteRecords: [...state.voteRecords, voteRecord],\n            // Also update the meeting's participatedVoters list locally\n            meetings: state.meetings.map(m => {\n              if (m.id === meetingId && !m.participatedVoters.includes(voterId)) {\n                return {\n                  ...m,\n                  participatedVoters: [...m.participatedVoters, voterId]\n                };\n              }\n              return m;\n            })\n          }));\n\n          return voteRecord;\n        } catch (error) {\n          console.error('Failed to vote on agenda item:', error);\n          throw error;\n        }\n      },\n\n      getVoteByUser: (meetingId, agendaItemId, voterId) => {\n        return get().voteRecords\n          .filter(v => v.meetingId === meetingId && v.agendaItemId === agendaItemId && v.voterId === voterId)\n          .sort((a, b) => new Date(b.votedAt).getTime() - new Date(a.votedAt).getTime())[0];\n      },\n\n      getUserVotesForMeeting: async (meetingId: string) => {\n        try {\n          const response = await meetingAgendaVotesApi.getMyVotes(meetingId);\n          if (response.success && response.data) {\n            const votes = (response.data as any[]).map(mapVoteRecordFromApi);\n\n            // Update store with fetched votes (merge with existing, avoiding duplicates)\n            set((state) => {\n              const existingIds = new Set(state.voteRecords.map(v => v.id));\n              const newVotes = votes.filter(v => !existingIds.has(v.id));\n              return {\n                voteRecords: [...state.voteRecords, ...newVotes]\n              };\n            });\n\n            return votes;\n          }\n          return [];\n        } catch (error) {\n          console.error('Failed to get user votes:', error);\n          return [];\n        }\n      },\n\n      // ========== OTP Management ==========\n\n      requestOTP: async (userId, phone, purpose, meetingId, agendaItemId) => {\n        try {\n          // Map purpose to API format\n          const apiPurpose = purpose === 'meeting_vote' ? 'agenda_vote' : purpose;\n          const response = await meetingOtpApi.request({\n            userId, phone,\n            purpose: apiPurpose as 'schedule_vote' | 'agenda_vote' | 'protocol_sign',\n            meetingId, agendaItemId\n          });\n          if (response.success && response.data) {\n            const otpRecord = mapOTPRecordFromApi(response.data);\n            set((state) => ({ otpRecords: [...state.otpRecords, otpRecord] }));\n            return otpRecord;\n          }\n          throw new Error('Failed to request OTP');\n        } catch (error) {\n          console.error('Failed to request OTP:', error);\n          throw error;\n        }\n      },\n\n      verifyOTP: async (otpId, code) => {\n        try {\n          const response = await meetingOtpApi.verify(otpId, code);\n          if (response.success && response.data?.verified) {\n            set((state) => ({\n              otpRecords: state.otpRecords.map(o =>\n                o.id === otpId ? { ...o, isUsed: true, verifiedAt: new Date().toISOString() } : o\n              )\n            }));\n            return true;\n          }\n          // Update attempts on failed verify\n          set((state) => ({\n            otpRecords: state.otpRecords.map(o =>\n              o.id === otpId ? { ...o, attempts: o.attempts + 1 } : o\n            )\n          }));\n          return false;\n        } catch (error) {\n          console.error('Failed to verify OTP:', error);\n          return false;\n        }\n      },\n\n      getActiveOTP: (userId, purpose) => {\n        const now = new Date();\n        return get().otpRecords.find(\n          o =>\n            o.userId === userId &&\n            o.purpose === purpose &&\n            !o.isUsed &&\n            new Date(o.expiresAt) > now &&\n            o.attempts < o.maxAttempts\n        );\n      },\n\n      // ========== Results Calculation ==========\n\n      calculateAgendaItemResult: (meetingId, agendaItemId) => {\n        const meeting = get().getMeeting(meetingId);\n        if (!meeting) {\n          return {\n            votesFor: 0,\n            votesAgainst: 0,\n            votesAbstain: 0,\n            totalVotes: 0,\n            percentFor: 0,\n            isApproved: false,\n            thresholdMet: false,\n          };\n        }\n\n        const item = meeting.agendaItems.find(i => i.id === agendaItemId);\n        if (!item) {\n          return {\n            votesFor: 0,\n            votesAgainst: 0,\n            votesAbstain: 0,\n            totalVotes: 0,\n            percentFor: 0,\n            isApproved: false,\n            thresholdMet: false,\n          };\n        }\n\n        // votesFor/Against/Abstain are now numbers (area in sq.m), not arrays\n        const votesFor = typeof item.votesFor === 'number' ? item.votesFor : (item.votesFor as any)?.length || 0;\n        const votesAgainst = typeof item.votesAgainst === 'number' ? item.votesAgainst : (item.votesAgainst as any)?.length || 0;\n        const votesAbstain = typeof item.votesAbstain === 'number' ? item.votesAbstain : (item.votesAbstain as any)?.length || 0;\n        const totalVotes = votesFor + votesAgainst + votesAbstain;\n\n        const percentFor = totalVotes > 0 ? (votesFor / totalVotes) * 100 : 0;\n\n        const thresholdPercent = {\n          simple_majority: 50,\n          qualified_majority: 60,\n          two_thirds: 66.67,\n          three_quarters: 75,\n          unanimous: 100,\n        }[item.threshold];\n\n        const thresholdMet = percentFor > thresholdPercent;\n        const isApproved = thresholdMet && meeting.quorumReached;\n\n        return {\n          votesFor,\n          votesAgainst,\n          votesAbstain,\n          totalVotes,\n          percentFor,\n          isApproved,\n          thresholdMet,\n        };\n      },\n\n      calculateMeetingQuorum: (meetingId) => {\n        const meeting = get().getMeeting(meetingId);\n        if (!meeting) {\n          return { participated: 0, total: 0, percent: 0, quorumReached: false };\n        }\n\n        const participated = meeting.participatedVoters?.length || 0;\n        const total = meeting.totalEligibleCount || meeting.eligibleVoters?.length || 0;\n        const percent = total > 0 ? (participated / total) * 100 : 0;\n        // Use quorumReached from server if available, otherwise calculate from votingSettings\n        const quorumPercent = meeting.votingSettings?.quorumPercent || 50;\n        const quorumReached = meeting.quorumReached ?? (percent >= quorumPercent);\n\n        return { participated, total, percent, quorumReached };\n      },\n\n      // ========== Building Settings ==========\n\n      getBuildingSettings: (buildingId) => {\n        const existing = get().buildingSettings.find(s => s.buildingId === buildingId);\n        if (existing) return existing;\n        return { ...defaultBuildingSettings, buildingId };\n      },\n\n      fetchBuildingSettings: async (buildingId) => {\n        try {\n          const response = await meetingBuildingSettingsApi.get(buildingId);\n          if (response.success && response.data) {\n            const settings = mapBuildingSettingsFromApi(response.data);\n            set((state) => {\n              const existing = state.buildingSettings.find(s => s.buildingId === buildingId);\n              if (existing) {\n                return {\n                  buildingSettings: state.buildingSettings.map(s =>\n                    s.buildingId === buildingId ? settings : s\n                  )\n                };\n              }\n              return { buildingSettings: [...state.buildingSettings, settings] };\n            });\n            return settings;\n          }\n          return { ...defaultBuildingSettings, buildingId };\n        } catch (error) {\n          console.error('Failed to fetch building settings:', error);\n          return { ...defaultBuildingSettings, buildingId };\n        }\n      },\n\n      updateBuildingSettings: async (buildingId, settings) => {\n        try {\n          // Convert to API format\n          const apiData: Record<string, unknown> = {};\n          if (settings.votingUnit !== undefined) apiData.voting_unit = settings.votingUnit;\n          if (settings.defaultQuorumPercent !== undefined) apiData.default_quorum_percent = settings.defaultQuorumPercent;\n          if (settings.schedulePollDurationDays !== undefined) apiData.schedule_poll_duration_days = settings.schedulePollDurationDays;\n          if (settings.votingDurationHours !== undefined) apiData.voting_duration_hours = settings.votingDurationHours;\n          if (settings.allowResidentInitiative !== undefined) apiData.allow_resident_initiative = settings.allowResidentInitiative;\n          if (settings.requireModeration !== undefined) apiData.require_moderation = settings.requireModeration;\n          if (settings.defaultMeetingTime !== undefined) apiData.default_meeting_time = settings.defaultMeetingTime;\n          if (settings.reminderHoursBefore !== undefined) apiData.reminder_hours_before = JSON.stringify(settings.reminderHoursBefore);\n          if (settings.notificationChannels !== undefined) apiData.notification_channels = JSON.stringify(settings.notificationChannels);\n\n          const response = await meetingBuildingSettingsApi.update(buildingId, apiData);\n          if (response.success && response.data) {\n            const updatedSettings = mapBuildingSettingsFromApi(response.data);\n            set((state) => {\n              const existing = state.buildingSettings.find(s => s.buildingId === buildingId);\n              if (existing) {\n                return {\n                  buildingSettings: state.buildingSettings.map(s =>\n                    s.buildingId === buildingId ? updatedSettings : s\n                  )\n                };\n              }\n              return { buildingSettings: [...state.buildingSettings, updatedSettings] };\n            });\n          }\n        } catch (error) {\n          console.error('Failed to update building settings:', error);\n        }\n      },\n\n      // ========== Voting Units ==========\n\n      addVotingUnit: async (unit) => {\n        try {\n          // API already handles camelCase -> snake_case conversion\n          const response = await meetingVotingUnitsApi.create({\n            buildingId: unit.buildingId,\n            apartmentId: unit.apartmentId,\n            apartmentNumber: unit.apartmentNumber,\n            totalArea: unit.totalArea,\n            ownershipShare: unit.ownershipShare,\n            ownerId: unit.ownerId,\n            ownerName: unit.ownerName,\n            coOwnerIds: unit.coOwnerIds || [],\n          });\n          if (response.success && response.data) {\n            const votingUnit = mapVotingUnitFromApi(response.data);\n            set((state) => ({ votingUnits: [...state.votingUnits, votingUnit] }));\n            return votingUnit;\n          }\n          throw new Error('Failed to create voting unit');\n        } catch (error) {\n          console.error('Failed to add voting unit:', error);\n          throw error;\n        }\n      },\n\n      updateVotingUnit: async (id, data) => {\n        // This would require a PATCH endpoint - for now, use local update\n        set((state) => ({\n          votingUnits: state.votingUnits.map(u => u.id === id ? { ...u, ...data } : u)\n        }));\n      },\n\n      getVotingUnitsByBuilding: (buildingId) => {\n        return get().votingUnits.filter(u => u.buildingId === buildingId);\n      },\n\n      getVotingUnitByOwner: (ownerId) => {\n        return get().votingUnits.find(\n          u => u.ownerId === ownerId || u.coOwnerIds?.includes(ownerId)\n        );\n      },\n\n      verifyVotingUnit: async (id, verifiedBy) => {\n        try {\n          const response = await meetingVotingUnitsApi.verify(id, verifiedBy);\n          if (response.success && response.data) {\n            const votingUnit = mapVotingUnitFromApi(response.data);\n            set((state) => ({\n              votingUnits: state.votingUnits.map(u => u.id === id ? votingUnit : u)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to verify voting unit:', error);\n        }\n      },\n\n      // ========== Eligible Voters ==========\n\n      setEligibleVoters: async (meetingId, voterIds, totalCount) => {\n        try {\n          const response = await meetingEligibleVotersApi.set(meetingId, voterIds, totalCount);\n          if (response.success && response.data) {\n            const meeting = mapMeetingFromApi(response.data);\n            set((state) => ({\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\n            }));\n          }\n        } catch (error) {\n          console.error('Failed to set eligible voters:', error);\n        }\n      },\n\n      // ========== Audit & Evidence ==========\n\n      getVoteRecordsForMeeting: (meetingId) => {\n        return get().voteRecords.filter(v => v.meetingId === meetingId);\n      },\n\n      fetchVoteRecordsForMeeting: async (meetingId) => {\n        try {\n          const response = await meetingAgendaVotesApi.getVoteRecords(meetingId);\n          if (response.success && response.data) {\n            const dataArray = Array.isArray(response.data) ? response.data : [];\n            const records = dataArray.map(mapVoteRecordFromApi);\n            // Merge with existing records\n            set((state) => {\n              const otherRecords = state.voteRecords.filter(v => v.meetingId !== meetingId);\n              return { voteRecords: [...otherRecords, ...records] };\n            });\n            return records;\n          }\n          return [];\n        } catch (error) {\n          console.error('Failed to fetch vote records:', error);\n          return [];\n        }\n      },\n\n      generateEvidenceReport: (meetingId) => {\n        const meeting = get().getMeeting(meetingId);\n        if (!meeting) throw new Error('Meeting not found');\n\n        const votes = get().getVoteRecordsForMeeting(meetingId);\n        const protocol = get().protocols.find(p => p.meetingId === meetingId);\n\n        const uniqueVoters = new Set(votes.map(v => v.voterId)).size;\n        const otpVerified = votes.filter(v => v.otpVerified).length;\n\n        return {\n          meeting,\n          votes,\n          protocol,\n          verificationSummary: {\n            totalVotes: votes.length,\n            otpVerified,\n            uniqueVoters,\n          },\n        };\n      },\n    }),\n    {\n      name: 'uk-meeting-storage',\n      partialize: (state) => ({\n        // Only persist locally cached data for offline support\n        otpRecords: state.otpRecords,\n        buildingSettings: state.buildingSettings,\n      }),\n    }\n  )\n);\n","interface AppLogoProps {\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n}\n\nexport function AppLogo({ size = 'md' }: AppLogoProps) {\n  const sizeClasses = {\n    sm: 'w-8 h-8',\n    md: 'w-10 h-10',\n    lg: 'w-12 h-12',\n    xl: 'w-16 h-16 md:w-20 md:h-20'\n  };\n\n  return (\n    <img\n      src=\"/favicon.svg\"\n      alt=\"Kamizo\"\n      className={`${sizeClasses[size]} object-contain`}\n    />\n  );\n}\n","import { Link, useLocation } from 'react-router-dom';\nimport { useMemo, useState, useEffect, useCallback } from 'react';\nimport {\n  LayoutDashboard, FileText, Users, Wrench, Building2, Settings,\n  LogOut, User, Home, Shield, BarChart3,\n  Megaphone, Vote, GraduationCap,\n  CalendarDays, Car, QrCode, MessageCircle, ScrollText, Key,\n  X as CloseIcon, Star, StickyNote, Phone, Ticket\n} from 'lucide-react';\nimport { useAuthStore } from '../../stores/authStore';\nimport { useLanguageStore } from '../../stores/languageStore';\nimport { useDataStore } from '../../stores/dataStore';\nimport { useMeetingStore } from '../../stores/meetingStore';\nimport { AppLogo } from '../common/AppLogo';\nimport { chatApi } from '../../services/api';\n\ninterface SidebarProps {\n  onLogout: () => void;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function Sidebar({ onLogout, isOpen, onClose }: SidebarProps) {\n  const location = useLocation();\n  const { user } = useAuthStore();\n  const { t, language } = useLanguageStore();\n  const { requests, announcements, executors, getAnnouncementsForEmployees } = useDataStore();\n  const { meetings } = useMeetingStore();\n\n  // Chat unread count state\n  const [chatUnreadCount, setChatUnreadCount] = useState(0);\n\n  // Fetch chat unread count\n  const fetchChatUnreadCount = useCallback(async () => {\n    if (!user) return;\n    // Only fetch for users who have chat access\n    if (!['admin', 'manager', 'resident'].includes(user.role)) return;\n\n    try {\n      const response = await chatApi.getUnreadCount();\n      setChatUnreadCount(response.unread_count || 0);\n    } catch (error) {\n      console.error('Failed to fetch chat unread count:', error);\n    }\n  }, [user]);\n\n  // Initial fetch and polling every 10 seconds\n  useEffect(() => {\n    fetchChatUnreadCount();\n    const interval = setInterval(fetchChatUnreadCount, 10000);\n    return () => clearInterval(interval);\n  }, [fetchChatUnreadCount]);\n\n  // Calculate meeting status for badge color\n  const meetingStatus = useMemo(() => {\n    if (!user) return null;\n    const now = new Date();\n    const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\n\n    // Find meetings relevant to user\n    const relevantMeetings = meetings.filter(m => {\n      if (m.status === 'cancelled') return false;\n\n      // Show badge for meetings with open schedule poll or voting\n      if (m.status === 'schedule_poll_open' || m.status === 'voting_open') {\n        return true;\n      }\n\n      // For other statuses, check if meeting is within next week\n      if (!m.confirmedDateTime) return false;\n      const meetingDate = new Date(m.confirmedDateTime);\n      return meetingDate >= now && meetingDate <= weekFromNow;\n    });\n\n    if (relevantMeetings.length === 0) return null;\n\n    // Check if any meeting has active voting (voting_open status)\n    const hasActiveVoting = relevantMeetings.some(m =>\n      m.status === 'voting_open' || m.status === 'schedule_poll_open'\n    );\n\n    // Check if any meeting is confirmed/completed (voting finished, results published)\n    const hasConfirmedMeeting = relevantMeetings.some(m =>\n      m.status === 'voting_closed' ||\n      m.status === 'results_published' ||\n      m.status === 'protocol_generated' ||\n      m.status === 'protocol_approved'\n    );\n\n    if (hasActiveVoting) return 'voting'; // blue\n    if (hasConfirmedMeeting) return 'confirmed'; // green\n    return 'upcoming'; // normal count\n  }, [user, meetings]);\n\n  // Calculate notification badges\n  const badges = useMemo(() => {\n    if (!user) return {};\n\n    // For executors\n    if (user.role === 'executor') {\n      const currentExecutor = executors.find(e => e.login === user.login);\n      const mySpecialization = currentExecutor?.specialization || user.specialization;\n\n      // Count new requests matching executor's specialization\n      const availableRequestsCount = requests.filter(r =>\n        r.status === 'new' && r.category === mySpecialization\n      ).length;\n\n      // Count assigned requests waiting for action\n      const assignedRequestsCount = requests.filter(r =>\n        r.executorId === currentExecutor?.id && (r.status === 'assigned' || r.status === 'accepted')\n      ).length;\n\n      // Count unread announcements for employees\n      const employeeAnnouncements = getAnnouncementsForEmployees();\n      const unreadAnnouncementsCount = employeeAnnouncements.filter(a =>\n        !a.viewedBy?.includes(user.id)\n      ).length;\n\n      return {\n        '/': availableRequestsCount + assignedRequestsCount,\n        '/announcements': unreadAnnouncementsCount,\n      };\n    }\n\n    // For residents\n    if (user.role === 'resident') {\n      // Count active requests (not completed)\n      const activeRequestsCount = requests.filter(r =>\n        r.residentId === user.id && !['completed', 'closed', 'cancelled'].includes(r.status)\n      ).length;\n\n      // Count unread announcements\n      const unreadAnnouncementsCount = announcements.filter(a =>\n        a.isActive && !a.viewedBy?.includes(user.id) && (a.type === 'residents' || a.type === 'all')\n      ).length;\n\n      // Count upcoming meetings\n      const now = new Date();\n      const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\n      const upcomingMeetingsCount = meetings.filter(m => {\n        if (m.status === 'cancelled') return false;\n        if (!m.confirmedDateTime) return false;\n        const meetingDate = new Date(m.confirmedDateTime);\n        return meetingDate >= now && meetingDate <= weekFromNow;\n      }).length;\n\n      return {\n        '/': activeRequestsCount,\n        '/announcements': unreadAnnouncementsCount,\n        '/meetings': upcomingMeetingsCount,\n        '/chat': chatUnreadCount,\n      };\n    }\n\n    // For managers/admins/director\n    if (user.role === 'manager' || user.role === 'admin' || user.role === 'department_head' || user.role === 'director') {\n      // Count new unassigned requests\n      const newRequestsCount = requests.filter(r => r.status === 'new').length;\n\n      // Count upcoming meetings for managers\n      const now = new Date();\n      const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\n      const upcomingMeetingsCount = meetings.filter(m => {\n        if (m.status === 'cancelled') return false;\n        if (!m.confirmedDateTime) return false;\n        const meetingDate = new Date(m.confirmedDateTime);\n        return meetingDate >= now && meetingDate <= weekFromNow;\n      }).length;\n\n      return {\n        '/requests': newRequestsCount,\n        '/meetings': upcomingMeetingsCount,\n        '/chat': chatUnreadCount,\n      };\n    }\n\n    return {};\n  }, [user, requests, announcements, executors, getAnnouncementsForEmployees, chatUnreadCount, meetings]);\n\n  // Different nav items based on role and account_type\n  const getNavItems = () => {\n    // Special account types first\n    if (user?.account_type === 'advertiser') {\n      return [\n        { path: '/', icon: LayoutDashboard, label: language === 'ru' ? ' ' : 'Mening e\\'lonlarim' },\n      ];\n    }\n    if (user?.account_type === 'coupon_checker') {\n      return [\n        { path: '/', icon: Ticket, label: language === 'ru' ? ' ' : 'Kuponlarni tekshirish' },\n      ];\n    }\n\n    if (user?.role === 'executor') {\n      // Security guards get QR scanner\n      const baseItems = [\n        { path: '/', icon: FileText, label: language === 'ru' ? '' : 'Arizalar' },\n        { path: '/schedule', icon: CalendarDays, label: language === 'ru' ? '' : 'Jadval' },\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\n      ];\n\n      // Add QR scanner for security guards\n      if (user?.specialization === 'security') {\n        baseItems.push({ path: '/qr-scanner', icon: QrCode, label: language === 'ru' ? ' QR' : 'QR skaner' });\n      }\n\n      return [\n        ...baseItems,\n        { path: '/stats', icon: BarChart3, label: language === 'ru' ? '' : 'Statistika' },\n        { path: '/announcements', icon: Megaphone, label: language === 'ru' ? '' : 'E\\'lonlar' },\n        { path: '/trainings', icon: GraduationCap, label: language === 'ru' ? '' : 'Treninglar' },\n        { path: '/colleagues', icon: Users, label: language === 'ru' ? '' : 'Hamkasblar' },\n        { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Eslatmalar' },\n      ];\n    }\n    if (user?.role === 'resident') {\n      return [\n        { path: '/', icon: Home, label: t('nav.services') },\n        { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '  ' : 'UK ga yozish' },\n        { path: '/vehicles', icon: Car, label: language === 'ru' ? ' ' : 'Mening avtomobillarim' },\n        { path: '/guest-access', icon: QrCode, label: language === 'ru' ? ' ' : 'Mehmon kirishi' },\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\n        { path: '/meetings', icon: Vote, label: t('meetings.title') },\n        { path: '/useful-contacts', icon: Phone, label: language === 'ru' ? ' ' : 'Foydali kontaktlar' },\n        { path: '/rate-employees', icon: Star, label: language === 'ru' ? '' : 'Baholash' },\n        { path: '/contract', icon: ScrollText, label: language === 'ru' ? '' : 'Shartnoma' },\n      ];\n    }\n    if (user?.role === 'tenant' || user?.role === 'commercial_owner') {\n      return [\n        { path: '/', icon: Key, label: t('nav.myApartments') },\n      ];\n    }\n    if (user?.role === 'admin') {\n      return [\n        { path: '/', icon: Shield, label: t('nav.monitoring') },\n        { path: '/requests', icon: FileText, label: t('nav.requests') },\n        { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '' : 'Chatlar' },\n        { path: '/team', icon: Users, label: language === 'ru' ? '' : 'Xodimlar' },\n        { path: '/residents', icon: Users, label: t('nav.residents') },\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\n        { path: '/buildings', icon: Building2, label: t('nav.buildings') },\n        { path: '/work-orders', icon: Wrench, label: t('nav.workOrders') },\n        { path: '/meetings', icon: Vote, label: t('meetings.title') },\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\n        { path: '/trainings', icon: GraduationCap, label: t('nav.trainings') },\n        { path: '/reports', icon: BarChart3, label: t('nav.reports') },\n        { path: '/settings', icon: Settings, label: t('nav.settings') },\n      ];\n    }\n    // Director ( ) -   \n    if (user?.role === 'director') {\n      return [\n        { path: '/', icon: LayoutDashboard, label: language === 'ru' ? ' ' : 'Kompaniya sharhi' },\n        { path: '/requests', icon: FileText, label: t('nav.requests') },\n        { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '' : 'Chatlar' },\n        { path: '/team', icon: Users, label: language === 'ru' ? '' : 'Xodimlar' },\n        { path: '/residents', icon: Users, label: t('nav.residents') },\n        { path: '/buildings', icon: Building2, label: t('nav.buildings') },\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\n        { path: '/guest-access', icon: QrCode, label: language === 'ru' ? ' ' : 'Mehmon ruxsatnomalari' },\n        { path: '/rentals', icon: Key, label: language === 'ru' ? '' : 'Ijara' },\n        { path: '/meetings', icon: Vote, label: t('meetings.title') },\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\n        { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Bloknot' },\n        { path: '/reports', icon: BarChart3, label: t('nav.reports') },\n        { path: '/settings', icon: Settings, label: t('nav.settings') },\n      ];\n    }\n    // Department Head ( ) - limited manager view for their department\n    if (user?.role === 'department_head') {\n      return [\n        { path: '/', icon: LayoutDashboard, label: language === 'ru' ? ' ' : 'Mening bo\\'limim' },\n        { path: '/requests', icon: FileText, label: language === 'ru' ? '' : 'Arizalar' },\n        { path: '/executors', icon: Wrench, label: language === 'ru' ? '' : 'Xodimlar' },\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\n        { path: '/trainings', icon: GraduationCap, label: t('nav.trainings') },\n        { path: '/colleagues', icon: Users, label: language === 'ru' ? '' : 'Hamkasblar' },\n        { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Bloknot' },\n      ];\n    }\n    // Manager -  \n    return [\n      { path: '/', icon: LayoutDashboard, label: t('nav.dashboard') },\n      { path: '/requests', icon: FileText, label: t('nav.requests') },\n      { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '' : 'Chatlar' },\n      { path: '/executors', icon: Wrench, label: t('nav.executors') },\n      { path: '/residents', icon: Users, label: t('nav.residents') },\n      { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\n      { path: '/guest-access', icon: QrCode, label: language === 'ru' ? ' ' : 'Mehmon ruxsatnomalari' },\n      { path: '/rentals', icon: Key, label: t('nav.rentals') },\n      { path: '/buildings', icon: Building2, label: t('nav.buildings') },\n      { path: '/work-orders', icon: Wrench, label: t('nav.workOrders') },\n      { path: '/meetings', icon: Vote, label: t('meetings.title') },\n      { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\n      { path: '/trainings', icon: GraduationCap, label: t('nav.trainings') },\n      { path: '/colleagues', icon: Users, label: language === 'ru' ? ' ' : 'Hamkasblar' },\n      { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Eslatmalar' },\n      { path: '/reports', icon: BarChart3, label: t('nav.reports') },\n      { path: '/settings', icon: Settings, label: t('nav.settings') },\n    ];\n  };\n\n  const navItems = getNavItems();\n\n  const handleNavClick = () => {\n    // Close sidebar on mobile after navigation\n    if (window.innerWidth < 768) {\n      onClose();\n    }\n  };\n\n  return (\n    <>\n      {/* Mobile overlay */}\n      <div\n        className={`sidebar-overlay ${isOpen ? 'open' : ''}`}\n        onClick={onClose}\n      />\n\n      <div className={`sidebar ${isOpen ? 'open' : ''}`}>\n        <div className=\"p-4 md:p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <AppLogo size=\"md\" />\n              <div>\n                <div className=\"font-bold text-gray-900\">My Helper</div>\n                <div className=\"text-xs text-gray-500\">CRM</div>\n              </div>\n            </div>\n            {/* Close button for mobile */}\n            <button\n              onClick={onClose}\n              className=\"md:hidden p-2 hover:bg-white/30 rounded-lg\"\n            >\n              <CloseIcon className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        <nav className=\"flex-1 py-4 overflow-y-auto\">\n          {navItems.map((item: { path: string; icon: React.ElementType; label: string; separator?: boolean }) => {\n            const badgeCount = badges[item.path as keyof typeof badges] || 0;\n            // Special color for meetings based on voting status\n            const isMeetingsTab = item.path === '/meetings';\n            const badgeColor = isMeetingsTab && meetingStatus\n              ? (meetingStatus === 'voting' ? 'bg-blue-500' : meetingStatus === 'confirmed' ? 'bg-green-500' : 'bg-red-500')\n              : 'bg-red-500';\n            const shouldAnimate = !isMeetingsTab || meetingStatus === 'voting';\n\n            return (\n              <div key={item.path}>\n                {item.separator && (\n                  <div className=\"my-3 mx-4 border-t border-white/20\" />\n                )}\n                <Link\n                  to={item.path}\n                  onClick={handleNavClick}\n                  className={`sidebar-item ${location.pathname === item.path ? 'active' : ''}`}\n                >\n                  <div className=\"relative\">\n                    <item.icon className=\"w-5 h-5\" />\n                    {badgeCount > 0 && (\n                      <span className={`absolute -top-2 -right-2 min-w-[18px] h-[18px] flex items-center justify-center px-1 text-[10px] font-bold text-white ${badgeColor} rounded-full ${shouldAnimate ? 'animate-pulse' : ''}`}>\n                        {badgeCount > 99 ? '99+' : badgeCount}\n                      </span>\n                    )}\n                  </div>\n                  <span className=\"flex-1\">{item.label}</span>\n                  {badgeCount > 0 && (\n                    <span className={`ml-auto px-2 py-0.5 text-xs font-bold text-white ${badgeColor} rounded-full`}>\n                      {badgeCount > 99 ? '99+' : badgeCount}\n                    </span>\n                  )}\n                </Link>\n              </div>\n            );\n          })}\n        </nav>\n\n        <div className=\"p-4 border-t border-white/20 space-y-1\">\n          {/* Profile link for residents and rental users */}\n          {(user?.role === 'resident' || user?.role === 'tenant' || user?.role === 'commercial_owner') && (\n            <Link\n              to=\"/profile\"\n              onClick={handleNavClick}\n              className={`sidebar-item ${location.pathname === '/profile' ? 'active' : ''}`}\n            >\n              <User className=\"w-5 h-5\" />\n              <span>{language === 'ru' ? ' ' : 'Mening profilim'}</span>\n            </Link>\n          )}\n          <button onClick={onLogout} className=\"sidebar-item w-full text-red-500 hover:bg-red-50\">\n            <LogOut className=\"w-5 h-5\" />\n            <span>{language === 'ru' ? '' : 'Chiqish'}</span>\n          </button>\n        </div>\n      </div>\n    </>\n  );\n}\n","import { useState, useMemo } from 'react';\nimport { createPortal } from 'react-dom';\nimport { Bell, Menu, Megaphone, Users, Key, Phone, FileText, Car, CheckCircle } from 'lucide-react';\nimport { useAuthStore } from '../../stores/authStore';\nimport { useDataStore } from '../../stores/dataStore';\nimport { useMeetingStore } from '../../stores/meetingStore';\nimport { AppLogo } from '../common/AppLogo';\nimport { useNavigate } from 'react-router-dom';\n\ninterface MobileHeaderProps {\n  onMenuClick: () => void;\n  unreadCount: number;\n}\n\nexport function MobileHeader({ onMenuClick, unreadCount }: MobileHeaderProps) {\n  const { user } = useAuthStore();\n  const navigate = useNavigate();\n  const [showNotifications, setShowNotifications] = useState(false);\n  const { notifications, markNotificationAsRead, markAllNotificationsAsRead, getAnnouncementsForResidents, getAnnouncementsForEmployees, vehicles } = useDataStore();\n  const { meetings } = useMeetingStore();\n\n  // Check if resident and get onboarding tasks\n  const isResident = user?.role?.toLowerCase() === 'resident' || user?.role?.toLowerCase() === 'tenant';\n\n  // Get unread announcements\n  const userAnnouncements = useMemo(() => {\n    if (!user) return [];\n    return isResident\n      ? getAnnouncementsForResidents(user.login || '', user.buildingId || '', user.entrance || '', user.floor || '', user.branch || '')\n      : getAnnouncementsForEmployees();\n  }, [user, isResident, getAnnouncementsForResidents, getAnnouncementsForEmployees]);\n\n  const unreadAnnouncementsCount = userAnnouncements.filter(a => !a.viewedBy?.includes(user?.id || '')).length;\n\n  // Get upcoming meetings\n  const upcomingMeetings = useMemo(() => {\n    const nowDate = new Date();\n    const weekFromNow = new Date(nowDate.getTime() + 7 * 24 * 60 * 60 * 1000);\n    return meetings.filter(m => {\n      if (!m.confirmedDateTime) return false;\n      const meetingDate = new Date(m.confirmedDateTime);\n      return meetingDate >= nowDate && meetingDate <= weekFromNow && m.status !== 'cancelled';\n    });\n  }, [meetings]);\n\n  // Calculate pending onboarding tasks with details\n  const pendingTasks = useMemo(() => {\n    if (!isResident || !user) return [];\n    const tasks: { id: string; title: string; description: string; icon: typeof Key; path: string; completed: boolean }[] = [\n      {\n        id: 'password',\n        title: ' ',\n        description: '  ',\n        icon: Key,\n        path: '/profile',\n        completed: !!user.passwordChangedAt\n      },\n      {\n        id: 'phone',\n        title: ' ',\n        description: '   ',\n        icon: Phone,\n        path: '/profile',\n        completed: !!(user.phone && user.phone.length >= 5)\n      },\n      {\n        id: 'contract',\n        title: ' ',\n        description: '   ',\n        icon: FileText,\n        path: '/contract',\n        completed: !!user.contractSignedAt\n      },\n      {\n        id: 'vehicle',\n        title: ' ',\n        description: '  ',\n        icon: Car,\n        path: '/vehicles',\n        completed: vehicles.some(v => v.ownerId === user.id)\n      }\n    ];\n    return tasks;\n  }, [isResident, user, vehicles]);\n\n  const pendingTasksCount = pendingTasks.filter(t => !t.completed).length;\n\n  // Menu badge - only sidebar tab notifications (announcements, meetings), NOT onboarding tasks\n  const totalMenuBadge = unreadAnnouncementsCount + upcomingMeetings.length;\n\n  const userNotifications = notifications.filter(n => n.userId === user?.id).slice(0, 10);\n\n  const formatTime = (dateStr: string) => {\n    const date = new Date(dateStr);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n\n    if (diffMins < 1) return ' ';\n    if (diffMins < 60) return `${diffMins} `;\n    if (diffHours < 24) return `${diffHours} `;\n    return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });\n  };\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case 'request_created': return '';\n      case 'request_assigned': return '';\n      case 'request_accepted': return '';\n      case 'request_started': return '';\n      case 'request_completed': return '';\n      case 'request_approved': return '';\n      case 'request_rejected': return '';\n      case 'request_cancelled': return '';\n      case 'request_declined': return '';\n      default: return '';\n    }\n  };\n\n  // Total badge for notifications button - includes onboarding tasks for residents\n  const totalNotificationsBadge = unreadCount + unreadAnnouncementsCount + upcomingMeetings.length + pendingTasksCount;\n\n  return (\n    <>\n      <header className=\"mobile-header\">\n        <button onClick={onMenuClick} className=\"p-2 hover:bg-white/30 rounded-lg relative\">\n          <Menu className=\"w-6 h-6\" />\n          {/* Badge on menu button for pending tasks */}\n          {totalMenuBadge > 0 && (\n            <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-amber-500 rounded-full text-white text-[10px] flex items-center justify-center\">\n              {totalMenuBadge > 9 ? '9+' : totalMenuBadge}\n            </span>\n          )}\n        </button>\n\n        <div className=\"flex items-center gap-2\">\n          <AppLogo size=\"sm\" />\n          <span className=\"font-bold text-gray-900 text-sm\">My Helper</span>\n        </div>\n\n        <button\n          onClick={() => setShowNotifications(!showNotifications)}\n          className=\"p-2 hover:bg-white/30 rounded-lg relative\"\n        >\n          <Bell className=\"w-6 h-6\" />\n          {totalNotificationsBadge > 0 && (\n            <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center\">\n              {totalNotificationsBadge > 9 ? '9+' : totalNotificationsBadge}\n            </span>\n          )}\n        </button>\n      </header>\n\n      {/* Mobile Notifications Dropdown - Full categories like desktop */}\n      {showNotifications && createPortal(\n        <div className=\"notifications-portal\">\n          <div\n            className=\"fixed inset-0 bg-black/20\"\n            style={{ zIndex: 10000 }}\n            onClick={() => setShowNotifications(false)}\n          />\n          <div\n            className=\"fixed left-2 right-2 bottom-16 bg-white rounded-2xl border border-gray-200 shadow-2xl overflow-hidden\"\n            style={{ zIndex: 10001, maxHeight: '70vh' }}\n          >\n            <div className=\"p-3 border-b border-gray-200 flex items-center justify-between bg-gray-50\">\n              <h3 className=\"font-semibold text-sm\"></h3>\n              {unreadCount > 0 && (\n                <button\n                  onClick={() => user && markAllNotificationsAsRead(user.id)}\n                  className=\"text-xs text-blue-600\"\n                >\n                   \n                </button>\n              )}\n            </div>\n            <div className=\"overflow-y-auto\" style={{ maxHeight: 'calc(70vh - 90px)' }}>\n              {/* Onboarding Tasks Section - for residents */}\n              {isResident && pendingTasks.length > 0 && (\n                <div className=\"border-b border-gray-200\">\n                  <div className=\"px-3 py-2 bg-amber-50 border-b border-amber-100\">\n                    <p className=\"text-xs font-medium text-amber-700 flex items-center gap-1\">\n                      <CheckCircle className=\"w-3 h-3\" />\n                       ({pendingTasksCount}/{pendingTasks.length})\n                    </p>\n                  </div>\n                  {pendingTasks.map((task) => (\n                    <div\n                      key={task.id}\n                      onClick={() => { setShowNotifications(false); navigate(task.path); }}\n                      className={`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 flex items-center gap-2 ${task.completed ? 'bg-green-50/50' : 'bg-amber-50/50'}`}\n                    >\n                      <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${task.completed ? 'bg-green-100' : 'bg-amber-100'}`}>\n                        <task.icon className={`w-4 h-4 ${task.completed ? 'text-green-600' : 'text-amber-600'}`} />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className={`text-sm font-medium ${task.completed ? 'text-green-700 line-through' : 'text-gray-900'}`}>\n                          {task.title}\n                        </p>\n                        <p className=\"text-xs text-gray-500\">{task.description}</p>\n                      </div>\n                      {task.completed ? (\n                        <CheckCircle className=\"w-4 h-4 text-green-500 flex-shrink-0\" />\n                      ) : (\n                        <span className=\"w-2 h-2 bg-amber-500 rounded-full flex-shrink-0\" />\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n\n              {/* Announcements Section */}\n              {unreadAnnouncementsCount > 0 && (\n                <div className=\"border-b border-gray-200\">\n                  <div className=\"px-3 py-2 bg-blue-50 border-b border-blue-100\">\n                    <p className=\"text-xs font-medium text-blue-700 flex items-center gap-1\">\n                      <Megaphone className=\"w-3 h-3\" />\n                       ({unreadAnnouncementsCount})\n                    </p>\n                  </div>\n                  {userAnnouncements.filter(a => !a.viewedBy?.includes(user?.id || '')).slice(0, 3).map((announcement) => (\n                    <div\n                      key={announcement.id}\n                      onClick={() => { setShowNotifications(false); navigate('/announcements'); }}\n                      className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 bg-blue-50/50 flex items-center gap-2\"\n                    >\n                      <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                        <Megaphone className=\"w-4 h-4 text-blue-600\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate\">{announcement.title}</p>\n                        <p className=\"text-xs text-gray-500 line-clamp-1\">{announcement.content}</p>\n                      </div>\n                      <span className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0\" />\n                    </div>\n                  ))}\n                </div>\n              )}\n\n              {/* Meetings Section */}\n              {upcomingMeetings.length > 0 && (\n                <div className=\"border-b border-gray-200\">\n                  <div className=\"px-3 py-2 bg-purple-50 border-b border-purple-100\">\n                    <p className=\"text-xs font-medium text-purple-700 flex items-center gap-1\">\n                      <Users className=\"w-3 h-3\" />\n                       ({upcomingMeetings.length})\n                    </p>\n                  </div>\n                  {upcomingMeetings.slice(0, 2).map((meeting) => (\n                    <div\n                      key={meeting.id}\n                      onClick={() => { setShowNotifications(false); navigate('/meetings'); }}\n                      className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 bg-purple-50/50 flex items-center gap-2\"\n                    >\n                      <div className=\"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                        <Users className=\"w-4 h-4 text-purple-600\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate\"> </p>\n                        <p className=\"text-xs text-gray-500\">\n                          {meeting.confirmedDateTime\n                            ? new Date(meeting.confirmedDateTime).toLocaleDateString('ru-RU', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' })\n                            : ' '}\n                        </p>\n                      </div>\n                      <span className=\"w-2 h-2 bg-purple-500 rounded-full flex-shrink-0\" />\n                    </div>\n                  ))}\n                </div>\n              )}\n\n              {/* Regular Notifications */}\n              {userNotifications.length === 0 && unreadAnnouncementsCount === 0 && upcomingMeetings.length === 0 && pendingTasksCount === 0 ? (\n                <div className=\"p-6 text-center text-gray-500\">\n                  <Bell className=\"w-10 h-10 mx-auto mb-2 text-gray-300\" />\n                  <p> </p>\n                </div>\n              ) : userNotifications.length > 0 && (\n                <>\n                  <div className=\"px-3 py-2 bg-gray-50 border-b border-gray-100\">\n                    <p className=\"text-xs font-medium text-gray-500\"></p>\n                  </div>\n                  {userNotifications.map((notification) => (\n                    <div\n                      key={notification.id}\n                      onClick={() => {\n                        if (!notification.read) {\n                          markNotificationAsRead(notification.id);\n                        }\n                      }}\n                      className={`p-3 border-b border-gray-100 ${!notification.read ? 'bg-blue-50' : 'bg-white'}`}\n                    >\n                      <div className=\"flex gap-2\">\n                        <span className=\"text-lg\">{getNotificationIcon(notification.type)}</span>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <h4 className=\"font-medium text-sm truncate\">{notification.title}</h4>\n                            <span className=\"text-xs text-gray-400 flex-shrink-0\">{formatTime(notification.createdAt)}</span>\n                          </div>\n                          <p className=\"text-xs text-gray-500 mt-0.5 line-clamp-2\">{notification.message}</p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </>\n              )}\n            </div>\n            <div className=\"p-2 border-t border-gray-200 bg-gray-50\">\n              <button\n                onClick={() => setShowNotifications(false)}\n                className=\"w-full text-center text-sm text-gray-600 py-1\"\n              >\n                \n              </button>\n            </div>\n          </div>\n        </div>,\n        document.body\n      )}\n    </>\n  );\n}\n","export type UserRole = 'admin' | 'director' | 'manager' | 'department_head' | 'executor' | 'resident' | 'commercial_owner' | 'tenant';\nexport type ExecutorSpecialization = 'plumber' | 'electrician' | 'elevator' | 'intercom' | 'cleaning' | 'security' | 'carpenter' | 'boiler' | 'ac' | 'other';\nexport type RequestStatus = 'new' | 'assigned' | 'accepted' | 'in_progress' | 'pending_approval' | 'completed' | 'cancelled';\nexport type CancelledBy = 'resident' | 'executor' | 'manager' | 'admin';\nexport type RequestPriority = 'low' | 'medium' | 'high' | 'urgent';\n\nexport type ContractType = 'standard' | 'commercial' | 'temporary';\n\nexport interface User {\n  id: string;\n  phone: string;\n  name: string;\n  login: string;\n  email?: string;\n  role: UserRole;\n  specialization?: ExecutorSpecialization;\n  avatar?: string;\n  address?: string;\n  apartment?: string;\n  branch?: string; //  (YS, CH, etc.)\n  building?: string; //   (8A, 15, etc.)\n  buildingId?: string;\n  entrance?: string; // \n  floor?: string; // \n  totalArea?: number; //    .\n\n  // Contract fields (for residents)\n  qrCode?: string; //  QR-   \n  signatureKey?: string; //     ( )\n  contractSignedAt?: string; //   \n  agreedToTermsAt?: string; //   \n  contractNumber?: string; //   (-2024-00001)\n  contractStartDate?: string; //   \n  contractEndDate?: string; //   (null = )\n  contractType?: ContractType; //  \n\n  // Onboarding tracking (from DB, works across devices)\n  passwordChangedAt?: string; //   \n\n  // Timestamps\n  createdAt?: string;\n\n  // Special account types (for advertising platform)\n  account_type?: 'advertiser' | 'coupon_checker';\n}\n\nexport interface Executor {\n  id: string;\n  name: string;\n  phone: string;\n  login: string;\n  password?: string;\n  specialization: ExecutorSpecialization;\n  status: 'available' | 'busy' | 'offline';\n  rating: number;\n  completedCount: number;\n  activeRequests: number;\n  totalEarnings: number;\n  avgCompletionTime: number;\n  createdAt: string;\n}\n\nexport interface Request {\n  id: string;\n  number: number | string;  // Can be numeric (1001) or with prefix (YS-1001)\n  title: string;\n  description: string;\n  category: ExecutorSpecialization;\n  status: RequestStatus;\n  priority: RequestPriority;\n  residentId: string;\n  residentName: string;\n  residentPhone: string;\n  address: string;\n  apartment: string;\n  executorId?: string;\n  executorName?: string;\n  executorPhone?: string;\n  executorRating?: number;\n  createdAt: string;\n  scheduledDate?: string; //   \n  scheduledTime?: string; //    ( \"09:00-12:00\")\n  accessInfo?: string; //     \n  assignedAt?: string;\n  acceptedAt?: string;\n  startedAt?: string;\n  completedAt?: string;\n  approvedAt?: string;\n  rating?: number;\n  feedback?: string;\n  workDuration?: number; // in seconds\n  pausedAt?: string; // when work was paused\n  totalPausedTime?: number; // total paused time in seconds\n  isPaused?: boolean; // current pause state\n  cancelledAt?: string;\n  cancelledBy?: CancelledBy;\n  cancellationReason?: string;\n  rejectedAt?: string;\n  rejectionReason?: string;\n  rejectionCount?: number; //     \n  buildingId?: string; // ID  \n  buildingName?: string; //  \n}\n\nexport interface Notification {\n  id: string;\n  userId: string;\n  type: 'request_created' | 'request_assigned' | 'request_accepted' | 'request_started' | 'request_completed' | 'request_approved' | 'request_rejected' | 'request_cancelled' | 'request_declined';\n  title: string;\n  message: string;\n  requestId?: string;\n  read: boolean;\n  createdAt: string;\n}\n\nexport interface ActivityLog {\n  id: string;\n  userId: string;\n  userName: string;\n  userRole: UserRole;\n  action: string;\n  details: string;\n  requestId?: string;\n  timestamp: string;\n}\n\nexport interface DashboardStats {\n  totalRequests: number;\n  newRequests: number;\n  inProgress: number;\n  completedToday: number;\n  completedWeek: number;\n  avgCompletionTime: number;\n  executorsOnline: number;\n  executorsTotal: number;\n}\n\nexport interface ChartData {\n  date: string;\n  name: string;\n  created: number;\n  completed: number;\n}\n\nexport interface Building {\n  id: string;\n  name: string;\n  address: string;\n  floors: number;\n  apartments: number;\n  entrances: number;\n  yearBuilt?: number;\n  managerId?: string;\n  createdAt: string;\n  residentsCount: number;\n  activeRequestsCount: number;\n}\n\n// Rental apartment for commercial owners (tenants)\nexport interface RentalApartment {\n  id: string;\n  name: string; // e.g., \" 42\" or custom name\n  address: string;\n  apartment: string;\n  ownerId: string; // tenant user id\n  ownerName: string;\n  ownerPhone: string;\n  ownerLogin: string;\n  ownerPassword?: string; // stored for delete confirmation\n  ownerType: 'tenant' | 'commercial_owner'; // tenant =  , commercial_owner =  \n  createdAt: string;\n  isActive: boolean;\n}\n\n// Rental record (guest check-in/check-out)\nexport interface RentalRecord {\n  id: string;\n  apartmentId: string;\n  guestNames: string; // comma separated or single name\n  passportInfo: string;\n  checkInDate: string;\n  checkOutDate: string;\n  amount: number; // rental amount\n  currency: string; // UZS, USD, etc.\n  notes?: string;\n  createdAt: string;\n  createdBy: string; // manager id\n}\n\n// Announcement types\nexport type AnnouncementType = 'residents' | 'employees' | 'all';\nexport type AnnouncementPriority = 'normal' | 'important' | 'urgent';\nexport type AnnouncementTargetType = 'all' | 'branch' | 'building' | 'entrance' | 'floor' | 'custom';\n\n// Announcement targeting\nexport interface AnnouncementTarget {\n  type: AnnouncementTargetType;\n  branchId?: string; // for branch targeting\n  buildingId?: string; // for building targeting\n  entrance?: string; // for entrance/ targeting\n  floor?: string; // for floor targeting\n  customLogins?: string[]; // for custom targeting (from Excel import)\n}\n\n// File attachment for announcements\nexport interface FileAttachment {\n  name: string;\n  url: string; // data URL or external URL\n  type: string; // MIME type\n  size: number; // in bytes\n}\n\n// Announcement for residents or staff\nexport interface Announcement {\n  id: string;\n  title: string;\n  content: string;\n  type: AnnouncementType; // 'residents' = for residents, 'employees' = for UK workers, 'all' = everyone\n  priority: AnnouncementPriority;\n  authorId: string;\n  authorName: string;\n  authorRole: UserRole;\n  createdAt: string;\n  expiresAt?: string; // optional expiration date\n  isActive: boolean;\n  viewedBy: string[]; // array of user IDs who viewed (for current user check)\n  viewCount?: number; // total view count from API (for admin/manager display)\n  attachments?: FileAttachment[]; // file attachments\n  // Targeting fields\n  target?: AnnouncementTarget;\n}\n\n// Chat types\nexport type ChatChannelType = 'uk_general' | 'building_general' | 'entrance' | 'floor' | 'admin_support' | 'private_support';\n\nexport interface ChatChannel {\n  id: string;\n  type: ChatChannelType;\n  name: string;\n  description?: string;\n  buildingId?: string;\n  entrance?: string;\n  floor?: string;\n  participants: string[]; // user IDs\n  createdAt: string;\n  lastMessageAt?: string;\n  unreadCount?: number;\n  // For private_support channels\n  residentId?: string; // The resident who owns this support channel\n  residentName?: string;\n  residentApartment?: string;\n  lastMessage?: string; // Preview of last message for listing\n}\n\nexport interface ChatMessage {\n  id: string;\n  channelId: string;\n  senderId: string;\n  senderName: string;\n  senderRole: UserRole;\n  senderApartment?: string;\n  content: string;\n  createdAt: string;\n  readBy: string[]; // user IDs who read the message\n  replyToId?: string; // for reply functionality\n  attachments?: ChatAttachment[];\n}\n\nexport interface ChatAttachment {\n  id: string;\n  type: 'image' | 'file';\n  name: string;\n  url: string;\n  size?: number;\n}\n\nexport const CHAT_CHANNEL_LABELS: Record<ChatChannelType, { label: string; labelUz: string; icon: string; description: string; descriptionUz: string }> = {\n  uk_general: {\n    label: '  ',\n    labelUz: 'UK umumiy chat',\n    icon: '',\n    description: '     ',\n    descriptionUz: 'Boshqaruv kompaniyasi barcha turar joy egalari uchun umumiy chat'\n  },\n  building_general: {\n    label: ' ',\n    labelUz: 'TJM chat',\n    icon: '',\n    description: '    ',\n    descriptionUz: 'Sizning turar joy majmuangiz aholisi uchun chat'\n  },\n  entrance: {\n    label: ' ',\n    labelUz: 'Kirish chati',\n    icon: '',\n    description: '   ',\n    descriptionUz: 'Sizning kirishingiz aholisi uchun chat'\n  },\n  floor: {\n    label: ' ',\n    labelUz: 'Qavat chati',\n    icon: '',\n    description: '   ',\n    descriptionUz: 'Sizning qavatingiz aholisi uchun chat'\n  },\n  admin_support: {\n    label: '  ',\n    labelUz: 'Administratsiya bilan chat',\n    icon: '',\n    description: '    ',\n    descriptionUz: 'UK administratsiyasi bilan to\\'g\\'ridan-to\\'g\\'ri chat'\n  },\n  private_support: {\n    label: '   ',\n    labelUz: 'UK bilan shaxsiy chat',\n    icon: '',\n    description: '    ',\n    descriptionUz: 'Administratsiya bilan shaxsiy chatizngiz'\n  }\n};\n\n// Service categories for residents\nexport interface ServiceCategory {\n  id: ExecutorSpecialization;\n  name: string;\n  icon: string;\n  description: string;\n}\n\nexport const SERVICE_CATEGORIES: ServiceCategory[] = [\n  // Popular services (first 4 shown in grid)\n  { id: 'plumber', name: '', icon: '', description: ' , , ' },\n  { id: 'electrician', name: '', icon: '', description: ', , ' },\n  { id: 'security', name: '', icon: '', description: '   ' },\n  { id: 'cleaning', name: '', icon: '', description: '   ' },\n  // Other services\n  { id: 'elevator', name: '', icon: '', description: '   ' },\n  { id: 'intercom', name: '', icon: '', description: '   ' },\n  { id: 'carpenter', name: ' ', icon: '', description: ' , , ' },\n  { id: 'boiler', name: '', icon: '', description: '   ' },\n  { id: 'ac', name: '', icon: '', description: '   ' },\n  { id: 'other', name: '', icon: '', description: ' ' },\n];\n\n// Labels\nexport const SPECIALIZATION_LABELS: Record<ExecutorSpecialization, string> = {\n  plumber: '',\n  electrician: '',\n  elevator: '',\n  intercom: '',\n  cleaning: '',\n  security: '',\n  carpenter: '',\n  boiler: '',\n  ac: '',\n  other: ''\n};\n\nexport const STATUS_LABELS: Record<RequestStatus, string> = {\n  new: '',\n  assigned: '',\n  accepted: '',\n  in_progress: ' ',\n  pending_approval: ' ',\n  completed: '',\n  cancelled: ''\n};\n\nexport const PRIORITY_LABELS: Record<RequestPriority, string> = {\n  low: '',\n  medium: '',\n  high: '',\n  urgent: ''\n};\n\n// ============================================\n// MEETINGS MODULE -  \n// ============================================\n\n// Meeting status - state machine\nexport type MeetingStatus =\n  | 'draft'                    // \n  | 'pending_moderation'       //   \n  | 'schedule_poll_open'       //  /\n  | 'schedule_confirmed'       // / \n  | 'voting_open'              //  \n  | 'voting_closed'            //  \n  | 'results_published'        //  \n  | 'protocol_generated'       //  \n  | 'protocol_approved'        //  /\n  | 'cancelled';               // \n\n// Meeting format\nexport type MeetingFormat = 'online' | 'offline' | 'hybrid';\n\n// Meeting organizer type\nexport type MeetingOrganizerType = 'resident' | 'management';\n\n// Vote choice for agenda items\nexport type VoteChoice = 'for' | 'against' | 'abstain' | 'not_voted';\n\n// Voting unit type - what counts as one vote\nexport type VotingUnitType = 'apartment' | 'owner' | 'share';\n\n// Decision threshold type\nexport type DecisionThreshold = 'simple_majority' | 'qualified_majority' | 'two_thirds' | 'three_quarters' | 'unanimous';\n\n// Agenda item type (predefined categories)\nexport type AgendaItemType =\n  | 'budget_approval'          //  \n  | 'tariff_change'            //  \n  | 'major_repair'             //  \n  | 'common_property'          //   \n  | 'management_contract'      //  \n  | 'chairman_election'        //  \n  | 'audit_commission'         //  \n  | 'rules_amendment'          //  \n  | 'landscaping'              // \n  | 'security'                 //   \n  | 'parking'                  // \n  | 'other';                   // \n\n// Schedule option for date/time voting\nexport interface ScheduleOption {\n  id: string;\n  dateTime: string;            // ISO datetime\n  votes: string[];             // Array of voter IDs\n  votesByShare?: number;       // Sum of shares if voting by shares\n}\n\n// Agenda item\nexport interface AgendaItem {\n  id: string;\n  type: AgendaItemType;\n  title: string;\n  description: string;\n  threshold: DecisionThreshold;\n  materials: MeetingMaterial[];\n  votesFor: number;           // Votes by area (sq.m) as per Uzbekistan law\n  votesAgainst: number;\n  votesAbstain: number;\n  votesForByShare?: number;   // Alias for compatibility\n  votesAgainstByShare?: number;\n  votesAbstainByShare?: number;\n  isApproved?: boolean;\n  decision?: string;\n  order: number;               // Order in agenda\n}\n\n// Meeting material (attachment)\nexport interface MeetingMaterial {\n  id: string;\n  name: string;\n  type: 'document' | 'image' | 'link';\n  url: string;\n  size?: number;\n  uploadedAt: string;\n  uploadedBy: string;\n}\n\n// Agenda item comment (/    )\nexport interface AgendaComment {\n  id: string;\n  agendaItemId: string;\n  meetingId: string;\n  residentId: string;\n  residentName: string;\n  apartmentNumber?: string;\n  content: string;\n  includeInProtocol: boolean;\n  createdAt: string;\n  updatedAt?: string;\n}\n\n// Vote record with audit trail\nexport interface VoteRecord {\n  id: string;\n  meetingId: string;\n  agendaItemId?: string;       // null for schedule votes\n  scheduleOptionId?: string;   // for schedule votes\n  voterId: string;\n  voterName: string;\n  apartmentId?: string;\n  apartmentNumber?: string;\n  ownershipShare?: number;     //   (0-100)\n  choice: VoteChoice | 'schedule';\n\n  // Audit & verification\n  verificationMethod: 'otp_sms' | 'otp_push' | 'password' | 'e_signature' | 'otp' | 'login' | 'in_person' | 'proxy';\n  otpVerified: boolean;\n  ipAddress?: string;\n  userAgent?: string;\n  sessionId?: string;\n  votedAt: string;\n  voteHash: string;            // SHA-256 hash for immutability proof\n\n  // Re-vote tracking\n  isRevote?: boolean;\n  previousVoteId?: string;\n}\n\n// OTP verification record\nexport interface OTPRecord {\n  id: string;\n  userId: string;\n  phone: string;\n  code: string;\n  purpose: 'meeting_vote' | 'schedule_vote' | 'phone_verification';\n  meetingId?: string;\n  agendaItemId?: string;\n  attempts: number;\n  maxAttempts: number;\n  createdAt: string;\n  expiresAt: string;\n  verifiedAt?: string;\n  isUsed: boolean;\n}\n\n// Notification log for meetings\nexport interface MeetingNotificationLog {\n  id: string;\n  meetingId: string;\n  recipientId: string;\n  recipientPhone?: string;\n  recipientEmail?: string;\n  channel: 'sms' | 'push' | 'email' | 'in_app';\n  type: 'meeting_created' | 'schedule_poll' | 'schedule_confirmed' | 'voting_open' | 'voting_reminder' | 'results_published' | 'protocol_ready';\n  status: 'pending' | 'sent' | 'delivered' | 'failed';\n  sentAt?: string;\n  deliveredAt?: string;\n  errorMessage?: string;\n}\n\n// Meeting protocol\nexport interface MeetingProtocol {\n  id: string;\n  meetingId: string;\n  number: string;              // Protocol number\n  generatedAt: string;\n  content: string;             // HTML or markdown content\n\n  // Signatures\n  signedByUK?: {\n    userId: string;\n    name: string;\n    role: string;\n    signedAt: string;\n    signatureHash: string;\n  };\n  signedByChairman?: {\n    userId: string;\n    name: string;\n    signedAt: string;\n    signatureHash: string;\n  };\n  signedBySecretary?: {\n    userId: string;\n    name: string;\n    signedAt: string;\n    signatureHash: string;\n  };\n\n  // Integrity\n  protocolHash: string;        // Hash of entire protocol for verification\n  attachments: string[];       // IDs of related materials\n}\n\n// Main Meeting entity\nexport interface Meeting {\n  id: string;\n  number: number;              // Sequential meeting number\n  buildingId: string;\n  buildingAddress: string;\n\n  // Organization\n  organizerType: MeetingOrganizerType;\n  organizerId: string;\n  organizerName: string;\n  format: MeetingFormat;\n  status: MeetingStatus;\n\n  // Schedule\n  scheduleOptions: ScheduleOption[];\n  schedulePollEndsAt?: string;\n  confirmedDateTime?: string;\n  location?: string;           // For offline/hybrid meetings\n\n  // Agenda\n  agendaItems: AgendaItem[];\n  materials: MeetingMaterial[];\n\n  // Voting settings (per building/meeting)\n  votingSettings: {\n    votingUnit: VotingUnitType;\n    quorumPercent: number;     // % required for valid meeting\n    allowRevote: boolean;      // Can change vote before closing\n    requireOTP: boolean;       // Require OTP for each vote\n    showIntermediateResults: boolean;\n  };\n\n  // Participation\n  eligibleVoters: string[];    // User IDs who can vote\n  totalEligibleCount: number;\n  totalEligibleShares?: number;\n  participatedVoters: string[];\n\n  // Results\n  quorumReached: boolean;\n  participationPercent: number;\n  participationByShares?: number;\n\n  // Protocol\n  protocolId?: string;\n\n  // Timestamps\n  createdAt: string;\n  moderatedAt?: string;\n  moderationComment?: string;      //  \n  schedulePollOpenedAt?: string;\n  scheduleConfirmedAt?: string;\n  votingOpenedAt?: string;\n  votingClosedAt?: string;\n  resultsPublishedAt?: string;\n  protocolGeneratedAt?: string;\n  protocolApprovedAt?: string;\n  cancelledAt?: string;\n  cancellationReason?: string;\n\n  // Reminders sent\n  remindersSent: {\n    type: string;\n    sentAt: string;\n  }[];\n\n  // Audit\n  notificationLogs: MeetingNotificationLog[];\n}\n\n// Building meeting settings (configurable per building)\nexport interface BuildingMeetingSettings {\n  buildingId: string;\n  votingUnit: VotingUnitType;\n  defaultQuorumPercent: number;\n  schedulePollDurationDays: number;\n  votingDurationHours: number;\n  allowResidentInitiative: boolean;\n  requireModeration: boolean;\n  defaultMeetingTime: string;  // e.g., \"19:00\"\n  reminderHoursBefore: number[];\n  notificationChannels: ('sms' | 'push' | 'email' | 'in_app')[];\n}\n\n// Apartment/Unit for voting\nexport interface VotingUnit {\n  id: string;\n  buildingId: string;\n  apartmentId?: string;        // ID \n  apartmentNumber: string;\n  totalArea?: number;          //  \n  floor?: number;\n  entrance?: number;\n  ownershipShare: number;      // % of total building (for share-based voting)\n  ownerId: string;             // Primary owner user ID\n  ownerName?: string;          //  \n  coOwnerIds: string[];        // Co-owners user IDs\n  residentIds?: string[];      // All residents (including renters)\n  isVerified: boolean;         // KYC verified\n  verifiedAt?: string;\n  verifiedBy?: string;\n}\n\n// Predefined agenda item templates\nexport const AGENDA_ITEM_TYPES: Record<AgendaItemType, {\n  label: string;\n  labelUz: string;\n  defaultThreshold: DecisionThreshold;\n  requiresMaterials: boolean;\n  description: string;\n  descriptionUz: string;\n}> = {\n  budget_approval: {\n    label: ' ',\n    labelUz: 'Byudjetni tasdiqlash',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: true,\n    description: '     ',\n    descriptionUz: 'Yillik uy byudjetini ko\\'rib chiqish va tasdiqlash'\n  },\n  tariff_change: {\n    label: ' ',\n    labelUz: 'Tariflarni o\\'zgartirish',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: true,\n    description: '   ',\n    descriptionUz: 'Oylik to\\'lovlar miqdorini o\\'zgartirish'\n  },\n  major_repair: {\n    label: ' ',\n    labelUz: 'Asosiy ta\\'mirlash',\n    defaultThreshold: 'two_thirds',\n    requiresMaterials: true,\n    description: '    ',\n    descriptionUz: 'Asosiy ta\\'mirlash to\\'g\\'risida qaror'\n  },\n  common_property: {\n    label: ' ',\n    labelUz: 'Umumiy mulk',\n    defaultThreshold: 'two_thirds',\n    requiresMaterials: false,\n    description: '   ',\n    descriptionUz: 'Umumiy uy mulkidan foydalanish'\n  },\n  management_contract: {\n    label: ' ',\n    labelUz: 'Boshqaruv shartnomasi',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: true,\n    description: '     ',\n    descriptionUz: 'Boshqaruv kompaniyasi bilan shartnoma tuzish yoki o\\'zgartirish'\n  },\n  chairman_election: {\n    label: ' ',\n    labelUz: 'Rais saylov',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: false,\n    description: '   ',\n    descriptionUz: 'Uy kengashi raisi saylovi'\n  },\n  audit_commission: {\n    label: ' ',\n    labelUz: 'Taftish komissiyasi',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: false,\n    description: '  ',\n    descriptionUz: 'Taftish komissiyasini shakllantirish'\n  },\n  rules_amendment: {\n    label: ' ',\n    labelUz: 'Qoidalarni o\\'zgartirish',\n    defaultThreshold: 'two_thirds',\n    requiresMaterials: true,\n    description: '    ',\n    descriptionUz: 'Uyda yashash qoidalarini o\\'zgartirish'\n  },\n  landscaping: {\n    label: '',\n    labelUz: 'Obodonlashtirish',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: true,\n    description: '   ',\n    descriptionUz: 'Hududni obodonlashtirish ishlari'\n  },\n  security: {\n    label: '  ',\n    labelUz: 'Xavfsizlik',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: false,\n    description: '    ',\n    descriptionUz: 'Uy xavfsizligi masalalari'\n  },\n  parking: {\n    label: '',\n    labelUz: 'Avtoturargoh',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: false,\n    description: '   ',\n    descriptionUz: 'Hududda avtoturargoh tashkil etish'\n  },\n  other: {\n    label: '',\n    labelUz: 'Boshqa',\n    defaultThreshold: 'simple_majority',\n    requiresMaterials: false,\n    description: ' ',\n    descriptionUz: 'Boshqa masalalar'\n  }\n};\n\n// Decision threshold labels\nexport const DECISION_THRESHOLD_LABELS: Record<DecisionThreshold, { label: string; labelUz: string; percent: number }> = {\n  simple_majority: { label: '  (50%+1)', labelUz: 'Oddiy ko\\'pchilik (50%+1)', percent: 50 },\n  qualified_majority: { label: '  (60%)', labelUz: 'Malakali ko\\'pchilik (60%)', percent: 60 },\n  two_thirds: { label: '  (66.7%)', labelUz: 'Uchdan ikki (66.7%)', percent: 66.67 },\n  three_quarters: { label: '  (75%)', labelUz: 'To\\'rtdan uch (75%)', percent: 75 },\n  unanimous: { label: ' (100%)', labelUz: 'Bir ovozdan (100%)', percent: 100 }\n};\n\n// Meeting status labels\nexport const MEETING_STATUS_LABELS: Record<MeetingStatus, { label: string; labelUz: string; color: string }> = {\n  draft: { label: '', labelUz: 'Qoralama', color: 'gray' },\n  pending_moderation: { label: ' ', labelUz: 'Moderatsiyada', color: 'yellow' },\n  schedule_poll_open: { label: ' ', labelUz: 'Sana tanlash', color: 'blue' },\n  schedule_confirmed: { label: ' ', labelUz: 'Sana tasdiqlangan', color: 'indigo' },\n  voting_open: { label: '', labelUz: 'Ovoz berish', color: 'green' },\n  voting_closed: { label: ' ', labelUz: 'Ovoz berish yopildi', color: 'orange' },\n  results_published: { label: ' ', labelUz: 'Natijalar e\\'lon qilindi', color: 'purple' },\n  protocol_generated: { label: ' ', labelUz: 'Bayonnoma tayyor', color: 'teal' },\n  protocol_approved: { label: ' ', labelUz: 'Bayonnoma tasdiqlangan', color: 'emerald' },\n  cancelled: { label: '', labelUz: 'Bekor qilindi', color: 'red' }\n};\n\n// ============================================\n// CRM MODULE -    \n// ============================================\n\n//     \nexport interface BuildingFull {\n  id: string;\n  name: string;\n  address: string;\n  zone?: string;                   //  / (,   ..)\n  cadastralNumber?: string;        //  \n  branchCode?: string;             //   (YS, CH, etc.)\n  buildingNumber?: string;         //   (8A, 15, etc.)\n\n  //  \n  floors: number;\n  entrances: number;\n  totalApartments: number;\n  totalArea: number;               //   \n  livingArea: number;              //   \n  commonArea: number;              //   \n  landArea?: number;               //   \n  yearBuilt: number;\n  yearRenovated?: number;\n  buildingType: 'panel' | 'brick' | 'monolith' | 'block' | 'wooden' | 'mixed';\n  roofType: 'flat' | 'pitched' | 'combined';\n  wallMaterial: string;\n  foundationType: string;\n\n  //  \n  hasElevator: boolean;\n  elevatorCount: number;\n  hasGas: boolean;\n  heatingType: 'central' | 'individual' | 'autonomous';\n  hasHotWater: boolean;\n  waterSupplyType: 'central' | 'autonomous';\n  sewerageType: 'central' | 'autonomous';\n  hasIntercom: boolean;\n  hasVideoSurveillance: boolean;\n  hasConcierge: boolean;\n  hasParkingLot: boolean;\n  parkingSpaces: number;\n  hasPlayground: boolean;\n\n  // \n  managerId?: string;\n  managerName?: string;\n  managementStartDate?: string;\n  contractNumber?: string;\n  contractEndDate?: string;\n\n  //  \n  monthlyBudget: number;\n  reserveFund: number;\n  totalDebt: number;\n  collectionRate: number;          // % \n\n  // \n  residentsCount: number;\n  ownersCount: number;\n  tenantsCount: number;\n  vacantApartments: number;\n  activeRequestsCount: number;\n\n  // \n  documents: BuildingDocument[];\n\n  createdAt: string;\n  updatedAt: string;\n}\n\n//  \nexport interface BuildingDocument {\n  id: string;\n  buildingId: string;\n  name: string;\n  type: 'contract' | 'act' | 'protocol' | 'passport' | 'license' | 'certificate' | 'other';\n  fileUrl: string;\n  fileSize: number;\n  uploadedAt: string;\n  uploadedBy: string;\n  expiresAt?: string;\n  isActive: boolean;\n}\n\n// \nexport interface Entrance {\n  id: string;\n  buildingId: string;\n  number: number;\n  floorsFrom: number;\n  floorsTo: number;\n  apartmentsFrom: number;\n  apartmentsTo: number;\n  hasElevator: boolean;\n  elevatorId?: string;\n  intercomType?: 'audio' | 'video' | 'smart' | 'none';\n  intercomCode?: string;\n  cleaningSchedule?: string;\n  responsibleId?: string;          //  \n  lastInspection?: string;\n  notes?: string;\n}\n\n//  ()\nexport interface Apartment {\n  id: string;\n  buildingId: string;\n  entranceId: string;\n  number: string;                  //  \n  floor: number;\n\n  // \n  rooms: number;\n  totalArea: number;               //   \n  livingArea: number;              //   \n  kitchenArea?: number;\n  balconyArea?: number;\n  loggiaArea?: number;             //  \n  ceilingHeight?: number;          //  \n  hasBalcony: boolean;\n  hasLoggia: boolean;\n  hasStorage?: boolean;            // \n  hasParking?: boolean;            // \n  parkingNumber?: string;          //  \n\n  //  \n  ownershipType: 'private' | 'municipal' | 'state' | 'cooperative';\n  ownershipShare?: number;          //     %\n  registrationNumber?: string;     //  \n  registrationDate?: string;       //  \n  cadastralValue?: number;\n\n  //  \n  status: 'occupied' | 'vacant' | 'rented' | 'commercial' | 'under_repair';\n  isCommercial: boolean;           //  \n  commercialType?: string;         //   \n\n  // \n  meters: Meter[];\n\n  // \n  personalAccountId?: string;\n  primaryOwnerId?: string;\n\n  notes?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\n//  ()\nexport interface Meter {\n  id: string;\n  apartmentId?: string;\n  buildingId?: string;             //  \n  type: 'cold_water' | 'hot_water' | 'electricity' | 'gas' | 'heat';\n  serialNumber: string;\n  model?: string;\n  brand?: string;                  // /\n  manufacturer?: string;\n  installDate: string;\n  verificationDate: string;\n  nextVerificationDate: string;\n  sealNumber?: string;\n  location: string;\n  initialValue: number;\n  currentValue: number;\n  lastReadingDate?: string;\n  isActive: boolean;\n  isCommon: boolean;               // \n  tariffZone?: string;             //  \n  notes?: string;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\n//  \nexport interface MeterReading {\n  id: string;\n  meterId: string;\n  apartmentId?: string;\n  value: number;\n  previousValue: number;\n  consumption: number;\n  readingDate: string;\n  source: 'manual' | 'online' | 'auto' | 'calculated';\n  submittedBy?: string;\n  submittedAt: string;\n  isVerified: boolean;\n  verifiedBy?: string;\n  verifiedAt?: string;\n  photoUrl?: string;\n  status?: 'pending' | 'approved' | 'rejected';\n  rejectionReason?: string;\n  notes?: string;\n  createdAt?: string;\n}\n\n// /\nexport interface Owner {\n  id: string;\n\n  //  \n  type: 'individual' | 'legal_entity';\n  lastName: string;\n  firstName: string;\n  middleName?: string;\n  fullName: string;                //    .\n\n  //  ( )\n  passportSeries?: string;\n  passportNumber?: string;\n  passportIssuedBy?: string;\n  passportIssuedDate?: string;\n  inn?: string;\n  snils?: string;\n  birthDate?: string;\n  birthPlace?: string;             //  \n\n  //  .\n  companyName?: string;\n  ogrn?: string;\n  kpp?: string;\n  legalAddress?: string;\n  directorName?: string;\n\n  // \n  phone: string;\n  additionalPhone?: string;        //  \n  phoneAdditional?: string;\n  email?: string;\n  preferredContact: 'phone' | 'sms' | 'email' | 'whatsapp' | 'telegram';\n\n  //  \n  registrationAddress?: string;\n  actualAddress?: string;          //  \n\n  //  \n  ownershipType: 'owner' | 'co_owner' | 'tenant' | 'representative';\n  ownershipShare?: number;         //  %\n  ownershipDocument?: string;      // /\n  ownershipDocumentDate?: string;  //  \n  ownershipDate?: string;          //   \n\n  //  \n  bankName?: string;\n  bankBik?: string;\n  bankAccount?: string;\n\n  // \n  apartmentIds: string[];          //    \n  personalAccountIds: string[];\n\n  // \n  isActive: boolean;\n  isVerified: boolean;\n  verifiedAt?: string;\n  verifiedBy?: string;\n\n  // \n  notes?: string;\n  tags: string[];\n\n  createdAt: string;\n  updatedAt: string;\n}\n\n//  (   )\nexport interface Resident {\n  id: string;\n  apartmentId: string;\n  ownerId?: string;                //   ,  \n\n  // \n  lastName: string;\n  firstName: string;\n  middleName?: string;\n  fullName: string;\n  birthDate?: string;\n\n  //  \n  residentType: 'owner' | 'family_member' | 'tenant' | 'registered' | 'temporary';\n  relationToOwner?: string;        //   \n\n  // \n  registrationType: 'permanent' | 'temporary' | 'none';\n  registrationDate?: string;\n  registrationEndDate?: string;\n\n  // \n  phone?: string;\n  additionalPhone?: string;        //  \n  email?: string;\n\n  //  \n  passportSeries?: string;\n  passportNumber?: string;\n\n  // \n  isActive: boolean;\n  movedInDate?: string;\n  movedOutDate?: string;\n  movedOutReason?: string;\n\n  notes?: string;\n  createdAt: string;\n  updatedAt?: string;\n}\n\n//  \nexport interface PersonalAccount {\n  id: string;\n  number: string;                  //  \n\n  // \n  apartmentId: string;\n  buildingId: string;\n  primaryOwnerId: string;\n\n  // \n  ownerName: string;\n  apartmentNumber: string;\n  address: string;\n\n  //   \n  totalArea: number;\n  heatedArea?: number;\n  residentsCount: number;\n  registeredCount: number;\n\n  // \n  balance: number;                 //   (+ , - )\n  currentDebt: number;\n  penaltyAmount: number;\n  lastPaymentDate?: string;\n  lastPaymentAmount?: number;\n  lastChargeDate?: string;         //   \n  lastChargeAmount?: number;       //   \n\n  // \n  hasSubsidy: boolean;\n  subsidyAmount?: number;\n  subsidyPercent?: number;         //  \n  subsidyEndDate?: string;\n  hasDiscount: boolean;\n  discountPercent?: number;\n  discountReason?: string;\n\n  // \n  status: 'active' | 'closed' | 'blocked' | 'archived';\n  blockReason?: string;\n  closedAt?: string;               //  \n  closedReason?: string;           //  \n\n  //  \n  tariffPlanId?: string;\n\n  notes?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\n// ============================================\n//   \n// ============================================\n\n//  \nexport interface Service {\n  id: string;\n  code: string;                    //  \n  name: string;\n  shortName: string;\n  category: 'housing' | 'utility' | 'additional' | 'repair' | 'other';\n  unit: 'sqm' | 'person' | 'apartment' | 'kwh' | 'cbm' | 'gcal' | 'fixed';\n\n  // \n  isMetered: boolean;              //  \n  isActive: boolean;\n  sortOrder: number;\n}\n\n// \nexport interface Tariff {\n  id: string;\n  serviceId: string;\n  serviceName: string;\n  buildingId?: string;             // null =   \n\n  // \n  rate: number;                    //  \n  ratePer: 'sqm' | 'person' | 'apartment' | 'unit';\n  normative?: number;              //  \n  normativeUnit?: string;\n\n  // \n  hasDayNightRates: boolean;\n  dayRate?: number;\n  nightRate?: number;\n\n  //  \n  effectiveFrom: string;\n  effectiveTo?: string;\n\n  // \n  includesVat: boolean;\n  vatRate: number;\n\n  createdAt: string;\n  createdBy: string;\n}\n\n// \nexport interface Charge {\n  id: string;\n  personalAccountId: string;\n  apartmentId: string;\n  buildingId: string;\n\n  // \n  period: string;                  // YYYY-MM\n\n  // \n  serviceId: string;\n  serviceName: string;\n  tariffId: string;\n\n  // \n  quantity: number;                //  (/-/)\n  rate: number;                    // \n  amount: number;                  //   \n  subsidyAmount: number;           //  \n  discountAmount: number;          // \n  recalculationAmount: number;     // \n  penaltyAmount: number;           // \n  totalAmount: number;             //   \n\n  //  \n  meterReadingId?: string;\n  previousReading?: number;\n  currentReading?: number;\n  consumption?: number;\n\n  // \n  status: 'draft' | 'calculated' | 'approved' | 'billed' | 'paid' | 'partially_paid';\n\n  calculatedAt: string;\n  calculatedBy: string;\n  approvedAt?: string;\n  approvedBy?: string;\n}\n\n//  ()\nexport interface Invoice {\n  id: string;\n  number: string;\n  personalAccountId: string;\n\n  // \n  period: string;\n  dueDate: string;\n\n  // \n  previousBalance: number;\n  totalCharges: number;\n  totalPayments: number;\n  currentBalance: number;\n  amountDue: number;\n\n  // \n  charges: Charge[];\n\n  // \n  status: 'draft' | 'sent' | 'viewed' | 'paid' | 'overdue' | 'cancelled';\n  sentAt?: string;\n  sentVia?: 'email' | 'sms' | 'post' | 'personal';\n  viewedAt?: string;\n  paidAt?: string;\n\n  // QR-  \n  qrCode?: string;\n  paymentUrl?: string;\n\n  createdAt: string;\n}\n\n// \nexport interface Payment {\n  id: string;\n  personalAccountId: string;\n  invoiceId?: string;\n\n  // \n  amount: number;\n\n  // \n  source: 'bank' | 'card' | 'cash' | 'terminal' | 'online' | 'mobile' | 'auto';\n  transactionId?: string;\n  bankName?: string;\n  payerName?: string;\n\n  //   \n  distribution: {\n    chargeId: string;\n    serviceId: string;\n    amount: number;\n  }[];\n\n  // \n  status: 'pending' | 'completed' | 'failed' | 'refunded' | 'cancelled';\n\n  paymentDate: string;\n  processedAt?: string;\n  processedBy?: string;\n\n  notes?: string;\n}\n\n//  \nexport interface ReconciliationAct {\n  id: string;\n  number: string;\n  personalAccountId: string;\n  ownerName: string;\n\n  // \n  periodFrom: string;\n  periodTo: string;\n\n  // \n  openingBalance: number;\n  totalCharges: number;\n  totalPayments: number;\n  closingBalance: number;\n\n  // \n  items: {\n    date: string;\n    description: string;\n    debit: number;\n    credit: number;\n    balance: number;\n  }[];\n\n  // \n  status: 'draft' | 'sent' | 'confirmed' | 'disputed';\n\n  createdAt: string;\n  createdBy: string;\n  sentAt?: string;\n  confirmedAt?: string;\n}\n\n//  (   )\nexport interface DebtClaim {\n  id: string;\n  number: string;\n  personalAccountId: string;\n  ownerId: string;\n\n  // \n  debtAmount: number;\n  penaltyAmount: number;\n  totalAmount: number;\n  debtPeriods: string[];           //  \n\n  //  \n  stage: 'reminder' | 'warning' | 'pretrial' | 'court' | 'enforcement' | 'restructured' | 'written_off';\n\n  //  \n  actions: {\n    date: string;\n    type: 'sms' | 'call' | 'letter' | 'visit' | 'meeting' | 'agreement' | 'court_filing';\n    description: string;\n    result?: string;\n    performedBy: string;\n    documents?: string[];\n  }[];\n\n  // \n  hasRestructuring: boolean;\n  restructuringSchedule?: {\n    date: string;\n    amount: number;\n    isPaid: boolean;\n  }[];\n\n  // \n  status: 'active' | 'resolved' | 'court' | 'closed';\n  closedReason?: string;\n\n  assignedTo?: string;\n\n  createdAt: string;\n  updatedAt: string;\n}\n\n// ============================================\n// WORKFORCE -  \n// ============================================\n\n//  \nexport type WorkType =\n  | 'scheduled_maintenance'      //  \n  | 'seasonal_inspection'        //  \n  | 'emergency_repair'           //  \n  | 'current_repair'             //  \n  | 'capital_repair'             //  \n  | 'cleaning'                   // \n  | 'landscaping'                // \n  | 'meter_inspection'           //  \n  | 'deratization'               // \n  | 'disinfection'               // \n  | 'fire_safety'                //  \n  | 'elevator_maintenance'       //  \n  | 'itp_maintenance'            //  \n  | 'other';\n\n// - \nexport interface WorkSchedule {\n  id: string;\n  name: string;\n  description?: string;\n\n  //   \n  workType: WorkType;\n  category: ExecutorSpecialization;\n\n  // \n  buildingIds: string[];           //   \n  scope: 'building' | 'entrance' | 'apartment' | 'common_area' | 'territory';\n\n  // \n  scheduleType: 'once' | 'daily' | 'weekly' | 'monthly' | 'quarterly' | 'yearly' | 'custom';\n  startDate: string;\n  endDate?: string;\n  recurrenceRule?: string;         // RRULE format\n  plannedDates: string[];          //  \n\n  // \n  estimatedDuration: number;       // \n  requiredWorkers: number;\n  assignedTeamId?: string;\n  assignedExecutorIds: string[];\n\n  // \n  requiredMaterials: {\n    materialId: string;\n    quantity: number;\n  }[];\n  estimatedCost: number;\n\n  // -\n  checklistTemplateId?: string;\n\n  // \n  isActive: boolean;\n  isPaused: boolean;\n  pauseReason?: string;\n\n  createdAt: string;\n  createdBy: string;\n  updatedAt: string;\n}\n\n// / \nexport interface WorkOrder {\n  id: string;\n  number: string;\n\n  // \n  source: 'schedule' | 'request' | 'emergency' | 'inspection' | 'manual';\n  scheduleId?: string;\n  requestId?: string;\n  emergencyId?: string;\n\n  // \n  workType: WorkType;\n  category: ExecutorSpecialization;\n  title: string;\n  description: string;\n\n  // \n  buildingId: string;\n  buildingAddress: string;\n  entranceId?: string;\n  apartmentId?: string;\n  location: string;                //  \n\n  // \n  plannedStartDate: string;\n  plannedEndDate: string;\n  actualStartDate?: string;\n  actualEndDate?: string;\n\n  // \n  assignedTeamId?: string;\n  assignedExecutorIds: string[];\n  primaryExecutorId?: string;\n\n  // \n  plannedMaterials: {\n    materialId: string;\n    materialName: string;\n    quantity: number;\n    unit: string;\n    unitCost: number;\n    totalCost: number;\n  }[];\n  actualMaterials: {\n    materialId: string;\n    materialName: string;\n    quantity: number;\n    unit: string;\n    unitCost: number;\n    totalCost: number;\n    warehouseId: string;\n  }[];\n\n  // \n  plannedLabor: number;            // -\n  actualLabor: number;\n  laborCost: number;\n\n  // \n  estimatedCost: number;\n  actualCost: number;\n\n  // -\n  checklist: ChecklistItem[];\n  checklistCompletedAt?: string;\n\n  // \n  photosBefore: WorkPhoto[];\n  photosAfter: WorkPhoto[];\n  photosProcess: WorkPhoto[];\n\n  // \n  executorSignature?: string;\n  residentSignature?: string;\n  managerSignature?: string;\n\n  // \n  status: 'draft' | 'planned' | 'assigned' | 'in_progress' | 'paused' | 'completed' | 'verified' | 'cancelled';\n  priority: 'low' | 'normal' | 'high' | 'urgent';\n\n  // /\n  cancelledAt?: string;\n  cancelledBy?: string;\n  cancelReason?: string;\n\n  // \n  rating?: number;\n  feedback?: string;\n\n  createdAt: string;\n  createdBy: string;\n  updatedAt: string;\n}\n\n//  -\nexport interface ChecklistItem {\n  id: string;\n  order: number;\n  title: string;\n  description?: string;\n  isRequired: boolean;\n  isCompleted: boolean;\n  completedAt?: string;\n  completedBy?: string;\n  notes?: string;\n  photoRequired: boolean;\n  photoId?: string;\n}\n\n//  \nexport interface WorkPhoto {\n  id: string;\n  workOrderId: string;\n  type: 'before' | 'after' | 'process' | 'defect' | 'materials';\n  url: string;\n  thumbnailUrl: string;\n  takenAt: string;\n  takenBy: string;\n  geoLocation?: {\n    latitude: number;\n    longitude: number;\n  };\n  notes?: string;\n}\n\n//  -\nexport interface ChecklistTemplate {\n  id: string;\n  name: string;\n  workType: WorkType;\n  category: ExecutorSpecialization;\n  items: {\n    order: number;\n    title: string;\n    description?: string;\n    isRequired: boolean;\n    photoRequired: boolean;\n  }[];\n  isActive: boolean;\n  createdAt: string;\n  createdBy: string;\n}\n\n// ============================================\n//   \n// ============================================\n\n// \nexport interface Warehouse {\n  id: string;\n  name: string;\n  address: string;\n  type: 'main' | 'building' | 'mobile';\n  buildingId?: string;\n  responsibleId: string;\n  responsibleName: string;\n  isActive: boolean;\n}\n\n// \nexport interface Material {\n  id: string;\n  code: string;\n  name: string;\n  category: string;\n  unit: string;\n\n  // \n  averageCost: number;\n  lastPurchasePrice: number;\n\n  // \n  totalQuantity: number;\n  reservedQuantity: number;\n  availableQuantity: number;\n  minQuantity: number;             //  \n\n  // \n  manufacturer?: string;\n  specifications?: string;\n  shelfLife?: number;              //    \n\n  isActive: boolean;\n}\n\n//    \nexport interface StockItem {\n  id: string;\n  warehouseId: string;\n  materialId: string;\n  quantity: number;\n  reservedQuantity: number;\n  lotNumber?: string;\n  expirationDate?: string;\n  location?: string;               // /\n  lastMovementAt: string;\n}\n\n//  \nexport interface StockMovement {\n  id: string;\n  warehouseId: string;\n  materialId: string;\n\n  type: 'receipt' | 'issue' | 'transfer' | 'write_off' | 'inventory' | 'return';\n  quantity: number;\n\n  // \n  workOrderId?: string;\n  purchaseOrderId?: string;\n  transferFromWarehouseId?: string;\n\n  // \n  unitCost: number;\n  totalCost: number;\n  lotNumber?: string;\n\n  // \n  performedBy: string;\n  performedAt: string;\n  approvedBy?: string;\n  approvedAt?: string;\n\n  notes?: string;\n}\n\n// ============================================\n// - \n// ============================================\n\n//  \nexport type EmergencyType =\n  | 'water_leak'                 //  \n  | 'water_main_break'           //  \n  | 'sewage_backup'              //  \n  | 'no_water'                   //  \n  | 'no_hot_water'               //   \n  | 'power_outage'               //  \n  | 'electrical_short'           //  \n  | 'gas_leak'                   //  \n  | 'elevator_stuck'             //   \n  | 'elevator_malfunction'       //  \n  | 'heating_failure'            //  \n  | 'fire'                       // \n  | 'flooding'                   // \n  | 'roof_leak'                  //  \n  | 'door_lock_failure'          //   \n  | 'intercom_failure'           //   \n  | 'other';\n\n//  \nexport interface EmergencyRequest {\n  id: string;\n  number: string;\n\n  //   \n  emergencyType: EmergencyType;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n\n  // \n  title: string;\n  description: string;\n\n  // \n  buildingId: string;\n  buildingAddress: string;\n  entranceId?: string;\n  apartmentId?: string;\n  apartmentNumber?: string;\n  floor?: number;\n  location: string;\n\n  // \n  reporterId?: string;\n  reporterName: string;\n  reporterPhone: string;\n  reporterType: 'resident' | 'employee' | 'security' | 'anonymous' | 'auto';\n\n  //  \n  receivedAt: string;\n  receivedBy: string;\n  receivedVia: 'phone' | 'app' | 'web' | 'sms' | 'intercom' | 'auto';\n\n  // \n  dispatchedAt?: string;\n  dispatchedBy?: string;\n  assignedTeamId?: string;\n  assignedExecutorIds: string[];\n\n  //  \n  estimatedArrival?: string;\n  actualArrival?: string;\n\n  // \n  workStartedAt?: string;\n  workCompletedAt?: string;\n\n  // \n  resolution?: string;\n  workOrderId?: string;\n  requiresFollowUp: boolean;\n  followUpWorkOrderId?: string;\n\n  // -  \n  scenarioChecklist: {\n    step: string;\n    isCompleted: boolean;\n    completedAt?: string;\n    notes?: string;\n  }[];\n\n  // \n  status: 'received' | 'dispatched' | 'en_route' | 'on_site' | 'in_progress' | 'completed' | 'cancelled' | 'false_alarm';\n\n  // \n  causeCategory?: string;\n  rootCause?: string;\n  preventionMeasures?: string;\n\n  // /\n  photos: string[];\n  documents: string[];\n\n  createdAt: string;\n  updatedAt: string;\n  closedAt?: string;\n  closedBy?: string;\n}\n\n//  \nexport interface EmergencyScenario {\n  id: string;\n  emergencyType: EmergencyType;\n  name: string;\n  description: string;\n\n  // - \n  steps: {\n    order: number;\n    action: string;\n    description: string;\n    isRequired: boolean;\n    timeLimit?: number;            // \n  }[];\n\n  // \n  notifications: {\n    role: UserRole;\n    channel: 'sms' | 'push' | 'call' | 'email';\n    template: string;\n    delayMinutes: number;\n  }[];\n\n  // SLA\n  responseTimeMinutes: number;\n  resolutionTimeMinutes: number;\n\n  isActive: boolean;\n}\n\n// ============================================\n//    KPI\n// ============================================\n\n// KPI \nexport interface KPIMetric {\n  id: string;\n  code: string;\n  name: string;\n  description: string;\n\n  //   \n  type: 'time' | 'percentage' | 'count' | 'rating' | 'money';\n  aggregation: 'avg' | 'sum' | 'min' | 'max' | 'count' | 'latest';\n  formula?: string;\n\n  //  \n  targetValue: number;\n  warningThreshold: number;\n  criticalThreshold: number;\n  isHigherBetter: boolean;\n\n  // \n  category: 'response' | 'resolution' | 'quality' | 'financial' | 'satisfaction';\n  applicableTo: 'executor' | 'team' | 'building' | 'company';\n\n  isActive: boolean;\n}\n\n//  KPI\nexport interface KPIValue {\n  id: string;\n  metricId: string;\n\n  // \n  period: string;                  // YYYY-MM  YYYY-WW\n  periodType: 'day' | 'week' | 'month' | 'quarter' | 'year';\n\n  // \n  subjectType: 'executor' | 'team' | 'building' | 'company';\n  subjectId: string;\n  subjectName: string;\n\n  // \n  value: number;\n  targetValue: number;\n  previousValue?: number;\n\n  // \n  status: 'green' | 'yellow' | 'red';\n  trend: 'up' | 'down' | 'stable';\n\n  calculatedAt: string;\n}\n\n//  /\nexport interface DelayReason {\n  id: string;\n  requestId?: string;\n  workOrderId?: string;\n\n  category: 'no_access' | 'no_materials' | 'wrong_category' | 'overload' | 'waiting_approval' | 'external' | 'other';\n  description: string;\n\n  delayMinutes: number;\n\n  reportedBy: string;\n  reportedAt: string;\n\n  isResolved: boolean;\n  resolution?: string;\n  resolvedAt?: string;\n}\n\n// /  \nexport interface QualityComplaint {\n  id: string;\n  number: string;\n\n  // \n  relatedTo: 'request' | 'work_order' | 'service' | 'employee' | 'other';\n  relatedId?: string;\n\n  // \n  complainantId: string;\n  complainantName: string;\n  complainantPhone: string;\n\n  // \n  category: 'quality' | 'timeliness' | 'behavior' | 'damage' | 'billing' | 'other';\n  description: string;\n\n  // \n  assignedTo?: string;\n  investigation?: string;\n  resolution?: string;\n\n  // \n  compensationType?: 'none' | 'refund' | 'discount' | 'free_service' | 'other';\n  compensationAmount?: number;\n  compensationDescription?: string;\n\n  // \n  status: 'new' | 'investigating' | 'resolved' | 'rejected' | 'escalated';\n  priority: 'low' | 'normal' | 'high';\n\n  createdAt: string;\n  resolvedAt?: string;\n  resolvedBy?: string;\n}\n\n// ============================================\n//    \n// ============================================\n\n//  \nexport type ExtendedUserRole =\n  | 'super_admin'                // - ( )\n  | 'admin'                      //  \n  | 'director'                   // \n  | 'accountant'                 // \n  | 'chief_engineer'             //  \n  | 'dispatcher'                 // \n  | 'manager'                    //     \n  | 'foreman'                    // /\n  | 'executor'                   // \n  | 'resident'                   // \n  | 'owner_representative';      //  \n\n// \nexport interface Permission {\n  id: string;\n  code: string;\n  name: string;\n  description: string;\n  module: 'crm' | 'requests' | 'workforce' | 'finance' | 'emergency' | 'reports' | 'settings' | 'audit';\n  action: 'view' | 'create' | 'edit' | 'delete' | 'approve' | 'export' | 'manage';\n}\n\n//   \nexport interface Role {\n  id: string;\n  code: ExtendedUserRole;\n  name: string;\n  description: string;\n\n  permissions: string[];           // Permission IDs\n\n  //   \n  buildingScope: 'all' | 'assigned' | 'none';\n  canViewFinancials: boolean;\n  canViewPersonalData: boolean;\n  canExportData: boolean;\n\n  isSystem: boolean;               //   ( )\n  isActive: boolean;\n\n  createdAt: string;\n  updatedAt: string;\n}\n\n//   ()\nexport interface AuditLog {\n  id: string;\n\n  // \n  userId: string;\n  userName: string;\n  userRole: string;\n  ipAddress?: string;\n  userAgent?: string;\n  sessionId?: string;\n\n  // \n  action: 'create' | 'read' | 'update' | 'delete' | 'login' | 'logout' | 'export' | 'approve' | 'reject' | 'assign' | 'other';\n  module: string;\n  entityType: string;\n  entityId: string;\n  entityName?: string;\n\n  //  \n  previousValue?: Record<string, unknown>;\n  newValue?: Record<string, unknown>;\n  changedFields?: string[];\n\n  // \n  status: 'success' | 'failure' | 'partial';\n  errorMessage?: string;\n\n  // \n  buildingId?: string;\n  requestId?: string;\n\n  timestamp: string;\n}\n\n// ============================================\n//    \n// ============================================\n\nexport const WORK_TYPE_LABELS: Record<WorkType, string> = {\n  scheduled_maintenance: ' ',\n  seasonal_inspection: ' ',\n  emergency_repair: ' ',\n  current_repair: ' ',\n  capital_repair: ' ',\n  cleaning: '',\n  landscaping: '',\n  meter_inspection: ' ',\n  deratization: '',\n  disinfection: '',\n  fire_safety: ' ',\n  elevator_maintenance: ' ',\n  itp_maintenance: ' ',\n  other: ''\n};\n\nexport const EMERGENCY_TYPE_LABELS: Record<EmergencyType, string> = {\n  water_leak: ' ',\n  water_main_break: ' ',\n  sewage_backup: ' ',\n  no_water: ' ',\n  no_hot_water: '  ',\n  power_outage: ' ',\n  electrical_short: ' ',\n  gas_leak: ' ',\n  elevator_stuck: '  ',\n  elevator_malfunction: ' ',\n  heating_failure: ' ',\n  fire: '',\n  flooding: '',\n  roof_leak: ' ',\n  door_lock_failure: '  ',\n  intercom_failure: '  ',\n  other: ''\n};\n\nexport const ROLE_LABELS: Record<ExtendedUserRole, string> = {\n  super_admin: '-',\n  admin: '',\n  director: '',\n  accountant: '',\n  chief_engineer: ' ',\n  dispatcher: '',\n  manager: '',\n  foreman: '',\n  executor: '',\n  resident: '',\n  owner_representative: ' '\n};\n\nexport const BUILDING_TYPE_LABELS: Record<BuildingFull['buildingType'], string> = {\n  panel: '',\n  brick: '',\n  monolith: '',\n  block: '',\n  wooden: '',\n  mixed: ''\n};\n\nexport const SERVICE_CATEGORY_LABELS: Record<Service['category'], string> = {\n  housing: ' ',\n  utility: ' ',\n  additional: ' ',\n  repair: ' ',\n  other: ''\n};\n\nexport const DEBT_STAGE_LABELS: Record<DebtClaim['stage'], string> = {\n  reminder: '',\n  warning: '',\n  pretrial: ' ',\n  court: ' ',\n  enforcement: ' ',\n  restructured: '',\n  written_off: ''\n};\n\n// ============================================\n//  \n// ============================================\n\n//   \nexport type TrainingProposalStatus =\n  | 'voting'        //  \n  | 'review'        //  ( )\n  | 'approved'      //  \n  | 'scheduled'     //  \n  | 'completed'     // \n  | 'rejected';     // \n\n//  \nexport type TrainingFormat = 'online' | 'offline' | 'any';\n\n//  \nexport type TrainingTimeSlot = 'morning' | 'afternoon' | 'evening' | 'weekend';\n\n//  \nexport type ParticipationIntent = 'definitely' | 'maybe' | 'support_only';\n\n//  ()\nexport interface Partner {\n  id: string;\n  name: string;\n  position: string;\n  specialization?: string;\n  email?: string;\n  phone?: string;\n  bio?: string;\n  avatar?: string;\n  avatarUrl?: string;\n  isActive: boolean;\n  trainingsonducted?: number;\n  averageRating?: number;\n}\n\n//    \nexport interface TrainingVote {\n  id: string;\n  proposalId: string;\n  voterId: string;\n  voterName: string;\n  participationIntent: ParticipationIntent;\n  isAnonymous: boolean;\n  votedAt: string;\n}\n\n//  \nexport interface TrainingProposal {\n  id: string;\n\n  //  \n  topic: string;\n  description?: string;\n\n  // \n  authorId: string;\n  authorName: string;\n  isAuthorAnonymous: boolean;\n\n  // \n  partnerId: string;\n  partnerName: string;\n  format: TrainingFormat;\n  preferredTimeSlots: TrainingTimeSlot[];\n\n  // \n  votes: TrainingVote[];\n  voteThreshold: number; //   \n\n  // \n  status: TrainingProposalStatus;\n  partnerResponse?: 'accepted' | 'rejected';\n  partnerResponseAt?: string;\n  partnerResponseNote?: string;\n\n  //  \n  scheduledDate?: string;\n  scheduledTime?: string;\n  scheduledLocation?: string;\n  scheduledLink?: string; //  \n\n  // \n  maxParticipants?: number;\n  registeredParticipants?: string[];\n\n  // \n  feedback?: TrainingFeedback[];\n\n  // \n  createdAt: string;\n  updatedAt: string;\n  completedAt?: string;\n  actualParticipantsCount?: number;\n\n  // Computed fields from API\n  voteCount?: number;\n  registeredCount?: number;\n}\n\n//   \nexport interface TrainingFeedback {\n  id: string;\n  proposalId: string;\n  reviewerId: string;\n  reviewerName: string;\n  isAnonymous: boolean;\n  rating: number; // 1-5\n  contentRating?: number;\n  presenterRating?: number;\n  usefulnessRating?: number;\n  comment?: string;\n  createdAt: string;\n}\n\n//   \nexport interface TrainingNotification {\n  id: string;\n  type:\n    | 'new_proposal'           //  \n    | 'threshold_reached'      //   \n    | 'partner_response'       //  \n    | 'training_scheduled'     //  \n    | 'reminder_day_before'    //   \n    | 'reminder_hour_before'   //   \n    | 'feedback_request';      //  \n  proposalId: string;\n  recipientId: string;\n  recipientRole: 'employee' | 'partner' | 'admin';\n  title: string;\n  message: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\n//   \nexport interface TrainingSettings {\n  voteThreshold: number;           //     (  5)\n  allowAnonymousProposals: boolean;\n  allowAnonymousVotes: boolean;\n  allowAnonymousFeedback: boolean;\n  notifyAllOnNewProposal: boolean;\n  autoCloseAfterDays?: number;     //   \n}\n\n//   UI\nexport const TRAINING_STATUS_LABELS: Record<TrainingProposalStatus, { label: string; labelUz: string; color: string }> = {\n  voting: { label: '', labelUz: 'Ovoz berish', color: 'blue' },\n  review: { label: '', labelUz: 'Ko\\'rib chiqish', color: 'yellow' },\n  approved: { label: '', labelUz: 'Tasdiqlangan', color: 'green' },\n  scheduled: { label: '', labelUz: 'Belgilangan', color: 'purple' },\n  completed: { label: '', labelUz: 'O\\'tkazildi', color: 'gray' },\n  rejected: { label: '', labelUz: 'Rad etilgan', color: 'red' },\n};\n\nexport const TRAINING_FORMAT_LABELS: Record<TrainingFormat, { label: string; labelUz: string }> = {\n  online: { label: '', labelUz: 'Onlayn' },\n  offline: { label: '', labelUz: 'Oflayn' },\n  any: { label: '', labelUz: 'Farqi yo\\'q' },\n};\n\nexport const TRAINING_TIME_LABELS: Record<TrainingTimeSlot, { label: string; labelUz: string }> = {\n  morning: { label: '', labelUz: 'Ertalab' },\n  afternoon: { label: '', labelUz: 'Kunduzi' },\n  evening: { label: '', labelUz: 'Kechqurun' },\n  weekend: { label: '', labelUz: 'Dam olish kuni' },\n};\n\nexport const PARTICIPATION_LABELS: Record<ParticipationIntent, { label: string; labelUz: string }> = {\n  definitely: { label: ' ', labelUz: 'Albatta kelaman' },\n  maybe: { label: ' ', labelUz: 'Balki kelaman' },\n  support_only: { label: ' ', labelUz: 'Faqat qo\\'llab-quvvatlayman' },\n};\n\n// ============================================\n// VEHICLES MODULE -  \n// ============================================\n\nexport type VehicleType = 'car' | 'motorcycle' | 'truck' | 'other';\nexport type VehicleOwnerType = 'individual' | 'legal_entity' | 'service';\n\nexport interface Vehicle {\n  id: string;\n  ownerId: string;           // ID    ( )\n  ownerName: string;\n  ownerPhone: string;\n  apartment: string;\n  address: string;\n  plateNumber: string;       //   (01A123BC)\n  brand: string;             //  (Toyota, Chevrolet, etc)\n  model: string;             //  (Camry, Nexia, etc)\n  color: string;             // \n  year?: number;             //  \n  type: VehicleType;\n  ownerType: VehicleOwnerType; //  : , , \n  companyName?: string;      //   ( /)\n  parkingSpot?: string;      //   \n  notes?: string;            // \n  createdAt: string;\n  updatedAt?: string;\n}\n\nexport const VEHICLE_TYPE_LABELS: Record<VehicleType, { label: string; labelUz: string }> = {\n  car: { label: ' ', labelUz: 'Yengil avtomobil' },\n  motorcycle: { label: '', labelUz: 'Mototsikl' },\n  truck: { label: '', labelUz: 'Yuk mashinasi' },\n  other: { label: '', labelUz: 'Boshqa' },\n};\n\nexport const VEHICLE_OWNER_TYPE_LABELS: Record<VehicleOwnerType, { label: string; labelUz: string; icon: string }> = {\n  individual: { label: '. ', labelUz: 'Jismoniy shaxs', icon: '' },\n  legal_entity: { label: '. ', labelUz: 'Yuridik shaxs', icon: '' },\n  service: { label: '', labelUz: 'Xizmat', icon: '' },\n};\n\n// ============================================\n// GUEST QR ACCESS MODULE - QR-  \n// ============================================\n\n//  \nexport type VisitorType = 'courier' | 'guest' | 'taxi' | 'other';\n\n//   (  )\nexport type AccessType = 'single_use' | 'day' | 'week' | 'custom';\n\n//  QR-\nexport type GuestAccessStatus = 'active' | 'expired' | 'used' | 'revoked';\n\n// QR-  \nexport interface GuestAccessCode {\n  id: string;\n\n  //  ()\n  residentId: string;\n  residentName: string;\n  residentPhone: string;\n  residentApartment: string;\n  residentAddress: string;\n\n  //  \n  visitorType: VisitorType;\n  visitorName?: string;          //   (  /)\n  visitorPhone?: string;         //  ()\n  visitorVehiclePlate?: string;  //    ( )\n\n  //  \n  accessType: AccessType;\n  validFrom: string;             // ISO datetime -  \n  validUntil: string;            // ISO datetime -  \n  maxUses: number;               // .   (1  single_use)\n  currentUses: number;           //   \n\n  // QR-\n  qrToken: string;               //    QR (UUID + )\n  qrImageUrl?: string;           // URL  QR \n\n  // \n  status: GuestAccessStatus;\n\n  //   ( revoked)\n  revokedAt?: string;\n  revokedBy?: string;\n  revokedByName?: string;\n  revokedByRole?: UserRole;\n  revocationReason?: string;\n\n  //   \n  notes?: string;\n\n  // \n  createdAt: string;\n  updatedAt?: string;\n  lastUsedAt?: string;\n}\n\n//   QR-\nexport interface GuestAccessLog {\n  id: string;\n  accessCodeId: string;\n\n  //  \n  scannedById: string;\n  scannedByName: string;\n  scannedByRole: UserRole;       // security, manager, admin\n\n  //  \n  action: 'scan_success' | 'scan_expired' | 'scan_used' | 'scan_revoked' | 'scan_invalid' | 'entry_allowed' | 'entry_denied';\n\n  //    \n  visitorType: VisitorType;\n  residentName: string;\n  residentApartment: string;\n\n  // \n  notes?: string;\n\n  //   ()\n  geoLocation?: {\n    latitude: number;\n    longitude: number;\n  };\n\n  // \n  timestamp: string;\n}\n\n//     \nexport interface GuestAccessStats {\n  totalActive: number;           //  \n  totalUsedToday: number;        //  \n  totalCreatedToday: number;     //  \n  byVisitorType: {\n    courier: number;\n    guest: number;\n    taxi: number;\n    other: number;\n  };\n  recentScans: GuestAccessLog[]; //  \n}\n\n//   \nexport interface GuestAccessLimits {\n  maxActivePerResident: number;  // .    \n  maxDayPassDuration: number;    // .    ()\n  maxWeekPassDuration: number;   // .    ()\n  maxCustomDuration: number;     // .    ()\n  allowVehiclePlate: boolean;    //    \n}\n\n//   UI\nexport const VISITOR_TYPE_LABELS: Record<VisitorType, { label: string; labelUz: string; icon: string }> = {\n  courier: { label: '', labelUz: 'Kuryer', icon: '' },\n  guest: { label: '', labelUz: 'Mehmon', icon: '' },\n  taxi: { label: '', labelUz: 'Taksi', icon: '' },\n  other: { label: '', labelUz: 'Boshqa', icon: '' },\n};\n\nexport const ACCESS_TYPE_LABELS: Record<AccessType, { label: string; labelUz: string; description: string; descriptionUz: string }> = {\n  single_use: {\n    label: '',\n    labelUz: 'Bir martalik',\n    description: '   ',\n    descriptionUz: 'Birinchi foydalanishgacha amal qiladi'\n  },\n  day: {\n    label: ' ',\n    labelUz: 'Kunlik',\n    description: '   ',\n    descriptionUz: 'Kun oxirigacha amal qiladi'\n  },\n  week: {\n    label: ' ',\n    labelUz: 'Haftalik',\n    description: ' 7 ',\n    descriptionUz: '7 kun amal qiladi'\n  },\n  custom: {\n    label: ' ',\n    labelUz: 'Maxsus muddat',\n    description: '  ',\n    descriptionUz: 'Amal qilish muddatini belgilang'\n  },\n};\n\nexport const GUEST_ACCESS_STATUS_LABELS: Record<GuestAccessStatus, { label: string; labelUz: string; color: string }> = {\n  active: { label: '', labelUz: 'Faol', color: 'green' },\n  expired: { label: '', labelUz: 'Muddati tugagan', color: 'gray' },\n  used: { label: '', labelUz: 'Ishlatilgan', color: 'blue' },\n  revoked: { label: '', labelUz: 'Bekor qilingan', color: 'red' },\n};\n\nexport const GUEST_ACCESS_LOG_ACTION_LABELS: Record<GuestAccessLog['action'], { label: string; labelUz: string; color: string }> = {\n  scan_success: { label: ' ', labelUz: 'Muvaffaqiyatli skanerlash', color: 'green' },\n  scan_expired: { label: ' ', labelUz: 'Ruxsatnoma muddati tugagan', color: 'orange' },\n  scan_used: { label: '  ', labelUz: 'Ruxsatnoma ishlatilgan', color: 'yellow' },\n  scan_revoked: { label: ' ', labelUz: 'Ruxsatnoma bekor qilingan', color: 'red' },\n  scan_invalid: { label: ' QR', labelUz: 'Noto\\'g\\'ri QR', color: 'red' },\n  entry_allowed: { label: ' ', labelUz: 'Kirish ruxsat etildi', color: 'green' },\n  entry_denied: { label: ' ', labelUz: 'Kirish rad etildi', color: 'red' },\n};\n\n// ============================================\n// RESCHEDULE/FEEDBACK SYSTEM -  \n// ============================================\n\n//    \nexport type RescheduleRequestStatus = 'pending' | 'accepted' | 'rejected' | 'expired';\n\n//   \nexport type RescheduleInitiator = 'resident' | 'executor';\n\n//  \nexport type RescheduleReason =\n  | 'busy_time'           //    \n  | 'emergency'           //  \n  | 'not_at_home'         //   \n  | 'need_preparation'    //    \n  | 'other';              // \n\n//     \nexport interface RescheduleRequest {\n  id: string;\n  requestId: string;              // ID \n  requestNumber: number | string; //     (   , e.g. YS-1001)\n\n  // \n  initiator: RescheduleInitiator;\n  initiatorId: string;\n  initiatorName: string;\n\n  //  (   )\n  recipientId: string;\n  recipientName: string;\n  recipientRole: 'resident' | 'executor';\n\n  //   \n  currentDate?: string;\n  currentTime?: string;\n\n  //   \n  proposedDate: string;\n  proposedTime: string;\n\n  //  \n  reason: RescheduleReason;\n  reasonText?: string;            //  \n\n  // \n  status: RescheduleRequestStatus;\n\n  // \n  respondedAt?: string;\n  responseNote?: string;          //   /\n\n  // \n  createdAt: string;\n  expiresAt: string;              //    24 \n}\n\n//    (  )\nexport type RescheduleNotificationType =\n  | 'reschedule_requested'        //  \n  | 'reschedule_accepted'         //  \n  | 'reschedule_rejected'         //  \n  | 'reschedule_expired';         //  \n\n//   \nexport const RESCHEDULE_REASON_LABELS: Record<RescheduleReason, { label: string; labelUz: string }> = {\n  busy_time: { label: '   ', labelUz: 'Bu vaqtda band' },\n  emergency: { label: ' ', labelUz: 'Kutilmagan holat' },\n  not_at_home: { label: '  ', labelUz: 'Uyda bo\\'lmayman' },\n  need_preparation: { label: '   ', labelUz: 'Tayyorgarlik kerak' },\n  other: { label: ' ', labelUz: 'Boshqa sabab' },\n};\n\nexport const RESCHEDULE_STATUS_LABELS: Record<RescheduleRequestStatus, { label: string; labelUz: string; color: string }> = {\n  pending: { label: ' ', labelUz: 'Javob kutilmoqda', color: 'yellow' },\n  accepted: { label: '', labelUz: 'Qabul qilindi', color: 'green' },\n  rejected: { label: '', labelUz: 'Rad etildi', color: 'red' },\n  expired: { label: ' ', labelUz: 'Muddati tugadi', color: 'gray' },\n};\n","import { useState, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useNavigate } from 'react-router-dom';\nimport { Bell, Clock, Search, Lock, Phone, FileText, Car, ChevronRight, Megaphone, Users } from 'lucide-react';\nimport { useAuthStore } from '../../stores/authStore';\nimport { useDataStore } from '../../stores/dataStore';\nimport { useMeetingStore } from '../../stores/meetingStore';\nimport { SPECIALIZATION_LABELS } from '../../types';\nimport type { ExecutorSpecialization } from '../../types';\n\n// Onboarding tasks for residents\ninterface OnboardingTask {\n  id: string;\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n  route: string;\n  checkComplete: (user: any, vehicles: any[]) => boolean;\n}\n\n// NOTE: Onboarding completion is now tracked in the database (password_changed_at, contract_signed_at)\n// This ensures the status persists across devices and browsers.\n// The markOnboardingComplete function is kept for backward compatibility but the primary\n// source of truth is now the user object from the API.\n\n// Mark action as completed (legacy - kept for backward compatibility during transition)\nexport const markOnboardingComplete = (userId: string, action: string): void => {\n  // This is now handled by the API automatically\n  // password_changed_at is set when user changes password\n  // contract_signed_at is set when user downloads contract\n  console.log(`[Onboarding] Action ${action} for user ${userId} - now tracked in DB`);\n};\n\nconst ONBOARDING_TASKS: OnboardingTask[] = [\n  {\n    id: 'change_password',\n    title: ' ',\n    description: '     ',\n    icon: <Lock className=\"w-5 h-5 text-amber-500\" />,\n    route: '/profile',\n    // Check if user has changed password (stored in DB - passwordChangedAt field)\n    checkComplete: (user) => !!user?.passwordChangedAt,\n  },\n  {\n    id: 'add_phone',\n    title: '  ',\n    description: '    ',\n    icon: <Phone className=\"w-5 h-5 text-blue-500\" />,\n    route: '/profile',\n    checkComplete: (user) => !!user?.phone && user.phone.length > 5,\n  },\n  {\n    id: 'sign_contract',\n    title: ' ',\n    description: '     ',\n    icon: <FileText className=\"w-5 h-5 text-green-500\" />,\n    route: '/', // Goes to dashboard where contract section is\n    // Check if user has downloaded contract (stored in DB - contractSignedAt field)\n    checkComplete: (user) => !!user?.contractSignedAt,\n  },\n  {\n    id: 'add_vehicle',\n    title: ' ',\n    description: '    ',\n    icon: <Car className=\"w-5 h-5 text-purple-500\" />,\n    route: '/vehicles',\n    checkComplete: (user, vehicles) => vehicles.some(v => v.ownerId === user?.id),\n  },\n];\n\nexport function Header() {\n  const { user } = useAuthStore();\n  const { notifications, requests, vehicles, getUnreadCount, markNotificationAsRead, markAllNotificationsAsRead, getAnnouncementsForResidents, getAnnouncementsForEmployees } = useDataStore();\n  const { meetings } = useMeetingStore();\n  const navigate = useNavigate();\n  const [showNotifications, setShowNotifications] = useState(false);\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const sentRemindersRef = useRef<Set<string>>(new Set());\n  const [searchQuery, setSearchQuery] = useState('');\n  const [showSearchResults, setShowSearchResults] = useState(false);\n\n  // Get pending onboarding tasks for residents - tasks stay until completed\n  // Check for 'resident' role (case-insensitive) or tenant\n  const isResident = user?.role?.toLowerCase() === 'resident' || user?.role?.toLowerCase() === 'tenant';\n  // Check if user is tenant or commercial_owner (rental users - don't have access to requests)\n  const isRentalUser = user?.role === 'tenant' || user?.role === 'commercial_owner';\n  const pendingOnboardingTasks = isResident\n    ? ONBOARDING_TASKS.filter(task => !task.checkComplete(user, vehicles))\n    : [];\n\n  // Get unread announcements count\n  const userAnnouncements = isResident\n    ? getAnnouncementsForResidents(user?.login || '', user?.buildingId || '', user?.entrance || '', user?.floor || '', user?.branch || '')\n    : getAnnouncementsForEmployees();\n  const unreadAnnouncementsCount = userAnnouncements.filter(a => !a.viewedBy.includes(user?.id || '')).length;\n\n  // Get upcoming meetings count (meetings in next 7 days that user hasn't seen)\n  const nowDate = new Date();\n  const weekFromNow = new Date(nowDate.getTime() + 7 * 24 * 60 * 60 * 1000);\n  const upcomingMeetings = meetings.filter(m => {\n    if (!m.confirmedDateTime) return false;\n    const meetingDate = new Date(m.confirmedDateTime);\n    return meetingDate >= nowDate && meetingDate <= weekFromNow && m.status !== 'cancelled';\n  });\n  const unreadMeetingsCount = upcomingMeetings.length;\n\n  const handleTaskClick = (task: OnboardingTask) => {\n    setShowNotifications(false);\n    navigate(task.route);\n  };\n\n  // Update clock every second\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  // Check for upcoming scheduled requests (every minute)\n  useEffect(() => {\n    if (!user) return;\n\n    const checkUpcomingRequests = () => {\n      const currentUser = useAuthStore.getState().user;\n      const { requests: currentRequests, executors: currentExecutors, addNotification: notify } = useDataStore.getState();\n\n      if (!currentUser) return;\n\n      const now = new Date();\n      const tenMinutesLater = new Date(now.getTime() + 10 * 60 * 1000);\n      const fiveMinutesLater = new Date(now.getTime() + 5 * 60 * 1000);\n\n      // Get requests that are relevant to current user\n      const relevantRequests = currentRequests.filter(r => {\n        if (!r.scheduledDate || !r.scheduledTime) return false;\n        if (!['assigned', 'accepted'].includes(r.status)) return false;\n\n        // For executors - their assigned requests\n        if (currentUser.role === 'executor') {\n          const executor = currentExecutors.find(e => e.login === currentUser.login);\n          return r.executorId === executor?.id;\n        }\n        // For residents - their own requests\n        if (currentUser.role === 'resident') {\n          return r.residentId === currentUser.id;\n        }\n        return false;\n      });\n\n      relevantRequests.forEach(request => {\n        // Parse scheduled time (format: \"09:00-12:00\" or \"14:00\")\n        const timeStr = request.scheduledTime!;\n        const startTime = timeStr.split('-')[0]; // Take start time\n        const [hours, minutes] = startTime.split(':').map(Number);\n\n        const scheduledDateTime = new Date(request.scheduledDate!);\n        scheduledDateTime.setHours(hours, minutes, 0, 0);\n\n        const reminderKey = `${request.id}-10min`;\n        const reminder5Key = `${request.id}-5min`;\n\n        // 10-minute reminder\n        if (scheduledDateTime > now && scheduledDateTime <= tenMinutesLater && !sentRemindersRef.current.has(reminderKey)) {\n          const minutesUntil = Math.round((scheduledDateTime.getTime() - now.getTime()) / 60000);\n\n          notify({\n            userId: currentUser.id,\n            type: 'request_assigned',\n            title: `:  ${minutesUntil} `,\n            message: ` #${request.number} \"${request.title}\"   ${startTime}. ${request.address}, . ${request.apartment}`,\n            requestId: request.id,\n          });\n\n          sentRemindersRef.current.add(reminderKey);\n        }\n\n        // 5-minute reminder (more urgent)\n        if (scheduledDateTime > now && scheduledDateTime <= fiveMinutesLater && !sentRemindersRef.current.has(reminder5Key)) {\n          const minutesUntil = Math.round((scheduledDateTime.getTime() - now.getTime()) / 60000);\n\n          if (minutesUntil <= 5 && !sentRemindersRef.current.has(reminderKey)) {\n            notify({\n              userId: currentUser.id,\n              type: 'request_assigned',\n              title: `:  ${minutesUntil} !`,\n              message: ` #${request.number}   ${minutesUntil} ! : ${request.address}, . ${request.apartment}`,\n              requestId: request.id,\n            });\n          }\n\n          sentRemindersRef.current.add(reminder5Key);\n        }\n      });\n    };\n\n    // Check immediately and then every minute\n    checkUpcomingRequests();\n    const reminderTimer = setInterval(checkUpcomingRequests, 60000);\n    return () => clearInterval(reminderTimer);\n  }, [user?.id]);\n\n  const unreadCount = user ? getUnreadCount(user.id) : 0;\n  const totalBadgeCount = unreadCount + pendingOnboardingTasks.length + unreadAnnouncementsCount + unreadMeetingsCount;\n  const userNotifications = notifications.filter(n => n.userId === user?.id).slice(0, 10);\n\n  // Format current time\n  const formatCurrentTime = () => {\n    return currentTime.toLocaleTimeString('ru-RU', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit'\n    });\n  };\n\n  const formatCurrentDate = () => {\n    return currentTime.toLocaleDateString('ru-RU', {\n      weekday: 'short',\n      day: 'numeric',\n      month: 'short'\n    });\n  };\n\n  const getRoleLabel = () => {\n    switch (user?.role) {\n      case 'admin': return '';\n      case 'manager': return '';\n      case 'department_head': return `  ${SPECIALIZATION_LABELS[user?.specialization as ExecutorSpecialization] || ''}`.trim();\n      case 'executor': return SPECIALIZATION_LABELS[user?.specialization as ExecutorSpecialization] || '';\n      case 'resident': return '';\n      default: return '';\n    }\n  };\n\n  const formatTime = (dateStr: string) => {\n    const date = new Date(dateStr);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return ' ';\n    if (diffMins < 60) return `${diffMins}  `;\n    if (diffHours < 24) return `${diffHours}  `;\n    if (diffDays < 7) return `${diffDays}  `;\n    return date.toLocaleDateString('ru-RU');\n  };\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case 'request_created': return '';\n      case 'request_assigned': return '';\n      case 'request_accepted': return '';\n      case 'request_started': return '';\n      case 'request_completed': return '';\n      case 'request_approved': return '';\n      case 'request_rejected': return '';\n      case 'request_cancelled': return '';\n      case 'request_declined': return '';\n      default: return '';\n    }\n  };\n\n  // Search functionality\n  const searchResults = searchQuery.trim()\n    ? requests.filter(r =>\n        r.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        r.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        r.number.toString().includes(searchQuery) ||\n        r.residentName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        r.address.toLowerCase().includes(searchQuery.toLowerCase())\n      ).slice(0, 5)\n    : [];\n\n  // Handle clock click - navigate based on user role\n  const handleClockClick = () => {\n    if (user?.role === 'executor') {\n      // For executors - go to schedule view\n      navigate('/');\n      // Will need to trigger schedule view in ExecutorDashboard\n      window.dispatchEvent(new CustomEvent('openSchedule'));\n    } else if (user?.role === 'resident') {\n      // For residents - go to my requests\n      navigate('/');\n    } else {\n      // For managers/admins - go to requests page\n      navigate('/requests');\n    }\n  };\n\n  return (\n    <header className=\"h-16 glass-card rounded-none border-x-0 border-t-0 flex items-center justify-between px-6\">\n      <div className=\"flex items-center gap-4\">\n        {/* Hide search for rental users (tenant/commercial_owner) - they don't have requests */}\n        {!isRentalUser && (\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n          <input\n            type=\"text\"\n            placeholder=\" ...\"\n            value={searchQuery}\n            onChange={(e) => {\n              setSearchQuery(e.target.value);\n              setShowSearchResults(e.target.value.trim().length > 0);\n            }}\n            onFocus={() => searchQuery.trim() && setShowSearchResults(true)}\n            className=\"glass-input pl-10 w-64\"\n          />\n          {/* Search Results Dropdown */}\n          {showSearchResults && createPortal(\n            <div className=\"search-results-portal\">\n              <div\n                className=\"fixed inset-0\"\n                onClick={() => setShowSearchResults(false)}\n              />\n              <div\n                className=\"fixed left-[280px] top-14 w-96 bg-white rounded-xl border border-gray-200 shadow-xl overflow-hidden\"\n                style={{ zIndex: 10002 }}\n              >\n                {searchResults.length === 0 ? (\n                  <div className=\"p-4 text-center text-gray-500\">\n                    <Search className=\"w-8 h-8 mx-auto mb-2 text-gray-300\" />\n                    <p>  </p>\n                  </div>\n                ) : (\n                  <div>\n                    <div className=\"p-2 bg-gray-50 border-b text-xs text-gray-500\">\n                      : {searchResults.length} \n                    </div>\n                    {searchResults.map((request) => (\n                      <div\n                        key={request.id}\n                        onClick={() => {\n                          navigate('/requests');\n                          setShowSearchResults(false);\n                          setSearchQuery('');\n                        }}\n                        className=\"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0\"\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-gray-400\">#{request.number}</span>\n                          <span className=\"font-medium text-sm\">{request.title}</span>\n                        </div>\n                        <div className=\"text-xs text-gray-500 mt-1\">{request.address}, . {request.apartment}</div>\n                        <div className=\"flex items-center gap-2 mt-1\">\n                          <span className={`text-xs px-2 py-0.5 rounded-full ${\n                            request.status === 'new' ? 'bg-blue-100 text-blue-700' :\n                            request.status === 'in_progress' ? 'bg-amber-100 text-amber-700' :\n                            request.status === 'completed' ? 'bg-green-100 text-green-700' :\n                            'bg-gray-100 text-gray-700'\n                          }`}>\n                            {request.status === 'new' ? '' :\n                             request.status === 'in_progress' ? ' ' :\n                             request.status === 'completed' ? '' :\n                             request.status}\n                          </span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>,\n            document.body\n          )}\n        </div>\n        )}\n      </div>\n      <div className=\"flex items-center gap-4\">\n        {/* Current Time Clock - clickable */}\n        <button\n          onClick={handleClockClick}\n          className=\"flex items-center gap-2 px-3 py-1.5 bg-white/50 rounded-xl border border-white/30 hover:bg-white/70 transition-colors cursor-pointer\"\n          title=\"  \"\n        >\n          <Clock className=\"w-4 h-4 text-primary-600\" />\n          <div className=\"text-right\">\n            <div className=\"text-sm font-mono font-semibold text-gray-800\">{formatCurrentTime()}</div>\n            <div className=\"text-xs text-gray-500\">{formatCurrentDate()}</div>\n          </div>\n        </button>\n\n        {/* Notifications Button */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowNotifications(!showNotifications)}\n            className=\"p-2 hover:bg-white/30 rounded-lg relative\"\n          >\n            <Bell className=\"w-5 h-5 text-gray-600\" />\n            {totalBadgeCount > 0 && (\n              <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center\">\n                {totalBadgeCount > 9 ? '9+' : totalBadgeCount}\n              </span>\n            )}\n          </button>\n        </div>\n\n        <div className=\"text-right\">\n          <div className=\"text-sm font-medium\">{user?.name}</div>\n          <div className=\"text-xs text-gray-500\">{getRoleLabel()}</div>\n        </div>\n      </div>\n\n      {/* Notifications Portal - rendered at body level for proper z-index */}\n      {showNotifications && createPortal(\n        <div className=\"notifications-portal\">\n          {/* Backdrop */}\n          <div\n            className=\"fixed inset-0 bg-black/20\"\n            style={{ zIndex: 10000 }}\n            onClick={() => setShowNotifications(false)}\n          />\n          {/* Dropdown */}\n          <div\n            className=\"fixed right-6 top-20 w-96 bg-white rounded-2xl border border-gray-200 shadow-2xl overflow-hidden flex flex-col\"\n            style={{ zIndex: 10001, maxHeight: 'calc(100vh - 100px)' }}\n          >\n            {/* Header */}\n            <div className=\"p-4 border-b border-gray-200 flex items-center justify-between bg-gray-50\">\n              <h3 className=\"font-semibold text-lg\"></h3>\n              {unreadCount > 0 && (\n                <button\n                  onClick={() => user && markAllNotificationsAsRead(user.id)}\n                  className=\"text-sm text-blue-600 hover:text-blue-800\"\n                >\n                   \n                </button>\n              )}\n            </div>\n\n            {/* Onboarding Tasks for Residents */}\n            {pendingOnboardingTasks.length > 0 && (\n              <div className=\"border-b border-gray-200\">\n                <div className=\"px-4 py-2 bg-amber-50 border-b border-amber-100\">\n                  <p className=\"text-xs font-medium text-amber-700\"> </p>\n                </div>\n                {pendingOnboardingTasks.map((task) => (\n                  <div\n                    key={task.id}\n                    onClick={() => handleTaskClick(task)}\n                    className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex-shrink-0 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center\">\n                        {task.icon}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className=\"font-medium text-sm text-gray-900\">{task.title}</h4>\n                        <p className=\"text-xs text-gray-500 mt-0.5\">{task.description}</p>\n                      </div>\n                      <ChevronRight className=\"w-4 h-4 text-gray-400 flex-shrink-0\" />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Announcements Section */}\n            {unreadAnnouncementsCount > 0 && (\n              <div className=\"border-b border-gray-200\">\n                <div className=\"px-4 py-2 bg-blue-50 border-b border-blue-100\">\n                  <p className=\"text-xs font-medium text-blue-700 flex items-center gap-1\">\n                    <Megaphone className=\"w-3 h-3\" />\n                     ({unreadAnnouncementsCount})\n                  </p>\n                </div>\n                {userAnnouncements.filter(a => !a.viewedBy.includes(user?.id || '')).slice(0, 3).map((announcement) => (\n                  <div\n                    key={announcement.id}\n                    onClick={() => {\n                      setShowNotifications(false);\n                      navigate(isResident ? '/announcements' : '/staff/announcements');\n                    }}\n                    className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 bg-blue-50/50\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                        <Megaphone className=\"w-5 h-5 text-blue-600\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className=\"font-medium text-sm text-gray-900 truncate\">{announcement.title}</h4>\n                        <p className=\"text-xs text-gray-500 mt-0.5 line-clamp-1\">{announcement.content}</p>\n                      </div>\n                      <span className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0\" />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Meetings Section */}\n            {unreadMeetingsCount > 0 && (\n              <div className=\"border-b border-gray-200\">\n                <div className=\"px-4 py-2 bg-purple-50 border-b border-purple-100\">\n                  <p className=\"text-xs font-medium text-purple-700 flex items-center gap-1\">\n                    <Users className=\"w-3 h-3\" />\n                     ({unreadMeetingsCount})\n                  </p>\n                </div>\n                {upcomingMeetings.slice(0, 3).map((meeting) => (\n                  <div\n                    key={meeting.id}\n                    onClick={() => {\n                      setShowNotifications(false);\n                      navigate(isResident ? '/meetings' : '/staff/meetings');\n                    }}\n                    className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 bg-purple-50/50\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center\">\n                        <Users className=\"w-5 h-5 text-purple-600\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className=\"font-medium text-sm text-gray-900 truncate\">\n                            {meeting.buildingAddress}\n                        </h4>\n                        <p className=\"text-xs text-gray-500 mt-0.5\">\n                          {meeting.confirmedDateTime ? new Date(meeting.confirmedDateTime).toLocaleDateString('ru-RU', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' }) : ' '}\n                        </p>\n                      </div>\n                      <span className=\"w-2 h-2 bg-purple-500 rounded-full flex-shrink-0\" />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Notifications List */}\n            <div className=\"overflow-y-auto flex-1\" style={{ maxHeight: '400px' }}>\n              {userNotifications.length === 0 && pendingOnboardingTasks.length === 0 && unreadAnnouncementsCount === 0 && unreadMeetingsCount === 0 ? (\n                <div className=\"p-8 text-center text-gray-500\">\n                  <Bell className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n                  <p> </p>\n                </div>\n              ) : userNotifications.length === 0 ? (\n                null\n              ) : (\n                userNotifications.map((notification) => (\n                  <div\n                    key={notification.id}\n                    onClick={() => {\n                      if (!notification.read) {\n                        markNotificationAsRead(notification.id);\n                      }\n                    }}\n                    className={`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors ${\n                      !notification.read ? 'bg-blue-50' : 'bg-white'\n                    }`}\n                  >\n                    <div className=\"flex gap-3\">\n                      <span className=\"text-2xl flex-shrink-0\">{getNotificationIcon(notification.type)}</span>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <h4 className={`font-medium text-sm ${!notification.read ? 'text-gray-900' : 'text-gray-600'}`}>\n                            {notification.title}\n                          </h4>\n                          {!notification.read && (\n                            <span className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-1.5\" />\n                          )}\n                        </div>\n                        <p className=\"text-sm text-gray-500 mt-0.5 line-clamp-2\">\n                          {notification.message}\n                        </p>\n                        <p className=\"text-xs text-gray-400 mt-1\">\n                          {formatTime(notification.createdAt)}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n\n            {/* Footer */}\n            {userNotifications.length > 0 && (\n              <div className=\"p-3 border-t border-gray-200 bg-gray-50\">\n                <button\n                  onClick={() => setShowNotifications(false)}\n                  className=\"w-full text-center text-sm text-gray-600 hover:text-gray-900\"\n                >\n                  \n                </button>\n              </div>\n            )}\n          </div>\n        </div>,\n        document.body\n      )}\n    </header>\n  );\n}\n","import { useState, useEffect, useCallback, useRef } from 'react';\nimport { useAuthStore } from '../stores/authStore';\nimport { useDataStore } from '../stores/dataStore';\nimport type { PopupType } from '../components/PopupNotification';\n\nexport interface PopupItem {\n  id: string;\n  type: PopupType;\n  title: string;\n  message: string;\n  actionLabel?: string;\n  onAction?: () => void;\n}\n\n// Store shown popup IDs in sessionStorage to persist across re-renders but not page reloads\nconst getShownIds = (): Set<string> => {\n  try {\n    const stored = sessionStorage.getItem('shown_popup_ids');\n    return stored ? new Set(JSON.parse(stored)) : new Set();\n  } catch {\n    return new Set();\n  }\n};\n\nconst saveShownId = (id: string) => {\n  try {\n    const shown = getShownIds();\n    shown.add(id);\n    sessionStorage.setItem('shown_popup_ids', JSON.stringify([...shown]));\n  } catch {\n    // Ignore\n  }\n};\n\nexport function usePopupNotifications() {\n  const { user } = useAuthStore();\n  const {\n    announcements,\n    getAnnouncementsForResidents,\n    markAnnouncementAsViewed,\n    requests,\n  } = useDataStore();\n\n  const [popups, setPopups] = useState<PopupItem[]>([]);\n  const processedRef = useRef(false);\n\n  // Check for new urgent announcements (for residents)\n  useEffect(() => {\n    // Only run once per mount\n    if (processedRef.current) return;\n\n    if (!user || user.role !== 'resident') {\n      return;\n    }\n\n    console.log('[PopupNotifications] Checking for resident:', user.login);\n    console.log('[PopupNotifications] All announcements:', announcements.length);\n\n    // Get announcements for this resident\n    const relevantAnnouncements = getAnnouncementsForResidents(\n      user.login,\n      user.buildingId,\n      user.entrance,\n      user.floor,\n      user.branch\n    );\n\n    console.log('[PopupNotifications] Relevant announcements:', relevantAnnouncements.length);\n\n    const shownIds = getShownIds();\n\n    // Filter important/urgent announcements not yet shown\n    const urgentAnnouncements = relevantAnnouncements.filter(a => {\n      const isUrgent = a.priority === 'urgent' || a.priority === 'important';\n      const notViewed = !a.viewedBy.includes(user.id);\n      const notShown = !shownIds.has(`announcement-${a.id}`);\n      console.log(`[PopupNotifications] Announcement \"${a.title}\": urgent=${isUrgent}, notViewed=${notViewed}, notShown=${notShown}`);\n      return isUrgent && notViewed && notShown;\n    });\n\n    console.log('[PopupNotifications] Urgent to show:', urgentAnnouncements.length);\n\n    // Create popups for new announcements\n    const newPopups: PopupItem[] = urgentAnnouncements.map(a => {\n      const isMeeting = /|||/i.test(a.title + ' ' + a.content);\n\n      saveShownId(`announcement-${a.id}`);\n\n      return {\n        id: `announcement-${a.id}`,\n        type: isMeeting ? 'announcement_meeting' : 'announcement_urgent',\n        title: a.title,\n        message: a.content.length > 200 ? a.content.substring(0, 200) + '...' : a.content,\n        actionLabel: '',\n        onAction: () => {\n          markAnnouncementAsViewed(a.id, user.id);\n        },\n      };\n    });\n\n    if (newPopups.length > 0) {\n      console.log('[PopupNotifications] Adding popups:', newPopups);\n      setPopups(prev => [...prev, ...newPopups]);\n    }\n\n    processedRef.current = true;\n  }, [user, announcements, getAnnouncementsForResidents, markAnnouncementAsViewed]);\n\n  // Check for requests pending approval (for residents)\n  useEffect(() => {\n    if (!user || user.role !== 'resident') {\n      return;\n    }\n\n    const shownIds = getShownIds();\n\n    // Find requests that are pending approval for this resident\n    const pendingApproval = requests.filter(r =>\n      r.residentId === user.id &&\n      r.status === 'pending_approval' &&\n      !shownIds.has(`request-completed-${r.id}`)\n    );\n\n    console.log('[PopupNotifications] Pending approval requests:', pendingApproval.length);\n\n    const newPopups: PopupItem[] = pendingApproval.map(r => {\n      saveShownId(`request-completed-${r.id}`);\n\n      return {\n        id: `request-completed-${r.id}`,\n        type: 'request_completed' as PopupType,\n        title: ' !',\n        message: ` ${r.number}: ${r.executorName || ''}  . ,     .`,\n        actionLabel: ' ',\n        onAction: () => {\n          // Store request ID to open rating modal directly\n          sessionStorage.setItem('open_rating_for_request', r.id);\n          // Navigate to home page where ResidentDashboard is mounted\n          // ResidentDashboard will check sessionStorage on mount/update\n          if (window.location.pathname !== '/') {\n            window.location.href = '/';\n          } else {\n            // Already on home page, dispatch event\n            window.dispatchEvent(new CustomEvent('openRatingModal', { detail: { requestId: r.id } }));\n          }\n        },\n      };\n    });\n\n    if (newPopups.length > 0) {\n      console.log('[PopupNotifications] Adding request popups:', newPopups);\n      setPopups(prev => [...prev, ...newPopups]);\n    }\n  }, [user, requests]);\n\n  const dismissPopup = useCallback((id: string) => {\n    setPopups(prev => prev.filter(p => p.id !== id));\n  }, []);\n\n  const addPopup = useCallback((popup: Omit<PopupItem, 'id'>) => {\n    const id = `custom-${Date.now()}`;\n    setPopups(prev => [...prev, { ...popup, id }]);\n  }, []);\n\n  return {\n    popups,\n    dismissPopup,\n    addPopup,\n  };\n}\n","import { useEffect, useRef, useCallback } from 'react';\nimport { useAuthStore } from '../stores/authStore';\nimport { useDataStore } from '../stores/dataStore';\nimport { useMeetingStore } from '../stores/meetingStore';\nimport { pushNotifications } from '../services/pushNotifications';\n\n// Global event emitter for chat messages\ntype ChatMessageListener = (message: any) => void;\nconst chatListeners: Set<ChatMessageListener> = new Set();\n\nexport function subscribeToChatMessages(listener: ChatMessageListener) {\n  chatListeners.add(listener);\n  return () => chatListeners.delete(listener);\n}\n\nfunction emitChatMessage(message: any) {\n  chatListeners.forEach(listener => listener(message));\n}\n\n// Global event emitter for reschedule updates\ntype RescheduleListener = (reschedule: any) => void;\nconst rescheduleListeners: Set<RescheduleListener> = new Set();\n\nexport function subscribeToRescheduleUpdates(listener: RescheduleListener) {\n  rescheduleListeners.add(listener);\n  return () => rescheduleListeners.delete(listener);\n}\n\nfunction emitRescheduleUpdate(reschedule: any) {\n  rescheduleListeners.forEach(listener => listener(reschedule));\n}\n\n/**\n * WebSocket hook  real-time  \n *  SSE   \n *\n * :\n * -   (  )\n * - Durable Objects   \n * - 99.99%    D1 (6 polls/min  60,000)\n * -    polling  \n * -    exponential backoff\n */\nexport function useWebSocketSync() {\n  const { user, token } = useAuthStore();\n  const { fetchRequests, fetchExecutors, fetchAnnouncements, fetchPendingReschedules } = useDataStore();\n  const { fetchMeetings } = useMeetingStore();\n\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const reconnectAttempts = useRef(0);\n  const heartbeatIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const lastSyncRef = useRef<number>(0);\n\n  const MAX_RECONNECT_ATTEMPTS = 10;\n  const SYNC_DEBOUNCE = 500; // Debounce sync calls\n  const HEARTBEAT_INTERVAL = 30000; // 30 seconds\n\n  const syncData = useCallback(async () => {\n    if (!user) return;\n\n    // Debounce: prevent multiple syncs in quick succession\n    const now = Date.now();\n    if (now - lastSyncRef.current < SYNC_DEBOUNCE) {\n      return;\n    }\n    lastSyncRef.current = now;\n\n    try {\n      // Parallel fetch for speed\n      const promises: Promise<void>[] = [fetchRequests()];\n\n      if (['manager', 'admin', 'director', 'dispatcher', 'department_head'].includes(user.role)) {\n        promises.push(fetchExecutors());\n      }\n\n      await Promise.all(promises);\n    } catch (error) {\n      console.error('[WS] Error syncing data:', error);\n    }\n  }, [user, fetchRequests, fetchExecutors]);\n\n  const syncMeetings = useCallback(async () => {\n    if (!user) return;\n    try {\n      console.log('[WS] Syncing meetings...');\n      await fetchMeetings();\n    } catch (error) {\n      console.error('[WS] Error syncing meetings:', error);\n    }\n  }, [user, fetchMeetings]);\n\n  const startHeartbeat = useCallback(() => {\n    if (heartbeatIntervalRef.current) {\n      clearInterval(heartbeatIntervalRef.current);\n    }\n\n    heartbeatIntervalRef.current = setInterval(() => {\n      if (wsRef.current?.readyState === WebSocket.OPEN) {\n        console.log('[WS] Sending heartbeat...');\n        wsRef.current.send(JSON.stringify({ type: 'ping' }));\n      }\n    }, HEARTBEAT_INTERVAL);\n  }, []);\n\n  const stopHeartbeat = useCallback(() => {\n    if (heartbeatIntervalRef.current) {\n      clearInterval(heartbeatIntervalRef.current);\n      heartbeatIntervalRef.current = null;\n    }\n  }, []);\n\n  const connect = useCallback(() => {\n    if (!user || !token) return;\n\n    // Close existing connection\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n\n    console.log('[WS] Connecting...');\n\n    // Determine protocol (ws:// or wss://)\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/api/ws?token=${token}`;\n\n    try {\n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log('[WS] Connected');\n        reconnectAttempts.current = 0;\n        startHeartbeat();\n      };\n\n      ws.onmessage = async (event) => {\n        try {\n          const message = JSON.parse(event.data);\n          console.log('[WS] Received:', message.type);\n\n          switch (message.type) {\n            case 'connected':\n              console.log('[WS] Connection confirmed:', message.data);\n              // Initial sync\n              await syncData();\n              await syncMeetings();\n              break;\n\n            case 'pong':\n              // Heartbeat response - connection is alive\n              break;\n\n            case 'request_update':\n              console.log('[WS] Requests updated');\n              await syncData();\n              break;\n\n            case 'meeting_update':\n              console.log('[WS] Meetings updated');\n              await syncMeetings();\n\n              // Show push notification for new/updated meetings\n              if (message.data?.meetings && message.data.meetings.length > 0) {\n                const activeMeeting = message.data.meetings.find((m: any) =>\n                  m.status === 'voting_open' || m.status === 'schedule_poll_open'\n                );\n                if (activeMeeting) {\n                  await pushNotifications.show({\n                    title: '  ',\n                    body: activeMeeting.status === 'voting_open'\n                      ? ' !    .'\n                      : '  .   .',\n                    tag: `meeting-${activeMeeting.id}`,\n                    requireInteraction: true,\n                    data: { url: '/meetings' }\n                  });\n                }\n              }\n              break;\n\n            case 'announcement_update':\n              console.log('[WS] Announcements updated, fetching new data');\n              await fetchAnnouncements();\n              break;\n\n            case 'chat_message':\n              console.log('[WS] New chat message received');\n              emitChatMessage(message.data?.message || message.data);\n              break;\n\n            case 'chat_read':\n              console.log('[WS] Chat read receipt received');\n              emitChatMessage({ type: 'read', ...message.data });\n              break;\n\n            case 'executor_update':\n              console.log('[WS] Executors updated');\n              if (['manager', 'admin', 'director', 'dispatcher', 'department_head'].includes(user.role)) {\n                await fetchExecutors();\n              }\n              break;\n\n            case 'reschedule_update':\n              console.log('[WS] Reschedule update received');\n              await fetchPendingReschedules();\n              if (message.data?.reschedule) {\n                emitRescheduleUpdate(message.data.reschedule);\n              }\n              break;\n\n            default:\n              console.warn('[WS] Unknown message type:', message.type);\n          }\n        } catch (error) {\n          console.error('[WS] Error processing message:', error);\n        }\n      };\n\n      ws.onerror = (error) => {\n        console.error('[WS] Error:', error);\n      };\n\n      ws.onclose = (event) => {\n        console.log('[WS] Connection closed:', event.code, event.reason);\n        stopHeartbeat();\n        wsRef.current = null;\n\n        // Attempt reconnect with exponential backoff\n        if (reconnectAttempts.current < MAX_RECONNECT_ATTEMPTS) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 30000);\n          console.log(`[WS] Reconnecting in ${delay}ms (attempt ${reconnectAttempts.current + 1})`);\n\n          reconnectTimeoutRef.current = setTimeout(() => {\n            reconnectAttempts.current++;\n            connect();\n          }, delay);\n        } else {\n          console.error('[WS] Max reconnect attempts reached');\n          // Could fallback to polling here if needed\n        }\n      };\n    } catch (error) {\n      console.error('[WS] Failed to create WebSocket:', error);\n    }\n  }, [user, token, syncData, syncMeetings, startHeartbeat, stopHeartbeat, fetchPendingReschedules]);\n\n  useEffect(() => {\n    if (!user || !token) {\n      // Cleanup on logout\n      if (wsRef.current) {\n        wsRef.current.close();\n        wsRef.current = null;\n      }\n      stopHeartbeat();\n      return;\n    }\n\n    // Initial data fetch\n    syncData();\n    syncMeetings();\n\n    // Connect via WebSocket\n    connect();\n\n    // Cleanup on unmount\n    return () => {\n      if (wsRef.current) {\n        wsRef.current.close();\n        wsRef.current = null;\n      }\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      stopHeartbeat();\n    };\n  }, [user, token, connect, syncData, syncMeetings, stopHeartbeat]);\n\n  // Handle visibility change - reconnect if disconnected\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (!document.hidden) {\n        // Tab became visible - sync data\n        syncData();\n        syncMeetings();\n\n        // Reconnect WebSocket if disconnected\n        if (!wsRef.current || wsRef.current.readyState === WebSocket.CLOSED) {\n          reconnectAttempts.current = 0;\n          connect();\n        }\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [connect, syncData, syncMeetings]);\n\n  // Manual refresh function\n  const refresh = useCallback(() => {\n    syncData();\n    syncMeetings();\n  }, [syncData, syncMeetings]);\n\n  return { refresh };\n}\n","import { useState, useEffect } from 'react';\nimport { X, Bell, AlertTriangle, Users, CheckCircle } from 'lucide-react';\n\nexport type PopupType =\n  | 'announcement_urgent'    //  \n  | 'announcement_meeting'   //  \n  | 'request_completed'      //   - \n  | 'info';                  //  \n\ninterface PopupNotificationProps {\n  type: PopupType;\n  title: string;\n  message: string;\n  onClose: () => void;\n  onAction?: () => void;\n  actionLabel?: string;\n  autoClose?: number; // ms, 0 = don't auto close\n}\n\nexport function PopupNotification({\n  type,\n  title,\n  message,\n  onClose,\n  onAction,\n  actionLabel,\n  autoClose = 0,\n}: PopupNotificationProps) {\n  const [isClosing, setIsClosing] = useState(false);\n\n  useEffect(() => {\n    if (autoClose > 0) {\n      const timer = setTimeout(() => handleClose(), autoClose);\n      return () => clearTimeout(timer);\n    }\n  }, [autoClose]);\n\n  const handleClose = () => {\n    setIsClosing(true);\n    setTimeout(() => onClose(), 300);\n  };\n\n  const handleAction = () => {\n    if (onAction) {\n      onAction();\n    }\n    handleClose();\n  };\n\n  const getIcon = () => {\n    switch (type) {\n      case 'announcement_urgent':\n        return <AlertTriangle className=\"w-8 h-8 text-red-500\" />;\n      case 'announcement_meeting':\n        return <Users className=\"w-8 h-8 text-blue-500\" />;\n      case 'request_completed':\n        return <CheckCircle className=\"w-8 h-8 text-green-500\" />;\n      default:\n        return <Bell className=\"w-8 h-8 text-yellow-500\" />;\n    }\n  };\n\n  const getBgColor = () => {\n    switch (type) {\n      case 'announcement_urgent':\n        return 'bg-gradient-to-br from-red-50 to-orange-50 border-red-200';\n      case 'announcement_meeting':\n        return 'bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200';\n      case 'request_completed':\n        return 'bg-gradient-to-br from-green-50 to-emerald-50 border-green-200';\n      default:\n        return 'bg-gradient-to-br from-yellow-50 to-amber-50 border-yellow-200';\n    }\n  };\n\n  const getActionBtnColor = () => {\n    switch (type) {\n      case 'announcement_urgent':\n        return 'bg-red-500 hover:bg-red-600 text-white';\n      case 'announcement_meeting':\n        return 'bg-blue-500 hover:bg-blue-600 text-white';\n      case 'request_completed':\n        return 'bg-green-500 hover:bg-green-600 text-white';\n      default:\n        return 'bg-yellow-400 hover:bg-yellow-500 text-black';\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\n      <div\n        className={`\n          relative w-full max-w-sm rounded-2xl border-2 shadow-2xl p-6\n          ${getBgColor()}\n          ${isClosing ? 'animate-out zoom-out-95 fade-out duration-300' : 'animate-in zoom-in-95 fade-in duration-300'}\n        `}\n      >\n        {/* Close button */}\n        <button\n          onClick={handleClose}\n          className=\"absolute top-3 right-3 p-2 rounded-full hover:bg-black/10 transition-colors\"\n        >\n          <X className=\"w-5 h-5 text-gray-500\" />\n        </button>\n\n        {/* Icon */}\n        <div className=\"flex justify-center mb-4\">\n          <div className=\"w-16 h-16 rounded-full bg-white shadow-lg flex items-center justify-center\">\n            {getIcon()}\n          </div>\n        </div>\n\n        {/* Title */}\n        <h3 className=\"text-xl font-bold text-center text-gray-900 mb-2\">\n          {title}\n        </h3>\n\n        {/* Message */}\n        <p className=\"text-center text-gray-600 mb-6 leading-relaxed\">\n          {message}\n        </p>\n\n        {/* Actions */}\n        <div className=\"flex flex-col gap-2\">\n          {onAction && actionLabel && (\n            <button\n              onClick={handleAction}\n              className={`w-full py-3 px-4 rounded-xl font-semibold transition-colors ${getActionBtnColor()}`}\n            >\n              {actionLabel}\n            </button>\n          )}\n          <button\n            onClick={handleClose}\n            className=\"w-full py-3 px-4 rounded-xl font-medium text-gray-600 hover:bg-black/5 transition-colors\"\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Manager for multiple popups (queue)\ninterface PopupItem {\n  id: string;\n  type: PopupType;\n  title: string;\n  message: string;\n  actionLabel?: string;\n  onAction?: () => void;\n}\n\ninterface PopupManagerProps {\n  popups: PopupItem[];\n  onDismiss: (id: string) => void;\n}\n\nexport function PopupManager({ popups, onDismiss }: PopupManagerProps) {\n  const currentPopup = popups[0]; // Show one at a time\n\n  if (!currentPopup) return null;\n\n  return (\n    <PopupNotification\n      type={currentPopup.type}\n      title={currentPopup.title}\n      message={currentPopup.message}\n      actionLabel={currentPopup.actionLabel}\n      onAction={currentPopup.onAction}\n      onClose={() => onDismiss(currentPopup.id)}\n    />\n  );\n}\n","import { memo, useEffect, useState } from 'react';\nimport { AlertCircle, CheckCircle, Clock, TrendingUp, Zap } from 'lucide-react';\n\ninterface PerformanceStats {\n  fps: number;\n  memory: number;\n  renderTime: number;\n  apiLatency: number;\n}\n\ninterface PerformanceMonitorProps {\n  enabled?: boolean;\n  position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\n}\n\n/**\n * Real-time Performance Monitor Component\n *\n * Displays live performance metrics in development mode:\n * - FPS (frames per second)\n * - Memory usage\n * - Render time\n * - API latency\n *\n * Only visible in development or when explicitly enabled\n */\nexport const PerformanceMonitor = memo<PerformanceMonitorProps>(\n  ({ enabled = import.meta.env.DEV, position = 'bottom-right' }) => {\n    const [stats, setStats] = useState<PerformanceStats>({\n      fps: 60,\n      memory: 0,\n      renderTime: 0,\n      apiLatency: 0,\n    });\n    const [isExpanded, setIsExpanded] = useState(false);\n\n    useEffect(() => {\n      if (!enabled) return;\n\n      // FPS measurement\n      let frameCount = 0;\n      let lastTime = performance.now();\n      let animationFrameId: number;\n\n      const measureFPS = () => {\n        frameCount++;\n        const currentTime = performance.now();\n\n        if (currentTime >= lastTime + 1000) {\n          const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));\n          frameCount = 0;\n          lastTime = currentTime;\n\n          setStats(prev => ({ ...prev, fps }));\n        }\n\n        animationFrameId = requestAnimationFrame(measureFPS);\n      };\n\n      animationFrameId = requestAnimationFrame(measureFPS);\n\n      // Memory measurement (if available)\n      const memoryInterval = setInterval(() => {\n        if ('memory' in performance) {\n          const mem = (performance as any).memory;\n          const usedMB = Math.round(mem.usedJSHeapSize / 1024 / 1024);\n          setStats(prev => ({ ...prev, memory: usedMB }));\n        }\n      }, 1000);\n\n      // Render time from custom performance monitor\n      const renderInterval = setInterval(() => {\n        if ((window as any).perfMonitor) {\n          const averages = (window as any).perfMonitor.getAverages();\n          const renderMetrics = averages.filter((m: any) => m.name.startsWith('render:'));\n\n          if (renderMetrics.length > 0) {\n            const avgRenderTime = renderMetrics.reduce((sum: number, m: any) => sum + m.avg, 0) / renderMetrics.length;\n            setStats(prev => ({ ...prev, renderTime: Math.round(avgRenderTime) }));\n          }\n        }\n      }, 2000);\n\n      // API latency measurement\n      const originalFetch = window.fetch;\n      let apiLatencies: number[] = [];\n\n      window.fetch = async (...args) => {\n        const startTime = performance.now();\n        const response = await originalFetch(...args);\n        const duration = performance.now() - startTime;\n\n        // Only track API calls\n        if (typeof args[0] === 'string' && args[0].includes('/api/')) {\n          apiLatencies.push(duration);\n          if (apiLatencies.length > 10) apiLatencies = apiLatencies.slice(-10);\n\n          const avgLatency = apiLatencies.reduce((sum, l) => sum + l, 0) / apiLatencies.length;\n          setStats(prev => ({ ...prev, apiLatency: Math.round(avgLatency) }));\n        }\n\n        return response;\n      };\n\n      return () => {\n        cancelAnimationFrame(animationFrameId);\n        clearInterval(memoryInterval);\n        clearInterval(renderInterval);\n        window.fetch = originalFetch;\n      };\n    }, [enabled]);\n\n    if (!enabled) return null;\n\n    const positionClasses = {\n      'top-left': 'top-4 left-4',\n      'top-right': 'top-4 right-4',\n      'bottom-left': 'bottom-4 left-4',\n      'bottom-right': 'bottom-4 right-4',\n    };\n\n    const getStatusColor = (metric: keyof PerformanceStats, value: number): string => {\n      const thresholds = {\n        fps: { good: 55, warning: 30 },\n        memory: { good: 100, warning: 150 },\n        renderTime: { good: 50, warning: 100 },\n        apiLatency: { good: 200, warning: 500 },\n      };\n\n      const threshold = thresholds[metric];\n      if (metric === 'fps') {\n        // Higher is better for FPS\n        if (value >= threshold.good) return 'text-green-500';\n        if (value >= threshold.warning) return 'text-yellow-500';\n        return 'text-red-500';\n      } else {\n        // Lower is better for other metrics\n        if (value <= threshold.good) return 'text-green-500';\n        if (value <= threshold.warning) return 'text-yellow-500';\n        return 'text-red-500';\n      }\n    };\n\n    return (\n      <div\n        className={`fixed ${positionClasses[position]} z-50 bg-gray-900/95 backdrop-blur-sm rounded-lg shadow-2xl border border-gray-700 transition-all duration-200 ${\n          isExpanded ? 'w-64' : 'w-12 h-12'\n        }`}\n      >\n        {/* Toggle button */}\n        <button\n          onClick={() => setIsExpanded(!isExpanded)}\n          className=\"w-full h-12 flex items-center justify-center text-gray-400 hover:text-white transition-colors\"\n          title=\"Performance Monitor\"\n        >\n          <Zap className=\"w-5 h-5\" />\n        </button>\n\n        {/* Expanded metrics */}\n        {isExpanded && (\n          <div className=\"px-3 pb-3 space-y-2 text-xs\">\n            {/* FPS */}\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Zap className=\"w-4 h-4 text-purple-400\" />\n                <span className=\"text-gray-400\">FPS</span>\n              </div>\n              <span className={`font-mono font-bold ${getStatusColor('fps', stats.fps)}`}>\n                {stats.fps}\n              </span>\n            </div>\n\n            {/* Memory */}\n            {stats.memory > 0 && (\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <TrendingUp className=\"w-4 h-4 text-blue-400\" />\n                  <span className=\"text-gray-400\">Memory</span>\n                </div>\n                <span className={`font-mono font-bold ${getStatusColor('memory', stats.memory)}`}>\n                  {stats.memory} MB\n                </span>\n              </div>\n            )}\n\n            {/* Render Time */}\n            {stats.renderTime > 0 && (\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"w-4 h-4 text-green-400\" />\n                  <span className=\"text-gray-400\">Render</span>\n                </div>\n                <span className={`font-mono font-bold ${getStatusColor('renderTime', stats.renderTime)}`}>\n                  {stats.renderTime} ms\n                </span>\n              </div>\n            )}\n\n            {/* API Latency */}\n            {stats.apiLatency > 0 && (\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Zap className=\"w-4 h-4 text-yellow-400\" />\n                  <span className=\"text-gray-400\">API</span>\n                </div>\n                <span className={`font-mono font-bold ${getStatusColor('apiLatency', stats.apiLatency)}`}>\n                  {stats.apiLatency} ms\n                </span>\n              </div>\n            )}\n\n            {/* Overall status */}\n            <div className=\"pt-2 border-t border-gray-700\">\n              <div className=\"flex items-center gap-2\">\n                {stats.fps >= 55 && stats.renderTime <= 50 && stats.apiLatency <= 200 ? (\n                  <>\n                    <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                    <span className=\"text-green-500 font-medium\">Excellent</span>\n                  </>\n                ) : stats.fps >= 30 && stats.renderTime <= 100 && stats.apiLatency <= 500 ? (\n                  <>\n                    <AlertCircle className=\"w-4 h-4 text-yellow-500\" />\n                    <span className=\"text-yellow-500 font-medium\">Good</span>\n                  </>\n                ) : (\n                  <>\n                    <AlertCircle className=\"w-4 h-4 text-red-500\" />\n                    <span className=\"text-red-500 font-medium\">Poor</span>\n                  </>\n                )}\n              </div>\n            </div>\n\n            {/* Actions */}\n            <div className=\"pt-2 border-t border-gray-700 flex gap-2\">\n              <button\n                onClick={() => {\n                  if ((window as any).perfReport) {\n                    const report = (window as any).perfReport();\n                    console.log('Performance Report:', report);\n                  }\n                }}\n                className=\"flex-1 px-2 py-1 bg-gray-800 hover:bg-gray-700 rounded text-gray-300 hover:text-white transition-colors\"\n              >\n                Report\n              </button>\n              <button\n                onClick={() => {\n                  if ((window as any).perfMonitor) {\n                    (window as any).perfMonitor.clear();\n                  }\n                }}\n                className=\"flex-1 px-2 py-1 bg-gray-800 hover:bg-gray-700 rounded text-gray-300 hover:text-white transition-colors\"\n              >\n                Clear\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nPerformanceMonitor.displayName = 'PerformanceMonitor';\n","import { useState, useEffect, lazy, Suspense } from 'react';\nimport { Routes, Route, useLocation } from 'react-router-dom';\nimport { useAuthStore } from '../../stores/authStore';\nimport { useDataStore } from '../../stores/dataStore';\nimport { usePopupNotifications } from '../../hooks/usePopupNotifications';\nimport { useWebSocketSync } from '../../hooks/useWebSocketSync';\nimport { Sidebar } from './Sidebar';\nimport { Header } from './Header';\nimport { MobileHeader } from './MobileHeader';\nimport { PopupManager } from '../PopupNotification';\nimport { PerformanceMonitor } from '../PerformanceMonitor';\nimport { Loader2 } from 'lucide-react';\n\n// Page loading fallback\nconst PageLoader = () => (\n  <div className=\"flex items-center justify-center h-64\">\n    <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n  </div>\n);\n\n// Lazy loaded pages - code splitting for optimal bundle size\nconst ManagerDashboard = lazy(() => import('../../pages/ManagerDashboard').then(m => ({ default: m.ManagerDashboard })));\nconst DepartmentHeadDashboard = lazy(() => import('../../pages/DepartmentHeadDashboard').then(m => ({ default: m.DepartmentHeadDashboard })));\nconst ExecutorDashboard = lazy(() => import('../../pages/ExecutorDashboard').then(m => ({ default: m.ExecutorDashboard })));\nconst ExecutorSchedulePage = lazy(() => import('../../pages/ExecutorSchedulePage').then(m => ({ default: m.ExecutorSchedulePage })));\nconst ExecutorStatsPage = lazy(() => import('../../pages/ExecutorStatsPage').then(m => ({ default: m.ExecutorStatsPage })));\nconst ExecutorAnnouncementsPage = lazy(() => import('../../pages/ExecutorAnnouncementsPage').then(m => ({ default: m.ExecutorAnnouncementsPage })));\nconst ResidentDashboard = lazy(() => import('../../pages/ResidentDashboard').then(m => ({ default: m.ResidentDashboard })));\nconst AdminDashboard = lazy(() => import('../../pages/AdminDashboard').then(m => ({ default: m.AdminDashboard })));\nconst DirectorDashboard = lazy(() => import('../../pages/DirectorDashboard').then(m => ({ default: m.DirectorDashboard })));\nconst BuildingsPage = lazy(() => import('../../pages/BuildingsPage').then(m => ({ default: m.BuildingsPage })));\nconst AnnouncementsPage = lazy(() => import('../../pages/AnnouncementsPage').then(m => ({ default: m.AnnouncementsPage })));\nconst MeetingsPage = lazy(() => import('../../pages/MeetingsPage').then(m => ({ default: m.MeetingsPage })));\nconst ResidentAnnouncementsPage = lazy(() => import('../../pages/ResidentAnnouncementsPage').then(m => ({ default: m.ResidentAnnouncementsPage })));\nconst ResidentMeetingsPage = lazy(() => import('../../pages/ResidentMeetingsPage').then(m => ({ default: m.ResidentMeetingsPage })));\nconst ResidentRateEmployeesPage = lazy(() => import('../../pages/ResidentRateEmployeesPage').then(m => ({ default: m.ResidentRateEmployeesPage })));\nconst WorkOrdersPage = lazy(() => import('../../pages/WorkOrdersPage').then(m => ({ default: m.WorkOrdersPage })));\nconst TrainingsPage = lazy(() => import('../../pages/TrainingsPage'));\nconst ColleaguesSection = lazy(() => import('../../pages/ColleaguesSection').then(m => ({ default: m.ColleaguesSection })));\nconst ResidentVehiclesPage = lazy(() => import('../../pages/ResidentVehiclesPage').then(m => ({ default: m.ResidentVehiclesPage })));\nconst VehicleSearchPage = lazy(() => import('../../pages/VehicleSearchPage').then(m => ({ default: m.VehicleSearchPage })));\nconst ResidentGuestAccessPage = lazy(() => import('../../pages/ResidentGuestAccessPage').then(m => ({ default: m.ResidentGuestAccessPage })));\nconst GuardQRScannerPage = lazy(() => import('../../pages/GuardQRScannerPage').then(m => ({ default: m.GuardQRScannerPage })));\nconst ManagerGuestAccessPage = lazy(() => import('../../pages/ManagerGuestAccessPage').then(m => ({ default: m.ManagerGuestAccessPage })));\nconst ResidentsPage = lazy(() => import('../../pages/ResidentsPage').then(m => ({ default: m.ResidentsPage })));\nconst ChatPage = lazy(() => import('../../pages/ChatPage').then(m => ({ default: m.ChatPage })));\nconst ResidentProfilePage = lazy(() => import('../../pages/ResidentProfilePage').then(m => ({ default: m.ResidentProfilePage })));\nconst ResidentContractPage = lazy(() => import('../../pages/ResidentContractPage').then(m => ({ default: m.ResidentContractPage })));\nconst ResidentUsefulContactsPage = lazy(() => import('../../pages/ResidentUsefulContactsPage'));\nconst AdvertiserDashboard = lazy(() => import('../../pages/AdvertiserDashboard').then(m => ({ default: m.AdvertiserDashboard })));\nconst CouponCheckerDashboard = lazy(() => import('../../pages/CouponCheckerDashboard').then(m => ({ default: m.CouponCheckerDashboard })));\nconst NotepadPage = lazy(() => import('../../pages/NotepadPage').then(m => ({ default: m.NotepadPage })));\nconst TenantDashboard = lazy(() => import('../../pages/tenant/TenantDashboard').then(m => ({ default: m.TenantDashboard })));\nconst ExecutorsPage = lazy(() => import('../../pages/shared/ExecutorsPage').then(m => ({ default: m.ExecutorsPage })));\nconst RequestsPage = lazy(() => import('../../pages/shared/RequestsPage').then(m => ({ default: m.RequestsPage })));\nconst RentalsPage = lazy(() => import('../../pages/manager/RentalsPage').then(m => ({ default: m.RentalsPage })));\nconst TeamPage = lazy(() => import('../../pages/admin/TeamPage').then(m => ({ default: m.TeamPage })));\nconst ReportsPage = lazy(() => import('../../pages/admin/ReportsPage').then(m => ({ default: m.ReportsPage })));\nconst SettingsPage = lazy(() => import('../../pages/admin/SettingsPage').then(m => ({ default: m.SettingsPage })));\nconst MonitoringPage = lazy(() => import('../../pages/admin/MonitoringPage').then(m => ({ default: m.MonitoringPage })));\n\nexport function Layout() {\n  const location = useLocation();\n  const { user, logout } = useAuthStore();\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const { getUnreadCount, fetchAnnouncements } = useDataStore();\n  const unreadCount = user ? getUnreadCount(user.id) : 0;\n\n  // Hook for popup notifications (urgent announcements, completed requests)\n  const { popups, dismissPopup } = usePopupNotifications();\n\n  // Real-time sync via WebSocket (replaces SSE polling)\n  useWebSocketSync();\n\n  // Fetch announcements on mount (for badge in sidebar)\n  useEffect(() => {\n    fetchAnnouncements();\n  }, [fetchAnnouncements]);\n\n  // Close sidebar when route changes on mobile\n  useEffect(() => {\n    setSidebarOpen(false);\n  }, [location.pathname]);\n\n  // Determine which dashboard to show based on role and account_type\n  const getDashboard = () => {\n    // Check account_type first for special accounts\n    if (user?.account_type === 'advertiser') {\n      return <AdvertiserDashboard />;\n    }\n    if (user?.account_type === 'coupon_checker') {\n      return <CouponCheckerDashboard />;\n    }\n\n    switch (user?.role) {\n      case 'admin':\n        return <AdminDashboard />;\n      case 'director':\n        return <DirectorDashboard />;\n      case 'department_head':\n        return <DepartmentHeadDashboard />;\n      case 'executor':\n        return <ExecutorDashboard />;\n      case 'resident':\n        return <ResidentDashboard />;\n      case 'tenant':\n      case 'commercial_owner':\n        return <TenantDashboard />;\n      default:\n        return <ManagerDashboard />;\n    }\n  };\n\n  // Determine which announcements page to show based on role\n  const getAnnouncementsPage = () => {\n    if (user?.role === 'resident') {\n      return <ResidentAnnouncementsPage />;\n    }\n    if (user?.role === 'executor') {\n      return <ExecutorAnnouncementsPage />;\n    }\n    return <AnnouncementsPage />;\n  };\n\n  // Determine which meetings page to show based on role\n  const getMeetingsPage = () => {\n    if (user?.role === 'resident') {\n      return <ResidentMeetingsPage />;\n    }\n    return <MeetingsPage />;\n  };\n\n  // Determine which guest access page to show based on role\n  const getGuestAccessPage = () => {\n    if (user?.role === 'resident') {\n      return <ResidentGuestAccessPage />;\n    }\n    return <ManagerGuestAccessPage />;\n  };\n\n  return (\n    <div className=\"min-h-screen min-h-dvh\">\n      <Sidebar\n        onLogout={logout}\n        isOpen={sidebarOpen}\n        onClose={() => setSidebarOpen(false)}\n      />\n\n      {/* Mobile Header */}\n      <MobileHeader\n        onMenuClick={() => setSidebarOpen(true)}\n        unreadCount={unreadCount}\n      />\n\n      <div className=\"main-content\">\n        {/* Desktop Header */}\n        <div className=\"hide-mobile\">\n          <Header />\n        </div>\n\n        <main className=\"p-4 md:p-6 page-content\">\n          <Suspense fallback={<PageLoader />}>\n            <Routes>\n              <Route path=\"/\" element={getDashboard()} />\n              <Route path=\"/requests\" element={<RequestsPage />} />\n              <Route path=\"/residents\" element={<ResidentsPage />} />\n              <Route path=\"/executors\" element={<ExecutorsPage />} />\n              <Route path=\"/rentals\" element={<RentalsPage />} />\n              <Route path=\"/buildings\" element={<BuildingsPage />} />\n              <Route path=\"/work-orders\" element={<WorkOrdersPage />} />\n              <Route path=\"/meetings\" element={getMeetingsPage()} />\n              <Route path=\"/announcements\" element={getAnnouncementsPage()} />\n              <Route path=\"/schedule\" element={<ExecutorSchedulePage />} />\n              <Route path=\"/stats\" element={<ExecutorStatsPage />} />\n              <Route path=\"/rate-employees\" element={<ResidentRateEmployeesPage />} />\n              <Route path=\"/vehicles\" element={<ResidentVehiclesPage />} />\n              <Route path=\"/vehicle-search\" element={<VehicleSearchPage />} />\n              <Route path=\"/guest-access\" element={getGuestAccessPage()} />\n              <Route path=\"/qr-scanner\" element={<GuardQRScannerPage />} />\n              <Route path=\"/chat\" element={<ChatPage />} />\n              <Route path=\"/profile\" element={<ResidentProfilePage />} />\n              <Route path=\"/contract\" element={<ResidentContractPage />} />\n              <Route path=\"/useful-contacts\" element={<ResidentUsefulContactsPage />} />\n              <Route path=\"/colleagues\" element={<ColleaguesSection />} />\n              <Route path=\"/notepad\" element={<NotepadPage />} />\n              <Route path=\"/trainings\" element={<TrainingsPage />} />\n              <Route path=\"/team\" element={<TeamPage />} />\n              <Route path=\"/reports\" element={<ReportsPage />} />\n              <Route path=\"/settings\" element={<SettingsPage />} />\n              <Route path=\"/monitoring\" element={<MonitoringPage />} />\n            </Routes>\n          </Suspense>\n        </main>\n      </div>\n\n      {/* Popup notifications for urgent announcements and completed requests */}\n      <PopupManager popups={popups} onDismiss={dismissPopup} />\n\n      {/* Performance Monitor (  dev mode) */}\n      <PerformanceMonitor />\n    </div>\n  );\n}\n","import { useState, useRef, useEffect } from 'react';\nimport { Eye, EyeOff, AlertCircle, X, FileText, Check, Users, UserCog, Building2, Wrench, Shield, Megaphone, ShieldCheck, Crown, Briefcase, Ticket } from 'lucide-react';\nimport { useAuthStore } from '../stores/authStore';\nimport { useLanguageStore, type Language } from '../stores/languageStore';\nimport { AppLogo } from '../components/common/AppLogo';\n\n// Demo accounts for all roles\nconst DEMO_ACCOUNTS = [\n  { login: 'admin', password: 'kamizo', role: 'admin', labelRu: '', labelUz: 'Administrator', icon: Shield, color: 'bg-red-500' },\n  { login: 'director', password: 'kamizo', role: 'director', labelRu: '', labelUz: 'Direktor', icon: Briefcase, color: 'bg-rose-600' },\n  { login: 'manager', password: 'kamizo', role: 'manager', labelRu: '', labelUz: 'Boshqaruvchi', icon: UserCog, color: 'bg-blue-500' },\n  { login: 'department_head', password: 'kamizo', role: 'department_head', labelRu: ' ', labelUz: 'Bo\\'lim boshlig\\'i', icon: Crown, color: 'bg-indigo-500' },\n  { login: 'resident', password: 'kamizo', role: 'resident', labelRu: '', labelUz: 'Aholi', icon: Users, color: 'bg-green-500' },\n  { login: 'executor', password: 'kamizo', role: 'executor', labelRu: '', labelUz: 'Ijrochi', icon: Wrench, color: 'bg-amber-500' },\n  { login: 'dispatcher', password: 'kamizo', role: 'dispatcher', labelRu: '', labelUz: 'Dispetcher', icon: Building2, color: 'bg-purple-500' },\n  { login: 'security', password: 'kamizo', role: 'security', labelRu: '', labelUz: 'Qo\\'riqchi', icon: ShieldCheck, color: 'bg-slate-500' },\n  { login: 'coupon_checker', password: 'kamizo', role: 'coupon_checker', labelRu: ' ', labelUz: 'Kupon tekshiruvchi', icon: Ticket, color: 'bg-teal-500' },\n  { login: 'advertiser', password: 'kamizo', role: 'advertiser', labelRu: '', labelUz: 'Reklamaberuvchi', icon: Megaphone, color: 'bg-pink-500' },\n];\n\nexport function LoginPage() {\n  const { login, isLoading: authLoading, error: authError } = useAuthStore();\n  const { language, setLanguage, t } = useLanguageStore();\n\n  const [loginValue, setLoginValue] = useState('');\n  const [password, setPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [error, setError] = useState('');\n  const [agreedToTerms, setAgreedToTerms] = useState(false);\n  const [showOfferModal, setShowOfferModal] = useState(false);\n  const [canAcceptOffer, setCanAcceptOffer] = useState(false);\n  const offerScrollRef = useRef<HTMLDivElement>(null);\n\n  const languages: { code: Language; label: string; flag: string }[] = [\n    { code: 'ru', label: 'RU', flag: '' },\n    { code: 'uz', label: 'UZ', flag: '' },\n  ];\n\n  // Check if user scrolled to bottom of offer\n  const handleOfferScroll = () => {\n    if (offerScrollRef.current) {\n      const { scrollTop, scrollHeight, clientHeight } = offerScrollRef.current;\n      // Allow acceptance when scrolled to within 50px of bottom\n      if (scrollTop + clientHeight >= scrollHeight - 50) {\n        setCanAcceptOffer(true);\n      }\n    }\n  };\n\n  // Reset scroll check when modal opens\n  useEffect(() => {\n    if (showOfferModal) {\n      setCanAcceptOffer(false);\n      // Check initial state in case content is short\n      setTimeout(() => {\n        if (offerScrollRef.current) {\n          const { scrollHeight, clientHeight } = offerScrollRef.current;\n          if (clientHeight >= scrollHeight) {\n            setCanAcceptOffer(true);\n          }\n        }\n      }, 100);\n    }\n  }, [showOfferModal]);\n\n  const handleAcceptOffer = () => {\n    setAgreedToTerms(true);\n    setShowOfferModal(false);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!agreedToTerms) {\n      setError(language === 'ru' ? '    ' : 'Ommaviy oferta shartlarini qabul qilish kerak');\n      return;\n    }\n\n    try {\n      const success = await login(loginValue, password);\n      if (!success) {\n        setError(language === 'ru' ? '   ' : 'Login yoki parol noto\\'g\\'ri');\n      }\n      // No need to navigate - App component will re-render with Layout when user is set\n    } catch {\n      setError(language === 'ru' ? '  ' : 'Kirishda xatolik');\n    }\n  };\n\n  const displayError = error || authError;\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Language Switcher */}\n      <div className=\"absolute top-4 right-4 z-20\">\n        <div className=\"flex items-center gap-1 bg-white/80 backdrop-blur-sm rounded-xl p-1 shadow-sm\">\n          {languages.map((lang) => (\n            <button\n              key={lang.code}\n              onClick={() => setLanguage(lang.code)}\n              className={`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors touch-manipulation ${\n                language === lang.code\n                  ? 'bg-orange-400 text-gray-900'\n                  : 'hover:bg-gray-100 text-gray-600'\n              }`}\n            >\n              <span>{lang.flag}</span>\n              <span>{lang.label}</span>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Decorative elements */}\n      <div className=\"absolute top-20 left-20 w-72 h-72 bg-primary-300/30 rounded-full blur-3xl\" />\n      <div className=\"absolute bottom-20 right-20 w-96 h-96 bg-primary-200/40 rounded-full blur-3xl\" />\n      <div className=\"absolute top-1/2 left-1/3 w-64 h-64 bg-orange-200/30 rounded-full blur-3xl\" />\n\n      <div className=\"glass-card p-6 md:p-8 w-full max-w-md relative z-10\">\n        {/* Logo */}\n        <div className=\"text-center mb-6 md:mb-8\">\n          <div className=\"flex justify-center mb-4\">\n            <AppLogo size=\"xl\" />\n          </div>\n          <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">Kamizo</h1>\n          <p className=\"text-gray-500 mt-1 md:mt-2 text-sm md:text-base\">{language === 'ru' ? ' ' : 'Uy-joy boshqaruvi'}</p>\n        </div>\n\n        {/* Login Form */}\n        <form onSubmit={handleSubmit} className=\"space-y-4 md:space-y-5\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1.5 md:mb-2\">{t('auth.login')}</label>\n            <input\n              type=\"text\"\n              value={loginValue}\n              onChange={(e) => setLoginValue(e.target.value)}\n              placeholder={language === 'ru' ? ' ' : 'Login kiriting'}\n              className=\"glass-input text-base\"\n              required\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1.5 md:mb-2\">{t('auth.password')}</label>\n            <div className=\"relative\">\n              <input\n                type={showPassword ? 'text' : 'password'}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder={language === 'ru' ? ' ' : 'Parol kiriting'}\n                className=\"glass-input pr-12 text-base\"\n                required\n              />\n              <button\n                type=\"button\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  setShowPassword(!showPassword);\n                }}\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 active:text-gray-800 touch-manipulation p-2 z-10\"\n                aria-label={showPassword ? ' ' : ' '}\n              >\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n          </div>\n\n          {displayError && (\n            <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm\">\n              <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\n              {displayError}\n            </div>\n          )}\n\n          {/* User Agreement Checkbox - Touch-friendly 44px target */}\n          <div className=\"flex items-start gap-3\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                if (!agreedToTerms) {\n                  setShowOfferModal(true);\n                } else {\n                  setAgreedToTerms(false);\n                }\n              }}\n              className={`flex-shrink-0 w-11 h-11 md:w-6 md:h-6 rounded-lg md:rounded border-2 flex items-center justify-center transition-colors touch-manipulation active:scale-95 ${\n                agreedToTerms\n                  ? 'bg-orange-400 border-orange-400'\n                  : 'border-gray-300 hover:border-orange-400 bg-white/50'\n              }`}\n            >\n              {agreedToTerms && <Check className=\"w-5 h-5 md:w-4 md:h-4 text-gray-800\" />}\n            </button>\n            <div className=\"text-sm text-gray-600\">\n              {language === 'ru' ? (\n                <>\n                     {' '}\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowOfferModal(true)}\n                    className=\"text-orange-600 hover:text-orange-700 underline font-medium touch-manipulation\"\n                  >\n                     \n                  </button>\n                </>\n              ) : (\n                <>\n                  Men{' '}\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowOfferModal(true)}\n                    className=\"text-orange-600 hover:text-orange-700 underline font-medium touch-manipulation\"\n                  >\n                    ommaviy oferta\n                  </button>\n                  {' '}shartlariga roziman\n                </>\n              )}\n            </div>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={authLoading || !agreedToTerms}\n            className=\"btn-primary w-full text-center disabled:opacity-50 py-3 text-base touch-manipulation\"\n          >\n            {authLoading ? (language === 'ru' ? '...' : 'Kirish...') : t('auth.enter')}\n          </button>\n        </form>\n\n        {/* Demo Accounts Section */}\n        <div className=\"mt-6 pt-6 border-t border-gray-200\">\n          <p className=\"text-xs text-gray-500 text-center mb-3\">\n            {language === 'ru' ? '-  :' : 'Test uchun demo-kirish:'}\n          </p>\n          <div className=\"grid grid-cols-2 gap-2\">\n            {DEMO_ACCOUNTS.map((account) => {\n              const Icon = account.icon;\n              return (\n                <button\n                  key={account.login}\n                  type=\"button\"\n                  onClick={() => {\n                    setLoginValue(account.login);\n                    setPassword(account.password);\n                    if (!agreedToTerms) {\n                      setShowOfferModal(true);\n                    }\n                  }}\n                  className=\"flex items-center gap-2 px-3 py-2 bg-gray-50 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation text-left\"\n                >\n                  <div className={`w-7 h-7 ${account.color} rounded-lg flex items-center justify-center flex-shrink-0`}>\n                    <Icon className=\"w-4 h-4 text-white\" />\n                  </div>\n                  <span className=\"text-xs font-medium text-gray-700 truncate\">\n                    {language === 'ru' ? account.labelRu : account.labelUz}\n                  </span>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Public Offer Modal */}\n      {showOfferModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4\">\n          <div className=\"bg-white rounded-t-2xl sm:rounded-2xl shadow-2xl w-full sm:max-w-2xl max-h-[95vh] sm:max-h-[90vh] flex flex-col\">\n            {/* Modal Header */}\n            <div className=\"flex items-center justify-between p-4 md:p-6 border-b border-gray-200\">\n              <div className=\"flex items-center gap-2 sm:gap-3\">\n                <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-orange-100 rounded-xl flex items-center justify-center flex-shrink-0\">\n                  <FileText className=\"w-4 h-4 sm:w-5 sm:h-5 text-orange-600\" />\n                </div>\n                <h2 className=\"text-base sm:text-lg md:text-xl font-bold text-gray-900\">\n                  {language === 'ru' ? ' ' : 'Ommaviy oferta'}\n                </h2>\n              </div>\n              <button\n                onClick={() => setShowOfferModal(false)}\n                className=\"p-2 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation\"\n              >\n                <X className=\"w-5 h-5 text-gray-500\" />\n              </button>\n            </div>\n\n            {/* Modal Content - Scrollable */}\n            <div\n              ref={offerScrollRef}\n              onScroll={handleOfferScroll}\n              className=\"flex-1 overflow-y-auto p-4 md:p-6 text-sm text-gray-700 leading-relaxed\"\n            >\n              {language === 'ru' ? (\n                <div className=\"space-y-4\">\n                  <h3 className=\"font-bold text-base\"> </h3>\n                  <p className=\"font-medium\">     \"Kamizo\"</p>\n\n                  <h4 className=\"font-semibold mt-4\">1.  </h4>\n                  <p>1.1.    (  )     \"Kamizo\" (  )       (  )         .</p>\n                  <p>1.2.              .</p>\n                  <p>1.3.                .</p>\n\n                  <h4 className=\"font-semibold mt-4\">2.  </h4>\n                  <p>2.1.         , :</p>\n                  <ul className=\"list-disc pl-6 space-y-1\">\n                    <li>      ;</li>\n                    <li>    ;</li>\n                    <li>  - ;</li>\n                    <li>      ;</li>\n                    <li>  ;</li>\n                    <li>     ;</li>\n                    <li>   .</li>\n                  </ul>\n\n                  <h4 className=\"font-semibold mt-4\">3.    </h4>\n                  <p>3.1.  :</p>\n                  <ul className=\"list-disc pl-6 space-y-1\">\n                    <li>       ;</li>\n                    <li>      ;</li>\n                    <li>    ;</li>\n                    <li>   .</li>\n                  </ul>\n                  <p className=\"mt-2\">3.2.  :</p>\n                  <ul className=\"list-disc pl-6 space-y-1\">\n                    <li>     ;</li>\n                    <li>      ;</li>\n                    <li>     ;</li>\n                    <li>     .</li>\n                  </ul>\n\n                  <h4 className=\"font-semibold mt-4\">4.    </h4>\n                  <p>4.1.        .</p>\n                  <p>4.2.     10  ,   .</p>\n                  <p>4.3.        0,1%       .</p>\n\n                  <h4 className=\"font-semibold mt-4\">5.  </h4>\n                  <p>5.1.               .</p>\n                  <p>5.2.      ,     .</p>\n\n                  <h4 className=\"font-semibold mt-4\">6.  </h4>\n                  <p>6.1.            .</p>\n                  <p>6.2.               .</p>\n\n                  <h4 className=\"font-semibold mt-4\">7.   </h4>\n                  <p>7.1.     .</p>\n                  <p>7.2.              .</p>\n\n                  <h4 className=\"font-semibold mt-4\">8.  </h4>\n                  <p>8.1.                 30 .</p>\n                  <p>8.2.            .</p>\n\n                  <div className=\"mt-6 p-4 bg-orange-50 rounded-xl border border-orange-200\">\n                    <p className=\"font-medium text-orange-800\">\n                         ,    .\n                    </p>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  <h3 className=\"font-bold text-base\">OMMAVIY OFERTA</h3>\n                  <p className=\"font-medium\">\"Kamizo\" boshqaruv kompaniyasi xizmatlarini ko'rsatish bo'yicha</p>\n\n                  <h4 className=\"font-semibold mt-4\">1. UMUMIY QOIDALAR</h4>\n                  <p>1.1. Ushbu ommaviy oferta (keyingi o'rinlarda - Oferta) \"Kamizo\" MChJ (keyingi o'rinlarda - Ijrochi) tomonidan cheklanmagan doiradagi jismoniy va yuridik shaxslarga (keyingi o'rinlarda - Buyurtmachi) ko'p qavatli uyni boshqarish xizmatlarini ko'rsatish bo'yicha shartnoma tuzish haqidagi rasmiy taklifdir.</p>\n                  <p>1.2. Ushbu Ofertaning to'liq va shartsiz aksepti - Buyurtmachining tizimda ro'yxatdan o'tishi va xizmatdan foydalanishidir.</p>\n                  <p>1.3. Oferta aksept qilingan paytdan boshlab kuchga kiradi va tomonlar o'z majburiyatlarini to'liq bajargunga qadar amal qiladi.</p>\n\n                  <h4 className=\"font-semibold mt-4\">2. OFERTA PREDMETI</h4>\n                  <p>2.1. Ijrochi Buyurtmachiga ko'p qavatli uyni boshqarish xizmatlarini ko'rsatishni o'z zimmasiga oladi, jumladan:</p>\n                  <ul className=\"list-disc pl-6 space-y-1\">\n                    <li>Umumiy mulkning texnik xizmati va joriy ta'miri;</li>\n                    <li>Umumiy foydalanish joylarini sanitariya-gigienik holatda saqlash;</li>\n                    <li>Kun-tun avariya-dispetcherlik xizmatini tashkil etish;</li>\n                    <li>Qattiq maishiy chiqindilarni yig'ish va olib chiqishni ta'minlash;</li>\n                    <li>Uy atrofi hududini saqlash;</li>\n                    <li>Liftlar va muhandislik tizimlariga texnik xizmat ko'rsatish;</li>\n                    <li>Qo'riqlash va video kuzatuvni tashkil etish.</li>\n                  </ul>\n\n                  <h4 className=\"font-semibold mt-4\">3. TOMONLARNING HUQUQ VA MAJBURIYATLARI</h4>\n                  <p>3.1. Ijrochi majburiyatlari:</p>\n                  <ul className=\"list-disc pl-6 space-y-1\">\n                    <li>Xizmat ko'rsatish bo'yicha arizalarni sifatli va o'z vaqtida bajarish;</li>\n                    <li>Ariza berish xizmatiga kun-tun kirish imkoniyatini ta'minlash;</li>\n                    <li>Bajarilgan ishlar bo'yicha hisobotlarni taqdim etish;</li>\n                    <li>Shaxsiy ma'lumotlar maxfiyligini saqlash.</li>\n                  </ul>\n                  <p className=\"mt-2\">3.2. Buyurtmachi majburiyatlari:</p>\n                  <ul className=\"list-disc pl-6 space-y-1\">\n                    <li>Ko'rsatilgan xizmatlar uchun o'z vaqtida to'lov qilish;</li>\n                    <li>Ishlarni bajarish uchun xonaga kirishni ta'minlash;</li>\n                    <li>Uyning umumiy mulkiga ehtiyotkorona munosabatda bo'lish;</li>\n                    <li>Ko'p qavatli uyda yashash qoidalariga rioya qilish.</li>\n                  </ul>\n\n                  <h4 className=\"font-semibold mt-4\">4. NARX VA TO'LOV TARTIBI</h4>\n                  <p>4.1. Xizmatlar narxi boshqaruv kompaniyasining tasdiqlangan tariflariga muvofiq belgilanadi.</p>\n                  <p>4.2. To'lov hisob-kitob oyidan keyingi oyning 10-sanasigacha har oy amalga oshiriladi.</p>\n                  <p>4.3. To'lovni kechiktirgan taqdirda, har bir kechiktirilgan kun uchun qarz summasining 0,1% miqdorida jarima hisoblanadi.</p>\n\n                  <h4 className=\"font-semibold mt-4\">5. TOMONLARNING JAVOBGARLIGI</h4>\n                  <p>5.1. Tomonlar o'z majburiyatlarini bajarmaslik yoki lozim darajada bajarmaslik uchun amaldagi qonunchilikka muvofiq javobgar bo'ladi.</p>\n                  <p>5.2. Ijrochi fors-major holatlari tufayli yetkazilgan zarar uchun javobgar emas.</p>\n\n                  <h4 className=\"font-semibold mt-4\">6. SHAXSIY MA'LUMOTLAR</h4>\n                  <p>6.1. Buyurtmachi Maxfiylik siyosatiga muvofiq shaxsiy ma'lumotlarni qayta ishlashga rozilik beradi.</p>\n                  <p>6.2. Shaxsiy ma'lumotlar faqat xizmatlar ko'rsatish uchun ishlatiladi va Buyurtmachining roziligisiz uchinchi shaxslarga berilmaydi.</p>\n\n                  <h4 className=\"font-semibold mt-4\">7. NIZOLARNI HAL ETISH TARTIBI</h4>\n                  <p>7.1. Barcha nizolar muzokaralar yo'li bilan hal etiladi.</p>\n                  <p>7.2. Kelishuvga erishish imkonsiz bo'lganda, nizo Ijrochi joylashgan joy sudiga ko'rib chiqish uchun topshiriladi.</p>\n\n                  <h4 className=\"font-semibold mt-4\">8. YAKUNIY QOIDALAR</h4>\n                  <p>8.1. Ushbu Oferta Ijrochi tomonidan bir tomonlama tartibda, Buyurtmachini kamida 30 kun oldin xabardor qilgan holda o'zgartirilishi mumkin.</p>\n                  <p>8.2. O'zgartirishlar kiritilganidan keyin xizmatdan foydalanishni davom ettirish Ofertaning yangi tahririga rozilikni bildiradi.</p>\n\n                  <div className=\"mt-6 p-4 bg-orange-50 rounded-xl border border-orange-200\">\n                    <p className=\"font-medium text-orange-800\">\n                      Oferta shartlarini qabul qilish uchun hujjat oxirigacha aylantiring.\n                    </p>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Modal Footer */}\n            <div className=\"p-4 md:p-6 border-t border-gray-200 bg-gray-50 sm:rounded-b-2xl\">\n              <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4\">\n                <p className={`text-xs sm:text-sm text-center sm:text-left ${canAcceptOffer ? 'text-green-600' : 'text-gray-500'}`}>\n                  {canAcceptOffer\n                    ? (language === 'ru' ? '   ' : ' Siz hujjatni o\\'qidingiz')\n                    : (language === 'ru' ? '   ' : 'O\\'qish uchun pastga aylantiring')\n                  }\n                </p>\n                <div className=\"flex gap-2 sm:gap-3\">\n                  <button\n                    onClick={() => setShowOfferModal(false)}\n                    className=\"flex-1 sm:flex-none px-4 py-3 sm:py-2 text-gray-600 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation text-sm sm:text-base\"\n                  >\n                    {language === 'ru' ? '' : 'Yopish'}\n                  </button>\n                  <button\n                    onClick={handleAcceptOffer}\n                    disabled={!canAcceptOffer}\n                    className={`flex-1 sm:flex-none px-6 py-3 sm:py-2 rounded-xl font-medium transition-colors touch-manipulation text-sm sm:text-base ${\n                      canAcceptOffer\n                        ? 'bg-orange-400 hover:bg-orange-500 active:bg-orange-600 text-gray-900'\n                        : 'bg-gray-200 text-gray-400 cursor-not-allowed'\n                    }`}\n                  >\n                    {language === 'ru' ? '' : 'Qabul qilish'}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { Bell, X, Loader2 } from 'lucide-react';\nimport { pushNotifications } from '../services/pushNotifications';\nimport { useAuthStore } from '../stores/authStore';\n\nexport function PushNotificationPrompt() {\n  const [show, setShow] = useState(false);\n  const [dismissed, setDismissed] = useState(false);\n  const [isSubscribing, setIsSubscribing] = useState(false);\n  const { user } = useAuthStore();\n\n  useEffect(() => {\n    // ,   \n    if (!pushNotifications.isBrowserNotificationsSupported()) {\n      return;\n    }\n\n    const permission = pushNotifications.getPermission();\n    const dismissedKey = `push_prompt_dismissed_${user?.id || 'anon'}`;\n    const wasDismissed = localStorage.getItem(dismissedKey);\n    const lastDismissedTime = wasDismissed ? parseInt(wasDismissed) : 0;\n    const daysSinceDismissed = (Date.now() - lastDismissedTime) / (1000 * 60 * 60 * 24);\n\n    //   :\n    // 1. permission === 'default'    \n    // 2.    7    \n    const shouldShow = permission === 'default' && (!wasDismissed || daysSinceDismissed > 7);\n\n    if (shouldShow) {\n      //     UX\n      const timer = setTimeout(() => setShow(true), 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [user?.id]);\n\n  const handleAllow = async () => {\n    setIsSubscribing(true);\n    try {\n      // Subscribe to Web Push (this also requests permission)\n      const subscription = await pushNotifications.subscribe();\n\n      // Show test notification via Service Worker for better mobile support\n      if ('serviceWorker' in navigator) {\n        try {\n          const swRegistration = await navigator.serviceWorker.ready;\n          await swRegistration.showNotification('  !', {\n            body: subscription\n              ? '       Kamizo    .'\n              : '         .',\n            icon: '/favicon.ico',\n            badge: '/favicon.ico',\n            tag: 'welcome-notification',\n            requireInteraction: false,\n          });\n        } catch (swError) {\n          console.warn('Service Worker notification failed, falling back:', swError);\n          // Fallback to browser Notification API\n          await pushNotifications.show({\n            title: '  !',\n            body: '         .',\n            requireInteraction: false,\n          });\n        }\n      } else if (!subscription) {\n        // No Service Worker, try browser notifications\n        const granted = await pushNotifications.requestPermission();\n        if (granted) {\n          await pushNotifications.show({\n            title: ' !',\n            body: '         .',\n            requireInteraction: false,\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Failed to subscribe to push notifications:', error);\n    } finally {\n      setIsSubscribing(false);\n      setShow(false);\n      setDismissed(true);\n    }\n  };\n\n  const handleDismiss = () => {\n    const dismissedKey = `push_prompt_dismissed_${user?.id || 'anon'}`;\n    localStorage.setItem(dismissedKey, Date.now().toString());\n    setShow(false);\n    setDismissed(true);\n  };\n\n  if (!show || dismissed) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-in slide-in-from-bottom-4 duration-300\">\n      <div className=\"bg-white rounded-xl shadow-xl border border-gray-200 p-4\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0\">\n            <Bell className=\"w-5 h-5 text-yellow-600\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-semibold text-gray-900\"> ?</h3>\n            <p className=\"text-sm text-gray-600 mt-1\">\n                   ,     .\n            </p>\n            <div className=\"flex gap-2 mt-3\">\n              <button\n                onClick={handleAllow}\n                disabled={isSubscribing}\n                className=\"px-4 py-2 bg-yellow-400 hover:bg-yellow-500 text-black font-medium rounded-lg transition-colors text-sm disabled:opacity-50 flex items-center gap-2\"\n              >\n                {isSubscribing ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    ...\n                  </>\n                ) : (\n                  ''\n                )}\n              </button>\n              <button\n                onClick={handleDismiss}\n                className=\"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors text-sm\"\n              >\n                \n              </button>\n            </div>\n          </div>\n          <button\n            onClick={handleDismiss}\n            className=\"text-gray-400 hover:text-gray-600 p-1\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { Component } from 'react';\nimport type { ErrorInfo, ReactNode } from 'react';\nimport { AlertTriangle, RefreshCw, Home } from 'lucide-react';\n\n/**\n * Production-Grade Error Boundary\n *\n * Features:\n * - Catches React errors in component tree\n * - Logs errors with context\n * - Shows user-friendly error UI\n * - Provides recovery options\n * - Sends errors to monitoring service\n */\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n  isolate?: boolean; // If true, only catches errors in this subtree\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n  errorCount: number;\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorCount: 0,\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<State> {\n    return {\n      hasError: true,\n      error,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // Update state with error details\n    this.setState(prev => ({\n      errorInfo,\n      errorCount: prev.errorCount + 1,\n    }));\n\n    // Log to console\n    console.error(' ErrorBoundary caught error:', {\n      error: error.message,\n      componentStack: errorInfo.componentStack,\n    });\n\n    // Send to monitoring service\n    this.logError(error, errorInfo);\n\n    // Call custom error handler\n    this.props.onError?.(error, errorInfo);\n\n    // Send to external monitoring (if available)\n    if (import.meta.env.PROD) {\n      this.sendToMonitoring(error, errorInfo);\n    }\n  }\n\n  logError(error: Error, errorInfo: ErrorInfo) {\n    // Store in localStorage for debugging\n    try {\n      const errorLog = {\n        timestamp: new Date().toISOString(),\n        message: error.message,\n        stack: error.stack,\n        componentStack: errorInfo.componentStack,\n        userAgent: navigator.userAgent,\n        url: window.location.href,\n      };\n\n      const logs = JSON.parse(localStorage.getItem('error_logs') || '[]');\n      logs.push(errorLog);\n\n      // Keep only last 50 errors\n      if (logs.length > 50) {\n        logs.shift();\n      }\n\n      localStorage.setItem('error_logs', JSON.stringify(logs));\n    } catch (err) {\n      console.warn('Failed to log error to localStorage:', err);\n    }\n  }\n\n  async sendToMonitoring(error: Error, errorInfo: ErrorInfo) {\n    try {\n      // Send to backend monitoring endpoint\n      await fetch('/api/admin/monitoring/frontend-error', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          error: {\n            message: error.message,\n            stack: error.stack,\n            name: error.name,\n          },\n          componentStack: errorInfo.componentStack,\n          timestamp: new Date().toISOString(),\n          userAgent: navigator.userAgent,\n          url: window.location.href,\n          userId: localStorage.getItem('user_id'),\n        }),\n      });\n    } catch (err) {\n      console.warn('Failed to send error to monitoring:', err);\n    }\n  }\n\n  handleReset = () => {\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n    });\n  };\n\n  handleReload = () => {\n    window.location.reload();\n  };\n\n  handleGoHome = () => {\n    window.location.href = '/';\n  };\n\n  render() {\n    if (this.state.hasError) {\n      // Use custom fallback if provided\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      // Default error UI\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50 px-4\">\n          <div className=\"max-w-2xl w-full\">\n            <div className=\"bg-white rounded-lg shadow-lg p-8\">\n              {/* Error Icon */}\n              <div className=\"flex items-center justify-center mb-6\">\n                <div className=\"bg-red-100 rounded-full p-4\">\n                  <AlertTriangle className=\"w-12 h-12 text-red-600\" />\n                </div>\n              </div>\n\n              {/* Error Title */}\n              <h1 className=\"text-2xl font-bold text-gray-900 text-center mb-4\">\n                ! -   \n              </h1>\n\n              {/* Error Message */}\n              <p className=\"text-gray-600 text-center mb-6\">\n                  .      .\n              </p>\n\n              {/* Error Details (dev mode only) */}\n              {import.meta.env.DEV && this.state.error && (\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\n                  <p className=\"font-mono text-sm text-red-900 mb-2\">\n                    <strong>Error:</strong> {this.state.error.message}\n                  </p>\n                  {this.state.error.stack && (\n                    <details className=\"mt-2\">\n                      <summary className=\"cursor-pointer text-sm text-red-800 hover:text-red-900\">\n                        Stack Trace\n                      </summary>\n                      <pre className=\"mt-2 text-xs text-red-800 overflow-x-auto whitespace-pre-wrap\">\n                        {this.state.error.stack}\n                      </pre>\n                    </details>\n                  )}\n                  {this.state.errorInfo && (\n                    <details className=\"mt-2\">\n                      <summary className=\"cursor-pointer text-sm text-red-800 hover:text-red-900\">\n                        Component Stack\n                      </summary>\n                      <pre className=\"mt-2 text-xs text-red-800 overflow-x-auto whitespace-pre-wrap\">\n                        {this.state.errorInfo.componentStack}\n                      </pre>\n                    </details>\n                  )}\n                </div>\n              )}\n\n              {/* Recovery Actions */}\n              <div className=\"flex flex-col sm:flex-row gap-3\">\n                <button\n                  onClick={this.handleReset}\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors\"\n                >\n                  <RefreshCw className=\"w-5 h-5\" />\n                   \n                </button>\n\n                <button\n                  onClick={this.handleGoHome}\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors\"\n                >\n                  <Home className=\"w-5 h-5\" />\n                   \n                </button>\n\n                <button\n                  onClick={this.handleReload}\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors\"\n                >\n                  <RefreshCw className=\"w-5 h-5\" />\n                  \n                </button>\n              </div>\n\n              {/* Error Count Warning */}\n              {this.state.errorCount > 1 && (\n                <div className=\"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3\">\n                  <p className=\"text-sm text-yellow-800 text-center\">\n                       ({this.state.errorCount} ).  \n                    .\n                  </p>\n                </div>\n              )}\n\n              {/* Help Text */}\n              <p className=\"text-sm text-gray-500 text-center mt-6\">\n                  ,       .\n              </p>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\n/**\n * Smaller error boundary for isolating specific components\n */\nexport function ComponentErrorBoundary({\n  children,\n  componentName,\n}: {\n  children: ReactNode;\n  componentName?: string;\n}) {\n  return (\n    <ErrorBoundary\n      fallback={\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 my-4\">\n          <div className=\"flex items-center gap-2 text-red-900 mb-2\">\n            <AlertTriangle className=\"w-5 h-5\" />\n            <p className=\"font-medium\">\n                {componentName || ''}\n            </p>\n          </div>\n          <p className=\"text-sm text-red-700\">\n               .   .\n          </p>\n        </div>\n      }\n      isolate\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\n/**\n * Hook for manual error reporting\n */\nexport function useErrorReporter() {\n  return (error: Error, context?: Record<string, any>) => {\n    console.error('Manual error report:', error, context);\n\n    // Log to localStorage\n    try {\n      const errorLog = {\n        timestamp: new Date().toISOString(),\n        message: error.message,\n        stack: error.stack,\n        context,\n        userAgent: navigator.userAgent,\n        url: window.location.href,\n      };\n\n      const logs = JSON.parse(localStorage.getItem('error_logs') || '[]');\n      logs.push(errorLog);\n      if (logs.length > 50) logs.shift();\n      localStorage.setItem('error_logs', JSON.stringify(logs));\n    } catch (err) {\n      console.warn('Failed to log error:', err);\n    }\n\n    // Send to monitoring\n    if (import.meta.env.PROD) {\n      fetch('/api/admin/monitoring/frontend-error', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          error: {\n            message: error.message,\n            stack: error.stack,\n            name: error.name,\n          },\n          context,\n          timestamp: new Date().toISOString(),\n          userAgent: navigator.userAgent,\n          url: window.location.href,\n        }),\n      }).catch(err => console.warn('Failed to send error:', err));\n    }\n  };\n}\n","import { useEffect } from 'react';\nimport { BrowserRouter } from 'react-router-dom';\nimport { useAuthStore } from './stores/authStore';\nimport { useCRMStore } from './stores/crmStore';\nimport { useDataStore } from './stores/dataStore';\nimport { Layout } from './components/layout';\nimport { LoginPage } from './pages/LoginPage';\nimport { PushNotificationPrompt } from './components/PushNotificationPrompt';\nimport { ErrorBoundary } from './components/ErrorBoundary';\n\nfunction App() {\n  const { user } = useAuthStore();\n  const { fetchBuildings } = useCRMStore();\n  const { fetchExecutors, fetchRequests, fetchVehicles } = useDataStore();\n\n  // Load data from API when user logs in\n  useEffect(() => {\n    if (user) {\n      console.log('User logged in, fetching data from API...');\n      fetchBuildings();\n\n      // Load executors for staff roles\n      if (['admin', 'manager', 'department_head', 'dispatcher'].includes(user.role)) {\n        fetchExecutors();\n      }\n\n      // Load requests for all roles\n      fetchRequests();\n\n      // Load vehicles for residents (needed for onboarding check)\n      if (user.role === 'resident') {\n        fetchVehicles();\n      }\n    }\n  }, [user, fetchBuildings, fetchExecutors, fetchRequests, fetchVehicles]);\n\n  return (\n    <ErrorBoundary>\n      <BrowserRouter>\n        {user ? (\n          <>\n            <Layout />\n            <PushNotificationPrompt />\n          </>\n        ) : (\n          <LoginPage />\n        )}\n      </BrowserRouter>\n    </ErrorBoundary>\n  );\n}\n\nexport default App;\n","import { StrictMode } from 'react'\nimport { createRoot } from 'react-dom/client'\nimport './index.css'\nimport App from './App.tsx'\n\ncreateRoot(document.getElementById('root')!).render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n)\n"],"file":"index-1767960438672-C3luc8oy.js"}
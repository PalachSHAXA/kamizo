{"version":3,"file":"TrainingsPage-1768650638000-efYNlL9a.js","sources":["../../src/stores/trainingStore.ts","../../src/pages/TrainingsPage.tsx"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport type {\r\n  Partner,\r\n  TrainingProposal,\r\n  TrainingVote,\r\n  TrainingFeedback,\r\n  TrainingNotification,\r\n  TrainingSettings,\r\n  TrainingProposalStatus,\r\n  TrainingFormat,\r\n  TrainingTimeSlot,\r\n  ParticipationIntent,\r\n} from '../types';\r\nimport {\r\n  trainingPartnersApi,\r\n  trainingProposalsApi,\r\n  trainingVotesApi,\r\n  trainingRegistrationsApi,\r\n  trainingFeedbackApi,\r\n  trainingNotificationsApi,\r\n  trainingSettingsApi,\r\n} from '../services/api';\r\n\r\n// ==================== Mappers (snake_case -> camelCase) ====================\r\n\r\nconst mapPartnerFromApi = (p: any): Partner => ({\r\n  id: p.id,\r\n  name: p.name,\r\n  position: p.position,\r\n  specialization: p.specialization,\r\n  email: p.email,\r\n  phone: p.phone,\r\n  bio: p.bio,\r\n  avatarUrl: p.avatar_url,\r\n  isActive: p.is_active === 1 || p.is_active === true,\r\n  trainingsСonducted: p.trainings_conducted,\r\n  averageRating: p.average_rating,\r\n});\r\n\r\nconst mapVoteFromApi = (v: any): TrainingVote => ({\r\n  id: v.id,\r\n  proposalId: v.proposal_id,\r\n  voterId: v.voter_id,\r\n  voterName: v.voter_name,\r\n  participationIntent: v.participation_intent as ParticipationIntent,\r\n  isAnonymous: v.is_anonymous === 1 || v.is_anonymous === true,\r\n  votedAt: v.voted_at,\r\n});\r\n\r\nconst mapFeedbackFromApi = (f: any): TrainingFeedback => ({\r\n  id: f.id,\r\n  proposalId: f.proposal_id,\r\n  reviewerId: f.reviewer_id,\r\n  reviewerName: f.reviewer_name,\r\n  isAnonymous: f.is_anonymous === 1 || f.is_anonymous === true,\r\n  rating: f.rating,\r\n  contentRating: f.content_rating,\r\n  presenterRating: f.presenter_rating,\r\n  usefulnessRating: f.usefulness_rating,\r\n  comment: f.comment,\r\n  createdAt: f.created_at,\r\n});\r\n\r\nconst mapProposalFromApi = (p: any): TrainingProposal => ({\r\n  id: p.id,\r\n  topic: p.topic,\r\n  description: p.description,\r\n  authorId: p.author_id,\r\n  authorName: p.author_name,\r\n  isAuthorAnonymous: p.is_author_anonymous === 1 || p.is_author_anonymous === true,\r\n  partnerId: p.partner_id,\r\n  partnerName: p.partner_name,\r\n  format: p.format as TrainingFormat,\r\n  preferredTimeSlots: Array.isArray(p.preferred_time_slots)\r\n    ? p.preferred_time_slots\r\n    : p.preferred_time_slots ? JSON.parse(p.preferred_time_slots) : [],\r\n  votes: p.votes ? p.votes.map(mapVoteFromApi) : [],\r\n  voteThreshold: p.vote_threshold || 5,\r\n  status: p.status as TrainingProposalStatus,\r\n  partnerResponse: p.partner_response,\r\n  partnerResponseAt: p.partner_response_at,\r\n  partnerResponseNote: p.partner_response_note,\r\n  scheduledDate: p.scheduled_date,\r\n  scheduledTime: p.scheduled_time,\r\n  scheduledLocation: p.scheduled_location,\r\n  scheduledLink: p.scheduled_link,\r\n  maxParticipants: p.max_participants,\r\n  registeredParticipants: p.registrations\r\n    ? p.registrations.map((r: any) => r.user_id)\r\n    : [],\r\n  feedback: p.feedback ? p.feedback.map(mapFeedbackFromApi) : [],\r\n  completedAt: p.completed_at,\r\n  actualParticipantsCount: p.actual_participants_count,\r\n  createdAt: p.created_at,\r\n  updatedAt: p.updated_at,\r\n  // Computed fields from API\r\n  voteCount: p.vote_count,\r\n  registeredCount: p.registered_count,\r\n});\r\n\r\nconst mapNotificationFromApi = (n: any): TrainingNotification => ({\r\n  id: n.id,\r\n  type: n.type,\r\n  proposalId: n.proposal_id,\r\n  recipientId: n.recipient_id,\r\n  recipientRole: n.recipient_role,\r\n  title: n.title,\r\n  message: n.message,\r\n  isRead: n.is_read === 1 || n.is_read === true,\r\n  createdAt: n.created_at,\r\n});\r\n\r\nconst mapSettingsFromApi = (s: Record<string, any>): TrainingSettings => ({\r\n  voteThreshold: s.vote_threshold ?? 5,\r\n  allowAnonymousProposals: s.allow_anonymous_proposals ?? true,\r\n  allowAnonymousVotes: s.allow_anonymous_votes ?? true,\r\n  allowAnonymousFeedback: s.allow_anonymous_feedback ?? true,\r\n  notifyAllOnNewProposal: s.notify_all_on_new_proposal ?? true,\r\n  autoCloseAfterDays: s.auto_close_after_days ?? 30,\r\n});\r\n\r\n// ==================== State Interface ====================\r\n\r\ninterface TrainingState {\r\n  // Data\r\n  partners: Partner[];\r\n  proposals: TrainingProposal[];\r\n  notifications: TrainingNotification[];\r\n  settings: TrainingSettings;\r\n\r\n  // Loading states\r\n  isLoadingPartners: boolean;\r\n  isLoadingProposals: boolean;\r\n  isLoadingNotifications: boolean;\r\n\r\n  // Partners (async)\r\n  fetchPartners: (activeOnly?: boolean) => Promise<void>;\r\n  addPartner: (partner: Omit<Partner, 'id'>) => Promise<Partner>;\r\n  updatePartner: (id: string, partner: Partial<Partner>) => Promise<void>;\r\n  deletePartner: (id: string) => Promise<void>;\r\n  getActivePartners: () => Partner[];\r\n\r\n  // Proposals (async)\r\n  fetchProposals: (options?: { status?: string; partnerId?: string; authorId?: string }) => Promise<void>;\r\n  fetchProposalById: (id: string) => Promise<TrainingProposal | null>;\r\n  addProposal: (proposal: {\r\n    topic: string;\r\n    description?: string;\r\n    partnerId: string;\r\n    format: TrainingFormat;\r\n    preferredTimeSlots: TrainingTimeSlot[];\r\n    isAuthorAnonymous?: boolean;\r\n  }) => Promise<TrainingProposal>;\r\n  updateProposal: (id: string, proposal: Partial<TrainingProposal>) => Promise<void>;\r\n  deleteProposal: (id: string) => Promise<void>;\r\n  getProposalById: (id: string) => TrainingProposal | undefined;\r\n  getProposalsByStatus: (status: TrainingProposalStatus) => TrainingProposal[];\r\n  getMyProposals: (userId: string) => TrainingProposal[];\r\n\r\n  // Voting (async)\r\n  addVote: (\r\n    proposalId: string,\r\n    vote: {\r\n      participationIntent: ParticipationIntent;\r\n      isAnonymous: boolean;\r\n    }\r\n  ) => Promise<void>;\r\n  removeVote: (proposalId: string) => Promise<void>;\r\n  hasVoted: (proposalId: string, voterId: string) => boolean;\r\n  getVoteCount: (proposalId: string) => number;\r\n  getDefinitelyCount: (proposalId: string) => number;\r\n\r\n  // Partner response (async)\r\n  setPartnerResponse: (\r\n    proposalId: string,\r\n    response: 'accepted' | 'rejected',\r\n    note?: string\r\n  ) => Promise<void>;\r\n\r\n  // Scheduling (async)\r\n  scheduleTraining: (\r\n    proposalId: string,\r\n    data: {\r\n      scheduledDate: string;\r\n      scheduledTime: string;\r\n      scheduledLocation?: string;\r\n      scheduledLink?: string;\r\n      maxParticipants?: number;\r\n    }\r\n  ) => Promise<void>;\r\n\r\n  // Complete training (async)\r\n  completeTraining: (proposalId: string, actualParticipantsCount?: number) => Promise<void>;\r\n\r\n  // Registration (async)\r\n  registerForTraining: (proposalId: string) => Promise<void>;\r\n  unregisterFromTraining: (proposalId: string) => Promise<void>;\r\n  isRegistered: (proposalId: string, userId: string) => boolean;\r\n  getRegisteredCount: (proposalId: string) => number;\r\n\r\n  // Feedback (async)\r\n  addFeedback: (\r\n    proposalId: string,\r\n    feedback: {\r\n      rating: number;\r\n      contentRating?: number;\r\n      presenterRating?: number;\r\n      usefulnessRating?: number;\r\n      comment?: string;\r\n      isAnonymous?: boolean;\r\n    }\r\n  ) => Promise<void>;\r\n  hasFeedback: (proposalId: string, reviewerId: string) => boolean;\r\n  getAverageRating: (proposalId: string) => number;\r\n\r\n  // Status (sync helpers)\r\n  changeStatus: (proposalId: string, status: TrainingProposalStatus) => Promise<void>;\r\n  checkThreshold: (proposalId: string) => boolean;\r\n\r\n  // Notifications (async)\r\n  fetchNotifications: (unreadOnly?: boolean) => Promise<void>;\r\n  markNotificationAsRead: (id: string) => Promise<void>;\r\n  markAllNotificationsAsRead: () => Promise<void>;\r\n  getUnreadNotifications: (recipientId: string) => TrainingNotification[];\r\n  getNotificationsByRecipient: (recipientId: string) => TrainingNotification[];\r\n\r\n  // Settings (async)\r\n  fetchSettings: () => Promise<void>;\r\n  updateSettings: (settings: Partial<TrainingSettings>) => Promise<void>;\r\n\r\n  // Stats (sync - computed from local state)\r\n  getStats: () => {\r\n    totalProposals: number;\r\n    votingProposals: number;\r\n    scheduledTrainings: number;\r\n    completedTrainings: number;\r\n    totalVotes: number;\r\n    totalParticipants: number;\r\n    averageRating: number;\r\n  };\r\n\r\n  // Anonymity helpers (sync)\r\n  getDisplayName: (name: string, isAnonymous: boolean, isAdmin: boolean) => string;\r\n  getVotesForDisplay: (proposalId: string, isAdmin: boolean) => TrainingVote[];\r\n}\r\n\r\n// ==================== Default Settings ====================\r\n\r\nconst defaultSettings: TrainingSettings = {\r\n  voteThreshold: 5,\r\n  allowAnonymousProposals: true,\r\n  allowAnonymousVotes: true,\r\n  allowAnonymousFeedback: true,\r\n  notifyAllOnNewProposal: true,\r\n  autoCloseAfterDays: 30,\r\n};\r\n\r\n// ==================== Store ====================\r\n\r\nexport const useTrainingStore = create<TrainingState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // Initial state\r\n      partners: [],\r\n      proposals: [],\r\n      notifications: [],\r\n      settings: defaultSettings,\r\n      isLoadingPartners: false,\r\n      isLoadingProposals: false,\r\n      isLoadingNotifications: false,\r\n\r\n      // Partners\r\n      fetchPartners: async (activeOnly?: boolean) => {\r\n        set({ isLoadingPartners: true });\r\n        try {\r\n          const response = await trainingPartnersApi.getAll(activeOnly);\r\n          set({ partners: response.partners.map(mapPartnerFromApi) });\r\n        } catch (error) {\r\n          console.error('Failed to fetch partners:', error);\r\n        } finally {\r\n          set({ isLoadingPartners: false });\r\n        }\r\n      },\r\n\r\n      addPartner: async (partnerData) => {\r\n        const response = await trainingPartnersApi.create(partnerData);\r\n        const newPartner = mapPartnerFromApi(response.partner);\r\n        set((state) => ({ partners: [...state.partners, newPartner] }));\r\n        return newPartner;\r\n      },\r\n\r\n      updatePartner: async (id, partnerData) => {\r\n        await trainingPartnersApi.update(id, partnerData);\r\n        set((state) => ({\r\n          partners: state.partners.map((p) =>\r\n            p.id === id ? { ...p, ...partnerData } : p\r\n          ),\r\n        }));\r\n      },\r\n\r\n      deletePartner: async (id) => {\r\n        await trainingPartnersApi.delete(id);\r\n        set((state) => ({\r\n          partners: state.partners.filter((p) => p.id !== id),\r\n        }));\r\n      },\r\n\r\n      getActivePartners: () => {\r\n        return get().partners.filter((p) => p.isActive);\r\n      },\r\n\r\n      // Proposals\r\n      fetchProposals: async (options) => {\r\n        set({ isLoadingProposals: true });\r\n        try {\r\n          const response = await trainingProposalsApi.getAll(options);\r\n          set({ proposals: response.proposals.map(mapProposalFromApi) });\r\n        } catch (error) {\r\n          console.error('Failed to fetch proposals:', error);\r\n        } finally {\r\n          set({ isLoadingProposals: false });\r\n        }\r\n      },\r\n\r\n      fetchProposalById: async (id) => {\r\n        try {\r\n          const response = await trainingProposalsApi.getById(id);\r\n          const proposal = mapProposalFromApi(response.proposal);\r\n          // Update in local state\r\n          set((state) => ({\r\n            proposals: state.proposals.some((p) => p.id === id)\r\n              ? state.proposals.map((p) => (p.id === id ? proposal : p))\r\n              : [...state.proposals, proposal],\r\n          }));\r\n          return proposal;\r\n        } catch (error) {\r\n          console.error('Failed to fetch proposal:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      addProposal: async (proposalData) => {\r\n        const response = await trainingProposalsApi.create({\r\n          topic: proposalData.topic,\r\n          description: proposalData.description,\r\n          partnerId: proposalData.partnerId,\r\n          format: proposalData.format,\r\n          preferredTimeSlots: proposalData.preferredTimeSlots,\r\n          isAuthorAnonymous: proposalData.isAuthorAnonymous,\r\n        });\r\n        const newProposal = mapProposalFromApi(response.proposal);\r\n        set((state) => ({ proposals: [...state.proposals, newProposal] }));\r\n        return newProposal;\r\n      },\r\n\r\n      updateProposal: async (id, proposalData) => {\r\n        await trainingProposalsApi.update(id, proposalData);\r\n        set((state) => ({\r\n          proposals: state.proposals.map((p) =>\r\n            p.id === id ? { ...p, ...proposalData, updatedAt: new Date().toISOString() } : p\r\n          ),\r\n        }));\r\n      },\r\n\r\n      deleteProposal: async (id) => {\r\n        await trainingProposalsApi.delete(id);\r\n        set((state) => ({\r\n          proposals: state.proposals.filter((p) => p.id !== id),\r\n        }));\r\n      },\r\n\r\n      getProposalById: (id) => {\r\n        return get().proposals.find((p) => p.id === id);\r\n      },\r\n\r\n      getProposalsByStatus: (status) => {\r\n        return get().proposals.filter((p) => p.status === status);\r\n      },\r\n\r\n      getMyProposals: (userId) => {\r\n        return get().proposals.filter((p) => p.authorId === userId);\r\n      },\r\n\r\n      // Voting\r\n      addVote: async (proposalId, voteData) => {\r\n        await trainingVotesApi.vote(proposalId, voteData);\r\n        // Refresh the proposal to get updated vote count\r\n        await get().fetchProposalById(proposalId);\r\n      },\r\n\r\n      removeVote: async (proposalId) => {\r\n        await trainingVotesApi.removeVote(proposalId);\r\n        // Refresh the proposal\r\n        await get().fetchProposalById(proposalId);\r\n      },\r\n\r\n      hasVoted: (proposalId, voterId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        return proposal?.votes.some((v) => v.voterId === voterId) ?? false;\r\n      },\r\n\r\n      getVoteCount: (proposalId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        return proposal?.votes.length ?? proposal?.voteCount ?? 0;\r\n      },\r\n\r\n      getDefinitelyCount: (proposalId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        return (\r\n          proposal?.votes.filter((v) => v.participationIntent === 'definitely').length ?? 0\r\n        );\r\n      },\r\n\r\n      // Partner response\r\n      setPartnerResponse: async (proposalId, response, note) => {\r\n        await trainingProposalsApi.update(proposalId, {\r\n          partnerResponse: response,\r\n          partnerResponseNote: note,\r\n          status: response === 'accepted' ? 'approved' : 'rejected',\r\n        });\r\n        set((state) => ({\r\n          proposals: state.proposals.map((p) =>\r\n            p.id === proposalId\r\n              ? {\r\n                  ...p,\r\n                  partnerResponse: response,\r\n                  partnerResponseAt: new Date().toISOString(),\r\n                  partnerResponseNote: note,\r\n                  status: response === 'accepted' ? 'approved' : 'rejected',\r\n                  updatedAt: new Date().toISOString(),\r\n                }\r\n              : p\r\n          ),\r\n        }));\r\n      },\r\n\r\n      // Scheduling\r\n      scheduleTraining: async (proposalId, data) => {\r\n        await trainingProposalsApi.schedule(proposalId, data);\r\n        set((state) => ({\r\n          proposals: state.proposals.map((p) =>\r\n            p.id === proposalId\r\n              ? {\r\n                  ...p,\r\n                  ...data,\r\n                  status: 'scheduled' as TrainingProposalStatus,\r\n                  registeredParticipants: [],\r\n                  updatedAt: new Date().toISOString(),\r\n                }\r\n              : p\r\n          ),\r\n        }));\r\n      },\r\n\r\n      // Complete training\r\n      completeTraining: async (proposalId, actualParticipantsCount) => {\r\n        await trainingProposalsApi.complete(proposalId, { actualParticipantsCount });\r\n        set((state) => ({\r\n          proposals: state.proposals.map((p) =>\r\n            p.id === proposalId\r\n              ? {\r\n                  ...p,\r\n                  status: 'completed' as TrainingProposalStatus,\r\n                  completedAt: new Date().toISOString(),\r\n                  actualParticipantsCount,\r\n                  updatedAt: new Date().toISOString(),\r\n                }\r\n              : p\r\n          ),\r\n        }));\r\n      },\r\n\r\n      // Registration\r\n      registerForTraining: async (proposalId) => {\r\n        await trainingRegistrationsApi.register(proposalId);\r\n        // Refresh proposal to get updated registrations\r\n        await get().fetchProposalById(proposalId);\r\n      },\r\n\r\n      unregisterFromTraining: async (proposalId) => {\r\n        await trainingRegistrationsApi.unregister(proposalId);\r\n        // Refresh proposal\r\n        await get().fetchProposalById(proposalId);\r\n      },\r\n\r\n      isRegistered: (proposalId, userId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        return proposal?.registeredParticipants?.includes(userId) ?? false;\r\n      },\r\n\r\n      getRegisteredCount: (proposalId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        return proposal?.registeredParticipants?.length ?? proposal?.registeredCount ?? 0;\r\n      },\r\n\r\n      // Feedback\r\n      addFeedback: async (proposalId, feedbackData) => {\r\n        await trainingFeedbackApi.submit(proposalId, feedbackData);\r\n        // Refresh proposal to get updated feedback\r\n        await get().fetchProposalById(proposalId);\r\n      },\r\n\r\n      hasFeedback: (proposalId, reviewerId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        return proposal?.feedback?.some((f) => f.reviewerId === reviewerId) ?? false;\r\n      },\r\n\r\n      getAverageRating: (proposalId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        if (!proposal?.feedback?.length) return 0;\r\n        const sum = proposal.feedback.reduce((acc, f) => acc + f.rating, 0);\r\n        return sum / proposal.feedback.length;\r\n      },\r\n\r\n      // Status\r\n      changeStatus: async (proposalId, status) => {\r\n        await trainingProposalsApi.update(proposalId, { status });\r\n        set((state) => ({\r\n          proposals: state.proposals.map((p) =>\r\n            p.id === proposalId\r\n              ? { ...p, status, updatedAt: new Date().toISOString() }\r\n              : p\r\n          ),\r\n        }));\r\n      },\r\n\r\n      checkThreshold: (proposalId) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        if (!proposal) return false;\r\n        const voteCount = proposal.votes?.length ?? proposal.voteCount ?? 0;\r\n        return voteCount >= proposal.voteThreshold;\r\n      },\r\n\r\n      // Notifications\r\n      fetchNotifications: async (unreadOnly) => {\r\n        set({ isLoadingNotifications: true });\r\n        try {\r\n          const response = await trainingNotificationsApi.getAll(unreadOnly);\r\n          set({ notifications: response.notifications.map(mapNotificationFromApi) });\r\n        } catch (error) {\r\n          console.error('Failed to fetch notifications:', error);\r\n        } finally {\r\n          set({ isLoadingNotifications: false });\r\n        }\r\n      },\r\n\r\n      markNotificationAsRead: async (id) => {\r\n        await trainingNotificationsApi.markAsRead(id);\r\n        set((state) => ({\r\n          notifications: state.notifications.map((n) =>\r\n            n.id === id ? { ...n, isRead: true } : n\r\n          ),\r\n        }));\r\n      },\r\n\r\n      markAllNotificationsAsRead: async () => {\r\n        await trainingNotificationsApi.markAllAsRead();\r\n        set((state) => ({\r\n          notifications: state.notifications.map((n) => ({ ...n, isRead: true })),\r\n        }));\r\n      },\r\n\r\n      getUnreadNotifications: (recipientId) => {\r\n        return get().notifications.filter(\r\n          (n) =>\r\n            (n.recipientId === recipientId || n.recipientId === 'all') && !n.isRead\r\n        );\r\n      },\r\n\r\n      getNotificationsByRecipient: (recipientId) => {\r\n        return get().notifications.filter(\r\n          (n) => n.recipientId === recipientId || n.recipientId === 'all'\r\n        );\r\n      },\r\n\r\n      // Settings\r\n      fetchSettings: async () => {\r\n        try {\r\n          const response = await trainingSettingsApi.getAll();\r\n          set({ settings: mapSettingsFromApi(response.settings) });\r\n        } catch (error) {\r\n          console.error('Failed to fetch settings:', error);\r\n        }\r\n      },\r\n\r\n      updateSettings: async (settingsData) => {\r\n        // Convert camelCase to snake_case for API\r\n        const apiSettings: Record<string, any> = {};\r\n        if (settingsData.voteThreshold !== undefined) apiSettings.vote_threshold = settingsData.voteThreshold;\r\n        if (settingsData.allowAnonymousProposals !== undefined) apiSettings.allow_anonymous_proposals = settingsData.allowAnonymousProposals;\r\n        if (settingsData.allowAnonymousVotes !== undefined) apiSettings.allow_anonymous_votes = settingsData.allowAnonymousVotes;\r\n        if (settingsData.allowAnonymousFeedback !== undefined) apiSettings.allow_anonymous_feedback = settingsData.allowAnonymousFeedback;\r\n        if (settingsData.notifyAllOnNewProposal !== undefined) apiSettings.notify_all_on_new_proposal = settingsData.notifyAllOnNewProposal;\r\n        if (settingsData.autoCloseAfterDays !== undefined) apiSettings.auto_close_after_days = settingsData.autoCloseAfterDays;\r\n\r\n        await trainingSettingsApi.update(apiSettings);\r\n        set((state) => ({\r\n          settings: { ...state.settings, ...settingsData },\r\n        }));\r\n      },\r\n\r\n      // Stats (sync - computed from local state)\r\n      getStats: () => {\r\n        const proposals = get().proposals;\r\n        const completedProposals = proposals.filter((p) => p.status === 'completed');\r\n\r\n        let totalRating = 0;\r\n        let ratingCount = 0;\r\n        completedProposals.forEach((p) => {\r\n          if (p.feedback?.length) {\r\n            p.feedback.forEach((f) => {\r\n              totalRating += f.rating;\r\n              ratingCount++;\r\n            });\r\n          }\r\n        });\r\n\r\n        return {\r\n          totalProposals: proposals.length,\r\n          votingProposals: proposals.filter((p) => p.status === 'voting').length,\r\n          scheduledTrainings: proposals.filter((p) => p.status === 'scheduled').length,\r\n          completedTrainings: completedProposals.length,\r\n          totalVotes: proposals.reduce((acc, p) => acc + (p.votes?.length ?? 0), 0),\r\n          totalParticipants: proposals.reduce(\r\n            (acc, p) => acc + (p.registeredParticipants?.length ?? 0),\r\n            0\r\n          ),\r\n          averageRating: ratingCount > 0 ? totalRating / ratingCount : 0,\r\n        };\r\n      },\r\n\r\n      // Anonymity helpers\r\n      getDisplayName: (name, isAnonymous, isAdmin) => {\r\n        if (isAdmin) return name;\r\n        return isAnonymous ? 'Аноним' : name;\r\n      },\r\n\r\n      getVotesForDisplay: (proposalId, isAdmin) => {\r\n        const proposal = get().getProposalById(proposalId);\r\n        if (!proposal) return [];\r\n\r\n        if (isAdmin) return proposal.votes;\r\n\r\n        return proposal.votes.map((vote) => ({\r\n          ...vote,\r\n          voterName: vote.isAnonymous ? 'Аноним' : vote.voterName,\r\n        }));\r\n      },\r\n    }),\r\n    {\r\n      name: 'training-storage',\r\n      partialize: (state) => ({\r\n        // Only persist settings locally for offline fallback\r\n        settings: state.settings,\r\n      }),\r\n    }\r\n  )\r\n);\r\n\r\n// ==================== Constants for UI ====================\r\n\r\nexport const TRAINING_STATUS_LABELS: Record<TrainingProposalStatus, string> = {\r\n  voting: 'Голосование',\r\n  review: 'На рассмотрении',\r\n  approved: 'Одобрено',\r\n  scheduled: 'Запланировано',\r\n  completed: 'Завершено',\r\n  rejected: 'Отклонено',\r\n};\r\n\r\nexport const TRAINING_STATUS_COLORS: Record<TrainingProposalStatus, string> = {\r\n  voting: 'bg-blue-100 text-blue-800',\r\n  review: 'bg-yellow-100 text-yellow-800',\r\n  approved: 'bg-green-100 text-green-800',\r\n  scheduled: 'bg-purple-100 text-purple-800',\r\n  completed: 'bg-gray-100 text-gray-800',\r\n  rejected: 'bg-red-100 text-red-800',\r\n};\r\n\r\nexport const FORMAT_LABELS: Record<TrainingFormat, string> = {\r\n  online: 'Онлайн',\r\n  offline: 'Офлайн',\r\n  any: 'Любой формат',\r\n};\r\n\r\nexport const TIME_SLOT_LABELS: Record<TrainingTimeSlot, string> = {\r\n  morning: 'Утро (9:00-12:00)',\r\n  afternoon: 'День (12:00-17:00)',\r\n  evening: 'Вечер (17:00-20:00)',\r\n  weekend: 'Выходные',\r\n};\r\n\r\nexport const PARTICIPATION_LABELS: Record<ParticipationIntent, string> = {\r\n  definitely: 'Точно приду',\r\n  maybe: 'Возможно приду',\r\n  support_only: 'Поддерживаю идею',\r\n};\r\n\r\nexport const PARTICIPATION_COLORS: Record<ParticipationIntent, string> = {\r\n  definitely: 'bg-green-100 text-green-800',\r\n  maybe: 'bg-yellow-100 text-yellow-800',\r\n  support_only: 'bg-gray-100 text-gray-600',\r\n};\r\n","import { useState } from 'react';\r\nimport {\r\n  GraduationCap,\r\n  Plus,\r\n  Vote,\r\n  Clock,\r\n  CheckCircle,\r\n  Calendar,\r\n  Users,\r\n  Star,\r\n  ThumbsUp,\r\n  Eye,\r\n  X,\r\n  Send,\r\n  User,\r\n  MapPin,\r\n  Link as LinkIcon,\r\n  MessageSquare,\r\n  Settings,\r\n  UserCheck,\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport {\r\n  useTrainingStore,\r\n  TRAINING_STATUS_LABELS,\r\n  TRAINING_STATUS_COLORS,\r\n  FORMAT_LABELS,\r\n  TIME_SLOT_LABELS,\r\n  PARTICIPATION_LABELS,\r\n  PARTICIPATION_COLORS,\r\n} from '../stores/trainingStore';\r\nimport type {\r\n  TrainingProposal,\r\n  TrainingProposalStatus,\r\n  TrainingFormat,\r\n  TrainingTimeSlot,\r\n  ParticipationIntent,\r\n} from '../types';\r\n\r\n// Компонент карточки статистики\r\nconst StatCard = ({\r\n  icon: Icon,\r\n  label,\r\n  value,\r\n  color,\r\n}: {\r\n  icon: React.ElementType;\r\n  label: string;\r\n  value: string | number;\r\n  color: string;\r\n}) => (\r\n  <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n    <div className=\"flex items-center gap-4\">\r\n      <div className={`p-3 rounded-lg ${color}`}>\r\n        <Icon className=\"w-6 h-6 text-white\" />\r\n      </div>\r\n      <div>\r\n        <p className=\"text-2xl font-bold text-gray-900\">{value}</p>\r\n        <p className=\"text-sm text-gray-500\">{label}</p>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// Модальное окно создания предложения\r\nconst CreateProposalModal = ({\r\n  isOpen,\r\n  onClose,\r\n}: {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}) => {\r\n  const { user } = useAuthStore();\r\n  const { addProposal, getActivePartners, settings } = useTrainingStore();\r\n\r\n  const [topic, setTopic] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [partnerId, setPartnerId] = useState('');\r\n  const [format, setFormat] = useState<TrainingFormat>('any');\r\n  const [timeSlots, setTimeSlots] = useState<TrainingTimeSlot[]>([]);\r\n  const [isAnonymous, setIsAnonymous] = useState(false);\r\n\r\n  const partners = getActivePartners();\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!user || !partnerId) return;\r\n\r\n    const partner = partners.find((p) => p.id === partnerId);\r\n    if (!partner) return;\r\n\r\n    addProposal({\r\n      topic,\r\n      description,\r\n      isAuthorAnonymous: isAnonymous,\r\n      partnerId,\r\n      format,\r\n      preferredTimeSlots: timeSlots,\r\n    });\r\n\r\n    // Сброс формы\r\n    setTopic('');\r\n    setDescription('');\r\n    setPartnerId('');\r\n    setFormat('any');\r\n    setTimeSlots([]);\r\n    setIsAnonymous(false);\r\n    onClose();\r\n  };\r\n\r\n  const toggleTimeSlot = (slot: TrainingTimeSlot) => {\r\n    setTimeSlots((prev) =>\r\n      prev.includes(slot) ? prev.filter((s) => s !== slot) : [...prev, slot]\r\n    );\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"flex items-center justify-between p-6 border-b\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900\">\r\n            Предложить тренинг\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\r\n          {/* Тема */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Тема тренинга *\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={topic}\r\n              onChange={(e) => setTopic(e.target.value)}\r\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"Введите тему тренинга\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/* Описание */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Описание\r\n            </label>\r\n            <textarea\r\n              value={description}\r\n              onChange={(e) => setDescription(e.target.value)}\r\n              rows={3}\r\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"Опишите, чему хотели бы научиться\"\r\n            />\r\n          </div>\r\n\r\n          {/* Выбор лектора */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Предпочтительный лектор *\r\n            </label>\r\n            <select\r\n              value={partnerId}\r\n              onChange={(e) => setPartnerId(e.target.value)}\r\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              required\r\n            >\r\n              <option value=\"\">Выберите партнёра</option>\r\n              {partners.map((partner) => (\r\n                <option key={partner.id} value={partner.id}>\r\n                  {partner.name}{' '}\r\n                  {partner.specialization && `(${partner.specialization})`}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Формат */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Предпочтительный формат\r\n            </label>\r\n            <div className=\"flex gap-4\">\r\n              {(Object.keys(FORMAT_LABELS) as TrainingFormat[]).map((f) => (\r\n                <label key={f} className=\"flex items-center gap-2 cursor-pointer\">\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"format\"\r\n                    value={f}\r\n                    checked={format === f}\r\n                    onChange={() => setFormat(f)}\r\n                    className=\"text-blue-600 focus:ring-blue-500\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-700\">{FORMAT_LABELS[f]}</span>\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Время */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Удобное время\r\n            </label>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              {(Object.keys(TIME_SLOT_LABELS) as TrainingTimeSlot[]).map(\r\n                (slot) => (\r\n                  <label\r\n                    key={slot}\r\n                    className={`flex items-center gap-2 p-3 border rounded-lg cursor-pointer transition-colors ${\r\n                      timeSlots.includes(slot)\r\n                        ? 'border-blue-500 bg-blue-50'\r\n                        : 'border-gray-300 hover:bg-gray-50'\r\n                    }`}\r\n                  >\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={timeSlots.includes(slot)}\r\n                      onChange={() => toggleTimeSlot(slot)}\r\n                      className=\"text-blue-600 focus:ring-blue-500\"\r\n                    />\r\n                    <span className=\"text-sm text-gray-700\">\r\n                      {TIME_SLOT_LABELS[slot]}\r\n                    </span>\r\n                  </label>\r\n                )\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Анонимность */}\r\n          {settings.allowAnonymousProposals && (\r\n            <label className=\"flex items-center gap-3 p-4 bg-gray-50 rounded-lg cursor-pointer active:bg-gray-100 touch-manipulation\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"anonymous\"\r\n                checked={isAnonymous}\r\n                onChange={(e) => setIsAnonymous(e.target.checked)}\r\n                className=\"w-5 h-5 md:w-4 md:h-4 text-blue-600 focus:ring-blue-500 rounded\"\r\n              />\r\n              <span className=\"text-sm text-gray-700\">\r\n                Предложить анонимно (ваше имя не будет отображаться для других\r\n                сотрудников)\r\n              </span>\r\n            </label>\r\n          )}\r\n\r\n          {/* Кнопки */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n            >\r\n              Отмена\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2\"\r\n            >\r\n              <Send className=\"w-4 h-4\" />\r\n              Предложить\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Модальное окно голосования\r\nconst VoteModal = ({\r\n  isOpen,\r\n  onClose,\r\n  proposal,\r\n}: {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  proposal: TrainingProposal | null;\r\n}) => {\r\n  const { user } = useAuthStore();\r\n  const { addVote, settings } = useTrainingStore();\r\n\r\n  const [intent, setIntent] = useState<ParticipationIntent>('definitely');\r\n  const [isAnonymous, setIsAnonymous] = useState(false);\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!user || !proposal) return;\r\n\r\n    addVote(proposal.id, {\r\n      participationIntent: intent,\r\n      isAnonymous,\r\n    });\r\n\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen || !proposal) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-xl shadow-xl max-w-md w-full\">\r\n        <div className=\"flex items-center justify-between p-6 border-b\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900\">Голосование</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\r\n          <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n            <h3 className=\"font-medium text-gray-900\">{proposal.topic}</h3>\r\n            <p className=\"text-sm text-gray-500 mt-1\">\r\n              Лектор: {proposal.partnerName}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Выбор намерения */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n              Ваше участие\r\n            </label>\r\n            <div className=\"space-y-2\">\r\n              {(Object.keys(PARTICIPATION_LABELS) as ParticipationIntent[]).map(\r\n                (i) => (\r\n                  <label\r\n                    key={i}\r\n                    className={`flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${\r\n                      intent === i\r\n                        ? 'border-blue-500 bg-blue-50'\r\n                        : 'border-gray-300 hover:bg-gray-50'\r\n                    }`}\r\n                  >\r\n                    <input\r\n                      type=\"radio\"\r\n                      name=\"intent\"\r\n                      value={i}\r\n                      checked={intent === i}\r\n                      onChange={() => setIntent(i)}\r\n                      className=\"text-blue-600 focus:ring-blue-500\"\r\n                    />\r\n                    <span className=\"text-sm text-gray-700\">\r\n                      {PARTICIPATION_LABELS[i]}\r\n                    </span>\r\n                  </label>\r\n                )\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Анонимность */}\r\n          {settings.allowAnonymousVotes && (\r\n            <div className=\"flex items-center gap-3 p-4 bg-gray-50 rounded-lg\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"voteAnonymous\"\r\n                checked={isAnonymous}\r\n                onChange={(e) => setIsAnonymous(e.target.checked)}\r\n                className=\"w-4 h-4 text-blue-600 focus:ring-blue-500\"\r\n              />\r\n              <label htmlFor=\"voteAnonymous\" className=\"text-sm text-gray-700\">\r\n                Голосовать анонимно\r\n              </label>\r\n            </div>\r\n          )}\r\n\r\n          {/* Кнопки */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n            >\r\n              Отмена\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2\"\r\n            >\r\n              <ThumbsUp className=\"w-4 h-4\" />\r\n              Проголосовать\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Модальное окно деталей предложения\r\nconst ProposalDetailModal = ({\r\n  isOpen,\r\n  onClose,\r\n  proposal,\r\n}: {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  proposal: TrainingProposal | null;\r\n}) => {\r\n  const { user } = useAuthStore();\r\n  const {\r\n    getVotesForDisplay,\r\n    getDisplayName,\r\n    hasVoted,\r\n    isRegistered,\r\n    registerForTraining,\r\n    unregisterFromTraining,\r\n    getAverageRating,\r\n    hasFeedback,\r\n    addFeedback,\r\n    settings,\r\n  } = useTrainingStore();\r\n\r\n  const [showFeedbackForm, setShowFeedbackForm] = useState(false);\r\n  const [rating, setRating] = useState(5);\r\n  const [comment, setComment] = useState('');\r\n  const [isFeedbackAnonymous, setIsFeedbackAnonymous] = useState(false);\r\n\r\n  const isAdmin = user?.role === 'admin';\r\n\r\n  if (!isOpen || !proposal) return null;\r\n\r\n  const votes = getVotesForDisplay(proposal.id, isAdmin);\r\n  const userHasVoted = user ? hasVoted(proposal.id, user.id) : false;\r\n  const userIsRegistered = user ? isRegistered(proposal.id, user.id) : false;\r\n  const userHasFeedback = user ? hasFeedback(proposal.id, user.id) : false;\r\n  const avgRating = getAverageRating(proposal.id);\r\n\r\n  const handleRegister = () => {\r\n    if (!user) return;\r\n    if (userIsRegistered) {\r\n      unregisterFromTraining(proposal.id);\r\n    } else {\r\n      registerForTraining(proposal.id);\r\n    }\r\n  };\r\n\r\n  const handleFeedbackSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!user) return;\r\n\r\n    addFeedback(proposal.id, {\r\n      isAnonymous: isFeedbackAnonymous,\r\n      rating,\r\n      comment,\r\n    });\r\n\r\n    setShowFeedbackForm(false);\r\n    setRating(5);\r\n    setComment('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"flex items-center justify-between p-6 border-b\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900\">\r\n              {proposal.topic}\r\n            </h2>\r\n            <span\r\n              className={`px-2 py-1 text-xs font-medium rounded-full ${\r\n                TRAINING_STATUS_COLORS[proposal.status]\r\n              }`}\r\n            >\r\n              {TRAINING_STATUS_LABELS[proposal.status]}\r\n            </span>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Основная информация */}\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n              <p className=\"text-sm text-gray-500\">Автор</p>\r\n              <p className=\"font-medium text-gray-900\">\r\n                {getDisplayName(\r\n                  proposal.authorName,\r\n                  proposal.isAuthorAnonymous,\r\n                  isAdmin\r\n                )}\r\n                {isAdmin && proposal.isAuthorAnonymous && (\r\n                  <span className=\"ml-2 text-xs text-gray-500\">(анонимно)</span>\r\n                )}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n              <p className=\"text-sm text-gray-500\">Лектор</p>\r\n              <p className=\"font-medium text-gray-900\">{proposal.partnerName}</p>\r\n            </div>\r\n            <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n              <p className=\"text-sm text-gray-500\">Формат</p>\r\n              <p className=\"font-medium text-gray-900\">\r\n                {FORMAT_LABELS[proposal.format]}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n              <p className=\"text-sm text-gray-500\">Голосов</p>\r\n              <p className=\"font-medium text-gray-900\">\r\n                {proposal.votes.length} / {proposal.voteThreshold}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Описание */}\r\n          {proposal.description && (\r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-700 mb-2\">Описание</h3>\r\n              <p className=\"text-gray-600\">{proposal.description}</p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Предпочтительное время */}\r\n          {proposal.preferredTimeSlots.length > 0 && (\r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-700 mb-2\">\r\n                Удобное время\r\n              </h3>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {proposal.preferredTimeSlots.map((slot) => (\r\n                  <span\r\n                    key={slot}\r\n                    className=\"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full\"\r\n                  >\r\n                    {TIME_SLOT_LABELS[slot]}\r\n                  </span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Информация о запланированном тренинге */}\r\n          {proposal.status === 'scheduled' && (\r\n            <div className=\"p-4 bg-purple-50 border border-purple-200 rounded-lg\">\r\n              <h3 className=\"font-medium text-purple-900 mb-3 flex items-center gap-2\">\r\n                <Calendar className=\"w-5 h-5\" />\r\n                Тренинг запланирован\r\n              </h3>\r\n              <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Clock className=\"w-4 h-4 text-purple-600\" />\r\n                  <span>\r\n                    {proposal.scheduledDate} в {proposal.scheduledTime}\r\n                  </span>\r\n                </div>\r\n                {proposal.scheduledLocation && (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <MapPin className=\"w-4 h-4 text-purple-600\" />\r\n                    <span>{proposal.scheduledLocation}</span>\r\n                  </div>\r\n                )}\r\n                {proposal.scheduledLink && (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <LinkIcon className=\"w-4 h-4 text-purple-600\" />\r\n                    <a\r\n                      href={proposal.scheduledLink}\r\n                      target=\"_blank\"\r\n                      rel=\"noopener noreferrer\"\r\n                      className=\"text-purple-600 hover:underline\"\r\n                    >\r\n                      Ссылка на онлайн\r\n                    </a>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Users className=\"w-4 h-4 text-purple-600\" />\r\n                  <span>\r\n                    {proposal.registeredParticipants?.length || 0} участников\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Кнопка регистрации */}\r\n              {user && (\r\n                <button\r\n                  onClick={handleRegister}\r\n                  className={`mt-4 w-full py-2 rounded-lg font-medium transition-colors ${\r\n                    userIsRegistered\r\n                      ? 'bg-red-100 text-red-700 hover:bg-red-200'\r\n                      : 'bg-purple-600 text-white hover:bg-purple-700'\r\n                  }`}\r\n                >\r\n                  {userIsRegistered\r\n                    ? 'Отменить регистрацию'\r\n                    : 'Зарегистрироваться'}\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Список голосов */}\r\n          {votes.length > 0 && (\r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-700 mb-3\">\r\n                Голоса ({votes.length})\r\n              </h3>\r\n              <div className=\"space-y-2\">\r\n                {votes.map((vote) => (\r\n                  <div\r\n                    key={vote.id}\r\n                    className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center\">\r\n                        <User className=\"w-4 h-4 text-gray-600\" />\r\n                      </div>\r\n                      <span className=\"text-sm font-medium text-gray-900\">\r\n                        {vote.voterName}\r\n                        {isAdmin && vote.isAnonymous && (\r\n                          <span className=\"ml-2 text-xs text-gray-500\">\r\n                            (анонимно)\r\n                          </span>\r\n                        )}\r\n                      </span>\r\n                    </div>\r\n                    <span\r\n                      className={`px-2 py-1 text-xs font-medium rounded-full ${\r\n                        PARTICIPATION_COLORS[vote.participationIntent]\r\n                      }`}\r\n                    >\r\n                      {PARTICIPATION_LABELS[vote.participationIntent]}\r\n                    </span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Обратная связь для завершённых тренингов */}\r\n          {proposal.status === 'completed' && (\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h3 className=\"text-sm font-medium text-gray-700\">\r\n                  Отзывы ({proposal.feedback?.length || 0})\r\n                </h3>\r\n                {avgRating > 0 && (\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Star className=\"w-4 h-4 text-yellow-500 fill-yellow-500\" />\r\n                    <span className=\"text-sm font-medium\">\r\n                      {avgRating.toFixed(1)}\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Список отзывов */}\r\n              {proposal.feedback && proposal.feedback.length > 0 && (\r\n                <div className=\"space-y-3 mb-4\">\r\n                  {proposal.feedback.map((fb) => (\r\n                    <div key={fb.id} className=\"p-4 bg-gray-50 rounded-lg\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <span className=\"text-sm font-medium text-gray-900\">\r\n                          {getDisplayName(fb.reviewerName, fb.isAnonymous, isAdmin)}\r\n                          {isAdmin && fb.isAnonymous && (\r\n                            <span className=\"ml-2 text-xs text-gray-500\">\r\n                              (анонимно)\r\n                            </span>\r\n                          )}\r\n                        </span>\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {[...Array(5)].map((_, i) => (\r\n                            <Star\r\n                              key={i}\r\n                              className={`w-4 h-4 ${\r\n                                i < fb.rating\r\n                                  ? 'text-yellow-500 fill-yellow-500'\r\n                                  : 'text-gray-300'\r\n                              }`}\r\n                            />\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                      {fb.comment && (\r\n                        <p className=\"text-sm text-gray-600\">{fb.comment}</p>\r\n                      )}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n\r\n              {/* Форма отзыва */}\r\n              {user && !userHasFeedback && !showFeedbackForm && (\r\n                <button\r\n                  onClick={() => setShowFeedbackForm(true)}\r\n                  className=\"w-full py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2\"\r\n                >\r\n                  <MessageSquare className=\"w-4 h-4\" />\r\n                  Оставить отзыв\r\n                </button>\r\n              )}\r\n\r\n              {showFeedbackForm && (\r\n                <form\r\n                  onSubmit={handleFeedbackSubmit}\r\n                  className=\"p-4 border border-gray-200 rounded-lg space-y-4\"\r\n                >\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Оценка\r\n                    </label>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      {[1, 2, 3, 4, 5].map((r) => (\r\n                        <button\r\n                          key={r}\r\n                          type=\"button\"\r\n                          onClick={() => setRating(r)}\r\n                          className=\"p-1\"\r\n                        >\r\n                          <Star\r\n                            className={`w-8 h-8 transition-colors ${\r\n                              r <= rating\r\n                                ? 'text-yellow-500 fill-yellow-500'\r\n                                : 'text-gray-300 hover:text-yellow-400'\r\n                            }`}\r\n                          />\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Комментарий\r\n                    </label>\r\n                    <textarea\r\n                      value={comment}\r\n                      onChange={(e) => setComment(e.target.value)}\r\n                      rows={3}\r\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                      placeholder=\"Поделитесь впечатлениями...\"\r\n                    />\r\n                  </div>\r\n                  {settings.allowAnonymousFeedback && (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        id=\"feedbackAnonymous\"\r\n                        checked={isFeedbackAnonymous}\r\n                        onChange={(e) => setIsFeedbackAnonymous(e.target.checked)}\r\n                        className=\"w-4 h-4 text-blue-600\"\r\n                      />\r\n                      <label\r\n                        htmlFor=\"feedbackAnonymous\"\r\n                        className=\"text-sm text-gray-700\"\r\n                      >\r\n                        Оставить анонимно\r\n                      </label>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowFeedbackForm(false)}\r\n                      className=\"flex-1 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50\"\r\n                    >\r\n                      Отмена\r\n                    </button>\r\n                    <button\r\n                      type=\"submit\"\r\n                      className=\"flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\r\n                    >\r\n                      Отправить\r\n                    </button>\r\n                  </div>\r\n                </form>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Кнопка голосования */}\r\n          {proposal.status === 'voting' && user && !userHasVoted && (\r\n            <div className=\"pt-4 border-t\">\r\n              <p className=\"text-sm text-gray-500 mb-3\">\r\n                Вы ещё не голосовали за это предложение\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Модальное окно админ-панели\r\nconst AdminPanel = ({\r\n  isOpen,\r\n  onClose,\r\n}: {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}) => {\r\n  const {\r\n    getProposalsByStatus,\r\n    setPartnerResponse,\r\n    scheduleTraining,\r\n    settings,\r\n    updateSettings,\r\n    getStats,\r\n  } = useTrainingStore();\r\n\r\n  const [selectedProposal, setSelectedProposal] =\r\n    useState<TrainingProposal | null>(null);\r\n  const [scheduleDate, setScheduleDate] = useState('');\r\n  const [scheduleTime, setScheduleTime] = useState('');\r\n  const [scheduleLocation, setScheduleLocation] = useState('');\r\n  const [scheduleLink, setScheduleLink] = useState('');\r\n  const [activeTab, setActiveTab] = useState<'review' | 'settings' | 'stats'>(\r\n    'review'\r\n  );\r\n\r\n  const reviewProposals = getProposalsByStatus('review');\r\n  const approvedProposals = getProposalsByStatus('approved');\r\n  const stats = getStats();\r\n\r\n  const handleSchedule = () => {\r\n    if (!selectedProposal || !scheduleDate || !scheduleTime) return;\r\n\r\n    scheduleTraining(selectedProposal.id, {\r\n      scheduledDate: scheduleDate,\r\n      scheduledTime: scheduleTime,\r\n      scheduledLocation: scheduleLocation || undefined,\r\n      scheduledLink: scheduleLink || undefined,\r\n    });\r\n\r\n    setSelectedProposal(null);\r\n    setScheduleDate('');\r\n    setScheduleTime('');\r\n    setScheduleLocation('');\r\n    setScheduleLink('');\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"flex items-center justify-between p-6 border-b\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 flex items-center gap-2\">\r\n            <Settings className=\"w-5 h-5\" />\r\n            Управление тренингами\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Вкладки */}\r\n        <div className=\"flex border-b\">\r\n          <button\r\n            onClick={() => setActiveTab('review')}\r\n            className={`px-6 py-3 text-sm font-medium transition-colors ${\r\n              activeTab === 'review'\r\n                ? 'text-blue-600 border-b-2 border-blue-600'\r\n                : 'text-gray-600 hover:text-gray-900'\r\n            }`}\r\n          >\r\n            На рассмотрении ({reviewProposals.length + approvedProposals.length})\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab('stats')}\r\n            className={`px-6 py-3 text-sm font-medium transition-colors ${\r\n              activeTab === 'stats'\r\n                ? 'text-blue-600 border-b-2 border-blue-600'\r\n                : 'text-gray-600 hover:text-gray-900'\r\n            }`}\r\n          >\r\n            Статистика\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab('settings')}\r\n            className={`px-6 py-3 text-sm font-medium transition-colors ${\r\n              activeTab === 'settings'\r\n                ? 'text-blue-600 border-b-2 border-blue-600'\r\n                : 'text-gray-600 hover:text-gray-900'\r\n            }`}\r\n          >\r\n            Настройки\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6\">\r\n          {/* Вкладка рассмотрения */}\r\n          {activeTab === 'review' && (\r\n            <div className=\"space-y-6\">\r\n              {/* Предложения на рассмотрении */}\r\n              {reviewProposals.length > 0 && (\r\n                <div>\r\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n                    Ожидают ответа партнёра\r\n                  </h3>\r\n                  <div className=\"space-y-3\">\r\n                    {reviewProposals.map((p) => (\r\n                      <div\r\n                        key={p.id}\r\n                        className=\"p-4 border border-yellow-200 bg-yellow-50 rounded-lg\"\r\n                      >\r\n                        <div className=\"flex items-start justify-between\">\r\n                          <div>\r\n                            <h4 className=\"font-medium text-gray-900\">\r\n                              {p.topic}\r\n                            </h4>\r\n                            <p className=\"text-sm text-gray-600 mt-1\">\r\n                              Лектор: {p.partnerName}\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-500\">\r\n                              Голосов: {p.votes.length}\r\n                            </p>\r\n                          </div>\r\n                          <div className=\"flex gap-2\">\r\n                            <button\r\n                              onClick={() =>\r\n                                setPartnerResponse(p.id, 'accepted')\r\n                              }\r\n                              className=\"px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700\"\r\n                            >\r\n                              Принять\r\n                            </button>\r\n                            <button\r\n                              onClick={() =>\r\n                                setPartnerResponse(p.id, 'rejected')\r\n                              }\r\n                              className=\"px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700\"\r\n                            >\r\n                              Отклонить\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Одобренные - нужно запланировать */}\r\n              {approvedProposals.length > 0 && (\r\n                <div>\r\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n                    Требуют планирования\r\n                  </h3>\r\n                  <div className=\"space-y-3\">\r\n                    {approvedProposals.map((p) => (\r\n                      <div\r\n                        key={p.id}\r\n                        className=\"p-4 border border-green-200 bg-green-50 rounded-lg\"\r\n                      >\r\n                        <div className=\"flex items-start justify-between\">\r\n                          <div>\r\n                            <h4 className=\"font-medium text-gray-900\">\r\n                              {p.topic}\r\n                            </h4>\r\n                            <p className=\"text-sm text-gray-600 mt-1\">\r\n                              Лектор: {p.partnerName}\r\n                            </p>\r\n                          </div>\r\n                          <button\r\n                            onClick={() => setSelectedProposal(p)}\r\n                            className=\"px-3 py-1 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700\"\r\n                          >\r\n                            Запланировать\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Форма планирования */}\r\n              {selectedProposal && (\r\n                <div className=\"p-4 border border-purple-200 bg-purple-50 rounded-lg\">\r\n                  <h3 className=\"font-medium text-purple-900 mb-4\">\r\n                    Планирование: {selectedProposal.topic}\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Дата *\r\n                      </label>\r\n                      <input\r\n                        type=\"date\"\r\n                        value={scheduleDate}\r\n                        onChange={(e) => setScheduleDate(e.target.value)}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Время *\r\n                      </label>\r\n                      <input\r\n                        type=\"time\"\r\n                        value={scheduleTime}\r\n                        onChange={(e) => setScheduleTime(e.target.value)}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Место (офлайн)\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={scheduleLocation}\r\n                        onChange={(e) => setScheduleLocation(e.target.value)}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n                        placeholder=\"Конференц-зал\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Ссылка (онлайн)\r\n                      </label>\r\n                      <input\r\n                        type=\"url\"\r\n                        value={scheduleLink}\r\n                        onChange={(e) => setScheduleLink(e.target.value)}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n                        placeholder=\"https://meet.google.com/...\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex gap-3 mt-4\">\r\n                    <button\r\n                      onClick={() => setSelectedProposal(null)}\r\n                      className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50\"\r\n                    >\r\n                      Отмена\r\n                    </button>\r\n                    <button\r\n                      onClick={handleSchedule}\r\n                      className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700\"\r\n                    >\r\n                      Запланировать\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {reviewProposals.length === 0 && approvedProposals.length === 0 && (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  <CheckCircle className=\"w-12 h-12 mx-auto mb-3 text-green-500\" />\r\n                  <p>Нет предложений на рассмотрении</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Вкладка статистики */}\r\n          {activeTab === 'stats' && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <div className=\"p-4 bg-blue-50 rounded-lg text-center\">\r\n                  <p className=\"text-3xl font-bold text-blue-600\">\r\n                    {stats.totalProposals}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">Всего предложений</p>\r\n                </div>\r\n                <div className=\"p-4 bg-green-50 rounded-lg text-center\">\r\n                  <p className=\"text-3xl font-bold text-green-600\">\r\n                    {stats.scheduledTrainings}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">Запланировано</p>\r\n                </div>\r\n                <div className=\"p-4 bg-purple-50 rounded-lg text-center\">\r\n                  <p className=\"text-3xl font-bold text-purple-600\">\r\n                    {stats.completedTrainings}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">Проведено</p>\r\n                </div>\r\n                <div className=\"p-4 bg-yellow-50 rounded-lg text-center\">\r\n                  <p className=\"text-3xl font-bold text-yellow-600\">\r\n                    {stats.averageRating.toFixed(1)}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">Средняя оценка</p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n                  <p className=\"text-2xl font-bold text-gray-900\">\r\n                    {stats.totalVotes}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">Всего голосов</p>\r\n                </div>\r\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n                  <p className=\"text-2xl font-bold text-gray-900\">\r\n                    {stats.totalParticipants}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">Участников</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Вкладка настроек */}\r\n          {activeTab === 'settings' && (\r\n            <div className=\"space-y-6\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Порог голосов для рассмотрения\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={settings.voteThreshold}\r\n                  onChange={(e) =>\r\n                    updateSettings({ voteThreshold: parseInt(e.target.value) })\r\n                  }\r\n                  min={1}\r\n                  max={50}\r\n                  className=\"w-32 px-3 py-2 border border-gray-300 rounded-lg\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-3\">\r\n                <label className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={settings.allowAnonymousProposals}\r\n                    onChange={(e) =>\r\n                      updateSettings({\r\n                        allowAnonymousProposals: e.target.checked,\r\n                      })\r\n                    }\r\n                    className=\"w-4 h-4 text-blue-600\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-700\">\r\n                    Разрешить анонимные предложения\r\n                  </span>\r\n                </label>\r\n\r\n                <label className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={settings.allowAnonymousVotes}\r\n                    onChange={(e) =>\r\n                      updateSettings({ allowAnonymousVotes: e.target.checked })\r\n                    }\r\n                    className=\"w-4 h-4 text-blue-600\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-700\">\r\n                    Разрешить анонимное голосование\r\n                  </span>\r\n                </label>\r\n\r\n                <label className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={settings.allowAnonymousFeedback}\r\n                    onChange={(e) =>\r\n                      updateSettings({\r\n                        allowAnonymousFeedback: e.target.checked,\r\n                      })\r\n                    }\r\n                    className=\"w-4 h-4 text-blue-600\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-700\">\r\n                    Разрешить анонимные отзывы\r\n                  </span>\r\n                </label>\r\n\r\n                <label className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={settings.notifyAllOnNewProposal}\r\n                    onChange={(e) =>\r\n                      updateSettings({\r\n                        notifyAllOnNewProposal: e.target.checked,\r\n                      })\r\n                    }\r\n                    className=\"w-4 h-4 text-blue-600\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-700\">\r\n                    Уведомлять всех о новых предложениях\r\n                  </span>\r\n                </label>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Автозакрытие через (дней, 0 = выкл)\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={settings.autoCloseAfterDays || 0}\r\n                  onChange={(e) =>\r\n                    updateSettings({\r\n                      autoCloseAfterDays:\r\n                        parseInt(e.target.value) || undefined,\r\n                    })\r\n                  }\r\n                  min={0}\r\n                  max={365}\r\n                  className=\"w-32 px-3 py-2 border border-gray-300 rounded-lg\"\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Главный компонент страницы\r\nexport default function TrainingsPage() {\r\n  const { user } = useAuthStore();\r\n  const {\r\n    proposals,\r\n    getProposalsByStatus,\r\n    hasVoted,\r\n    getStats,\r\n  } = useTrainingStore();\r\n\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [showVoteModal, setShowVoteModal] = useState(false);\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n  const [showAdminPanel, setShowAdminPanel] = useState(false);\r\n  const [selectedProposal, setSelectedProposal] =\r\n    useState<TrainingProposal | null>(null);\r\n  const [filterStatus, setFilterStatus] = useState<\r\n    TrainingProposalStatus | 'all'\r\n  >('all');\r\n\r\n  const isAdmin = user?.role === 'admin';\r\n  const stats = getStats();\r\n\r\n  const filteredProposals =\r\n    filterStatus === 'all'\r\n      ? proposals\r\n      : getProposalsByStatus(filterStatus);\r\n\r\n  const handleVote = (proposal: TrainingProposal) => {\r\n    setSelectedProposal(proposal);\r\n    setShowVoteModal(true);\r\n  };\r\n\r\n  const handleViewDetail = (proposal: TrainingProposal) => {\r\n    setSelectedProposal(proposal);\r\n    setShowDetailModal(true);\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Заголовок */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-gray-900 flex items-center gap-3\">\r\n            <GraduationCap className=\"w-8 h-8 text-blue-600\" />\r\n            Тренинги\r\n          </h1>\r\n          <p className=\"text-gray-600 mt-1\">\r\n            Предлагайте темы, голосуйте и развивайтесь вместе\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-3\">\r\n          {isAdmin && (\r\n            <button\r\n              onClick={() => setShowAdminPanel(true)}\r\n              className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2\"\r\n            >\r\n              <Settings className=\"w-4 h-4\" />\r\n              Управление\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={() => setShowCreateModal(true)}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2\"\r\n          >\r\n            <Plus className=\"w-4 h-4\" />\r\n            Предложить тренинг\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Статистика */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <StatCard\r\n          icon={Vote}\r\n          label=\"На голосовании\"\r\n          value={stats.votingProposals}\r\n          color=\"bg-blue-500\"\r\n        />\r\n        <StatCard\r\n          icon={Calendar}\r\n          label=\"Запланировано\"\r\n          value={stats.scheduledTrainings}\r\n          color=\"bg-purple-500\"\r\n        />\r\n        <StatCard\r\n          icon={CheckCircle}\r\n          label=\"Проведено\"\r\n          value={stats.completedTrainings}\r\n          color=\"bg-green-500\"\r\n        />\r\n        <StatCard\r\n          icon={Star}\r\n          label=\"Средняя оценка\"\r\n          value={stats.averageRating.toFixed(1)}\r\n          color=\"bg-orange-500\"\r\n        />\r\n      </div>\r\n\r\n      {/* Фильтры */}\r\n      <div className=\"flex gap-2 flex-wrap\">\r\n        <button\r\n          onClick={() => setFilterStatus('all')}\r\n          className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\r\n            filterStatus === 'all'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n          }`}\r\n        >\r\n          Все ({proposals.length})\r\n        </button>\r\n        {(\r\n          ['voting', 'review', 'scheduled', 'completed', 'rejected'] as TrainingProposalStatus[]\r\n        ).map((status) => {\r\n          const count = getProposalsByStatus(status).length;\r\n          return (\r\n            <button\r\n              key={status}\r\n              onClick={() => setFilterStatus(status)}\r\n              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\r\n                filterStatus === status\r\n                  ? 'bg-blue-600 text-white'\r\n                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n              }`}\r\n            >\r\n              {TRAINING_STATUS_LABELS[status]} ({count})\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Список предложений */}\r\n      <div className=\"space-y-4\">\r\n        {filteredProposals.length === 0 ? (\r\n          <div className=\"text-center py-12 bg-white rounded-xl border border-gray-100\">\r\n            <GraduationCap className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\r\n            <p className=\"text-gray-500 text-lg\">Нет предложений</p>\r\n            <p className=\"text-gray-400 mt-1\">\r\n              Будьте первым, кто предложит тему для тренинга!\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          filteredProposals.map((proposal) => {\r\n            const userHasVoted = user ? hasVoted(proposal.id, user.id) : false;\r\n            const progress =\r\n              (proposal.votes.length / proposal.voteThreshold) * 100;\r\n\r\n            return (\r\n              <div\r\n                key={proposal.id}\r\n                className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow\"\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                      <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                        {proposal.topic}\r\n                      </h3>\r\n                      <span\r\n                        className={`px-2 py-1 text-xs font-medium rounded-full ${\r\n                          TRAINING_STATUS_COLORS[proposal.status]\r\n                        }`}\r\n                      >\r\n                        {TRAINING_STATUS_LABELS[proposal.status]}\r\n                      </span>\r\n                    </div>\r\n\r\n                    {proposal.description && (\r\n                      <p className=\"text-gray-600 mb-3\">{proposal.description}</p>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center gap-4 text-sm text-gray-500\">\r\n                      <span className=\"flex items-center gap-1\">\r\n                        <User className=\"w-4 h-4\" />\r\n                        Лектор: {proposal.partnerName}\r\n                      </span>\r\n                      <span className=\"flex items-center gap-1\">\r\n                        {FORMAT_LABELS[proposal.format]}\r\n                      </span>\r\n                      {proposal.status === 'scheduled' && (\r\n                        <span className=\"flex items-center gap-1 text-purple-600\">\r\n                          <Calendar className=\"w-4 h-4\" />\r\n                          {proposal.scheduledDate} в {proposal.scheduledTime}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Прогресс голосования */}\r\n                    {proposal.status === 'voting' && (\r\n                      <div className=\"mt-4\">\r\n                        <div className=\"flex items-center justify-between text-sm mb-1\">\r\n                          <span className=\"text-gray-600\">\r\n                            Голосов: {proposal.votes.length} /{' '}\r\n                            {proposal.voteThreshold}\r\n                          </span>\r\n                          <span className=\"text-gray-500\">\r\n                            {Math.round(progress)}%\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"h-2 bg-gray-200 rounded-full overflow-hidden\">\r\n                          <div\r\n                            className=\"h-full bg-blue-500 rounded-full transition-all\"\r\n                            style={{ width: `${Math.min(progress, 100)}%` }}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Участники для запланированных */}\r\n                    {proposal.status === 'scheduled' && (\r\n                      <div className=\"mt-3 flex items-center gap-2 text-sm\">\r\n                        <UserCheck className=\"w-4 h-4 text-green-600\" />\r\n                        <span className=\"text-gray-600\">\r\n                          Зарегистрировано:{' '}\r\n                          {proposal.registeredParticipants?.length || 0}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Кнопки действий */}\r\n                  <div className=\"flex gap-2 ml-4\">\r\n                    <button\r\n                      onClick={() => handleViewDetail(proposal)}\r\n                      className=\"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors\"\r\n                      title=\"Подробнее\"\r\n                    >\r\n                      <Eye className=\"w-5 h-5\" />\r\n                    </button>\r\n\r\n                    {proposal.status === 'voting' && user && !userHasVoted && (\r\n                      <button\r\n                        onClick={() => handleVote(proposal)}\r\n                        className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2\"\r\n                      >\r\n                        <ThumbsUp className=\"w-4 h-4\" />\r\n                        Голосовать\r\n                      </button>\r\n                    )}\r\n\r\n                    {proposal.status === 'voting' && user && userHasVoted && (\r\n                      <span className=\"px-4 py-2 bg-green-100 text-green-700 rounded-lg flex items-center gap-2\">\r\n                        <CheckCircle className=\"w-4 h-4\" />\r\n                        Вы проголосовали\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })\r\n        )}\r\n      </div>\r\n\r\n      {/* Модальные окна */}\r\n      <CreateProposalModal\r\n        isOpen={showCreateModal}\r\n        onClose={() => setShowCreateModal(false)}\r\n      />\r\n\r\n      <VoteModal\r\n        isOpen={showVoteModal}\r\n        onClose={() => {\r\n          setShowVoteModal(false);\r\n          setSelectedProposal(null);\r\n        }}\r\n        proposal={selectedProposal}\r\n      />\r\n\r\n      <ProposalDetailModal\r\n        isOpen={showDetailModal}\r\n        onClose={() => {\r\n          setShowDetailModal(false);\r\n          setSelectedProposal(null);\r\n        }}\r\n        proposal={selectedProposal}\r\n      />\r\n\r\n      <AdminPanel\r\n        isOpen={showAdminPanel}\r\n        onClose={() => setShowAdminPanel(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["mapPartnerFromApi","p","mapVoteFromApi","v","mapFeedbackFromApi","f","mapProposalFromApi","r","mapNotificationFromApi","n","mapSettingsFromApi","s","defaultSettings","useTrainingStore","create","persist","set","get","activeOnly","response","trainingPartnersApi","partnerData","newPartner","state","id","options","trainingProposalsApi","proposal","proposalData","newProposal","status","userId","proposalId","voteData","trainingVotesApi","voterId","note","data","actualParticipantsCount","trainingRegistrationsApi","feedbackData","trainingFeedbackApi","reviewerId","acc","unreadOnly","trainingNotificationsApi","recipientId","trainingSettingsApi","settingsData","apiSettings","proposals","completedProposals","totalRating","ratingCount","name","isAnonymous","isAdmin","vote","TRAINING_STATUS_LABELS","TRAINING_STATUS_COLORS","FORMAT_LABELS","TIME_SLOT_LABELS","PARTICIPATION_LABELS","PARTICIPATION_COLORS","StatCard","Icon","label","value","color","jsxs","jsx","CreateProposalModal","isOpen","onClose","user","useAuthStore","addProposal","getActivePartners","settings","topic","setTopic","useState","description","setDescription","partnerId","setPartnerId","format","setFormat","timeSlots","setTimeSlots","setIsAnonymous","partners","handleSubmit","e","toggleTimeSlot","slot","prev","X","partner","Send","VoteModal","addVote","intent","setIntent","i","ThumbsUp","ProposalDetailModal","getVotesForDisplay","getDisplayName","hasVoted","isRegistered","registerForTraining","unregisterFromTraining","getAverageRating","hasFeedback","addFeedback","showFeedbackForm","setShowFeedbackForm","rating","setRating","comment","setComment","isFeedbackAnonymous","setIsFeedbackAnonymous","votes","userHasVoted","userIsRegistered","userHasFeedback","avgRating","handleRegister","handleFeedbackSubmit","Calendar","Clock","MapPin","LinkIcon","Users","User","Star","fb","_","MessageSquare","AdminPanel","getProposalsByStatus","setPartnerResponse","scheduleTraining","updateSettings","getStats","selectedProposal","setSelectedProposal","scheduleDate","setScheduleDate","scheduleTime","setScheduleTime","scheduleLocation","setScheduleLocation","scheduleLink","setScheduleLink","activeTab","setActiveTab","reviewProposals","approvedProposals","stats","handleSchedule","Settings","CheckCircle","TrainingsPage","showCreateModal","setShowCreateModal","showVoteModal","setShowVoteModal","showDetailModal","setShowDetailModal","showAdminPanel","setShowAdminPanel","filterStatus","setFilterStatus","filteredProposals","handleVote","handleViewDetail","GraduationCap","Plus","Vote","count","progress","UserCheck","Eye"],"mappings":"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"}
{"version":3,"file":"ResidentAnnouncementsPage-1768582427694-cbqPbsxP.js","sources":["../../src/pages/ResidentAnnouncementsPage.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { Megaphone, AlertTriangle, AlertCircle, Info, ChevronRight, Check } from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useDataStore } from '../stores/dataStore';\r\nimport { useLanguageStore } from '../stores/languageStore';\r\nimport type { Announcement, AnnouncementPriority } from '../types';\r\n\r\nexport function ResidentAnnouncementsPage() {\r\n  const { user } = useAuthStore();\r\n  const { getAnnouncementsForResidents, markAnnouncementAsViewed, fetchAnnouncements } = useDataStore();\r\n  const { language } = useLanguageStore();\r\n  const [expandedId, setExpandedId] = useState<string | null>(null);\r\n  const [filter, setFilter] = useState<'all' | 'unread'>('all');\r\n\r\n  // Fetch announcements on component mount\r\n  useEffect(() => {\r\n    fetchAnnouncements();\r\n  }, [fetchAnnouncements]);\r\n\r\n  // Get user's targeting info\r\n  const userLogin = user?.login || '';\r\n  const userBuilding = user?.buildingId || '';\r\n  const userEntrance = user?.entrance || '';\r\n  const userFloor = user?.floor || '';\r\n  const userBranch = user?.branch || '';\r\n\r\n  const announcements = getAnnouncementsForResidents(userLogin, userBuilding, userEntrance, userFloor, userBranch);\r\n\r\n  const filteredAnnouncements = filter === 'unread'\r\n    ? announcements.filter(a => !a.viewedBy.includes(user?.id || ''))\r\n    : announcements;\r\n\r\n  const unreadCount = announcements.filter(a => !a.viewedBy.includes(user?.id || '')).length;\r\n\r\n  const handleExpand = (announcement: Announcement) => {\r\n    if (expandedId === announcement.id) {\r\n      setExpandedId(null);\r\n    } else {\r\n      setExpandedId(announcement.id);\r\n      // Mark as viewed when expanded\r\n      if (user?.id && !announcement.viewedBy.includes(user.id)) {\r\n        markAnnouncementAsViewed(announcement.id, user.id);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getPriorityStyles = (priority: AnnouncementPriority) => {\r\n    switch (priority) {\r\n      case 'urgent':\r\n        return {\r\n          bg: 'bg-red-50 border-red-200',\r\n          badge: 'bg-red-100 text-red-700',\r\n          icon: <AlertTriangle className=\"w-5 h-5 text-red-500\" />,\r\n          label: language === 'ru' ? 'Срочно' : 'Shoshilinch'\r\n        };\r\n      case 'important':\r\n        return {\r\n          bg: 'bg-amber-50 border-amber-200',\r\n          badge: 'bg-amber-100 text-amber-700',\r\n          icon: <AlertCircle className=\"w-5 h-5 text-amber-500\" />,\r\n          label: language === 'ru' ? 'Важно' : 'Muhim'\r\n        };\r\n      default:\r\n        return {\r\n          bg: 'bg-blue-50 border-blue-200',\r\n          badge: 'bg-blue-100 text-blue-700',\r\n          icon: <Info className=\"w-5 h-5 text-blue-500\" />,\r\n          label: language === 'ru' ? 'Информация' : 'Ma\\'lumot'\r\n        };\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\r\n      day: '2-digit',\r\n      month: 'long',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <h1 className=\"text-xl md:text-2xl font-bold flex items-center gap-3\">\r\n          <Megaphone className=\"w-7 h-7 text-primary-500\" />\r\n          {language === 'ru' ? 'Объявления' : 'E\\'lonlar'}\r\n        </h1>\r\n\r\n        {unreadCount > 0 && (\r\n          <span className=\"px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-sm font-medium\">\r\n            {unreadCount} {language === 'ru' ? 'новых' : 'yangi'}\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {/* Filter */}\r\n      <div className=\"flex gap-2\">\r\n        <button\r\n          onClick={() => setFilter('all')}\r\n          className={`px-4 py-2 rounded-xl font-medium text-sm transition-colors ${\r\n            filter === 'all'\r\n              ? 'bg-primary-500 text-gray-900'\r\n              : 'bg-white/60 text-gray-600 hover:bg-white/80'\r\n          }`}\r\n        >\r\n          {language === 'ru' ? 'Все' : 'Hammasi'} ({announcements.length})\r\n        </button>\r\n        <button\r\n          onClick={() => setFilter('unread')}\r\n          className={`px-4 py-2 rounded-xl font-medium text-sm transition-colors ${\r\n            filter === 'unread'\r\n              ? 'bg-primary-500 text-gray-900'\r\n              : 'bg-white/60 text-gray-600 hover:bg-white/80'\r\n          }`}\r\n        >\r\n          {language === 'ru' ? 'Непрочитанные' : 'O\\'qilmagan'} ({unreadCount})\r\n        </button>\r\n      </div>\r\n\r\n      {/* Announcements List */}\r\n      {filteredAnnouncements.length === 0 ? (\r\n        <div className=\"glass-card p-8 text-center\">\r\n          <Megaphone className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n          <p className=\"text-gray-500\">\r\n            {filter === 'unread'\r\n              ? (language === 'ru' ? 'Нет новых объявлений' : 'Yangi e\\'lonlar yo\\'q')\r\n              : (language === 'ru' ? 'Объявлений пока нет' : 'E\\'lonlar yo\\'q')}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-3\">\r\n          {filteredAnnouncements.map((announcement) => {\r\n            const isUnread = !announcement.viewedBy.includes(user?.id || '');\r\n            const isExpanded = expandedId === announcement.id;\r\n            const styles = getPriorityStyles(announcement.priority);\r\n\r\n            return (\r\n              <div\r\n                key={announcement.id}\r\n                className={`glass-card p-4 border-2 cursor-pointer transition-all ${styles.bg} ${\r\n                  isUnread ? 'ring-2 ring-yellow-400 ring-offset-2' : ''\r\n                }`}\r\n                onClick={() => handleExpand(announcement)}\r\n              >\r\n                <div className=\"flex items-start gap-3\">\r\n                  <div className=\"flex-shrink-0 mt-0.5\">\r\n                    {styles.icon}\r\n                  </div>\r\n\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    {/* Header */}\r\n                    <div className=\"flex items-center gap-2 flex-wrap mb-2\">\r\n                      {isUnread && (\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-yellow-400 text-yellow-900 text-xs font-medium\">\r\n                          {language === 'ru' ? 'Новое' : 'Yangi'}\r\n                        </span>\r\n                      )}\r\n                      <span className={`px-2 py-0.5 rounded-lg text-xs font-medium ${styles.badge}`}>\r\n                        {styles.label}\r\n                      </span>\r\n                    </div>\r\n\r\n                    {/* Title */}\r\n                    <h3 className=\"font-semibold text-base text-gray-900 mb-1\">\r\n                      {announcement.title}\r\n                    </h3>\r\n\r\n                    {/* Content */}\r\n                    <p className={`text-gray-600 text-sm ${isExpanded ? '' : 'line-clamp-2'}`}>\r\n                      {announcement.content}\r\n                    </p>\r\n\r\n                    {/* Meta */}\r\n                    <div className=\"flex items-center gap-3 mt-3 text-xs text-gray-500\">\r\n                      <span>{formatDate(announcement.createdAt)}</span>\r\n                      <span>{announcement.authorName}</span>\r\n                      {!isUnread && (\r\n                        <span className=\"flex items-center gap-1 text-green-600\">\r\n                          <Check className=\"w-3 h-3\" />\r\n                          {language === 'ru' ? 'Прочитано' : 'O\\'qilgan'}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <ChevronRight className={`w-5 h-5 text-gray-400 flex-shrink-0 transition-transform ${\r\n                    isExpanded ? 'rotate-90' : ''\r\n                  }`} />\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ResidentAnnouncementsPage","user","useAuthStore","getAnnouncementsForResidents","markAnnouncementAsViewed","fetchAnnouncements","useDataStore","language","useLanguageStore","expandedId","setExpandedId","useState","filter","setFilter","useEffect","userLogin","userBuilding","userEntrance","userFloor","userBranch","announcements","filteredAnnouncements","a","unreadCount","handleExpand","announcement","getPriorityStyles","priority","jsx","AlertTriangle","AlertCircle","Info","formatDate","dateStr","jsxs","Megaphone","isUnread","isExpanded","styles","Check","ChevronRight"],"mappings":"0TAOO,SAASA,GAA4B,CAC1C,KAAM,CAAE,KAAAC,CAAA,EAASC,EAAA,EACX,CAAE,6BAAAC,EAA8B,yBAAAC,EAA0B,mBAAAC,CAAA,EAAuBC,EAAA,EACjF,CAAE,SAAAC,CAAA,EAAaC,EAAA,EACf,CAACC,EAAYC,CAAa,EAAIC,EAAAA,SAAwB,IAAI,EAC1D,CAACC,EAAQC,CAAS,EAAIF,EAAAA,SAA2B,KAAK,EAG5DG,EAAAA,UAAU,IAAM,CACdT,EAAA,CACF,EAAG,CAACA,CAAkB,CAAC,EAGvB,MAAMU,EAAYd,GAAM,OAAS,GAC3Be,EAAef,GAAM,YAAc,GACnCgB,EAAehB,GAAM,UAAY,GACjCiB,EAAYjB,GAAM,OAAS,GAC3BkB,EAAalB,GAAM,QAAU,GAE7BmB,EAAgBjB,EAA6BY,EAAWC,EAAcC,EAAcC,EAAWC,CAAU,EAEzGE,EAAwBT,IAAW,SACrCQ,EAAc,OAAOE,GAAK,CAACA,EAAE,SAAS,SAASrB,GAAM,IAAM,EAAE,CAAC,EAC9DmB,EAEEG,EAAcH,EAAc,OAAOE,GAAK,CAACA,EAAE,SAAS,SAASrB,GAAM,IAAM,EAAE,CAAC,EAAE,OAE9EuB,EAAgBC,GAA+B,CAC/ChB,IAAegB,EAAa,GAC9Bf,EAAc,IAAI,GAElBA,EAAce,EAAa,EAAE,EAEzBxB,GAAM,IAAM,CAACwB,EAAa,SAAS,SAASxB,EAAK,EAAE,GACrDG,EAAyBqB,EAAa,GAAIxB,EAAK,EAAE,EAGvD,EAEMyB,EAAqBC,GAAmC,CAC5D,OAAQA,EAAA,CACN,IAAK,SACH,MAAO,CACL,GAAI,2BACJ,MAAO,0BACP,KAAMC,EAAAA,IAACC,EAAA,CAAc,UAAU,sBAAA,CAAuB,EACtD,MAAOtB,IAAa,KAAO,SAAW,aAAA,EAE1C,IAAK,YACH,MAAO,CACL,GAAI,+BACJ,MAAO,8BACP,KAAMqB,EAAAA,IAACE,EAAA,CAAY,UAAU,wBAAA,CAAyB,EACtD,MAAOvB,IAAa,KAAO,QAAU,OAAA,EAEzC,QACE,MAAO,CACL,GAAI,6BACJ,MAAO,4BACP,KAAMqB,EAAAA,IAACG,EAAA,CAAK,UAAU,uBAAA,CAAwB,EAC9C,MAAOxB,IAAa,KAAO,aAAe,UAAA,CAC5C,CAEN,EAEMyB,EAAcC,GACL,IAAI,KAAKA,CAAO,EACjB,mBAAmB1B,IAAa,KAAO,QAAU,QAAS,CACpE,IAAK,UACL,MAAO,OACP,KAAM,UACN,KAAM,UACN,OAAQ,SAAA,CACT,EAGH,OACE2B,EAAAA,KAAC,MAAA,CAAI,UAAU,uCAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,wDACZ,SAAA,CAAAN,EAAAA,IAACO,EAAA,CAAU,UAAU,0BAAA,CAA2B,EAC/C5B,IAAa,KAAO,aAAe,UAAA,EACtC,EAECgB,EAAc,GACbW,OAAC,OAAA,CAAK,UAAU,2EACb,SAAA,CAAAX,EAAY,IAAEhB,IAAa,KAAO,QAAU,OAAA,CAAA,CAC/C,CAAA,EAEJ,EAGA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,QAAS,IAAMrB,EAAU,KAAK,EAC9B,UAAW,8DACTD,IAAW,MACP,+BACA,6CACN,GAEC,SAAA,CAAAL,IAAa,KAAO,MAAQ,UAAU,KAAGa,EAAc,OAAO,GAAA,CAAA,CAAA,EAEjEc,EAAAA,KAAC,SAAA,CACC,QAAS,IAAMrB,EAAU,QAAQ,EACjC,UAAW,8DACTD,IAAW,SACP,+BACA,6CACN,GAEC,SAAA,CAAAL,IAAa,KAAO,gBAAkB,aAAc,KAAGgB,EAAY,GAAA,CAAA,CAAA,CACtE,EACF,EAGCF,EAAsB,SAAW,EAChCa,EAAAA,KAAC,MAAA,CAAI,UAAU,6BACb,SAAA,CAAAN,EAAAA,IAACO,EAAA,CAAU,UAAU,sCAAA,CAAuC,EAC5DP,EAAAA,IAAC,IAAA,CAAE,UAAU,gBACV,SAAAhB,IAAW,SACPL,IAAa,KAAO,uBAAyB,sBAC7CA,IAAa,KAAO,sBAAwB,eAAA,CACnD,CAAA,CAAA,CACF,QAEC,MAAA,CAAI,UAAU,YACZ,SAAAc,EAAsB,IAAKI,GAAiB,CAC3C,MAAMW,EAAW,CAACX,EAAa,SAAS,SAASxB,GAAM,IAAM,EAAE,EACzDoC,EAAa5B,IAAegB,EAAa,GACzCa,EAASZ,EAAkBD,EAAa,QAAQ,EAEtD,OACEG,EAAAA,IAAC,MAAA,CAEC,UAAW,yDAAyDU,EAAO,EAAE,IAC3EF,EAAW,uCAAyC,EACtD,GACA,QAAS,IAAMZ,EAAaC,CAAY,EAExC,SAAAS,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAN,EAAAA,IAAC,MAAA,CAAI,UAAU,uBACZ,SAAAU,EAAO,KACV,EAEAJ,EAAAA,KAAC,MAAA,CAAI,UAAU,iBAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACZ,SAAA,CAAAE,SACE,OAAA,CAAK,UAAU,6EACb,SAAA7B,IAAa,KAAO,QAAU,OAAA,CACjC,EAEFqB,EAAAA,IAAC,QAAK,UAAW,8CAA8CU,EAAO,KAAK,GACxE,WAAO,KAAA,CACV,CAAA,EACF,EAGAV,EAAAA,IAAC,KAAA,CAAG,UAAU,6CACX,WAAa,MAChB,EAGAA,EAAAA,IAAC,KAAE,UAAW,yBAAyBS,EAAa,GAAK,cAAc,GACpE,SAAAZ,EAAa,OAAA,CAChB,EAGAS,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAN,EAAAA,IAAC,OAAA,CAAM,SAAAI,EAAWP,EAAa,SAAS,EAAE,EAC1CG,EAAAA,IAAC,OAAA,CAAM,SAAAH,EAAa,UAAA,CAAW,EAC9B,CAACW,GACAF,EAAAA,KAAC,OAAA,CAAK,UAAU,yCACd,SAAA,CAAAN,EAAAA,IAACW,EAAA,CAAM,UAAU,SAAA,CAAU,EAC1BhC,IAAa,KAAO,YAAc,UAAA,CAAA,CACrC,CAAA,CAAA,CAEJ,CAAA,EACF,QAECiC,EAAA,CAAa,UAAW,4DACvBH,EAAa,YAAc,EAC7B,EAAA,CAAI,CAAA,CAAA,CACN,CAAA,EAlDKZ,EAAa,EAAA,CAqDxB,CAAC,CAAA,CACH,CAAA,EAEJ,CAEJ"}
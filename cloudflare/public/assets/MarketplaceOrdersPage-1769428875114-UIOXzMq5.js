import{r as i,j as e,bn as N,q as w,U as j,z as D,D as $,l as v,ab as O,ae as _,X as U,y as Y,m as F}from"./react-vendor-1769428875114-t_MJ7TI5.js";import{d as H,u as J,e as b}from"./index-1769428875114-CG_16j_e.js";import"./vendor-1769428875114-wOrLRiCI.js";import"./qr-scanner-1769428875114-B_vB3SDT.js";import"./zustand-1769428875114-wNUYBKDB.js";const f={new:{label:"Новый",labelUz:"Yangi",color:"blue"},confirmed:{label:"Назначен",labelUz:"Tayinlangan",color:"indigo"},preparing:{label:"Собирается",labelUz:"Yig'ilmoqda",color:"yellow"},ready:{label:"Готов",labelUz:"Tayyor",color:"orange"},delivering:{label:"Доставляется",labelUz:"Yetkazilmoqda",color:"purple"},delivered:{label:"Доставлен",labelUz:"Yetkazildi",color:"green"},cancelled:{label:"Отменён",labelUz:"Bekor qilindi",color:"red"}},y=["new","confirmed","preparing","delivering","ready","delivered"],Q={blue:"bg-blue-100 text-blue-700",indigo:"bg-indigo-100 text-indigo-700",yellow:"bg-yellow-100 text-yellow-700",orange:"bg-orange-100 text-orange-700",purple:"bg-purple-100 text-purple-700",green:"bg-green-100 text-green-700",red:"bg-red-100 text-red-700"};function Z(){const{language:a}=H(),{executors:C,fetchExecutors:S}=J(),[c,I]=i.useState([]),[L,k]=i.useState(!0),[m,P]=i.useState(""),[d,o]=i.useState("all"),[t,u]=i.useState(null),[h,g]=i.useState(null),x=i.useCallback(async()=>{try{k(!0);const s=await b("/api/marketplace/admin/orders"),l=await Promise.all((s?.orders||[]).map(async r=>{try{const n=await b(`/api/marketplace/orders/${r.id}/items`);return{...r,items:n?.items||[]}}catch{return{...r,items:[]}}}));I(l)}catch{}finally{k(!1)}},[]);i.useEffect(()=>{x(),S(!0);const s=setInterval(x,3e4);return()=>clearInterval(s)},[x,S]);const R=async(s,l)=>{try{await b(`/api/marketplace/admin/orders/${s}`,{method:"PATCH",body:JSON.stringify({executor_id:l})}),await x(),g(null),u(null)}catch{}},q=async(s,l)=>{try{await b(`/api/marketplace/admin/orders/${s}`,{method:"PATCH",body:JSON.stringify({status:l})}),await x(),u(null)}catch{}},z=c.filter(s=>{const l=d==="all"||s.status===d,r=!m||s.order_number?.toLowerCase().includes(m.toLowerCase())||s.user_name?.toLowerCase().includes(m.toLowerCase());return l&&r}),p=s=>new Intl.NumberFormat("ru-RU").format(s)+" сум",B=c.filter(s=>s.status==="new").length,T=c.filter(s=>["confirmed","preparing","ready"].includes(s.status)).length,A=c.filter(s=>s.status==="delivering").length;return L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-4",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:a==="ru"?"Заказы магазина":"Do'kon buyurtmalari"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a==="ru"?"Назначение и отслеживание заказов":"Buyurtmalarni tayinlash va kuzatish"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 p-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-3 shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>o("new"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(N,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:B}),e.jsx("p",{className:"text-xs text-gray-500",children:a==="ru"?"Новых":"Yangi"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-3 shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>o("confirmed"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(w,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:T}),e.jsx("p",{className:"text-xs text-gray-500",children:a==="ru"?"В работе":"Ishda"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-3 shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>o("delivering"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(j,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:A}),e.jsx("p",{className:"text-xs text-gray-500",children:a==="ru"?"Доставка":"Yetkazish"})]})]})})]}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("div",{className:"flex gap-2 mb-3",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:a==="ru"?"Поиск заказов...":"Buyurtma qidirish...",value:m,onChange:s=>P(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500"})]})}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>o("all"),className:`px-3 py-1.5 rounded-full text-sm whitespace-nowrap ${d==="all"?"bg-orange-600 text-white":"bg-gray-100 text-gray-600"}`,children:[a==="ru"?"Все":"Hammasi"," (",c.length,")"]}),Object.entries(f).map(([s,l])=>{const r=c.filter(n=>n.status===s).length;return r===0&&s!==d?null:e.jsxs("button",{onClick:()=>o(s),className:`px-3 py-1.5 rounded-full text-sm whitespace-nowrap ${d===s?"bg-orange-600 text-white":"bg-gray-100 text-gray-600"}`,children:[a==="ru"?l.label:l.labelUz," (",r,")"]},s)})]})]}),e.jsxs("div",{className:"px-4 pb-20 space-y-3",children:[z.map(s=>{const l=f[s.status];return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>u(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-gray-900",children:["#",s.order_number]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${Q[l?.color]||"bg-gray-100 text-gray-700"}`,children:a==="ru"?l?.label:l?.labelUz})]}),e.jsx($,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{children:s.user_name||"Клиент"}),s.user_phone&&e.jsxs("span",{className:"text-gray-400",children:["• ",s.user_phone]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.delivery_address||"Адрес не указан",s.apartment?`, кв. ${s.apartment}`:""]})]}),s.executor_name&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600 mt-2",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsxs("span",{children:[a==="ru"?"Исполнитель:":"Ijrochi:"," ",s.executor_name]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t",children:[e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[s.items_count||s.items?.length||0," товаров"]}),e.jsx("span",{className:"font-bold text-orange-600",children:p(s.final_amount||s.total_amount)})]})]})]}),s.status==="new"&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),g(s)},className:"w-full py-3 bg-orange-50 text-orange-600 font-medium border-t hover:bg-orange-100 transition-colors flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),a==="ru"?"Назначить исполнителя":"Ijrochi tayinlash"]})]},s.id)}),z.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:a==="ru"?"Заказов нет":"Buyurtmalar yo'q"})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center md:p-4",children:e.jsxs("div",{className:"bg-white w-full md:max-w-lg md:rounded-2xl rounded-t-3xl max-h-[90vh] md:max-h-[85vh] overflow-y-auto md:self-center self-end",children:[e.jsxs("div",{className:"sticky top-0 bg-white p-4 border-b flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"font-bold text-lg",children:[a==="ru"?"Заказ":"Buyurtma"," #",t.order_number]}),e.jsx("button",{onClick:()=>u(null),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:y.slice(0,5).map((s,l)=>{const r=y.indexOf(t.status),n=l<=r,E=l===r,M=l===0?N:l===1?_:l===2?w:l===3?j:Y;return e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n?"bg-orange-600 text-white":"bg-gray-200 text-gray-400"} ${E?"ring-2 ring-orange-300 ring-offset-2":""}`,children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("span",{className:`text-xs mt-1 text-center ${n?"text-orange-600 font-medium":"text-gray-400"}`,children:a==="ru"?f[s].label:f[s].labelUz})]},s)})}),e.jsx("div",{className:"flex items-center mt-2",children:y.slice(0,4).map((s,l)=>{const r=y.indexOf(t.status),n=l<r;return e.jsx("div",{className:`flex-1 h-1 ${n?"bg-orange-600":"bg-gray-200"} ${l===0?"rounded-l-full":""} ${l===3?"rounded-r-full":""}`},s)})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:a==="ru"?"Клиент":"Mijoz"}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:t.user_name||"Клиент"}),t.user_phone&&e.jsxs("a",{href:`tel:${t.user_phone}`,className:"flex items-center gap-2 text-sm text-blue-600 mb-1",children:[e.jsx(v,{className:"w-4 h-4"}),t.user_phone]}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),t.delivery_address||"Адрес не указан",t.apartment?`, кв. ${t.apartment}`:""]}),t.delivery_notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',t.delivery_notes,'"']})]}),t.executor_name?e.jsxs("div",{className:"bg-indigo-50 rounded-xl p-4 mb-4",children:[e.jsx("h4",{className:"text-xs font-medium text-indigo-600 uppercase mb-2",children:a==="ru"?"Исполнитель":"Ijrochi"}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:t.executor_name}),t.executor_phone&&e.jsxs("a",{href:`tel:${t.executor_phone}`,className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(v,{className:"w-4 h-4"}),t.executor_phone]})]}):e.jsx("div",{className:"bg-yellow-50 rounded-xl p-4 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-700 text-center",children:a==="ru"?"Исполнитель не назначен":"Ijrochi tayinlanmagan"})}),e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:a==="ru"?"Товары":"Mahsulotlar"}),e.jsx("div",{className:"space-y-3 mb-4",children:(t.items||[]).map((s,l)=>e.jsxs("div",{className:"flex items-center gap-3 bg-white rounded-xl p-3 border",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden",children:s.product_image?e.jsx("img",{src:s.product_image,alt:"",className:"w-full h-full object-cover"}):e.jsx(w,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.product_name||"Товар"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.quantity," x ",p(s.unit_price)]})]}),e.jsx("span",{className:"font-bold text-gray-900",children:p(s.quantity*s.unit_price)})]},l))}),e.jsx("div",{className:"bg-orange-50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:a==="ru"?"Итого:":"Jami:"}),e.jsx("span",{className:"text-xl font-bold text-orange-600",children:p(t.final_amount||t.total_amount)})]})}),t.status==="delivered"&&t.rating&&e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-xl border border-yellow-200",children:[e.jsx("h3",{className:"font-medium text-yellow-800 mb-2",children:a==="ru"?"Оценка клиента":"Mijoz bahosi"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(s=>e.jsx(F,{className:`w-5 h-5 ${s<=t.rating?"text-yellow-500 fill-yellow-500":"text-gray-300"}`},s))}),e.jsxs("span",{className:"text-lg font-semibold text-yellow-700",children:[t.rating,"/5"]})]}),t.review&&e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsx("span",{className:"font-medium",children:a==="ru"?"Отзыв: ":"Sharh: "}),t.review]})]}),e.jsxs("div",{className:"flex gap-3",children:[t.status==="new"&&e.jsxs("button",{onClick:()=>g(t),className:"flex-1 py-3 bg-orange-600 text-white rounded-xl font-medium flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),a==="ru"?"Назначить исполнителя":"Ijrochi tayinlash"]}),t.status==="new"&&e.jsx("button",{onClick:()=>q(t.id,"cancelled"),className:"px-4 py-3 bg-red-50 text-red-600 rounded-xl font-medium",children:a==="ru"?"Отменить":"Bekor"})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white p-4 border-b flex items-center justify-between z-10",children:[e.jsx("h2",{className:"font-bold text-lg",children:a==="ru"?"Назначить исполнителя":"Ijrochi tayinlash"}),e.jsx("button",{onClick:()=>g(null),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:a==="ru"?`Выберите исполнителя для заказа #${h.order_number}`:`#${h.order_number} buyurtmasi uchun ijrochi tanlang`}),e.jsxs("div",{className:"space-y-2",children:[C.filter(s=>s.status!=="offline"&&s.specialization==="courier").map(s=>e.jsxs("button",{onClick:()=>R(h.id,s.id),className:"w-full p-4 bg-gray-50 rounded-xl flex items-center gap-3 hover:bg-orange-50 transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.phone})]}),e.jsx("div",{className:`px-2 py-1 rounded-lg text-xs ${s.status==="available"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:s.status==="available"?a==="ru"?"Доступен":"Bo'sh":a==="ru"?"Занят":"Band"}),e.jsx($,{className:"w-5 h-5 text-gray-400"})]},s.id)),C.filter(s=>s.status!=="offline"&&s.specialization==="courier").length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:a==="ru"?"Нет доступных исполнителей":"Mavjud ijrochilar yo'q"})]})]})]})})]})}export{Z as MarketplaceOrdersPage};
//# sourceMappingURL=MarketplaceOrdersPage-1769428875114-UIOXzMq5.js.map

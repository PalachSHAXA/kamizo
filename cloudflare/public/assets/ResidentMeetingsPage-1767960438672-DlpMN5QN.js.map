{"version":3,"file":"ResidentMeetingsPage-1767960438672-DlpMN5QN.js","sources":["../../src/components/QRSignatureModal.tsx","../../src/pages/ResidentMeetingsPage.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\nimport { X, Camera, CheckCircle, AlertCircle, Key, Loader2 } from 'lucide-react';\nimport { generateQRCode } from './LazyQRCode';\n\ninterface QRSignatureModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onVerified: () => void;\n  user: {\n    id: string;\n    name: string;\n    login?: string;\n    address?: string;\n    apartment?: string;\n    phone?: string;\n    contractNumber?: string;\n  };\n  language: string;\n  title?: string;\n  description?: string;\n}\n\nexport function QRSignatureModal({\n  isOpen,\n  onClose,\n  onVerified,\n  user,\n  language,\n  title,\n  description\n}: QRSignatureModalProps) {\n  const [mode, setMode] = useState<'show' | 'scan'>('show');\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\n  const [isScanning, setIsScanning] = useState(false);\n  const [scanResult, setScanResult] = useState<'success' | 'error' | null>(null);\n  const [inputCode, setInputCode] = useState('');\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  // Use user ID directly as signature code for consistency\n  const signatureCode = user.id.toUpperCase();\n\n  // Generate QR code with same format as profile (for consistency)\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const generateQR = async () => {\n      // Use same QR content as in ResidentProfilePage for consistency\n      const signatureText = [\n        `ID: ${user.id}`,\n        `Л/С: ${user.login || '-'}`,\n        `ФИО: ${user.name}`,\n        `Адрес: ${user.address || '-'}`,\n        `Кв: ${user.apartment || '-'}`,\n        `Тел: ${user.phone || '-'}`,\n        `Договор: ${user.contractNumber || '-'}`,\n      ].join('\\n');\n\n      const url = await generateQRCode(signatureText, {\n        width: 200,\n        margin: 2,\n        color: { dark: '#1f2937', light: '#ffffff' },\n      });\n      setQrCodeUrl(url);\n    };\n\n    generateQR();\n  }, [isOpen, user]);\n\n  // Cleanup camera on unmount\n  useEffect(() => {\n    return () => {\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, []);\n\n  const stopCamera = () => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    setIsScanning(false);\n  };\n\n  const handleShowMode = () => {\n    setMode('show');\n    stopCamera();\n  };\n\n  // Manual code verification\n  const handleManualVerify = () => {\n    const normalizedInput = inputCode.trim().toUpperCase();\n    if (normalizedInput === signatureCode) {\n      setScanResult('success');\n      setTimeout(() => {\n        onVerified();\n        onClose();\n      }, 1500);\n    } else {\n      setScanResult('error');\n      setTimeout(() => setScanResult(null), 2000);\n    }\n  };\n\n  // Simple verification - just confirm they have the key\n  const handleConfirmSignature = () => {\n    setScanResult('success');\n    setTimeout(() => {\n      onVerified();\n      onClose();\n    }, 1000);\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-100\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center\">\n              <Key className=\"w-5 h-5 text-blue-600\" />\n            </div>\n            <div>\n              <h3 className=\"font-bold text-gray-900\">\n                {title || (language === 'ru' ? 'Электронная подпись' : 'Elektron imzo')}\n              </h3>\n              <p className=\"text-xs text-gray-500\">\n                {language === 'ru' ? 'Подтвердите вашу личность' : 'Shaxsingizni tasdiqlang'}\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-4\">\n          {description && (\n            <p className=\"text-sm text-gray-600 mb-4 text-center\">{description}</p>\n          )}\n\n          {/* Success State */}\n          {scanResult === 'success' && (\n            <div className=\"text-center py-8\">\n              <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\n                <CheckCircle className=\"w-10 h-10 text-green-500\" />\n              </div>\n              <h4 className=\"text-lg font-bold text-green-700\">\n                {language === 'ru' ? 'Подпись подтверждена!' : 'Imzo tasdiqlandi!'}\n              </h4>\n              <p className=\"text-sm text-gray-500 mt-2\">\n                {language === 'ru' ? 'Ваш голос будет записан' : 'Ovozingiz qayd etiladi'}\n              </p>\n            </div>\n          )}\n\n          {/* Error State */}\n          {scanResult === 'error' && (\n            <div className=\"text-center py-4 mb-4 bg-red-50 rounded-xl\">\n              <AlertCircle className=\"w-8 h-8 text-red-500 mx-auto mb-2\" />\n              <p className=\"text-sm text-red-600\">\n                {language === 'ru' ? 'Неверный ключ подписи' : 'Noto\\'g\\'ri imzo kaliti'}\n              </p>\n            </div>\n          )}\n\n          {/* Main Content - Show QR or Scan */}\n          {!scanResult && (\n            <>\n              {mode === 'show' ? (\n                <>\n                  {/* Show User's QR Signature */}\n                  <div className=\"text-center\">\n                    <p className=\"text-sm text-gray-600 mb-4\">\n                      {language === 'ru'\n                        ? 'Ваш уникальный ключ электронной подписи:'\n                        : 'Sizning noyob elektron imzo kalitingiz:'}\n                    </p>\n\n                    {/* QR Code */}\n                    <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 mb-3\">\n                      {qrCodeUrl ? (\n                        <img src={qrCodeUrl} alt=\"QR Signature\" className=\"w-32 h-32 mx-auto\" />\n                      ) : (\n                        <div className=\"w-32 h-32 mx-auto bg-gray-100 rounded animate-pulse flex items-center justify-center\">\n                          <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n                        </div>\n                      )}\n                    </div>\n\n                    {/* User Info with ID */}\n                    <div className=\"bg-blue-50 rounded-xl p-3 mb-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0\">\n                          {user.name.charAt(0)}\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"font-semibold text-gray-900\">{user.name}</p>\n                          <p className=\"text-xs text-gray-500\">\n                            {language === 'ru' ? 'Л/С:' : 'L/H:'} {user.login || '-'}\n                          </p>\n                        </div>\n                      </div>\n                      {/* Signature ID */}\n                      <div className=\"mt-3 pt-3 border-t border-blue-100\">\n                        <p className=\"text-xs text-gray-500 mb-1\">\n                          {language === 'ru' ? 'ID электронной подписи:' : 'Elektron imzo ID:'}\n                        </p>\n                        <p className=\"font-mono text-lg font-bold text-blue-600 tracking-wider select-all\">\n                          {signatureCode}\n                        </p>\n                      </div>\n                    </div>\n\n                    {/* Confirm Button */}\n                    <button\n                      onClick={handleConfirmSignature}\n                      className=\"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform\"\n                      style={{ background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)' }}\n                    >\n                      <CheckCircle className=\"w-5 h-5\" />\n                      {language === 'ru' ? 'Подтвердить подпись' : 'Imzoni tasdiqlash'}\n                    </button>\n\n                    <p className=\"text-xs text-gray-400 mt-3 text-center\">\n                      {language === 'ru'\n                        ? 'Нажимая \"Подтвердить\", вы подписываете голос электронным ключом'\n                        : '\"Tasdiqlash\" tugmasini bosish orqali ovozingizni elektron kalit bilan imzolaysiz'}\n                    </p>\n                  </div>\n                </>\n              ) : (\n                <>\n                  {/* Camera Scanner */}\n                  <div className=\"text-center\">\n                    <div className=\"bg-black rounded-2xl overflow-hidden mb-4 aspect-square relative\">\n                      <video\n                        ref={videoRef}\n                        autoPlay\n                        playsInline\n                        className=\"w-full h-full object-cover\"\n                      />\n                      {!isScanning && (\n                        <div className=\"absolute inset-0 flex items-center justify-center bg-gray-900\">\n                          <Camera className=\"w-12 h-12 text-gray-500\" />\n                        </div>\n                      )}\n                      {/* Scanner overlay */}\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <div className=\"w-48 h-48 border-2 border-white/50 rounded-2xl\" />\n                      </div>\n                    </div>\n\n                    <p className=\"text-sm text-gray-600 mb-4\">\n                      {language === 'ru'\n                        ? 'Наведите камеру на ваш QR-код подписи'\n                        : 'Kamerani QR-kod imzongizga yo\\'naltiring'}\n                    </p>\n\n                    {/* Manual Input Option */}\n                    <div className=\"border-t border-gray-100 pt-4 mt-4\">\n                      <p className=\"text-xs text-gray-500 mb-2\">\n                        {language === 'ru' ? 'Или введите код вручную:' : 'Yoki kodni qo\\'lda kiriting:'}\n                      </p>\n                      <div className=\"flex gap-2\">\n                        <input\n                          type=\"text\"\n                          value={inputCode}\n                          onChange={(e) => setInputCode(e.target.value.toUpperCase())}\n                          placeholder=\"SIG-XXXXX-XXXX\"\n                          className=\"flex-1 px-4 py-3 rounded-xl border border-gray-200 text-center font-mono uppercase\"\n                        />\n                        <button\n                          onClick={handleManualVerify}\n                          disabled={!inputCode.trim()}\n                          className=\"px-4 py-3 bg-blue-500 text-white rounded-xl font-medium disabled:opacity-50\"\n                        >\n                          OK\n                        </button>\n                      </div>\n                    </div>\n\n                    <button\n                      onClick={handleShowMode}\n                      className=\"mt-4 text-sm text-blue-600 hover:text-blue-800\"\n                    >\n                      {language === 'ru' ? '← Показать мой QR-код' : '← QR-kodimni ko\\'rsatish'}\n                    </button>\n                  </div>\n                </>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        {!scanResult && (\n          <div className=\"px-4 pb-4\">\n            <button\n              onClick={onClose}\n              className=\"w-full py-2.5 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors text-sm\"\n            >\n              {language === 'ru' ? 'Отмена' : 'Bekor qilish'}\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect, useMemo } from 'react';\nimport {\n  Vote, Calendar, FileText, Users, Building2, CheckCircle, X,\n  ThumbsUp, ThumbsDown, Minus, ChevronRight, Loader2, Clock, Trophy, ArrowRight, Key, User,\n  MessageSquare\n} from 'lucide-react';\nimport { useAuthStore } from '../stores/authStore';\nimport { useMeetingStore } from '../stores/meetingStore';\nimport { useLanguageStore } from '../stores/languageStore';\nimport { MEETING_STATUS_LABELS, DECISION_THRESHOLD_LABELS } from '../types';\nimport type { Meeting, VoteChoice } from '../types';\nimport { QRSignatureModal } from '../components/QRSignatureModal';\n\nexport function ResidentMeetingsPage() {\n  const { user } = useAuthStore();\n  const {\n    meetings,\n    fetchMeetings,\n    voteForSchedule,\n    getScheduleVoteByUser,\n    voteOnAgendaItem,\n    getVoteByUser,\n    getUserVotesForMeeting,\n    calculateAgendaItemResult,\n    calculateMeetingQuorum,\n  } = useMeetingStore();\n  const { language } = useLanguageStore();\n\n  const [selectedMeetingId, setSelectedMeetingId] = useState<string | null>(null);\n  const [showVotingModal, setShowVotingModal] = useState(false);\n\n  // Get selected meeting from store (reactive to changes)\n  const selectedMeeting = selectedMeetingId ? meetings.find(m => m.id === selectedMeetingId) || null : null;\n\n  // ✅ OPTIMIZED: Fetch meetings once on mount (empty deps)\n  useEffect(() => {\n    fetchMeetings();\n  }, []); // Empty array - runs only once\n\n  // Load user's votes when opening voting modal\n  useEffect(() => {\n    if (selectedMeetingId && user?.id) {\n      getUserVotesForMeeting(selectedMeetingId, user.id);\n    }\n  }, [selectedMeetingId, user?.id, getUserVotesForMeeting]);\n\n  // ✅ OPTIMIZED: Memoized filtering (no re-computation on every render)\n  // ✅ FIX: Filter meetings by user's building - residents should only see meetings for their building\n  const activeMeetings = useMemo(() =>\n    meetings.filter(m =>\n      ['schedule_poll_open', 'voting_open', 'results_published', 'protocol_approved'].includes(m.status) &&\n      // Filter by building: only show meetings for user's building\n      (!user?.buildingId || m.buildingId === user.buildingId)\n    ),\n    [meetings, user?.buildingId]\n  );\n\n  const votableMeetings = useMemo(() =>\n    activeMeetings.filter(m =>\n      ['schedule_poll_open', 'voting_open'].includes(m.status)\n    ),\n    [activeMeetings]\n  );\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n      weekday: 'short',\n      day: '2-digit',\n      month: 'short',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  const getStatusStyles = (status: Meeting['status']) => {\n    switch (status) {\n      case 'schedule_poll_open':\n        return { bg: 'bg-blue-50 border-blue-300', badge: 'bg-blue-100 text-blue-700' };\n      case 'voting_open':\n        return { bg: 'bg-green-50 border-green-300', badge: 'bg-green-100 text-green-700' };\n      case 'results_published':\n        return { bg: 'bg-purple-50 border-purple-300', badge: 'bg-purple-100 text-purple-700' };\n      case 'protocol_approved':\n        return { bg: 'bg-emerald-50 border-emerald-300', badge: 'bg-emerald-100 text-emerald-700' };\n      default:\n        return { bg: 'bg-gray-50 border-gray-300', badge: 'bg-gray-100 text-gray-700' };\n    }\n  };\n\n  const handleOpenMeeting = (meeting: Meeting) => {\n    setSelectedMeetingId(meeting.id);\n    setShowVotingModal(true);\n  };\n\n  return (\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-xl md:text-2xl font-bold flex items-center gap-3\">\n          <Vote className=\"w-7 h-7 text-primary-500\" />\n          {language === 'ru' ? 'Собрания' : 'Yig\\'ilishlar'}\n        </h1>\n\n        {votableMeetings.length > 0 && (\n          <span className=\"px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-medium\">\n            {votableMeetings.length} {language === 'ru' ? 'активных' : 'faol'}\n          </span>\n        )}\n      </div>\n\n      {/* Meetings List */}\n      {activeMeetings.length === 0 ? (\n        <div className=\"glass-card p-8 text-center\">\n          <Vote className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n          <p className=\"text-gray-500\">\n            {language === 'ru' ? 'Нет активных собраний' : 'Faol yig\\'ilishlar yo\\'q'}\n          </p>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {activeMeetings.map((meeting) => {\n            const styles = getStatusStyles(meeting.status);\n            const statusLabel = MEETING_STATUS_LABELS[meeting.status];\n            const quorum = calculateMeetingQuorum(meeting.id);\n            // Check if user has already voted (is in participatedVoters)\n            const hasVoted = user?.id && meeting.participatedVoters?.includes(user.id);\n            // Note: scheduleVote will be loaded async in the modal\n            const scheduleVote: string | null = null;\n\n            return (\n              <div\n                key={meeting.id}\n                className={`glass-card p-4 border-2 ${styles.bg} cursor-pointer hover:shadow-md transition-all`}\n                onClick={() => handleOpenMeeting(meeting)}\n              >\n                {/* Header */}\n                <div className=\"flex items-start justify-between gap-3 mb-3\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 flex-wrap mb-1\">\n                      <span className={`px-2 py-0.5 rounded-lg text-xs font-medium ${styles.badge}`}>\n                        {language === 'ru' ? statusLabel?.label : statusLabel?.labelUz}\n                      </span>\n                      <span className=\"text-xs text-gray-500\">#{meeting.number}</span>\n                      {/* Show \"Voted\" badge if user has voted */}\n                      {hasVoted && meeting.status === 'voting_open' && (\n                        <span className=\"px-2 py-0.5 rounded-lg text-xs font-medium bg-green-100 text-green-700 flex items-center gap-1\">\n                          <CheckCircle className=\"w-3 h-3\" />\n                          {language === 'ru' ? 'Вы проголосовали' : 'Ovoz berdingiz'}\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                      <Building2 className=\"w-4 h-4\" />\n                      <span className=\"truncate\">{meeting.buildingAddress}</span>\n                    </div>\n                  </div>\n                  <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n                </div>\n\n                {/* Agenda Summary */}\n                <div className=\"flex items-center gap-2 text-sm text-gray-600 mb-3\">\n                  <FileText className=\"w-4 h-4\" />\n                  <span>\n                    {meeting.agendaItems.length} {language === 'ru' ? 'вопросов' : 'savol'}\n                  </span>\n                </div>\n\n                {/* Schedule Poll Info */}\n                {meeting.status === 'schedule_poll_open' && (\n                  <div className=\"bg-white/60 rounded-lg p-3 mb-3\">\n                    <div className=\"text-sm font-medium mb-2\">\n                      {language === 'ru' ? 'Голосование за дату' : 'Sana uchun ovoz berish'}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {scheduleVote ? (\n                        <span className=\"text-xs text-green-600 flex items-center gap-1\">\n                          <CheckCircle className=\"w-4 h-4\" />\n                          {language === 'ru' ? 'Вы уже проголосовали' : 'Siz ovoz berdingiz'}\n                        </span>\n                      ) : (\n                        <span className=\"text-xs text-blue-600\">\n                          {language === 'ru' ? 'Выберите удобную дату' : 'Qulay sanani tanlang'}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {/* Confirmed Date */}\n                {meeting.confirmedDateTime && meeting.status !== 'schedule_poll_open' && (\n                  <div className=\"flex items-center gap-2 text-sm bg-white/60 rounded-lg p-3 mb-3\">\n                    <Calendar className=\"w-4 h-4 text-green-500\" />\n                    <span className=\"font-medium\">{formatDate(meeting.confirmedDateTime)}</span>\n                  </div>\n                )}\n\n                {/* Thank you message if already voted */}\n                {hasVoted && meeting.status === 'voting_open' && (\n                  <div className=\"bg-green-50 border border-green-200 rounded-xl p-3 mb-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                      <div>\n                        <p className=\"text-sm font-medium text-green-800\">\n                          {language === 'ru' ? 'Спасибо за участие!' : 'Ishtirok uchun rahmat!'}\n                        </p>\n                        <p className=\"text-xs text-green-600\">\n                          {language === 'ru' ? 'Ваш голос учтён' : 'Ovozingiz hisobga olindi'}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Voting Call to Action - show only if not voted yet */}\n                {meeting.status === 'voting_open' && !hasVoted && (\n                  <div\n                    className=\"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform touch-manipulation\"\n                    style={{ background: 'linear-gradient(135deg, #10b981, #059669)' }}\n                  >\n                    <Vote className=\"w-5 h-5\" />\n                    {language === 'ru' ? 'Проголосовать' : 'Ovoz berish'}\n                  </div>\n                )}\n\n                {/* View Details button if already voted */}\n                {meeting.status === 'voting_open' && hasVoted && (\n                  <div className=\"w-full py-3 px-4 rounded-xl font-medium bg-gray-100 text-gray-700 flex items-center justify-center gap-2\">\n                    <ChevronRight className=\"w-5 h-5\" />\n                    {language === 'ru' ? 'Посмотреть детали' : 'Tafsilotlarni ko\\'rish'}\n                  </div>\n                )}\n\n                {/* Quorum Info */}\n                {['voting_open', 'results_published', 'protocol_approved'].includes(meeting.status) && (\n                  <div className=\"flex items-center justify-between text-sm mt-3 pt-3 border-t border-gray-200/50\">\n                    <div className=\"flex items-center gap-2\">\n                      <Users className=\"w-4 h-4 text-gray-400\" />\n                      <span>{quorum.participated}/{quorum.total} ({quorum.percent.toFixed(0)}%)</span>\n                    </div>\n                    <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${\n                      quorum.quorumReached ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\n                    }`}>\n                      {quorum.quorumReached\n                        ? (language === 'ru' ? 'Кворум есть' : 'Kvorum bor')\n                        : (language === 'ru' ? 'Нет кворума' : 'Kvorum yo\\'q')}\n                    </span>\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Voting Modal */}\n      {showVotingModal && selectedMeeting && user && (\n        <MeetingVotingModal\n          meeting={selectedMeeting}\n          language={language}\n          user={user}\n          onClose={() => {\n            setShowVotingModal(false);\n            setSelectedMeetingId(null);\n          }}\n          getVote={(agendaItemId) => {\n            const vote = getVoteByUser(selectedMeeting.id, agendaItemId, user.id);\n            if (vote && vote.choice !== 'schedule') {\n              return { choice: vote.choice as VoteChoice };\n            }\n            return undefined;\n          }}\n          onVote={(agendaItemId, choice, verified, comment) =>\n            voteOnAgendaItem(selectedMeeting.id, agendaItemId, user.id, user.name, choice, {\n              method: 'e_signature',\n              otpVerified: verified,\n            }, comment)\n          }\n          getScheduleVote={() => getScheduleVoteByUser(selectedMeeting.id)}\n          onScheduleVote={(optionId) => voteForSchedule(selectedMeeting.id, optionId)}\n          calculateResult={(agendaItemId) => calculateAgendaItemResult(selectedMeeting.id, agendaItemId)}\n          calculateQuorum={() => calculateMeetingQuorum(selectedMeeting.id)}\n        />\n      )}\n    </div>\n  );\n}\n\n// Meeting Voting Modal Component\nfunction MeetingVotingModal({\n  meeting,\n  language,\n  user,\n  onClose,\n  getVote,\n  onVote,\n  getScheduleVote,\n  onScheduleVote,\n  calculateResult,\n  calculateQuorum,\n}: {\n  meeting: Meeting;\n  language: string;\n  user: { id: string; name: string; login?: string; address?: string; apartment?: string; phone?: string; contractNumber?: string };\n  onClose: () => void;\n  getVote: (agendaItemId: string) => { choice: VoteChoice } | undefined;\n  onVote: (agendaItemId: string, choice: VoteChoice, verified: boolean, comment?: string) => void;\n  getScheduleVote: () => Promise<string | null>;\n  onScheduleVote: (optionId: string) => Promise<{ success: boolean; error?: string }>;\n  calculateResult: (agendaItemId: string) => {\n    votesFor: number;\n    votesAgainst: number;\n    votesAbstain: number;\n    totalVotes: number;\n    percentFor: number;\n    isApproved: boolean;\n    thresholdMet: boolean;\n  };\n  calculateQuorum: () => { participated: number; total: number; percent: number; quorumReached: boolean };\n}) {\n  // Track pending votes for all agenda items (before submission)\n  const [pendingVotes, setPendingVotes] = useState<Record<string, VoteChoice>>({});\n  // Track comments for each agenda item vote\n  const [pendingComments, setPendingComments] = useState<Record<string, string>>({});\n  const [showSignatureModal, setShowSignatureModal] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [selectedScheduleOption, setSelectedScheduleOption] = useState<string | null>(null);\n  const [scheduleVoteLoading, setScheduleVoteLoading] = useState(false);\n  const [scheduleVoteSuccess, setScheduleVoteSuccess] = useState(false);\n  const [previousVote, setPreviousVote] = useState<string | null>(null);\n  const [votesSubmitted, setVotesSubmitted] = useState(false);\n\n  // Load schedule vote on mount\n  useEffect(() => {\n    getScheduleVote().then(vote => {\n      setSelectedScheduleOption(vote);\n      setPreviousVote(vote);\n    });\n  }, [getScheduleVote]);\n\n  // Check if user has already voted on all items\n  const hasVotedOnAll = meeting.agendaItems.every(item => getVote(item.id) !== undefined);\n\n  const quorum = calculateQuorum();\n  const isVotingOpen = meeting.status === 'voting_open';\n  const isSchedulePoll = meeting.status === 'schedule_poll_open';\n  const showResults = ['voting_closed', 'results_published', 'protocol_generated', 'protocol_approved'].includes(meeting.status);\n\n  // Handle selecting a vote for an agenda item (just stores locally, doesn't submit)\n  const handleVoteClick = (agendaItemId: string, choice: VoteChoice) => {\n    setPendingVotes(prev => ({\n      ...prev,\n      [agendaItemId]: choice\n    }));\n  };\n\n  // Check if all agenda items have a vote (either pending or already submitted)\n  const allItemsVoted = meeting.agendaItems.every(item =>\n    pendingVotes[item.id] || getVote(item.id)\n  );\n\n  // Count how many items have votes\n  const votedItemsCount = meeting.agendaItems.filter(item =>\n    pendingVotes[item.id] || getVote(item.id)\n  ).length;\n\n  // Handle confirmation click - opens signature modal\n  const handleConfirmAllVotes = () => {\n    if (Object.keys(pendingVotes).length === 0) return;\n    setShowSignatureModal(true);\n  };\n\n  // After signature verified, submit all pending votes with comments\n  const handleSignatureVerified = async () => {\n    setShowSignatureModal(false);\n    setIsSubmitting(true);\n\n    try {\n      // Submit all pending votes with their comments\n      for (const [agendaItemId, choice] of Object.entries(pendingVotes)) {\n        const comment = pendingComments[agendaItemId]?.trim() || undefined;\n        await onVote(agendaItemId, choice, true, comment);\n      }\n      setPendingVotes({});\n      setPendingComments({});\n      setVotesSubmitted(true);\n    } catch (error: any) {\n      console.error('Failed to submit votes:', error);\n      const errorMessage = error?.message || 'Ошибка при голосовании. Проверьте что указана площадь квартиры.';\n      alert(errorMessage);\n      setVotesSubmitted(false);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleScheduleVote = async (optionId: string) => {\n    // Don't allow if already voted (one vote only, no re-voting)\n    if (previousVote) return;\n\n    // Don't do anything if clicking the same option\n    if (optionId === selectedScheduleOption) return;\n\n    setScheduleVoteLoading(true);\n    setScheduleVoteSuccess(false);\n\n    try {\n      const result = await onScheduleVote(optionId);\n\n      if (result && !result.success) {\n        // Show error message if vote failed\n        const errorMsg = result.error || 'Ошибка при голосовании. Проверьте что указана площадь квартиры.';\n        alert(errorMsg);\n        setSelectedScheduleOption('');\n\n        // If meeting not found, close modal and refresh\n        if (errorMsg.includes('не найдено')) {\n          onClose();\n          window.location.reload();\n        }\n      } else {\n        // Vote successful\n        setSelectedScheduleOption(optionId);\n        setScheduleVoteSuccess(true);\n\n        // After successful vote, set previousVote to lock further voting\n        // Use setTimeout to show the success message briefly first\n        setTimeout(() => {\n          setPreviousVote(optionId);\n          setScheduleVoteSuccess(false);\n        }, 2000);\n      }\n    } catch (error: any) {\n      console.error('Failed to vote:', error);\n      const errorMessage = error?.message || 'Ошибка при голосовании. Проверьте что указана площадь квартиры.';\n      alert(errorMessage);\n      setSelectedScheduleOption('');\n\n      // If meeting not found, close modal and refresh\n      if (errorMessage.includes('не найдено')) {\n        onClose();\n        window.location.reload();\n      }\n    } finally {\n      setScheduleVoteLoading(false);\n    }\n  };\n\n  // Calculate total votes and find leading option (use voteCount for proper counting)\n  const totalScheduleVotes = meeting.scheduleOptions.reduce((sum, opt) => sum + ((opt as any).voteCount ?? opt.votes?.length ?? 0), 0);\n  const maxVotes = Math.max(...meeting.scheduleOptions.map(opt => (opt as any).voteCount ?? opt.votes?.length ?? 0));\n  const leadingOptions = meeting.scheduleOptions.filter(opt => ((opt as any).voteCount ?? opt.votes?.length ?? 0) === maxVotes && maxVotes > 0);\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n      weekday: 'long',\n      day: '2-digit',\n      month: 'long',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  const formatShortDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n      weekday: 'short',\n      day: '2-digit',\n      month: 'short',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center\">\n      <div className=\"max-h-[85vh] md:max-h-[90vh] w-full md:max-w-lg md:mx-4 bg-white rounded-t-2xl md:rounded-2xl flex flex-col overflow-hidden animate-in slide-in-from-bottom-4 md:slide-in-from-bottom-0 duration-200\">\n        {/* Header - more compact */}\n        <div className=\"flex items-center justify-between p-3 border-b border-gray-100 bg-white sticky top-0 z-10\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2\">\n              <h2 className=\"text-base font-bold truncate\">\n                {language === 'ru' ? `Собрание #${meeting.number}` : `Yig'ilish #${meeting.number}`}\n              </h2>\n              <span className={`px-2 py-0.5 rounded-lg text-xs font-medium flex-shrink-0 ${\n                MEETING_STATUS_LABELS[meeting.status]?.color === 'green' ? 'bg-green-100 text-green-700' :\n                MEETING_STATUS_LABELS[meeting.status]?.color === 'blue' ? 'bg-blue-100 text-blue-700' :\n                'bg-gray-100 text-gray-700'\n              }`}>\n                {language === 'ru' ? MEETING_STATUS_LABELS[meeting.status]?.label : MEETING_STATUS_LABELS[meeting.status]?.labelUz}\n              </span>\n            </div>\n            <p className=\"text-xs text-gray-500 truncate\">{meeting.buildingAddress}</p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation ml-2\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-3 space-y-3\">\n          {/* Quorum Info - compact */}\n          <div className=\"flex items-center justify-between bg-gray-50 rounded-xl p-2.5\">\n            <div className=\"flex items-center gap-2 text-sm\">\n              <User className=\"w-4 h-4 text-gray-400\" />\n              <span className=\"text-gray-600\">{language === 'ru' ? 'Участие:' : 'Ishtirok:'}</span>\n              <span className=\"font-medium\">{quorum.participated}/{quorum.total}</span>\n              <span className=\"text-gray-400\">({quorum.percent.toFixed(0)}%)</span>\n            </div>\n            <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${\n              quorum.quorumReached ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'\n            }`}>\n              {quorum.quorumReached\n                ? (language === 'ru' ? 'Кворум есть' : 'Kvorum bor')\n                : (language === 'ru' ? 'Нет кворума' : 'Kvorum yo\\'q')\n              }\n            </span>\n          </div>\n\n          {/* Schedule Poll */}\n          {isSchedulePoll && (\n            <div className=\"space-y-4\">\n              {/* Header with deadline */}\n              <div className=\"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <h3 className=\"font-semibold text-lg flex items-center gap-2\">\n                    <Calendar className=\"w-5 h-5\" />\n                    {language === 'ru' ? 'Голосование за дату' : 'Sana uchun ovoz berish'}\n                  </h3>\n                  {totalScheduleVotes > 0 && (\n                    <span className=\"bg-white/20 px-3 py-1 rounded-full text-sm\">\n                      {totalScheduleVotes} {language === 'ru' ? 'голосов' : 'ovoz'}\n                    </span>\n                  )}\n                </div>\n                {meeting.schedulePollEndsAt && (\n                  <div className=\"flex items-center gap-2 text-blue-100 text-sm\">\n                    <Clock className=\"w-4 h-4\" />\n                    {language === 'ru' ? 'Завершится: ' : 'Tugaydi: '}\n                    {new Date(meeting.schedulePollEndsAt).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n                      day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit'\n                    })}\n                  </div>\n                )}\n              </div>\n\n              {/* Instructions - only if not voted yet */}\n              {!previousVote && !selectedScheduleOption && (\n                <div className=\"bg-amber-50 border border-amber-200 rounded-xl p-3\">\n                  <p className=\"text-sm text-amber-700 flex items-center gap-2\">\n                    <ArrowRight className=\"w-4 h-4 flex-shrink-0\" />\n                    {language === 'ru'\n                      ? 'Нажмите на удобную для вас дату, чтобы проголосовать'\n                      : 'Qulay sanani bosing ovoz berish uchun'}\n                  </p>\n                </div>\n              )}\n\n              {/* Already voted indicator */}\n              {previousVote && (\n                <div className=\"bg-green-50 border border-green-200 rounded-xl p-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center\">\n                      <CheckCircle className=\"w-6 h-6 text-green-600\" />\n                    </div>\n                    <div>\n                      <p className=\"font-medium text-green-700\">\n                        {language === 'ru' ? 'Вы уже проголосовали!' : 'Siz allaqachon ovoz berdingiz!'}\n                      </p>\n                      <p className=\"text-sm text-green-600\">\n                        {language === 'ru'\n                          ? 'Ваш голос учтён. Ожидайте подтверждения даты администратором.'\n                          : 'Ovozingiz hisobga olindi. Administrator sanani tasdiqlaguncha kuting.'}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Vote options */}\n              <div className=\"space-y-3\">\n                {meeting.scheduleOptions.map((option, index) => {\n                  const isSelected = selectedScheduleOption === option.id;\n                  const isLeading = leadingOptions.some(lo => lo.id === option.id);\n                  const optionVoteCount = (option as any).voteCount ?? option.votes?.length ?? 0;\n                  const votePercent = totalScheduleVotes > 0 ? (optionVoteCount / totalScheduleVotes) * 100 : 0;\n\n                  // Disable voting if already voted (previousVote exists)\n                  const alreadyVoted = !!previousVote;\n\n                  return (\n                    <div\n                      key={option.id}\n                      onClick={() => !alreadyVoted && !scheduleVoteLoading && handleScheduleVote(option.id)}\n                      className={`w-full p-4 rounded-xl border-2 text-left transition-all relative overflow-hidden ${\n                        isSelected\n                          ? 'border-green-500 bg-green-50 shadow-md'\n                          : alreadyVoted\n                            ? 'border-gray-200 bg-gray-50 cursor-default'\n                            : 'border-gray-200 hover:border-blue-300 hover:bg-blue-50/50 bg-white cursor-pointer'\n                      } ${scheduleVoteLoading ? 'opacity-70 pointer-events-none' : ''}`}\n                    >\n                      {/* Progress bar background */}\n                      {totalScheduleVotes > 0 && (\n                        <div\n                          className={`absolute inset-0 transition-all ${\n                            isSelected ? 'bg-green-100' : 'bg-blue-50'\n                          }`}\n                          style={{ width: `${votePercent}%` }}\n                        />\n                      )}\n\n                      <div className=\"relative flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          {/* Option number or checkmark */}\n                          <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${\n                            isSelected\n                              ? 'bg-green-500 text-white'\n                              : 'bg-gray-100 text-gray-600'\n                          }`}>\n                            {isSelected ? <CheckCircle className=\"w-5 h-5\" /> : index + 1}\n                          </div>\n\n                          <div>\n                            <div className=\"font-medium text-gray-900\">\n                              {formatShortDate(option.dateTime)}\n                            </div>\n                            {isLeading && !isSelected && option.votes.length > 0 && (\n                              <div className=\"flex items-center gap-1 text-xs text-amber-600 mt-0.5\">\n                                <Trophy className=\"w-3 h-3\" />\n                                {language === 'ru' ? 'Лидирует' : 'Yetakchi'}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-center gap-3\">\n                          {/* Vote count with percentage */}\n                          <div className=\"text-right\">\n                            <div className={`font-semibold ${isSelected ? 'text-green-700' : 'text-gray-700'}`}>\n                              {optionVoteCount}\n                            </div>\n                            {totalScheduleVotes > 0 && (\n                              <div className=\"text-xs text-gray-500\">\n                                {votePercent.toFixed(0)}%\n                              </div>\n                            )}\n                          </div>\n\n                          {/* Loading indicator */}\n                          {scheduleVoteLoading && isSelected && (\n                            <Loader2 className=\"w-5 h-5 text-green-500 animate-spin\" />\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n\n              {/* Success message - only show on first vote, then previousVote gets set and the \"already voted\" indicator is shown instead */}\n              {scheduleVoteSuccess && !previousVote && (\n                <div className=\"bg-green-100 border border-green-300 rounded-xl p-4 animate-pulse\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center\">\n                      <CheckCircle className=\"w-6 h-6 text-white\" />\n                    </div>\n                    <div>\n                      <div className=\"font-semibold text-green-800\">\n                        {language === 'ru' ? 'Голос принят!' : 'Ovoz qabul qilindi!'}\n                      </div>\n                      <p className=\"text-sm text-green-600\">\n                        {language === 'ru'\n                          ? 'Ваш выбор зарегистрирован. После завершения опроса будет выбрана дата с максимальным числом голосов.'\n                          : 'Tanlovingiz ro\\'yxatga olindi. So\\'rovnoma tugagandan so\\'ng eng ko\\'p ovoz olgan sana tanlanadi.'}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Current vote status - only shown briefly after first voting, then previousVote gets set */}\n              {selectedScheduleOption && !scheduleVoteSuccess && !previousVote && (\n                <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <CheckCircle className=\"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5\" />\n                    <div>\n                      <div className=\"font-medium text-blue-800\">\n                        {language === 'ru' ? 'Ваш голос учтён' : 'Ovozingiz hisobga olindi'}\n                      </div>\n                      <p className=\"text-sm text-blue-600 mt-1\">\n                        {language === 'ru'\n                          ? 'После завершения опроса будет выбрана дата с максимальным числом голосов.'\n                          : 'So\\'rovnoma tugagach, eng ko\\'p ovoz olgan sana tanlanadi.'}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Meeting Timeline */}\n          <div className=\"bg-gray-50 rounded-xl p-4 border border-gray-200\">\n            <h3 className=\"font-medium mb-3 flex items-center gap-2\">\n              <FileText className=\"w-4 h-4\" />\n              {language === 'ru' ? 'Этапы собрания' : 'Yig\\'ilish bosqichlari'}\n            </h3>\n            <div className=\"space-y-3\">\n              {[\n                { status: 'schedule_poll_open', label: language === 'ru' ? 'Опрос по дате' : 'Sana so\\'rovi', labelUz: 'Sana so\\'rovi' },\n                { status: 'schedule_confirmed', label: language === 'ru' ? 'Дата подтверждена' : 'Sana tasdiqlandi', labelUz: 'Sana tasdiqlandi' },\n                { status: 'voting_open', label: language === 'ru' ? 'Голосование' : 'Ovoz berish', labelUz: 'Ovoz berish' },\n                { status: 'voting_closed', label: language === 'ru' ? 'Подсчёт голосов' : 'Ovozlar sanash', labelUz: 'Ovozlar sanash' },\n                { status: 'results_published', label: language === 'ru' ? 'Результаты' : 'Natijalar', labelUz: 'Natijalar' },\n                { status: 'protocol_approved', label: language === 'ru' ? 'Протокол' : 'Bayonnoma', labelUz: 'Bayonnoma' },\n              ].map((step, index) => {\n                const statusOrder = ['schedule_poll_open', 'schedule_confirmed', 'voting_open', 'voting_closed', 'results_published', 'protocol_approved'];\n                const currentIndex = statusOrder.indexOf(meeting.status);\n                const stepIndex = statusOrder.indexOf(step.status);\n                const isCompleted = stepIndex < currentIndex;\n                const isCurrent = step.status === meeting.status;\n\n                return (\n                  <div key={step.status} className=\"flex items-center gap-3\">\n                    <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${\n                      isCompleted ? 'bg-green-500 text-white' :\n                      isCurrent ? 'bg-blue-500 text-white' :\n                      'bg-gray-200 text-gray-500'\n                    }`}>\n                      {isCompleted ? <CheckCircle className=\"w-4 h-4\" /> : index + 1}\n                    </div>\n                    <span className={`text-sm ${\n                      isCompleted ? 'text-green-700' :\n                      isCurrent ? 'text-blue-700 font-medium' :\n                      'text-gray-400'\n                    }`}>\n                      {step.label}\n                    </span>\n                    {isCurrent && (\n                      <span className=\"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full\">\n                        {language === 'ru' ? 'Сейчас' : 'Hozir'}\n                      </span>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Confirmed Date */}\n          {meeting.confirmedDateTime && !isSchedulePoll && (\n            <div className=\"flex items-center gap-2 text-sm bg-gray-50 rounded-lg p-3\">\n              <Calendar className=\"w-4 h-4 text-gray-500\" />\n              <span>{formatDate(meeting.confirmedDateTime)}</span>\n            </div>\n          )}\n\n          {/* Voting Instructions */}\n          {isVotingOpen && (\n            <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-4\">\n              <div className=\"flex items-start gap-3\">\n                <Key className=\"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5\" />\n                <div className=\"text-sm text-blue-700\">\n                  {language === 'ru'\n                    ? 'Для подтверждения голоса используется ваш уникальный электронный ключ. Это защищает от подделки голосов.'\n                    : 'Ovozni tasdiqlash uchun sizning noyob elektron kalitingiz ishlatiladi. Bu ovozlarni soxtalashtirish oldini oladi.'}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Agenda Items */}\n          {(isVotingOpen || showResults) && (\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium\">\n                {language === 'ru' ? 'Повестка дня' : 'Kun tartibi'}\n              </h3>\n\n              {meeting.agendaItems.map((item, index) => {\n                const existingVote = getVote(item.id);\n                const result = calculateResult(item.id);\n\n                return (\n                  <div key={item.id} className=\"bg-gray-50 rounded-xl p-4 border border-gray-200\">\n                    <div className=\"mb-3\">\n                      <div className=\"font-medium text-base\">\n                        {index + 1}. {item.title}\n                      </div>\n                      <p className=\"text-sm text-gray-600 mt-1\">{item.description}</p>\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        <span className=\"text-xs px-2 py-0.5 rounded bg-gray-200 text-gray-600\">\n                          {language === 'ru'\n                            ? DECISION_THRESHOLD_LABELS[item.threshold]?.label\n                            : DECISION_THRESHOLD_LABELS[item.threshold]?.labelUz}\n                        </span>\n                      </div>\n                    </div>\n\n                    {/* Voting Buttons */}\n                    {isVotingOpen && !hasVotedOnAll && (\n                      <div className=\"grid grid-cols-3 gap-2 mb-3\">\n                        {/* Get current selection: pendingVotes first, then existingVote */}\n                        {(() => {\n                          const currentChoice = pendingVotes[item.id] || existingVote?.choice;\n                          return (\n                            <>\n                              <button\n                                onClick={() => handleVoteClick(item.id, 'for')}\n                                disabled={isSubmitting}\n                                className={`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${\n                                  currentChoice === 'for'\n                                    ? 'bg-green-500 text-white ring-2 ring-green-300'\n                                    : 'bg-green-50 text-green-700 border border-green-200 hover:bg-green-100 active:bg-green-200'\n                                }`}\n                              >\n                                <ThumbsUp className=\"w-4 h-4\" />\n                                {language === 'ru' ? 'За' : 'Ha'}\n                              </button>\n                              <button\n                                onClick={() => handleVoteClick(item.id, 'against')}\n                                disabled={isSubmitting}\n                                className={`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${\n                                  currentChoice === 'against'\n                                    ? 'bg-red-500 text-white ring-2 ring-red-300'\n                                    : 'bg-red-50 text-red-700 border border-red-200 hover:bg-red-100 active:bg-red-200'\n                                }`}\n                              >\n                                <ThumbsDown className=\"w-4 h-4\" />\n                                {language === 'ru' ? 'Против' : 'Yo\\'q'}\n                              </button>\n                              <button\n                                onClick={() => handleVoteClick(item.id, 'abstain')}\n                                disabled={isSubmitting}\n                                className={`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${\n                                  currentChoice === 'abstain'\n                                    ? 'bg-gray-500 text-white ring-2 ring-gray-300'\n                                    : 'bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100 active:bg-gray-200'\n                                }`}\n                              >\n                                <Minus className=\"w-4 h-4\" />\n                                {language === 'ru' ? 'Воздерж.' : 'Betaraf'}\n                              </button>\n                            </>\n                          );\n                        })()}\n                      </div>\n                    )}\n\n                    {/* Comment input - show when vote is selected but not yet submitted */}\n                    {isVotingOpen && !hasVotedOnAll && pendingVotes[item.id] && (\n                      <div className=\"mb-3\">\n                        <label className=\"flex items-center gap-1.5 text-xs text-gray-500 mb-1\">\n                          <MessageSquare className=\"w-3 h-3\" />\n                          {language === 'ru' ? 'Обоснование (будет в протоколе)' : 'Asoslash (bayonnomada bo\\'ladi)'}\n                        </label>\n                        <textarea\n                          value={pendingComments[item.id] || ''}\n                          onChange={(e) => setPendingComments(prev => ({ ...prev, [item.id]: e.target.value }))}\n                          placeholder={language === 'ru' ? 'Почему вы так проголосовали? (необязательно)' : 'Nima uchun shunday ovoz berdingiz? (ixtiyoriy)'}\n                          className=\"w-full px-3 py-2 text-sm border border-gray-200 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-200 resize-none\"\n                          rows={2}\n                          maxLength={500}\n                        />\n                        <div className=\"flex justify-between items-center mt-1\">\n                          <span className=\"text-[10px] text-gray-400\">\n                            {language === 'ru' ? 'Будет виден в протоколе собрания' : 'Yig\\'ilish bayonnomasida ko\\'rinadi'}\n                          </span>\n                          <span className=\"text-[10px] text-gray-400\">\n                            {(pendingComments[item.id] || '').length}/500\n                          </span>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Your Vote Indicator - show for submitted votes or pending selection */}\n                    {(() => {\n                      const currentChoice = existingVote?.choice || pendingVotes[item.id];\n                      const isSubmitted = !!existingVote;\n                      if (!currentChoice) return null;\n                      return (\n                        <div className={`text-sm font-medium flex items-center gap-2 mb-2 ${\n                          currentChoice === 'for' ? 'text-green-600' :\n                          currentChoice === 'against' ? 'text-red-600' : 'text-gray-600'\n                        }`}>\n                          {isSubmitted ? (\n                            <CheckCircle className=\"w-4 h-4\" />\n                          ) : (\n                            <span className=\"w-4 h-4 rounded-full border-2 border-current\" />\n                          )}\n                          {isSubmitted\n                            ? (language === 'ru' ? 'Ваш голос: ' : 'Sizning ovozingiz: ')\n                            : (language === 'ru' ? 'Выбрано: ' : 'Tanlangan: ')\n                          }\n                          {currentChoice === 'for' ? (language === 'ru' ? 'За' : 'Ha') :\n                           currentChoice === 'against' ? (language === 'ru' ? 'Против' : 'Yo\\'q') :\n                           (language === 'ru' ? 'Воздержался' : 'Betaraf')}\n                          {!isSubmitted && (\n                            <span className=\"text-xs text-gray-400 ml-1\">\n                              ({language === 'ru' ? 'не подтверждено' : 'tasdiqlanmagan'})\n                            </span>\n                          )}\n                        </div>\n                      );\n                    })()}\n\n                    {/* Results */}\n                    {(showResults || (isVotingOpen && meeting.votingSettings?.showIntermediateResults)) && (\n                      <div className=\"pt-3 border-t border-gray-200\">\n                        <div className=\"grid grid-cols-3 gap-2 text-sm mb-2\">\n                          <div className=\"flex items-center gap-1 text-green-600\">\n                            <ThumbsUp className=\"w-4 h-4\" />\n                            <span>{result.votesFor} ({result.percentFor.toFixed(0)}%)</span>\n                          </div>\n                          <div className=\"flex items-center gap-1 text-red-600\">\n                            <ThumbsDown className=\"w-4 h-4\" />\n                            <span>{result.votesAgainst}</span>\n                          </div>\n                          <div className=\"flex items-center gap-1 text-gray-600\">\n                            <Minus className=\"w-4 h-4\" />\n                            <span>{result.votesAbstain}</span>\n                          </div>\n                        </div>\n\n                        <div className=\"h-2 bg-gray-200 rounded-full overflow-hidden\">\n                          <div\n                            className={`h-full ${result.thresholdMet ? 'bg-green-500' : 'bg-red-500'}`}\n                            style={{ width: `${result.percentFor}%` }}\n                          />\n                        </div>\n\n                        {showResults && item.isApproved !== undefined && (\n                          <div className={`mt-2 px-3 py-1 rounded-lg text-sm font-medium inline-flex items-center gap-1 ${\n                            item.isApproved ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\n                          }`}>\n                            {item.isApproved\n                              ? (language === 'ru' ? 'Принято' : 'Qabul qilindi')\n                              : (language === 'ru' ? 'Не принято' : 'Rad etildi')}\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-3 border-t border-gray-100 bg-white safe-area-bottom space-y-2\">\n          {/* Show confirm button when voting is open and there are pending votes */}\n          {isVotingOpen && !hasVotedOnAll && Object.keys(pendingVotes).length > 0 && (\n            <div className=\"space-y-2\">\n              {/* Progress indicator */}\n              <div className=\"flex items-center justify-between text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <User className=\"w-4 h-4 text-gray-400\" />\n                  <span className=\"text-gray-600\">\n                    {language === 'ru' ? 'Отвечено:' : 'Javob berildi:'}\n                  </span>\n                </div>\n                <span className=\"font-medium\">\n                  {votedItemsCount}/{meeting.agendaItems.length}\n                  <span className=\"text-gray-400 ml-1\">\n                    ({Math.round((votedItemsCount / meeting.agendaItems.length) * 100)}%)\n                  </span>\n                </span>\n                {!quorum.quorumReached && (\n                  <span className=\"text-xs text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full\">\n                    {language === 'ru' ? 'Нет кворума' : 'Kvorum yo\\'q'}\n                  </span>\n                )}\n              </div>\n\n              {/* Confirm button */}\n              <button\n                onClick={handleConfirmAllVotes}\n                disabled={isSubmitting || Object.keys(pendingVotes).length === 0}\n                className=\"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform touch-manipulation disabled:opacity-50\"\n                style={{ background: allItemsVoted ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #3b82f6, #1d4ed8)' }}\n              >\n                {isSubmitting ? (\n                  <>\n                    <Loader2 className=\"w-5 h-5 animate-spin\" />\n                    {language === 'ru' ? 'Отправка...' : 'Yuborilmoqda...'}\n                  </>\n                ) : (\n                  <>\n                    <Key className=\"w-5 h-5\" />\n                    {allItemsVoted\n                      ? (language === 'ru' ? 'Подписать и отправить все голоса' : 'Imzolash va barcha ovozlarni yuborish')\n                      : (language === 'ru' ? `Подтвердить ${Object.keys(pendingVotes).length} голос(ов)` : `${Object.keys(pendingVotes).length} ta ovozni tasdiqlash`)\n                    }\n                  </>\n                )}\n              </button>\n            </div>\n          )}\n\n          {/* Show success message after voting */}\n          {(votesSubmitted || hasVotedOnAll) && isVotingOpen && (\n            <div className=\"bg-green-50 border border-green-200 rounded-xl p-3 mb-2\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                <div>\n                  <p className=\"text-sm font-medium text-green-800\">\n                    {language === 'ru' ? 'Спасибо за участие!' : 'Ishtirok uchun rahmat!'}\n                  </p>\n                  <p className=\"text-xs text-green-600\">\n                    {language === 'ru' ? 'Все ваши голоса учтены' : 'Barcha ovozlaringiz hisobga olindi'}\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <button\n            onClick={onClose}\n            className=\"w-full py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors touch-manipulation\"\n          >\n            {language === 'ru' ? 'Закрыть' : 'Yopish'}\n          </button>\n        </div>\n      </div>\n\n      {/* QR Signature Verification Modal */}\n      <QRSignatureModal\n        isOpen={showSignatureModal}\n        onClose={() => setShowSignatureModal(false)}\n        onVerified={handleSignatureVerified}\n        user={user}\n        language={language}\n        title={language === 'ru' ? 'Подтверждение голосов' : 'Ovozlarni tasdiqlash'}\n        description={language === 'ru'\n          ? `Подтвердите, что все ${Object.keys(pendingVotes).length} голос(ов) поданы вами лично. Нажмите \"Подтвердить\" для подписи электронным ключом.`\n          : `Barcha ${Object.keys(pendingVotes).length} ta ovoz sizning tomoningizdan berilganligini tasdiqlang. Elektron kalit bilan imzolash uchun \"Tasdiqlash\" tugmasini bosing.`\n        }\n      />\n    </div>\n  );\n}\n"],"names":["QRSignatureModal","isOpen","onClose","onVerified","user","language","title","description","mode","setMode","useState","qrCodeUrl","setQrCodeUrl","isScanning","setIsScanning","scanResult","setScanResult","inputCode","setInputCode","videoRef","useRef","streamRef","signatureCode","useEffect","signatureText","url","generateQRCode","track","stopCamera","handleShowMode","handleManualVerify","handleConfirmSignature","jsxs","jsx","Key","X","CheckCircle","AlertCircle","Fragment","Loader2","Camera","e","ResidentMeetingsPage","useAuthStore","meetings","fetchMeetings","voteForSchedule","getScheduleVoteByUser","voteOnAgendaItem","getVoteByUser","getUserVotesForMeeting","calculateAgendaItemResult","calculateMeetingQuorum","useMeetingStore","useLanguageStore","selectedMeetingId","setSelectedMeetingId","showVotingModal","setShowVotingModal","selectedMeeting","m","activeMeetings","useMemo","votableMeetings","formatDate","dateStr","getStatusStyles","status","handleOpenMeeting","meeting","Vote","styles","statusLabel","MEETING_STATUS_LABELS","quorum","hasVoted","Building2","ChevronRight","FileText","Calendar","Users","MeetingVotingModal","agendaItemId","vote","choice","verified","comment","optionId","getVote","onVote","getScheduleVote","onScheduleVote","calculateResult","calculateQuorum","pendingVotes","setPendingVotes","pendingComments","setPendingComments","showSignatureModal","setShowSignatureModal","isSubmitting","setIsSubmitting","selectedScheduleOption","setSelectedScheduleOption","scheduleVoteLoading","setScheduleVoteLoading","scheduleVoteSuccess","setScheduleVoteSuccess","previousVote","setPreviousVote","votesSubmitted","setVotesSubmitted","hasVotedOnAll","item","isVotingOpen","isSchedulePoll","showResults","handleVoteClick","prev","allItemsVoted","votedItemsCount","handleConfirmAllVotes","handleSignatureVerified","error","errorMessage","handleScheduleVote","result","errorMsg","totalScheduleVotes","sum","opt","maxVotes","leadingOptions","formatShortDate","User","Clock","ArrowRight","option","index","isSelected","isLeading","lo","optionVoteCount","votePercent","alreadyVoted","Trophy","step","statusOrder","currentIndex","isCompleted","isCurrent","existingVote","DECISION_THRESHOLD_LABELS","currentChoice","ThumbsUp","ThumbsDown","Minus","MessageSquare","isSubmitted"],"mappings":"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"}
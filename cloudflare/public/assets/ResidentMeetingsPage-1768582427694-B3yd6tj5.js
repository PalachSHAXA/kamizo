import{r as i,j as e,K as Y,X as le,x as f,J as he,Y as K,aR as be,V as B,B as ge,A as W,F as ie,ab as P,h as pe,U as ee,z as fe,az as je,aS as ve,aP as se,aQ as te,ax as re,aT as Ne}from"./react-vendor-1768582427694-B6y3o6MK.js";import{b as ye,i as we,d as ze,M as D,D as ae}from"./index-1768582427694-DBI_CkbW.js";import{g as Se}from"./LazyQRCode-1768582427694-5IX2K37j.js";import"./vendor-1768582427694-CXLiVVVA.js";import"./qr-scanner-1768582427694-cr32YHjo.js";import"./zustand-1768582427694-wNUYBKDB.js";function ke({isOpen:r,onClose:t,onVerified:R,user:x,language:c,title:T,description:_}){const[M,A]=i.useState("show"),[C,l]=i.useState(""),[j,k]=i.useState(!1),[y,w]=i.useState(null),[m,b]=i.useState(""),q=i.useRef(null),g=i.useRef(null),z=x.id.toUpperCase();i.useEffect(()=>{if(!r)return;(async()=>{const S=[`ID: ${x.id}`,`Л/С: ${x.login||"-"}`,`ФИО: ${x.name}`,`Адрес: ${x.address||"-"}`,`Кв: ${x.apartment||"-"}`,`Тел: ${x.phone||"-"}`,`Договор: ${x.contractNumber||"-"}`].join(`
`),F=await Se(S,{width:200,margin:2,color:{dark:"#1f2937",light:"#ffffff"}});l(F)})()},[r,x]),i.useEffect(()=>()=>{g.current&&g.current.getTracks().forEach(d=>d.stop())},[]);const I=()=>{g.current&&(g.current.getTracks().forEach(d=>d.stop()),g.current=null),k(!1)},a=()=>{A("show"),I()},h=()=>{m.trim().toUpperCase()===z?(w("success"),setTimeout(()=>{R(),t()},1500)):(w("error"),setTimeout(()=>w(null),2e3))},v=()=>{w("success"),setTimeout(()=>{R(),t()},1e3)};return r?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:T||(c==="ru"?"Электронная подпись":"Elektron imzo")}),e.jsx("p",{className:"text-xs text-gray-500",children:c==="ru"?"Подтвердите вашу личность":"Shaxsingizni tasdiqlang"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[_&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:_}),y==="success"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce",children:e.jsx(f,{className:"w-10 h-10 text-green-500"})}),e.jsx("h4",{className:"text-lg font-bold text-green-700",children:c==="ru"?"Подпись подтверждена!":"Imzo tasdiqlandi!"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:c==="ru"?"Ваш голос будет записан":"Ovozingiz qayd etiladi"})]}),y==="error"&&e.jsxs("div",{className:"text-center py-4 mb-4 bg-red-50 rounded-xl",children:[e.jsx(he,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-red-600",children:c==="ru"?"Неверный ключ подписи":"Noto'g'ri imzo kaliti"})]}),!y&&e.jsx(e.Fragment,{children:M==="show"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:c==="ru"?"Ваш уникальный ключ электронной подписи:":"Sizning noyob elektron imzo kalitingiz:"}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 mb-3",children:C?e.jsx("img",{src:C,alt:"QR Signature",className:"w-32 h-32 mx-auto"}):e.jsx("div",{className:"w-32 h-32 mx-auto bg-gray-100 rounded animate-pulse flex items-center justify-center",children:e.jsx(K,{className:"w-6 h-6 animate-spin text-gray-400"})})}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:x.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:x.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c==="ru"?"Л/С:":"L/H:"," ",x.login||"-"]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-100",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:c==="ru"?"ID электронной подписи:":"Elektron imzo ID:"}),e.jsx("p",{className:"font-mono text-lg font-bold text-blue-600 tracking-wider select-all",children:z})]})]}),e.jsxs("button",{onClick:v,className:"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform",style:{background:"linear-gradient(135deg, #3b82f6, #1d4ed8)"},children:[e.jsx(f,{className:"w-5 h-5"}),c==="ru"?"Подтвердить подпись":"Imzoni tasdiqlash"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-3 text-center",children:c==="ru"?'Нажимая "Подтвердить", вы подписываете голос электронным ключом':'"Tasdiqlash" tugmasini bosish orqali ovozingizni elektron kalit bilan imzolaysiz'})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-black rounded-2xl overflow-hidden mb-4 aspect-square relative",children:[e.jsx("video",{ref:q,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),!j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsx(be,{className:"w-12 h-12 text-gray-500"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-48 h-48 border-2 border-white/50 rounded-2xl"})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:c==="ru"?"Наведите камеру на ваш QR-код подписи":"Kamerani QR-kod imzongizga yo'naltiring"}),e.jsxs("div",{className:"border-t border-gray-100 pt-4 mt-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:c==="ru"?"Или введите код вручную:":"Yoki kodni qo'lda kiriting:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:d=>b(d.target.value.toUpperCase()),placeholder:"SIG-XXXXX-XXXX",className:"flex-1 px-4 py-3 rounded-xl border border-gray-200 text-center font-mono uppercase"}),e.jsx("button",{onClick:h,disabled:!m.trim(),className:"px-4 py-3 bg-blue-500 text-white rounded-xl font-medium disabled:opacity-50",children:"OK"})]})]}),e.jsx("button",{onClick:a,className:"mt-4 text-sm text-blue-600 hover:text-blue-800",children:c==="ru"?"← Показать мой QR-код":"← QR-kodimni ko'rsatish"})]})})})]}),!y&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("button",{onClick:t,className:"w-full py-2.5 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors text-sm",children:c==="ru"?"Отмена":"Bekor qilish"})})]})}):null}function Ve(){const{user:r}=ye(),{meetings:t,fetchMeetings:R,voteForSchedule:x,getScheduleVoteByUser:c,voteOnAgendaItem:T,getVoteByUser:_,getUserVotesForMeeting:M,calculateAgendaItemResult:A,calculateMeetingQuorum:C}=we(),{language:l}=ze(),[j,k]=i.useState(null),[y,w]=i.useState(!1),m=j&&t.find(a=>a.id===j)||null;i.useEffect(()=>{R()},[]),i.useEffect(()=>{j&&r?.id&&M(j,r.id)},[j,r?.id,M]);const b=i.useMemo(()=>t.filter(a=>["schedule_poll_open","voting_open","results_published","protocol_approved"].includes(a.status)&&(!r?.buildingId||a.buildingId===r.buildingId)),[t,r?.buildingId]),q=i.useMemo(()=>b.filter(a=>["schedule_poll_open","voting_open"].includes(a.status)),[b]),g=a=>new Date(a).toLocaleDateString(l==="ru"?"ru-RU":"uz-UZ",{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}),z=a=>{switch(a){case"schedule_poll_open":return{bg:"bg-blue-50 border-blue-300",badge:"bg-blue-100 text-blue-700"};case"voting_open":return{bg:"bg-green-50 border-green-300",badge:"bg-green-100 text-green-700"};case"results_published":return{bg:"bg-purple-50 border-purple-300",badge:"bg-purple-100 text-purple-700"};case"protocol_approved":return{bg:"bg-emerald-50 border-emerald-300",badge:"bg-emerald-100 text-emerald-700"};default:return{bg:"bg-gray-50 border-gray-300",badge:"bg-gray-100 text-gray-700"}}},I=a=>{k(a.id),w(!0)};return e.jsxs("div",{className:"space-y-4 md:space-y-6 pb-20 md:pb-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold flex items-center gap-3",children:[e.jsx(B,{className:"w-7 h-7 text-primary-500"}),l==="ru"?"Собрания":"Yig'ilishlar"]}),q.length>0&&e.jsxs("span",{className:"px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-medium",children:[q.length," ",l==="ru"?"активных":"faol"]})]}),b.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:l==="ru"?"Нет активных собраний":"Faol yig'ilishlar yo'q"})]}):e.jsx("div",{className:"space-y-4",children:b.map(a=>{const h=z(a.status),v=D[a.status],d=C(a.id),S=r?.id&&a.participatedVoters?.includes(r.id);return e.jsxs("div",{className:`glass-card p-4 border-2 ${h.bg} cursor-pointer hover:shadow-md transition-all`,onClick:()=>I(a),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs font-medium ${h.badge}`,children:l==="ru"?v?.label:v?.labelUz}),e.jsxs("span",{className:"text-xs text-gray-500",children:["#",a.number]}),S&&a.status==="voting_open"&&e.jsxs("span",{className:"px-2 py-0.5 rounded-lg text-xs font-medium bg-green-100 text-green-700 flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),l==="ru"?"Вы проголосовали":"Ovoz berdingiz"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:a.buildingAddress})]})]}),e.jsx(W,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.agendaItems.length," ",l==="ru"?"вопросов":"savol"]})]}),a.status==="schedule_poll_open"&&e.jsxs("div",{className:"bg-white/60 rounded-lg p-3 mb-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:l==="ru"?"Голосование за дату":"Sana uchun ovoz berish"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs text-blue-600",children:l==="ru"?"Выберите удобную дату":"Qulay sanani tanlang"})})]}),a.confirmedDateTime&&a.status!=="schedule_poll_open"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-white/60 rounded-lg p-3 mb-3",children:[e.jsx(P,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:g(a.confirmedDateTime)})]}),S&&a.status==="voting_open"&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:l==="ru"?"Спасибо за участие!":"Ishtirok uchun rahmat!"}),e.jsx("p",{className:"text-xs text-green-600",children:l==="ru"?"Ваш голос учтён":"Ovozingiz hisobga olindi"})]})]})}),a.status==="voting_open"&&!S&&e.jsxs("div",{className:"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform touch-manipulation",style:{background:"linear-gradient(135deg, #10b981, #059669)"},children:[e.jsx(B,{className:"w-5 h-5"}),l==="ru"?"Проголосовать":"Ovoz berish"]}),a.status==="voting_open"&&S&&e.jsxs("div",{className:"w-full py-3 px-4 rounded-xl font-medium bg-gray-100 text-gray-700 flex items-center justify-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),l==="ru"?"Посмотреть детали":"Tafsilotlarni ko'rish"]}),["voting_open","results_published","protocol_approved"].includes(a.status)&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-3 pt-3 border-t border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[d.participated,"/",d.total," (",d.percent.toFixed(0),"%)"]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${d.quorumReached?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:d.quorumReached?l==="ru"?"Кворум есть":"Kvorum bor":l==="ru"?"Нет кворума":"Kvorum yo'q"})]})]},a.id)})}),y&&m&&r&&e.jsx(_e,{meeting:m,language:l,user:r,onClose:()=>{w(!1),k(null)},getVote:a=>{const h=_(m.id,a,r.id);if(h&&h.choice!=="schedule")return{choice:h.choice}},onVote:(a,h,v,d)=>T(m.id,a,r.id,r.name,h,{method:"e_signature",otpVerified:v},d),getScheduleVote:()=>c(m.id),onScheduleVote:a=>x(m.id,a),calculateResult:a=>A(m.id,a),calculateQuorum:()=>C(m.id)})]})}function _e({meeting:r,language:t,user:R,onClose:x,getVote:c,onVote:T,getScheduleVote:_,onScheduleVote:M,calculateResult:A,calculateQuorum:C}){const[l,j]=i.useState({}),[k,y]=i.useState({}),[w,m]=i.useState(!1),[b,q]=i.useState(!1),[g,z]=i.useState(null),[I,a]=i.useState(!1),[h,v]=i.useState(!1),[d,S]=i.useState(null),[F,X]=i.useState(!1);i.useEffect(()=>{_().then(s=>{z(s),S(s)})},[_]);const E=r.agendaItems.every(s=>c(s.id)!==void 0),V=C(),O=r.status==="voting_open",H=r.status==="schedule_poll_open",L=["voting_closed","results_published","protocol_generated","protocol_approved"].includes(r.status),Q=(s,o)=>{j(n=>({...n,[s]:o}))},Z=r.agendaItems.every(s=>l[s.id]||c(s.id)),G=r.agendaItems.filter(s=>l[s.id]||c(s.id)).length,ne=()=>{Object.keys(l).length!==0&&m(!0)},de=async()=>{m(!1),q(!0);try{for(const[s,o]of Object.entries(l)){const n=k[s]?.trim()||void 0;await T(s,o,!0,n)}j({}),y({}),X(!0)}catch(s){const o=s?.message||"Ошибка при голосовании. Проверьте что указана площадь квартиры.";alert(o),X(!1)}finally{q(!1)}},ce=async s=>{if(!d&&s!==g){a(!0),v(!1);try{const o=await M(s);if(o&&!o.success){const n=o.error||"Ошибка при голосовании. Проверьте что указана площадь квартиры.";alert(n),z(""),n.includes("не найдено")&&(x(),window.location.reload())}else z(s),v(!0),setTimeout(()=>{S(s),v(!1)},2e3)}catch(o){const n=o?.message||"Ошибка при голосовании. Проверьте что указана площадь квартиры.";alert(n),z(""),n.includes("не найдено")&&(x(),window.location.reload())}finally{a(!1)}}},$=r.scheduleOptions.reduce((s,o)=>s+(o.voteCount??o.votes?.length??0),0),J=Math.max(...r.scheduleOptions.map(s=>s.voteCount??s.votes?.length??0)),oe=r.scheduleOptions.filter(s=>(s.voteCount??s.votes?.length??0)===J&&J>0),xe=s=>new Date(s).toLocaleDateString(t==="ru"?"ru-RU":"uz-UZ",{weekday:"long",day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),me=s=>new Date(s).toLocaleDateString(t==="ru"?"ru-RU":"uz-UZ",{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center",children:[e.jsxs("div",{className:"max-h-[85vh] md:max-h-[90vh] w-full md:max-w-lg md:mx-4 bg-white rounded-t-2xl md:rounded-2xl flex flex-col overflow-hidden animate-in slide-in-from-bottom-4 md:slide-in-from-bottom-0 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-100 bg-white sticky top-0 z-10",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-base font-bold truncate",children:t==="ru"?`Собрание #${r.number}`:`Yig'ilish #${r.number}`}),e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs font-medium flex-shrink-0 ${D[r.status]?.color==="green"?"bg-green-100 text-green-700":D[r.status]?.color==="blue"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:t==="ru"?D[r.status]?.label:D[r.status]?.labelUz})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:r.buildingAddress})]}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation ml-2",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-xl p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ee,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:t==="ru"?"Участие:":"Ishtirok:"}),e.jsxs("span",{className:"font-medium",children:[V.participated,"/",V.total]}),e.jsxs("span",{className:"text-gray-400",children:["(",V.percent.toFixed(0),"%)"]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${V.quorumReached?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:V.quorumReached?t==="ru"?"Кворум есть":"Kvorum bor":t==="ru"?"Нет кворума":"Kvorum yo'q"})]}),H&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),t==="ru"?"Голосование за дату":"Sana uchun ovoz berish"]}),$>0&&e.jsxs("span",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:[$," ",t==="ru"?"голосов":"ovoz"]})]}),r.schedulePollEndsAt&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-100 text-sm",children:[e.jsx(fe,{className:"w-4 h-4"}),t==="ru"?"Завершится: ":"Tugaydi: ",new Date(r.schedulePollEndsAt).toLocaleDateString(t==="ru"?"ru-RU":"uz-UZ",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"})]})]}),!d&&!g&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-amber-700 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 flex-shrink-0"}),t==="ru"?"Нажмите на удобную для вас дату, чтобы проголосовать":"Qulay sanani bosing ovoz berish uchun"]})}),d&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-700",children:t==="ru"?"Вы уже проголосовали!":"Siz allaqachon ovoz berdingiz!"}),e.jsx("p",{className:"text-sm text-green-600",children:t==="ru"?"Ваш голос учтён. Ожидайте подтверждения даты администратором.":"Ovozingiz hisobga olindi. Administrator sanani tasdiqlaguncha kuting."})]})]})}),e.jsx("div",{className:"space-y-3",children:r.scheduleOptions.map((s,o)=>{const n=g===s.id,N=oe.some(ue=>ue.id===s.id),u=s.voteCount??s.votes?.length??0,p=$>0?u/$*100:0,U=!!d;return e.jsxs("div",{onClick:()=>!U&&!I&&ce(s.id),className:`w-full p-4 rounded-xl border-2 text-left transition-all relative overflow-hidden ${n?"border-green-500 bg-green-50 shadow-md":U?"border-gray-200 bg-gray-50 cursor-default":"border-gray-200 hover:border-blue-300 hover:bg-blue-50/50 bg-white cursor-pointer"} ${I?"opacity-70 pointer-events-none":""}`,children:[$>0&&e.jsx("div",{className:`absolute inset-0 transition-all ${n?"bg-green-100":"bg-blue-50"}`,style:{width:`${p}%`}}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${n?"bg-green-500 text-white":"bg-gray-100 text-gray-600"}`,children:n?e.jsx(f,{className:"w-5 h-5"}):o+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:me(s.dateTime)}),N&&!n&&s.votes.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-600 mt-0.5",children:[e.jsx(ve,{className:"w-3 h-3"}),t==="ru"?"Лидирует":"Yetakchi"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`font-semibold ${n?"text-green-700":"text-gray-700"}`,children:u}),$>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:[p.toFixed(0),"%"]})]}),I&&n&&e.jsx(K,{className:"w-5 h-5 text-green-500 animate-spin"})]})]})]},s.id)})}),h&&!d&&e.jsx("div",{className:"bg-green-100 border border-green-300 rounded-xl p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-800",children:t==="ru"?"Голос принят!":"Ovoz qabul qilindi!"}),e.jsx("p",{className:"text-sm text-green-600",children:t==="ru"?"Ваш выбор зарегистрирован. После завершения опроса будет выбрана дата с максимальным числом голосов.":"Tanlovingiz ro'yxatga olindi. So'rovnoma tugagandan so'ng eng ko'p ovoz olgan sana tanlanadi."})]})]})}),g&&!h&&!d&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(f,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-800",children:t==="ru"?"Ваш голос учтён":"Ovozingiz hisobga olindi"}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:t==="ru"?"После завершения опроса будет выбрана дата с максимальным числом голосов.":"So'rovnoma tugagach, eng ko'p ovoz olgan sana tanlanadi."})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),t==="ru"?"Этапы собрания":"Yig'ilish bosqichlari"]}),e.jsx("div",{className:"space-y-3",children:[{status:"schedule_poll_open",label:t==="ru"?"Опрос по дате":"Sana so'rovi",labelUz:"Sana so'rovi"},{status:"schedule_confirmed",label:t==="ru"?"Дата подтверждена":"Sana tasdiqlandi",labelUz:"Sana tasdiqlandi"},{status:"voting_open",label:t==="ru"?"Голосование":"Ovoz berish",labelUz:"Ovoz berish"},{status:"voting_closed",label:t==="ru"?"Подсчёт голосов":"Ovozlar sanash",labelUz:"Ovozlar sanash"},{status:"results_published",label:t==="ru"?"Результаты":"Natijalar",labelUz:"Natijalar"},{status:"protocol_approved",label:t==="ru"?"Протокол":"Bayonnoma",labelUz:"Bayonnoma"}].map((s,o)=>{const n=["schedule_poll_open","schedule_confirmed","voting_open","voting_closed","results_published","protocol_approved"],N=n.indexOf(r.status),p=n.indexOf(s.status)<N,U=s.status===r.status;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${p?"bg-green-500 text-white":U?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:p?e.jsx(f,{className:"w-4 h-4"}):o+1}),e.jsx("span",{className:`text-sm ${p?"text-green-700":U?"text-blue-700 font-medium":"text-gray-400"}`,children:s.label}),U&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full",children:t==="ru"?"Сейчас":"Hozir"})]},s.status)})})]}),r.confirmedDateTime&&!H&&e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-50 rounded-lg p-3",children:[e.jsx(P,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:xe(r.confirmedDateTime)})]}),O&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-blue-700",children:t==="ru"?"Для подтверждения голоса используется ваш уникальный электронный ключ. Это защищает от подделки голосов.":"Ovozni tasdiqlash uchun sizning noyob elektron kalitingiz ishlatiladi. Bu ovozlarni soxtalashtirish oldini oladi."})]})}),(O||L)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:t==="ru"?"Повестка дня":"Kun tartibi"}),r.agendaItems.map((s,o)=>{const n=c(s.id),N=A(s.id);return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"font-medium text-base",children:[o+1,". ",s.title]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-200 text-gray-600",children:t==="ru"?ae[s.threshold]?.label:ae[s.threshold]?.labelUz})})]}),O&&!E&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-3",children:(()=>{const u=l[s.id]||n?.choice;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Q(s.id,"for"),disabled:b,className:`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${u==="for"?"bg-green-500 text-white ring-2 ring-green-300":"bg-green-50 text-green-700 border border-green-200 hover:bg-green-100 active:bg-green-200"}`,children:[e.jsx(se,{className:"w-4 h-4"}),t==="ru"?"За":"Ha"]}),e.jsxs("button",{onClick:()=>Q(s.id,"against"),disabled:b,className:`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${u==="against"?"bg-red-500 text-white ring-2 ring-red-300":"bg-red-50 text-red-700 border border-red-200 hover:bg-red-100 active:bg-red-200"}`,children:[e.jsx(te,{className:"w-4 h-4"}),t==="ru"?"Против":"Yo'q"]}),e.jsxs("button",{onClick:()=>Q(s.id,"abstain"),disabled:b,className:`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${u==="abstain"?"bg-gray-500 text-white ring-2 ring-gray-300":"bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100 active:bg-gray-200"}`,children:[e.jsx(re,{className:"w-4 h-4"}),t==="ru"?"Воздерж.":"Betaraf"]})]})})()}),O&&!E&&l[s.id]&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-1",children:[e.jsx(Ne,{className:"w-3 h-3"}),t==="ru"?"Обоснование (будет в протоколе)":"Asoslash (bayonnomada bo'ladi)"]}),e.jsx("textarea",{value:k[s.id]||"",onChange:u=>y(p=>({...p,[s.id]:u.target.value})),placeholder:t==="ru"?"Почему вы так проголосовали? (необязательно)":"Nima uchun shunday ovoz berdingiz? (ixtiyoriy)",className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-200 resize-none",rows:2,maxLength:500}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:t==="ru"?"Будет виден в протоколе собрания":"Yig'ilish bayonnomasida ko'rinadi"}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:[(k[s.id]||"").length,"/500"]})]})]}),(()=>{const u=n?.choice||l[s.id],p=!!n;return u?e.jsxs("div",{className:`text-sm font-medium flex items-center gap-2 mb-2 ${u==="for"?"text-green-600":u==="against"?"text-red-600":"text-gray-600"}`,children:[p?e.jsx(f,{className:"w-4 h-4"}):e.jsx("span",{className:"w-4 h-4 rounded-full border-2 border-current"}),p?t==="ru"?"Ваш голос: ":"Sizning ovozingiz: ":t==="ru"?"Выбрано: ":"Tanlangan: ",u==="for"?t==="ru"?"За":"Ha":u==="against"?t==="ru"?"Против":"Yo'q":t==="ru"?"Воздержался":"Betaraf",!p&&e.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",t==="ru"?"не подтверждено":"tasdiqlanmagan",")"]})]}):null})(),(L||O&&r.votingSettings?.showIntermediateResults)&&e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:[N.votesFor," (",N.percentFor.toFixed(0),"%)"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:N.votesAgainst})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:N.votesAbstain})]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${N.thresholdMet?"bg-green-500":"bg-red-500"}`,style:{width:`${N.percentFor}%`}})}),L&&s.isApproved!==void 0&&e.jsx("div",{className:`mt-2 px-3 py-1 rounded-lg text-sm font-medium inline-flex items-center gap-1 ${s.isApproved?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.isApproved?t==="ru"?"Принято":"Qabul qilindi":t==="ru"?"Не принято":"Rad etildi"})]})]},s.id)})]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 bg-white safe-area-bottom space-y-2",children:[O&&!E&&Object.keys(l).length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:t==="ru"?"Отвечено:":"Javob berildi:"})]}),e.jsxs("span",{className:"font-medium",children:[G,"/",r.agendaItems.length,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",Math.round(G/r.agendaItems.length*100),"%)"]})]}),!V.quorumReached&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:t==="ru"?"Нет кворума":"Kvorum yo'q"})]}),e.jsx("button",{onClick:ne,disabled:b||Object.keys(l).length===0,className:"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform touch-manipulation disabled:opacity-50",style:{background:Z?"linear-gradient(135deg, #10b981, #059669)":"linear-gradient(135deg, #3b82f6, #1d4ed8)"},children:b?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-5 h-5 animate-spin"}),t==="ru"?"Отправка...":"Yuborilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5"}),Z?t==="ru"?"Подписать и отправить все голоса":"Imzolash va barcha ovozlarni yuborish":t==="ru"?`Подтвердить ${Object.keys(l).length} голос(ов)`:`${Object.keys(l).length} ta ovozni tasdiqlash`]})})]}),(F||E)&&O&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:t==="ru"?"Спасибо за участие!":"Ishtirok uchun rahmat!"}),e.jsx("p",{className:"text-xs text-green-600",children:t==="ru"?"Все ваши голоса учтены":"Barcha ovozlaringiz hisobga olindi"})]})]})}),e.jsx("button",{onClick:x,className:"w-full py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors touch-manipulation",children:t==="ru"?"Закрыть":"Yopish"})]})]}),e.jsx(ke,{isOpen:w,onClose:()=>m(!1),onVerified:de,user:R,language:t,title:t==="ru"?"Подтверждение голосов":"Ovozlarni tasdiqlash",description:t==="ru"?`Подтвердите, что все ${Object.keys(l).length} голос(ов) поданы вами лично. Нажмите "Подтвердить" для подписи электронным ключом.`:`Barcha ${Object.keys(l).length} ta ovoz sizning tomoningizdan berilganligini tasdiqlang. Elektron kalit bilan imzolash uchun "Tasdiqlash" tugmasini bosing.`})]})}export{Ve as ResidentMeetingsPage};
//# sourceMappingURL=ResidentMeetingsPage-1768582427694-B3yd6tj5.js.map

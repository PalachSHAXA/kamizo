import{r as l,j as e,a7 as ee,$ as v,l as Z,m as q,X as se,ar as ae,A as te,a2 as u,af as y,a0 as le,a1 as ne,a_ as ie,aZ as re}from"./react-vendor-1768935444692-B1b45RTo.js";import{b as ce,u as de,S as w,f as oe}from"./index-1768935444692-CsUEvcLn.js";import"./vendor-1768935444692-CoA8TQ05.js";import"./qr-scanner-1768935444692-cr32YHjo.js";import"./zustand-1768935444692-wNUYBKDB.js";function je(){const{user:P}=ce(),{executors:C,addExecutor:H,updateExecutor:U,deleteExecutor:X,fetchExecutors:j,isLoadingExecutors:k}=de(),i=P?.role==="department_head",c=P?.specialization,G=l.useMemo(()=>i&&c?C.filter(s=>s.specialization===c):C,[C,i,c]);l.useEffect(()=>{j()},[j]);const[J,S]=l.useState(!1),[a,g]=l.useState(null),[F,h]=l.useState(!1),[b,E]=l.useState(!1),[f,x]=l.useState(null),[z,L]=l.useState({}),[p,I]=l.useState(null),[n,o]=l.useState({name:"",phone:"",login:"",password:"",specialization:"plumber"}),[t,d]=l.useState({name:"",phone:"",login:"",password:"",specialization:"plumber",role:"executor"}),[A,T]=l.useState(!1),[M,N]=l.useState(null),[_,R]=l.useState(!1),[K,B]=l.useState(!1),Q=async s=>{g(s),o({name:s.name,phone:s.phone,login:s.login,password:s.password||"",specialization:s.specialization}),h(!1),E(!1),B(!0);try{const r=await oe.getById(s.id);if(r.executor){const m={...s,...r.executor,createdAt:r.executor.created_at||s.createdAt};g(m),o({name:m.name,phone:m.phone,login:m.login,password:m.password||"",specialization:m.specialization})}}catch{}finally{B(!1)}},D=()=>{g(null),h(!1),E(!1)},O=(s,r)=>{navigator.clipboard.writeText(s),x(r),setTimeout(()=>x(null),2e3)},V=()=>{a&&(U(a.id,n),n.password&&L(s=>({...s,[a.id]:n.password})),g({...a,...n}),h(!1))},W=async()=>{if(a&&confirm("Вы уверены, что хотите удалить этого исполнителя?")){R(!0);try{await X(a.id),D()}catch(s){alert(s.message||"Ошибка при удалении")}finally{R(!1)}}},$=s=>{switch(s){case"available":return e.jsx("span",{className:"badge badge-done",children:"Доступен"});case"busy":return e.jsx("span",{className:"badge badge-progress",children:"Занят"});case"offline":return e.jsx("span",{className:"badge bg-gray-100 text-gray-600",children:"Не в сети"});default:return e.jsx("span",{className:"badge",children:s})}},Y=async()=>{if(!t.name||!t.phone||!t.login||!t.password){N("Заполните все обязательные поля");return}T(!0),N(null);try{const s=await H(t);s?.id&&L(r=>({...r,[s.id]:t.password})),I({login:t.login,password:t.password}),d({name:"",phone:"",login:"",password:"",specialization:"plumber",role:"executor"}),S(!1),j()}catch(s){N(s.message||"Ошибка при добавлении исполнителя")}finally{T(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:i?"Мои сотрудники":"Исполнители"}),i&&c&&e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["Отдел: ",w[c]]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(),className:"btn-secondary p-2",title:"Обновить",disabled:k,children:e.jsx(ee,{className:`w-5 h-5 ${k?"animate-spin":""}`})}),e.jsx("button",{onClick:()=>{i&&c&&d(s=>({...s,specialization:c,role:"executor"})),S(!0)},className:"btn-primary",children:"+ Добавить исполнителя"})]})]}),k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-primary-500"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:G.map(s=>e.jsxs("div",{className:"glass-card p-5 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-medium text-primary-700",children:s.name.split(" ").map(r=>r[0]).join("").slice(0,2)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:w[s.specialization]||"Не указана"})]})]}),$(s.status)]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),s.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-amber-400"}),s.rating," • ",s.completedCount," выполнено"]})]}),e.jsx("button",{type:"button",className:"w-full btn-secondary text-sm py-2",onClick:()=>Q(s),children:"Подробнее"})]},s.id))}),J&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:i?"Добавить сотрудника в отдел":"Добавить сотрудника"}),i&&c&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg mb-4",children:["Отдел: ",e.jsx("strong",{children:w[c]})]}),M&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",children:M}),e.jsxs("div",{className:"space-y-4",children:[!i&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Роль *"}),e.jsxs("select",{value:t.role,onChange:s=>d({...t,role:s.target.value}),className:"input-field",children:[e.jsx("option",{value:"executor",children:"Исполнитель"}),e.jsx("option",{value:"department_head",children:"Начальник отдела"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ФИО *"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>d({...t,name:s.target.value}),className:"input-field",placeholder:"Фамилия Имя Отчество"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Телефон *"}),e.jsx("input",{type:"text",value:t.phone,onChange:s=>d({...t,phone:s.target.value}),className:"input-field",placeholder:"+998 90 123 45 67"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Логин *"}),e.jsx("input",{type:"text",value:t.login,onChange:s=>d({...t,login:s.target.value}),className:"input-field",placeholder:"login"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Пароль *"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>d({...t,password:s.target.value}),className:"input-field",placeholder:"••••••••"})]}),!i&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Специализация/Отдел *"}),e.jsxs("select",{value:t.specialization,onChange:s=>d({...t,specialization:s.target.value}),className:"input-field",children:[e.jsx("option",{value:"plumber",children:"Сантехник"}),e.jsx("option",{value:"electrician",children:"Электрик"}),e.jsx("option",{value:"elevator",children:"Лифтёр"}),e.jsx("option",{value:"intercom",children:"Домофон"}),e.jsx("option",{value:"cleaning",children:"Уборщица"}),e.jsx("option",{value:"gardener",children:"Садовник"}),e.jsx("option",{value:"security",children:"Охранник"}),e.jsx("option",{value:"carpenter",children:"Столяр"}),e.jsx("option",{value:"boiler",children:"Котельщик"}),e.jsx("option",{value:"ac",children:"Кондиционерщик"}),e.jsx("option",{value:"courier",children:"Курьер"}),e.jsx("option",{value:"other",children:"Другое"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{S(!1),N(null)},className:"btn-secondary flex-1",disabled:A,children:"Отмена"}),e.jsx("button",{onClick:Y,className:"btn-primary flex-1 flex items-center justify-center gap-2",disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Добавление..."]}):"Добавить"})]})]})}),a&&e.jsx("div",{className:"modal-backdrop",onClick:D,children:e.jsxs("div",{className:"modal-content p-6 w-full max-w-lg mx-4",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center text-2xl font-medium text-primary-700",children:a.name.split(" ").map(s=>s[0]).join("").slice(0,2)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:a.name}),e.jsx("div",{className:"text-gray-500",children:w[a.specialization]||"Не указана"}),$(a.status)]})]}),e.jsx("button",{onClick:D,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-amber-50 rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-amber-600 mb-1",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold text-lg",children:a.rating})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Рейтинг"})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-green-600 mb-1",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold text-lg",children:a.completedCount})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Выполнено"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-blue-600 mb-1",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold text-lg",children:a.activeRequests||0})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Активных"})]})]}),F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ФИО"}),e.jsx("input",{type:"text",value:n.name,onChange:s=>o({...n,name:s.target.value}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Телефон"}),e.jsx("input",{type:"text",value:n.phone,onChange:s=>o({...n,phone:s.target.value}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Логин"}),e.jsx("input",{type:"text",value:n.login,onChange:s=>o({...n,login:s.target.value}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Новый пароль"}),e.jsx("input",{type:"text",value:n.password,onChange:s=>o({...n,password:s.target.value}),className:"input-field",placeholder:"Оставьте пустым, чтобы не менять"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Специализация"}),e.jsxs("select",{value:n.specialization,onChange:s=>o({...n,specialization:s.target.value}),className:"input-field",children:[e.jsx("option",{value:"plumber",children:"Сантехник"}),e.jsx("option",{value:"electrician",children:"Электрик"}),e.jsx("option",{value:"elevator",children:"Лифтёр"}),e.jsx("option",{value:"intercom",children:"Домофон"}),e.jsx("option",{value:"cleaning",children:"Уборщица"}),e.jsx("option",{value:"gardener",children:"Садовник"}),e.jsx("option",{value:"security",children:"Охранник"}),e.jsx("option",{value:"carpenter",children:"Столяр"}),e.jsx("option",{value:"boiler",children:"Котельщик"}),e.jsx("option",{value:"ac",children:"Кондиционерщик"}),e.jsx("option",{value:"courier",children:"Курьер"}),e.jsx("option",{value:"other",children:"Другое"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Телефон"})]}),e.jsx("span",{className:"font-medium",children:a.phone})]})}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800 mb-2",children:"Данные для входа"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Логин"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm font-mono",children:a.login}),e.jsx("button",{onClick:()=>O(a.login,"login"),className:"p-1 hover:bg-blue-100 rounded",title:"Копировать",children:f==="login"?e.jsx(u,{className:"w-4 h-4 text-green-500"}):e.jsx(y,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Пароль"}),e.jsx("div",{className:"flex items-center gap-2",children:K?e.jsxs("span",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Загрузка..."]}):a.password||z[a.id]?e.jsxs(e.Fragment,{children:[e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm font-mono",children:b?a.password||z[a.id]:"••••••••"}),e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),E(!b)},className:"p-2 hover:bg-blue-100 active:bg-blue-200 rounded touch-manipulation z-10",title:b?"Скрыть":"Показать",children:b?e.jsx(le,{className:"w-4 h-4 text-gray-400"}):e.jsx(ne,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>O(a.password||z[a.id]||"","password"),className:"p-1 hover:bg-blue-100 rounded",title:"Копировать",children:f==="password"?e.jsx(u,{className:"w-4 h-4 text-green-500"}):e.jsx(y,{className:"w-4 h-4 text-gray-400"})})]}):e.jsx("span",{className:"text-sm text-gray-400 italic",children:'Сбросить через "Редактировать"'})})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Добавлен: ",new Date(a.createdAt).toLocaleDateString("ru-RU")]})]}),e.jsx("div",{className:"flex gap-3 mt-6",children:F?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary flex-1",children:"Отмена"}),e.jsxs("button",{onClick:V,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Сохранить"]})]}):e.jsxs(e.Fragment,{children:[!i&&e.jsx("button",{onClick:W,className:"btn-secondary text-red-600 hover:bg-red-50 flex-1 flex items-center justify-center gap-2",disabled:_,children:_?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Удаление..."]}):"Удалить"}),e.jsxs("button",{onClick:()=>h(!0),className:`btn-primary flex items-center justify-center gap-2 ${i?"w-full":"flex-1"}`,children:[e.jsx(re,{className:"w-4 h-4"}),"Редактировать"]})]})})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(u,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Исполнитель создан!"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Сохраните учетные данные для входа"})]}),e.jsxs("div",{className:"space-y-4 bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Логин"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white px-3 py-1.5 rounded-lg text-sm font-mono font-medium",children:p.login}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(p.login),x("cred-login"),setTimeout(()=>x(null),2e3)},className:"p-1.5 hover:bg-gray-200 rounded-lg transition-colors",children:f==="cred-login"?e.jsx(u,{className:"w-4 h-4 text-green-500"}):e.jsx(y,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Пароль"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white px-3 py-1.5 rounded-lg text-sm font-mono font-medium",children:p.password}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(p.password),x("cred-password"),setTimeout(()=>x(null),2e3)},className:"p-1.5 hover:bg-gray-200 rounded-lg transition-colors",children:f==="cred-password"?e.jsx(u,{className:"w-4 h-4 text-green-500"}):e.jsx(y,{className:"w-4 h-4 text-gray-400"})})]})]})]}),e.jsx("div",{className:"mt-6 p-3 bg-yellow-50 rounded-xl border border-yellow-200",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"⚠️ Сохраните эти данные! Пароль показывается только один раз."})}),e.jsx("button",{onClick:()=>I(null),className:"btn-primary w-full mt-6",children:"Готово"})]})})]})}export{je as ExecutorsPage};
//# sourceMappingURL=ExecutorsPage-1768935444692-BUx1UJ5e.js.map

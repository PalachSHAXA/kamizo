{"version":3,"file":"RentalsPage-1767960438672-Bnmn5OvA.js","sources":["../../src/pages/manager/RentalsPage.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { Key, User, Phone, FileText, Calendar, CheckCircle, AlertCircle, Loader2, GitBranch, Building2, ChevronRight } from 'lucide-react';\nimport { useAuthStore } from '../../stores/authStore';\nimport { useDataStore } from '../../stores/dataStore';\nimport { branchesApi, buildingsApi, usersApi } from '../../services/api';\n\ninterface Branch {\n  code: string;\n  name: string;\n}\n\ninterface Building {\n  id: string;\n  name: string;\n  address: string;\n  branch_code: string;\n}\n\ninterface Resident {\n  id: string;\n  name: string;\n  phone: string;\n  address: string;\n  apartment: string;\n  login?: string;\n}\n\nexport function RentalsPage() {\n  const { user } = useAuthStore();\n  const { rentalApartments, rentalRecords, addRentalApartment, deleteRentalApartment, addRentalRecord, deleteRentalRecord, fetchRentals } = useDataStore();\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const loadRentals = async () => {\n      setIsLoading(true);\n      try {\n        await fetchRentals();\n      } catch (error) {\n        console.error('Failed to fetch rentals:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadRentals();\n  }, [fetchRentals]);\n  const [showAddApartmentModal, setShowAddApartmentModal] = useState(false);\n  const [showAddRecordModal, setShowAddRecordModal] = useState(false);\n  const [selectedApartment, setSelectedApartment] = useState<string | null>(null);\n  const [showCredentials, setShowCredentials] = useState<{ login: string; password: string } | null>(null);\n  const [deleteConfirmApartment, setDeleteConfirmApartment] = useState<{ id: string; ownerLogin: string } | null>(null);\n  const [deletePassword, setDeletePassword] = useState('');\n  const [deleteError, setDeleteError] = useState('');\n\n  const [newApartment, setNewApartment] = useState({\n    name: '',\n    address: '',\n    apartment: '',\n    ownerName: '',\n    ownerPhone: '',\n    ownerLogin: '',\n    password: '',\n    ownerType: 'tenant' as 'tenant' | 'commercial_owner',\n  });\n\n  // Cascading selection state for apartment modal\n  const [branches, setBranches] = useState<Branch[]>([]);\n  const [buildings, setBuildings] = useState<Building[]>([]);\n  const [residents, setResidents] = useState<Resident[]>([]);\n\n  const [selectedBranch, setSelectedBranch] = useState<string>('');\n  const [selectedBuilding, setSelectedBuilding] = useState<string>('');\n  const [selectedResident, setSelectedResident] = useState<Resident | null>(null);\n\n  const [loadingBranches, setLoadingBranches] = useState(false);\n  const [loadingBuildings, setLoadingBuildings] = useState(false);\n  const [loadingResidents, setLoadingResidents] = useState(false);\n\n  // Load branches when modal opens\n  useEffect(() => {\n    if (!showAddApartmentModal) return;\n\n    const loadBranches = async () => {\n      setLoadingBranches(true);\n      try {\n        const data = await branchesApi.getAll();\n        setBranches(data.branches || []);\n      } catch (error) {\n        console.error('Failed to load branches:', error);\n      } finally {\n        setLoadingBranches(false);\n      }\n    };\n    loadBranches();\n  }, [showAddApartmentModal]);\n\n  // Load buildings when branch changes\n  useEffect(() => {\n    if (!selectedBranch) {\n      setBuildings([]);\n      setSelectedBuilding('');\n      setResidents([]);\n      setSelectedResident(null);\n      return;\n    }\n\n    const loadBuildings = async () => {\n      setLoadingBuildings(true);\n      setSelectedBuilding('');\n      setResidents([]);\n      setSelectedResident(null);\n      try {\n        const data = await buildingsApi.getAll();\n        const filteredBuildings = (data.buildings || []).filter(\n          (b: Building) => b.branch_code === selectedBranch\n        );\n        setBuildings(filteredBuildings);\n      } catch (error) {\n        console.error('Failed to load buildings:', error);\n      } finally {\n        setLoadingBuildings(false);\n      }\n    };\n    loadBuildings();\n  }, [selectedBranch]);\n\n  // Load residents when building changes\n  useEffect(() => {\n    if (!selectedBuilding) {\n      setResidents([]);\n      setSelectedResident(null);\n      return;\n    }\n\n    const loadResidents = async () => {\n      setLoadingResidents(true);\n      setSelectedResident(null);\n      try {\n        const data = await usersApi.getAll({ role: 'resident', building_id: selectedBuilding, limit: 500 });\n        setResidents(data.users || []);\n      } catch (error) {\n        console.error('Failed to load residents:', error);\n      } finally {\n        setLoadingResidents(false);\n      }\n    };\n    loadResidents();\n  }, [selectedBuilding]);\n\n  // Auto-populate apartment data when resident is selected\n  const handleResidentSelect = (residentId: string) => {\n    const resident = residents.find(r => r.id === residentId);\n    setSelectedResident(resident || null);\n\n    if (resident) {\n      const buildingData = buildings.find(b => b.id === selectedBuilding);\n      setNewApartment(prev => ({\n        ...prev,\n        address: buildingData?.address || resident.address || '',\n        apartment: resident.apartment || '',\n        ownerName: resident.name || '',\n        ownerPhone: resident.phone || '',\n        ownerLogin: resident.login || '',\n      }));\n    }\n  };\n\n  // Reset cascading selection when modal closes\n  const resetCascadingSelection = () => {\n    setSelectedBranch('');\n    setSelectedBuilding('');\n    setSelectedResident(null);\n    setBranches([]);\n    setBuildings([]);\n    setResidents([]);\n  };\n\n  const [newRecord, setNewRecord] = useState({\n    guestNames: '',\n    passportInfo: '',\n    checkInDate: '',\n    checkOutDate: '',\n    amount: '',\n    currency: 'UZS',\n    notes: '',\n  });\n\n  const generateCredentials = () => {\n    const prefix = newApartment.ownerType === 'commercial_owner' ? 'owner' : 'tenant';\n    const login = prefix + Math.floor(Math.random() * 10000);\n    const password = Math.random().toString(36).slice(-8);\n    setNewApartment({ ...newApartment, ownerLogin: login, password });\n  };\n\n  const handleDeleteConfirm = async () => {\n    if (!deleteConfirmApartment) return;\n\n    // Find apartment to get stored password\n    const apartment = rentalApartments.find(a => a.id === deleteConfirmApartment.id);\n\n    if (!apartment || apartment.ownerPassword !== deletePassword) {\n      setDeleteError('Неверный пароль');\n      return;\n    }\n\n    try {\n      await deleteRentalApartment(deleteConfirmApartment.id);\n      // Also remove user from auth store\n      const { removeUser } = useAuthStore.getState();\n      removeUser(deleteConfirmApartment.ownerLogin);\n\n      setDeleteConfirmApartment(null);\n      setDeletePassword('');\n      setDeleteError('');\n    } catch (error) {\n      setDeleteError('Ошибка удаления');\n    }\n  };\n\n  const handleAddApartment = async () => {\n    // Validate required fields - now uses cascading selection\n    if (!newApartment.name || !selectedResident || !newApartment.ownerLogin || !newApartment.password) {\n      alert('Пожалуйста, заполните все обязательные поля');\n      return;\n    }\n\n    const prefix = newApartment.ownerType === 'commercial_owner' ? 'owner_' : 'tenant_';\n    const ownerId = prefix + Math.random().toString(36).substr(2, 9);\n\n    try {\n      const result = await addRentalApartment({\n        ...newApartment,\n        ownerId,\n        password: newApartment.password,\n        ownerType: newApartment.ownerType,\n      });\n\n      if (result) {\n        setShowCredentials({ login: newApartment.ownerLogin, password: newApartment.password });\n        setNewApartment({ name: '', address: '', apartment: '', ownerName: '', ownerPhone: '', ownerLogin: '', password: '', ownerType: 'tenant' });\n        resetCascadingSelection();\n        setShowAddApartmentModal(false);\n      } else {\n        alert('Ошибка создания пользователя. Ответ сервера пустой.');\n      }\n    } catch (error: any) {\n      console.error('[RentalsPage] Error creating apartment:', error);\n      alert(`Ошибка создания пользователя: ${error.message || 'Неизвестная ошибка'}`);\n    }\n  };\n\n  const handleAddRecord = async () => {\n    if (!selectedApartment || !newRecord.guestNames || !newRecord.passportInfo || !newRecord.checkInDate || !newRecord.checkOutDate || !newRecord.amount) return;\n\n    const result = await addRentalRecord({\n      apartmentId: selectedApartment,\n      guestNames: newRecord.guestNames,\n      passportInfo: newRecord.passportInfo,\n      checkInDate: newRecord.checkInDate,\n      checkOutDate: newRecord.checkOutDate,\n      amount: parseFloat(newRecord.amount),\n      currency: newRecord.currency,\n      notes: newRecord.notes,\n      createdBy: user?.id || '',\n    });\n\n    if (result) {\n      setNewRecord({ guestNames: '', passportInfo: '', checkInDate: '', checkOutDate: '', amount: '', currency: 'UZS', notes: '' });\n      setShowAddRecordModal(false);\n    } else {\n      alert('Ошибка сохранения записи');\n    }\n  };\n\n  const getApartmentRecords = (apartmentId: string) => {\n    return rentalRecords.filter(r => r.apartmentId === apartmentId).sort((a, b) =>\n      new Date(b.checkInDate).getTime() - new Date(a.checkInDate).getTime()\n    );\n  };\n\n  const formatDate = (date: string) => {\n    return new Date(date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short', year: 'numeric' });\n  };\n\n  const formatAmount = (amount: number, currency: string) => {\n    if (currency === 'UZS') {\n      return amount.toLocaleString('ru-RU') + ' сум';\n    }\n    return '$' + amount.toLocaleString('en-US');\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-2xl font-bold text-gray-900\">Аренда квартир</h1>\n        <button onClick={() => setShowAddApartmentModal(true)} className=\"btn-primary\">\n          + Добавить квартиру\n        </button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"glass-card p-8 text-center\">\n          <Loader2 className=\"w-12 h-12 text-primary-500 mx-auto mb-4 animate-spin\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Загрузка...</h3>\n        </div>\n      ) : rentalApartments.length === 0 ? (\n        <div className=\"glass-card p-8 text-center\">\n          <Key className=\"w-12 h-12 text-gray-300 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Квартир пока нет</h3>\n          <p className=\"text-gray-500\">Добавьте первую квартиру для управления арендой</p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {rentalApartments.map((apartment) => {\n            const records = getApartmentRecords(apartment.id);\n            const activeRecord = records.find(r => new Date(r.checkOutDate) >= new Date());\n\n            return (\n              <div\n                key={apartment.id}\n                className=\"glass-card p-5 cursor-pointer hover:shadow-lg transition-shadow\"\n                onClick={() => setSelectedApartment(apartment.id)}\n              >\n                <div className=\"flex items-start justify-between mb-3\">\n                  <div>\n                    <h3 className=\"font-semibold text-lg mb-1\">{apartment.name}</h3>\n                    <div className=\"text-sm text-gray-500\">{apartment.address}, кв. {apartment.apartment}</div>\n                  </div>\n                  {activeRecord ? (\n                    <span className=\"badge badge-progress\">Занята</span>\n                  ) : (\n                    <span className=\"badge badge-done\">Свободна</span>\n                  )}\n                </div>\n                <div className=\"space-y-2 text-sm text-gray-600\">\n                  <div className=\"flex items-center gap-2\">\n                    <User className=\"w-4 h-4\" />\n                    {apartment.ownerName}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Phone className=\"w-4 h-4\" />\n                    {apartment.ownerPhone}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"w-4 h-4\" />\n                    {records.length} записей\n                  </div>\n                </div>\n                {activeRecord && (\n                  <div className=\"mt-3 pt-3 border-t border-gray-100\">\n                    <div className=\"text-xs text-gray-500\">Текущий гость:</div>\n                    <div className=\"text-sm font-medium\">{activeRecord.guestNames}</div>\n                    <div className=\"text-xs text-gray-500\">до {formatDate(activeRecord.checkOutDate)}</div>\n                  </div>\n                )}\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    setDeleteConfirmApartment({ id: apartment.id, ownerLogin: apartment.ownerLogin });\n                  }}\n                  className=\"mt-3 text-xs text-red-500 hover:text-red-700\"\n                >\n                  Удалить квартиру\n                </button>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Apartment Details Modal */}\n      {selectedApartment && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\" onClick={() => setSelectedApartment(null)}>\n          <div className=\"bg-white rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto\" onClick={e => e.stopPropagation()}>\n            {(() => {\n              const apartment = rentalApartments.find(a => a.id === selectedApartment);\n              const records = getApartmentRecords(selectedApartment);\n              if (!apartment) return null;\n\n              return (\n                <>\n                  <div className=\"flex items-center justify-between mb-6\">\n                    <div>\n                      <h2 className=\"text-xl font-bold\">{apartment.name}</h2>\n                      <div className=\"text-gray-500\">{apartment.address}, кв. {apartment.apartment}</div>\n                    </div>\n                    <button\n                      onClick={() => { setShowAddRecordModal(true); }}\n                      className=\"btn-primary text-sm\"\n                    >\n                      + Добавить запись\n                    </button>\n                  </div>\n\n                  <div className=\"mb-6 p-4 bg-gray-50 rounded-xl\">\n                    <div className=\"text-sm text-gray-500 mb-2\">Владелец</div>\n                    <div className=\"font-medium\">{apartment.ownerName}</div>\n                    <div className=\"text-sm text-gray-600\">{apartment.ownerPhone}</div>\n                    <div className=\"mt-3 pt-3 border-t border-gray-200\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <div className=\"text-xs text-gray-400\">Логин</div>\n                          <div className=\"font-mono text-sm font-medium text-gray-700\">{apartment.ownerLogin}</div>\n                        </div>\n                        <div>\n                          <div className=\"text-xs text-gray-400\">Пароль</div>\n                          <div className=\"font-mono text-sm font-medium text-gray-700\">{apartment.ownerPassword || '—'}</div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <h3 className=\"font-semibold mb-4\">История аренды ({records.length})</h3>\n\n                  {records.length === 0 ? (\n                    <div className=\"text-center py-8 text-gray-500\">\n                      Записей пока нет\n                    </div>\n                  ) : (\n                    <div className=\"space-y-3\">\n                      {records.map(record => {\n                        const isActive = new Date(record.checkOutDate) >= new Date();\n                        return (\n                          <div key={record.id} className={`p-4 rounded-xl border ${isActive ? 'border-green-200 bg-green-50' : 'border-gray-200'}`}>\n                            <div className=\"flex items-start justify-between\">\n                              <div>\n                                <div className=\"font-medium\">{record.guestNames}</div>\n                                <div className=\"text-sm text-gray-500\">{record.passportInfo}</div>\n                              </div>\n                              <div className=\"text-right\">\n                                <div className=\"font-semibold text-green-600\">{formatAmount(record.amount, record.currency)}</div>\n                                {isActive && <span className=\"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded\">Активно</span>}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-4 mt-2 text-sm text-gray-600\">\n                              <div className=\"flex items-center gap-1\">\n                                <Calendar className=\"w-4 h-4\" />\n                                {formatDate(record.checkInDate)} - {formatDate(record.checkOutDate)}\n                              </div>\n                            </div>\n                            {record.notes && (\n                              <div className=\"mt-2 text-sm text-gray-500\">{record.notes}</div>\n                            )}\n                            <button\n                              onClick={async () => {\n                                try {\n                                  await deleteRentalRecord(record.id);\n                                } catch (error) {\n                                  alert('Ошибка удаления записи');\n                                }\n                              }}\n                              className=\"mt-2 text-xs text-red-500 hover:text-red-700\"\n                            >\n                              Удалить\n                            </button>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  )}\n\n                  <div className=\"flex justify-end mt-6\">\n                    <button onClick={() => setSelectedApartment(null)} className=\"btn-secondary\">\n                      Закрыть\n                    </button>\n                  </div>\n                </>\n              );\n            })()}\n          </div>\n        </div>\n      )}\n\n      {/* Add Apartment Modal */}\n      {showAddApartmentModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto\">\n            <h2 className=\"text-xl font-bold mb-6\">Добавить квартиру</h2>\n            <div className=\"space-y-4\">\n              {/* Apartment Name */}\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Название</label>\n                <input\n                  type=\"text\"\n                  value={newApartment.name}\n                  onChange={e => setNewApartment({ ...newApartment, name: e.target.value })}\n                  placeholder=\"Квартира у моря\"\n                  className=\"glass-input\"\n                />\n              </div>\n\n              {/* Cascading Selection */}\n              <div className=\"border-t pt-4\">\n                <h3 className=\"font-medium mb-3 flex items-center gap-2\">\n                  <Building2 className=\"w-5 h-5\" />\n                  Выбор квартиры и владельца\n                </h3>\n\n                {/* Branch Selection */}\n                <div className=\"mb-3\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1\">\n                    <GitBranch className=\"w-4 h-4\" />\n                    Филиал *\n                  </label>\n                  <select\n                    value={selectedBranch}\n                    onChange={(e) => setSelectedBranch(e.target.value)}\n                    className=\"glass-input w-full\"\n                    disabled={loadingBranches}\n                  >\n                    <option value=\"\">\n                      {loadingBranches ? 'Загрузка...' : 'Выберите филиал'}\n                    </option>\n                    {branches.map(branch => (\n                      <option key={branch.code} value={branch.code}>{branch.name}</option>\n                    ))}\n                  </select>\n                </div>\n\n                {/* Building Selection */}\n                <div className=\"mb-3\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1\">\n                    <Building2 className=\"w-4 h-4\" />\n                    Дом *\n                  </label>\n                  <select\n                    value={selectedBuilding}\n                    onChange={(e) => setSelectedBuilding(e.target.value)}\n                    className=\"glass-input w-full\"\n                    disabled={!selectedBranch || loadingBuildings}\n                  >\n                    <option value=\"\">\n                      {loadingBuildings ? 'Загрузка...' : !selectedBranch ? 'Сначала выберите филиал' : 'Выберите дом'}\n                    </option>\n                    {buildings.map(building => (\n                      <option key={building.id} value={building.id}>\n                        {building.name} - {building.address}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                {/* Resident Selection */}\n                <div className=\"mb-3\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1\">\n                    <User className=\"w-4 h-4\" />\n                    Житель (владелец) *\n                  </label>\n                  <select\n                    value={selectedResident?.id || ''}\n                    onChange={(e) => handleResidentSelect(e.target.value)}\n                    className=\"glass-input w-full\"\n                    disabled={!selectedBuilding || loadingResidents}\n                  >\n                    <option value=\"\">\n                      {loadingResidents ? 'Загрузка...' : !selectedBuilding ? 'Сначала выберите дом' : 'Выберите жителя'}\n                    </option>\n                    {residents.map(resident => (\n                      <option key={resident.id} value={resident.id}>\n                        {resident.name} {resident.apartment ? `- кв. ${resident.apartment}` : ''}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                {/* Selected Resident Info */}\n                {selectedResident && (\n                  <div className=\"bg-primary-50 border border-primary-200 rounded-xl p-4 mt-3\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center\">\n                        <User className=\"w-5 h-5 text-primary-600\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-semibold text-gray-900\">{selectedResident.name}</p>\n                        <p className=\"text-sm text-gray-600\">\n                          {selectedResident.phone || 'Телефон не указан'}\n                        </p>\n                        <p className=\"text-sm text-gray-500 mt-1\">\n                          {buildings.find(b => b.id === selectedBuilding)?.address}\n                          {selectedResident.apartment && `, кв. ${selectedResident.apartment}`}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Selection Path Display */}\n                {(selectedBranch || selectedBuilding) && (\n                  <div className=\"flex items-center gap-1 text-xs text-gray-500 mt-2 flex-wrap\">\n                    {selectedBranch && (\n                      <>\n                        <span className=\"bg-gray-100 px-2 py-1 rounded\">\n                          {branches.find(b => b.code === selectedBranch)?.name}\n                        </span>\n                        {selectedBuilding && <ChevronRight className=\"w-3 h-3\" />}\n                      </>\n                    )}\n                    {selectedBuilding && (\n                      <>\n                        <span className=\"bg-gray-100 px-2 py-1 rounded\">\n                          {buildings.find(b => b.id === selectedBuilding)?.name}\n                        </span>\n                        {selectedResident && <ChevronRight className=\"w-3 h-3\" />}\n                      </>\n                    )}\n                    {selectedResident && (\n                      <span className=\"bg-primary-100 text-primary-700 px-2 py-1 rounded\">\n                        {selectedResident.name}\n                      </span>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* Owner Login/Password */}\n              <div className=\"border-t pt-4\">\n                <h3 className=\"font-medium mb-3\">Учётные данные владельца</h3>\n                <div className=\"space-y-3\">\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-1\">\n                      <label className=\"block text-sm font-medium mb-1\">Логин</label>\n                      <input\n                        type=\"text\"\n                        value={newApartment.ownerLogin}\n                        onChange={e => setNewApartment({ ...newApartment, ownerLogin: e.target.value })}\n                        className=\"glass-input\"\n                        readOnly={!!selectedResident?.login}\n                      />\n                    </div>\n                    <div className=\"flex-1\">\n                      <label className=\"block text-sm font-medium mb-1\">Пароль</label>\n                      <input\n                        type=\"text\"\n                        value={newApartment.password}\n                        onChange={e => setNewApartment({ ...newApartment, password: e.target.value })}\n                        className=\"glass-input\"\n                      />\n                    </div>\n                  </div>\n                  <button onClick={generateCredentials} className=\"text-sm text-primary-600 hover:text-primary-700\">\n                    Сгенерировать логин/пароль\n                  </button>\n                </div>\n              </div>\n            </div>\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => {\n                  setShowAddApartmentModal(false);\n                  resetCascadingSelection();\n                  setNewApartment({ name: '', address: '', apartment: '', ownerName: '', ownerPhone: '', ownerLogin: '', password: '', ownerType: 'tenant' });\n                }}\n                className=\"btn-secondary flex-1\"\n              >\n                Отмена\n              </button>\n              <button\n                onClick={handleAddApartment}\n                className=\"btn-primary flex-1\"\n                disabled={!selectedResident}\n              >\n                Добавить\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Add Record Modal */}\n      {showAddRecordModal && selectedApartment && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl p-6 w-full max-w-md\">\n            <h2 className=\"text-xl font-bold mb-6\">Добавить запись</h2>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Имена гостей</label>\n                <input\n                  type=\"text\"\n                  value={newRecord.guestNames}\n                  onChange={e => setNewRecord({ ...newRecord, guestNames: e.target.value })}\n                  placeholder=\"Иванов Иван, Петрова Мария\"\n                  className=\"glass-input\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Паспортные данные</label>\n                <input\n                  type=\"text\"\n                  value={newRecord.passportInfo}\n                  onChange={e => setNewRecord({ ...newRecord, passportInfo: e.target.value })}\n                  placeholder=\"AA1234567\"\n                  className=\"glass-input\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium mb-1\">Дата заезда</label>\n                  <input\n                    type=\"date\"\n                    value={newRecord.checkInDate}\n                    onChange={e => setNewRecord({ ...newRecord, checkInDate: e.target.value })}\n                    className=\"glass-input\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium mb-1\">Дата выезда</label>\n                  <input\n                    type=\"date\"\n                    value={newRecord.checkOutDate}\n                    onChange={e => setNewRecord({ ...newRecord, checkOutDate: e.target.value })}\n                    className=\"glass-input\"\n                  />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium mb-1\">Сумма</label>\n                  <input\n                    type=\"number\"\n                    value={newRecord.amount}\n                    onChange={e => setNewRecord({ ...newRecord, amount: e.target.value })}\n                    placeholder=\"1000000\"\n                    className=\"glass-input\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium mb-1\">Валюта</label>\n                  <select\n                    value={newRecord.currency}\n                    onChange={e => setNewRecord({ ...newRecord, currency: e.target.value })}\n                    className=\"glass-input\"\n                  >\n                    <option value=\"UZS\">UZS (сум)</option>\n                    <option value=\"USD\">USD ($)</option>\n                  </select>\n                </div>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Заметки (опционально)</label>\n                <textarea\n                  value={newRecord.notes}\n                  onChange={e => setNewRecord({ ...newRecord, notes: e.target.value })}\n                  className=\"glass-input min-h-[80px]\"\n                  placeholder=\"Дополнительная информация...\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-3 mt-6\">\n              <button onClick={() => { setShowAddRecordModal(false); }} className=\"btn-secondary flex-1\">\n                Отмена\n              </button>\n              <button onClick={handleAddRecord} className=\"btn-primary flex-1\">\n                Добавить\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Credentials Modal */}\n      {showCredentials && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl p-6 w-full max-w-sm text-center\">\n            <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n            </div>\n            <h2 className=\"text-xl font-bold mb-2\">Квартира добавлена!</h2>\n            <p className=\"text-gray-500 mb-6\">Данные для входа владельца:</p>\n            <div className=\"bg-gray-50 rounded-xl p-4 mb-6\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-gray-500\">Логин:</span>\n                <span className=\"font-mono font-bold\">{showCredentials.login}</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-gray-500\">Пароль:</span>\n                <span className=\"font-mono font-bold\">{showCredentials.password}</span>\n              </div>\n            </div>\n            <button onClick={() => setShowCredentials(null)} className=\"btn-primary w-full\">\n              Готово\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {deleteConfirmApartment && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl p-6 w-full max-w-sm\">\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <AlertCircle className=\"w-8 h-8 text-red-600\" />\n            </div>\n            <h2 className=\"text-xl font-bold mb-2 text-center\">Подтвердите удаление</h2>\n            <p className=\"text-gray-500 mb-6 text-center\">\n              Введите пароль владельца квартиры для подтверждения удаления\n            </p>\n            <div className=\"mb-4\">\n              <input\n                type=\"password\"\n                value={deletePassword}\n                onChange={e => {\n                  setDeletePassword(e.target.value);\n                  setDeleteError('');\n                }}\n                placeholder=\"Пароль владельца\"\n                className=\"glass-input w-full\"\n              />\n              {deleteError && (\n                <p className=\"text-red-500 text-sm mt-2\">{deleteError}</p>\n              )}\n            </div>\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => {\n                  setDeleteConfirmApartment(null);\n                  setDeletePassword('');\n                  setDeleteError('');\n                }}\n                className=\"btn-secondary flex-1\"\n              >\n                Отмена\n              </button>\n              <button\n                onClick={handleDeleteConfirm}\n                className=\"flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl font-medium transition-colors\"\n              >\n                Удалить\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["RentalsPage","user","useAuthStore","rentalApartments","rentalRecords","addRentalApartment","deleteRentalApartment","addRentalRecord","deleteRentalRecord","fetchRentals","useDataStore","isLoading","setIsLoading","useState","useEffect","showAddApartmentModal","setShowAddApartmentModal","showAddRecordModal","setShowAddRecordModal","selectedApartment","setSelectedApartment","showCredentials","setShowCredentials","deleteConfirmApartment","setDeleteConfirmApartment","deletePassword","setDeletePassword","deleteError","setDeleteError","newApartment","setNewApartment","branches","setBranches","buildings","setBuildings","residents","setResidents","selectedBranch","setSelectedBranch","selectedBuilding","setSelectedBuilding","selectedResident","setSelectedResident","loadingBranches","setLoadingBranches","loadingBuildings","setLoadingBuildings","loadingResidents","setLoadingResidents","data","branchesApi","filteredBuildings","buildingsApi","b","usersApi","handleResidentSelect","residentId","resident","r","buildingData","prev","resetCascadingSelection","newRecord","setNewRecord","generateCredentials","login","password","handleDeleteConfirm","apartment","a","removeUser","handleAddApartment","ownerId","error","handleAddRecord","getApartmentRecords","apartmentId","formatDate","date","formatAmount","amount","currency","jsxs","jsx","Loader2","Key","records","activeRecord","User","Phone","FileText","e","Fragment","record","isActive","Calendar","Building2","GitBranch","branch","building","ChevronRight","CheckCircle","AlertCircle"],"mappings":"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"}
{"version":3,"mappings":"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","names":["AnnouncementsPage","user","useAuthStore","announcements","addAnnouncement","deleteAnnouncement","updateAnnouncement","fetchAnnouncements","useDataStore","t","language","useLanguageStore","canManageAnnouncements","activeTab","setActiveTab","useState","showAddModal","setShowAddModal","showEditModal","setShowEditModal","editingAnnouncement","setEditingAnnouncement","newAnnouncement","setNewAnnouncement","targetType","setTargetType","selectedBranch","setSelectedBranch","selectedBuilding","setSelectedBuilding","customLogins","setCustomLogins","uploadedFileName","setUploadedFileName","fileInputRef","useRef","attachments","setAttachments","isUploadingAttachment","setIsUploadingAttachment","attachmentInputRef","buildings","setBuildings","useEffect","result","buildingsApi","branches","useMemo","branchMap","b","branchCode","branch","dateFilter","setDateFilter","filterByDate","items","now","today","weekAgo","monthAgo","a","createdAt","residentAnnouncements","employeeAnnouncements","currentAnnouncements","handleFileUpload","e","file","XLSX","reader","event","data","workbook","sheetName","sheet","jsonData","logins","row","value","buildTarget","getTargetDescription","building","resetTargeting","handleAttachmentUpload","files","newAttachments","uploadApi","prev","removeAttachment","index","_","i","getFileIcon","type","jsx","Image","FileText","File","formatFileSize","bytes","handleAddAnnouncement","target","handleDelete","id","getPriorityIcon","priority","AlertTriangle","AlertCircle","Info","getPriorityBadge","formatDate","dateStr","jsxs","Plus","Users","Briefcase","Filter","Megaphone","announcement","AnnouncementCard","X","Target","Building2","FileSpreadsheet","label","Icon","Upload","Paperclip","Fragment","attachment","p","onDelete","onEdit","canDelete","canEdit","showViewers","setShowViewers","viewers","setViewers","isLoadingViewers","setIsLoadingViewers","viewStats","setViewStats","viewCount","handleViewClick","announcementsApi","__vitePreload","n","Download","Clock","Eye","Trash2","viewer"],"ignoreList":[],"sources":["../../src/pages/AnnouncementsPage.tsx"],"sourcesContent":["import { useState, useMemo, useRef, useEffect } from 'react';\nimport { Plus, Megaphone, Users, Briefcase, X, AlertTriangle, AlertCircle, Info, Trash2, Eye, Clock, Building2, Upload, FileSpreadsheet, Target, Filter, Paperclip, File, Image, FileText, Download } from 'lucide-react';\nimport { useAuthStore } from '../stores/authStore';\nimport { useDataStore } from '../stores/dataStore';\nimport { useLanguageStore } from '../stores/languageStore';\nimport { buildingsApi, uploadApi } from '../services/api';\nimport type { Announcement, AnnouncementType, AnnouncementPriority, AnnouncementTargetType, AnnouncementTarget, FileAttachment } from '../types';\n\nexport function AnnouncementsPage() {\n  const { user } = useAuthStore();\n  const { announcements, addAnnouncement, deleteAnnouncement, updateAnnouncement, fetchAnnouncements } = useDataStore();\n  const { t, language } = useLanguageStore();\n\n  // Only admin, manager, director can create/edit announcements\n  const canManageAnnouncements = user?.role === 'admin' || user?.role === 'manager' || user?.role === 'director';\n\n  const [activeTab, setActiveTab] = useState<'residents' | 'employees'>('residents');\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingAnnouncement, setEditingAnnouncement] = useState<Announcement | null>(null);\n  const [newAnnouncement, setNewAnnouncement] = useState({\n    title: '',\n    content: '',\n    type: 'residents' as AnnouncementType,\n    priority: 'normal' as AnnouncementPriority,\n    expiresAt: '',\n  });\n\n  // Targeting state\n  const [targetType, setTargetType] = useState<AnnouncementTargetType>('all');\n  const [selectedBranch, setSelectedBranch] = useState('');\n  const [selectedBuilding, setSelectedBuilding] = useState('');\n  const [customLogins, setCustomLogins] = useState<string[]>([]);\n  const [uploadedFileName, setUploadedFileName] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // File attachments state\n  const [attachments, setAttachments] = useState<FileAttachment[]>([]);\n  const [isUploadingAttachment, setIsUploadingAttachment] = useState(false);\n  const attachmentInputRef = useRef<HTMLInputElement>(null);\n\n  // Real buildings from API\n  const [buildings, setBuildings] = useState<any[]>([]);\n\n  // Fetch buildings on mount\n  useEffect(() => {\n    const loadBuildings = async () => {\n      try {\n        const result = await buildingsApi.getAll();\n        setBuildings(result.buildings || []);\n      } catch (error) {\n        console.error('Failed to load buildings:', error);\n      }\n    };\n    loadBuildings();\n    fetchAnnouncements(); // Also refresh announcements\n  }, [fetchAnnouncements]);\n\n  // Extract unique branches from buildings (using branch_code field)\n  const branches = useMemo(() => {\n    const branchMap = new Map<string, { id: string; name: string; buildingCount: number }>();\n    buildings.forEach(b => {\n      const branchCode = b.branch_code || b.branchCode || 'default';\n      if (!branchMap.has(branchCode)) {\n        branchMap.set(branchCode, {\n          id: branchCode,\n          name: branchCode === 'default' ? (language === 'ru' ? 'Основной филиал' : 'Asosiy filial') : branchCode,\n          buildingCount: 0\n        });\n      }\n      const branch = branchMap.get(branchCode)!;\n      branch.buildingCount++;\n    });\n    return Array.from(branchMap.values());\n  }, [buildings, language]);\n\n  // Date filter state\n  const [dateFilter, setDateFilter] = useState<'all' | 'today' | 'week' | 'month'>('all');\n\n  // Filter announcements by type and date\n  const filterByDate = (items: typeof announcements) => {\n    if (dateFilter === 'all') return items;\n\n    const now = new Date();\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n    return items.filter(a => {\n      const createdAt = new Date(a.createdAt);\n      switch (dateFilter) {\n        case 'today':\n          return createdAt >= today;\n        case 'week':\n          return createdAt >= weekAgo;\n        case 'month':\n          return createdAt >= monthAgo;\n        default:\n          return true;\n      }\n    });\n  };\n\n  const residentAnnouncements = useMemo(() =>\n    filterByDate(announcements.filter(a => a.type === 'residents' && a.isActive)),\n    [announcements, dateFilter]\n  );\n\n  const employeeAnnouncements = useMemo(() =>\n    filterByDate(announcements.filter(a => a.type === 'employees' && a.isActive)),\n    [announcements, dateFilter]\n  );\n\n  const currentAnnouncements = activeTab === 'residents' ? residentAnnouncements : employeeAnnouncements;\n\n  // Handle Excel file upload for custom targeting\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setUploadedFileName(file.name);\n\n    // Lazy load XLSX library\n    const XLSX = await import('xlsx');\n\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      try {\n        const data = event.target?.result;\n        const workbook = XLSX.read(data, { type: 'binary' });\n        const sheetName = workbook.SheetNames[0];\n        const sheet = workbook.Sheets[sheetName];\n        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 }) as any[][];\n\n        // Extract logins from first column (skip header)\n        const logins: string[] = [];\n        jsonData.slice(1).forEach(row => {\n          if (row[0]) {\n            const value = String(row[0]).trim();\n            if (value) logins.push(value);\n          }\n        });\n\n        setCustomLogins(logins);\n      } catch (err) {\n        console.error('Error parsing Excel file:', err);\n        alert(language === 'ru' ? 'Ошибка чтения файла' : 'Faylni o\\'qishda xato');\n      }\n    };\n    reader.readAsBinaryString(file);\n  };\n\n  // Build target object based on selections\n  const buildTarget = (): AnnouncementTarget | undefined => {\n    if (newAnnouncement.type !== 'residents') return undefined;\n\n    switch (targetType) {\n      case 'all':\n        return { type: 'all' };\n      case 'branch':\n        return selectedBranch ? { type: 'branch', branchId: selectedBranch } : undefined;\n      case 'building':\n        return selectedBuilding ? { type: 'building', buildingId: selectedBuilding } : undefined;\n      case 'custom':\n        return customLogins.length > 0 ? { type: 'custom', customLogins } : undefined;\n      default:\n        return { type: 'all' };\n    }\n  };\n\n  const getTargetDescription = (): string => {\n    if (newAnnouncement.type !== 'residents') return '';\n\n    switch (targetType) {\n      case 'all':\n        return language === 'ru' ? 'Все жители' : 'Barcha aholiga';\n      case 'branch':\n        const branch = branches.find(b => b.id === selectedBranch);\n        return branch ? branch.name : '';\n      case 'building':\n        const building = buildings.find(b => b.id === selectedBuilding);\n        return building ? building.name : '';\n      case 'custom':\n        return customLogins.length > 0\n          ? `${customLogins.length} ${language === 'ru' ? 'получателей' : 'qabul qiluvchi'}`\n          : '';\n      default:\n        return '';\n    }\n  };\n\n  const resetTargeting = () => {\n    setTargetType('all');\n    setSelectedBranch('');\n    setSelectedBuilding('');\n    setCustomLogins([]);\n    setUploadedFileName('');\n    if (fileInputRef.current) fileInputRef.current.value = '';\n  };\n\n  // Handle file attachment upload\n  const handleAttachmentUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    setIsUploadingAttachment(true);\n    try {\n      const newAttachments = await uploadApi.uploadFiles(Array.from(files));\n      setAttachments(prev => [...prev, ...newAttachments]);\n    } catch (error) {\n      console.error('Failed to upload attachments:', error);\n      alert(language === 'ru' ? 'Ошибка загрузки файла' : 'Fayl yuklashda xato');\n    } finally {\n      setIsUploadingAttachment(false);\n      if (attachmentInputRef.current) attachmentInputRef.current.value = '';\n    }\n  };\n\n  // Remove attachment\n  const removeAttachment = (index: number) => {\n    setAttachments(prev => prev.filter((_, i) => i !== index));\n  };\n\n  // Get file icon based on type\n  const getFileIcon = (type: string) => {\n    if (type.startsWith('image/')) return <Image className=\"w-4 h-4\" />;\n    if (type.includes('pdf') || type.includes('word') || type.includes('document')) return <FileText className=\"w-4 h-4\" />;\n    return <File className=\"w-4 h-4\" />;\n  };\n\n  // Format file size\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  };\n\n  const handleAddAnnouncement = async () => {\n    if (!newAnnouncement.title.trim() || !newAnnouncement.content.trim() || !user) return;\n\n    const target = buildTarget();\n\n    await addAnnouncement({\n      title: newAnnouncement.title,\n      content: newAnnouncement.content,\n      type: newAnnouncement.type,\n      priority: newAnnouncement.priority,\n      authorId: user.id,\n      authorName: user.name,\n      authorRole: user.role,\n      expiresAt: newAnnouncement.expiresAt || undefined,\n      target,\n      attachments: attachments.length > 0 ? attachments : undefined,\n    });\n\n    setNewAnnouncement({\n      title: '',\n      content: '',\n      type: 'residents',\n      priority: 'normal',\n      expiresAt: '',\n    });\n    resetTargeting();\n    setAttachments([]);\n    setShowAddModal(false);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (confirm(language === 'ru' ? 'Удалить объявление?' : 'E\\'lonni o\\'chirishni tasdiqlaysizmi?')) {\n      await deleteAnnouncement(id);\n    }\n  };\n\n  const getPriorityIcon = (priority: AnnouncementPriority) => {\n    switch (priority) {\n      case 'urgent':\n        return <AlertTriangle className=\"w-4 h-4 text-red-500\" />;\n      case 'important':\n        return <AlertCircle className=\"w-4 h-4 text-amber-500\" />;\n      default:\n        return <Info className=\"w-4 h-4 text-blue-500\" />;\n    }\n  };\n\n  const getPriorityBadge = (priority: AnnouncementPriority) => {\n    switch (priority) {\n      case 'urgent':\n        return 'bg-red-100 text-red-700 border-red-200';\n      case 'important':\n        return 'bg-amber-100 text-amber-700 border-amber-200';\n      default:\n        return 'bg-blue-100 text-blue-700 border-blue-200';\n    }\n  };\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">{t('announcements.title')}</h1>\n          <p className=\"text-gray-500\">\n            {language === 'ru'\n              ? (canManageAnnouncements ? 'Создавайте объявления для жителей и сотрудников' : 'Объявления от управляющей компании')\n              : (canManageAnnouncements ? 'Aholi va xodimlar uchun e\\'lonlar yarating' : 'Boshqaruv kompaniyasidan e\\'lonlar')}\n          </p>\n        </div>\n        {/* Only admin, manager, director can create announcements */}\n        {canManageAnnouncements && (\n          <button\n            onClick={() => setShowAddModal(true)}\n            className=\"btn-primary flex items-center gap-2\"\n          >\n            <Plus className=\"w-5 h-5\" />\n            {t('announcements.add')}\n          </button>\n        )}\n      </div>\n\n      {/* Tabs and Date Filter */}\n      <div className=\"flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between\">\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => setActiveTab('residents')}\n            className={`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-colors ${\n              activeTab === 'residents'\n                ? 'bg-orange-400 text-gray-900'\n                : 'bg-white text-gray-600 hover:bg-gray-100'\n            }`}\n          >\n            <Users className=\"w-5 h-5\" />\n            {t('announcements.forResidents')}\n            {residentAnnouncements.length > 0 && (\n              <span className=\"ml-1 px-2 py-0.5 rounded-full bg-gray-900/10 text-xs\">\n                {residentAnnouncements.length}\n              </span>\n            )}\n          </button>\n          <button\n            onClick={() => setActiveTab('employees')}\n            className={`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-colors ${\n              activeTab === 'employees'\n                ? 'bg-orange-400 text-gray-900'\n                : 'bg-white text-gray-600 hover:bg-gray-100'\n            }`}\n          >\n            <Briefcase className=\"w-5 h-5\" />\n            {t('announcements.forStaff')}\n            {employeeAnnouncements.length > 0 && (\n              <span className=\"ml-1 px-2 py-0.5 rounded-full bg-gray-900/10 text-xs\">\n                {employeeAnnouncements.length}\n              </span>\n            )}\n          </button>\n        </div>\n\n        {/* Date Filter */}\n        <div className=\"flex items-center gap-2\">\n          <Filter className=\"w-4 h-4 text-gray-400\" />\n          <select\n            value={dateFilter}\n            onChange={(e) => setDateFilter(e.target.value as typeof dateFilter)}\n            className=\"px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-sm text-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400\"\n          >\n            <option value=\"all\">{language === 'ru' ? 'Все время' : 'Barcha vaqt'}</option>\n            <option value=\"today\">{language === 'ru' ? 'Сегодня' : 'Bugun'}</option>\n            <option value=\"week\">{language === 'ru' ? 'Неделя' : 'Hafta'}</option>\n            <option value=\"month\">{language === 'ru' ? 'Месяц' : 'Oy'}</option>\n          </select>\n        </div>\n      </div>\n\n      {/* Announcements List */}\n      <div className=\"space-y-4\">\n        {currentAnnouncements.length === 0 ? (\n          <div className=\"glass-card p-12 text-center\">\n            <Megaphone className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-600 mb-2\">\n              {t('announcements.noAnnouncements')}\n            </h3>\n            <p className=\"text-gray-400\">{t('announcements.addFirst')}</p>\n          </div>\n        ) : (\n          currentAnnouncements.map((announcement) => (\n            <AnnouncementCard\n              key={announcement.id}\n              announcement={announcement}\n              onDelete={() => handleDelete(announcement.id)}\n              onEdit={() => {\n                setEditingAnnouncement(announcement);\n                setShowEditModal(true);\n              }}\n              formatDate={formatDate}\n              getPriorityIcon={getPriorityIcon}\n              getPriorityBadge={getPriorityBadge}\n              t={t}\n              canDelete={canManageAnnouncements && (user?.id === announcement.authorId || user?.role === 'admin')}\n              canEdit={canManageAnnouncements}\n              language={language}\n            />\n          ))\n        )}\n      </div>\n\n      {/* Add Announcement Modal */}\n      {showAddModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-100 flex items-center justify-between\">\n              <h2 className=\"text-xl font-bold\">{t('announcements.add')}</h2>\n              <button\n                onClick={() => setShowAddModal(false)}\n                className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n            <div className=\"p-6 space-y-4\">\n              {/* Type Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('announcements.type')}\n                </label>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setNewAnnouncement({ ...newAnnouncement, type: 'residents' })}\n                    className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-medium transition-colors ${\n                      newAnnouncement.type === 'residents'\n                        ? 'bg-green-100 text-green-700 border-2 border-green-400'\n                        : 'bg-gray-100 text-gray-600 border-2 border-transparent'\n                    }`}\n                  >\n                    <Users className=\"w-5 h-5\" />\n                    {t('announcements.forResidents')}\n                  </button>\n                  <button\n                    onClick={() => setNewAnnouncement({ ...newAnnouncement, type: 'employees' })}\n                    className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-medium transition-colors ${\n                      newAnnouncement.type === 'employees'\n                        ? 'bg-purple-100 text-purple-700 border-2 border-purple-400'\n                        : 'bg-gray-100 text-gray-600 border-2 border-transparent'\n                    }`}\n                  >\n                    <Briefcase className=\"w-5 h-5\" />\n                    {t('announcements.forStaff')}\n                  </button>\n                </div>\n              </div>\n\n              {/* Targeting (only for residents) */}\n              {newAnnouncement.type === 'residents' && (\n                <div className=\"border-2 border-dashed border-gray-200 rounded-xl p-4 space-y-3\">\n                  <div className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\n                    <Target className=\"w-4 h-4\" />\n                    {language === 'ru' ? 'Таргетирование' : 'Maqsadli auditoriya'}\n                  </div>\n\n                  {/* Target Type Selection */}\n                  <div className=\"grid grid-cols-4 gap-2\">\n                    {[\n                      { type: 'all' as AnnouncementTargetType, label: language === 'ru' ? 'Все' : 'Hammasi', icon: Users },\n                      { type: 'branch' as AnnouncementTargetType, label: language === 'ru' ? 'Филиал' : 'Filial', icon: Building2 },\n                      { type: 'building' as AnnouncementTargetType, label: language === 'ru' ? 'ЖК' : 'TJM', icon: Building2 },\n                      { type: 'custom' as AnnouncementTargetType, label: language === 'ru' ? 'Список' : 'Ro\\'yxat', icon: FileSpreadsheet },\n                    ].map(({ type, label, icon: Icon }) => (\n                      <button\n                        key={type}\n                        onClick={() => {\n                          setTargetType(type);\n                          if (type !== 'branch') setSelectedBranch('');\n                          if (type !== 'building') setSelectedBuilding('');\n                          if (type !== 'custom') {\n                            setCustomLogins([]);\n                            setUploadedFileName('');\n                          }\n                        }}\n                        className={`flex flex-col items-center gap-1 py-2 px-2 rounded-xl text-xs font-medium transition-colors ${\n                          targetType === type\n                            ? 'bg-primary-100 text-primary-700 border-2 border-primary-400'\n                            : 'bg-gray-50 text-gray-600 border-2 border-transparent hover:bg-gray-100'\n                        }`}\n                      >\n                        <Icon className=\"w-4 h-4\" />\n                        {label}\n                      </button>\n                    ))}\n                  </div>\n\n                  {/* Branch Selection */}\n                  {targetType === 'branch' && (\n                    <select\n                      value={selectedBranch}\n                      onChange={(e) => setSelectedBranch(e.target.value)}\n                      className=\"glass-input\"\n                    >\n                      <option value=\"\">{language === 'ru' ? 'Выберите филиал...' : 'Filialni tanlang...'}</option>\n                      {branches.map(branch => (\n                        <option key={branch.id} value={branch.id}>\n                          {branch.name} ({branch.buildingCount} {language === 'ru' ? 'домов' : 'uy'})\n                        </option>\n                      ))}\n                    </select>\n                  )}\n\n                  {/* Building Selection */}\n                  {targetType === 'building' && (\n                    <select\n                      value={selectedBuilding}\n                      onChange={(e) => setSelectedBuilding(e.target.value)}\n                      className=\"glass-input\"\n                    >\n                      <option value=\"\">{language === 'ru' ? 'Выберите ЖК...' : 'TJM tanlang...'}</option>\n                      {buildings.map(building => (\n                        <option key={building.id} value={building.id}>\n                          {building.name} - {building.address}\n                        </option>\n                      ))}\n                    </select>\n                  )}\n\n                  {/* Custom Upload */}\n                  {targetType === 'custom' && (\n                    <div className=\"space-y-2\">\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\".xlsx,.xls,.csv\"\n                        onChange={handleFileUpload}\n                        className=\"hidden\"\n                      />\n                      <button\n                        onClick={() => fileInputRef.current?.click()}\n                        className=\"w-full flex items-center justify-center gap-2 py-3 border-2 border-dashed border-gray-300 rounded-xl hover:border-primary-400 hover:bg-primary-50 transition-colors\"\n                      >\n                        <Upload className=\"w-5 h-5 text-gray-500\" />\n                        <span className=\"text-sm text-gray-600\">\n                          {uploadedFileName || (language === 'ru' ? 'Загрузить Excel файл' : 'Excel fayl yuklang')}\n                        </span>\n                      </button>\n                      {customLogins.length > 0 && (\n                        <div className=\"text-sm text-green-600 flex items-center gap-2\">\n                          <FileSpreadsheet className=\"w-4 h-4\" />\n                          {language === 'ru'\n                            ? `Загружено ${customLogins.length} лицевых счетов`\n                            : `${customLogins.length} ta shaxsiy hisob yuklandi`}\n                        </div>\n                      )}\n                      <p className=\"text-xs text-gray-400\">\n                        {language === 'ru'\n                          ? 'Файл должен содержать лицевые счета (логины) в первой колонке'\n                          : 'Fayl birinchi ustunda shaxsiy hisoblarni (loginlarni) o\\'z ichiga olishi kerak'}\n                      </p>\n                    </div>\n                  )}\n\n                  {/* Target Summary */}\n                  {getTargetDescription() && (\n                    <div className=\"flex items-center gap-2 p-2 bg-green-50 rounded-lg text-sm text-green-700\">\n                      <Target className=\"w-4 h-4\" />\n                      {getTargetDescription()}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Priority */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('announcements.priority')}\n                </label>\n                <div className=\"flex gap-2\">\n                  {(['normal', 'important', 'urgent'] as AnnouncementPriority[]).map((priority) => (\n                    <button\n                      key={priority}\n                      onClick={() => setNewAnnouncement({ ...newAnnouncement, priority })}\n                      className={`flex-1 py-2 px-3 rounded-xl font-medium text-sm transition-colors ${\n                        newAnnouncement.priority === priority\n                          ? getPriorityBadge(priority) + ' border-2'\n                          : 'bg-gray-100 text-gray-600 border-2 border-transparent'\n                      }`}\n                    >\n                      {t(`announcements.priority${priority.charAt(0).toUpperCase() + priority.slice(1)}`)}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Title */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('announcements.titleLabel')}\n                </label>\n                <input\n                  type=\"text\"\n                  value={newAnnouncement.title}\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, title: e.target.value })}\n                  className=\"glass-input\"\n                  placeholder={language === 'ru' ? 'Введите заголовок...' : 'Sarlavhani kiriting...'}\n                />\n              </div>\n\n              {/* Content */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('announcements.content')}\n                </label>\n                <textarea\n                  value={newAnnouncement.content}\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, content: e.target.value })}\n                  className=\"glass-input min-h-[120px] resize-none\"\n                  placeholder={language === 'ru' ? 'Введите содержание объявления...' : 'E\\'lon mazmunini kiriting...'}\n                />\n              </div>\n\n              {/* Expires At */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('announcements.expiresAt')}\n                </label>\n                <input\n                  type=\"datetime-local\"\n                  value={newAnnouncement.expiresAt}\n                  onChange={(e) => setNewAnnouncement({ ...newAnnouncement, expiresAt: e.target.value })}\n                  className=\"glass-input\"\n                />\n              </div>\n\n              {/* File Attachments */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  <Paperclip className=\"w-4 h-4 inline mr-1\" />\n                  {language === 'ru' ? 'Вложения' : 'Ilovalar'}\n                </label>\n                <input\n                  ref={attachmentInputRef}\n                  type=\"file\"\n                  multiple\n                  accept=\"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt\"\n                  onChange={handleAttachmentUpload}\n                  className=\"hidden\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => attachmentInputRef.current?.click()}\n                  disabled={isUploadingAttachment}\n                  className=\"w-full flex items-center justify-center gap-2 py-3 border-2 border-dashed border-gray-300 rounded-xl hover:border-blue-400 hover:bg-blue-50 transition-colors disabled:opacity-50\"\n                >\n                  {isUploadingAttachment ? (\n                    <span className=\"text-sm text-gray-500\">{language === 'ru' ? 'Загрузка...' : 'Yuklanmoqda...'}</span>\n                  ) : (\n                    <>\n                      <Upload className=\"w-5 h-5 text-gray-500\" />\n                      <span className=\"text-sm text-gray-600\">\n                        {language === 'ru' ? 'Добавить файлы (до 5 МБ)' : 'Fayl qo\\'shish (5 MB gacha)'}\n                      </span>\n                    </>\n                  )}\n                </button>\n\n                {/* Attachments List */}\n                {attachments.length > 0 && (\n                  <div className=\"mt-3 space-y-2\">\n                    {attachments.map((attachment, index) => (\n                      <div key={index} className=\"flex items-center gap-2 p-2 bg-gray-50 rounded-lg\">\n                        {getFileIcon(attachment.type)}\n                        <span className=\"flex-1 text-sm text-gray-700 truncate\">{attachment.name}</span>\n                        <span className=\"text-xs text-gray-400\">{formatFileSize(attachment.size)}</span>\n                        <button\n                          type=\"button\"\n                          onClick={() => removeAttachment(index)}\n                          className=\"p-1 text-red-500 hover:bg-red-50 rounded\"\n                        >\n                          <X className=\"w-4 h-4\" />\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  onClick={() => setShowAddModal(false)}\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\n                >\n                  {t('form.cancel')}\n                </button>\n                <button\n                  onClick={handleAddAnnouncement}\n                  disabled={!newAnnouncement.title.trim() || !newAnnouncement.content.trim()}\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-orange-400 text-gray-900 hover:bg-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {t('form.add')}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Announcement Modal */}\n      {showEditModal && editingAnnouncement && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-100 flex items-center justify-between\">\n              <h2 className=\"text-xl font-bold\">{language === 'ru' ? 'Редактировать объявление' : 'E\\'lonni tahrirlash'}</h2>\n              <button\n                onClick={() => { setShowEditModal(false); setEditingAnnouncement(null); }}\n                className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            <div className=\"p-6 space-y-4\">\n              {/* Title */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  {t('announcements.titleLabel')}\n                </label>\n                <input\n                  type=\"text\"\n                  value={editingAnnouncement.title}\n                  onChange={(e) => setEditingAnnouncement({ ...editingAnnouncement, title: e.target.value })}\n                  className=\"glass-input\"\n                  placeholder={t('announcements.titlePlaceholder')}\n                />\n              </div>\n\n              {/* Content */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  {t('announcements.contentLabel')}\n                </label>\n                <textarea\n                  value={editingAnnouncement.content}\n                  onChange={(e) => setEditingAnnouncement({ ...editingAnnouncement, content: e.target.value })}\n                  className=\"glass-input min-h-32\"\n                  placeholder={t('announcements.contentPlaceholder')}\n                  rows={4}\n                />\n              </div>\n\n              {/* Priority */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('announcements.priority')}\n                </label>\n                <div className=\"flex gap-2\">\n                  {(['normal', 'important', 'urgent'] as AnnouncementPriority[]).map((p) => (\n                    <button\n                      key={p}\n                      onClick={() => setEditingAnnouncement({ ...editingAnnouncement, priority: p })}\n                      className={`flex-1 py-2 px-3 rounded-xl text-sm font-medium transition-colors ${\n                        editingAnnouncement.priority === p\n                          ? p === 'urgent' ? 'bg-red-100 text-red-700 ring-2 ring-red-500'\n                            : p === 'important' ? 'bg-amber-100 text-amber-700 ring-2 ring-amber-500'\n                            : 'bg-blue-100 text-blue-700 ring-2 ring-blue-500'\n                          : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                      }`}\n                    >\n                      {t(`announcements.priority${p.charAt(0).toUpperCase() + p.slice(1)}`)}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  onClick={() => { setShowEditModal(false); setEditingAnnouncement(null); }}\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\n                >\n                  {t('form.cancel')}\n                </button>\n                <button\n                  onClick={async () => {\n                    if (editingAnnouncement) {\n                      await updateAnnouncement(editingAnnouncement.id, {\n                        title: editingAnnouncement.title,\n                        content: editingAnnouncement.content,\n                        priority: editingAnnouncement.priority,\n                      });\n                      setShowEditModal(false);\n                      setEditingAnnouncement(null);\n                    }\n                  }}\n                  disabled={!editingAnnouncement.title.trim() || !editingAnnouncement.content.trim()}\n                  className=\"flex-1 py-3 rounded-xl font-medium bg-orange-400 text-gray-900 hover:bg-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {language === 'ru' ? 'Сохранить' : 'Saqlash'}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Announcement Card Component with clickable view details\nfunction AnnouncementCard({\n  announcement,\n  onDelete,\n  onEdit,\n  formatDate,\n  getPriorityIcon,\n  getPriorityBadge,\n  t,\n  canDelete,\n  canEdit,\n  language,\n}: {\n  announcement: Announcement;\n  onDelete: () => void;\n  onEdit: () => void;\n  formatDate: (date: string) => string;\n  getPriorityIcon: (priority: AnnouncementPriority) => React.ReactNode;\n  getPriorityBadge: (priority: AnnouncementPriority) => string;\n  t: (key: string) => string;\n  canDelete: boolean;\n  canEdit?: boolean;\n  language: string;\n}) {\n  const [showViewers, setShowViewers] = useState(false);\n  const [viewers, setViewers] = useState<any[]>([]);\n  const [isLoadingViewers, setIsLoadingViewers] = useState(false);\n  const [viewStats, setViewStats] = useState<{ count: number; targetAudienceSize: number; viewPercentage: number } | null>(null);\n\n  const viewCount = announcement.viewCount ?? announcement.viewedBy.length;\n\n  const handleViewClick = async (e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    setShowViewers(true);\n    setIsLoadingViewers(true);\n\n    try {\n      const { announcementsApi } = await import('../services/api');\n      const result = await announcementsApi.getViews(announcement.id);\n      setViewers(result.viewers || []);\n      setViewStats({\n        count: result.count,\n        targetAudienceSize: result.targetAudienceSize,\n        viewPercentage: result.viewPercentage\n      });\n    } catch (error) {\n      console.error('Failed to load viewers:', error);\n    } finally {\n      setIsLoadingViewers(false);\n    }\n  };\n\n  return (\n    <>\n      <div className=\"glass-card p-5 hover:shadow-lg transition-shadow\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            {/* Header */}\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n              <span className={`flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-medium border ${getPriorityBadge(announcement.priority)}`}>\n                {getPriorityIcon(announcement.priority)}\n                {t(`announcements.priority${announcement.priority.charAt(0).toUpperCase() + announcement.priority.slice(1)}`)}\n              </span>\n              <span className={`px-2 py-1 rounded-lg text-xs font-medium ${\n                announcement.type === 'residents'\n                  ? 'bg-green-100 text-green-700'\n                  : announcement.type === 'employees'\n                  ? 'bg-purple-100 text-purple-700'\n                  : 'bg-blue-100 text-blue-700'\n              }`}>\n                {announcement.type === 'residents'\n                  ? t('announcements.forResidents')\n                  : announcement.type === 'employees'\n                  ? t('announcements.forStaff')\n                  : (language === 'ru' ? 'Для всех' : 'Hammasi uchun')}\n              </span>\n              {/* Targeting info */}\n              {announcement.target && announcement.target.type !== 'all' && (\n                <span className=\"px-2 py-1 rounded-lg text-xs font-medium bg-gray-100 text-gray-600\">\n                  <Target className=\"w-3 h-3 inline mr-1\" />\n                  {announcement.target.type === 'building' && (language === 'ru' ? 'ЖК' : 'TJM')}\n                  {announcement.target.type === 'entrance' && (language === 'ru' ? 'Подъезд' : 'Kirish')}\n                  {announcement.target.type === 'floor' && (language === 'ru' ? 'Этаж' : 'Qavat')}\n                  {announcement.target.type === 'custom' && (language === 'ru' ? 'Список' : 'Ro\\'yxat')}\n                </span>\n              )}\n            </div>\n\n            {/* Title */}\n            <h3 className=\"font-semibold text-lg text-gray-900 mb-2\">{announcement.title}</h3>\n\n            {/* Content */}\n            <p className=\"text-gray-600 whitespace-pre-wrap\">{announcement.content}</p>\n\n            {/* Attachments */}\n            {announcement.attachments && announcement.attachments.length > 0 && (\n              <div className=\"mt-3 flex flex-wrap gap-2\">\n                {announcement.attachments.map((attachment, index) => (\n                  <a\n                    key={index}\n                    href={attachment.url}\n                    download={attachment.name}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"flex items-center gap-2 px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm text-gray-700 transition-colors\"\n                    onClick={(e) => e.stopPropagation()}\n                  >\n                    {attachment.type.startsWith('image/') ? (\n                      <Image className=\"w-4 h-4 text-blue-500\" />\n                    ) : attachment.type.includes('pdf') ? (\n                      <FileText className=\"w-4 h-4 text-red-500\" />\n                    ) : (\n                      <File className=\"w-4 h-4 text-gray-500\" />\n                    )}\n                    <span className=\"truncate max-w-[150px]\">{attachment.name}</span>\n                    <Download className=\"w-4 h-4 text-gray-400\" />\n                  </a>\n                ))}\n              </div>\n            )}\n\n            {/* Meta */}\n            <div className=\"flex items-center gap-4 mt-4 text-sm text-gray-500 flex-wrap\">\n              <span className=\"flex items-center gap-1\">\n                <Clock className=\"w-4 h-4\" />\n                {formatDate(announcement.createdAt)}\n              </span>\n              {announcement.authorName && (\n                <span>\n                  {t('announcements.author')}: {announcement.authorName}\n                </span>\n              )}\n              {/* Clickable view count */}\n              <button\n                onClick={handleViewClick}\n                className={`flex items-center gap-1 ${viewCount > 0 ? 'text-blue-600 hover:text-blue-800 cursor-pointer hover:underline' : 'text-gray-400 cursor-default'}`}\n                disabled={viewCount === 0}\n              >\n                <Eye className=\"w-4 h-4\" />\n                {viewCount} {t('announcements.views')}\n              </button>\n            </div>\n          </div>\n\n          {/* Actions - only show for users with edit/delete permissions */}\n          {(canEdit || canDelete) && (\n            <div className=\"flex flex-col gap-1\">\n              {canEdit && (\n                <button\n                  onClick={(e) => { e.stopPropagation(); onEdit(); }}\n                  className=\"p-2 text-blue-500 hover:bg-blue-50 rounded-xl transition-colors\"\n                  title={language === 'ru' ? 'Редактировать' : 'Tahrirlash'}\n                >\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\n                  </svg>\n                </button>\n              )}\n              {canDelete && (\n                <button\n                  onClick={(e) => { e.stopPropagation(); onDelete(); }}\n                  className=\"p-2 text-red-500 hover:bg-red-50 rounded-xl transition-colors\"\n                  title={language === 'ru' ? 'Удалить' : 'O\\'chirish'}\n                >\n                  <Trash2 className=\"w-5 h-5\" />\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Viewers Modal with Statistics */}\n      {showViewers && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\" onClick={() => setShowViewers(false)}>\n          <div className=\"bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden\" onClick={e => e.stopPropagation()}>\n            <div className=\"p-4 border-b border-gray-100 flex items-center justify-between\">\n              <h3 className=\"font-semibold text-lg flex items-center gap-2\">\n                <Eye className=\"w-5 h-5 text-blue-500\" />\n                {language === 'ru' ? 'Статистика просмотров' : 'Ko\\'rishlar statistikasi'}\n              </h3>\n              <button onClick={() => setShowViewers(false)} className=\"p-2 hover:bg-gray-100 rounded-xl\">\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n            <div className=\"p-4 max-h-[60vh] overflow-y-auto space-y-4\">\n              {isLoadingViewers ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  {language === 'ru' ? 'Загрузка...' : 'Yuklanmoqda...'}\n                </div>\n              ) : (\n                <>\n                  {/* Statistics Summary */}\n                  {viewStats && (\n                    <div className=\"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-sm text-blue-700\">\n                          {language === 'ru' ? 'Просмотрели' : 'Ko\\'rganlar'}\n                        </span>\n                        <span className=\"font-bold text-blue-900\">\n                          {viewStats.count} / {viewStats.targetAudienceSize}\n                        </span>\n                      </div>\n                      {/* Progress bar */}\n                      <div className=\"w-full bg-blue-200 rounded-full h-3\">\n                        <div\n                          className=\"bg-blue-600 h-3 rounded-full transition-all duration-500\"\n                          style={{ width: `${Math.min(viewStats.viewPercentage, 100)}%` }}\n                        />\n                      </div>\n                      <div className=\"text-center\">\n                        <span className=\"text-2xl font-bold text-blue-900\">{viewStats.viewPercentage}%</span>\n                        <span className=\"text-sm text-blue-600 ml-2\">\n                          {language === 'ru' ? 'от целевой аудитории' : 'maqsadli auditoriyadan'}\n                        </span>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Viewers List */}\n                  {viewers.length === 0 ? (\n                    <div className=\"text-center py-4 text-gray-500\">\n                      {language === 'ru' ? 'Пока никто не просмотрел' : 'Hali hech kim ko\\'rmagan'}\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      <h4 className=\"text-sm font-medium text-gray-600\">\n                        {language === 'ru' ? 'Кто просмотрел:' : 'Kim ko\\'rgan:'}\n                      </h4>\n                      {viewers.map((viewer: any) => (\n                        <div key={viewer.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-xl\">\n                          <div>\n                            <p className=\"font-medium text-gray-900\">{viewer.name}</p>\n                            <p className=\"text-sm text-gray-500\">\n                              {viewer.apartment && `${language === 'ru' ? 'Кв.' : 'Xon.'} ${viewer.apartment}`}\n                              {viewer.address && ` • ${viewer.address}`}\n                            </p>\n                          </div>\n                          <span className=\"text-xs text-gray-400\">\n                            {new Date(viewer.viewed_at).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n                              day: '2-digit',\n                              month: 'short',\n                              hour: '2-digit',\n                              minute: '2-digit'\n                            })}\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n"],"file":"AnnouncementsPage-1768381324153-CYYg5Hfu.js"}
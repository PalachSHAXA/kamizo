import{r as l,j as e,K as ee,X as Z,y as w,O as fe,$ as G,aS as je,J as re,a7 as se,V as W,aQ as xe,B as ve,D as ie,F as me,ad as te,h as Ne,U as le,A as ye,az as we,aT as ze,aR as ne,aP as de,ax as oe}from"./react-vendor-1770493083576-vH-hHAng.js";import{b as ke,i as Se,d as Re,M as X,D as ce}from"./index-1770493083576-CfAzBj-W.js";import{g as qe}from"./LazyQRCode-1770493083576-Bd3QoiQL.js";import"./vendor-1770493083576-DMjXTqd7.js";import"./qr-scanner-1770493083576-B_vB3SDT.js";import"./zustand-1770493083576-wNUYBKDB.js";function Ce({isOpen:r,onClose:t,onVerified:V,user:x,language:o,title:z,description:D}){const[U,Y]=l.useState("show"),[A,B]=l.useState(""),[u,E]=l.useState(!1),[i,b]=l.useState(null),[k,M]=l.useState(""),f=l.useRef(null),N=l.useRef(null),q=x.id.toUpperCase();l.useEffect(()=>{if(!r)return;(async()=>{const m=[`ID: ${x.id}`,`Л/С: ${x.login||"-"}`,`ФИО: ${x.name}`,`Адрес: ${x.address||"-"}`,`Кв: ${x.apartment||"-"}`,`Тел: ${x.phone||"-"}`,`Договор: ${x.contractNumber||"-"}`].join(`
`),y=await qe(m,{width:200,margin:2,color:{dark:"#1f2937",light:"#ffffff"}});B(y)})()},[r,x]),l.useEffect(()=>()=>{N.current&&N.current.getTracks().forEach(p=>p.stop())},[]);const $=()=>{N.current&&(N.current.getTracks().forEach(p=>p.stop()),N.current=null),E(!1)},T=()=>{Y("show"),$()},S=()=>{k.trim().toUpperCase()===q?(b("success"),setTimeout(()=>{V(),t()},1500)):(b("error"),setTimeout(()=>b(null),2e3))},C=()=>{b("success"),setTimeout(()=>{V(),t()},1e3)};return r?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:z||(o==="ru"?"Электронная подпись":"Elektron imzo")}),e.jsx("p",{className:"text-xs text-gray-500",children:o==="ru"?"Подтвердите вашу личность":"Shaxsingizni tasdiqlang"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[D&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:D}),i==="success"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce",children:e.jsx(w,{className:"w-10 h-10 text-green-500"})}),e.jsx("h4",{className:"text-lg font-bold text-green-700",children:o==="ru"?"Подпись подтверждена!":"Imzo tasdiqlandi!"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:o==="ru"?"Ваш голос будет записан":"Ovozingiz qayd etiladi"})]}),i==="error"&&e.jsxs("div",{className:"text-center py-4 mb-4 bg-red-50 rounded-xl",children:[e.jsx(fe,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-red-600",children:o==="ru"?"Неверный ключ подписи":"Noto'g'ri imzo kaliti"})]}),!i&&e.jsx(e.Fragment,{children:U==="show"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:o==="ru"?"Ваш уникальный ключ электронной подписи:":"Sizning noyob elektron imzo kalitingiz:"}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 mb-3",children:A?e.jsx("img",{src:A,alt:"QR Signature",className:"w-32 h-32 mx-auto"}):e.jsx("div",{className:"w-32 h-32 mx-auto bg-gray-100 rounded animate-pulse flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6 animate-spin text-gray-400"})})}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:x.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:x.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o==="ru"?"Л/С:":"L/H:"," ",x.login||"-"]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-100",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:o==="ru"?"ID электронной подписи:":"Elektron imzo ID:"}),e.jsx("p",{className:"font-mono text-lg font-bold text-blue-600 tracking-wider select-all",children:q})]})]}),e.jsxs("button",{onClick:C,className:"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform",style:{background:"linear-gradient(135deg, #3b82f6, #1d4ed8)"},children:[e.jsx(w,{className:"w-5 h-5"}),o==="ru"?"Подтвердить подпись":"Imzoni tasdiqlash"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-3 text-center",children:o==="ru"?'Нажимая "Подтвердить", вы подписываете голос электронным ключом':'"Tasdiqlash" tugmasini bosish orqali ovozingizni elektron kalit bilan imzolaysiz'})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-black rounded-2xl overflow-hidden mb-4 aspect-square relative",children:[e.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsx(je,{className:"w-12 h-12 text-gray-500"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-48 h-48 border-2 border-white/50 rounded-2xl"})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:o==="ru"?"Наведите камеру на ваш QR-код подписи":"Kamerani QR-kod imzongizga yo'naltiring"}),e.jsxs("div",{className:"border-t border-gray-100 pt-4 mt-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:o==="ru"?"Или введите код вручную:":"Yoki kodni qo'lda kiriting:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:k,onChange:p=>M(p.target.value.toUpperCase()),placeholder:"SIG-XXXXX-XXXX",className:"flex-1 px-4 py-3 rounded-xl border border-gray-200 text-center font-mono uppercase"}),e.jsx("button",{onClick:S,disabled:!k.trim(),className:"px-4 py-3 bg-blue-500 text-white rounded-xl font-medium disabled:opacity-50",children:"OK"})]})]}),e.jsx("button",{onClick:T,className:"mt-4 text-sm text-blue-600 hover:text-blue-800",children:o==="ru"?"← Показать мой QR-код":"← QR-kodimni ko'rsatish"})]})})})]}),!i&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("button",{onClick:t,className:"w-full py-2.5 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors text-sm",children:o==="ru"?"Отмена":"Bekor qilish"})})]})}):null}function Ue(){const{user:r}=ke(),{meetings:t,fetchMeetings:V,voteForSchedule:x,getScheduleVoteByUser:o,voteOnAgendaItem:z,getVoteByUser:D,getUserVotesForMeeting:U,calculateAgendaItemResult:Y,calculateMeetingQuorum:A,fetchMyReconsiderationRequests:B,markReconsiderationRequestViewed:u,ignoreReconsiderationRequest:E}=Se(),{language:i}=Re(),[b,k]=l.useState(null),[M,f]=l.useState(!1),[N,q]=l.useState([]),[$,T]=l.useState(!1),[S,C]=l.useState(null),p=l.useRef(new Set),m=b&&t.find(a=>a.id===b)||null;l.useEffect(()=>{V()},[]);const y=l.useCallback(async(a=!1)=>{const c=await B();if(!a&&c.length>0){const j=c.filter(h=>(h.status==="pending"||h.status==="viewed")&&!p.current.has(h.id));if(j.length>0){C(j[0]);try{const h=new Audio("/notification.mp3");h.volume=.5,h.play().catch(()=>{})}catch{}}}c.forEach(j=>p.current.add(j.id)),q(c)},[B]);l.useEffect(()=>{y(!0)},[y]),l.useEffect(()=>{const a=setInterval(()=>{y(!1)},5e3);return()=>clearInterval(a)},[y]);const J=async a=>{await E(a),await y(!1),S?.id===a&&C(null)},P=async a=>{await u(a.id),T(!0),k(a.meetingId),f(!0),S?.id===a.id&&C(null),await V(),await y(!1)};l.useEffect(()=>{b&&r?.id&&U(b,r.id)},[b,r?.id,U]);const _=l.useMemo(()=>t.filter(a=>["schedule_poll_open","voting_open","results_published","protocol_approved"].includes(a.status)&&(!r?.buildingId||a.buildingId===r.buildingId)),[t,r?.buildingId]),I=l.useMemo(()=>_.filter(a=>["schedule_poll_open","voting_open"].includes(a.status)),[_]),O=a=>new Date(a).toLocaleDateString(i==="ru"?"ru-RU":"uz-UZ",{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}),H=a=>{switch(a){case"schedule_poll_open":return{bg:"bg-blue-50 border-blue-300",badge:"bg-blue-100 text-blue-700"};case"voting_open":return{bg:"bg-green-50 border-green-300",badge:"bg-green-100 text-green-700"};case"results_published":return{bg:"bg-purple-50 border-purple-300",badge:"bg-purple-100 text-purple-700"};case"protocol_approved":return{bg:"bg-emerald-50 border-emerald-300",badge:"bg-emerald-100 text-emerald-700"};default:return{bg:"bg-gray-50 border-gray-300",badge:"bg-gray-100 text-gray-700"}}},K=a=>{k(a.id),f(!0)};return e.jsxs("div",{className:"space-y-4 md:space-y-6 pb-20 md:pb-0",children:[S&&e.jsx("div",{className:"fixed top-4 right-4 left-4 md:left-auto md:w-96 z-50 animate-in slide-in-from-top-2 duration-300",children:e.jsx("div",{className:"glass-card p-4 border-2 border-orange-400 bg-gradient-to-r from-orange-50 to-yellow-50 shadow-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-full animate-pulse",children:e.jsx(re,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-orange-800 mb-1",children:i==="ru"?"Новый запрос!":"Yangi so'rov!"}),e.jsx("div",{className:"text-sm text-orange-700 mb-2",children:i==="ru"?"УК просит вас пересмотреть свой голос":"BK sizdan ovozingizni qayta ko'rib chiqishni so'raydi"}),e.jsx("div",{className:"text-xs text-gray-600 mb-3 truncate",children:S.agendaItemTitle}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>P(S),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-orange-500 text-white rounded-xl text-sm font-medium hover:bg-orange-600 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),i==="ru"?"Открыть":"Ochish"]}),e.jsx("button",{onClick:()=>C(null),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold flex items-center gap-3",children:[e.jsx(W,{className:"w-7 h-7 text-primary-500"}),i==="ru"?"Собрания":"Yig'ilishlar"]}),I.length>0&&e.jsxs("span",{className:"px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-medium",children:[I.length," ",i==="ru"?"активных":"faol"]})]}),N.length>0&&e.jsx("div",{className:"space-y-3",children:N.map(a=>e.jsx("div",{className:"glass-card p-4 border-2 border-orange-300 bg-orange-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-xl",children:e.jsx(re,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-orange-800 mb-1",children:i==="ru"?"Просьба пересмотреть голос":"Ovozni qayta ko'rib chiqish so'rovi"}),e.jsxs("div",{className:"text-sm text-orange-700 mb-2",children:[i==="ru"?"Вопрос:":"Savol:"," ",a.agendaItemTitle]}),a.messageToResident&&e.jsxs("div",{className:"p-2 bg-white rounded-lg text-sm text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-3 h-3 inline mr-1 text-orange-500"}),a.messageToResident]}),e.jsx("div",{className:"text-xs text-orange-600 mb-3",children:i==="ru"?"Это только просьба. Вы сами решаете, менять голос или нет.":"Bu faqat iltimos. Ovozni o'zgartirish yoki o'zgartirmaslikni o'zingiz hal qilasiz."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:c=>{c.stopPropagation(),P(a)},className:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-xl text-sm font-medium hover:bg-orange-600 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),i==="ru"?"Изменить голос":"Ovozni o'zgartirish"]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),J(a.id)},className:"flex items-center gap-2 px-4 py-2 border border-orange-300 text-orange-700 rounded-xl text-sm font-medium hover:bg-orange-100 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),i==="ru"?"Оставить как есть":"Shundayligicha qoldirish"]})]})]})]})},a.id))}),_.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(W,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:i==="ru"?"Нет активных собраний":"Faol yig'ilishlar yo'q"})]}):e.jsx("div",{className:"space-y-4",children:_.map(a=>{const c=H(a.status),j=X[a.status],h=A(a.id),F=r?.id&&a.participatedVoters?.includes(r.id);return e.jsxs("div",{className:`glass-card p-4 border-2 ${c.bg} cursor-pointer hover:shadow-md transition-all`,onClick:()=>K(a),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs font-medium ${c.badge}`,children:i==="ru"?j?.label:j?.labelUz}),e.jsxs("span",{className:"text-xs text-gray-500",children:["#",a.number]}),F&&a.status==="voting_open"&&e.jsxs("span",{className:"px-2 py-0.5 rounded-lg text-xs font-medium bg-green-100 text-green-700 flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),i==="ru"?"Вы проголосовали":"Ovoz berdingiz"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:a.buildingAddress})]})]}),e.jsx(ie,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.agendaItems.length," ",i==="ru"?"вопросов":"savol"]})]}),a.status==="schedule_poll_open"&&e.jsxs("div",{className:"bg-white/60 rounded-lg p-3 mb-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:i==="ru"?"Голосование за дату":"Sana uchun ovoz berish"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs text-blue-600",children:i==="ru"?"Выберите удобную дату":"Qulay sanani tanlang"})})]}),a.confirmedDateTime&&a.status!=="schedule_poll_open"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-white/60 rounded-lg p-3 mb-3",children:[e.jsx(te,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:O(a.confirmedDateTime)})]}),F&&a.status==="voting_open"&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:i==="ru"?"Спасибо за участие!":"Ishtirok uchun rahmat!"}),e.jsx("p",{className:"text-xs text-green-600",children:i==="ru"?"Ваш голос учтён":"Ovozingiz hisobga olindi"})]})]})}),a.status==="voting_open"&&!F&&e.jsxs("div",{className:"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform touch-manipulation",style:{background:"linear-gradient(135deg, #10b981, #059669)"},children:[e.jsx(W,{className:"w-5 h-5"}),i==="ru"?"Проголосовать":"Ovoz berish"]}),a.status==="voting_open"&&F&&e.jsxs("div",{className:"w-full py-3 px-4 rounded-xl font-medium bg-gray-100 text-gray-700 flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),i==="ru"?"Посмотреть детали":"Tafsilotlarni ko'rish"]}),["voting_open","results_published","protocol_approved"].includes(a.status)&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-3 pt-3 border-t border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[h.participated,"/",h.total," (",h.percent.toFixed(0),"%)"]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${h.quorumReached?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:h.quorumReached?i==="ru"?"Кворум есть":"Kvorum bor":i==="ru"?"Нет кворума":"Kvorum yo'q"})]})]},a.id)})}),M&&m&&r&&e.jsx(_e,{meeting:m,language:i,user:r,allowRevote:$,onClose:()=>{f(!1),k(null),T(!1)},getVote:a=>{const c=D(m.id,a,r.id);if(c&&c.choice!=="schedule")return{choice:c.choice}},onVote:(a,c,j,h)=>z(m.id,a,r.id,r.name,c,{method:"e_signature",otpVerified:j},h),getScheduleVote:()=>o(m.id),onScheduleVote:a=>x(m.id,a),calculateResult:a=>Y(m.id,a),calculateQuorum:()=>A(m.id)}),M&&!m&&b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm w-full mx-4 text-center",children:[e.jsx(G,{className:"w-8 h-8 animate-spin mx-auto mb-3 text-orange-500"}),e.jsx("p",{className:"text-gray-600",children:i==="ru"?"Загрузка собрания...":"Yig'ilish yuklanmoqda..."}),e.jsx("button",{onClick:()=>{f(!1),k(null)},className:"mt-4 px-4 py-2 text-gray-600 hover:text-gray-800",children:i==="ru"?"Отмена":"Bekor qilish"})]})})]})}function _e({meeting:r,language:t,user:V,allowRevote:x=!1,onClose:o,getVote:z,onVote:D,getScheduleVote:U,onScheduleVote:Y,calculateResult:A,calculateQuorum:B}){const[u,E]=l.useState({}),[i,b]=l.useState({}),[k,M]=l.useState(!1),[f,N]=l.useState(!1),[q,$]=l.useState(null),[T,S]=l.useState(!1),[C,p]=l.useState(!1),[m,y]=l.useState(null),[J,P]=l.useState(!1);l.useEffect(()=>{U().then(s=>{$(s),y(s)})},[U]),l.useEffect(()=>{if(x){const s={};r.agendaItems.forEach(d=>{const n=z(d.id);n&&n.choice&&(s[d.id]=n.choice)}),Object.keys(s).length>0&&E(s)}},[x,r.agendaItems,z]);const _=x?!1:r.agendaItems.every(s=>z(s.id)!==void 0),I=B(),O=r.status==="voting_open",H=r.status==="schedule_poll_open",K=["voting_closed","results_published","protocol_generated","protocol_approved"].includes(r.status),a=(s,d)=>{E(n=>({...n,[s]:d}))},c=r.agendaItems.every(s=>u[s.id]||z(s.id)),j=r.agendaItems.filter(s=>u[s.id]||z(s.id)).length,h=()=>{Object.keys(u).length!==0&&M(!0)},F=async()=>{M(!1),N(!0);try{for(const[s,d]of Object.entries(u)){const n=i[s]?.trim()||void 0;await D(s,d,!0,n)}E({}),b({}),P(!0)}catch(s){const d=s?.message||"Ошибка при голосовании. Проверьте что указана площадь квартиры.";alert(d),P(!1)}finally{N(!1)}},ue=async s=>{if(!m&&s!==q){S(!0),p(!1);try{const d=await Y(s);if(d&&!d.success){const n=d.error||"Ошибка при голосовании. Проверьте что указана площадь квартиры.";alert(n),$(""),n.includes("не найдено")&&(o(),window.location.reload())}else $(s),p(!0),setTimeout(()=>{y(s),p(!1)},2e3)}catch(d){const n=d?.message||"Ошибка при голосовании. Проверьте что указана площадь квартиры.";alert(n),$(""),n.includes("не найдено")&&(o(),window.location.reload())}finally{S(!1)}}},L=r.scheduleOptions.reduce((s,d)=>s+(d.voteCount??d.votes?.length??0),0),ae=Math.max(...r.scheduleOptions.map(s=>s.voteCount??s.votes?.length??0)),he=r.scheduleOptions.filter(s=>(s.voteCount??s.votes?.length??0)===ae&&ae>0),ge=s=>new Date(s).toLocaleDateString(t==="ru"?"ru-RU":"uz-UZ",{weekday:"long",day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),be=s=>new Date(s).toLocaleDateString(t==="ru"?"ru-RU":"uz-UZ",{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center",children:[e.jsxs("div",{className:"max-h-[85vh] md:max-h-[90vh] w-full md:max-w-lg md:mx-4 bg-white rounded-t-2xl md:rounded-2xl flex flex-col overflow-hidden animate-in slide-in-from-bottom-4 md:slide-in-from-bottom-0 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-100 bg-white sticky top-0 z-10",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-base font-bold truncate",children:t==="ru"?`Собрание #${r.number}`:`Yig'ilish #${r.number}`}),e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs font-medium flex-shrink-0 ${X[r.status]?.color==="green"?"bg-green-100 text-green-700":X[r.status]?.color==="blue"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:t==="ru"?X[r.status]?.label:X[r.status]?.labelUz})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:r.buildingAddress})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation ml-2",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[x&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:t==="ru"?"Изменение голоса":"Ovozni o'zgartirish"}),e.jsx("p",{className:"text-xs text-orange-600",children:t==="ru"?"Выберите новый вариант голоса и подтвердите изменение":"Yangi ovoz variantini tanlang va o'zgartirishni tasdiqlang"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-xl p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(le,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:t==="ru"?"Участие:":"Ishtirok:"}),e.jsxs("span",{className:"font-medium",children:[I.participated,"/",I.total]}),e.jsxs("span",{className:"text-gray-400",children:["(",I.percent.toFixed(0),"%)"]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${I.quorumReached?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:I.quorumReached?t==="ru"?"Кворум есть":"Kvorum bor":t==="ru"?"Нет кворума":"Kvorum yo'q"})]}),H&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),t==="ru"?"Голосование за дату":"Sana uchun ovoz berish"]}),L>0&&e.jsxs("span",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:[L," ",t==="ru"?"голосов":"ovoz"]})]}),r.schedulePollEndsAt&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-100 text-sm",children:[e.jsx(ye,{className:"w-4 h-4"}),t==="ru"?"Завершится: ":"Tugaydi: ",new Date(r.schedulePollEndsAt).toLocaleDateString(t==="ru"?"ru-RU":"uz-UZ",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"})]})]}),!m&&!q&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-amber-700 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 flex-shrink-0"}),t==="ru"?"Нажмите на удобную для вас дату, чтобы проголосовать":"Qulay sanani bosing ovoz berish uchun"]})}),m&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-700",children:t==="ru"?"Вы уже проголосовали!":"Siz allaqachon ovoz berdingiz!"}),e.jsx("p",{className:"text-sm text-green-600",children:t==="ru"?"Ваш голос учтён. Ожидайте подтверждения даты администратором.":"Ovozingiz hisobga olindi. Administrator sanani tasdiqlaguncha kuting."})]})]})}),e.jsx("div",{className:"space-y-3",children:r.scheduleOptions.map((s,d)=>{const n=q===s.id,R=he.some(pe=>pe.id===s.id),g=s.voteCount??s.votes?.length??0,v=L>0?g/L*100:0,Q=!!m;return e.jsxs("div",{onClick:()=>!Q&&!T&&ue(s.id),className:`w-full p-4 rounded-xl border-2 text-left transition-all relative overflow-hidden ${n?"border-green-500 bg-green-50 shadow-md":Q?"border-gray-200 bg-gray-50 cursor-default":"border-gray-200 hover:border-blue-300 hover:bg-blue-50/50 bg-white cursor-pointer"} ${T?"opacity-70 pointer-events-none":""}`,children:[L>0&&e.jsx("div",{className:`absolute inset-0 transition-all ${n?"bg-green-100":"bg-blue-50"}`,style:{width:`${v}%`}}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${n?"bg-green-500 text-white":"bg-gray-100 text-gray-600"}`,children:n?e.jsx(w,{className:"w-5 h-5"}):d+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:be(s.dateTime)}),R&&!n&&s.votes.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-600 mt-0.5",children:[e.jsx(ze,{className:"w-3 h-3"}),t==="ru"?"Лидирует":"Yetakchi"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`font-semibold ${n?"text-green-700":"text-gray-700"}`,children:g}),L>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:[v.toFixed(0),"%"]})]}),T&&n&&e.jsx(G,{className:"w-5 h-5 text-green-500 animate-spin"})]})]})]},s.id)})}),C&&!m&&e.jsx("div",{className:"bg-green-100 border border-green-300 rounded-xl p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-800",children:t==="ru"?"Голос принят!":"Ovoz qabul qilindi!"}),e.jsx("p",{className:"text-sm text-green-600",children:t==="ru"?"Ваш выбор зарегистрирован. После завершения опроса будет выбрана дата с максимальным числом голосов.":"Tanlovingiz ro'yxatga olindi. So'rovnoma tugagandan so'ng eng ko'p ovoz olgan sana tanlanadi."})]})]})}),q&&!C&&!m&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-800",children:t==="ru"?"Ваш голос учтён":"Ovozingiz hisobga olindi"}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:t==="ru"?"После завершения опроса будет выбрана дата с максимальным числом голосов.":"So'rovnoma tugagach, eng ko'p ovoz olgan sana tanlanadi."})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),t==="ru"?"Этапы собрания":"Yig'ilish bosqichlari"]}),e.jsx("div",{className:"space-y-3",children:[{status:"schedule_poll_open",label:t==="ru"?"Опрос по дате":"Sana so'rovi",labelUz:"Sana so'rovi"},{status:"schedule_confirmed",label:t==="ru"?"Дата подтверждена":"Sana tasdiqlandi",labelUz:"Sana tasdiqlandi"},{status:"voting_open",label:t==="ru"?"Голосование":"Ovoz berish",labelUz:"Ovoz berish"},{status:"voting_closed",label:t==="ru"?"Подсчёт голосов":"Ovozlar sanash",labelUz:"Ovozlar sanash"},{status:"results_published",label:t==="ru"?"Результаты":"Natijalar",labelUz:"Natijalar"},{status:"protocol_approved",label:t==="ru"?"Протокол":"Bayonnoma",labelUz:"Bayonnoma"}].map((s,d)=>{const n=["schedule_poll_open","schedule_confirmed","voting_open","voting_closed","results_published","protocol_approved"],R=n.indexOf(r.status),v=n.indexOf(s.status)<R,Q=s.status===r.status;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${v?"bg-green-500 text-white":Q?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:v?e.jsx(w,{className:"w-4 h-4"}):d+1}),e.jsx("span",{className:`text-sm ${v?"text-green-700":Q?"text-blue-700 font-medium":"text-gray-400"}`,children:s.label}),Q&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full",children:t==="ru"?"Сейчас":"Hozir"})]},s.status)})})]}),r.confirmedDateTime&&!H&&e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-50 rounded-lg p-3",children:[e.jsx(te,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:ge(r.confirmedDateTime)})]}),O&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-blue-700",children:t==="ru"?"Для подтверждения голоса используется ваш уникальный электронный ключ. Это защищает от подделки голосов.":"Ovozni tasdiqlash uchun sizning noyob elektron kalitingiz ishlatiladi. Bu ovozlarni soxtalashtirish oldini oladi."})]})}),(O||K)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:t==="ru"?"Повестка дня":"Kun tartibi"}),r.agendaItems.map((s,d)=>{const n=z(s.id),R=A(s.id);return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"font-medium text-base",children:[d+1,". ",s.title]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-200 text-gray-600",children:t==="ru"?ce[s.threshold]?.label:ce[s.threshold]?.labelUz})})]}),O&&!_&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-3",children:(()=>{const g=u[s.id]||n?.choice;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>a(s.id,"for"),disabled:f,className:`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${g==="for"?"bg-green-500 text-white ring-2 ring-green-300":"bg-green-50 text-green-700 border border-green-200 hover:bg-green-100 active:bg-green-200"}`,children:[e.jsx(ne,{className:"w-4 h-4"}),t==="ru"?"За":"Ha"]}),e.jsxs("button",{onClick:()=>a(s.id,"against"),disabled:f,className:`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${g==="against"?"bg-red-500 text-white ring-2 ring-red-300":"bg-red-50 text-red-700 border border-red-200 hover:bg-red-100 active:bg-red-200"}`,children:[e.jsx(de,{className:"w-4 h-4"}),t==="ru"?"Против":"Yo'q"]}),e.jsxs("button",{onClick:()=>a(s.id,"abstain"),disabled:f,className:`py-3 px-3 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${g==="abstain"?"bg-gray-500 text-white ring-2 ring-gray-300":"bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100 active:bg-gray-200"}`,children:[e.jsx(oe,{className:"w-4 h-4"}),t==="ru"?"Воздерж.":"Betaraf"]})]})})()}),O&&!_&&u[s.id]&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-1",children:[e.jsx(xe,{className:"w-3 h-3"}),t==="ru"?"Обоснование (будет в протоколе)":"Asoslash (bayonnomada bo'ladi)"]}),e.jsx("textarea",{value:i[s.id]||"",onChange:g=>b(v=>({...v,[s.id]:g.target.value})),placeholder:t==="ru"?"Почему вы так проголосовали? (необязательно)":"Nima uchun shunday ovoz berdingiz? (ixtiyoriy)",className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-200 resize-none",rows:2,maxLength:500}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:t==="ru"?"Будет виден в протоколе собрания":"Yig'ilish bayonnomasida ko'rinadi"}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:[(i[s.id]||"").length,"/500"]})]})]}),(()=>{const g=n?.choice||u[s.id],v=!!n;return g?e.jsxs("div",{className:`text-sm font-medium flex items-center gap-2 mb-2 ${g==="for"?"text-green-600":g==="against"?"text-red-600":"text-gray-600"}`,children:[v?e.jsx(w,{className:"w-4 h-4"}):e.jsx("span",{className:"w-4 h-4 rounded-full border-2 border-current"}),v?t==="ru"?"Ваш голос: ":"Sizning ovozingiz: ":t==="ru"?"Выбрано: ":"Tanlangan: ",g==="for"?t==="ru"?"За":"Ha":g==="against"?t==="ru"?"Против":"Yo'q":t==="ru"?"Воздержался":"Betaraf",!v&&e.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",t==="ru"?"не подтверждено":"tasdiqlanmagan",")"]})]}):null})(),(K||O&&r.votingSettings?.showIntermediateResults)&&e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{children:[R.votesFor," (",R.percentFor.toFixed(0),"%)"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:R.votesAgainst})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:R.votesAbstain})]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${R.thresholdMet?"bg-green-500":"bg-red-500"}`,style:{width:`${R.percentFor}%`}})}),K&&s.isApproved!==void 0&&e.jsx("div",{className:`mt-2 px-3 py-1 rounded-lg text-sm font-medium inline-flex items-center gap-1 ${s.isApproved?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.isApproved?t==="ru"?"Принято":"Qabul qilindi":t==="ru"?"Не принято":"Rad etildi"})]})]},s.id)})]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 bg-white safe-area-bottom space-y-2",children:[O&&!_&&Object.keys(u).length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:t==="ru"?"Отвечено:":"Javob berildi:"})]}),e.jsxs("span",{className:"font-medium",children:[j,"/",r.agendaItems.length,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",Math.round(j/r.agendaItems.length*100),"%)"]})]}),!I.quorumReached&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:t==="ru"?"Нет кворума":"Kvorum yo'q"})]}),e.jsx("button",{onClick:h,disabled:f||Object.keys(u).length===0,className:"w-full py-3 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 active:scale-[0.98] transition-transform touch-manipulation disabled:opacity-50",style:{background:c?"linear-gradient(135deg, #10b981, #059669)":"linear-gradient(135deg, #3b82f6, #1d4ed8)"},children:f?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5 animate-spin"}),t==="ru"?"Отправка...":"Yuborilmoqda..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5"}),c?t==="ru"?"Подписать и отправить все голоса":"Imzolash va barcha ovozlarni yuborish":t==="ru"?`Подтвердить ${Object.keys(u).length} голос(ов)`:`${Object.keys(u).length} ta ovozni tasdiqlash`]})})]}),(J||_)&&O&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:t==="ru"?"Спасибо за участие!":"Ishtirok uchun rahmat!"}),e.jsx("p",{className:"text-xs text-green-600",children:t==="ru"?"Все ваши голоса учтены":"Barcha ovozlaringiz hisobga olindi"})]})]})}),e.jsx("button",{onClick:o,className:"w-full py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors touch-manipulation",children:t==="ru"?"Закрыть":"Yopish"})]})]}),e.jsx(Ce,{isOpen:k,onClose:()=>M(!1),onVerified:F,user:V,language:t,title:t==="ru"?"Подтверждение голосов":"Ovozlarni tasdiqlash",description:t==="ru"?`Подтвердите, что все ${Object.keys(u).length} голос(ов) поданы вами лично. Нажмите "Подтвердить" для подписи электронным ключом.`:`Barcha ${Object.keys(u).length} ta ovoz sizning tomoningizdan berilganligini tasdiqlang. Elektron kalit bilan imzolash uchun "Tasdiqlash" tugmasini bosing.`})]})}export{Ue as ResidentMeetingsPage};
//# sourceMappingURL=ResidentMeetingsPage-1770493083576-BB9zSAsz.js.map

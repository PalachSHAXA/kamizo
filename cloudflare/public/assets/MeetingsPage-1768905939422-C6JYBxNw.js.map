{"version":3,"file":"MeetingsPage-1768905939422-C6JYBxNw.js","sources":["../../src/utils/protocolGenerator.ts","../../src/pages/MeetingsPage.tsx"],"sourcesContent":["import PizZip from 'pizzip';\r\nimport QRCode from 'qrcode';\r\n\r\ninterface VoteResult {\r\n  votesFor: number;\r\n  votesAgainst: number;\r\n  votesAbstain: number;\r\n  percentFor: number;\r\n  percentAgainst: number;\r\n  percentAbstain: number;\r\n}\r\n\r\ninterface AgendaItem {\r\n  id: string;\r\n  item_order: number;\r\n  title: string;\r\n  description?: string;\r\n  votes_for_area: number;\r\n  votes_against_area: number;\r\n  votes_abstain_area: number;\r\n  decision?: 'approved' | 'rejected' | 'no_quorum';\r\n}\r\n\r\ninterface VoteRecord {\r\n  voter_id: string;\r\n  voter_name: string;\r\n  apartment_number: string;\r\n  vote_weight: number;\r\n  voted_at: string;\r\n  choice?: 'for' | 'against' | 'abstain';\r\n  qr_code?: string; // QR code for signature\r\n  comment?: string; // Комментарий/обоснование голоса\r\n}\r\n\r\ninterface Meeting {\r\n  id: string;\r\n  number: number;\r\n  building_id: string;\r\n  buildingAddress?: string;\r\n  building_address?: string;\r\n  description?: string;\r\n  format: 'online' | 'offline' | 'hybrid';\r\n  status: string;\r\n  confirmed_date_time?: string;\r\n  location?: string;\r\n  total_area: number;\r\n  voted_area: number;\r\n  total_eligible_count: number;\r\n  participated_count: number;\r\n  quorum_percent: number;\r\n  participation_percent: number;\r\n  quorum_reached: number;\r\n  voting_opened_at?: string;\r\n  voting_closed_at?: string;\r\n  organizer_name?: string;\r\n}\r\n\r\ninterface ProtocolData {\r\n  meeting: Meeting;\r\n  agendaItems: AgendaItem[];\r\n  voteRecords: VoteRecord[];\r\n  votesByItem: Record<string, VoteRecord[]>;\r\n  protocolHash?: string;\r\n}\r\n\r\n// UK Company details for QR code\r\nconst UK_COMPANY = {\r\n  name: 'OOO KAMIZO',\r\n  address: 'г. Ташкент, Яшнобадский район, ул. Махтумкули, дом 93/3',\r\n  bank: '«Ориент Финанс» ЧАКБ Миробад филиал',\r\n  account: '20208000805307918001',\r\n  inn: '307928888',\r\n  oked: '81100',\r\n  mfo: '01071',\r\n};\r\n\r\n// Cross-browser file download\r\nfunction downloadBlob(blob: Blob, fileName: string): void {\r\n  const url = URL.createObjectURL(blob);\r\n  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\r\n  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n\r\n  if (isIOS || isSafari) {\r\n    const newWindow = window.open(url, '_blank');\r\n    if (!newWindow) {\r\n      window.location.href = url;\r\n    }\r\n    setTimeout(() => URL.revokeObjectURL(url), 10000);\r\n  } else {\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = fileName;\r\n    link.style.display = 'none';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    setTimeout(() => URL.revokeObjectURL(url), 100);\r\n  }\r\n}\r\n\r\nconst MONTHS_RU: Record<number, string> = {\r\n  0: 'января', 1: 'февраля', 2: 'марта', 3: 'апреля', 4: 'мая', 5: 'июня',\r\n  6: 'июля', 7: 'августа', 8: 'сентября', 9: 'октября', 10: 'ноября', 11: 'декабря'\r\n};\r\n\r\nfunction formatDateRu(dateStr: string | undefined): string {\r\n  if (!dateStr) return '___';\r\n  const date = new Date(dateStr);\r\n  return `${date.getDate()} ${MONTHS_RU[date.getMonth()]} ${date.getFullYear()}`;\r\n}\r\n\r\nfunction formatTimeRu(dateStr: string | undefined): string {\r\n  if (!dateStr) return '___';\r\n  const date = new Date(dateStr);\r\n  return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\r\n}\r\n\r\nfunction escapeXml(str: string): string {\r\n  return str\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&apos;');\r\n}\r\n\r\n// Calculate vote result for an agenda item\r\nfunction calculateVoteResult(item: AgendaItem, _totalArea: number): VoteResult {\r\n  const votedArea = item.votes_for_area + item.votes_against_area + item.votes_abstain_area;\r\n  return {\r\n    votesFor: item.votes_for_area,\r\n    votesAgainst: item.votes_against_area,\r\n    votesAbstain: item.votes_abstain_area,\r\n    percentFor: votedArea > 0 ? (item.votes_for_area / votedArea) * 100 : 0,\r\n    percentAgainst: votedArea > 0 ? (item.votes_against_area / votedArea) * 100 : 0,\r\n    percentAbstain: votedArea > 0 ? (item.votes_abstain_area / votedArea) * 100 : 0,\r\n  };\r\n}\r\n\r\n// Convert base64 data URL to binary array\r\nfunction dataUrlToUint8Array(dataUrl: string): Uint8Array {\r\n  const base64 = dataUrl.split(',')[1];\r\n  const binaryString = atob(base64);\r\n  const bytes = new Uint8Array(binaryString.length);\r\n  for (let i = 0; i < binaryString.length; i++) {\r\n    bytes[i] = binaryString.charCodeAt(i);\r\n  }\r\n  return bytes;\r\n}\r\n\r\n// Generate UK company QR code\r\nasync function generateUKQRCode(): Promise<string> {\r\n  const ukData = [\r\n    `Компания: ${UK_COMPANY.name}`,\r\n    `Адрес: ${UK_COMPANY.address}`,\r\n    `Банк: ${UK_COMPANY.bank}`,\r\n    `Р/С: ${UK_COMPANY.account}`,\r\n    `ИНН: ${UK_COMPANY.inn}`,\r\n    `ОКЭД: ${UK_COMPANY.oked}`,\r\n    `МФО: ${UK_COMPANY.mfo}`,\r\n  ].join('\\n');\r\n\r\n  return await QRCode.toDataURL(ukData, {\r\n    width: 150,\r\n    margin: 1,\r\n    color: { dark: '#1f2937', light: '#ffffff' },\r\n  });\r\n}\r\n\r\n// Generate voter signature QR code\r\nasync function generateVoterQRCode(voter: VoteRecord, meetingNumber: number, buildingAddress: string): Promise<string> {\r\n  const voterData = [\r\n    `ЭЛЕКТРОННАЯ ПОДПИСЬ`,\r\n    `Протокол: ${meetingNumber}`,\r\n    `ФИО: ${voter.voter_name}`,\r\n    `Квартира: ${voter.apartment_number || '-'}`,\r\n    `Площадь: ${voter.vote_weight?.toFixed(2) || '-'} кв.м`,\r\n    `Голос: ${voter.choice === 'for' ? 'ЗА' : voter.choice === 'against' ? 'ПРОТИВ' : 'ВОЗДЕРЖАЛСЯ'}`,\r\n    `Дата: ${new Date(voter.voted_at).toLocaleString('ru-RU')}`,\r\n    `Адрес: ${buildingAddress}`,\r\n  ].join('\\n');\r\n\r\n  return await QRCode.toDataURL(voterData, {\r\n    width: 80,\r\n    margin: 1,\r\n    color: { dark: '#1f2937', light: '#ffffff' },\r\n  });\r\n}\r\n\r\n// Generate a table row XML for voting results\r\nfunction generateVotingTableXml(result: VoteResult): string {\r\n  return `\r\n<w:tbl>\r\n  <w:tblPr>\r\n    <w:tblW w:w=\"9000\" w:type=\"dxa\"/>\r\n    <w:tblBorders>\r\n      <w:top w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:left w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:bottom w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:right w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:insideH w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:insideV w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n    </w:tblBorders>\r\n    <w:jc w:val=\"center\"/>\r\n  </w:tblPr>\r\n  <w:tblGrid>\r\n    <w:gridCol w:w=\"3000\"/>\r\n    <w:gridCol w:w=\"3000\"/>\r\n    <w:gridCol w:w=\"3000\"/>\r\n  </w:tblGrid>\r\n  <w:tr>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"3000\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr><w:t>ЗА</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"3000\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr><w:t>ПРОТИВ</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"3000\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr><w:t>ВОЗДЕРЖАЛИСЬ</w:t></w:r></w:p>\r\n    </w:tc>\r\n  </w:tr>\r\n  <w:tr>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"3000\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"20\"/></w:rPr><w:t>${result.votesFor.toFixed(2)} кв.м</w:t></w:r></w:p>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"20\"/></w:rPr><w:t>(${result.percentFor.toFixed(1)}%)</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"3000\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"20\"/></w:rPr><w:t>${result.votesAgainst.toFixed(2)} кв.м</w:t></w:r></w:p>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"20\"/></w:rPr><w:t>(${result.percentAgainst.toFixed(1)}%)</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"3000\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"20\"/></w:rPr><w:t>${result.votesAbstain.toFixed(2)} кв.м</w:t></w:r></w:p>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"20\"/></w:rPr><w:t>(${result.percentAbstain.toFixed(1)}%)</w:t></w:r></w:p>\r\n    </w:tc>\r\n  </w:tr>\r\n</w:tbl>`;\r\n}\r\n\r\n// Generate voter list table for appendix with QR signatures\r\nfunction generateVoterListTableXml(voteRecords: VoteRecord[], voterImageIds: Map<string, string>): string {\r\n  let tableXml = `\r\n<w:tbl>\r\n  <w:tblPr>\r\n    <w:tblW w:w=\"9500\" w:type=\"dxa\"/>\r\n    <w:tblBorders>\r\n      <w:top w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:left w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:bottom w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:right w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:insideH w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:insideV w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n    </w:tblBorders>\r\n  </w:tblPr>\r\n  <w:tblGrid>\r\n    <w:gridCol w:w=\"500\"/>\r\n    <w:gridCol w:w=\"2800\"/>\r\n    <w:gridCol w:w=\"800\"/>\r\n    <w:gridCol w:w=\"1200\"/>\r\n    <w:gridCol w:w=\"1400\"/>\r\n    <w:gridCol w:w=\"1400\"/>\r\n    <w:gridCol w:w=\"1400\"/>\r\n  </w:tblGrid>\r\n  <w:tr>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"500\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>№</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"2800\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>ФИО собственника</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"800\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Кв.</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1200\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Площадь</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1400\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Дата</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1400\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Голос</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1400\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Э-подпись</w:t></w:r></w:p>\r\n    </w:tc>\r\n  </w:tr>`;\r\n\r\n  voteRecords.forEach((record, idx) => {\r\n    const votedDate = new Date(record.voted_at);\r\n    const choiceText = record.choice === 'for' ? 'ЗА' : record.choice === 'against' ? 'ПРОТИВ' : 'ВОЗДЕРЖ.';\r\n    const imageId = voterImageIds.get(record.voter_id);\r\n\r\n    // QR code image XML - inline (wp:inline) 1.5cm x 1.5cm = 600000 EMUs for table cell\r\n    const qrImageXml = imageId ? `<w:r><w:drawing><wp:inline distT=\"0\" distB=\"0\" distL=\"0\" distR=\"0\" xmlns:wp=\"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing\"><wp:extent cx=\"600000\" cy=\"600000\"/><wp:docPr id=\"${1000 + idx}\" name=\"QR Signature ${idx}\"/><a:graphic xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\"><a:graphicData uri=\"http://schemas.openxmlformats.org/drawingml/2006/picture\"><pic:pic xmlns:pic=\"http://schemas.openxmlformats.org/drawingml/2006/picture\"><pic:nvPicPr><pic:cNvPr id=\"0\" name=\"voter_qr_${idx}.png\"/><pic:cNvPicPr/></pic:nvPicPr><pic:blipFill><a:blip r:embed=\"${imageId}\" xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"/><a:stretch><a:fillRect/></a:stretch></pic:blipFill><pic:spPr><a:xfrm><a:off x=\"0\" y=\"0\"/><a:ext cx=\"600000\" cy=\"600000\"/></a:xfrm><a:prstGeom prst=\"rect\"><a:avLst/></a:prstGeom></pic:spPr></pic:pic></a:graphicData></a:graphic></wp:inline></w:drawing></w:r>` : '<w:r><w:t>✓</w:t></w:r>';\r\n\r\n    tableXml += `\r\n  <w:tr>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"500\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${idx + 1}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"2800\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${escapeXml(record.voter_name)}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"800\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${record.apartment_number || '-'}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1200\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${record.vote_weight?.toFixed(2) || '-'}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1400\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${votedDate.toLocaleDateString('ru-RU')}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1400\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${choiceText}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1400\" w:type=\"dxa\"/><w:vAlign w:val=\"center\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/></w:pPr>${qrImageXml}</w:p>\r\n    </w:tc>\r\n  </w:tr>`;\r\n  });\r\n\r\n  tableXml += `</w:tbl>`;\r\n  return tableXml;\r\n}\r\n\r\n// Generate votes by item table with optional comments\r\nfunction generateVotesByItemTableXml(_agendaItem: AgendaItem, votes: VoteRecord[]): string {\r\n  if (!votes || votes.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  // Check if any vote has a comment\r\n  const hasComments = votes.some(v => v.comment && v.comment.trim().length > 0);\r\n\r\n  let tableXml = `\r\n<w:p><w:pPr><w:spacing w:before=\"100\"/><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr><w:t>Голоса участников:</w:t></w:r></w:p>\r\n<w:tbl>\r\n  <w:tblPr>\r\n    <w:tblW w:w=\"${hasComments ? '10500' : '9000'}\" w:type=\"dxa\"/>\r\n    <w:tblBorders>\r\n      <w:top w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:left w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:bottom w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:right w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:insideH w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n      <w:insideV w:val=\"single\" w:sz=\"4\" w:color=\"000000\"/>\r\n    </w:tblBorders>\r\n    <w:jc w:val=\"center\"/>\r\n  </w:tblPr>\r\n  <w:tblGrid>\r\n    <w:gridCol w:w=\"500\"/>\r\n    <w:gridCol w:w=\"${hasComments ? '2500' : '3500'}\"/>\r\n    <w:gridCol w:w=\"800\"/>\r\n    <w:gridCol w:w=\"1200\"/>\r\n    <w:gridCol w:w=\"1500\"/>\r\n    ${hasComments ? '<w:gridCol w:w=\"4000\"/>' : ''}\r\n  </w:tblGrid>\r\n  <w:tr>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"500\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>№</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"${hasComments ? '2500' : '3500'}\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>ФИО</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"800\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Кв.</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1200\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Площадь</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1500\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Голос</w:t></w:r></w:p>\r\n    </w:tc>\r\n    ${hasComments ? `<w:tc><w:tcPr><w:tcW w:w=\"4000\" w:type=\"dxa\"/><w:shd w:val=\"clear\" w:fill=\"E7E6E6\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:b/><w:sz w:val=\"16\"/></w:rPr><w:t>Обоснование</w:t></w:r></w:p>\r\n    </w:tc>` : ''}\r\n  </w:tr>`;\r\n\r\n  votes.forEach((v, idx) => {\r\n    const choiceText = v.choice === 'for' ? 'ЗА' : v.choice === 'against' ? 'ПРОТИВ' : 'ВОЗДЕРЖАЛСЯ';\r\n    const commentText = v.comment?.trim() || '';\r\n    tableXml += `\r\n  <w:tr>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"500\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${idx + 1}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"${hasComments ? '2500' : '3500'}\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${escapeXml(v.voter_name)}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"800\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${v.apartment_number || '-'}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1200\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${v.vote_weight?.toFixed(2) || '-'}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    <w:tc><w:tcPr><w:tcW w:w=\"1500\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"16\"/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"16\"/></w:rPr><w:t>${choiceText}</w:t></w:r></w:p>\r\n    </w:tc>\r\n    ${hasComments ? `<w:tc><w:tcPr><w:tcW w:w=\"4000\" w:type=\"dxa\"/></w:tcPr>\r\n      <w:p><w:pPr><w:rPr><w:sz w:val=\"14\"/><w:i/></w:rPr></w:pPr>\r\n      <w:r><w:rPr><w:sz w:val=\"14\"/><w:i/></w:rPr><w:t>${escapeXml(commentText)}</w:t></w:r></w:p>\r\n    </w:tc>` : ''}\r\n  </w:tr>`;\r\n  });\r\n\r\n  tableXml += `</w:tbl>`;\r\n  return tableXml;\r\n}\r\n\r\nexport async function generateProtocolDocx(data: ProtocolData): Promise<void> {\r\n  const { meeting, agendaItems, voteRecords, votesByItem } = data;\r\n\r\n  const address = meeting.buildingAddress || meeting.building_address || 'Адрес не указан';\r\n  const meetingDate = formatDateRu(meeting.confirmed_date_time || meeting.voting_opened_at);\r\n  const meetingTime = formatTimeRu(meeting.confirmed_date_time || meeting.voting_opened_at);\r\n  const location = meeting.location || address;\r\n  const format = meeting.format === 'online' ? 'заочной' : meeting.format === 'hybrid' ? 'очно-заочной' : 'очной';\r\n\r\n  // Generate UK company QR code\r\n  const ukQrCodeDataUrl = await generateUKQRCode();\r\n\r\n  // Generate QR codes for each voter\r\n  const voterQRCodes = new Map<string, string>();\r\n  const voterImageIds = new Map<string, string>();\r\n\r\n  for (let i = 0; i < voteRecords.length; i++) {\r\n    const voter = voteRecords[i];\r\n    const qrCode = await generateVoterQRCode(voter, meeting.number, address);\r\n    voterQRCodes.set(voter.voter_id, qrCode);\r\n    voterImageIds.set(voter.voter_id, `rId${200 + i}`);\r\n  }\r\n\r\n  // Generate agenda items content\r\n  let agendaItemsXml = '';\r\n\r\n  // First question is always election of chairman and secretary\r\n  agendaItemsXml += `\r\n<w:p><w:pPr><w:spacing w:before=\"200\" w:after=\"100\"/><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>1. Избрание Председателя и Секретаря собрания</w:t></w:r></w:p>\r\n<w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>СЛУШАЛИ: Предложение об избрании Председателя и Секретаря собрания из числа присутствующих собственников помещений.</w:t></w:r></w:p>\r\n<w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>ПРЕДЛОЖЕНО: Избрать Председателем собрания представителя УК, Секретарём - ${meeting.organizer_name || 'представителя УК'}.</w:t></w:r></w:p>\r\n<w:p><w:pPr><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>ГОЛОСОВАЛИ:</w:t></w:r></w:p>\r\n${generateVotingTableXml({\r\n  votesFor: meeting.voted_area,\r\n  votesAgainst: 0,\r\n  votesAbstain: 0,\r\n  percentFor: 100,\r\n  percentAgainst: 0,\r\n  percentAbstain: 0,\r\n})}\r\n<w:p><w:pPr><w:spacing w:before=\"100\"/><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>РЕШЕНИЕ: Избрать Председателя и Секретаря собрания. Решение принято.</w:t></w:r></w:p>\r\n`;\r\n\r\n  // Add actual agenda items\r\n  agendaItems.forEach((item, idx) => {\r\n    const result = calculateVoteResult(item, meeting.total_area);\r\n    const itemNumber = idx + 2; // +2 because first is election of chairman\r\n    const isApproved = result.percentFor > 50;\r\n    const itemVotes = votesByItem[item.id] || [];\r\n\r\n    agendaItemsXml += `\r\n<w:p><w:pPr><w:spacing w:before=\"300\" w:after=\"100\"/><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>${itemNumber}. ${escapeXml(item.title)}</w:t></w:r></w:p>\r\n${item.description ? `<w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>СЛУШАЛИ: ${escapeXml(item.description)}</w:t></w:r></w:p>` : ''}\r\n<w:p><w:pPr><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>ГОЛОСОВАЛИ:</w:t></w:r></w:p>\r\n${generateVotingTableXml(result)}\r\n${generateVotesByItemTableXml(item, itemVotes)}\r\n<w:p><w:pPr><w:spacing w:before=\"100\"/><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n<w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>РЕШЕНИЕ: ${isApproved ? 'Решение принято.' : 'Решение не принято.'}</w:t></w:r></w:p>\r\n`;\r\n  });\r\n\r\n  // UK QR code image XML for signatures section\r\n  const ukQrImageXml = `<w:r><w:drawing><wp:inline distT=\"0\" distB=\"0\" distL=\"0\" distR=\"0\" xmlns:wp=\"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing\"><wp:extent cx=\"900000\" cy=\"900000\"/><wp:docPr id=\"999\" name=\"UK QR Code\"/><a:graphic xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\"><a:graphicData uri=\"http://schemas.openxmlformats.org/drawingml/2006/picture\"><pic:pic xmlns:pic=\"http://schemas.openxmlformats.org/drawingml/2006/picture\"><pic:nvPicPr><pic:cNvPr id=\"0\" name=\"uk_qr.png\"/><pic:cNvPicPr/></pic:nvPicPr><pic:blipFill><a:blip r:embed=\"rId100\" xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"/><a:stretch><a:fillRect/></a:stretch></pic:blipFill><pic:spPr><a:xfrm><a:off x=\"0\" y=\"0\"/><a:ext cx=\"900000\" cy=\"900000\"/></a:xfrm><a:prstGeom prst=\"rect\"><a:avLst/></a:prstGeom></pic:spPr></pic:pic></a:graphicData></a:graphic></wp:inline></w:drawing></w:r>`;\r\n\r\n  // Build the complete document.xml content\r\n  const documentXml = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n<w:document xmlns:w=\"http://schemas.openxmlformats.org/wordprocessingml/2006/main\"\r\n            xmlns:wp=\"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing\"\r\n            xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\"\r\n            xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"\r\n            xmlns:pic=\"http://schemas.openxmlformats.org/drawingml/2006/picture\">\r\n  <w:body>\r\n    <!-- Header -->\r\n    <w:p><w:pPr><w:jc w:val=\"right\"/><w:rPr><w:i/><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:i/><w:sz w:val=\"20\"/></w:rPr><w:t>Закон РУз «Об управлении многоквартирными домами»</w:t></w:r></w:p>\r\n\r\n    <!-- Title -->\r\n    <w:p><w:pPr><w:spacing w:before=\"400\" w:after=\"200\"/><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"28\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"28\"/></w:rPr><w:t>ПРОТОКОЛ № ${meeting.number}/${new Date().getFullYear()}</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr><w:t>общего собрания собственников помещений</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr><w:t>многоквартирного дома по адресу:</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr><w:t>${escapeXml(address)}</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>проведённого в форме ${format} голосования</w:t></w:r></w:p>\r\n\r\n    <!-- Meeting Info -->\r\n    <w:p><w:pPr><w:spacing w:before=\"200\"/><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>Дата проведения: </w:t></w:r>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>${meetingDate}</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>Время: </w:t></w:r>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>${meetingTime}</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>Место проведения: </w:t></w:r>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>${escapeXml(location)}</w:t></w:r></w:p>\r\n\r\n    <!-- Quorum Info -->\r\n    <w:p><w:pPr><w:spacing w:before=\"200\"/><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>КВОРУМ:</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>Общая площадь помещений в доме: ${meeting.total_area.toFixed(2)} кв.м</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>Площадь помещений проголосовавших собственников: ${meeting.voted_area.toFixed(2)} кв.м</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>Процент участия: ${meeting.participation_percent.toFixed(1)}%</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>Количество проголосовавших: ${meeting.participated_count} из ${meeting.total_eligible_count} собственников</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:b/><w:sz w:val=\"22\"/><w:color w:val=\"${meeting.quorum_reached ? '008000' : 'FF0000'}\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"22\"/><w:color w:val=\"${meeting.quorum_reached ? '008000' : 'FF0000'}\"/></w:rPr><w:t>Кворум ${meeting.quorum_reached ? 'ИМЕЕТСЯ' : 'ОТСУТСТВУЕТ'} (требуется ${meeting.quorum_percent}%)</w:t></w:r></w:p>\r\n\r\n    <!-- Agenda -->\r\n    <w:p><w:pPr><w:spacing w:before=\"300\" w:after=\"100\"/><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr><w:t>ПОВЕСТКА ДНЯ:</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>1. Избрание Председателя и Секретаря собрания</w:t></w:r></w:p>\r\n    ${agendaItems.map((item, idx) => `\r\n    <w:p><w:pPr><w:rPr><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"22\"/></w:rPr><w:t>${idx + 2}. ${escapeXml(item.title)}</w:t></w:r></w:p>`).join('')}\r\n\r\n    <!-- Agenda Items Content -->\r\n    ${agendaItemsXml}\r\n\r\n    <!-- UK QR Code Signature -->\r\n    <w:p><w:pPr><w:spacing w:before=\"400\"/><w:jc w:val=\"center\"/></w:pPr>${ukQrImageXml}</w:p>\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"20\"/></w:rPr><w:t>Управляющая компания</w:t></w:r></w:p>\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:sz w:val=\"18\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:sz w:val=\"18\"/></w:rPr><w:t>${UK_COMPANY.name}</w:t></w:r></w:p>\r\n\r\n    <!-- Appendix - Page Break -->\r\n    <w:p><w:r><w:br w:type=\"page\"/></w:r></w:p>\r\n\r\n    <!-- Appendix Header -->\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"24\"/></w:rPr><w:t>ПРИЛОЖЕНИЕ № 1</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>к Протоколу № ${meeting.number}/${new Date().getFullYear()}</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:b/><w:sz w:val=\"22\"/></w:rPr><w:t>РЕЕСТР УЧАСТНИКОВ ГОЛОСОВАНИЯ С ЭЛЕКТРОННЫМИ ПОДПИСЯМИ</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:spacing w:before=\"200\"/></w:pPr></w:p>\r\n\r\n    ${generateVoterListTableXml(voteRecords, voterImageIds)}\r\n\r\n    <!-- Footer -->\r\n    <w:p><w:pPr><w:spacing w:before=\"300\"/><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr><w:t>Протокол сформирован автоматически системой УК «KAMIZO»</w:t></w:r></w:p>\r\n\r\n    <w:p><w:pPr><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr><w:t>Дата формирования: ${new Date().toLocaleString('ru-RU')}</w:t></w:r></w:p>\r\n\r\n    ${data.protocolHash ? `<w:p><w:pPr><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr></w:pPr>\r\n    <w:r><w:rPr><w:i/><w:sz w:val=\"18\"/></w:rPr><w:t>Хеш документа: ${data.protocolHash}</w:t></w:r></w:p>` : ''}\r\n\r\n    <w:sectPr>\r\n      <w:pgSz w:w=\"11906\" w:h=\"16838\"/>\r\n      <w:pgMar w:top=\"1134\" w:right=\"850\" w:bottom=\"1134\" w:left=\"1701\"/>\r\n    </w:sectPr>\r\n  </w:body>\r\n</w:document>`;\r\n\r\n  // Create minimal DOCX structure\r\n  const zip = new PizZip();\r\n\r\n  // Add UK QR code image\r\n  const ukImageBytes = dataUrlToUint8Array(ukQrCodeDataUrl);\r\n  zip.file('word/media/uk_qr.png', ukImageBytes);\r\n\r\n  // Add voter QR code images\r\n  for (const [voterId, qrCode] of voterQRCodes) {\r\n    const imageBytes = dataUrlToUint8Array(qrCode);\r\n    const idx = voteRecords.findIndex(v => v.voter_id === voterId);\r\n    zip.file(`word/media/voter_qr_${idx}.png`, imageBytes);\r\n  }\r\n\r\n  // Build relationships for all images\r\n  let relsContent = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">\r\n  <Relationship Id=\"rId100\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"media/uk_qr.png\"/>`;\r\n\r\n  for (let i = 0; i < voteRecords.length; i++) {\r\n    relsContent += `\r\n  <Relationship Id=\"rId${200 + i}\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"media/voter_qr_${i}.png\"/>`;\r\n  }\r\n  relsContent += `\r\n</Relationships>`;\r\n\r\n  // Add required files\r\n  zip.file('[Content_Types].xml', `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n<Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\">\r\n  <Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\"/>\r\n  <Default Extension=\"xml\" ContentType=\"application/xml\"/>\r\n  <Default Extension=\"png\" ContentType=\"image/png\"/>\r\n  <Override PartName=\"/word/document.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml\"/>\r\n</Types>`);\r\n\r\n  zip.file('_rels/.rels', `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">\r\n  <Relationship Id=\"rId1\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\" Target=\"word/document.xml\"/>\r\n</Relationships>`);\r\n\r\n  zip.file('word/_rels/document.xml.rels', relsContent);\r\n  zip.file('word/document.xml', documentXml);\r\n\r\n  // Generate blob\r\n  const blob = zip.generate({\r\n    type: 'blob',\r\n    mimeType: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n  });\r\n\r\n  // Download\r\n  const fileName = `Протокол_${meeting.number}_${address.replace(/[^a-zA-Zа-яА-ЯёЁ0-9]/g, '_')}.docx`;\r\n  downloadBlob(blob, fileName);\r\n}\r\n","import { useState, useMemo, useEffect } from 'react';\r\nimport {\r\n  Plus, Users, Calendar, AlertCircle,\r\n  FileText, Building2, User,\r\n  ThumbsUp, ThumbsDown, Minus, Eye,\r\n  Play, Square, BarChart3, Shield, X, Check, CalendarCheck, Download, Trash2\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useMeetingStore } from '../stores/meetingStore';\r\nimport { useLanguageStore } from '../stores/languageStore';\r\nimport { useCRMStore } from '../stores/crmStore';\r\nimport { generateProtocolDocx } from '../utils/protocolGenerator';\r\nimport type {\r\n  Meeting, MeetingStatus, MeetingFormat, AgendaItem, AgendaItemType,\r\n  MeetingOrganizerType, DecisionThreshold\r\n} from '../types';\r\nimport { AGENDA_ITEM_TYPES, MEETING_STATUS_LABELS, DECISION_THRESHOLD_LABELS } from '../types';\r\n\r\nexport function MeetingsPage() {\r\n  const { user } = useAuthStore();\r\n  const { t, language } = useLanguageStore();\r\n  const { buildings, fetchBuildings } = useCRMStore();\r\n  const {\r\n    meetings,\r\n    fetchMeetings,\r\n    createMeeting,\r\n    approveMeeting,\r\n    rejectMeeting,\r\n    confirmSchedule,\r\n    openVoting,\r\n    closeVoting,\r\n    publishResults,\r\n    generateProtocol,\r\n    approveProtocol,\r\n    deleteMeeting,\r\n    calculateAgendaItemResult,\r\n    calculateMeetingQuorum,\r\n  } = useMeetingStore();\r\n\r\n  // Fetch meetings and buildings on component mount\r\n  useEffect(() => {\r\n    fetchMeetings();\r\n    fetchBuildings();\r\n  }, [fetchMeetings, fetchBuildings]);\r\n\r\n  const [activeTab, setActiveTab] = useState<'all' | 'active' | 'completed' | 'pending'>('all');\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [selectedMeeting, setSelectedMeeting] = useState<Meeting | null>(null);\r\n  const [showDetailsModal, setShowDetailsModal] = useState(false);\r\n\r\n  // Filter meetings by tab\r\n  const filteredMeetings = useMemo(() => {\r\n    switch (activeTab) {\r\n      case 'active':\r\n        return meetings.filter(m =>\r\n          ['schedule_poll_open', 'schedule_confirmed', 'voting_open'].includes(m.status)\r\n        );\r\n      case 'completed':\r\n        return meetings.filter(m =>\r\n          ['voting_closed', 'results_published', 'protocol_generated', 'protocol_approved'].includes(m.status)\r\n        );\r\n      case 'pending':\r\n        return meetings.filter(m =>\r\n          ['draft', 'pending_moderation'].includes(m.status)\r\n        );\r\n      default:\r\n        return meetings;\r\n    }\r\n  }, [meetings, activeTab]);\r\n\r\n  const getStatusColor = (status: MeetingStatus): string => {\r\n    return MEETING_STATUS_LABELS[status]?.color || 'gray';\r\n  };\r\n\r\n  const getStatusLabel = (status: MeetingStatus): string => {\r\n    const labels = MEETING_STATUS_LABELS[status];\r\n    return language === 'ru' ? labels?.label : labels?.labelUz;\r\n  };\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  const handleViewDetails = (meeting: Meeting) => {\r\n    setSelectedMeeting(meeting);\r\n    setShowDetailsModal(true);\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (confirm(language === 'ru' ? 'Удалить собрание? Это действие необратимо.' : 'Yig\\'ilishni o\\'chirmoqchimisiz? Bu amalni bekor qilib bo\\'lmaydi.')) {\r\n      await deleteMeeting(id);\r\n    }\r\n  };\r\n\r\n  const tabs = [\r\n    { id: 'all' as const, label: language === 'ru' ? 'Все' : 'Barchasi', count: meetings.length },\r\n    { id: 'active' as const, label: language === 'ru' ? 'Активные' : 'Faol', count: meetings.filter(m => ['schedule_poll_open', 'schedule_confirmed', 'voting_open'].includes(m.status)).length },\r\n    { id: 'pending' as const, label: language === 'ru' ? 'Ожидают' : 'Kutmoqda', count: meetings.filter(m => ['draft', 'pending_moderation'].includes(m.status)).length },\r\n    { id: 'completed' as const, label: language === 'ru' ? 'Завершены' : 'Tugallangan', count: meetings.filter(m => ['voting_closed', 'results_published', 'protocol_generated', 'protocol_approved'].includes(m.status)).length },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">{t('meetings.title')}</h1>\r\n          <p className=\"text-gray-500\">{t('meetings.subtitle')}</p>\r\n        </div>\r\n        <button\r\n          onClick={() => setShowCreateModal(true)}\r\n          className=\"btn-primary flex items-center gap-2\"\r\n        >\r\n          <Plus className=\"w-5 h-5\" />\r\n          {t('meetings.create')}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"flex gap-2 flex-wrap\">\r\n        {tabs.map((tab) => (\r\n          <button\r\n            key={tab.id}\r\n            onClick={() => setActiveTab(tab.id)}\r\n            className={`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-colors ${\r\n              activeTab === tab.id\r\n                ? 'bg-orange-400 text-gray-900'\r\n                : 'bg-white text-gray-600 hover:bg-gray-100'\r\n            }`}\r\n          >\r\n            {tab.label}\r\n            {tab.count > 0 && (\r\n              <span className=\"ml-1 px-2 py-0.5 rounded-full bg-gray-900/10 text-xs\">\r\n                {tab.count}\r\n              </span>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Meetings List */}\r\n      <div className=\"space-y-4\">\r\n        {filteredMeetings.length === 0 ? (\r\n          <div className=\"glass-card p-12 text-center\">\r\n            <Users className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\r\n            <h3 className=\"text-lg font-medium text-gray-600 mb-2\">\r\n              {t('meetings.noMeetings')}\r\n            </h3>\r\n            <p className=\"text-gray-400\">{t('meetings.createFirst')}</p>\r\n          </div>\r\n        ) : (\r\n          filteredMeetings.map((meeting) => (\r\n            <MeetingCard\r\n              key={meeting.id}\r\n              meeting={meeting}\r\n              language={language}\r\n              getStatusColor={getStatusColor}\r\n              getStatusLabel={getStatusLabel}\r\n              formatDate={formatDate}\r\n              onViewDetails={() => handleViewDetails(meeting)}\r\n              onApprove={() => approveMeeting(meeting.id)}\r\n              onReject={(reason) => rejectMeeting(meeting.id, reason)}\r\n              onConfirmSchedule={() => confirmSchedule(meeting.id)}\r\n              onOpenVoting={() => openVoting(meeting.id)}\r\n              onCloseVoting={() => closeVoting(meeting.id)}\r\n              onPublishResults={() => publishResults(meeting.id)}\r\n              onGenerateProtocol={() => generateProtocol(meeting.id)}\r\n              onApproveProtocol={() => approveProtocol(meeting.id)}\r\n              onDelete={() => handleDelete(meeting.id)}\r\n              calculateQuorum={() => calculateMeetingQuorum(meeting.id)}\r\n              user={user}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      {/* Create Meeting Modal */}\r\n      {showCreateModal && (\r\n        <CreateMeetingWizard\r\n          onClose={() => setShowCreateModal(false)}\r\n          onCreate={async (data) => {\r\n            try {\r\n              await createMeeting(data);\r\n              await fetchMeetings(); // Refresh the list\r\n              setShowCreateModal(false);\r\n            } catch (err) {\r\n              console.error('Failed to create meeting:', err);\r\n            }\r\n          }}\r\n          language={language}\r\n          user={user}\r\n          buildings={buildings.map(b => ({ id: b.id, name: b.name, address: b.address }))}\r\n        />\r\n      )}\r\n\r\n      {/* Meeting Details Modal */}\r\n      {showDetailsModal && selectedMeeting && (\r\n        <MeetingDetailsModal\r\n          meeting={selectedMeeting}\r\n          onClose={() => {\r\n            setShowDetailsModal(false);\r\n            setSelectedMeeting(null);\r\n          }}\r\n          language={language}\r\n          calculateResult={calculateAgendaItemResult}\r\n          calculateQuorum={() => calculateMeetingQuorum(selectedMeeting.id)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Meeting Card Component\r\nfunction MeetingCard({\r\n  meeting,\r\n  language,\r\n  getStatusColor,\r\n  getStatusLabel,\r\n  formatDate,\r\n  onViewDetails,\r\n  onApprove,\r\n  onReject,\r\n  onConfirmSchedule,\r\n  onOpenVoting,\r\n  onCloseVoting,\r\n  onPublishResults,\r\n  onGenerateProtocol,\r\n  onApproveProtocol,\r\n  onDelete,\r\n  calculateQuorum,\r\n  user,\r\n}: {\r\n  meeting: Meeting;\r\n  language: string;\r\n  getStatusColor: (status: MeetingStatus) => string;\r\n  getStatusLabel: (status: MeetingStatus) => string;\r\n  formatDate: (date: string) => string;\r\n  onViewDetails: () => void;\r\n  onApprove: () => void;\r\n  onReject: (reason: string) => void;\r\n  onConfirmSchedule: () => void;\r\n  onOpenVoting: () => void;\r\n  onCloseVoting: () => void;\r\n  onPublishResults: () => void;\r\n  onGenerateProtocol: () => void;\r\n  onApproveProtocol: () => void;\r\n  onDelete: () => void;\r\n  calculateQuorum: () => { participated: number; total: number; percent: number; quorumReached: boolean };\r\n  user: { id: string; role: string } | null;\r\n}) {\r\n  const quorum = calculateQuorum();\r\n\r\n  const statusColor = getStatusColor(meeting.status);\r\n  const colorClasses: Record<string, string> = {\r\n    gray: 'bg-gray-100 text-gray-700',\r\n    yellow: 'bg-yellow-100 text-orange-700',\r\n    blue: 'bg-blue-100 text-blue-700',\r\n    indigo: 'bg-indigo-100 text-indigo-700',\r\n    green: 'bg-green-100 text-green-700',\r\n    orange: 'bg-orange-100 text-orange-700',\r\n    purple: 'bg-purple-100 text-purple-700',\r\n    teal: 'bg-teal-100 text-teal-700',\r\n    emerald: 'bg-emerald-100 text-emerald-700',\r\n    red: 'bg-red-100 text-red-700',\r\n  };\r\n\r\n  return (\r\n    <div className=\"glass-card p-5 hover:shadow-lg transition-shadow\">\r\n      <div className=\"flex items-start justify-between gap-4\">\r\n        <div className=\"flex-1 min-w-0\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center gap-3 mb-3 flex-wrap\">\r\n            <span className={`px-3 py-1 rounded-lg text-sm font-medium ${colorClasses[statusColor] || colorClasses.gray}`}>\r\n              {getStatusLabel(meeting.status)}\r\n            </span>\r\n            <span className=\"text-sm text-gray-500\">\r\n              #{meeting.number}\r\n            </span>\r\n            <span className={`px-2 py-0.5 rounded text-xs font-medium ${\r\n              meeting.format === 'online' ? 'bg-blue-50 text-blue-600' :\r\n              meeting.format === 'offline' ? 'bg-green-50 text-green-600' :\r\n              'bg-purple-50 text-purple-600'\r\n            }`}>\r\n              {meeting.format === 'online' ? (language === 'ru' ? 'Онлайн' : 'Onlayn') :\r\n               meeting.format === 'offline' ? (language === 'ru' ? 'Очное' : 'Yuzma-yuz') :\r\n               (language === 'ru' ? 'Смешанное' : 'Aralash')}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Building & Date */}\r\n          <div className=\"flex items-center gap-4 text-sm text-gray-600 mb-2\">\r\n            <span className=\"flex items-center gap-1\">\r\n              <Building2 className=\"w-4 h-4\" />\r\n              {meeting.buildingAddress}\r\n            </span>\r\n            {meeting.confirmedDateTime && (\r\n              <span className=\"flex items-center gap-1\">\r\n                <Calendar className=\"w-4 h-4\" />\r\n                {formatDate(meeting.confirmedDateTime)}\r\n              </span>\r\n            )}\r\n          </div>\r\n\r\n          {/* Organizer */}\r\n          <div className=\"flex items-center gap-2 text-sm text-gray-500 mb-3\">\r\n            <User className=\"w-4 h-4\" />\r\n            <span>{meeting.organizerName}</span>\r\n            <span className=\"text-gray-400\">\r\n              ({meeting.organizerType === 'resident'\r\n                ? (language === 'ru' ? 'Житель' : 'Aholi')\r\n                : (language === 'ru' ? 'УК' : 'UK')})\r\n            </span>\r\n          </div>\r\n\r\n          {/* Agenda Summary */}\r\n          <div className=\"flex items-center gap-2 text-sm\">\r\n            <FileText className=\"w-4 h-4 text-gray-400\" />\r\n            <span className=\"text-gray-600\">\r\n              {meeting.agendaItems.length} {language === 'ru' ? 'вопросов в повестке' : 'savol kun tartibida'}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Schedule Poll Stats - show votes for each date option */}\r\n          {meeting.status === 'schedule_poll_open' && meeting.scheduleOptions && meeting.scheduleOptions.length > 0 && (\r\n            <div className=\"mt-3 pt-3 border-t border-gray-100\">\r\n              <div className=\"text-sm font-medium text-gray-700 mb-2 flex items-center gap-2\">\r\n                <Calendar className=\"w-4 h-4 text-blue-500\" />\r\n                {language === 'ru' ? 'Голосование за дату:' : 'Sana uchun ovoz berish:'}\r\n              </div>\r\n              <div className=\"space-y-1\">\r\n                {meeting.scheduleOptions.map((option) => {\r\n                  const totalVotes = meeting.scheduleOptions.reduce((sum, opt) => sum + ((opt as any).voteCount ?? opt.votes?.length ?? 0), 0);\r\n                  const voteCount = (option as any).voteCount ?? option.votes?.length ?? 0;\r\n                  const percent = totalVotes > 0 ? (voteCount / totalVotes * 100) : 0;\r\n                  const isLeading = voteCount > 0 && voteCount === Math.max(...meeting.scheduleOptions.map(o => (o as any).voteCount ?? o.votes?.length ?? 0));\r\n\r\n                  return (\r\n                    <div key={option.id} className=\"flex items-center gap-2 text-sm\">\r\n                      <div className={`flex-1 flex items-center gap-2 ${isLeading ? 'font-medium text-blue-700' : 'text-gray-600'}`}>\r\n                        <span>{formatDate(option.dateTime)}</span>\r\n                        {isLeading && voteCount > 0 && (\r\n                          <span className=\"text-xs px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded\">\r\n                            {language === 'ru' ? 'Лидер' : 'Yetakchi'}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-20 h-2 bg-gray-100 rounded-full overflow-hidden\">\r\n                          <div\r\n                            className=\"h-full bg-blue-500 rounded-full transition-all\"\r\n                            style={{ width: `${percent}%` }}\r\n                          />\r\n                        </div>\r\n                        <span className=\"text-xs text-gray-500 w-12 text-right\">{voteCount} ({percent.toFixed(0)}%)</span>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n              <div className=\"text-xs text-gray-400 mt-2\">\r\n                {language === 'ru' ? 'Всего голосов: ' : 'Jami ovozlar: '}\r\n                {meeting.scheduleOptions.reduce((sum, opt) => sum + ((opt as any).voteCount ?? opt.votes?.length ?? 0), 0)}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Participation stats for active/completed meetings */}\r\n          {['voting_open', 'voting_closed', 'results_published', 'protocol_generated', 'protocol_approved'].includes(meeting.status) && (\r\n            <div className=\"flex items-center gap-4 mt-3 pt-3 border-t border-gray-100\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Users className=\"w-4 h-4 text-gray-400\" />\r\n                <span className=\"text-sm\">\r\n                  {quorum.participated}/{quorum.total} ({quorum.percent.toFixed(1)}%)\r\n                </span>\r\n              </div>\r\n              <span className={`text-xs px-2 py-0.5 rounded-full font-medium ${\r\n                quorum.quorumReached\r\n                  ? 'bg-green-100 text-green-700'\r\n                  : 'bg-red-100 text-red-700'\r\n              }`}>\r\n                {quorum.quorumReached\r\n                  ? (language === 'ru' ? 'Кворум есть' : 'Kvorum bor')\r\n                  : (language === 'ru' ? 'Нет кворума' : 'Kvorum yo\\'q')}\r\n              </span>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Actions */}\r\n        <div className=\"flex flex-col gap-2\">\r\n          <button\r\n            onClick={onViewDetails}\r\n            className=\"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors\"\r\n            title={language === 'ru' ? 'Подробнее' : 'Batafsil'}\r\n          >\r\n            <Eye className=\"w-5 h-5\" />\r\n          </button>\r\n\r\n          {/* Status-specific actions */}\r\n          {meeting.status === 'pending_moderation' && (user?.role === 'admin' || user?.role === 'manager' || user?.role === 'director') && (\r\n            <>\r\n              <button\r\n                onClick={onApprove}\r\n                className=\"p-2 text-green-500 hover:text-green-700 hover:bg-green-50 rounded-lg transition-colors\"\r\n                title={language === 'ru' ? 'Одобрить' : 'Tasdiqlash'}\r\n              >\r\n                <Check className=\"w-5 h-5\" />\r\n              </button>\r\n              <button\r\n                onClick={() => onReject(language === 'ru' ? 'Отклонено модератором' : 'Moderator tomonidan rad etildi')}\r\n                className=\"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors\"\r\n                title={language === 'ru' ? 'Отклонить' : 'Rad etish'}\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </>\r\n          )}\r\n\r\n          {/* Delete button - for admin/manager/director (all meetings including completed) */}\r\n          {(user?.role === 'admin' || user?.role === 'manager' || user?.role === 'director') && (\r\n            <button\r\n              onClick={onDelete}\r\n              className=\"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n              title={language === 'ru' ? 'Удалить' : 'O\\'chirish'}\r\n            >\r\n              <Trash2 className=\"w-5 h-5\" />\r\n            </button>\r\n          )}\r\n\r\n        </div>\r\n      </div>\r\n\r\n      {/* Admin Action Buttons - Full width at bottom */}\r\n      {(user?.role === 'admin' || user?.role === 'manager' || user?.role === 'director') && (\r\n        <div className=\"mt-4 pt-4 border-t border-gray-100 flex flex-wrap gap-2\">\r\n          {meeting.status === 'schedule_poll_open' && (\r\n            <button\r\n              onClick={onConfirmSchedule}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors text-sm font-medium\"\r\n            >\r\n              <CalendarCheck className=\"w-4 h-4\" />\r\n              {language === 'ru' ? 'Подтвердить дату' : 'Sanani tasdiqlash'}\r\n            </button>\r\n          )}\r\n\r\n          {meeting.status === 'schedule_confirmed' && (\r\n            <button\r\n              onClick={onOpenVoting}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors text-sm font-medium\"\r\n            >\r\n              <Play className=\"w-4 h-4\" />\r\n              {language === 'ru' ? 'Открыть голосование' : 'Ovoz berishni ochish'}\r\n            </button>\r\n          )}\r\n\r\n          {meeting.status === 'voting_open' && (\r\n            <button\r\n              onClick={onCloseVoting}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors text-sm font-medium\"\r\n            >\r\n              <Square className=\"w-4 h-4\" />\r\n              {language === 'ru' ? 'Закрыть голосование' : 'Ovoz berishni yopish'}\r\n            </button>\r\n          )}\r\n\r\n          {meeting.status === 'voting_closed' && (\r\n            <button\r\n              onClick={onPublishResults}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors text-sm font-medium\"\r\n            >\r\n              <BarChart3 className=\"w-4 h-4\" />\r\n              {language === 'ru' ? 'Опубликовать итоги' : 'Natijalarni e\\'lon qilish'}\r\n            </button>\r\n          )}\r\n\r\n          {meeting.status === 'results_published' && (\r\n            <button\r\n              onClick={onGenerateProtocol}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-teal-500 hover:bg-teal-600 text-white rounded-lg transition-colors text-sm font-medium\"\r\n            >\r\n              <FileText className=\"w-4 h-4\" />\r\n              {language === 'ru' ? 'Сформировать протокол' : 'Bayonnoma yaratish'}\r\n            </button>\r\n          )}\r\n\r\n          {meeting.status === 'protocol_generated' && (\r\n            <>\r\n              <button\r\n                onClick={onApproveProtocol}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg transition-colors text-sm font-medium\"\r\n              >\r\n                <Shield className=\"w-4 h-4\" />\r\n                {language === 'ru' ? 'Подписать протокол' : 'Bayonnomani imzolash'}\r\n              </button>\r\n              <button\r\n                onClick={onViewDetails}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors text-sm font-medium\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n                {language === 'ru' ? 'Скачать протокол' : 'Bayonnomani yuklab olish'}\r\n              </button>\r\n            </>\r\n          )}\r\n\r\n          {meeting.status === 'protocol_approved' && (\r\n            <button\r\n              onClick={onViewDetails}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors text-sm font-medium\"\r\n            >\r\n              <Download className=\"w-4 h-4\" />\r\n              {language === 'ru' ? 'Скачать протокол' : 'Bayonnomani yuklab olish'}\r\n            </button>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Create Meeting Wizard\r\nfunction CreateMeetingWizard({\r\n  onClose,\r\n  onCreate,\r\n  language,\r\n  user,\r\n  buildings,\r\n}: {\r\n  onClose: () => void;\r\n  onCreate: (data: {\r\n    buildingId: string;\r\n    buildingAddress: string;\r\n    organizerType: MeetingOrganizerType;\r\n    organizerId: string;\r\n    organizerName: string;\r\n    format: MeetingFormat;\r\n    agendaItems: Omit<AgendaItem, 'id' | 'votesFor' | 'votesAgainst' | 'votesAbstain' | 'order'>[];\r\n    location?: string;\r\n    description?: string;\r\n  }) => void;\r\n  language: string;\r\n  user: { id: string; name: string; role: string; buildingId?: string } | null;\r\n  buildings: { id: string; name: string; address: string }[];\r\n}) {\r\n  const [step, setStep] = useState(1);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [showCustomItemForm, setShowCustomItemForm] = useState(false);\r\n  const [newCustomItem, setNewCustomItem] = useState({ title: '', description: '', threshold: 'simple_majority' as DecisionThreshold });\r\n  const [formData, setFormData] = useState({\r\n    buildingId: user?.buildingId || (buildings.length > 0 ? buildings[0].id : ''),\r\n    buildingAddress: buildings.length > 0 ? buildings[0].address : '',\r\n    organizerType: 'management' as MeetingOrganizerType,\r\n    format: 'online' as MeetingFormat,\r\n    agendaItems: [] as AgendaItemType[],\r\n    customItems: [] as { title: string; description: string; threshold: DecisionThreshold }[],\r\n    location: '',\r\n    description: '', // Описание/обоснование собрания\r\n  });\r\n\r\n  const handleBuildingChange = (buildingId: string) => {\r\n    const building = buildings.find(b => b.id === buildingId);\r\n    setFormData({\r\n      ...formData,\r\n      buildingId,\r\n      buildingAddress: building?.address || '',\r\n    });\r\n  };\r\n\r\n  const handleAddAgendaItem = (type: AgendaItemType) => {\r\n    if (formData.agendaItems.includes(type)) {\r\n      setFormData({ ...formData, agendaItems: formData.agendaItems.filter(t => t !== type) });\r\n    } else {\r\n      setFormData({ ...formData, agendaItems: [...formData.agendaItems, type] });\r\n    }\r\n  };\r\n\r\n  const handleCreate = async () => {\r\n    if (!user || !formData.buildingId || isSubmitting) return;\r\n\r\n    setIsSubmitting(true);\r\n\r\n    const agendaItems = [\r\n      ...formData.agendaItems.map(type => ({\r\n        type,\r\n        title: language === 'ru' ? AGENDA_ITEM_TYPES[type].label : AGENDA_ITEM_TYPES[type].labelUz,\r\n        description: language === 'ru' ? AGENDA_ITEM_TYPES[type].description : AGENDA_ITEM_TYPES[type].descriptionUz,\r\n        threshold: AGENDA_ITEM_TYPES[type].defaultThreshold,\r\n        materials: [],\r\n      })),\r\n      ...formData.customItems.map(item => ({\r\n        type: 'other' as AgendaItemType,\r\n        title: item.title,\r\n        description: item.description,\r\n        threshold: item.threshold,\r\n        materials: [],\r\n      })),\r\n    ];\r\n\r\n    try {\r\n      await onCreate({\r\n        buildingId: formData.buildingId,\r\n        buildingAddress: formData.buildingAddress,\r\n        organizerType: formData.organizerType,\r\n        organizerId: user.id,\r\n        organizerName: user.name,\r\n        format: formData.format,\r\n        agendaItems,\r\n        location: formData.location || undefined,\r\n        description: formData.description || undefined,\r\n      });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const steps = [\r\n    { num: 1, label: language === 'ru' ? 'Тип' : 'Turi' },\r\n    { num: 2, label: language === 'ru' ? 'Повестка' : 'Kun tartibi' },\r\n    { num: 3, label: language === 'ru' ? 'Публикация' : 'Nashr' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        {/* Header */}\r\n        <div className=\"p-6 border-b border-gray-100 flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-xl font-bold\">\r\n              {language === 'ru' ? 'Созвать собрание' : 'Yig\\'ilish chaqirish'}\r\n            </h2>\r\n            <p className=\"text-sm text-gray-500\">\r\n              {language === 'ru' ? `Шаг ${step} из 3` : `Bosqich ${step} dan 3`}\r\n            </p>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Progress */}\r\n        <div className=\"px-6 py-4 border-b border-gray-100\">\r\n          <div className=\"flex items-center justify-between\">\r\n            {steps.map((s, i) => (\r\n              <div key={s.num} className=\"flex items-center\">\r\n                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\r\n                  step >= s.num ? 'bg-orange-400 text-gray-900' : 'bg-gray-200 text-gray-500'\r\n                }`}>\r\n                  {s.num}\r\n                </div>\r\n                <span className={`ml-2 text-sm ${step >= s.num ? 'text-gray-900' : 'text-gray-500'}`}>\r\n                  {s.label}\r\n                </span>\r\n                {i < steps.length - 1 && (\r\n                  <div className={`w-16 h-1 mx-4 rounded ${step > s.num ? 'bg-orange-400' : 'bg-gray-200'}`} />\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"p-6 space-y-6\">\r\n          {step === 1 && (\r\n            <>\r\n              {/* Building Selection */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n                  {language === 'ru' ? 'Выберите дом' : 'Uyni tanlang'}\r\n                </label>\r\n                {buildings.length === 0 ? (\r\n                  <div className=\"p-4 bg-yellow-50 border border-yellow-200 rounded-xl text-sm text-yellow-800\">\r\n                    {language === 'ru'\r\n                      ? 'Нет доступных домов. Сначала добавьте дом в системе.'\r\n                      : 'Mavjud uylar yo\\'q. Avval tizimda uy qo\\'shing.'}\r\n                  </div>\r\n                ) : (\r\n                  <select\r\n                    value={formData.buildingId}\r\n                    onChange={(e) => handleBuildingChange(e.target.value)}\r\n                    className=\"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400\"\r\n                  >\r\n                    {buildings.map((building) => (\r\n                      <option key={building.id} value={building.id}>\r\n                        {building.name} - {building.address}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                )}\r\n              </div>\r\n\r\n              {/* Organizer Type */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n                  {language === 'ru' ? 'Организатор' : 'Tashkilotchi'}\r\n                </label>\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <button\r\n                    onClick={() => setFormData({ ...formData, organizerType: 'management' })}\r\n                    className={`p-4 rounded-xl border-2 transition-colors ${\r\n                      formData.organizerType === 'management'\r\n                        ? 'border-orange-400 bg-yellow-50'\r\n                        : 'border-gray-200 hover:border-gray-300'\r\n                    }`}\r\n                  >\r\n                    <Building2 className=\"w-6 h-6 mb-2 mx-auto text-gray-600\" />\r\n                    <div className=\"text-sm font-medium\">\r\n                      {language === 'ru' ? 'Управляющая компания' : 'Boshqaruv kompaniyasi'}\r\n                    </div>\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setFormData({ ...formData, organizerType: 'resident' })}\r\n                    className={`p-4 rounded-xl border-2 transition-colors ${\r\n                      formData.organizerType === 'resident'\r\n                        ? 'border-orange-400 bg-yellow-50'\r\n                        : 'border-gray-200 hover:border-gray-300'\r\n                    }`}\r\n                  >\r\n                    <User className=\"w-6 h-6 mb-2 mx-auto text-gray-600\" />\r\n                    <div className=\"text-sm font-medium\">\r\n                      {language === 'ru' ? 'Житель (инициатива)' : 'Aholi (tashabbusi)'}\r\n                    </div>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Format */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n                  {language === 'ru' ? 'Формат проведения' : 'O\\'tkazish formati'}\r\n                </label>\r\n                <div className=\"grid grid-cols-3 gap-3\">\r\n                  {(['online', 'offline', 'hybrid'] as MeetingFormat[]).map((format) => (\r\n                    <button\r\n                      key={format}\r\n                      onClick={() => setFormData({ ...formData, format })}\r\n                      className={`p-3 rounded-xl border-2 transition-colors ${\r\n                        formData.format === format\r\n                          ? 'border-orange-400 bg-yellow-50'\r\n                          : 'border-gray-200 hover:border-gray-300'\r\n                      }`}\r\n                    >\r\n                      <div className=\"text-sm font-medium\">\r\n                        {format === 'online'\r\n                          ? (language === 'ru' ? 'Онлайн' : 'Onlayn')\r\n                          : format === 'offline'\r\n                          ? (language === 'ru' ? 'Очное' : 'Yuzma-yuz')\r\n                          : (language === 'ru' ? 'Смешанное' : 'Aralash')}\r\n                      </div>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Location (for offline/hybrid) */}\r\n              {formData.format !== 'online' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {language === 'ru' ? 'Место проведения' : 'O\\'tkazish joyi'}\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={formData.location}\r\n                    onChange={(e) => setFormData({ ...formData, location: e.target.value })}\r\n                    className=\"glass-input\"\r\n                    placeholder={language === 'ru' ? 'Например: Холл 1 этажа' : 'Masalan: 1-qavat zali'}\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              {/* Description/Justification */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {language === 'ru' ? 'Обоснование собрания' : 'Yig\\'ilish asoslashi'}\r\n                  <span className=\"text-gray-400 font-normal ml-1\">\r\n                    ({language === 'ru' ? 'необязательно' : 'ixtiyoriy'})\r\n                  </span>\r\n                </label>\r\n                <textarea\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                  className=\"glass-input min-h-[80px] resize-none\"\r\n                  placeholder={language === 'ru'\r\n                    ? 'Опишите причину созыва собрания и что планируется обсудить...'\r\n                    : 'Yig\\'ilish sababi va nimalar muhokama qilinishini tasvirlang...'}\r\n                  rows={3}\r\n                />\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {step === 2 && (\r\n            <>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n                  {language === 'ru' ? 'Выберите вопросы повестки' : 'Kun tartibi savollarini tanlang'}\r\n                </label>\r\n                <div className=\"space-y-2 max-h-96 overflow-y-auto\">\r\n                  {(Object.keys(AGENDA_ITEM_TYPES) as AgendaItemType[]).map((type) => {\r\n                    const item = AGENDA_ITEM_TYPES[type];\r\n                    const isSelected = formData.agendaItems.includes(type);\r\n\r\n                    return (\r\n                      <button\r\n                        key={type}\r\n                        onClick={() => handleAddAgendaItem(type)}\r\n                        className={`w-full p-4 rounded-xl border-2 text-left transition-colors ${\r\n                          isSelected\r\n                            ? 'border-orange-400 bg-yellow-50'\r\n                            : 'border-gray-200 hover:border-gray-300'\r\n                        }`}\r\n                      >\r\n                        <div className=\"flex items-start justify-between\">\r\n                          <div>\r\n                            <div className=\"font-medium\">\r\n                              {language === 'ru' ? item.label : item.labelUz}\r\n                            </div>\r\n                            <div className=\"text-sm text-gray-500 mt-1\">\r\n                              {language === 'ru' ? item.description : item.descriptionUz}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 mt-2\">\r\n                              <span className=\"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600\">\r\n                                {language === 'ru'\r\n                                  ? DECISION_THRESHOLD_LABELS[item.defaultThreshold].label\r\n                                  : DECISION_THRESHOLD_LABELS[item.defaultThreshold].labelUz}\r\n                              </span>\r\n                              {item.requiresMaterials && (\r\n                                <span className=\"text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-600\">\r\n                                  {language === 'ru' ? 'Нужны материалы' : 'Materiallar kerak'}\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                          <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${\r\n                            isSelected ? 'border-orange-400 bg-orange-400' : 'border-gray-300'\r\n                          }`}>\r\n                            {isSelected && <Check className=\"w-4 h-4 text-gray-900\" />}\r\n                          </div>\r\n                        </div>\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Custom Items Section */}\r\n              <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                  <label className=\"block text-sm font-medium text-gray-700\">\r\n                    {language === 'ru' ? 'Свои вопросы' : 'O\\'z savollaringiz'}\r\n                  </label>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowCustomItemForm(true)}\r\n                    className=\"text-sm text-orange-600 hover:text-orange-700 font-medium flex items-center gap-1\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4\" />\r\n                    {language === 'ru' ? 'Добавить вопрос' : 'Savol qo\\'shish'}\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Custom Items List */}\r\n                {formData.customItems.length > 0 && (\r\n                  <div className=\"space-y-2 mb-4\">\r\n                    {formData.customItems.map((item, index) => (\r\n                      <div key={index} className=\"p-3 rounded-xl border-2 border-orange-400 bg-yellow-50\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"font-medium\">{item.title}</div>\r\n                            {item.description && (\r\n                              <div className=\"text-sm text-gray-500 mt-1\">{item.description}</div>\r\n                            )}\r\n                            <span className=\"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600 mt-2 inline-block\">\r\n                              {language === 'ru'\r\n                                ? DECISION_THRESHOLD_LABELS[item.threshold].label\r\n                                : DECISION_THRESHOLD_LABELS[item.threshold].labelUz}\r\n                            </span>\r\n                          </div>\r\n                          <button\r\n                            onClick={() => setFormData({\r\n                              ...formData,\r\n                              customItems: formData.customItems.filter((_, i) => i !== index)\r\n                            })}\r\n                            className=\"p-1 text-red-500 hover:bg-red-50 rounded\"\r\n                          >\r\n                            <X className=\"w-4 h-4\" />\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Add Custom Item Form */}\r\n                {showCustomItemForm && (\r\n                  <div className=\"p-4 rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 space-y-3\">\r\n                    <input\r\n                      type=\"text\"\r\n                      value={newCustomItem.title}\r\n                      onChange={(e) => setNewCustomItem({ ...newCustomItem, title: e.target.value })}\r\n                      className=\"glass-input\"\r\n                      placeholder={language === 'ru' ? 'Название вопроса *' : 'Savol nomi *'}\r\n                    />\r\n                    <textarea\r\n                      value={newCustomItem.description}\r\n                      onChange={(e) => setNewCustomItem({ ...newCustomItem, description: e.target.value })}\r\n                      className=\"glass-input min-h-[60px] resize-none\"\r\n                      placeholder={language === 'ru' ? 'Описание (необязательно)' : 'Tavsif (ixtiyoriy)'}\r\n                      rows={2}\r\n                    />\r\n                    <div>\r\n                      <label className=\"block text-xs text-gray-500 mb-1\">\r\n                        {language === 'ru' ? 'Порог принятия' : 'Qabul qilish chegarasi'}\r\n                      </label>\r\n                      <select\r\n                        value={newCustomItem.threshold}\r\n                        onChange={(e) => setNewCustomItem({ ...newCustomItem, threshold: e.target.value as DecisionThreshold })}\r\n                        className=\"glass-input text-sm\"\r\n                      >\r\n                        {(Object.keys(DECISION_THRESHOLD_LABELS) as DecisionThreshold[]).map((t) => (\r\n                          <option key={t} value={t}>\r\n                            {language === 'ru' ? DECISION_THRESHOLD_LABELS[t].label : DECISION_THRESHOLD_LABELS[t].labelUz}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => {\r\n                          if (newCustomItem.title.trim()) {\r\n                            setFormData({\r\n                              ...formData,\r\n                              customItems: [...formData.customItems, { ...newCustomItem }]\r\n                            });\r\n                            setNewCustomItem({ title: '', description: '', threshold: 'simple_majority' });\r\n                            setShowCustomItemForm(false);\r\n                          }\r\n                        }}\r\n                        disabled={!newCustomItem.title.trim()}\r\n                        className=\"flex-1 py-2 px-4 bg-orange-400 hover:bg-orange-500 text-gray-900 rounded-lg font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        {language === 'ru' ? 'Добавить' : 'Qo\\'shish'}\r\n                      </button>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => {\r\n                          setShowCustomItemForm(false);\r\n                          setNewCustomItem({ title: '', description: '', threshold: 'simple_majority' });\r\n                        }}\r\n                        className=\"py-2 px-4 bg-gray-200 hover:bg-gray-300 rounded-lg font-medium text-sm\"\r\n                      >\r\n                        {language === 'ru' ? 'Отмена' : 'Bekor qilish'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {formData.agendaItems.length === 0 && formData.customItems.length === 0 && (\r\n                <p className=\"text-sm text-red-500\">\r\n                  {language === 'ru' ? 'Выберите хотя бы один вопрос или добавьте свой' : 'Kamida bitta savol tanlang yoki o\\'zingiznikini qo\\'shing'}\r\n                </p>\r\n              )}\r\n            </>\r\n          )}\r\n\r\n          {step === 3 && (\r\n            <>\r\n              {/* Summary */}\r\n              <div className=\"space-y-4\">\r\n                <div className=\"p-4 rounded-xl bg-gray-50\">\r\n                  <h3 className=\"font-medium mb-3\">\r\n                    {language === 'ru' ? 'Сводка' : 'Xulosa'}\r\n                  </h3>\r\n\r\n                  <div className=\"space-y-2 text-sm\">\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-500\">{language === 'ru' ? 'Формат:' : 'Format:'}</span>\r\n                      <span className=\"font-medium\">\r\n                        {formData.format === 'online'\r\n                          ? (language === 'ru' ? 'Онлайн' : 'Onlayn')\r\n                          : formData.format === 'offline'\r\n                          ? (language === 'ru' ? 'Очное' : 'Yuzma-yuz')\r\n                          : (language === 'ru' ? 'Смешанное' : 'Aralash')}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-500\">{language === 'ru' ? 'Дом:' : 'Uy:'}</span>\r\n                      <span className=\"font-medium\">\r\n                        {buildings.find(b => b.id === formData.buildingId)?.name || formData.buildingAddress}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-500\">{language === 'ru' ? 'Организатор:' : 'Tashkilotchi:'}</span>\r\n                      <span className=\"font-medium\">\r\n                        {formData.organizerType === 'management'\r\n                          ? (language === 'ru' ? 'УК' : 'UK')\r\n                          : (language === 'ru' ? 'Житель' : 'Aholi')}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-500\">{language === 'ru' ? 'Вопросов:' : 'Savollar:'}</span>\r\n                      <span className=\"font-medium\">{formData.agendaItems.length}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-4 rounded-xl bg-blue-50 border border-blue-200\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <AlertCircle className=\"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5\" />\r\n                    <div className=\"text-sm text-blue-700\">\r\n                      {language === 'ru'\r\n                        ? 'После публикации жильцам будет отправлено уведомление. Они смогут проголосовать за удобную дату проведения собрания.'\r\n                        : 'Nashrdan so\\'ng aholiga bildirishnoma yuboriladi. Ular yig\\'ilish uchun qulay sanani tanlashlari mumkin bo\\'ladi.'}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-4 rounded-xl bg-yellow-50 border border-yellow-200\">\r\n                  <h4 className=\"font-medium mb-2\">\r\n                    {language === 'ru' ? 'Повестка дня:' : 'Kun tartibi:'}\r\n                  </h4>\r\n                  <ol className=\"list-decimal list-inside space-y-1 text-sm\">\r\n                    {formData.agendaItems.map((type) => (\r\n                      <li key={type}>\r\n                        {language === 'ru'\r\n                          ? AGENDA_ITEM_TYPES[type].label\r\n                          : AGENDA_ITEM_TYPES[type].labelUz}\r\n                      </li>\r\n                    ))}\r\n                    {formData.customItems.map((item, index) => (\r\n                      <li key={`custom-${index}`} className=\"text-blue-700\">\r\n                        {item.title}\r\n                        <span className=\"text-xs text-gray-500 ml-1\">\r\n                          ({language === 'ru' ? 'свой вопрос' : 'o\\'z savoli'})\r\n                        </span>\r\n                      </li>\r\n                    ))}\r\n                  </ol>\r\n                </div>\r\n\r\n                {/* Description preview */}\r\n                {formData.description && (\r\n                  <div className=\"p-4 rounded-xl bg-gray-50 border border-gray-200\">\r\n                    <h4 className=\"font-medium mb-2\">\r\n                      {language === 'ru' ? 'Обоснование:' : 'Asoslash:'}\r\n                    </h4>\r\n                    <p className=\"text-sm text-gray-600\">{formData.description}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"p-6 border-t border-gray-100 flex gap-3\">\r\n          {step > 1 && (\r\n            <button\r\n              onClick={() => setStep(step - 1)}\r\n              disabled={isSubmitting}\r\n              className=\"flex-1 py-3 rounded-xl font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors disabled:opacity-50\"\r\n            >\r\n              {language === 'ru' ? 'Назад' : 'Orqaga'}\r\n            </button>\r\n          )}\r\n          {step < 3 ? (\r\n            <button\r\n              onClick={() => setStep(step + 1)}\r\n              disabled={(step === 1 && !formData.buildingId) || (step === 2 && formData.agendaItems.length === 0 && formData.customItems.length === 0)}\r\n              className=\"flex-1 py-3 rounded-xl font-medium bg-orange-400 text-gray-900 hover:bg-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {language === 'ru' ? 'Далее' : 'Keyingi'}\r\n            </button>\r\n          ) : (\r\n            <button\r\n              onClick={handleCreate}\r\n              disabled={isSubmitting || !formData.buildingId}\r\n              className=\"flex-1 py-3 rounded-xl font-medium bg-orange-400 text-gray-900 hover:bg-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {isSubmitting\r\n                ? (language === 'ru' ? 'Создание...' : 'Yaratilmoqda...')\r\n                : (language === 'ru' ? 'Опубликовать' : 'Nashr qilish')}\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Meeting Details Modal\r\nfunction MeetingDetailsModal({\r\n  meeting,\r\n  onClose,\r\n  language,\r\n  calculateResult,\r\n  calculateQuorum,\r\n}: {\r\n  meeting: Meeting;\r\n  onClose: () => void;\r\n  language: string;\r\n  calculateResult: (meetingId: string, agendaItemId: string) => {\r\n    votesFor: number;\r\n    votesAgainst: number;\r\n    votesAbstain: number;\r\n    totalVotes: number;\r\n    percentFor: number;\r\n    isApproved: boolean;\r\n    thresholdMet: boolean;\r\n  };\r\n  calculateQuorum: () => { participated: number; total: number; percent: number; quorumReached: boolean };\r\n}) {\r\n  const quorum = calculateQuorum();\r\n  const [downloadingProtocol, setDownloadingProtocol] = useState(false);\r\n\r\n  // Download protocol as DOCX file (official format)\r\n  const handleDownloadProtocol = async () => {\r\n    setDownloadingProtocol(true);\r\n    try {\r\n      // Fetch protocol data from backend\r\n      const response = await fetch(`/api/meetings/${meeting.id}/protocol/data`);\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch protocol data');\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Generate DOCX using the protocol generator\r\n      await generateProtocolDocx({\r\n        meeting: {\r\n          ...data.meeting,\r\n          buildingAddress: meeting.buildingAddress || data.meeting.building_address,\r\n        },\r\n        agendaItems: data.agendaItems,\r\n        voteRecords: data.voteRecords,\r\n        votesByItem: data.votesByItem,\r\n        protocolHash: data.protocolHash,\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to download protocol:', error);\r\n      alert(language === 'ru' ? 'Ошибка при скачивании протокола' : 'Bayonnomani yuklashda xato');\r\n    } finally {\r\n      setDownloadingProtocol(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        {/* Header */}\r\n        <div className=\"p-6 border-b border-gray-100 flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-xl font-bold\">\r\n              {language === 'ru' ? `Собрание #${meeting.number}` : `Yig'ilish #${meeting.number}`}\r\n            </h2>\r\n            <p className=\"text-sm text-gray-500\">{meeting.buildingAddress}</p>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            {/* Download protocol button - show for completed meetings */}\r\n            {['protocol_generated', 'protocol_approved'].includes(meeting.status) && (\r\n              <button\r\n                onClick={handleDownloadProtocol}\r\n                disabled={downloadingProtocol}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-teal-500 text-white rounded-xl hover:bg-teal-600 transition-colors disabled:opacity-50\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n                {downloadingProtocol\r\n                  ? (language === 'ru' ? 'Загрузка...' : 'Yuklanmoqda...')\r\n                  : (language === 'ru' ? 'Скачать протокол' : 'Bayonnomani yuklab olish')}\r\n              </button>\r\n            )}\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Status & Quorum */}\r\n          <div className=\"flex items-center gap-4 flex-wrap\">\r\n            <span className={`px-3 py-1 rounded-lg text-sm font-medium ${\r\n              MEETING_STATUS_LABELS[meeting.status]?.color === 'green' ? 'bg-green-100 text-green-700' :\r\n              MEETING_STATUS_LABELS[meeting.status]?.color === 'blue' ? 'bg-blue-100 text-blue-700' :\r\n              MEETING_STATUS_LABELS[meeting.status]?.color === 'yellow' ? 'bg-yellow-100 text-orange-700' :\r\n              'bg-gray-100 text-gray-700'\r\n            }`}>\r\n              {language === 'ru'\r\n                ? MEETING_STATUS_LABELS[meeting.status]?.label\r\n                : MEETING_STATUS_LABELS[meeting.status]?.labelUz}\r\n            </span>\r\n\r\n            {meeting.status !== 'draft' && meeting.status !== 'pending_moderation' && (\r\n              <div className=\"flex items-center gap-2\">\r\n                <Users className=\"w-4 h-4 text-gray-400\" />\r\n                <span className=\"text-sm\">\r\n                  {quorum.participated}/{quorum.total} ({quorum.percent.toFixed(1)}%)\r\n                </span>\r\n                <span className={`text-xs px-2 py-0.5 rounded-full font-medium ${\r\n                  quorum.quorumReached ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\r\n                }`}>\r\n                  {quorum.quorumReached\r\n                    ? (language === 'ru' ? 'Кворум' : 'Kvorum')\r\n                    : (language === 'ru' ? 'Нет кворума' : 'Kvorum yo\\'q')}\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Confirmed Date */}\r\n          {meeting.confirmedDateTime && (\r\n            <div className=\"flex items-center gap-2 text-gray-600\">\r\n              <Calendar className=\"w-5 h-5\" />\r\n              <span>\r\n                {new Date(meeting.confirmedDateTime).toLocaleDateString(\r\n                  language === 'ru' ? 'ru-RU' : 'uz-UZ',\r\n                  { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' }\r\n                )}\r\n              </span>\r\n            </div>\r\n          )}\r\n\r\n          {/* Agenda Items with Results */}\r\n          <div>\r\n            <h3 className=\"font-medium mb-3\">\r\n              {language === 'ru' ? 'Повестка дня' : 'Kun tartibi'}\r\n            </h3>\r\n            <div className=\"space-y-4\">\r\n              {meeting.agendaItems.map((item, index) => {\r\n                const result = calculateResult(meeting.id, item.id);\r\n\r\n                return (\r\n                  <div key={item.id} className=\"p-4 rounded-xl bg-gray-50 border border-gray-200\">\r\n                    <div className=\"flex items-start justify-between gap-4\">\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"font-medium\">\r\n                          {index + 1}. {item.title}\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 mt-1\">{item.description}</p>\r\n\r\n                        {/* Voting results */}\r\n                        {['voting_open', 'voting_closed', 'results_published', 'protocol_generated', 'protocol_approved'].includes(meeting.status) && (\r\n                          <div className=\"mt-3 pt-3 border-t border-gray-200\">\r\n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <ThumbsUp className=\"w-4 h-4 text-green-500\" />\r\n                                <span>{result.votesFor} ({result.percentFor.toFixed(0)}%)</span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <ThumbsDown className=\"w-4 h-4 text-red-500\" />\r\n                                <span>{result.votesAgainst}</span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <Minus className=\"w-4 h-4 text-gray-400\" />\r\n                                <span>{result.votesAbstain}</span>\r\n                              </div>\r\n                            </div>\r\n\r\n                            {/* Progress bar */}\r\n                            <div className=\"mt-2 h-2 bg-gray-200 rounded-full overflow-hidden\">\r\n                              <div\r\n                                className={`h-full ${result.thresholdMet ? 'bg-green-500' : 'bg-red-500'}`}\r\n                                style={{ width: `${result.percentFor}%` }}\r\n                              />\r\n                            </div>\r\n\r\n                            {/* Threshold line */}\r\n                            <div className=\"flex items-center justify-between mt-1 text-xs text-gray-500\">\r\n                              <span>0%</span>\r\n                              <span>\r\n                                {language === 'ru' ? 'Порог:' : 'Chegara:'} {DECISION_THRESHOLD_LABELS[item.threshold].percent}%\r\n                              </span>\r\n                              <span>100%</span>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Result badge */}\r\n                      {item.isApproved !== undefined && (\r\n                        <span className={`px-2 py-1 rounded-lg text-xs font-medium ${\r\n                          item.isApproved ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\r\n                        }`}>\r\n                          {item.isApproved\r\n                            ? (language === 'ru' ? 'Принято' : 'Qabul')\r\n                            : (language === 'ru' ? 'Не принято' : 'Rad')}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["UK_COMPANY","downloadBlob","blob","fileName","url","isIOS","isSafari","link","MONTHS_RU","formatDateRu","dateStr","date","formatTimeRu","escapeXml","str","calculateVoteResult","item","_totalArea","votedArea","dataUrlToUint8Array","dataUrl","base64","binaryString","bytes","i","generateUKQRCode","ukData","QRCode","generateVoterQRCode","voter","meetingNumber","buildingAddress","voterData","generateVotingTableXml","result","generateVoterListTableXml","voteRecords","voterImageIds","tableXml","record","idx","votedDate","choiceText","imageId","qrImageXml","generateVotesByItemTableXml","_agendaItem","votes","hasComments","v","commentText","generateProtocolDocx","data","meeting","agendaItems","votesByItem","address","meetingDate","meetingTime","location","format","ukQrCodeDataUrl","voterQRCodes","qrCode","agendaItemsXml","itemNumber","isApproved","itemVotes","documentXml","zip","PizZip","ukImageBytes","voterId","imageBytes","relsContent","MeetingsPage","user","useAuthStore","t","language","useLanguageStore","buildings","fetchBuildings","useCRMStore","meetings","fetchMeetings","createMeeting","approveMeeting","rejectMeeting","confirmSchedule","openVoting","closeVoting","publishResults","generateProtocol","approveProtocol","deleteMeeting","calculateAgendaItemResult","calculateMeetingQuorum","useMeetingStore","useEffect","activeTab","setActiveTab","useState","showCreateModal","setShowCreateModal","selectedMeeting","setSelectedMeeting","showDetailsModal","setShowDetailsModal","filteredMeetings","useMemo","m","getStatusColor","status","MEETING_STATUS_LABELS","getStatusLabel","labels","formatDate","handleViewDetails","handleDelete","id","tabs","jsxs","jsx","Plus","tab","Users","MeetingCard","reason","CreateMeetingWizard","b","MeetingDetailsModal","onViewDetails","onApprove","onReject","onConfirmSchedule","onOpenVoting","onCloseVoting","onPublishResults","onGenerateProtocol","onApproveProtocol","onDelete","calculateQuorum","quorum","statusColor","colorClasses","Building2","Calendar","User","FileText","option","totalVotes","sum","opt","voteCount","percent","isLeading","o","Eye","Fragment","Check","X","Trash2","CalendarCheck","Play","Square","BarChart3","Shield","Download","onClose","onCreate","step","setStep","isSubmitting","setIsSubmitting","showCustomItemForm","setShowCustomItemForm","newCustomItem","setNewCustomItem","formData","setFormData","handleBuildingChange","buildingId","building","handleAddAgendaItem","type","handleCreate","AGENDA_ITEM_TYPES","steps","s","e","isSelected","DECISION_THRESHOLD_LABELS","index","_","AlertCircle","calculateResult","downloadingProtocol","setDownloadingProtocol","handleDownloadProtocol","response","ThumbsUp","ThumbsDown","Minus"],"mappings":"qeAkEA,MAAMA,EAAa,CACjB,KAAM,aACN,QAAS,0DACT,KAAM,sCACN,QAAS,uBACT,IAAK,YACL,KAAM,QACN,IAAK,OACP,EAGA,SAASC,GAAaC,EAAYC,EAAwB,CACxD,MAAMC,EAAM,IAAI,gBAAgBF,CAAI,EAC9BG,EAAQ,mBAAmB,KAAK,UAAU,SAAS,EACnDC,EAAW,iCAAiC,KAAK,UAAU,SAAS,EAE1E,GAAID,GAASC,EACO,OAAO,KAAKF,EAAK,QAAQ,IAEzC,OAAO,SAAS,KAAOA,GAEzB,WAAW,IAAM,IAAI,gBAAgBA,CAAG,EAAG,GAAK,MAC3C,CACL,MAAMG,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOH,EACZG,EAAK,SAAWJ,EAChBI,EAAK,MAAM,QAAU,OACrB,SAAS,KAAK,YAAYA,CAAI,EAC9BA,EAAK,MAAA,EACL,SAAS,KAAK,YAAYA,CAAI,EAC9B,WAAW,IAAM,IAAI,gBAAgBH,CAAG,EAAG,GAAG,CAChD,CACF,CAEA,MAAMI,GAAoC,CACxC,EAAG,SAAU,EAAG,UAAW,EAAG,QAAS,EAAG,SAAU,EAAG,MAAO,EAAG,OACjE,EAAG,OAAQ,EAAG,UAAW,EAAG,WAAY,EAAG,UAAW,GAAI,SAAU,GAAI,SAC1E,EAEA,SAASC,GAAaC,EAAqC,CACzD,GAAI,CAACA,EAAS,MAAO,MACrB,MAAMC,EAAO,IAAI,KAAKD,CAAO,EAC7B,MAAO,GAAGC,EAAK,QAAA,CAAS,IAAIH,GAAUG,EAAK,SAAA,CAAU,CAAC,IAAIA,EAAK,aAAa,EAC9E,CAEA,SAASC,GAAaF,EAAqC,CACzD,GAAI,CAACA,EAAS,MAAO,MACrB,MAAMC,EAAO,IAAI,KAAKD,CAAO,EAC7B,MAAO,GAAGC,EAAK,SAAA,EAAW,WAAW,SAAS,EAAG,GAAG,CAAC,IAAIA,EAAK,aAAa,SAAA,EAAW,SAAS,EAAG,GAAG,CAAC,EACxG,CAEA,SAASE,EAAUC,EAAqB,CACtC,OAAOA,EACJ,QAAQ,KAAM,OAAO,EACrB,QAAQ,KAAM,MAAM,EACpB,QAAQ,KAAM,MAAM,EACpB,QAAQ,KAAM,QAAQ,EACtB,QAAQ,KAAM,QAAQ,CAC3B,CAGA,SAASC,GAAoBC,EAAkBC,EAAgC,CAC7E,MAAMC,EAAYF,EAAK,eAAiBA,EAAK,mBAAqBA,EAAK,mBACvE,MAAO,CACL,SAAUA,EAAK,eACf,aAAcA,EAAK,mBACnB,aAAcA,EAAK,mBACnB,WAAYE,EAAY,EAAKF,EAAK,eAAiBE,EAAa,IAAM,EACtE,eAAgBA,EAAY,EAAKF,EAAK,mBAAqBE,EAAa,IAAM,EAC9E,eAAgBA,EAAY,EAAKF,EAAK,mBAAqBE,EAAa,IAAM,CAAA,CAElF,CAGA,SAASC,EAAoBC,EAA6B,CACxD,MAAMC,EAASD,EAAQ,MAAM,GAAG,EAAE,CAAC,EAC7BE,EAAe,KAAKD,CAAM,EAC1BE,EAAQ,IAAI,WAAWD,EAAa,MAAM,EAChD,QAASE,EAAI,EAAGA,EAAIF,EAAa,OAAQE,IACvCD,EAAMC,CAAC,EAAIF,EAAa,WAAWE,CAAC,EAEtC,OAAOD,CACT,CAGA,eAAeE,IAAoC,CACjD,MAAMC,EAAS,CACb,aAAa1B,EAAW,IAAI,GAC5B,UAAUA,EAAW,OAAO,GAC5B,SAASA,EAAW,IAAI,GACxB,QAAQA,EAAW,OAAO,GAC1B,QAAQA,EAAW,GAAG,GACtB,SAASA,EAAW,IAAI,GACxB,QAAQA,EAAW,GAAG,EAAA,EACtB,KAAK;AAAA,CAAI,EAEX,OAAO,MAAM2B,EAAO,UAAUD,EAAQ,CACpC,MAAO,IACP,OAAQ,EACR,MAAO,CAAE,KAAM,UAAW,MAAO,SAAA,CAAU,CAC5C,CACH,CAGA,eAAeE,GAAoBC,EAAmBC,EAAuBC,EAA0C,CACrH,MAAMC,EAAY,CAChB,sBACA,aAAaF,CAAa,GAC1B,QAAQD,EAAM,UAAU,GACxB,aAAaA,EAAM,kBAAoB,GAAG,GAC1C,YAAYA,EAAM,aAAa,QAAQ,CAAC,GAAK,GAAG,QAChD,UAAUA,EAAM,SAAW,MAAQ,KAAOA,EAAM,SAAW,UAAY,SAAW,aAAa,GAC/F,SAAS,IAAI,KAAKA,EAAM,QAAQ,EAAE,eAAe,OAAO,CAAC,GACzD,UAAUE,CAAe,EAAA,EACzB,KAAK;AAAA,CAAI,EAEX,OAAO,MAAMJ,EAAO,UAAUK,EAAW,CACvC,MAAO,GACP,OAAQ,EACR,MAAO,CAAE,KAAM,UAAW,MAAO,SAAA,CAAU,CAC5C,CACH,CAGA,SAASC,EAAuBC,EAA4B,CAC1D,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAoC0CA,EAAO,SAAS,QAAQ,CAAC,CAAC;AAAA;AAAA,oDAEzBA,EAAO,WAAW,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,mDAI7BA,EAAO,aAAa,QAAQ,CAAC,CAAC;AAAA;AAAA,oDAE7BA,EAAO,eAAe,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,mDAIjCA,EAAO,aAAa,QAAQ,CAAC,CAAC;AAAA;AAAA,oDAE7BA,EAAO,eAAe,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA,SAIpF,CAGA,SAASC,GAA0BC,EAA2BC,EAA4C,CACxG,IAAIC,EAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAqDf,OAAAF,EAAY,QAAQ,CAACG,EAAQC,IAAQ,CACnC,MAAMC,EAAY,IAAI,KAAKF,EAAO,QAAQ,EACpCG,EAAaH,EAAO,SAAW,MAAQ,KAAOA,EAAO,SAAW,UAAY,SAAW,WACvFI,EAAUN,EAAc,IAAIE,EAAO,QAAQ,EAG3CK,EAAaD,EAAU,0MAA0M,IAAOH,CAAG,wBAAwBA,CAAG,2RAA2RA,CAAG,sEAAsEG,CAAO,oVAAsV,0BAE78BL,GAAY;AAAA;AAAA;AAAA;AAAA,mDAImCE,EAAM,CAAC;AAAA;AAAA;AAAA;AAAA,mDAIP3B,EAAU0B,EAAO,UAAU,CAAC;AAAA;AAAA;AAAA;AAAA,mDAI5BA,EAAO,kBAAoB,GAAG;AAAA;AAAA;AAAA;AAAA,mDAI9BA,EAAO,aAAa,QAAQ,CAAC,GAAK,GAAG;AAAA;AAAA;AAAA;AAAA,mDAIrCE,EAAU,mBAAmB,OAAO,CAAC;AAAA;AAAA;AAAA;AAAA,mDAIrCC,CAAU;AAAA;AAAA;AAAA,kDAGXE,CAAU;AAAA;AAAA,UAG1D,CAAC,EAEDN,GAAY,WACLA,CACT,CAGA,SAASO,GAA4BC,EAAyBC,EAA6B,CACzF,GAAI,CAACA,GAASA,EAAM,SAAW,EAC7B,MAAO,GAIT,MAAMC,EAAcD,EAAM,KAAKE,GAAKA,EAAE,SAAWA,EAAE,QAAQ,OAAO,OAAS,CAAC,EAE5E,IAAIX,EAAW;AAAA;AAAA;AAAA;AAAA;AAAA,mBAKEU,EAAc,QAAU,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAa3BA,EAAc,OAAS,MAAM;AAAA;AAAA;AAAA;AAAA,MAI7CA,EAAc,0BAA4B,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAOlBA,EAAc,OAAS,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAgBvDA,EAAc;AAAA;AAAA;AAAA,aAGL,EAAE;AAAA,WAGf,OAAAD,EAAM,QAAQ,CAACE,EAAGT,IAAQ,CACxB,MAAME,EAAaO,EAAE,SAAW,MAAQ,KAAOA,EAAE,SAAW,UAAY,SAAW,cAC7EC,EAAcD,EAAE,SAAS,KAAA,GAAU,GACzCX,GAAY;AAAA;AAAA;AAAA;AAAA,mDAImCE,EAAM,CAAC;AAAA;AAAA,gCAE1BQ,EAAc,OAAS,MAAM;AAAA;AAAA,mDAEVnC,EAAUoC,EAAE,UAAU,CAAC;AAAA;AAAA;AAAA;AAAA,mDAIvBA,EAAE,kBAAoB,GAAG;AAAA;AAAA;AAAA;AAAA,mDAIzBA,EAAE,aAAa,QAAQ,CAAC,GAAK,GAAG;AAAA;AAAA;AAAA;AAAA,mDAIhCP,CAAU;AAAA;AAAA,MAEvDM,EAAc;AAAA;AAAA,yDAEqCnC,EAAUqC,CAAW,CAAC;AAAA,aAChE,EAAE;AAAA,UAEf,CAAC,EAEDZ,GAAY,WACLA,CACT,CAEA,eAAsBa,GAAqBC,EAAmC,CAC5E,KAAM,CAAE,QAAAC,EAAS,YAAAC,EAAa,YAAAlB,EAAa,YAAAmB,GAAgBH,EAErDI,EAAUH,EAAQ,iBAAmBA,EAAQ,kBAAoB,kBACjEI,EAAchD,GAAa4C,EAAQ,qBAAuBA,EAAQ,gBAAgB,EAClFK,EAAc9C,GAAayC,EAAQ,qBAAuBA,EAAQ,gBAAgB,EAClFM,EAAWN,EAAQ,UAAYG,EAC/BI,EAASP,EAAQ,SAAW,SAAW,UAAYA,EAAQ,SAAW,SAAW,eAAiB,QAGlGQ,EAAkB,MAAMpC,GAAA,EAGxBqC,MAAmB,IACnBzB,MAAoB,IAE1B,QAASb,EAAI,EAAGA,EAAIY,EAAY,OAAQZ,IAAK,CAC3C,MAAMK,EAAQO,EAAYZ,CAAC,EACrBuC,EAAS,MAAMnC,GAAoBC,EAAOwB,EAAQ,OAAQG,CAAO,EACvEM,EAAa,IAAIjC,EAAM,SAAUkC,CAAM,EACvC1B,EAAc,IAAIR,EAAM,SAAU,MAAM,IAAML,CAAC,EAAE,CACnD,CAGA,IAAIwC,EAAiB,GAGrBA,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uHAMmGX,EAAQ,gBAAkB,kBAAkB;AAAA;AAAA;AAAA,EAGjKpB,EAAuB,CACvB,SAAUoB,EAAQ,WAClB,aAAc,EACd,aAAc,EACd,WAAY,IACZ,eAAgB,EAChB,eAAgB,CAAA,CACjB,CAAC;AAAA;AAAA;AAAA,EAMAC,EAAY,QAAQ,CAACtC,EAAMwB,IAAQ,CACjC,MAAMN,EAASnB,GAAoBC,EAAMqC,EAAQ,UAAU,EACrDY,EAAazB,EAAM,EACnB0B,EAAahC,EAAO,WAAa,GACjCiC,EAAYZ,EAAYvC,EAAK,EAAE,GAAK,CAAA,EAE1CgD,GAAkB;AAAA;AAAA,mDAE6BC,CAAU,KAAKpD,EAAUG,EAAK,KAAK,CAAC;AAAA,EACrFA,EAAK,YAAc;AAAA,sDACiCH,EAAUG,EAAK,WAAW,CAAC,qBAAuB,EAAE;AAAA;AAAA;AAAA,EAGxGiB,EAAuBC,CAAM,CAAC;AAAA,EAC9BW,GAA4B7B,EAAMmD,CAAS,CAAC;AAAA;AAAA,4DAEcD,EAAa,mBAAqB,qBAAqB;AAAA,CAEjH,CAAC,EAMD,MAAME,EAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kEAa4Cf,EAAQ,MAAM,QAAQ,KAAA,EAAO,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uDASrDxC,EAAU2C,CAAO,CAAC;AAAA;AAAA;AAAA,sEAGHI,CAAM;AAAA;AAAA;AAAA;AAAA;AAAA,iDAK3BH,CAAW;AAAA;AAAA;AAAA;AAAA,iDAIXC,CAAW;AAAA;AAAA;AAAA;AAAA,iDAIX7C,EAAU8C,CAAQ,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iFAOaN,EAAQ,WAAW,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA,kGAGZA,EAAQ,WAAW,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA,kEAG7DA,EAAQ,sBAAsB,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA,6EAG7BA,EAAQ,kBAAkB,OAAOA,EAAQ,oBAAoB;AAAA;AAAA,iEAEzEA,EAAQ,eAAiB,SAAW,QAAQ;AAAA,0DACnDA,EAAQ,eAAiB,SAAW,QAAQ,0BAA0BA,EAAQ,eAAiB,UAAY,aAAa,eAAeA,EAAQ,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQjNC,EAAY,IAAI,CAACtC,EAAMwB,IAAQ;AAAA;AAAA,iDAEYA,EAAM,CAAC,KAAK3B,EAAUG,EAAK,KAAK,CAAC,oBAAoB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,MAG1GgD,CAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDAO6BhE,EAAW,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qEAUKqD,EAAQ,MAAM,QAAQ,KAAA,EAAO,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOzGlB,GAA0BC,EAAaC,CAAa,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0EAOe,IAAI,KAAA,EAAO,eAAe,OAAO,CAAC;AAAA;AAAA,MAEtGe,EAAK,aAAe;AAAA,sEAC4CA,EAAK,YAAY,qBAAuB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAUxGiB,EAAM,IAAIC,GAGVC,EAAepD,EAAoB0C,CAAe,EACxDQ,EAAI,KAAK,uBAAwBE,CAAY,EAG7C,SAAW,CAACC,EAAST,CAAM,IAAKD,EAAc,CAC5C,MAAMW,EAAatD,EAAoB4C,CAAM,EACvCvB,EAAMJ,EAAY,UAAUa,GAAKA,EAAE,WAAauB,CAAO,EAC7DH,EAAI,KAAK,uBAAuB7B,CAAG,OAAQiC,CAAU,CACvD,CAGA,IAAIC,EAAc;AAAA;AAAA,yIAIlB,QAASlD,EAAI,EAAGA,EAAIY,EAAY,OAAQZ,IACtCkD,GAAe;AAAA,yBACM,IAAMlD,CAAC,6GAA6GA,CAAC,UAE5IkD,GAAe;AAAA,kBAIfL,EAAI,KAAK,sBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMzB,EAEPA,EAAI,KAAK,cAAe;AAAA;AAAA;AAAA,iBAGT,EAEfA,EAAI,KAAK,+BAAgCK,CAAW,EACpDL,EAAI,KAAK,oBAAqBD,CAAW,EAGzC,MAAMlE,EAAOmE,EAAI,SAAS,CACxB,KAAM,OACN,SAAU,yEAAA,CACX,EAGKlE,EAAW,YAAYkD,EAAQ,MAAM,IAAIG,EAAQ,QAAQ,wBAAyB,GAAG,CAAC,QAC5FvD,GAAaC,EAAMC,CAAQ,CAC7B,CCtpBO,SAASwE,IAAe,CAC7B,KAAM,CAAE,KAAAC,CAAA,EAASC,GAAA,EACX,CAAE,EAAAC,EAAG,SAAAC,CAAA,EAAaC,GAAA,EAClB,CAAE,UAAAC,EAAW,eAAAC,CAAA,EAAmBC,GAAA,EAChC,CACJ,SAAAC,EACA,cAAAC,EACA,cAAAC,EACA,eAAAC,EACA,cAAAC,EACA,gBAAAC,EACA,WAAAC,EACA,YAAAC,EACA,eAAAC,EACA,iBAAAC,EACA,gBAAAC,EACA,cAAAC,EACA,0BAAAC,EACA,uBAAAC,CAAA,EACEC,GAAA,EAGJC,EAAAA,UAAU,IAAM,CACdd,EAAA,EACAH,EAAA,CACF,EAAG,CAACG,EAAeH,CAAc,CAAC,EAElC,KAAM,CAACkB,EAAWC,CAAY,EAAIC,EAAAA,SAAqD,KAAK,EACtF,CAACC,EAAiBC,CAAkB,EAAIF,EAAAA,SAAS,EAAK,EACtD,CAACG,EAAiBC,CAAkB,EAAIJ,EAAAA,SAAyB,IAAI,EACrE,CAACK,EAAkBC,CAAmB,EAAIN,EAAAA,SAAS,EAAK,EAGxDO,EAAmBC,EAAAA,QAAQ,IAAM,CACrC,OAAQV,EAAA,CACN,IAAK,SACH,OAAOhB,EAAS,OAAO2B,GACrB,CAAC,qBAAsB,qBAAsB,aAAa,EAAE,SAASA,EAAE,MAAM,CAAA,EAEjF,IAAK,YACH,OAAO3B,EAAS,OAAO2B,GACrB,CAAC,gBAAiB,oBAAqB,qBAAsB,mBAAmB,EAAE,SAASA,EAAE,MAAM,CAAA,EAEvG,IAAK,UACH,OAAO3B,EAAS,UACd,CAAC,QAAS,oBAAoB,EAAE,SAAS2B,EAAE,MAAM,CAAA,EAErD,QACE,OAAO3B,CAAA,CAEb,EAAG,CAACA,EAAUgB,CAAS,CAAC,EAElBY,EAAkBC,GACfC,EAAsBD,CAAM,GAAG,OAAS,OAG3CE,EAAkBF,GAAkC,CACxD,MAAMG,EAASF,EAAsBD,CAAM,EAC3C,OAAOlC,IAAa,KAAOqC,GAAQ,MAAQA,GAAQ,OACrD,EAEMC,EAAc3G,GACL,IAAI,KAAKA,CAAO,EACjB,mBAAmBqE,IAAa,KAAO,QAAU,QAAS,CACpE,IAAK,UACL,MAAO,QACP,KAAM,UACN,KAAM,UACN,OAAQ,SAAA,CACT,EAGGuC,EAAqBjE,GAAqB,CAC9CqD,EAAmBrD,CAAO,EAC1BuD,EAAoB,EAAI,CAC1B,EAEMW,EAAe,MAAOC,GAAe,CACrC,QAAQzC,IAAa,KAAO,6CAA+C,iEAAoE,GACjJ,MAAMgB,EAAcyB,CAAE,CAE1B,EAEMC,GAAO,CACX,CAAE,GAAI,MAAgB,MAAO1C,IAAa,KAAO,MAAQ,WAAY,MAAOK,EAAS,MAAA,EACrF,CAAE,GAAI,SAAmB,MAAOL,IAAa,KAAO,WAAa,OAAQ,MAAOK,EAAS,UAAY,CAAC,qBAAsB,qBAAsB,aAAa,EAAE,SAAS2B,EAAE,MAAM,CAAC,EAAE,MAAA,EACrL,CAAE,GAAI,UAAoB,MAAOhC,IAAa,KAAO,UAAY,WAAY,MAAOK,EAAS,OAAO2B,GAAK,CAAC,QAAS,oBAAoB,EAAE,SAASA,EAAE,MAAM,CAAC,EAAE,MAAA,EAC7J,CAAE,GAAI,YAAsB,MAAOhC,IAAa,KAAO,YAAc,cAAe,MAAOK,EAAS,UAAY,CAAC,gBAAiB,oBAAqB,qBAAsB,mBAAmB,EAAE,SAAS2B,EAAE,MAAM,CAAC,EAAE,MAAA,CAAO,EAG/N,OACEW,EAAAA,KAAC,MAAA,CAAI,UAAU,YAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,mCAAoC,SAAA7C,EAAE,gBAAgB,EAAE,QACrE,IAAA,CAAE,UAAU,gBAAiB,SAAAA,EAAE,mBAAmB,CAAA,CAAE,CAAA,EACvD,EACA4C,EAAAA,KAAC,SAAA,CACC,QAAS,IAAMlB,EAAmB,EAAI,EACtC,UAAU,sCAEV,SAAA,CAAAmB,EAAAA,IAACC,EAAA,CAAK,UAAU,SAAA,CAAU,EACzB9C,EAAE,iBAAiB,CAAA,CAAA,CAAA,CACtB,EACF,QAGC,MAAA,CAAI,UAAU,uBACZ,SAAA2C,GAAK,IAAKI,GACTH,EAAAA,KAAC,SAAA,CAEC,QAAS,IAAMrB,EAAawB,EAAI,EAAE,EAClC,UAAW,8EACTzB,IAAcyB,EAAI,GACd,8BACA,0CACN,GAEC,SAAA,CAAAA,EAAI,MACJA,EAAI,MAAQ,GACXF,EAAAA,IAAC,QAAK,UAAU,uDACb,WAAI,KAAA,CACP,CAAA,CAAA,EAZGE,EAAI,EAAA,CAeZ,EACH,EAGAF,EAAAA,IAAC,MAAA,CAAI,UAAU,YACZ,SAAAd,EAAiB,SAAW,EAC3Ba,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAC,EAAAA,IAACG,EAAA,CAAM,UAAU,sCAAA,CAAuC,QACvD,KAAA,CAAG,UAAU,yCACX,SAAAhD,EAAE,qBAAqB,EAC1B,QACC,IAAA,CAAE,UAAU,gBAAiB,SAAAA,EAAE,sBAAsB,CAAA,CAAE,CAAA,CAAA,CAC1D,EAEA+B,EAAiB,IAAKxD,GACpBsE,EAAAA,IAACI,GAAA,CAEC,QAAA1E,EACA,SAAA0B,EACA,eAAAiC,EACA,eAAAG,EACA,WAAAE,EACA,cAAe,IAAMC,EAAkBjE,CAAO,EAC9C,UAAW,IAAMkC,EAAelC,EAAQ,EAAE,EAC1C,SAAW2E,GAAWxC,EAAcnC,EAAQ,GAAI2E,CAAM,EACtD,kBAAmB,IAAMvC,EAAgBpC,EAAQ,EAAE,EACnD,aAAc,IAAMqC,EAAWrC,EAAQ,EAAE,EACzC,cAAe,IAAMsC,EAAYtC,EAAQ,EAAE,EAC3C,iBAAkB,IAAMuC,EAAevC,EAAQ,EAAE,EACjD,mBAAoB,IAAMwC,EAAiBxC,EAAQ,EAAE,EACrD,kBAAmB,IAAMyC,EAAgBzC,EAAQ,EAAE,EACnD,SAAU,IAAMkE,EAAalE,EAAQ,EAAE,EACvC,gBAAiB,IAAM4C,EAAuB5C,EAAQ,EAAE,EACxD,KAAAuB,CAAA,EAjBKvB,EAAQ,EAAA,CAmBhB,EAEL,EAGCkD,GACCoB,EAAAA,IAACM,GAAA,CACC,QAAS,IAAMzB,EAAmB,EAAK,EACvC,SAAU,MAAOpD,GAAS,CACxB,GAAI,CACF,MAAMkC,EAAclC,CAAI,EACxB,MAAMiC,EAAA,EACNmB,EAAmB,EAAK,CAC1B,MAAc,CAEd,CACF,EACA,SAAAzB,EACA,KAAAH,EACA,UAAWK,EAAU,IAAIiD,IAAM,CAAE,GAAIA,EAAE,GAAI,KAAMA,EAAE,KAAM,QAASA,EAAE,SAAU,CAAA,CAAA,EAKjFvB,GAAoBF,GACnBkB,EAAAA,IAACQ,GAAA,CACC,QAAS1B,EACT,QAAS,IAAM,CACbG,EAAoB,EAAK,EACzBF,EAAmB,IAAI,CACzB,EACA,SAAA3B,EACA,gBAAiBiB,EACjB,gBAAiB,IAAMC,EAAuBQ,EAAgB,EAAE,CAAA,CAAA,CAClE,EAEJ,CAEJ,CAGA,SAASsB,GAAY,CACnB,QAAA1E,EACA,SAAA0B,EACA,eAAAiC,EACA,eAAAG,EACA,WAAAE,EACA,cAAAe,EACA,UAAAC,EACA,SAAAC,EACA,kBAAAC,EACA,aAAAC,EACA,cAAAC,EACA,iBAAAC,EACA,mBAAAC,EACA,kBAAAC,EACA,SAAAC,EACA,gBAAAC,EACA,KAAAlE,CACF,EAkBG,CACD,MAAMmE,EAASD,EAAA,EAETE,EAAchC,EAAe3D,EAAQ,MAAM,EAC3C4F,EAAuC,CAC3C,KAAM,4BACN,OAAQ,gCACR,KAAM,4BACN,OAAQ,gCACR,MAAO,8BACP,OAAQ,gCACR,OAAQ,gCACR,KAAM,4BACN,QAAS,kCACT,IAAK,yBAAA,EAGP,OACEvB,EAAAA,KAAC,MAAA,CAAI,UAAU,mDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iBAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAW,4CAA4CsB,EAAaD,CAAW,GAAKC,EAAa,IAAI,GACxG,SAAA9B,EAAe9D,EAAQ,MAAM,EAChC,EACAqE,EAAAA,KAAC,OAAA,CAAK,UAAU,wBAAwB,SAAA,CAAA,IACpCrE,EAAQ,MAAA,EACZ,EACAsE,EAAAA,IAAC,OAAA,CAAK,UAAW,2CACftE,EAAQ,SAAW,SAAW,2BAC9BA,EAAQ,SAAW,UAAY,6BAC/B,8BACF,GACG,SAAAA,EAAQ,SAAW,SAAY0B,IAAa,KAAO,SAAW,SAC9D1B,EAAQ,SAAW,UAAa0B,IAAa,KAAO,QAAU,YAC7DA,IAAa,KAAO,YAAc,SAAA,CACtC,CAAA,EACF,EAGA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,0BACd,SAAA,CAAAC,EAAAA,IAACuB,EAAA,CAAU,UAAU,SAAA,CAAU,EAC9B7F,EAAQ,eAAA,EACX,EACCA,EAAQ,mBACPqE,OAAC,OAAA,CAAK,UAAU,0BACd,SAAA,CAAAC,EAAAA,IAACwB,EAAA,CAAS,UAAU,SAAA,CAAU,EAC7B9B,EAAWhE,EAAQ,iBAAiB,CAAA,CAAA,CACvC,CAAA,EAEJ,EAGAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAC,EAAAA,IAACyB,EAAA,CAAK,UAAU,SAAA,CAAU,EAC1BzB,EAAAA,IAAC,OAAA,CAAM,SAAAtE,EAAQ,aAAA,CAAc,EAC7BqE,EAAAA,KAAC,OAAA,CAAK,UAAU,gBAAgB,SAAA,CAAA,IAC5BrE,EAAQ,gBAAkB,WACvB0B,IAAa,KAAO,SAAW,QAC/BA,IAAa,KAAO,KAAO,KAAM,GAAA,CAAA,CACxC,CAAA,EACF,EAGA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACb,SAAA,CAAAC,EAAAA,IAAC0B,EAAA,CAAS,UAAU,uBAAA,CAAwB,EAC5C3B,EAAAA,KAAC,OAAA,CAAK,UAAU,gBACb,SAAA,CAAArE,EAAQ,YAAY,OAAO,IAAE0B,IAAa,KAAO,sBAAwB,qBAAA,CAAA,CAC5E,CAAA,EACF,EAGC1B,EAAQ,SAAW,sBAAwBA,EAAQ,iBAAmBA,EAAQ,gBAAgB,OAAS,GACtGqE,EAAAA,KAAC,MAAA,CAAI,UAAU,qCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iEACb,SAAA,CAAAC,EAAAA,IAACwB,EAAA,CAAS,UAAU,uBAAA,CAAwB,EAC3CpE,IAAa,KAAO,uBAAyB,yBAAA,EAChD,EACA4C,MAAC,OAAI,UAAU,YACZ,WAAQ,gBAAgB,IAAK2B,GAAW,CACvC,MAAMC,EAAalG,EAAQ,gBAAgB,OAAO,CAACmG,EAAKC,IAAQD,GAAQC,EAAY,WAAaA,EAAI,OAAO,QAAU,GAAI,CAAC,EACrHC,EAAaJ,EAAe,WAAaA,EAAO,OAAO,QAAU,EACjEK,EAAUJ,EAAa,EAAKG,EAAYH,EAAa,IAAO,EAC5DK,EAAYF,EAAY,GAAKA,IAAc,KAAK,IAAI,GAAGrG,EAAQ,gBAAgB,OAAUwG,EAAU,WAAaA,EAAE,OAAO,QAAU,CAAC,CAAC,EAE3I,OACEnC,EAAAA,KAAC,MAAA,CAAoB,UAAU,kCAC7B,SAAA,CAAAA,OAAC,OAAI,UAAW,kCAAkCkC,EAAY,4BAA8B,eAAe,GACzG,SAAA,CAAAjC,EAAAA,IAAC,OAAA,CAAM,SAAAN,EAAWiC,EAAO,QAAQ,EAAE,EAClCM,GAAaF,EAAY,GACxB/B,EAAAA,IAAC,OAAA,CAAK,UAAU,0DACb,SAAA5C,IAAa,KAAO,QAAU,UAAA,CACjC,CAAA,EAEJ,EACA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,oDACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,iDACV,MAAO,CAAE,MAAO,GAAGgC,CAAO,GAAA,CAAI,CAAA,EAElC,EACAjC,EAAAA,KAAC,OAAA,CAAK,UAAU,wCAAyC,SAAA,CAAAgC,EAAU,KAAGC,EAAQ,QAAQ,CAAC,EAAE,IAAA,CAAA,CAAE,CAAA,CAAA,CAC7F,CAAA,CAAA,EAjBQL,EAAO,EAkBjB,CAEJ,CAAC,CAAA,CACH,EACA5B,EAAAA,KAAC,MAAA,CAAI,UAAU,6BACZ,SAAA,CAAA3C,IAAa,KAAO,kBAAoB,iBACxC1B,EAAQ,gBAAgB,OAAO,CAACmG,EAAKC,IAAQD,GAAQC,EAAY,WAAaA,EAAI,OAAO,QAAU,GAAI,CAAC,CAAA,CAAA,CAC3G,CAAA,EACF,EAID,CAAC,cAAe,gBAAiB,oBAAqB,qBAAsB,mBAAmB,EAAE,SAASpG,EAAQ,MAAM,GACvHqE,EAAAA,KAAC,MAAA,CAAI,UAAU,6DACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAACG,EAAA,CAAM,UAAU,uBAAA,CAAwB,EACzCJ,EAAAA,KAAC,OAAA,CAAK,UAAU,UACb,SAAA,CAAAqB,EAAO,aAAa,IAAEA,EAAO,MAAM,KAAGA,EAAO,QAAQ,QAAQ,CAAC,EAAE,IAAA,CAAA,CACnE,CAAA,EACF,QACC,OAAA,CAAK,UAAW,gDACfA,EAAO,cACH,8BACA,yBACN,GACG,SAAAA,EAAO,cACHhE,IAAa,KAAO,cAAgB,aACpCA,IAAa,KAAO,cAAgB,aAAA,CAC3C,CAAA,CAAA,CACF,CAAA,EAEJ,EAGA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,QAASS,EACT,UAAU,uFACV,MAAOrD,IAAa,KAAO,YAAc,WAEzC,SAAA4C,EAAAA,IAACmC,GAAA,CAAI,UAAU,SAAA,CAAU,CAAA,CAAA,EAI1BzG,EAAQ,SAAW,uBAAyBuB,GAAM,OAAS,SAAWA,GAAM,OAAS,WAAaA,GAAM,OAAS,aAChH8C,EAAAA,KAAAqC,EAAAA,SAAA,CACE,SAAA,CAAApC,EAAAA,IAAC,SAAA,CACC,QAASU,EACT,UAAU,yFACV,MAAOtD,IAAa,KAAO,WAAa,aAExC,SAAA4C,EAAAA,IAACqC,EAAA,CAAM,UAAU,SAAA,CAAU,CAAA,CAAA,EAE7BrC,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMW,EAASvD,IAAa,KAAO,wBAA0B,gCAAgC,EACtG,UAAU,mFACV,MAAOA,IAAa,KAAO,YAAc,YAEzC,SAAA4C,EAAAA,IAACsC,EAAA,CAAE,UAAU,SAAA,CAAU,CAAA,CAAA,CACzB,EACF,GAIArF,GAAM,OAAS,SAAWA,GAAM,OAAS,WAAaA,GAAM,OAAS,aACrE+C,EAAAA,IAAC,SAAA,CACC,QAASkB,EACT,UAAU,mFACV,MAAO9D,IAAa,KAAO,UAAY,YAEvC,SAAA4C,EAAAA,IAACuC,GAAA,CAAO,UAAU,SAAA,CAAU,CAAA,CAAA,CAC9B,CAAA,CAGJ,CAAA,EACF,GAGEtF,GAAM,OAAS,SAAWA,GAAM,OAAS,WAAaA,GAAM,OAAS,aACrE8C,EAAAA,KAAC,MAAA,CAAI,UAAU,0DACZ,SAAA,CAAArE,EAAQ,SAAW,sBAClBqE,EAAAA,KAAC,SAAA,CACC,QAASa,EACT,UAAU,8HAEV,SAAA,CAAAZ,EAAAA,IAACwC,GAAA,CAAc,UAAU,SAAA,CAAU,EAClCpF,IAAa,KAAO,mBAAqB,mBAAA,CAAA,CAAA,EAI7C1B,EAAQ,SAAW,sBAClBqE,EAAAA,KAAC,SAAA,CACC,QAASc,EACT,UAAU,gIAEV,SAAA,CAAAb,EAAAA,IAACyC,GAAA,CAAK,UAAU,SAAA,CAAU,EACzBrF,IAAa,KAAO,sBAAwB,sBAAA,CAAA,CAAA,EAIhD1B,EAAQ,SAAW,eAClBqE,EAAAA,KAAC,SAAA,CACC,QAASe,EACT,UAAU,kIAEV,SAAA,CAAAd,EAAAA,IAAC0C,GAAA,CAAO,UAAU,SAAA,CAAU,EAC3BtF,IAAa,KAAO,sBAAwB,sBAAA,CAAA,CAAA,EAIhD1B,EAAQ,SAAW,iBAClBqE,EAAAA,KAAC,SAAA,CACC,QAASgB,EACT,UAAU,kIAEV,SAAA,CAAAf,EAAAA,IAAC2C,GAAA,CAAU,UAAU,SAAA,CAAU,EAC9BvF,IAAa,KAAO,qBAAuB,0BAAA,CAAA,CAAA,EAI/C1B,EAAQ,SAAW,qBAClBqE,EAAAA,KAAC,SAAA,CACC,QAASiB,EACT,UAAU,8HAEV,SAAA,CAAAhB,EAAAA,IAAC0B,EAAA,CAAS,UAAU,SAAA,CAAU,EAC7BtE,IAAa,KAAO,wBAA0B,oBAAA,CAAA,CAAA,EAIlD1B,EAAQ,SAAW,sBAClBqE,EAAAA,KAAAqC,EAAAA,SAAA,CACE,SAAA,CAAArC,EAAAA,KAAC,SAAA,CACC,QAASkB,EACT,UAAU,oIAEV,SAAA,CAAAjB,EAAAA,IAAC4C,GAAA,CAAO,UAAU,SAAA,CAAU,EAC3BxF,IAAa,KAAO,qBAAuB,sBAAA,CAAA,CAAA,EAE9C2C,EAAAA,KAAC,SAAA,CACC,QAASU,EACT,UAAU,iIAEV,SAAA,CAAAT,EAAAA,IAAC6C,EAAA,CAAS,UAAU,SAAA,CAAU,EAC7BzF,IAAa,KAAO,mBAAqB,0BAAA,CAAA,CAAA,CAC5C,EACF,EAGD1B,EAAQ,SAAW,qBAClBqE,EAAAA,KAAC,SAAA,CACC,QAASU,EACT,UAAU,iIAEV,SAAA,CAAAT,EAAAA,IAAC6C,EAAA,CAAS,UAAU,SAAA,CAAU,EAC7BzF,IAAa,KAAO,mBAAqB,0BAAA,CAAA,CAAA,CAC5C,CAAA,CAEJ,CAAA,EAEJ,CAEJ,CAGA,SAASkD,GAAoB,CAC3B,QAAAwC,EACA,SAAAC,EACA,SAAA3F,EACA,KAAAH,EACA,UAAAK,CACF,EAgBG,CACD,KAAM,CAAC0F,EAAMC,CAAO,EAAItE,EAAAA,SAAS,CAAC,EAC5B,CAACuE,EAAcC,CAAe,EAAIxE,EAAAA,SAAS,EAAK,EAChD,CAACyE,EAAoBC,CAAqB,EAAI1E,EAAAA,SAAS,EAAK,EAC5D,CAAC2E,EAAeC,CAAgB,EAAI5E,EAAAA,SAAS,CAAE,MAAO,GAAI,YAAa,GAAI,UAAW,iBAAA,CAAwC,EAC9H,CAAC6E,EAAUC,CAAW,EAAI9E,WAAS,CACvC,WAAY1B,GAAM,aAAeK,EAAU,OAAS,EAAIA,EAAU,CAAC,EAAE,GAAK,IAC1E,gBAAiBA,EAAU,OAAS,EAAIA,EAAU,CAAC,EAAE,QAAU,GAC/D,cAAe,aACf,OAAQ,SACR,YAAa,CAAA,EACb,YAAa,CAAA,EACb,SAAU,GACV,YAAa,EAAA,CACd,EAEKoG,EAAwBC,GAAuB,CACnD,MAAMC,EAAWtG,EAAU,KAAKiD,GAAKA,EAAE,KAAOoD,CAAU,EACxDF,EAAY,CACV,GAAGD,EACH,WAAAG,EACA,gBAAiBC,GAAU,SAAW,EAAA,CACvC,CACH,EAEMC,EAAuBC,GAAyB,CAChDN,EAAS,YAAY,SAASM,CAAI,EACpCL,EAAY,CAAE,GAAGD,EAAU,YAAaA,EAAS,YAAY,OAAOrG,GAAKA,IAAM2G,CAAI,CAAA,CAAG,EAEtFL,EAAY,CAAE,GAAGD,EAAU,YAAa,CAAC,GAAGA,EAAS,YAAaM,CAAI,EAAG,CAE7E,EAEMC,EAAe,SAAY,CAC/B,GAAI,CAAC9G,GAAQ,CAACuG,EAAS,YAAcN,EAAc,OAEnDC,EAAgB,EAAI,EAEpB,MAAMxH,EAAc,CAClB,GAAG6H,EAAS,YAAY,IAAIM,IAAS,CACnC,KAAAA,EACA,MAAO1G,IAAa,KAAO4G,EAAkBF,CAAI,EAAE,MAAQE,EAAkBF,CAAI,EAAE,QACnF,YAAa1G,IAAa,KAAO4G,EAAkBF,CAAI,EAAE,YAAcE,EAAkBF,CAAI,EAAE,cAC/F,UAAWE,EAAkBF,CAAI,EAAE,iBACnC,UAAW,CAAA,CAAC,EACZ,EACF,GAAGN,EAAS,YAAY,IAAInK,IAAS,CACnC,KAAM,QACN,MAAOA,EAAK,MACZ,YAAaA,EAAK,YAClB,UAAWA,EAAK,UAChB,UAAW,CAAA,CAAC,EACZ,CAAA,EAGJ,GAAI,CACF,MAAM0J,EAAS,CACb,WAAYS,EAAS,WACrB,gBAAiBA,EAAS,gBAC1B,cAAeA,EAAS,cACxB,YAAavG,EAAK,GAClB,cAAeA,EAAK,KACpB,OAAQuG,EAAS,OACjB,YAAA7H,EACA,SAAU6H,EAAS,UAAY,OAC/B,YAAaA,EAAS,aAAe,MAAA,CACtC,CACH,QAAA,CACEL,EAAgB,EAAK,CACvB,CACF,EAEMc,EAAQ,CACZ,CAAE,IAAK,EAAG,MAAO7G,IAAa,KAAO,MAAQ,MAAA,EAC7C,CAAE,IAAK,EAAG,MAAOA,IAAa,KAAO,WAAa,aAAA,EAClD,CAAE,IAAK,EAAG,MAAOA,IAAa,KAAO,aAAe,OAAA,CAAQ,EAG9D,aACG,MAAA,CAAI,UAAU,sEACb,SAAA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,qEAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iEACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,MAAC,MAAG,UAAU,oBACX,SAAA5C,IAAa,KAAO,mBAAqB,sBAC5C,EACA4C,EAAAA,IAAC,IAAA,CAAE,UAAU,wBACV,SAAA5C,IAAa,KAAO,OAAO4F,CAAI,QAAU,WAAWA,CAAI,QAAA,CAC3D,CAAA,EACF,EACAhD,EAAAA,IAAC,SAAA,CACC,QAAS8C,EACT,UAAU,qDAEV,SAAA9C,EAAAA,IAACsC,EAAA,CAAE,UAAU,SAAA,CAAU,CAAA,CAAA,CACzB,EACF,QAGC,MAAA,CAAI,UAAU,qCACb,SAAAtC,MAAC,OAAI,UAAU,oCACZ,SAAAiE,EAAM,IAAI,CAACC,EAAG,IACbnE,OAAC,MAAA,CAAgB,UAAU,oBACzB,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAW,6EACdgD,GAAQkB,EAAE,IAAM,8BAAgC,2BAClD,GACG,SAAAA,EAAE,GAAA,CACL,EACAlE,EAAAA,IAAC,OAAA,CAAK,UAAW,gBAAgBgD,GAAQkB,EAAE,IAAM,gBAAkB,eAAe,GAC/E,SAAAA,EAAE,KAAA,CACL,EACC,EAAID,EAAM,OAAS,GAClBjE,EAAAA,IAAC,MAAA,CAAI,UAAW,yBAAyBgD,EAAOkB,EAAE,IAAM,gBAAkB,aAAa,EAAA,CAAI,CAAA,CAAA,EAVrFA,EAAE,GAYZ,CACD,CAAA,CACH,CAAA,CACF,EAGAnE,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACZ,SAAA,CAAAiD,IAAS,GACRjD,EAAAA,KAAAqC,EAAAA,SAAA,CAEE,SAAA,CAAArC,OAAC,MAAA,CACC,SAAA,CAAAC,MAAC,SAAM,UAAU,+CACd,SAAA5C,IAAa,KAAO,eAAiB,eACxC,EACCE,EAAU,SAAW,EACpB0C,EAAAA,IAAC,MAAA,CAAI,UAAU,+EACZ,SAAA5C,IAAa,KACV,uDACA,+CAAA,CACN,EAEA4C,EAAAA,IAAC,SAAA,CACC,MAAOwD,EAAS,WAChB,SAAWW,GAAMT,EAAqBS,EAAE,OAAO,KAAK,EACpD,UAAU,0GAET,SAAA7G,EAAU,IAAKsG,UACb,SAAA,CAAyB,MAAOA,EAAS,GACvC,SAAA,CAAAA,EAAS,KAAK,MAAIA,EAAS,OAAA,CAAA,EADjBA,EAAS,EAEtB,CACD,CAAA,CAAA,CACH,EAEJ,SAGC,MAAA,CACC,SAAA,CAAA5D,MAAC,SAAM,UAAU,+CACd,SAAA5C,IAAa,KAAO,cAAgB,eACvC,EACA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,QAAS,IAAM0D,EAAY,CAAE,GAAGD,EAAU,cAAe,aAAc,EACvE,UAAW,6CACTA,EAAS,gBAAkB,aACvB,iCACA,uCACN,GAEA,SAAA,CAAAxD,EAAAA,IAACuB,EAAA,CAAU,UAAU,oCAAA,CAAqC,QACzD,MAAA,CAAI,UAAU,sBACZ,SAAAnE,IAAa,KAAO,uBAAyB,uBAAA,CAChD,CAAA,CAAA,CAAA,EAEF2C,EAAAA,KAAC,SAAA,CACC,QAAS,IAAM0D,EAAY,CAAE,GAAGD,EAAU,cAAe,WAAY,EACrE,UAAW,6CACTA,EAAS,gBAAkB,WACvB,iCACA,uCACN,GAEA,SAAA,CAAAxD,EAAAA,IAACyB,EAAA,CAAK,UAAU,oCAAA,CAAqC,QACpD,MAAA,CAAI,UAAU,sBACZ,SAAArE,IAAa,KAAO,sBAAwB,oBAAA,CAC/C,CAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EACF,SAGC,MAAA,CACC,SAAA,CAAA4C,MAAC,SAAM,UAAU,+CACd,SAAA5C,IAAa,KAAO,oBAAsB,oBAC7C,EACA4C,EAAAA,IAAC,MAAA,CAAI,UAAU,yBACX,SAAA,CAAC,SAAU,UAAW,QAAQ,EAAsB,IAAK/D,GACzD+D,EAAAA,IAAC,SAAA,CAEC,QAAS,IAAMyD,EAAY,CAAE,GAAGD,EAAU,OAAAvH,EAAQ,EAClD,UAAW,6CACTuH,EAAS,SAAWvH,EAChB,iCACA,uCACN,GAEA,eAAC,MAAA,CAAI,UAAU,sBACZ,SAAAA,IAAW,SACPmB,IAAa,KAAO,SAAW,SAChCnB,IAAW,UACVmB,IAAa,KAAO,QAAU,YAC9BA,IAAa,KAAO,YAAc,SAAA,CACzC,CAAA,EAdKnB,CAAA,CAgBR,CAAA,CACH,CAAA,EACF,EAGCuH,EAAS,SAAW,UACnBzD,EAAAA,KAAC,MAAA,CACC,SAAA,CAAAC,MAAC,SAAM,UAAU,+CACd,SAAA5C,IAAa,KAAO,mBAAqB,iBAC5C,EACA4C,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAOwD,EAAS,SAChB,SAAWW,GAAMV,EAAY,CAAE,GAAGD,EAAU,SAAUW,EAAE,OAAO,MAAO,EACtE,UAAU,cACV,YAAa/G,IAAa,KAAO,yBAA2B,uBAAA,CAAA,CAC9D,EACF,SAID,MAAA,CACC,SAAA,CAAA2C,EAAAA,KAAC,QAAA,CAAM,UAAU,+CACd,SAAA,CAAA3C,IAAa,KAAO,uBAAyB,sBAC9C2C,EAAAA,KAAC,OAAA,CAAK,UAAU,iCAAiC,SAAA,CAAA,IAC7C3C,IAAa,KAAO,gBAAkB,YAAY,GAAA,CAAA,CACtD,CAAA,EACF,EACA4C,EAAAA,IAAC,WAAA,CACC,MAAOwD,EAAS,YAChB,SAAWW,GAAMV,EAAY,CAAE,GAAGD,EAAU,YAAaW,EAAE,OAAO,MAAO,EACzE,UAAU,uCACV,YAAa/G,IAAa,KACtB,gEACA,iEACJ,KAAM,CAAA,CAAA,CACR,CAAA,CACF,CAAA,EACF,EAGD4F,IAAS,GACRjD,EAAAA,KAAAqC,EAAAA,SAAA,CACE,SAAA,CAAArC,OAAC,MAAA,CACC,SAAA,CAAAC,MAAC,SAAM,UAAU,+CACd,SAAA5C,IAAa,KAAO,4BAA8B,kCACrD,EACA4C,EAAAA,IAAC,MAAA,CAAI,UAAU,qCACX,SAAA,OAAO,KAAKgE,CAAiB,EAAuB,IAAKF,GAAS,CAClE,MAAMzK,EAAO2K,EAAkBF,CAAI,EAC7BM,EAAaZ,EAAS,YAAY,SAASM,CAAI,EAErD,OACE9D,EAAAA,IAAC,SAAA,CAEC,QAAS,IAAM6D,EAAoBC,CAAI,EACvC,UAAW,8DACTM,EACI,iCACA,uCACN,GAEA,SAAArE,EAAAA,KAAC,MAAA,CAAI,UAAU,mCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,cACZ,SAAA5C,IAAa,KAAO/D,EAAK,MAAQA,EAAK,OAAA,CACzC,EACA2G,EAAAA,IAAC,OAAI,UAAU,6BACZ,aAAa,KAAO3G,EAAK,YAAcA,EAAK,aAAA,CAC/C,EACA0G,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,wDACb,SAAA5C,IAAa,KACViH,EAA0BhL,EAAK,gBAAgB,EAAE,MACjDgL,EAA0BhL,EAAK,gBAAgB,EAAE,QACvD,EACCA,EAAK,mBACJ2G,MAAC,OAAA,CAAK,UAAU,wDACb,SAAA5C,IAAa,KAAO,kBAAoB,mBAAA,CAC3C,CAAA,CAAA,CAEJ,CAAA,EACF,EACA4C,EAAAA,IAAC,MAAA,CAAI,UAAW,kEACdoE,EAAa,kCAAoC,iBACnD,GACG,SAAAA,GAAcpE,MAACqC,EAAA,CAAM,UAAU,wBAAwB,CAAA,CAC1D,CAAA,CAAA,CACF,CAAA,EAlCKyB,CAAA,CAqCX,CAAC,CAAA,CACH,CAAA,EACF,EAGA/D,EAAAA,KAAC,MAAA,CAAI,UAAU,qCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAC,MAAC,SAAM,UAAU,0CACd,SAAA5C,IAAa,KAAO,eAAiB,oBACxC,EACA2C,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAMsD,EAAsB,EAAI,EACzC,UAAU,oFAEV,SAAA,CAAArD,EAAAA,IAACC,EAAA,CAAK,UAAU,SAAA,CAAU,EACzB7C,IAAa,KAAO,kBAAoB,gBAAA,CAAA,CAAA,CAC3C,EACF,EAGCoG,EAAS,YAAY,OAAS,SAC5B,MAAA,CAAI,UAAU,iBACZ,SAAAA,EAAS,YAAY,IAAI,CAACnK,EAAMiL,IAC/BtE,EAAAA,IAAC,MAAA,CAAgB,UAAU,yDACzB,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,mCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,cAAe,SAAA3G,EAAK,MAAM,EACxCA,EAAK,aACJ2G,EAAAA,IAAC,OAAI,UAAU,6BAA8B,WAAK,YAAY,EAEhEA,EAAAA,IAAC,OAAA,CAAK,UAAU,0EACb,aAAa,KACVqE,EAA0BhL,EAAK,SAAS,EAAE,MAC1CgL,EAA0BhL,EAAK,SAAS,EAAE,OAAA,CAChD,CAAA,EACF,EACA2G,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMyD,EAAY,CACzB,GAAGD,EACH,YAAaA,EAAS,YAAY,OAAO,CAACe,EAAG1K,IAAMA,IAAMyK,CAAK,CAAA,CAC/D,EACD,UAAU,2CAEV,SAAAtE,EAAAA,IAACsC,EAAA,CAAE,UAAU,SAAA,CAAU,CAAA,CAAA,CACzB,CAAA,CACF,CAAA,EAtBQgC,CAuBV,CACD,EACH,EAIDlB,GACCrD,EAAAA,KAAC,MAAA,CAAI,UAAU,6EACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAOsD,EAAc,MACrB,SAAWa,GAAMZ,EAAiB,CAAE,GAAGD,EAAe,MAAOa,EAAE,OAAO,MAAO,EAC7E,UAAU,cACV,YAAa/G,IAAa,KAAO,qBAAuB,cAAA,CAAA,EAE1D4C,EAAAA,IAAC,WAAA,CACC,MAAOsD,EAAc,YACrB,SAAWa,GAAMZ,EAAiB,CAAE,GAAGD,EAAe,YAAaa,EAAE,OAAO,MAAO,EACnF,UAAU,uCACV,YAAa/G,IAAa,KAAO,2BAA6B,qBAC9D,KAAM,CAAA,CAAA,SAEP,MAAA,CACC,SAAA,CAAA4C,MAAC,SAAM,UAAU,mCACd,SAAA5C,IAAa,KAAO,iBAAmB,yBAC1C,EACA4C,EAAAA,IAAC,SAAA,CACC,MAAOsD,EAAc,UACrB,SAAWa,GAAMZ,EAAiB,CAAE,GAAGD,EAAe,UAAWa,EAAE,OAAO,MAA4B,EACtG,UAAU,sBAER,SAAA,OAAO,KAAKE,CAAyB,EAA0B,IAAKlH,GACpE6C,EAAAA,IAAC,SAAA,CAAe,MAAO7C,EACpB,aAAa,KAAOkH,EAA0BlH,CAAC,EAAE,MAAQkH,EAA0BlH,CAAC,EAAE,OAAA,EAD5EA,CAEb,CACD,CAAA,CAAA,CACH,EACF,EACA4C,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAM,CACTsD,EAAc,MAAM,SACtBG,EAAY,CACV,GAAGD,EACH,YAAa,CAAC,GAAGA,EAAS,YAAa,CAAE,GAAGF,EAAe,CAAA,CAC5D,EACDC,EAAiB,CAAE,MAAO,GAAI,YAAa,GAAI,UAAW,kBAAmB,EAC7EF,EAAsB,EAAK,EAE/B,EACA,SAAU,CAACC,EAAc,MAAM,KAAA,EAC/B,UAAU,kJAET,SAAAlG,IAAa,KAAO,WAAa,UAAA,CAAA,EAEpC4C,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAM,CACbqD,EAAsB,EAAK,EAC3BE,EAAiB,CAAE,MAAO,GAAI,YAAa,GAAI,UAAW,kBAAmB,CAC/E,EACA,UAAU,yEAET,SAAAnG,IAAa,KAAO,SAAW,cAAA,CAAA,CAClC,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EAEJ,EAECoG,EAAS,YAAY,SAAW,GAAKA,EAAS,YAAY,SAAW,GACpExD,EAAAA,IAAC,KAAE,UAAU,uBACV,SAAA5C,IAAa,KAAO,iDAAmD,yDAAA,CAC1E,CAAA,EAEJ,EAGD4F,IAAS,GACRhD,MAAAoC,EAAAA,SAAA,CAEE,SAAArC,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAC,MAAC,MAAG,UAAU,mBACX,SAAA5C,IAAa,KAAO,SAAW,SAClC,EAEA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAA5C,IAAa,KAAO,UAAY,UAAU,EAC3E4C,EAAAA,IAAC,QAAK,UAAU,cACb,WAAS,SAAW,SAChB5C,IAAa,KAAO,SAAW,SAChCoG,EAAS,SAAW,UACnBpG,IAAa,KAAO,QAAU,YAC9BA,IAAa,KAAO,YAAc,SAAA,CACzC,CAAA,EACF,EACA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAA5C,IAAa,KAAO,OAAS,MAAM,EACpE4C,EAAAA,IAAC,OAAA,CAAK,UAAU,cACb,WAAU,KAAKO,GAAKA,EAAE,KAAOiD,EAAS,UAAU,GAAG,MAAQA,EAAS,eAAA,CACvE,CAAA,EACF,EACAzD,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAA5C,IAAa,KAAO,eAAiB,gBAAgB,EACtF4C,EAAAA,IAAC,OAAA,CAAK,UAAU,cACb,WAAS,gBAAkB,aACvB5C,IAAa,KAAO,KAAO,KAC3BA,IAAa,KAAO,SAAW,OAAA,CACtC,CAAA,EACF,EACA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,MAAC,QAAK,UAAU,gBAAiB,SAAA5C,IAAa,KAAO,YAAc,YAAY,QAC9E,OAAA,CAAK,UAAU,cAAe,SAAAoG,EAAS,YAAY,MAAA,CAAO,CAAA,CAAA,CAC7D,CAAA,CAAA,CACF,CAAA,EACF,QAEC,MAAA,CAAI,UAAU,mDACb,SAAAzD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAACwE,GAAA,CAAY,UAAU,4CAAA,CAA6C,QACnE,MAAA,CAAI,UAAU,wBACZ,SAAApH,IAAa,KACV,uHACA,gHAAA,CACN,CAAA,CAAA,CACF,CAAA,CACF,EAEA2C,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAC,MAAC,MAAG,UAAU,mBACX,SAAA5C,IAAa,KAAO,gBAAkB,eACzC,EACA2C,EAAAA,KAAC,KAAA,CAAG,UAAU,6CACX,SAAA,CAAAyD,EAAS,YAAY,IAAKM,GACzB9D,EAAAA,IAAC,MACE,SAAA5C,IAAa,KACV4G,EAAkBF,CAAI,EAAE,MACxBE,EAAkBF,CAAI,EAAE,SAHrBA,CAIT,CACD,EACAN,EAAS,YAAY,IAAI,CAACnK,EAAMiL,IAC/BvE,EAAAA,KAAC,KAAA,CAA2B,UAAU,gBACnC,SAAA,CAAA1G,EAAK,MACN0G,EAAAA,KAAC,OAAA,CAAK,UAAU,6BAA6B,SAAA,CAAA,IACzC3C,IAAa,KAAO,cAAgB,aAAc,GAAA,CAAA,CACtD,CAAA,CAAA,EAJO,UAAUkH,CAAK,EAKxB,CACD,CAAA,CAAA,CACH,CAAA,EACF,EAGCd,EAAS,aACRzD,OAAC,MAAA,CAAI,UAAU,mDACb,SAAA,CAAAC,MAAC,MAAG,UAAU,mBACX,SAAA5C,IAAa,KAAO,eAAiB,YACxC,EACA4C,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAyB,WAAS,WAAA,CAAY,CAAA,CAAA,CAC7D,CAAA,CAAA,CAEJ,CAAA,CACF,CAAA,EAEJ,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACZ,SAAA,CAAAiD,EAAO,GACNhD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMiD,EAAQD,EAAO,CAAC,EAC/B,SAAUE,EACV,UAAU,uHAET,SAAA9F,IAAa,KAAO,QAAU,QAAA,CAAA,EAGlC4F,EAAO,EACNhD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMiD,EAAQD,EAAO,CAAC,EAC/B,SAAWA,IAAS,GAAK,CAACQ,EAAS,YAAgBR,IAAS,GAAKQ,EAAS,YAAY,SAAW,GAAKA,EAAS,YAAY,SAAW,EACtI,UAAU,uJAET,SAAApG,IAAa,KAAO,QAAU,SAAA,CAAA,EAGjC4C,EAAAA,IAAC,SAAA,CACC,QAAS+D,EACT,SAAUb,GAAgB,CAACM,EAAS,WACpC,UAAU,uJAET,WACIpG,IAAa,KAAO,cAAgB,kBACpCA,IAAa,KAAO,eAAiB,cAAA,CAAA,CAC5C,CAAA,CAEJ,CAAA,CAAA,CACF,CAAA,CACF,CAEJ,CAGA,SAASoD,GAAoB,CAC3B,QAAA9E,EACA,QAAAoH,EACA,SAAA1F,EACA,gBAAAqH,EACA,gBAAAtD,CACF,EAcG,CACD,MAAMC,EAASD,EAAA,EACT,CAACuD,EAAqBC,CAAsB,EAAIhG,EAAAA,SAAS,EAAK,EAG9DiG,EAAyB,SAAY,CACzCD,EAAuB,EAAI,EAC3B,GAAI,CAEF,MAAME,EAAW,MAAM,MAAM,iBAAiBnJ,EAAQ,EAAE,gBAAgB,EAExE,GAAI,CAACmJ,EAAS,GACZ,MAAM,IAAI,MAAM,+BAA+B,EAGjD,MAAMpJ,EAAO,MAAMoJ,EAAS,KAAA,EAG5B,MAAMrJ,GAAqB,CACzB,QAAS,CACP,GAAGC,EAAK,QACR,gBAAiBC,EAAQ,iBAAmBD,EAAK,QAAQ,gBAAA,EAE3D,YAAaA,EAAK,YAClB,YAAaA,EAAK,YAClB,YAAaA,EAAK,YAClB,aAAcA,EAAK,YAAA,CACpB,CACH,MAAgB,CAEd,MAAM2B,IAAa,KAAO,kCAAoC,4BAA4B,CAC5F,QAAA,CACEuH,EAAuB,EAAK,CAC9B,CACF,EAEA,aACG,MAAA,CAAI,UAAU,sEACb,SAAA5E,EAAAA,KAAC,MAAA,CAAI,UAAU,qEAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iEACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,oBACX,SAAA5C,IAAa,KAAO,aAAa1B,EAAQ,MAAM,GAAK,cAAcA,EAAQ,MAAM,GACnF,EACAsE,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAyB,WAAQ,eAAA,CAAgB,CAAA,EAChE,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAEZ,SAAA,CAAA,CAAC,qBAAsB,mBAAmB,EAAE,SAASrE,EAAQ,MAAM,GAClEqE,EAAAA,KAAC,SAAA,CACC,QAAS6E,EACT,SAAUF,EACV,UAAU,8HAEV,SAAA,CAAA1E,EAAAA,IAAC6C,EAAA,CAAS,UAAU,SAAA,CAAU,EAC7B6B,EACItH,IAAa,KAAO,cAAgB,iBACpCA,IAAa,KAAO,mBAAqB,0BAAA,CAAA,CAAA,EAGlD4C,EAAAA,IAAC,SAAA,CACC,QAAS8C,EACT,UAAU,qDAEV,SAAA9C,EAAAA,IAACsC,EAAA,CAAE,UAAU,SAAA,CAAU,CAAA,CAAA,CACzB,CAAA,CACF,CAAA,EACF,EAEAvC,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,MAAC,QAAK,UAAW,4CACfT,EAAsB7D,EAAQ,MAAM,GAAG,QAAU,QAAU,8BAC3D6D,EAAsB7D,EAAQ,MAAM,GAAG,QAAU,OAAS,4BAC1D6D,EAAsB7D,EAAQ,MAAM,GAAG,QAAU,SAAW,gCAC5D,2BACF,GACG,SAAA0B,IAAa,KACVmC,EAAsB7D,EAAQ,MAAM,GAAG,MACvC6D,EAAsB7D,EAAQ,MAAM,GAAG,QAC7C,EAECA,EAAQ,SAAW,SAAWA,EAAQ,SAAW,sBAChDqE,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAACG,EAAA,CAAM,UAAU,uBAAA,CAAwB,EACzCJ,EAAAA,KAAC,OAAA,CAAK,UAAU,UACb,SAAA,CAAAqB,EAAO,aAAa,IAAEA,EAAO,MAAM,KAAGA,EAAO,QAAQ,QAAQ,CAAC,EAAE,IAAA,EACnE,QACC,OAAA,CAAK,UAAW,gDACfA,EAAO,cAAgB,8BAAgC,yBACzD,GACG,SAAAA,EAAO,cACHhE,IAAa,KAAO,SAAW,SAC/BA,IAAa,KAAO,cAAgB,aAAA,CAC3C,CAAA,CAAA,CACF,CAAA,EAEJ,EAGC1B,EAAQ,mBACPqE,OAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAC,EAAAA,IAACwB,EAAA,CAAS,UAAU,SAAA,CAAU,QAC7B,OAAA,CACE,SAAA,IAAI,KAAK9F,EAAQ,iBAAiB,EAAE,mBACnC0B,IAAa,KAAO,QAAU,QAC9B,CAAE,QAAS,OAAQ,IAAK,UAAW,MAAO,OAAQ,KAAM,UAAW,KAAM,UAAW,OAAQ,SAAA,CAAU,CACxG,CACF,CAAA,EACF,SAID,MAAA,CACC,SAAA,CAAA4C,MAAC,MAAG,UAAU,mBACX,SAAA5C,IAAa,KAAO,eAAiB,cACxC,EACA4C,EAAAA,IAAC,OAAI,UAAU,YACZ,WAAQ,YAAY,IAAI,CAAC3G,EAAMiL,IAAU,CACxC,MAAM/J,EAASkK,EAAgB/I,EAAQ,GAAIrC,EAAK,EAAE,EAElD,aACG,MAAA,CAAkB,UAAU,mDAC3B,SAAA0G,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,cACZ,SAAA,CAAAuE,EAAQ,EAAE,KAAGjL,EAAK,KAAA,EACrB,EACA2G,EAAAA,IAAC,IAAA,CAAE,UAAU,6BAA8B,WAAK,YAAY,EAG3D,CAAC,cAAe,gBAAiB,oBAAqB,qBAAsB,mBAAmB,EAAE,SAAStE,EAAQ,MAAM,GACvHqE,EAAAA,KAAC,MAAA,CAAI,UAAU,qCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC8E,GAAA,CAAS,UAAU,wBAAA,CAAyB,SAC5C,OAAA,CAAM,SAAA,CAAAvK,EAAO,SAAS,KAAGA,EAAO,WAAW,QAAQ,CAAC,EAAE,IAAA,CAAA,CAAE,CAAA,EAC3D,EACAwF,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC+E,GAAA,CAAW,UAAU,sBAAA,CAAuB,EAC7C/E,EAAAA,IAAC,OAAA,CAAM,SAAAzF,EAAO,YAAA,CAAa,CAAA,EAC7B,EACAwF,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAACgF,GAAA,CAAM,UAAU,uBAAA,CAAwB,EACzChF,EAAAA,IAAC,OAAA,CAAM,SAAAzF,EAAO,YAAA,CAAa,CAAA,CAAA,CAC7B,CAAA,EACF,EAGAyF,EAAAA,IAAC,MAAA,CAAI,UAAU,oDACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAW,UAAUzF,EAAO,aAAe,eAAiB,YAAY,GACxE,MAAO,CAAE,MAAO,GAAGA,EAAO,UAAU,GAAA,CAAI,CAAA,EAE5C,EAGAwF,EAAAA,KAAC,MAAA,CAAI,UAAU,+DACb,SAAA,CAAAC,EAAAA,IAAC,QAAK,SAAA,IAAA,CAAE,SACP,OAAA,CACE,SAAA,CAAA5C,IAAa,KAAO,SAAW,WAAW,IAAEiH,EAA0BhL,EAAK,SAAS,EAAE,QAAQ,GAAA,EACjG,EACA2G,EAAAA,IAAC,QAAK,SAAA,MAAA,CAAI,CAAA,CAAA,CACZ,CAAA,CAAA,CACF,CAAA,EAEJ,EAGC3G,EAAK,aAAe,QACnB2G,EAAAA,IAAC,QAAK,UAAW,4CACf3G,EAAK,WAAa,8BAAgC,yBACpD,GACG,SAAAA,EAAK,WACD+D,IAAa,KAAO,UAAY,QAChCA,IAAa,KAAO,aAAe,KAAA,CAC1C,CAAA,EAEJ,CAAA,EAxDQ/D,EAAK,EAyDf,CAEJ,CAAC,CAAA,CACH,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}
{"version":3,"mappings":"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","names":["API_URL","getToken","requestCache","pendingRequests","CACHE_TTL","getCached","key","entry","setCache","data","ttl","invalidateCache","pattern","API_TIMEOUT","apiRequest","endpoint","options","timeout","token","headers","controller","timeoutId","response","error","cachedGet","cacheKey","cached","pending","request","err","apiRequestWrapped","transformUser","user","authApi","login","password","userData","users","usersApi","updates","currentPassword","newPassword","userId","filters","params","query","vehiclesApi","residentId","vehicle","vehicleId","plateNumber","rentalsApi","id","apartmentId","url","guestCodesApi","codeId","code","reason","qrToken","chatApi","channel","channelId","limit","before","content","messageId","announcementsApi","announcement","result","announcementId","uploadApi","file","formData","errorData","files","branchesApi","buildingsApi","building","entrancesApi","buildingId","entrance","buildingDocumentsApi","document","apartmentsApi","apartment","ownersApi","owner","ownerId","personalAccountsApi","account","crmResidentsApi","resident","metersApi","meter","meterReadingsApi","meterId","reading","readingId","teamApi","executorsApi","showAll","executorId","status","requestsApi","category","queryString","requestId","rating","feedback","rescheduleApi","rescheduleId","accepted","responseNote","trainingPartnersApi","activeOnly","partner","trainingProposalsApi","proposal","trainingVotesApi","proposalId","trainingRegistrationsApi","trainingFeedbackApi","trainingNotificationsApi","unreadOnly","trainingSettingsApi","settings","meetingsFullApi","r","meeting","optionId","signerData","meetingId","html","iframe","doc","meetingScheduleVotesApi","meetingAgendaVotesApi","agendaItemId","voterId","meetingOtpApi","otpId","meetingBuildingSettingsApi","meetingVotingUnitsApi","unit","verifiedBy","meetingEligibleVotersApi","voterIds","totalCount","settingsApi","value","useAuthStore","create","persist","set","get","loginStr","normalizedLogin","normalizedPassword","apiError","message","currentUser","state","newUsers","correctToken","mapBuildingFromApi","b","mapEntranceFromApi","mapApartmentFromApi","a","mapOwnerFromApi","o","mapAccountFromApi","mapMeterFromApi","m","mapMeterReadingFromApi","mapResidentFromApi","useCRMStore","buildings","entrances","documents","updatedBuildings","updatedEntrances","e","buildingData","newBuilding","p","apartments","accounts","residents","aId","sum","docData","newDoc","docId","d","entranceData","newEntrance","owners","apartmentData","newApartment","entranceId","meters","readings","updatedMeters","otherReadings","meterData","newMeter","readingData","newReading","approved","rejectionReason","ownerData","newOwner","lowerQuery","residentData","newResident","accountData","newAccount","minDebt","personalAccounts","totalDebt","totalCollectionRates","persistedState","_version","extractBuildingFromAddress","address","uzMatch","ruMatch","seenIds","index","updatedBuilding","extractedNumber","VAPID_PUBLIC_KEY","urlBase64ToUint8Array","base64String","padding","base64","rawData","outputArray","i","PushNotificationService","__publicField","permission","existingSub","subscription","subscriptionData","notification","event","requestNumber","executorName","title","date","time","buildingAddress","hoursLeft","priority","icon","pushNotifications","generateId","createDemoGuestAccessCode","now","validUntil","defaultSettings","useDataStore","mappedRequests","apiReq","mappedExecutors","forStaff","mappedVehicles","v","mappedCodes","c","newCode","revokedBy","revokedByName","revokedByRole","fullCode","newUses","newStatus","base64Data","decoded","bytes","utf8Decoded","tokenData","usedCodes","localCode","logData","newLog","accessCodeId","logs","l","todayStart","codes","activeCodes","usedToday","createdToday","byVisitorType","recentScans","vehicleData","tempId","optimisticVehicle","realVehicle","veh","originalVehicle","deletedVehicle","normalized","announcementData","__vitePreload","api","target","apiData","newAnnouncement","readAnnouncementsKey","readAnnouncements","userLogin","floor","branch","authorId","announcements","viewedByUser","viewedBy","attachments","typeForUI","apartmentsRes","recordsRes","recordData","executorData","newExecutor","requests","executorRequests","completed","weekAgo","monthAgo","thisWeek","thisMonth","ratings","avgRating","times","avgTime","requestData","tempNumber","optimisticRequest","realRequest","executor","isSelfAssign","executorPhone","originalRequest","originalExecutor","totalPausedTime","workDuration","wasRejected","notifyMessage","newRating","newRejectionCount","cancelledBy","cancellerName","canResidentCancel","canManagerCancel","previousExecutorId","activeCount","cancellerLabels","newNotification","n","log","executors","today","completedRequests","completedToday","completedWeek","totalTime","count","avgCompletionTime","days","chartData","dayStart","dayEnd","created","createdAt","approvedAt","apiSettings","newSettings","mappedReschedules","requestsApi2","newReschedule","reschedule","oneDayAgo","currentState","persisted","demoCode","parsed","translations","useLanguageStore","lang","language","mapMeetingFromApi","parseJson","defaultValue","mapAgendaItem","item","mapScheduleOption","opt","mapVoteRecordFromApi","mapProtocolFromApi","mapOTPRecordFromApi","mapVotingUnitFromApi","mapBuildingSettingsFromApi","defaultBuildingSettings","useMeetingStore","meetings","newMeetings","newUnits","u","organizerId","selectedOptionId","protocol","voterName","choice","verificationData","comment","apiMethod","voteRecord","votes","existingIds","newVotes","phone","purpose","apiPurpose","otpRecord","votesFor","votesAgainst","votesAbstain","totalVotes","percentFor","thresholdPercent","thresholdMet","isApproved","participated","total","percent","quorumPercent","quorumReached","existing","s","updatedSettings","votingUnit","records","uniqueVoters","otpVerified","AppLogo","size","sizeClasses","jsx","Sidebar","onLogout","isOpen","onClose","location","useLocation","t","getAnnouncementsForEmployees","chatUnreadCount","setChatUnreadCount","useState","fetchChatUnreadCount","useCallback","useEffect","interval","meetingStatus","useMemo","weekFromNow","relevantMeetings","meetingDate","hasActiveVoting","hasConfirmedMeeting","badges","currentExecutor","mySpecialization","availableRequestsCount","assignedRequestsCount","unreadAnnouncementsCount","activeRequestsCount","upcomingMeetingsCount","newRequestsCount","navItems","LayoutDashboard","Ticket","ShoppingBag","baseItems","FileText","CalendarDays","Car","QrCode","BarChart3","Megaphone","GraduationCap","Users","StickyNote","Home","MessageCircle","Vote","Phone","Star","ScrollText","Key","Shield","Building2","Wrench","Settings","Package","handleNavClick","jsxs","Fragment","CloseIcon","badgeCount","isMeetingsTab","badgeColor","shouldAnimate","Link","User","LogOut","MobileHeader","onMenuClick","unreadCount","navigate","useNavigate","showNotifications","setShowNotifications","notifications","markNotificationAsRead","markAllNotificationsAsRead","getAnnouncementsForResidents","vehicles","isResident","userAnnouncements","upcomingMeetings","nowDate","pendingTasks","pendingTasksCount","totalMenuBadge","userNotifications","formatTime","dateStr","diffMs","diffMins","diffHours","getNotificationIcon","type","totalNotificationsBadge","Menu","Bell","createPortal","CheckCircle","task","CHAT_CHANNEL_LABELS","SERVICE_CATEGORIES","SPECIALIZATION_LABELS","STATUS_LABELS","PRIORITY_LABELS","AGENDA_ITEM_TYPES","DECISION_THRESHOLD_LABELS","MEETING_STATUS_LABELS","BUILDING_TYPE_LABELS","VEHICLE_TYPE_LABELS","VEHICLE_OWNER_TYPE_LABELS","VISITOR_TYPE_LABELS","ACCESS_TYPE_LABELS","GUEST_ACCESS_STATUS_LABELS","RESCHEDULE_REASON_LABELS","RESCHEDULE_STATUS_LABELS","ONBOARDING_TASKS","Lock","Header","getUnreadCount","currentTime","setCurrentTime","sentRemindersRef","useRef","searchQuery","setSearchQuery","showSearchResults","setShowSearchResults","isRentalUser","pendingOnboardingTasks","unreadMeetingsCount","handleTaskClick","timer","checkUpcomingRequests","currentRequests","currentExecutors","notify","tenMinutesLater","fiveMinutesLater","startTime","hours","minutes","scheduledDateTime","reminderKey","reminder5Key","minutesUntil","reminderTimer","totalBadgeCount","formatCurrentTime","formatCurrentDate","getRoleLabel","diffDays","searchResults","handleClockClick","Search","Clock","ChevronRight","getShownIds","stored","saveShownId","shown","usePopupNotifications","markAnnouncementAsViewed","popups","setPopups","processedRef","relevantAnnouncements","shownIds","newPopups","isUrgent","notViewed","notShown","isMeeting","prev","checkDeliveredOrders","deliveredOrders","dismissPopup","addPopup","popup","chatListeners","subscribeToChatMessages","listener","emitChatMessage","rescheduleListeners","emitRescheduleUpdate","useWebSocketSync","fetchRequests","fetchExecutors","fetchAnnouncements","fetchPendingReschedules","fetchMeetings","wsRef","reconnectTimeoutRef","reconnectAttempts","heartbeatIntervalRef","lastSyncRef","MAX_RECONNECT_ATTEMPTS","SYNC_DEBOUNCE","HEARTBEAT_INTERVAL","syncData","promises","syncMeetings","startHeartbeat","stopHeartbeat","connect","wsUrl","ws","activeMeeting","delay","handleVisibilityChange","PopupNotification","onAction","actionLabel","autoClose","isClosing","setIsClosing","handleClose","handleAction","getIcon","AlertTriangle","Truck","getBgColor","getActionBtnColor","X","PopupManager","onDismiss","currentPopup","PerformanceMonitor","memo","enabled","position","stats","setStats","isExpanded","setIsExpanded","frameCount","lastTime","animationFrameId","measureFPS","fps","memoryInterval","mem","usedMB","renderInterval","renderMetrics","avgRenderTime","originalFetch","apiLatencies","args","duration","avgLatency","positionClasses","getStatusColor","metric","threshold","Zap","TrendingUp","AlertCircle","PageLoader","Loader2","ManagerDashboard","lazy","DepartmentHeadDashboard","ExecutorDashboard","ExecutorSchedulePage","ExecutorStatsPage","ExecutorAnnouncementsPage","ResidentDashboard","AdminDashboard","DirectorDashboard","BuildingsPage","AnnouncementsPage","MeetingsPage","ResidentAnnouncementsPage","ResidentMeetingsPage","ResidentRateEmployeesPage","WorkOrdersPage","TrainingsPage","ColleaguesSection","ResidentVehiclesPage","VehicleSearchPage","ResidentGuestAccessPage","GuardQRScannerPage","ManagerGuestAccessPage","ResidentsPage","ChatPage","ResidentProfilePage","ResidentContractPage","ResidentUsefulContactsPage","AdvertiserDashboard","CouponCheckerDashboard","NotepadPage","TenantDashboard","ExecutorsPage","RequestsPage","RentalsPage","TeamPage","ReportsPage","SettingsPage","MonitoringPage","MarketplacePage","MarketplaceManagerDashboard","MarketplaceOrdersPage","Layout","logout","sidebarOpen","setSidebarOpen","getDashboard","getAnnouncementsPage","getMeetingsPage","getGuestAccessPage","Suspense","Routes","Route","DEMO_ACCOUNTS","Briefcase","UserCog","Crown","ShieldCheck","LoginPage","authLoading","authError","setLanguage","loginValue","setLoginValue","setPassword","showPassword","setShowPassword","setError","agreedToTerms","setAgreedToTerms","showOfferModal","setShowOfferModal","canAcceptOffer","setCanAcceptOffer","offerScrollRef","languages","handleOfferScroll","scrollTop","scrollHeight","clientHeight","handleAcceptOffer","handleSubmit","displayError","EyeOff","Eye","Check","Icon","PushNotificationPrompt","show","setShow","dismissed","setDismissed","isSubscribing","setIsSubscribing","dismissedKey","wasDismissed","lastDismissedTime","daysSinceDismissed","handleAllow","handleDismiss","ErrorBoundary","Component","props","errorInfo","errorLog","RefreshCw","App","fetchBuildings","fetchVehicles","BrowserRouter","createRoot","StrictMode"],"ignoreList":[],"sources":["../../src/services/api.ts","../../src/stores/authStore.ts","../../src/stores/crmStore.ts","../../src/services/pushNotifications.ts","../../src/stores/dataStore.ts","../../src/stores/languageStore.ts","../../src/stores/meetingStore.ts","../../src/components/common/AppLogo.tsx","../../src/components/layout/Sidebar.tsx","../../src/components/layout/MobileHeader.tsx","../../src/types/index.ts","../../src/components/layout/Header.tsx","../../src/hooks/usePopupNotifications.ts","../../src/hooks/useWebSocketSync.ts","../../src/components/PopupNotification.tsx","../../src/components/PerformanceMonitor.tsx","../../src/components/layout/Layout.tsx","../../src/pages/LoginPage.tsx","../../src/components/PushNotificationPrompt.tsx","../../src/components/ErrorBoundary.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["// API Client for UK CRM\r\n\r\nconst API_URL = '';\r\n\r\n// Get auth token from localStorage\r\nconst getToken = () => localStorage.getItem('auth_token');\r\n\r\n// Response wrapper type for consistent API handling\r\ninterface ApiResponse<T> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: string;\r\n}\r\n\r\n// === REQUEST CACHE & DEDUPLICATION ===\r\ninterface CacheEntry<T> {\r\n  data: T;\r\n  timestamp: number;\r\n  ttl: number;\r\n}\r\n\r\nconst requestCache = new Map<string, CacheEntry<unknown>>();\r\nconst pendingRequests = new Map<string, Promise<unknown>>();\r\n\r\n// Cache TTL values (ms)\r\nconst CACHE_TTL = {\r\n  SHORT: 10 * 1000,     // 10 sec - for frequently changing data (requests list)\r\n  MEDIUM: 60 * 1000,    // 1 min - for moderately changing data (executors)\r\n  LONG: 2 * 60 * 1000,  // 2 min - for buildings (reduced from 5 min for better sync)\r\n} as const;\r\n\r\n// Get cached data if valid\r\nfunction getCached<T>(key: string): T | null {\r\n  const entry = requestCache.get(key) as CacheEntry<T> | undefined;\r\n  if (!entry) return null;\r\n\r\n  const isExpired = Date.now() - entry.timestamp > entry.ttl;\r\n  if (isExpired) {\r\n    requestCache.delete(key);\r\n    return null;\r\n  }\r\n  return entry.data;\r\n}\r\n\r\n// Set cache with TTL\r\nfunction setCache<T>(key: string, data: T, ttl: number): void {\r\n  requestCache.set(key, { data, timestamp: Date.now(), ttl });\r\n}\r\n\r\n// Clear specific cache entries\r\nexport function invalidateCache(pattern?: string): void {\r\n  if (!pattern) {\r\n    requestCache.clear();\r\n    return;\r\n  }\r\n  for (const key of requestCache.keys()) {\r\n    if (key.includes(pattern)) {\r\n      requestCache.delete(key);\r\n    }\r\n  }\r\n}\r\n\r\n// Default timeout for API requests (30 seconds)\r\nconst API_TIMEOUT = 30000;\r\n\r\n// Helper for API requests - returns raw data for backward compatibility\r\nexport async function apiRequest<T>(\r\n  endpoint: string,\r\n  options: RequestInit = {},\r\n  timeout: number = API_TIMEOUT\r\n): Promise<T> {\r\n  const token = getToken();\r\n\r\n  const headers: HeadersInit = {\r\n    'Content-Type': 'application/json',\r\n    ...(token ? { 'Authorization': `Bearer ${token}` } : {}),\r\n    ...options.headers,\r\n  };\r\n\r\n  // Create abort controller for timeout\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n  try {\r\n    const response = await fetch(`${API_URL}${endpoint}`, {\r\n      ...options,\r\n      headers,\r\n      signal: controller.signal,\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    if (!response.ok) {\r\n      throw new Error(data.error || 'API Error');\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    if (error instanceof Error && error.name === 'AbortError') {\r\n      throw new Error('   .  .');\r\n    }\r\n    throw error;\r\n  } finally {\r\n    clearTimeout(timeoutId);\r\n  }\r\n}\r\n\r\n// Cached GET request with deduplication\r\nasync function cachedGet<T>(\r\n  endpoint: string,\r\n  ttl: number = CACHE_TTL.SHORT\r\n): Promise<T> {\r\n  const cacheKey = endpoint;\r\n\r\n  // Return cached data if available\r\n  const cached = getCached<T>(cacheKey);\r\n  if (cached) return cached;\r\n\r\n  // Deduplicate: if same request is in flight, wait for it\r\n  const pending = pendingRequests.get(cacheKey);\r\n  if (pending) return pending as Promise<T>;\r\n\r\n  // Make the request\r\n  const request = apiRequest<T>(endpoint).then(data => {\r\n    setCache(cacheKey, data, ttl);\r\n    pendingRequests.delete(cacheKey);\r\n    return data;\r\n  }).catch(err => {\r\n    pendingRequests.delete(cacheKey);\r\n    throw err;\r\n  });\r\n\r\n  pendingRequests.set(cacheKey, request);\r\n  return request;\r\n}\r\n\r\n// Helper for API requests - returns wrapped response { success, data, error }\r\nasync function apiRequestWrapped<T>(\r\n  endpoint: string,\r\n  options: RequestInit = {}\r\n): Promise<ApiResponse<T>> {\r\n  try {\r\n    const data = await apiRequest<T>(endpoint, options);\r\n    return { success: true, data };\r\n  } catch (error: any) {\r\n    return { success: false, error: error.message || 'API Error' };\r\n  }\r\n}\r\n\r\n// Transform user object from snake_case (API) to camelCase (frontend)\r\nfunction transformUser(user: any): any {\r\n  if (!user) return user;\r\n  return {\r\n    ...user,\r\n    // Map snake_case to camelCase for onboarding fields\r\n    passwordChangedAt: user.password_changed_at || user.passwordChangedAt,\r\n    contractSignedAt: user.contract_signed_at || user.contractSignedAt,\r\n    buildingId: user.building_id || user.buildingId,\r\n    totalArea: user.total_area || user.totalArea,\r\n    signatureKey: user.signature_key || user.signatureKey,\r\n    // Keep original fields too for backward compatibility\r\n  };\r\n}\r\n\r\n// Auth API\r\nexport const authApi = {\r\n  login: async (login: string, password: string) => {\r\n    const data = await apiRequest<{ user: any; token: string }>('/api/auth/login', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ login, password }),\r\n    });\r\n    localStorage.setItem('auth_token', data.token);\r\n    // Transform user fields from snake_case to camelCase\r\n    return { ...data, user: transformUser(data.user) };\r\n  },\r\n\r\n  logout: () => {\r\n    localStorage.removeItem('auth_token');\r\n  },\r\n\r\n  register: async (userData: {\r\n    login: string;\r\n    password: string;\r\n    name: string;\r\n    role: string;\r\n    phone?: string;\r\n    address?: string;\r\n    apartment?: string;\r\n    specialization?: string;\r\n    building_id?: string;\r\n    entrance?: string;\r\n    floor?: string;\r\n    branch?: string;\r\n    building?: string;\r\n  }) => {\r\n    return apiRequest<{ user: any }>('/api/auth/register', {\r\n      method: 'POST',\r\n      body: JSON.stringify(userData),\r\n    });\r\n  },\r\n\r\n  registerBulk: async (users: Array<{\r\n    login: string;\r\n    password: string;\r\n    name: string;\r\n    role: string;\r\n    phone?: string;\r\n    address?: string;\r\n    apartment?: string;\r\n    building_id?: string;\r\n    entrance?: string;\r\n    floor?: string;\r\n  }>) => {\r\n    return apiRequest<{ created: any[]; updated: any[] }>('/api/auth/register-bulk', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ users }),\r\n    });\r\n  },\r\n};\r\n\r\n// Users API\r\nexport const usersApi = {\r\n  getMe: async () => {\r\n    const data = await apiRequest<{ user: any }>('/api/users/me');\r\n    return { user: transformUser(data.user) };\r\n  },\r\n\r\n  updateMe: async (updates: { phone?: string; name?: string; language?: string }) => {\r\n    const data = await apiRequest<{ user: any }>('/api/users/me', {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n    return { user: transformUser(data.user) };\r\n  },\r\n\r\n  changePassword: async (currentPassword: string, newPassword: string) => {\r\n    return apiRequest<{ success: boolean; password_changed_at?: string }>('/api/users/me/password', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ current_password: currentPassword, new_password: newPassword }),\r\n    });\r\n  },\r\n\r\n  markContractSigned: async () => {\r\n    return apiRequest<{ success: boolean; contract_signed_at?: string }>('/api/users/me/contract-signed', {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  adminChangePassword: async (userId: string, newPassword: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/users/${userId}/password`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ new_password: newPassword }),\r\n    });\r\n  },\r\n\r\n  getAll: async (filters?: { role?: string; building_id?: string; limit?: number }) => {\r\n    const params = new URLSearchParams();\r\n    if (filters?.role) params.append('role', filters.role);\r\n    if (filters?.building_id) params.append('building_id', filters.building_id);\r\n    if (filters?.limit) params.append('limit', filters.limit.toString());\r\n    const query = params.toString();\r\n    return apiRequest<{ users: any[]; pagination?: any }>(`/api/users${query ? '?' + query : ''}`);\r\n  },\r\n\r\n  delete: async (userId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/users/${userId}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Vehicles API\r\nexport const vehiclesApi = {\r\n  // Get current user's vehicles only\r\n  getMyVehicles: async () => {\r\n    return cachedGet<{ vehicles: any[] }>('/api/vehicles', CACHE_TTL.MEDIUM);\r\n  },\r\n\r\n  // Get ALL vehicles with pagination (for staff: admin, manager, executor, department_head)\r\n  //   5000+ \r\n  getAll: async (options?: { page?: number; limit?: number; search?: string }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.page) params.append('page', String(options.page));\r\n    if (options?.limit) params.append('limit', String(options.limit));\r\n    if (options?.search) params.append('search', options.search);\r\n    const query = params.toString();\r\n    return apiRequest<{ vehicles: any[]; pagination?: { page: number; limit: number; total: number; totalPages: number } }>(\r\n      `/api/vehicles/all${query ? '?' + query : ''}`\r\n    );\r\n  },\r\n\r\n  getForResident: async (residentId: string) => {\r\n    return cachedGet<{ vehicles: any[] }>(`/api/vehicles?resident_id=${residentId}`, CACHE_TTL.MEDIUM);\r\n  },\r\n\r\n  create: async (vehicle: {\r\n    plate_number: string;\r\n    brand?: string;\r\n    model?: string;\r\n    color?: string;\r\n    year?: number;\r\n    vehicle_type?: string;\r\n    owner_type?: string;\r\n    company_name?: string;\r\n    parking_spot?: string;\r\n    notes?: string;\r\n    is_primary?: boolean;\r\n  }) => {\r\n    return apiRequest<{ vehicle: any }>('/api/vehicles', {\r\n      method: 'POST',\r\n      body: JSON.stringify(vehicle),\r\n    });\r\n  },\r\n\r\n  update: async (vehicleId: string, updates: {\r\n    plate_number?: string;\r\n    brand?: string;\r\n    model?: string;\r\n    color?: string;\r\n    year?: number;\r\n    vehicle_type?: string;\r\n    owner_type?: string;\r\n    company_name?: string;\r\n    parking_spot?: string;\r\n    notes?: string;\r\n    is_primary?: boolean;\r\n  }) => {\r\n    return apiRequest<{ vehicle: any }>(`/api/vehicles/${vehicleId}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (vehicleId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/vehicles/${vehicleId}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  search: async (plateNumber: string) => {\r\n    return apiRequest<{ vehicles: any[] }>(`/api/vehicles/search?plate=${encodeURIComponent(plateNumber)}`);\r\n  },\r\n};\r\n\r\n// Rentals API\r\nexport const rentalsApi = {\r\n  // Apartments\r\n  getApartments: async () => {\r\n    return apiRequest<{ apartments: any[] }>('/api/rentals/apartments');\r\n  },\r\n\r\n  // Get my apartments (for tenants/commercial_owners)\r\n  getMyApartments: async () => {\r\n    return apiRequest<{ apartments: any[]; records: any[] }>('/api/rentals/my-apartments');\r\n  },\r\n\r\n  createApartment: async (data: {\r\n    name: string;\r\n    address: string;\r\n    apartment?: string;\r\n    ownerName?: string;\r\n    ownerPhone?: string;\r\n    ownerLogin: string;\r\n    ownerPassword: string;\r\n    ownerType?: 'tenant' | 'commercial_owner';\r\n  }) => {\r\n    return apiRequest<{ apartment: any }>('/api/rentals/apartments', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  updateApartment: async (id: string, data: { name?: string; address?: string; apartment?: string; isActive?: boolean }) => {\r\n    return apiRequest<{ success: boolean }>(`/api/rentals/apartments/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  deleteApartment: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/rentals/apartments/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  // Records\r\n  getRecords: async (apartmentId?: string) => {\r\n    const url = apartmentId ? `/api/rentals/records?apartmentId=${apartmentId}` : '/api/rentals/records';\r\n    return apiRequest<{ records: any[] }>(url);\r\n  },\r\n\r\n  createRecord: async (data: {\r\n    apartmentId: string;\r\n    guestNames: string;\r\n    passportInfo?: string;\r\n    checkInDate: string;\r\n    checkOutDate: string;\r\n    amount?: number;\r\n    currency?: string;\r\n    notes?: string;\r\n  }) => {\r\n    return apiRequest<{ record: any }>('/api/rentals/records', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  updateRecord: async (id: string, data: {\r\n    guestNames?: string;\r\n    passportInfo?: string;\r\n    checkInDate?: string;\r\n    checkOutDate?: string;\r\n    amount?: number;\r\n    currency?: string;\r\n    notes?: string;\r\n  }) => {\r\n    return apiRequest<{ success: boolean }>(`/api/rentals/records/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  deleteRecord: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/rentals/records/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Guest Codes API\r\nexport const guestCodesApi = {\r\n  getAll: async () => {\r\n    return cachedGet<{ codes: any[] }>('/api/guest-codes', CACHE_TTL.SHORT);\r\n  },\r\n\r\n  getById: async (codeId: string) => {\r\n    return cachedGet<{ code: any }>(`/api/guest-codes/${codeId}`, CACHE_TTL.SHORT);\r\n  },\r\n\r\n  create: async (code: {\r\n    visitor_type: string;\r\n    visitor_name?: string;\r\n    visitor_phone?: string;\r\n    visitor_vehicle_plate?: string;\r\n    access_type: string;\r\n    valid_from?: string;\r\n    valid_until?: string;\r\n    resident_name?: string;\r\n    resident_phone?: string;\r\n    resident_apartment?: string;\r\n    resident_address?: string;\r\n    notes?: string;\r\n  }) => {\r\n    return apiRequest<{ code: any }>('/api/guest-codes', {\r\n      method: 'POST',\r\n      body: JSON.stringify(code),\r\n    });\r\n  },\r\n\r\n  revoke: async (codeId: string, reason?: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/guest-codes/${codeId}/revoke`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ reason }),\r\n    });\r\n  },\r\n\r\n  delete: async (codeId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/guest-codes/${codeId}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  validate: async (qrToken: string) => {\r\n    return apiRequest<{ valid: boolean; code?: any; error?: string; message?: string }>('/api/guest-codes/validate', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ qr_token: qrToken }),\r\n    });\r\n  },\r\n\r\n  use: async (codeId: string) => {\r\n    return apiRequest<{ success: boolean; code?: any }>(`/api/guest-codes/${codeId}/use`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  getLogs: async (codeId: string) => {\r\n    return apiRequest<{ logs: any[] }>(`/api/guest-codes/${codeId}/logs`);\r\n  },\r\n};\r\n\r\n// Chat API\r\nexport const chatApi = {\r\n  getChannels: async () => {\r\n    return apiRequest<{ channels: any[] }>('/api/chat/channels');\r\n  },\r\n\r\n  createChannel: async (channel: {\r\n    type: 'uk_general' | 'building_general' | 'admin_support' | 'private_support';\r\n    name: string;\r\n    description?: string;\r\n    building_id?: string;\r\n  }) => {\r\n    return apiRequest<{ channel: any }>('/api/chat/channels', {\r\n      method: 'POST',\r\n      body: JSON.stringify(channel),\r\n    });\r\n  },\r\n\r\n  getMessages: async (channelId: string, limit = 50, before?: string) => {\r\n    const params = new URLSearchParams({ limit: String(limit) });\r\n    if (before) params.append('before', before);\r\n    return apiRequest<{ messages: any[] }>(`/api/chat/channels/${channelId}/messages?${params}`);\r\n  },\r\n\r\n  sendMessage: async (channelId: string, content: string) => {\r\n    return apiRequest<{ message: any }>(`/api/chat/channels/${channelId}/messages`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ content }),\r\n    });\r\n  },\r\n\r\n  markRead: async (channelId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/chat/channels/${channelId}/read`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  // Mark specific message as read (for delivery checkmarks)\r\n  markMessageRead: async (channelId: string, messageId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/chat/channels/${channelId}/messages/${messageId}/read`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  // Get or create private support channel for current user (resident)\r\n  getOrCreateSupportChannel: async () => {\r\n    return apiRequest<any>('/api/chat/channels/support', {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  // Get all private support channels (admin/manager only)\r\n  getAllSupportChannels: async () => {\r\n    return apiRequest<{ channels: any[] }>('/api/chat/channels?type=private_support');\r\n  },\r\n\r\n  // Get unread message count for sidebar badge\r\n  getUnreadCount: async () => {\r\n    return apiRequest<{ unread_count: number }>('/api/chat/unread-count');\r\n  },\r\n};\r\n\r\n// Announcements API\r\nexport const announcementsApi = {\r\n  getAll: async () => {\r\n    return cachedGet<{ announcements: any[] }>('/api/announcements', CACHE_TTL.SHORT);\r\n  },\r\n\r\n  create: async (announcement: {\r\n    title: string;\r\n    content: string;\r\n    type: 'residents' | 'employees' | 'staff' | 'all';\r\n    target_type?: 'all' | 'branch' | 'building' | 'entrance' | 'floor' | 'custom';\r\n    target_branch?: string;\r\n    target_building_id?: string;\r\n    target_entrance?: string;\r\n    target_floor?: string;\r\n    target_logins?: string;\r\n    priority?: 'normal' | 'important' | 'urgent';\r\n    expires_at?: string;\r\n    attachments?: { name: string; url: string; type: string; size: number }[];\r\n  }) => {\r\n    const result = await apiRequest<{ id: string }>('/api/announcements', {\r\n      method: 'POST',\r\n      body: JSON.stringify(announcement),\r\n    });\r\n    invalidateCache('/api/announcements');\r\n    return result;\r\n  },\r\n\r\n  delete: async (announcementId: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/announcements/${announcementId}`, {\r\n      method: 'DELETE',\r\n    });\r\n    invalidateCache('/api/announcements');\r\n    return result;\r\n  },\r\n\r\n  // Update announcement\r\n  update: async (announcementId: string, data: {\r\n    title?: string;\r\n    content?: string;\r\n    type?: 'residents' | 'employees' | 'all';\r\n    priority?: 'normal' | 'important' | 'urgent';\r\n    target_type?: string;\r\n    target_building_id?: string;\r\n    target_entrance?: string;\r\n    target_floor?: string;\r\n    target_logins?: string;\r\n    expires_at?: string;\r\n    attachments?: { name: string; url: string; type: string; size: number }[] | null;\r\n  }) => {\r\n    const result = await apiRequest<{ announcement: any }>(`/api/announcements/${announcementId}`, {\r\n      method: 'PUT',\r\n      body: JSON.stringify(data),\r\n    });\r\n    invalidateCache('/api/announcements');\r\n    return result;\r\n  },\r\n\r\n  // Mark announcement as viewed\r\n  markAsViewed: async (announcementId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/announcements/${announcementId}/view`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  // Get views for an announcement (admin/manager can see viewers list and stats)\r\n  getViews: async (announcementId: string) => {\r\n    return apiRequest<{\r\n      count: number;\r\n      targetAudienceSize: number;\r\n      viewPercentage: number;\r\n      viewers: any[];\r\n      userViewed: boolean;\r\n    }>(`/api/announcements/${announcementId}/views`);\r\n  },\r\n};\r\n\r\n// File Upload API\r\nexport const uploadApi = {\r\n  // Upload a file and get a data URL back\r\n  uploadFile: async (file: File): Promise<{ name: string; url: string; type: string; size: number }> => {\r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n\r\n    const token = localStorage.getItem('auth_token');\r\n    const response = await fetch(`${API_URL}/api/upload`, {\r\n      method: 'POST',\r\n      headers: token ? { 'Authorization': `Bearer ${token}` } : {},\r\n      body: formData,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.error || 'Upload failed');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.file;\r\n  },\r\n\r\n  // Upload multiple files\r\n  uploadFiles: async (files: File[]): Promise<{ name: string; url: string; type: string; size: number }[]> => {\r\n    const results = await Promise.all(files.map(file => uploadApi.uploadFile(file)));\r\n    return results;\r\n  },\r\n};\r\n\r\n// Branches API (CRM)\r\nexport const branchesApi = {\r\n  getAll: async () => {\r\n    return cachedGet<{ branches: any[] }>('/api/branches', CACHE_TTL.LONG);\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ branch: any }>(`/api/branches/${id}`);\r\n  },\r\n};\r\n\r\n// Buildings API (CRM)\r\nexport const buildingsApi = {\r\n  getAll: async () => {\r\n    // Buildings rarely change - use long cache\r\n    return cachedGet<{ buildings: any[] }>('/api/buildings', CACHE_TTL.LONG);\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return cachedGet<{ building: any; entrances: any[]; documents: any[] }>(`/api/buildings/${id}`, CACHE_TTL.LONG);\r\n  },\r\n\r\n  create: async (building: {\r\n    name: string;\r\n    address: string;\r\n    zone?: string;\r\n    cadastralNumber?: string;\r\n    branchCode?: string;\r\n    buildingNumber?: string;\r\n    floors?: number;\r\n    entrances?: number;\r\n    totalApartments?: number;\r\n    totalArea?: number;\r\n    livingArea?: number;\r\n    commonArea?: number;\r\n    landArea?: number;\r\n    yearBuilt?: number;\r\n    yearRenovated?: number;\r\n    buildingType?: string;\r\n    roofType?: string;\r\n    wallMaterial?: string;\r\n    foundationType?: string;\r\n    hasElevator?: boolean;\r\n    elevatorCount?: number;\r\n    hasGas?: boolean;\r\n    heatingType?: string;\r\n    hasHotWater?: boolean;\r\n    waterSupplyType?: string;\r\n    sewerageType?: string;\r\n    hasIntercom?: boolean;\r\n    hasVideoSurveillance?: boolean;\r\n    hasConcierge?: boolean;\r\n    hasParkingLot?: boolean;\r\n    parkingSpaces?: number;\r\n    hasPlayground?: boolean;\r\n    managerId?: string;\r\n    managerName?: string;\r\n    monthlyBudget?: number;\r\n    reserveFund?: number;\r\n  }) => {\r\n    const result = await apiRequest<{ building: any }>('/api/buildings', {\r\n      method: 'POST',\r\n      body: JSON.stringify(building),\r\n    });\r\n    // Invalidate buildings cache after creation\r\n    invalidateCache('/api/buildings');\r\n    return result;\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    name: string;\r\n    address: string;\r\n    zone: string;\r\n    cadastralNumber: string;\r\n    branchCode: string;\r\n    buildingNumber: string;\r\n    floors: number;\r\n    entrances: number;\r\n    totalApartments: number;\r\n    totalArea: number;\r\n    livingArea: number;\r\n    commonArea: number;\r\n    landArea: number;\r\n    yearBuilt: number;\r\n    yearRenovated: number;\r\n    buildingType: string;\r\n    roofType: string;\r\n    wallMaterial: string;\r\n    foundationType: string;\r\n    hasElevator: boolean;\r\n    elevatorCount: number;\r\n    hasGas: boolean;\r\n    heatingType: string;\r\n    hasHotWater: boolean;\r\n    waterSupplyType: string;\r\n    sewerageType: string;\r\n    hasIntercom: boolean;\r\n    hasVideoSurveillance: boolean;\r\n    hasConcierge: boolean;\r\n    hasParkingLot: boolean;\r\n    parkingSpaces: number;\r\n    hasPlayground: boolean;\r\n    managerId: string;\r\n    managerName: string;\r\n    monthlyBudget: number;\r\n    reserveFund: number;\r\n    totalDebt: number;\r\n    collectionRate: number;\r\n  }>) => {\r\n    const result = await apiRequest<{ building: any }>(`/api/buildings/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n    // Invalidate buildings cache after update\r\n    invalidateCache('/api/buildings');\r\n    return result;\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/buildings/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n    // Invalidate buildings cache after deletion\r\n    invalidateCache('/api/buildings');\r\n    return result;\r\n  },\r\n};\r\n\r\n// Entrances API (CRM)\r\nexport const entrancesApi = {\r\n  getByBuilding: async (buildingId: string) => {\r\n    return apiRequest<{ entrances: any[] }>(`/api/buildings/${buildingId}/entrances`);\r\n  },\r\n\r\n  create: async (buildingId: string, entrance: {\r\n    number: number;\r\n    floorsFrom?: number;\r\n    floorsTo?: number;\r\n    apartmentsFrom?: number;\r\n    apartmentsTo?: number;\r\n    hasElevator?: boolean;\r\n    elevatorId?: string;\r\n    intercomType?: string;\r\n    intercomCode?: string;\r\n    cleaningSchedule?: string;\r\n    responsibleId?: string;\r\n    notes?: string;\r\n  }) => {\r\n    return apiRequest<{ entrance: any }>(`/api/buildings/${buildingId}/entrances`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(entrance),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    number: number;\r\n    floorsFrom: number;\r\n    floorsTo: number;\r\n    apartmentsFrom: number;\r\n    apartmentsTo: number;\r\n    hasElevator: boolean;\r\n    elevatorId: string;\r\n    intercomType: string;\r\n    intercomCode: string;\r\n    cleaningSchedule: string;\r\n    responsibleId: string;\r\n    lastInspection: string;\r\n    notes: string;\r\n  }>) => {\r\n    return apiRequest<{ entrance: any }>(`/api/entrances/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/entrances/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Building Documents API (CRM)\r\nexport const buildingDocumentsApi = {\r\n  getByBuilding: async (buildingId: string) => {\r\n    return apiRequest<{ documents: any[] }>(`/api/buildings/${buildingId}/documents`);\r\n  },\r\n\r\n  create: async (buildingId: string, document: {\r\n    name: string;\r\n    type?: string;\r\n    fileUrl: string;\r\n    fileSize?: number;\r\n    expiresAt?: string;\r\n  }) => {\r\n    return apiRequest<{ document: any }>(`/api/buildings/${buildingId}/documents`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(document),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/building-documents/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Apartments API (CRM)\r\nexport const apartmentsApi = {\r\n  getByBuilding: async (buildingId: string, options?: {\r\n    entranceId?: string;\r\n    status?: string;\r\n    page?: number;\r\n    limit?: number;\r\n  }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.entranceId) params.append('entrance_id', options.entranceId);\r\n    if (options?.status) params.append('status', options.status);\r\n    if (options?.page) params.append('page', options.page.toString());\r\n    if (options?.limit) params.append('limit', options.limit.toString());\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ apartments: any[]; pagination: { page: number; limit: number; total: number; pages: number } }>(\r\n      `/api/buildings/${buildingId}/apartments${query}`\r\n    );\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ apartment: any; owners: any[]; personalAccount: any }>(`/api/apartments/${id}`);\r\n  },\r\n\r\n  create: async (buildingId: string, apartment: {\r\n    number: string;\r\n    entranceId?: string;\r\n    floor?: number;\r\n    totalArea?: number;\r\n    livingArea?: number;\r\n    kitchenArea?: number;\r\n    rooms?: number;\r\n    hasBalcony?: boolean;\r\n    hasLoggia?: boolean;\r\n    status?: string;\r\n  }) => {\r\n    return apiRequest<{ apartment: any }>(`/api/buildings/${buildingId}/apartments`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(apartment),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    entranceId: string;\r\n    number: string;\r\n    floor: number;\r\n    totalArea: number;\r\n    livingArea: number;\r\n    rooms: number;\r\n    status: string;\r\n    primaryOwnerId: string;\r\n    personalAccountId: string;\r\n  }>) => {\r\n    return apiRequest<{ apartment: any }>(`/api/apartments/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/apartments/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Owners API (CRM)\r\nexport const ownersApi = {\r\n  getAll: async (options?: { type?: string; search?: string; page?: number; limit?: number }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.type) params.append('type', options.type);\r\n    if (options?.search) params.append('search', options.search);\r\n    if (options?.page) params.append('page', options.page.toString());\r\n    if (options?.limit) params.append('limit', options.limit.toString());\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ owners: any[]; pagination: { page: number; limit: number; total: number; pages: number } }>(\r\n      `/api/owners${query}`\r\n    );\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ owner: any; apartments: any[] }>(`/api/owners/${id}`);\r\n  },\r\n\r\n  create: async (owner: {\r\n    type?: string;\r\n    lastName?: string;\r\n    firstName?: string;\r\n    middleName?: string;\r\n    fullName?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    ownershipType?: string;\r\n    ownershipShare?: number;\r\n  }) => {\r\n    return apiRequest<{ owner: any }>('/api/owners', {\r\n      method: 'POST',\r\n      body: JSON.stringify(owner),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    lastName: string;\r\n    firstName: string;\r\n    middleName: string;\r\n    fullName: string;\r\n    phone: string;\r\n    email: string;\r\n    isActive: boolean;\r\n    isVerified: boolean;\r\n  }>) => {\r\n    return apiRequest<{ owner: any }>(`/api/owners/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/owners/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  linkToApartment: async (ownerId: string, apartmentId: string, data?: {\r\n    ownershipShare?: number;\r\n    isPrimary?: boolean;\r\n    startDate?: string;\r\n  }) => {\r\n    return apiRequest<{ success: boolean }>(`/api/owners/${ownerId}/apartments/${apartmentId}`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(data || {}),\r\n    });\r\n  },\r\n\r\n  unlinkFromApartment: async (ownerId: string, apartmentId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/owners/${ownerId}/apartments/${apartmentId}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Personal Accounts API (CRM)\r\nexport const personalAccountsApi = {\r\n  getByBuilding: async (buildingId: string, options?: {\r\n    status?: string;\r\n    hasDebt?: boolean;\r\n    page?: number;\r\n    limit?: number;\r\n  }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.status) params.append('status', options.status);\r\n    if (options?.hasDebt) params.append('has_debt', 'true');\r\n    if (options?.page) params.append('page', options.page.toString());\r\n    if (options?.limit) params.append('limit', options.limit.toString());\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ accounts: any[]; pagination: { page: number; limit: number; total: number; pages: number } }>(\r\n      `/api/buildings/${buildingId}/accounts${query}`\r\n    );\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ account: any }>(`/api/accounts/${id}`);\r\n  },\r\n\r\n  create: async (account: {\r\n    apartmentId: string;\r\n    buildingId: string;\r\n    primaryOwnerId?: string;\r\n    ownerName?: string;\r\n    apartmentNumber?: string;\r\n    totalArea?: number;\r\n    residentsCount?: number;\r\n    balance?: number;\r\n    currentDebt?: number;\r\n  }) => {\r\n    return apiRequest<{ account: any }>('/api/accounts', {\r\n      method: 'POST',\r\n      body: JSON.stringify(account),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    ownerName: string;\r\n    balance: number;\r\n    currentDebt: number;\r\n    penaltyAmount: number;\r\n    status: string;\r\n  }>) => {\r\n    return apiRequest<{ account: any }>(`/api/accounts/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  getDebtors: async (options?: { minDebt?: number; buildingId?: string }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.minDebt) params.append('min_debt', options.minDebt.toString());\r\n    if (options?.buildingId) params.append('building_id', options.buildingId);\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ debtors: any[] }>(`/api/accounts/debtors${query}`);\r\n  },\r\n};\r\n\r\n// CRM Residents API\r\nexport const crmResidentsApi = {\r\n  getByApartment: async (apartmentId: string, options?: { isActive?: boolean }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.isActive !== undefined) params.append('is_active', options.isActive.toString());\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ residents: any[] }>(`/api/apartments/${apartmentId}/residents${query}`);\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ resident: any }>(`/api/residents/${id}`);\r\n  },\r\n\r\n  create: async (apartmentId: string, resident: {\r\n    lastName?: string;\r\n    firstName?: string;\r\n    middleName?: string;\r\n    fullName?: string;\r\n    birthDate?: string;\r\n    residentType?: string;\r\n    relationToOwner?: string;\r\n    registrationType?: string;\r\n    registrationDate?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    movedInDate?: string;\r\n    ownerId?: string;\r\n  }) => {\r\n    return apiRequest<{ resident: any }>(`/api/apartments/${apartmentId}/residents`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(resident),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    lastName: string;\r\n    firstName: string;\r\n    middleName: string;\r\n    fullName: string;\r\n    birthDate: string;\r\n    residentType: string;\r\n    phone: string;\r\n    email: string;\r\n    isActive: boolean;\r\n    movedOutDate: string;\r\n    movedOutReason: string;\r\n  }>) => {\r\n    return apiRequest<{ resident: any }>(`/api/residents/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/residents/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  moveOut: async (id: string, data: { movedOutDate?: string; reason?: string }) => {\r\n    return apiRequest<{ success: boolean }>(`/api/residents/${id}/move-out`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n};\r\n\r\n// Meters API (CRM)\r\nexport const metersApi = {\r\n  getByApartment: async (apartmentId: string, options?: { type?: string; isActive?: boolean }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.type) params.append('type', options.type);\r\n    if (options?.isActive !== undefined) params.append('is_active', options.isActive.toString());\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ meters: any[] }>(`/api/apartments/${apartmentId}/meters${query}`);\r\n  },\r\n\r\n  getByBuilding: async (buildingId: string, options?: { type?: string; isCommon?: boolean }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.type) params.append('type', options.type);\r\n    if (options?.isCommon !== undefined) params.append('is_common', options.isCommon.toString());\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ meters: any[] }>(`/api/buildings/${buildingId}/meters${query}`);\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ meter: any; readings: any[] }>(`/api/meters/${id}`);\r\n  },\r\n\r\n  create: async (meter: {\r\n    apartmentId?: string;\r\n    buildingId?: string;\r\n    type: 'cold_water' | 'hot_water' | 'electricity' | 'gas' | 'heating';\r\n    isCommon?: boolean;\r\n    serialNumber: string;\r\n    model?: string;\r\n    brand?: string;\r\n    installDate?: string;\r\n    location?: string;\r\n    initialValue?: number;\r\n    verificationDate?: string;\r\n    nextVerificationDate?: string;\r\n    sealNumber?: string;\r\n  }) => {\r\n    return apiRequest<{ meter: any }>('/api/meters', {\r\n      method: 'POST',\r\n      body: JSON.stringify(meter),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    serialNumber: string;\r\n    model: string;\r\n    brand: string;\r\n    location: string;\r\n    verificationDate: string;\r\n    nextVerificationDate: string;\r\n    sealNumber: string;\r\n    isActive: boolean;\r\n    currentValue: number;\r\n    lastReadingDate: string;\r\n    notes: string;\r\n  }>) => {\r\n    return apiRequest<{ meter: any }>(`/api/meters/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/meters/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  decommission: async (id: string, reason?: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/meters/${id}/decommission`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ reason }),\r\n    });\r\n  },\r\n};\r\n\r\n// Meter Readings API\r\nexport const meterReadingsApi = {\r\n  getByMeter: async (meterId: string, options?: { limit?: number; offset?: number; status?: string }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.limit) params.append('limit', options.limit.toString());\r\n    if (options?.offset) params.append('offset', options.offset.toString());\r\n    if (options?.status) params.append('status', options.status);\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ readings: any[] }>(`/api/meters/${meterId}/readings${query}`);\r\n  },\r\n\r\n  getLastReading: async (meterId: string) => {\r\n    return apiRequest<{ reading: any | null }>(`/api/meters/${meterId}/last-reading`);\r\n  },\r\n\r\n  submit: async (meterId: string, reading: {\r\n    value: number;\r\n    readingDate?: string;\r\n    photoUrl?: string;\r\n    notes?: string;\r\n  }) => {\r\n    return apiRequest<{ reading: any }>(`/api/meters/${meterId}/readings`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(reading),\r\n    });\r\n  },\r\n\r\n  verify: async (readingId: string, data: { approved: boolean; rejectionReason?: string }) => {\r\n    return apiRequest<{ success: boolean }>(`/api/meter-readings/${readingId}/verify`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n};\r\n\r\n// Team API (Admin only - get all staff: managers, department heads, executors)\r\nexport const teamApi = {\r\n  getAll: async () => {\r\n    // Always fetch fresh data, no caching\r\n    return apiRequest<{\r\n      managers: any[];\r\n      departmentHeads: any[];\r\n      executors: any[];\r\n    }>('/api/team', { cache: 'no-store' });\r\n  },\r\n\r\n  // Get single staff member by ID (for live data refresh with password)\r\n  getById: async (userId: string) => {\r\n    // Always fetch fresh data, no caching\r\n    return apiRequest<{ user: any }>(`/api/team/${userId}`, { cache: 'no-store' });\r\n  },\r\n\r\n  // Create new staff member (uses auth/register endpoint)\r\n  create: async (data: {\r\n    login: string;\r\n    password: string;\r\n    name: string;\r\n    phone: string;\r\n    role: 'manager' | 'department_head' | 'executor';\r\n    specialization?: string;\r\n  }) => {\r\n    return apiRequest<{ user: any }>('/api/auth/register', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  update: async (userId: string, data: {\r\n    name?: string;\r\n    phone?: string;\r\n    login?: string;\r\n    password?: string;\r\n    specialization?: string;\r\n    status?: string;\r\n  }) => {\r\n    return apiRequest<{ user: any }>(`/api/team/${userId}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  // Delete staff member\r\n  delete: async (userId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/team/${userId}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  // Reset passwords for all staff without password_plain (admin only, one-time operation)\r\n  resetAllPasswords: async () => {\r\n    return apiRequest<{\r\n      message: string;\r\n      updated: number;\r\n      staff: { id: string; login: string; name: string; password: string }[];\r\n    }>('/api/team/reset-all-passwords', {\r\n      method: 'POST',\r\n    });\r\n  },\r\n};\r\n\r\n// Executors API\r\nexport const executorsApi = {\r\n  getAll: async (showAll = false) => {\r\n    const url = showAll ? '/api/executors?all=true' : '/api/executors';\r\n    // No caching for executors - always fetch fresh data for accurate assignment\r\n    return apiRequest<{ executors: any[] }>(url, { cache: 'no-store' });\r\n  },\r\n\r\n  // Get single executor by ID (for live data refresh with password)\r\n  getById: async (executorId: string) => {\r\n    // Always fetch fresh data, no caching\r\n    return apiRequest<{ executor: any }>(`/api/executors/${executorId}`, { cache: 'no-store' });\r\n  },\r\n\r\n  updateStatus: async (executorId: string, status: 'available' | 'busy' | 'offline') => {\r\n    return apiRequest<{ executor: any }>(`/api/executors/${executorId}/status`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify({ status }),\r\n    });\r\n  },\r\n\r\n  // Get executor stats (rating, completed count, weekly, avg time)\r\n  getStats: async (executorId: string) => {\r\n    return apiRequest<{\r\n      stats: {\r\n        totalCompleted: number;\r\n        thisWeek: number;\r\n        thisMonth: number;\r\n        rating: number;\r\n        avgCompletionTime: number;\r\n        statusBreakdown: Array<{ status: string; count: number }>;\r\n      }\r\n    }>(`/api/executors/${executorId}/stats`);\r\n  },\r\n};\r\n\r\n// Requests API\r\nexport const requestsApi = {\r\n  getAll: async (status?: string, category?: string) => {\r\n    const params = new URLSearchParams();\r\n    if (status) params.append('status', status);\r\n    if (category) params.append('category', category);\r\n    const queryString = params.toString();\r\n    // Use cached GET with short TTL (10s) - requests change frequently\r\n    return cachedGet<{ requests: any[] }>(`/api/requests${queryString ? '?' + queryString : ''}`, CACHE_TTL.SHORT);\r\n  },\r\n\r\n  create: async (request: {\r\n    category_id: string;\r\n    title: string;\r\n    description?: string;\r\n    priority?: 'low' | 'medium' | 'high' | 'urgent';\r\n    access_info?: string;\r\n    scheduled_at?: string;\r\n    // For manual creation by managers/admins - specify resident\r\n    resident_id?: string;\r\n  }) => {\r\n    const result = await apiRequest<{ request: any }>('/api/requests', {\r\n      method: 'POST',\r\n      body: JSON.stringify(request),\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  update: async (requestId: string, updates: {\r\n    status?: string;\r\n    executor_id?: string;\r\n    rating?: number;\r\n    feedback?: string;\r\n  }) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  assign: async (requestId: string, executorId: string) => {\r\n    const result = await apiRequest<{ request: any }>(`/api/requests/${requestId}/assign`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ executor_id: executorId }),\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  accept: async (requestId: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/accept`, {\r\n      method: 'POST',\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  start: async (requestId: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/start`, {\r\n      method: 'POST',\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  complete: async (requestId: string) => {\r\n    invalidateCache('/api/requests');\r\n    return apiRequest<{ success: boolean }>(`/api/requests/${requestId}/complete`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  pause: async (requestId: string) => {\r\n    const result = await apiRequest<{ success: boolean; request: any }>(`/api/requests/${requestId}/pause`, {\r\n      method: 'POST',\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  resume: async (requestId: string) => {\r\n    const result = await apiRequest<{ success: boolean; request: any; totalPausedTime: number }>(`/api/requests/${requestId}/resume`, {\r\n      method: 'POST',\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  // Resident approves completed work\r\n  approve: async (requestId: string, rating?: number, feedback?: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/approve`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ rating, feedback }),\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  // Resident rejects work (sends back to executor)\r\n  reject: async (requestId: string, reason: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/reject`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ reason }),\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  // Legacy rate endpoint (for backward compatibility)\r\n  rate: async (requestId: string, rating: number, feedback?: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/requests/${requestId}/rate`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ rating, feedback }),\r\n    });\r\n  },\r\n\r\n  // Cancel request\r\n  cancel: async (requestId: string, reason: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/cancel`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ reason }),\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  // Decline/Release request (executor releases the request back to queue)\r\n  decline: async (requestId: string, reason: string) => {\r\n    const result = await apiRequest<{ success: boolean }>(`/api/requests/${requestId}/decline`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ reason }),\r\n    });\r\n    invalidateCache('/api/requests');\r\n    return result;\r\n  },\r\n\r\n  // Reschedule requests\r\n  createReschedule: async (requestId: string, data: {\r\n    proposed_date: string;\r\n    proposed_time: string;\r\n    reason: string;\r\n    reason_text?: string;\r\n  }) => {\r\n    return apiRequest<{ reschedule: any }>(`/api/requests/${requestId}/reschedule`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  getReschedules: async (requestId: string) => {\r\n    return apiRequest<{ reschedules: any[] }>(`/api/requests/${requestId}/reschedule`);\r\n  },\r\n};\r\n\r\n// Reschedule API (for pending reschedules)\r\nexport const rescheduleApi = {\r\n  // Get pending reschedules for current user\r\n  getPending: async () => {\r\n    return apiRequest<{ reschedules: any[] }>('/api/reschedule-requests');\r\n  },\r\n\r\n  // Respond to reschedule request\r\n  respond: async (rescheduleId: string, accepted: boolean, responseNote?: string) => {\r\n    return apiRequest<{ reschedule: any }>(`/api/reschedule-requests/${rescheduleId}/respond`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ accepted, response_note: responseNote }),\r\n    });\r\n  },\r\n};\r\n\r\n// Ratings API\r\nexport const ratingsApi = {\r\n  getForExecutor: async (executorId: string) => {\r\n    return apiRequest<{ ratings: any[]; average: any }>(`/api/ratings?executor_id=${executorId}`);\r\n  },\r\n\r\n  create: async (rating: {\r\n    executor_id: string;\r\n    quality: number;\r\n    speed: number;\r\n    politeness: number;\r\n    comment?: string;\r\n  }) => {\r\n    return apiRequest<{ rating: any }>('/api/ratings', {\r\n      method: 'POST',\r\n      body: JSON.stringify(rating),\r\n    });\r\n  },\r\n};\r\n\r\n// Categories API\r\nexport const categoriesApi = {\r\n  getAll: async () => {\r\n    return apiRequest<{ categories: any[] }>('/api/categories');\r\n  },\r\n};\r\n\r\n// Stats API\r\nexport const statsApi = {\r\n  getDashboard: async () => {\r\n    return apiRequest<any>('/api/stats/dashboard');\r\n  },\r\n};\r\n\r\n// Meetings API\r\nexport const meetingsApi = {\r\n  getAll: async () => {\r\n    return cachedGet<{ meetings: any[] }>('/api/meetings', CACHE_TTL.MEDIUM);\r\n  },\r\n\r\n  create: async (meeting: {\r\n    title: string;\r\n    description?: string;\r\n    date: string;\r\n    time: string;\r\n    location?: string;\r\n    type?: 'general' | 'emergency' | 'committee';\r\n    target_building_id?: string;\r\n  }) => {\r\n    return apiRequest<{ meeting: any }>('/api/meetings', {\r\n      method: 'POST',\r\n      body: JSON.stringify(meeting),\r\n    });\r\n  },\r\n\r\n  createVote: async (meetingId: string, vote: {\r\n    question: string;\r\n    options: string[];\r\n  }) => {\r\n    return apiRequest<{ vote: any }>(`/api/meetings/${meetingId}/votes`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(vote),\r\n    });\r\n  },\r\n\r\n  submitVote: async (voteId: string, optionIndex: number) => {\r\n    return apiRequest<{ response: any }>(`/api/votes/${voteId}/respond`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ option_index: optionIndex }),\r\n    });\r\n  },\r\n};\r\n\r\n// ==================== TRAINING SYSTEM API ====================\r\n\r\n// Training Partners API\r\nexport const trainingPartnersApi = {\r\n  getAll: async (activeOnly?: boolean) => {\r\n    const query = activeOnly ? '?active=true' : '';\r\n    return apiRequest<{ partners: any[] }>(`/api/training/partners${query}`);\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ partner: any }>(`/api/training/partners/${id}`);\r\n  },\r\n\r\n  create: async (partner: {\r\n    name: string;\r\n    position?: string;\r\n    specialization?: string;\r\n    email?: string;\r\n    phone?: string;\r\n    bio?: string;\r\n    avatarUrl?: string;\r\n    isActive?: boolean;\r\n  }) => {\r\n    return apiRequest<{ partner: any }>('/api/training/partners', {\r\n      method: 'POST',\r\n      body: JSON.stringify(partner),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    name: string;\r\n    position: string;\r\n    specialization: string;\r\n    email: string;\r\n    phone: string;\r\n    bio: string;\r\n    avatarUrl: string;\r\n    isActive: boolean;\r\n  }>) => {\r\n    return apiRequest<{ partner: any }>(`/api/training/partners/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/training/partners/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Training Proposals API\r\nexport const trainingProposalsApi = {\r\n  getAll: async (options?: {\r\n    status?: string;\r\n    partnerId?: string;\r\n    authorId?: string;\r\n    page?: number;\r\n    limit?: number;\r\n  }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.status) params.append('status', options.status);\r\n    if (options?.partnerId) params.append('partner_id', options.partnerId);\r\n    if (options?.authorId) params.append('author_id', options.authorId);\r\n    if (options?.page) params.append('page', options.page.toString());\r\n    if (options?.limit) params.append('limit', options.limit.toString());\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequest<{ proposals: any[] }>(`/api/training/proposals${query}`);\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}`);\r\n  },\r\n\r\n  create: async (proposal: {\r\n    topic: string;\r\n    description?: string;\r\n    partnerId: string;\r\n    format?: 'online' | 'offline' | 'any';\r\n    preferredTimeSlots?: string[];\r\n    isAuthorAnonymous?: boolean;\r\n  }) => {\r\n    return apiRequest<{ proposal: any }>('/api/training/proposals', {\r\n      method: 'POST',\r\n      body: JSON.stringify(proposal),\r\n    });\r\n  },\r\n\r\n  update: async (id: string, updates: Partial<{\r\n    topic: string;\r\n    description: string;\r\n    format: string;\r\n    status: string;\r\n    preferredTimeSlots: string[];\r\n    partnerResponse: 'accepted' | 'rejected';\r\n    partnerResponseNote: string;\r\n  }>) => {\r\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    });\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  schedule: async (id: string, data: {\r\n    scheduledDate: string;\r\n    scheduledTime: string;\r\n    scheduledLocation?: string;\r\n    scheduledLink?: string;\r\n    maxParticipants?: number;\r\n  }) => {\r\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}/schedule`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  complete: async (id: string, data?: { actualParticipantsCount?: number }) => {\r\n    return apiRequest<{ proposal: any }>(`/api/training/proposals/${id}/complete`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(data || {}),\r\n    });\r\n  },\r\n};\r\n\r\n// Training Votes API\r\nexport const trainingVotesApi = {\r\n  getForProposal: async (proposalId: string) => {\r\n    return apiRequest<{ votes: any[] }>(`/api/training/proposals/${proposalId}/votes`);\r\n  },\r\n\r\n  vote: async (proposalId: string, data: {\r\n    participationIntent?: 'definitely' | 'maybe' | 'support_only';\r\n    isAnonymous?: boolean;\r\n  }) => {\r\n    return apiRequest<{ vote: any }>(`/api/training/proposals/${proposalId}/votes`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  removeVote: async (proposalId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${proposalId}/votes`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// Training Registrations API\r\nexport const trainingRegistrationsApi = {\r\n  register: async (proposalId: string) => {\r\n    return apiRequest<{ registration: any }>(`/api/training/proposals/${proposalId}/register`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  unregister: async (proposalId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${proposalId}/register`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  confirmAttendance: async (proposalId: string, userId: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/training/proposals/${proposalId}/attendance/${userId}`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n};\r\n\r\n// Training Feedback API\r\nexport const trainingFeedbackApi = {\r\n  getForProposal: async (proposalId: string) => {\r\n    return apiRequest<{ feedback: any[] }>(`/api/training/proposals/${proposalId}/feedback`);\r\n  },\r\n\r\n  submit: async (proposalId: string, feedback: {\r\n    rating: number;\r\n    contentRating?: number;\r\n    presenterRating?: number;\r\n    usefulnessRating?: number;\r\n    comment?: string;\r\n    isAnonymous?: boolean;\r\n  }) => {\r\n    return apiRequest<{ feedback: any }>(`/api/training/proposals/${proposalId}/feedback`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(feedback),\r\n    });\r\n  },\r\n};\r\n\r\n// Training Notifications API\r\nexport const trainingNotificationsApi = {\r\n  getAll: async (unreadOnly?: boolean) => {\r\n    const query = unreadOnly ? '?unread=true' : '';\r\n    return apiRequest<{ notifications: any[] }>(`/api/training/notifications${query}`);\r\n  },\r\n\r\n  markAsRead: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/training/notifications/${id}/read`, {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  markAllAsRead: async () => {\r\n    return apiRequest<{ success: boolean }>('/api/training/notifications/read-all', {\r\n      method: 'POST',\r\n    });\r\n  },\r\n};\r\n\r\n// Training Settings API\r\nexport const trainingSettingsApi = {\r\n  getAll: async () => {\r\n    return apiRequest<{ settings: Record<string, any> }>('/api/training/settings');\r\n  },\r\n\r\n  update: async (settings: Record<string, any>) => {\r\n    return apiRequest<{ success: boolean }>('/api/training/settings', {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(settings),\r\n    });\r\n  },\r\n};\r\n\r\n// Training Stats API\r\nexport const trainingStatsApi = {\r\n  get: async () => {\r\n    return apiRequest<{ stats: {\r\n      totalProposals: number;\r\n      votingProposals: number;\r\n      scheduledTrainings: number;\r\n      completedTrainings: number;\r\n      totalVotes: number;\r\n      totalParticipants: number;\r\n      averageRating: number;\r\n    } }>('/api/training/stats');\r\n  },\r\n};\r\n\r\n// ==================== MEETING SYSTEM API ====================\r\n\r\n// Meetings API (Full OSS workflow) - Uses wrapped responses for meetingStore compatibility\r\nexport const meetingsFullApi = {\r\n  getAll: async (options?: {\r\n    buildingId?: string;\r\n    status?: string;\r\n    organizerId?: string;\r\n    onlyActive?: boolean; //  NEW: Filter for active meetings only\r\n  }) => {\r\n    const params = new URLSearchParams();\r\n    if (options?.buildingId) params.append('building_id', options.buildingId);\r\n    if (options?.status) params.append('status', options.status);\r\n    if (options?.organizerId) params.append('organizer_id', options.organizerId);\r\n    if (options?.onlyActive) params.append('only_active', 'true'); //  NEW\r\n    const query = params.toString() ? `?${params.toString()}` : '';\r\n    return apiRequestWrapped<{ meetings?: any[] }>(`/api/meetings${query}`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meetings || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  getById: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  create: async (meeting: {\r\n    buildingId: string;\r\n    buildingAddress?: string;\r\n    organizerType?: 'uk' | 'resident' | 'initiative_group';\r\n    format?: 'online' | 'offline' | 'hybrid';\r\n    location?: string;\r\n    description?: string;\r\n    agendaItems: { title: string; description?: string; threshold?: string }[];\r\n    materials?: any[];\r\n  }) => {\r\n    return apiRequestWrapped<any>('/api/meetings', {\r\n      method: 'POST',\r\n      body: JSON.stringify(meeting),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  update: async (id: string, updates: any) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(updates),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  delete: async (id: string) => {\r\n    return apiRequestWrapped<{ success: boolean }>(`/api/meetings/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  // Status transitions\r\n  submit: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/submit`, { method: 'POST' }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  approve: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/approve`, { method: 'POST' }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  reject: async (id: string, reason: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/reject`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ reason }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  openSchedulePoll: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/open-schedule-poll`, { method: 'POST' }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  confirmSchedule: async (id: string, optionId?: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/confirm-schedule`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ optionId }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  openVoting: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/open-voting`, { method: 'POST' }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  closeVoting: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/close-voting`, { method: 'POST' }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  publishResults: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/publish-results`, { method: 'POST' }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  generateProtocol: async (id: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/generate-protocol`, { method: 'POST' }).then(r => ({\r\n      success: r.success,\r\n      data: r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  approveProtocol: async (id: string, signerData?: { signerId: string; signerName: string; signerRole: string }) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/approve-protocol`, {\r\n      method: 'POST',\r\n      body: signerData ? JSON.stringify(signerData) : undefined,\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  cancel: async (id: string, reason: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${id}/cancel`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ reason }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  getProtocol: async (meetingId: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${meetingId}/protocol`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.protocol || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  // Get protocol as HTML (for PDF export)\r\n  getProtocolHtml: async (meetingId: string): Promise<string> => {\r\n    const token = localStorage.getItem('auth_token');\r\n    const response = await fetch(`/api/meetings/${meetingId}/protocol/html`, {\r\n      headers: token ? { 'Authorization': `Bearer ${token}` } : {},\r\n    });\r\n    return response.text();\r\n  },\r\n\r\n  // Open protocol in new tab for printing/PDF\r\n  openProtocolForPrint: (meetingId: string) => {\r\n    window.open(`/api/meetings/${meetingId}/protocol/html`, '_blank');\r\n  },\r\n\r\n  // Download protocol as PDF (uses browser print dialog)\r\n  downloadProtocolPdf: async (meetingId: string) => {\r\n    const html = await meetingsFullApi.getProtocolHtml(meetingId);\r\n\r\n    // Create iframe for printing\r\n    const iframe = document.createElement('iframe');\r\n    iframe.style.display = 'none';\r\n    document.body.appendChild(iframe);\r\n\r\n    const doc = iframe.contentDocument || iframe.contentWindow?.document;\r\n    if (doc) {\r\n      doc.open();\r\n      doc.write(html);\r\n      doc.close();\r\n\r\n      // Wait for content to load then print\r\n      setTimeout(() => {\r\n        iframe.contentWindow?.print();\r\n        // Remove iframe after printing dialog closes\r\n        setTimeout(() => {\r\n          document.body.removeChild(iframe);\r\n        }, 1000);\r\n      }, 500);\r\n    }\r\n  },\r\n};\r\n\r\n// Meeting Schedule Votes API\r\nexport const meetingScheduleVotesApi = {\r\n  vote: async (meetingId: string, optionId: string) => {\r\n    // Invalidate meetings cache to force fresh data after vote\r\n    invalidateCache('/api/meetings');\r\n\r\n    return apiRequestWrapped<any>(`/api/meetings/${meetingId}/schedule-votes`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ option_id: optionId }), // API expects snake_case\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  getMyVote: async (meetingId: string) => {\r\n    return apiRequestWrapped<{ optionId: string | null }>(`/api/meetings/${meetingId}/schedule-votes/me`);\r\n  },\r\n};\r\n\r\n// Meeting Agenda Votes API\r\nexport const meetingAgendaVotesApi = {\r\n  vote: async (meetingId: string, agendaItemId: string, data: {\r\n    voterId: string;\r\n    voterName: string;\r\n    choice: 'for' | 'against' | 'abstain';\r\n    apartmentId?: string;\r\n    apartmentNumber?: string;\r\n    ownershipShare?: number;\r\n    verificationMethod?: 'login' | 'otp' | 'in_person' | 'proxy';\r\n    otpVerified?: boolean;\r\n    comment?: string; // /  \r\n  }) => {\r\n    return apiRequestWrapped<any>(\r\n      `/api/meetings/${meetingId}/agenda/${agendaItemId}/vote`,\r\n      {\r\n        method: 'POST',\r\n        body: JSON.stringify(data),\r\n      }\r\n    ).then(r => ({\r\n      success: r.success,\r\n      data: r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  getMyVotes: async (meetingId: string, voterId?: string) => {\r\n    const query = voterId ? `?voter_id=${voterId}` : '';\r\n    return apiRequestWrapped<{ votes?: any[] }>(`/api/meetings/${meetingId}/votes/me${query}`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.votes || r.data || [],\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  getVoteRecords: async (meetingId: string) => {\r\n    return apiRequestWrapped<{ voteRecords?: any[] }>(`/api/meetings/${meetingId}/vote-records`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.voteRecords || r.data || [],\r\n      error: r.error\r\n    }));\r\n  },\r\n};\r\n\r\n// Meeting OTP API\r\nexport const meetingOtpApi = {\r\n  request: async (data: {\r\n    userId: string;\r\n    phone: string;\r\n    purpose: 'schedule_vote' | 'agenda_vote' | 'protocol_sign';\r\n    meetingId?: string;\r\n    agendaItemId?: string;\r\n  }) => {\r\n    return apiRequestWrapped<any>('/api/meetings/otp/request', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  verify: async (otpId: string, code: string) => {\r\n    return apiRequestWrapped<{ verified: boolean; error?: string }>('/api/meetings/otp/verify', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ otpId, code }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n};\r\n\r\n// Meeting Building Settings API\r\nexport const meetingBuildingSettingsApi = {\r\n  get: async (buildingId: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/building-settings/${buildingId}`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.settings || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  update: async (buildingId: string, settings: any) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/building-settings/${buildingId}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(settings),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.settings || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n};\r\n\r\n// Meeting Voting Units API\r\nexport const meetingVotingUnitsApi = {\r\n  getByBuilding: async (buildingId: string) => {\r\n    return apiRequestWrapped<{ votingUnits?: any[] }>(`/api/meetings/voting-units?building_id=${buildingId}`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.votingUnits || r.data || [],\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  create: async (unit: {\r\n    buildingId: string;\r\n    apartmentId?: string;\r\n    apartmentNumber: string;\r\n    ownerId?: string;\r\n    ownerName?: string;\r\n    coOwnerIds?: string[];\r\n    ownershipShare?: number;\r\n    totalArea?: number;\r\n  }) => {\r\n    return apiRequestWrapped<any>('/api/meetings/voting-units', {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        building_id: unit.buildingId,\r\n        apartment_id: unit.apartmentId,\r\n        apartment_number: unit.apartmentNumber,\r\n        owner_id: unit.ownerId,\r\n        owner_name: unit.ownerName,\r\n        co_owner_ids: unit.coOwnerIds ? JSON.stringify(unit.coOwnerIds) : '[]',\r\n        ownership_share: unit.ownershipShare || 100,\r\n        total_area: unit.totalArea || 0,\r\n      }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.votingUnit || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  verify: async (id: string, verifiedBy: string) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/voting-units/${id}/verify`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ verified_by: verifiedBy }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.votingUnit || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n};\r\n\r\n// Meeting Eligible Voters API\r\nexport const meetingEligibleVotersApi = {\r\n  set: async (meetingId: string, voterIds: string[], totalCount: number) => {\r\n    return apiRequestWrapped<any>(`/api/meetings/${meetingId}/eligible-voters`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ voterIds, totalCount }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.meeting || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n};\r\n\r\n// Meeting Agenda Comments API (   )\r\nexport const meetingAgendaCommentsApi = {\r\n  //    \r\n  getByAgendaItem: async (agendaItemId: string) => {\r\n    return apiRequestWrapped<{ comments: any[] }>(`/api/agenda/${agendaItemId}/comments`).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.comments || [],\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  //  \r\n  create: async (agendaItemId: string, data: {\r\n    content: string;\r\n    apartmentNumber?: string;\r\n    includeInProtocol?: boolean;\r\n  }) => {\r\n    return apiRequestWrapped<any>(`/api/agenda/${agendaItemId}/comments`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        content: data.content,\r\n        apartment_number: data.apartmentNumber,\r\n        include_in_protocol: data.includeInProtocol !== false\r\n      }),\r\n    }).then(r => ({\r\n      success: r.success,\r\n      data: r.data?.comment || r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  //   \r\n  delete: async (commentId: string) => {\r\n    return apiRequestWrapped<{ success: boolean }>(`/api/comments/${commentId}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n};\r\n\r\n// ============================================\r\n// APP SETTINGS API\r\n// ============================================\r\n\r\nexport interface AppSettings {\r\n  companyName: string;\r\n  companyInn: string;\r\n  companyAddress: string;\r\n  companyPhone: string;\r\n  routingMode: 'manual' | 'auto' | 'hybrid';\r\n  workingHoursStart: string;\r\n  workingHoursEnd: string;\r\n  autoAssign: boolean;\r\n  notifyOnNew: boolean;\r\n  notifyOnComplete: boolean;\r\n  notifyOnRating: boolean;\r\n  smsNotifications: boolean;\r\n  emailNotifications: boolean;\r\n  pushNotifications: boolean;\r\n}\r\n\r\nexport const settingsApi = {\r\n  // Get all settings\r\n  getAll: async () => {\r\n    return apiRequestWrapped<{ settings: Record<string, any> }>('/api/settings').then(r => ({\r\n      success: r.success,\r\n      data: r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  // Get single setting\r\n  get: async (key: string) => {\r\n    return apiRequestWrapped<{ value: any }>(`/api/settings/${key}`).then(r => ({\r\n      success: r.success,\r\n      data: r.data,\r\n      error: r.error\r\n    }));\r\n  },\r\n\r\n  // Update single setting\r\n  update: async (key: string, value: any) => {\r\n    return apiRequestWrapped<{ success: boolean }>(`/api/settings/${key}`, {\r\n      method: 'PUT',\r\n      body: JSON.stringify({ value }),\r\n    });\r\n  },\r\n\r\n  // Bulk update settings\r\n  updateMany: async (settings: Partial<AppSettings>) => {\r\n    return apiRequestWrapped<{ success: boolean }>('/api/settings', {\r\n      method: 'POST',\r\n      body: JSON.stringify(settings),\r\n    });\r\n  },\r\n};\r\n\r\n// ============================================\r\n// NOTIFICATIONS API\r\n// ============================================\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  user_id: string;\r\n  type: string;\r\n  title: string;\r\n  body?: string;\r\n  data?: any;\r\n  is_read: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport const notificationsApi = {\r\n  // Get notifications for current user\r\n  getAll: async (limit = 50, unreadOnly = false) => {\r\n    const params = new URLSearchParams({ limit: String(limit) });\r\n    if (unreadOnly) params.set('unread', 'true');\r\n    return apiRequest<{ notifications: Notification[] }>(`/api/notifications?${params}`);\r\n  },\r\n\r\n  // Get unread count\r\n  getUnreadCount: async () => {\r\n    return apiRequest<{ count: number }>('/api/notifications/count');\r\n  },\r\n\r\n  // Create notification\r\n  create: async (data: {\r\n    user_id: string;\r\n    type: string;\r\n    title: string;\r\n    body?: string;\r\n    data?: any;\r\n  }) => {\r\n    return apiRequest<{ id: string; success: boolean }>('/api/notifications', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n\r\n  // Mark as read\r\n  markAsRead: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/notifications/${id}/read`, {\r\n      method: 'PATCH',\r\n    });\r\n  },\r\n\r\n  // Mark all as read\r\n  markAllAsRead: async () => {\r\n    return apiRequest<{ success: boolean }>('/api/notifications/read-all', {\r\n      method: 'POST',\r\n    });\r\n  },\r\n\r\n  // Delete\r\n  delete: async (id: string) => {\r\n    return apiRequest<{ success: boolean }>(`/api/notifications/${id}`, {\r\n      method: 'DELETE',\r\n    });\r\n  },\r\n\r\n  // Broadcast to multiple users\r\n  broadcast: async (data: {\r\n    user_ids: string[];\r\n    type: string;\r\n    title: string;\r\n    body?: string;\r\n    data?: any;\r\n  }) => {\r\n    return apiRequest<{ success: boolean; count: number }>('/api/notifications/broadcast', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  },\r\n};\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport type { User } from '../types';\r\nimport { authApi, usersApi } from '../services/api';\r\n\r\ninterface MockUserData {\r\n  password: string;\r\n  user: User;\r\n}\r\n\r\ninterface AuthState {\r\n  user: User | null;\r\n  token: string | null;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  // Legacy compatibility - to be removed after full migration\r\n  additionalUsers: Record<string, MockUserData>;\r\n  login: (loginStr: string, password: string) => Promise<boolean>;\r\n  logout: () => void;\r\n  register: (userData: {\r\n    login: string;\r\n    password: string;\r\n    name: string;\r\n    role: string;\r\n    phone?: string;\r\n    address?: string;\r\n    apartment?: string;\r\n    specialization?: string;\r\n  }) => Promise<boolean>;\r\n  registerBulk: (users: Array<{\r\n    login: string;\r\n    password: string;\r\n    name: string;\r\n    role: string;\r\n    phone?: string;\r\n    address?: string;\r\n    apartment?: string;\r\n  }>) => Promise<{ created: any[]; updated: any[] }>;\r\n  updateProfile: (updates: { phone?: string; name?: string }) => Promise<boolean>;\r\n  changePassword: (currentPassword: string, newPassword: string) => Promise<boolean>;\r\n  adminChangePassword: (userId: string, newPassword: string) => Promise<boolean>;\r\n  markContractSigned: () => Promise<boolean>;\r\n  refreshUser: () => Promise<void>;\r\n  // Legacy methods for backward compatibility\r\n  addMockUser: (login: string, password: string, user: User) => void;\r\n  removeUser: (login: string) => void;\r\n  updateUserPassword: (login: string, newPassword: string) => void;\r\n  updateUserProfile: (login: string, updates: Partial<User>) => void;\r\n  getUserPassword: (login: string) => string | null;\r\n}\r\n\r\nexport const useAuthStore = create<AuthState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      user: null,\r\n      token: null,\r\n      isLoading: false,\r\n      error: null,\r\n      additionalUsers: {},\r\n\r\n      login: async (loginStr: string, password: string) => {\r\n        const normalizedLogin = loginStr.trim();\r\n        const normalizedPassword = password.trim();\r\n        set({ isLoading: true, error: null });\r\n\r\n        // API login (all users are in database)\r\n        try {\r\n          const data = await authApi.login(normalizedLogin, normalizedPassword);\r\n          set({\r\n            user: data.user,\r\n            token: data.token,\r\n            isLoading: false,\r\n            error: null\r\n          });\r\n          return true;\r\n        } catch (apiError: unknown) {\r\n          // Login failed\r\n          const message = apiError instanceof Error ? apiError.message : '   ';\r\n          set({\r\n            isLoading: false,\r\n            error: message\r\n          });\r\n          return false;\r\n        }\r\n      },\r\n\r\n      logout: () => {\r\n        authApi.logout();\r\n        set({ user: null, token: null, error: null });\r\n      },\r\n\r\n      register: async (userData) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n          await authApi.register(userData);\r\n          set({ isLoading: false });\r\n          return true;\r\n        } catch (error: unknown) {\r\n          console.error('Register failed:', error);\r\n          set({ isLoading: false, error: (error as Error).message });\r\n          return false;\r\n        }\r\n      },\r\n\r\n      registerBulk: async (users) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n          const result = await authApi.registerBulk(users);\r\n          set({ isLoading: false });\r\n          return result;\r\n        } catch (error: unknown) {\r\n          console.error('Bulk register failed:', error);\r\n          set({ isLoading: false, error: (error as Error).message });\r\n          return { created: [], updated: [] };\r\n        }\r\n      },\r\n\r\n      updateProfile: async (updates) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n          const data = await usersApi.updateMe(updates);\r\n          set({ user: data.user, isLoading: false });\r\n          return true;\r\n        } catch (error: unknown) {\r\n          console.error('Update profile failed:', error);\r\n          set({ isLoading: false, error: (error as Error).message });\r\n          return false;\r\n        }\r\n      },\r\n\r\n      changePassword: async (currentPassword, newPassword) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n          const result = await usersApi.changePassword(currentPassword, newPassword);\r\n          // Update user with password_changed_at from server\r\n          const currentUser = get().user;\r\n          if (currentUser && result.password_changed_at) {\r\n            set({\r\n              user: { ...currentUser, passwordChangedAt: result.password_changed_at },\r\n              isLoading: false\r\n            });\r\n          } else {\r\n            set({ isLoading: false });\r\n          }\r\n          return true;\r\n        } catch (error: unknown) {\r\n          console.error('Change password failed:', error);\r\n          set({ isLoading: false, error: (error as Error).message });\r\n          return false;\r\n        }\r\n      },\r\n\r\n      adminChangePassword: async (userId, newPassword) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n          await usersApi.adminChangePassword(userId, newPassword);\r\n          set({ isLoading: false });\r\n          return true;\r\n        } catch (error: unknown) {\r\n          console.error('Admin change password failed:', error);\r\n          set({ isLoading: false, error: (error as Error).message });\r\n          return false;\r\n        }\r\n      },\r\n\r\n      markContractSigned: async () => {\r\n        try {\r\n          const result = await usersApi.markContractSigned();\r\n          // Update user with contract_signed_at from server\r\n          const currentUser = get().user;\r\n          if (currentUser && result.contract_signed_at) {\r\n            set({\r\n              user: { ...currentUser, contractSignedAt: result.contract_signed_at }\r\n            });\r\n          }\r\n          return true;\r\n        } catch (error: unknown) {\r\n          console.error('Mark contract signed failed:', error);\r\n          return false;\r\n        }\r\n      },\r\n\r\n      refreshUser: async () => {\r\n        const token = get().token;\r\n        if (!token) return;\r\n\r\n        try {\r\n          const data = await usersApi.getMe();\r\n          set({ user: data.user });\r\n        } catch (error) {\r\n          console.error('Refresh user failed:', error);\r\n          // If token is invalid, logout\r\n          get().logout();\r\n        }\r\n      },\r\n\r\n      // Legacy methods for backward compatibility (to be removed after full migration)\r\n      addMockUser: (login: string, password: string, user: User) => {\r\n        console.log('addMockUser called with:', { login, password, user });\r\n\r\n        // Also register via API with all fields including building info\r\n        authApi.register({\r\n          login,\r\n          password,\r\n          name: user.name,\r\n          role: user.role,\r\n          phone: user.phone,\r\n          address: user.address,\r\n          apartment: user.apartment,\r\n          building_id: (user as any).buildingId,\r\n          entrance: (user as any).entrance,\r\n          floor: (user as any).floor,\r\n          branch: (user as any).branch,\r\n          building: (user as any).building,\r\n        }).then(() => {\r\n          console.log('User registered via API successfully');\r\n        }).catch((err) => {\r\n          console.error('API register error:', err);\r\n        });\r\n\r\n        set((state) => ({\r\n          additionalUsers: {\r\n            ...state.additionalUsers,\r\n            [login]: { password, user }\r\n          }\r\n        }));\r\n\r\n        console.log('User added to local store');\r\n      },\r\n\r\n      removeUser: (login: string) => {\r\n        set((state) => {\r\n          const newUsers = { ...state.additionalUsers };\r\n          delete newUsers[login];\r\n          return { additionalUsers: newUsers };\r\n        });\r\n      },\r\n\r\n      updateUserPassword: (login: string, newPassword: string) => {\r\n        set((state) => {\r\n          if (state.additionalUsers[login]) {\r\n            return {\r\n              additionalUsers: {\r\n                ...state.additionalUsers,\r\n                [login]: {\r\n                  ...state.additionalUsers[login],\r\n                  password: newPassword\r\n                }\r\n              }\r\n            };\r\n          }\r\n          return state;\r\n        });\r\n      },\r\n\r\n      updateUserProfile: (login: string, updates: Partial<User>) => {\r\n        set((state) => {\r\n          if (state.additionalUsers[login]) {\r\n            return {\r\n              additionalUsers: {\r\n                ...state.additionalUsers,\r\n                [login]: {\r\n                  ...state.additionalUsers[login],\r\n                  user: { ...state.additionalUsers[login].user, ...updates }\r\n                }\r\n              }\r\n            };\r\n          }\r\n          // Also update current user if it's themselves\r\n          if (state.user?.login === login) {\r\n            return { user: { ...state.user, ...updates } };\r\n          }\r\n          return state;\r\n        });\r\n      },\r\n\r\n      getUserPassword: (login: string) => {\r\n        const state = get();\r\n        return state.additionalUsers[login]?.password || null;\r\n      },\r\n    }),\r\n    {\r\n      name: 'uk-auth-storage',\r\n      version: 3, // Increment to fix token/user.id mismatch\r\n      partialize: (state) => ({\r\n        user: state.user,\r\n        token: state.token,\r\n        // Do NOT persist additionalUsers - all users should come from API\r\n        // This ensures data is consistent across all browsers/devices\r\n      }),\r\n      // Sync token to localStorage when store is rehydrated (e.g., page refresh)\r\n      onRehydrateStorage: () => (state, error) => {\r\n        if (error) {\r\n          console.error('Rehydrate error:', error);\r\n          return;\r\n        }\r\n        if (state?.user?.id) {\r\n          // CRITICAL FIX: Ensure token always matches user.id\r\n          // This fixes 401 errors caused by token/user.id mismatch\r\n          const correctToken = state.user.id;\r\n          if (state.token !== correctToken) {\r\n            console.warn('Token mismatch detected, fixing...', {\r\n              oldToken: state.token,\r\n              newToken: correctToken\r\n            });\r\n            state.token = correctToken;\r\n          }\r\n          localStorage.setItem('auth_token', correctToken);\r\n          console.log('Token synced to localStorage on rehydrate:', correctToken);\r\n        } else if (state?.token) {\r\n          // No user but have token - clear it to avoid stale state\r\n          console.warn('Token exists but no user, clearing auth state');\r\n          localStorage.removeItem('auth_token');\r\n          state.token = null;\r\n        }\r\n      },\r\n    }\r\n  )\r\n);\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport type {\r\n  BuildingFull,\r\n  BuildingDocument,\r\n  Entrance,\r\n  Apartment,\r\n  Meter,\r\n  MeterReading,\r\n  Owner,\r\n  Resident,\r\n  PersonalAccount,\r\n} from '../types';\r\nimport { buildingsApi, entrancesApi, buildingDocumentsApi, apartmentsApi, ownersApi, personalAccountsApi, crmResidentsApi, metersApi, meterReadingsApi } from '../services/api';\r\n\r\ninterface CRMState {\r\n  // Data\r\n  buildings: BuildingFull[];\r\n  entrances: Entrance[];\r\n  apartments: Apartment[];\r\n  meters: Meter[];\r\n  meterReadings: MeterReading[];\r\n  owners: Owner[];\r\n  residents: Resident[];\r\n  personalAccounts: PersonalAccount[];\r\n\r\n  // Loading states\r\n  isLoadingBuildings: boolean;\r\n  isLoadingEntrances: boolean;\r\n  isLoadingApartments: boolean;\r\n  isLoadingOwners: boolean;\r\n  isLoadingAccounts: boolean;\r\n  isLoadingResidents: boolean;\r\n  isLoadingMeters: boolean;\r\n\r\n  // API-driven building actions\r\n  fetchBuildings: () => Promise<void>;\r\n  fetchBuildingById: (id: string) => Promise<{ building: BuildingFull; entrances: Entrance[]; documents: BuildingDocument[] } | null>;\r\n  addBuilding: (building: Omit<BuildingFull, 'id' | 'createdAt' | 'updatedAt' | 'documents'>) => Promise<BuildingFull | null>;\r\n  updateBuilding: (id: string, data: Partial<BuildingFull>) => Promise<void>;\r\n  deleteBuilding: (id: string) => Promise<void>;\r\n  getBuildingById: (id: string) => BuildingFull | undefined;\r\n  getBuildingWithStats: (id: string) => BuildingFull | undefined;\r\n\r\n  // API-driven building document actions\r\n  addBuildingDocument: (buildingId: string, doc: Omit<BuildingDocument, 'id' | 'buildingId' | 'uploadedAt'>) => Promise<void>;\r\n  deleteBuildingDocument: (buildingId: string, docId: string) => Promise<void>;\r\n\r\n  // API-driven entrance actions\r\n  fetchEntrancesByBuilding: (buildingId: string) => Promise<Entrance[]>;\r\n  addEntrance: (entrance: Omit<Entrance, 'id'>) => Promise<Entrance | null>;\r\n  updateEntrance: (id: string, data: Partial<Entrance>) => Promise<void>;\r\n  deleteEntrance: (id: string) => Promise<void>;\r\n  getEntrancesByBuilding: (buildingId: string) => Entrance[];\r\n\r\n  // API-driven apartment actions\r\n  fetchApartmentsByBuilding: (buildingId: string, options?: { entranceId?: string; status?: string }) => Promise<Apartment[]>;\r\n  fetchApartmentById: (id: string) => Promise<{ apartment: Apartment; owners: Owner[]; account: PersonalAccount | null } | null>;\r\n  addApartment: (apartment: Omit<Apartment, 'id' | 'createdAt' | 'updatedAt' | 'meters'>) => Promise<Apartment | null>;\r\n  updateApartment: (id: string, data: Partial<Apartment>) => Promise<void>;\r\n  deleteApartment: (id: string) => Promise<void>;\r\n  getApartmentsByBuilding: (buildingId: string) => Apartment[];\r\n  getApartmentsByEntrance: (entranceId: string) => Apartment[];\r\n  getApartmentById: (id: string) => Apartment | undefined;\r\n\r\n  // API-driven meter actions\r\n  fetchMetersByApartment: (apartmentId: string, options?: { type?: string; isActive?: boolean }) => Promise<Meter[]>;\r\n  fetchMetersByBuilding: (buildingId: string, options?: { type?: string; isCommon?: boolean }) => Promise<Meter[]>;\r\n  fetchMeterById: (id: string) => Promise<{ meter: Meter; readings: MeterReading[] } | null>;\r\n  addMeter: (meter: Omit<Meter, 'id'>) => Promise<Meter | null>;\r\n  updateMeter: (id: string, data: Partial<Meter>) => Promise<void>;\r\n  deleteMeter: (id: string) => Promise<void>;\r\n  decommissionMeter: (id: string, reason?: string) => Promise<void>;\r\n  getMetersByApartment: (apartmentId: string) => Meter[];\r\n  getCommonMetersByBuilding: (buildingId: string) => Meter[];\r\n\r\n  // API-driven meter reading actions\r\n  fetchMeterReadings: (meterId: string, options?: { limit?: number; offset?: number }) => Promise<MeterReading[]>;\r\n  submitMeterReading: (meterId: string, reading: { value: number; readingDate?: string; photoUrl?: string }) => Promise<MeterReading | null>;\r\n  verifyMeterReading: (readingId: string, approved: boolean, rejectionReason?: string) => Promise<void>;\r\n  getMeterReadings: (meterId: string) => MeterReading[];\r\n  getLastReading: (meterId: string) => MeterReading | undefined;\r\n\r\n  // API-driven owner actions\r\n  fetchOwners: (options?: { type?: string; search?: string }) => Promise<Owner[]>;\r\n  fetchOwnerById: (id: string) => Promise<{ owner: Owner; apartments: Apartment[] } | null>;\r\n  addOwner: (owner: Omit<Owner, 'id' | 'createdAt' | 'updatedAt' | 'tags'>) => Promise<Owner | null>;\r\n  updateOwner: (id: string, data: Partial<Owner>) => Promise<void>;\r\n  deleteOwner: (id: string) => Promise<void>;\r\n  linkOwnerToApartment: (ownerId: string, apartmentId: string, data?: { ownershipShare?: number; isPrimary?: boolean }) => Promise<void>;\r\n  unlinkOwnerFromApartment: (ownerId: string, apartmentId: string) => Promise<void>;\r\n  getOwnerById: (id: string) => Owner | undefined;\r\n  getOwnersByApartment: (apartmentId: string) => Owner[];\r\n  searchOwners: (query: string) => Owner[];\r\n\r\n  // API-driven resident actions\r\n  fetchResidentsByApartment: (apartmentId: string, options?: { isActive?: boolean }) => Promise<Resident[]>;\r\n  fetchResidentById: (id: string) => Promise<Resident | null>;\r\n  addResident: (apartmentId: string, resident: Omit<Resident, 'id' | 'createdAt'>) => Promise<Resident | null>;\r\n  updateResident: (id: string, data: Partial<Resident>) => Promise<void>;\r\n  deleteResident: (id: string) => Promise<void>;\r\n  moveOutResident: (id: string, data: { movedOutDate?: string; reason?: string }) => Promise<void>;\r\n  getResidentsByApartment: (apartmentId: string) => Resident[];\r\n\r\n  // API-driven personal account actions\r\n  fetchAccountsByBuilding: (buildingId: string, options?: { status?: string; hasDebt?: boolean }) => Promise<PersonalAccount[]>;\r\n  addPersonalAccount: (account: Omit<PersonalAccount, 'id' | 'createdAt' | 'updatedAt'>) => Promise<PersonalAccount | null>;\r\n  updatePersonalAccount: (id: string, data: Partial<PersonalAccount>) => Promise<void>;\r\n  getPersonalAccountById: (id: string) => PersonalAccount | undefined;\r\n  getPersonalAccountByApartment: (apartmentId: string) => PersonalAccount | undefined;\r\n  getPersonalAccountsByBuilding: (buildingId: string) => PersonalAccount[];\r\n  fetchDebtors: (options?: { minDebt?: number; buildingId?: string }) => Promise<PersonalAccount[]>;\r\n  getDebtors: (minDebt?: number) => PersonalAccount[];\r\n\r\n  // Stats\r\n  getBuildingStats: () => {\r\n    totalBuildings: number;\r\n    totalApartments: number;\r\n    totalResidents: number;\r\n    totalOwners: number;\r\n    totalDebt: number;\r\n    avgCollectionRate: number;\r\n  };\r\n}\r\n\r\n// Helper to map API response to frontend type\r\nconst mapBuildingFromApi = (b: any): BuildingFull => ({\r\n  id: b.id,\r\n  name: b.name,\r\n  address: b.address,\r\n  zone: b.zone,\r\n  cadastralNumber: b.cadastral_number,\r\n  branchCode: b.branch_code,\r\n  buildingNumber: b.building_number,\r\n  floors: b.floors || 0,\r\n  entrances: b.entrances_count || 0,\r\n  totalApartments: b.apartments_count || 0,\r\n  totalArea: b.total_area || 0,\r\n  livingArea: b.living_area || 0,\r\n  commonArea: b.common_area || 0,\r\n  landArea: b.land_area,\r\n  yearBuilt: b.year_built || 0,\r\n  yearRenovated: b.year_renovated,\r\n  buildingType: b.building_type || 'monolith',\r\n  roofType: b.roof_type || 'flat',\r\n  wallMaterial: b.wall_material || '',\r\n  foundationType: b.foundation_type || '',\r\n  hasElevator: !!b.has_elevator,\r\n  elevatorCount: b.elevator_count || 0,\r\n  hasGas: !!b.has_gas,\r\n  heatingType: b.heating_type || 'central',\r\n  hasHotWater: !!b.has_hot_water,\r\n  waterSupplyType: b.water_supply_type || 'central',\r\n  sewerageType: b.sewerage_type || 'central',\r\n  hasIntercom: !!b.has_intercom,\r\n  hasVideoSurveillance: !!b.has_video_surveillance,\r\n  hasConcierge: !!b.has_concierge,\r\n  hasParkingLot: !!b.has_parking_lot,\r\n  parkingSpaces: b.parking_spaces || 0,\r\n  hasPlayground: !!b.has_playground,\r\n  managerId: b.manager_id,\r\n  managerName: b.manager_name,\r\n  managementStartDate: b.management_start_date,\r\n  contractNumber: b.contract_number,\r\n  contractEndDate: b.contract_end_date,\r\n  monthlyBudget: b.monthly_budget || 0,\r\n  reserveFund: b.reserve_fund || 0,\r\n  totalDebt: b.total_debt || 0,\r\n  collectionRate: b.collection_rate || 0,\r\n  residentsCount: b.residents_count || 0,\r\n  ownersCount: b.owners_count || 0,\r\n  tenantsCount: b.tenants_count || 0,\r\n  vacantApartments: b.vacant_apartments || 0,\r\n  activeRequestsCount: b.active_requests_count || 0,\r\n  documents: [],\r\n  createdAt: b.created_at,\r\n  updatedAt: b.updated_at,\r\n});\r\n\r\nconst mapEntranceFromApi = (e: any): Entrance => ({\r\n  id: e.id,\r\n  buildingId: e.building_id,\r\n  number: e.number,\r\n  floorsFrom: e.floors_from || 1,\r\n  floorsTo: e.floors_to,\r\n  apartmentsFrom: e.apartments_from,\r\n  apartmentsTo: e.apartments_to,\r\n  hasElevator: !!e.has_elevator,\r\n  elevatorId: e.elevator_id,\r\n  intercomType: e.intercom_type,\r\n  intercomCode: e.intercom_code,\r\n  cleaningSchedule: e.cleaning_schedule,\r\n  responsibleId: e.responsible_id,\r\n  lastInspection: e.last_inspection,\r\n  notes: e.notes,\r\n});\r\n\r\nconst mapApartmentFromApi = (a: any): Apartment => ({\r\n  id: a.id,\r\n  buildingId: a.building_id,\r\n  entranceId: a.entrance_id,\r\n  number: a.number,\r\n  floor: a.floor || 1,\r\n  rooms: a.rooms || 1,\r\n  totalArea: a.total_area || 0,\r\n  livingArea: a.living_area || 0,\r\n  kitchenArea: a.kitchen_area,\r\n  balconyArea: a.balcony_area,\r\n  loggiaArea: a.loggia_area,\r\n  ceilingHeight: a.ceiling_height,\r\n  hasBalcony: !!a.has_balcony,\r\n  hasLoggia: !!a.has_loggia,\r\n  hasStorage: !!a.has_storage,\r\n  hasParking: !!a.has_parking,\r\n  parkingNumber: a.parking_number,\r\n  ownershipType: a.ownership_type || 'private',\r\n  ownershipShare: a.ownership_share,\r\n  registrationNumber: a.registration_number,\r\n  registrationDate: a.registration_date,\r\n  status: a.status || 'occupied',\r\n  isCommercial: !!a.is_commercial,\r\n  commercialType: a.commercial_type,\r\n  meters: [],\r\n  personalAccountId: a.personal_account_id,\r\n  primaryOwnerId: a.primary_owner_id,\r\n  notes: a.notes,\r\n  createdAt: a.created_at,\r\n  updatedAt: a.updated_at,\r\n});\r\n\r\nconst mapOwnerFromApi = (o: any): Owner => ({\r\n  id: o.id,\r\n  type: o.type || 'individual',\r\n  lastName: o.last_name,\r\n  firstName: o.first_name,\r\n  middleName: o.middle_name,\r\n  fullName: o.full_name,\r\n  companyName: o.company_name,\r\n  inn: o.inn,\r\n  kpp: o.kpp,\r\n  ogrn: o.ogrn,\r\n  legalAddress: o.legal_address,\r\n  directorName: o.director_name,\r\n  passportSeries: o.passport_series,\r\n  passportNumber: o.passport_number,\r\n  passportIssuedBy: o.passport_issued_by,\r\n  passportIssuedDate: o.passport_issued_date,\r\n  birthDate: o.birth_date,\r\n  birthPlace: o.birth_place,\r\n  registrationAddress: o.registration_address,\r\n  actualAddress: o.actual_address,\r\n  phone: o.phone,\r\n  additionalPhone: o.additional_phone,\r\n  email: o.email,\r\n  preferredContact: o.preferred_contact || 'phone',\r\n  ownershipType: o.ownership_type || 'owner',\r\n  ownershipShare: o.ownership_share || 100,\r\n  ownershipDocument: o.ownership_document,\r\n  ownershipDocumentDate: o.ownership_document_date,\r\n  apartmentIds: o.apartment_ids ? JSON.parse(o.apartment_ids) : [],\r\n  personalAccountIds: o.personal_account_ids ? JSON.parse(o.personal_account_ids) : [],\r\n  isActive: o.is_active !== false && o.is_active !== 0,\r\n  isVerified: !!o.is_verified,\r\n  verifiedAt: o.verified_at,\r\n  verifiedBy: o.verified_by,\r\n  bankName: o.bank_name,\r\n  bankBik: o.bank_bik,\r\n  bankAccount: o.bank_account,\r\n  tags: o.tags ? JSON.parse(o.tags) : [],\r\n  notes: o.notes,\r\n  createdAt: o.created_at,\r\n  updatedAt: o.updated_at,\r\n});\r\n\r\nconst mapAccountFromApi = (a: any): PersonalAccount => ({\r\n  id: a.id,\r\n  number: a.number,\r\n  apartmentId: a.apartment_id,\r\n  buildingId: a.building_id,\r\n  primaryOwnerId: a.primary_owner_id,\r\n  ownerName: a.owner_name,\r\n  apartmentNumber: a.apartment_number,\r\n  address: a.address,\r\n  totalArea: a.total_area || 0,\r\n  residentsCount: a.residents_count || 0,\r\n  registeredCount: a.registered_count || 0,\r\n  balance: a.balance || 0,\r\n  currentDebt: a.current_debt || 0,\r\n  penaltyAmount: a.penalty_amount || 0,\r\n  lastPaymentDate: a.last_payment_date,\r\n  lastPaymentAmount: a.last_payment_amount,\r\n  lastChargeDate: a.last_charge_date,\r\n  lastChargeAmount: a.last_charge_amount,\r\n  tariffPlanId: a.tariff_plan_id,\r\n  hasSubsidy: !!a.has_subsidy,\r\n  subsidyPercent: a.subsidy_percent,\r\n  subsidyEndDate: a.subsidy_end_date,\r\n  hasDiscount: !!a.has_discount,\r\n  discountPercent: a.discount_percent,\r\n  discountReason: a.discount_reason,\r\n  status: a.status || 'active',\r\n  closedAt: a.closed_at,\r\n  closedReason: a.closed_reason,\r\n  notes: a.notes,\r\n  createdAt: a.created_at,\r\n  updatedAt: a.updated_at,\r\n});\r\n\r\nconst mapMeterFromApi = (m: any): Meter => ({\r\n  id: m.id,\r\n  apartmentId: m.apartment_id,\r\n  buildingId: m.building_id,\r\n  type: m.type,\r\n  serialNumber: m.serial_number,\r\n  model: m.model,\r\n  brand: m.brand,\r\n  installDate: m.install_date,\r\n  verificationDate: m.verification_date,\r\n  nextVerificationDate: m.next_verification_date,\r\n  sealNumber: m.seal_number,\r\n  location: m.install_location,\r\n  initialValue: m.initial_value || 0,\r\n  currentValue: m.current_value || 0,\r\n  lastReadingDate: m.last_reading_date,\r\n  isActive: m.is_active !== false && m.is_active !== 0,\r\n  isCommon: !!m.is_common,\r\n  tariffZone: m.tariff_zone,\r\n  notes: m.notes,\r\n  createdAt: m.created_at,\r\n  updatedAt: m.updated_at,\r\n});\r\n\r\nconst mapMeterReadingFromApi = (r: any): MeterReading => ({\r\n  id: r.id,\r\n  meterId: r.meter_id,\r\n  value: r.value,\r\n  previousValue: r.previous_value,\r\n  consumption: r.consumption,\r\n  readingDate: r.reading_date,\r\n  source: r.source,\r\n  submittedBy: r.submitted_by,\r\n  submittedAt: r.submitted_at,\r\n  isVerified: !!r.is_verified,\r\n  verifiedBy: r.verified_by,\r\n  verifiedAt: r.verified_at,\r\n  photoUrl: r.photo_url,\r\n  status: r.status,\r\n  rejectionReason: r.rejection_reason,\r\n  notes: r.notes,\r\n  createdAt: r.created_at,\r\n});\r\n\r\nconst mapResidentFromApi = (r: any): Resident => ({\r\n  id: r.id,\r\n  apartmentId: r.apartment_id,\r\n  ownerId: r.owner_id,\r\n  lastName: r.last_name,\r\n  firstName: r.first_name,\r\n  middleName: r.middle_name,\r\n  fullName: r.full_name,\r\n  birthDate: r.birth_date,\r\n  residentType: r.resident_type || 'owner',\r\n  relationToOwner: r.relation_to_owner,\r\n  registrationType: r.registration_type || 'permanent',\r\n  registrationDate: r.registration_date,\r\n  registrationEndDate: r.registration_end_date,\r\n  phone: r.phone,\r\n  additionalPhone: r.additional_phone,\r\n  email: r.email,\r\n  isActive: r.is_active !== false && r.is_active !== 0,\r\n  movedInDate: r.moved_in_date,\r\n  movedOutDate: r.moved_out_date,\r\n  movedOutReason: r.moved_out_reason,\r\n  passportSeries: r.passport_series,\r\n  passportNumber: r.passport_number,\r\n  notes: r.notes,\r\n  createdAt: r.created_at,\r\n  updatedAt: r.updated_at,\r\n});\r\n\r\nexport const useCRMStore = create<CRMState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // Initialize with empty arrays - will be loaded from API\r\n      buildings: [],\r\n      entrances: [],\r\n      apartments: [],\r\n      meters: [],\r\n      meterReadings: [],\r\n      owners: [],\r\n      residents: [],\r\n      personalAccounts: [],\r\n\r\n      // Loading states\r\n      isLoadingBuildings: false,\r\n      isLoadingEntrances: false,\r\n      isLoadingApartments: false,\r\n      isLoadingOwners: false,\r\n      isLoadingAccounts: false,\r\n      isLoadingResidents: false,\r\n      isLoadingMeters: false,\r\n\r\n      // ========== API-DRIVEN BUILDING ACTIONS ==========\r\n\r\n      fetchBuildings: async () => {\r\n        console.log('[fetchBuildings] Starting...');\r\n        set({ isLoadingBuildings: true });\r\n        try {\r\n          const response = await buildingsApi.getAll();\r\n          console.log('[fetchBuildings] API response:', response);\r\n          const buildings = (response.buildings || []).map(mapBuildingFromApi);\r\n          console.log('[fetchBuildings] Mapped buildings:', buildings.length);\r\n          set({ buildings, isLoadingBuildings: false });\r\n        } catch (error) {\r\n          console.error('[fetchBuildings] Failed:', error);\r\n          set({ isLoadingBuildings: false });\r\n        }\r\n      },\r\n\r\n      fetchBuildingById: async (id: string) => {\r\n        try {\r\n          const response = await buildingsApi.getById(id);\r\n          if (!response.building) return null;\r\n\r\n          const building = mapBuildingFromApi(response.building);\r\n          const entrances = (response.entrances || []).map(mapEntranceFromApi);\r\n          const documents = response.documents || [];\r\n\r\n          // Update local state with this building's data\r\n          set((state) => {\r\n            const updatedBuildings = state.buildings.some((b) => b.id === id)\r\n              ? state.buildings.map((b) => (b.id === id ? { ...building, documents } : b))\r\n              : [...state.buildings, { ...building, documents }];\r\n\r\n            // Merge entrances (replace for this building, keep others)\r\n            const otherEntrances = state.entrances.filter((e) => e.buildingId !== id);\r\n            const updatedEntrances = [...otherEntrances, ...entrances];\r\n\r\n            return { buildings: updatedBuildings, entrances: updatedEntrances };\r\n          });\r\n\r\n          return { building: { ...building, documents }, entrances, documents };\r\n        } catch (error) {\r\n          console.error('Failed to fetch building:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      addBuilding: async (buildingData) => {\r\n        try {\r\n          const response = await buildingsApi.create(buildingData as any);\r\n          if (response.building) {\r\n            const newBuilding = mapBuildingFromApi(response.building);\r\n            set((state) => ({ buildings: [...state.buildings, newBuilding] }));\r\n            return newBuilding;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create building:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateBuilding: async (id, data) => {\r\n        try {\r\n          await buildingsApi.update(id, data as any);\r\n          // Optimistic update\r\n          set((state) => ({\r\n            buildings: state.buildings.map((b) =>\r\n              b.id === id ? { ...b, ...data, updatedAt: new Date().toISOString() } : b\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to update building:', error);\r\n        }\r\n      },\r\n\r\n      deleteBuilding: async (id) => {\r\n        try {\r\n          await buildingsApi.delete(id);\r\n          set((state) => ({\r\n            buildings: state.buildings.filter((b) => b.id !== id),\r\n            entrances: state.entrances.filter((e) => e.buildingId !== id),\r\n            apartments: state.apartments.filter((a) => a.buildingId !== id),\r\n            personalAccounts: state.personalAccounts.filter((p) => p.buildingId !== id),\r\n          }));\r\n        } catch (error: any) {\r\n          console.error('Failed to delete building:', error);\r\n          throw new Error(error.message || '   ');\r\n        }\r\n      },\r\n\r\n      getBuildingById: (id) => {\r\n        return get().buildings.find((b) => b.id === id);\r\n      },\r\n\r\n      getBuildingWithStats: (id) => {\r\n        const building = get().buildings.find((b) => b.id === id);\r\n        if (!building) return undefined;\r\n\r\n        const apartments = get().apartments.filter((a) => a.buildingId === id);\r\n        const accounts = get().personalAccounts.filter((p) => p.buildingId === id);\r\n        const residents = get().residents.filter((r) =>\r\n          apartments.some((a) => a.id === r.apartmentId)\r\n        );\r\n\r\n        return {\r\n          ...building,\r\n          totalApartments: apartments.length || building.totalApartments,\r\n          residentsCount: residents.length || building.residentsCount,\r\n          ownersCount: get().owners.filter((o) =>\r\n            o.apartmentIds.some((aId) => apartments.some((a) => a.id === aId))\r\n          ).length || building.ownersCount,\r\n          totalDebt: accounts.reduce((sum, a) => sum + a.currentDebt, 0) || building.totalDebt,\r\n          vacantApartments: apartments.filter((a) => a.status === 'vacant').length || building.vacantApartments,\r\n        };\r\n      },\r\n\r\n      // ========== API-DRIVEN DOCUMENT ACTIONS ==========\r\n\r\n      addBuildingDocument: async (buildingId, docData) => {\r\n        try {\r\n          const response = await buildingDocumentsApi.create(buildingId, {\r\n            name: docData.name,\r\n            type: docData.type,\r\n            fileUrl: docData.fileUrl,\r\n            fileSize: docData.fileSize,\r\n            expiresAt: docData.expiresAt,\r\n          });\r\n          if (response.document) {\r\n            // Optimistic update\r\n            const newDoc: BuildingDocument = {\r\n              ...docData,\r\n              id: response.document.id,\r\n              buildingId,\r\n              uploadedAt: response.document.uploaded_at || new Date().toISOString(),\r\n            };\r\n            set((state) => ({\r\n              buildings: state.buildings.map((b) =>\r\n                b.id === buildingId\r\n                  ? { ...b, documents: [...(b.documents || []), newDoc] }\r\n                  : b\r\n              ),\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to add document:', error);\r\n        }\r\n      },\r\n\r\n      deleteBuildingDocument: async (buildingId, docId) => {\r\n        try {\r\n          await buildingDocumentsApi.delete(docId);\r\n          set((state) => ({\r\n            buildings: state.buildings.map((b) =>\r\n              b.id === buildingId\r\n                ? { ...b, documents: (b.documents || []).filter((d) => d.id !== docId) }\r\n                : b\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to delete document:', error);\r\n        }\r\n      },\r\n\r\n      // ========== API-DRIVEN ENTRANCE ACTIONS ==========\r\n\r\n      fetchEntrancesByBuilding: async (buildingId: string) => {\r\n        set({ isLoadingEntrances: true });\r\n        try {\r\n          const response = await entrancesApi.getByBuilding(buildingId);\r\n          const entrances = (response.entrances || []).map(mapEntranceFromApi);\r\n\r\n          // Replace entrances for this building, keep others\r\n          set((state) => {\r\n            const otherEntrances = state.entrances.filter((e) => e.buildingId !== buildingId);\r\n            return { entrances: [...otherEntrances, ...entrances], isLoadingEntrances: false };\r\n          });\r\n\r\n          return entrances;\r\n        } catch (error) {\r\n          console.error('Failed to fetch entrances:', error);\r\n          set({ isLoadingEntrances: false });\r\n          return [];\r\n        }\r\n      },\r\n\r\n      addEntrance: async (entranceData) => {\r\n        try {\r\n          const response = await entrancesApi.create(entranceData.buildingId, {\r\n            number: entranceData.number,\r\n            floorsFrom: entranceData.floorsFrom,\r\n            floorsTo: entranceData.floorsTo,\r\n            apartmentsFrom: entranceData.apartmentsFrom,\r\n            apartmentsTo: entranceData.apartmentsTo,\r\n            hasElevator: entranceData.hasElevator,\r\n            elevatorId: entranceData.elevatorId,\r\n            intercomType: entranceData.intercomType,\r\n            intercomCode: entranceData.intercomCode,\r\n            cleaningSchedule: entranceData.cleaningSchedule,\r\n            responsibleId: entranceData.responsibleId,\r\n            notes: entranceData.notes,\r\n          });\r\n          if (response.entrance) {\r\n            const newEntrance = mapEntranceFromApi(response.entrance);\r\n            set((state) => ({ entrances: [...state.entrances, newEntrance] }));\r\n            return newEntrance;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create entrance:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateEntrance: async (id, data) => {\r\n        try {\r\n          await entrancesApi.update(id, data);\r\n          set((state) => ({\r\n            entrances: state.entrances.map((e) =>\r\n              e.id === id ? { ...e, ...data } : e\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to update entrance:', error);\r\n        }\r\n      },\r\n\r\n      deleteEntrance: async (id) => {\r\n        try {\r\n          await entrancesApi.delete(id);\r\n          set((state) => ({\r\n            entrances: state.entrances.filter((e) => e.id !== id),\r\n            apartments: state.apartments.filter((a) => a.entranceId !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to delete entrance:', error);\r\n        }\r\n      },\r\n\r\n      getEntrancesByBuilding: (buildingId) => {\r\n        return get().entrances.filter((e) => e.buildingId === buildingId);\r\n      },\r\n\r\n      // ========== API-DRIVEN APARTMENT ACTIONS ==========\r\n\r\n      fetchApartmentsByBuilding: async (buildingId: string, options?: { entranceId?: string; status?: string }) => {\r\n        set({ isLoadingApartments: true });\r\n        try {\r\n          const response = await apartmentsApi.getByBuilding(buildingId, options);\r\n          const apartments = (response.apartments || []).map(mapApartmentFromApi);\r\n\r\n          // Replace apartments for this building\r\n          set((state) => {\r\n            const otherApartments = state.apartments.filter((a) => a.buildingId !== buildingId);\r\n            return { apartments: [...otherApartments, ...apartments], isLoadingApartments: false };\r\n          });\r\n\r\n          return apartments;\r\n        } catch (error) {\r\n          console.error('Failed to fetch apartments:', error);\r\n          set({ isLoadingApartments: false });\r\n          return [];\r\n        }\r\n      },\r\n\r\n      fetchApartmentById: async (id: string) => {\r\n        try {\r\n          const response = await apartmentsApi.getById(id);\r\n          if (!response.apartment) return null;\r\n\r\n          const apartment = mapApartmentFromApi(response.apartment);\r\n          const owners = (response.owners || []).map(mapOwnerFromApi);\r\n          const account = response.personalAccount ? mapAccountFromApi(response.personalAccount) : null;\r\n\r\n          // Update local state\r\n          set((state) => {\r\n            const updatedApartments = state.apartments.some((a) => a.id === id)\r\n              ? state.apartments.map((a) => (a.id === id ? apartment : a))\r\n              : [...state.apartments, apartment];\r\n\r\n            return { apartments: updatedApartments };\r\n          });\r\n\r\n          return { apartment, owners, account };\r\n        } catch (error) {\r\n          console.error('Failed to fetch apartment:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      addApartment: async (apartmentData) => {\r\n        try {\r\n          const response = await apartmentsApi.create(apartmentData.buildingId, {\r\n            number: apartmentData.number,\r\n            entranceId: apartmentData.entranceId,\r\n            floor: apartmentData.floor,\r\n            totalArea: apartmentData.totalArea,\r\n            livingArea: apartmentData.livingArea,\r\n            kitchenArea: apartmentData.kitchenArea,\r\n            rooms: apartmentData.rooms,\r\n            hasBalcony: apartmentData.hasBalcony,\r\n            hasLoggia: apartmentData.hasLoggia,\r\n            status: apartmentData.status,\r\n          });\r\n          if (response.apartment) {\r\n            const newApartment = mapApartmentFromApi(response.apartment);\r\n            set((state) => ({ apartments: [...state.apartments, newApartment] }));\r\n            return newApartment;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create apartment:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateApartment: async (id, data) => {\r\n        try {\r\n          await apartmentsApi.update(id, data as any);\r\n          set((state) => ({\r\n            apartments: state.apartments.map((a) =>\r\n              a.id === id ? { ...a, ...data, updatedAt: new Date().toISOString() } : a\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to update apartment:', error);\r\n        }\r\n      },\r\n\r\n      deleteApartment: async (id) => {\r\n        try {\r\n          await apartmentsApi.delete(id);\r\n          set((state) => ({\r\n            apartments: state.apartments.filter((a) => a.id !== id),\r\n            meters: state.meters.filter((m) => m.apartmentId !== id),\r\n            residents: state.residents.filter((r) => r.apartmentId !== id),\r\n            personalAccounts: state.personalAccounts.filter((p) => p.apartmentId !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to delete apartment:', error);\r\n        }\r\n      },\r\n\r\n      getApartmentsByBuilding: (buildingId) => {\r\n        return get().apartments.filter((a) => a.buildingId === buildingId);\r\n      },\r\n\r\n      getApartmentsByEntrance: (entranceId) => {\r\n        return get().apartments.filter((a) => a.entranceId === entranceId);\r\n      },\r\n\r\n      getApartmentById: (id) => {\r\n        return get().apartments.find((a) => a.id === id);\r\n      },\r\n\r\n      // ========== API-DRIVEN METER ACTIONS ==========\r\n\r\n      fetchMetersByApartment: async (apartmentId: string, options?: { type?: string; isActive?: boolean }) => {\r\n        set({ isLoadingMeters: true });\r\n        try {\r\n          const response = await metersApi.getByApartment(apartmentId, options);\r\n          const meters = (response.meters || []).map(mapMeterFromApi);\r\n\r\n          // Replace meters for this apartment\r\n          set((state) => {\r\n            const otherMeters = state.meters.filter((m) => m.apartmentId !== apartmentId);\r\n            return { meters: [...otherMeters, ...meters], isLoadingMeters: false };\r\n          });\r\n\r\n          return meters;\r\n        } catch (error) {\r\n          console.error('Failed to fetch meters:', error);\r\n          set({ isLoadingMeters: false });\r\n          return [];\r\n        }\r\n      },\r\n\r\n      fetchMetersByBuilding: async (buildingId: string, options?: { type?: string; isCommon?: boolean }) => {\r\n        set({ isLoadingMeters: true });\r\n        try {\r\n          const response = await metersApi.getByBuilding(buildingId, options);\r\n          const meters = (response.meters || []).map(mapMeterFromApi);\r\n\r\n          // Replace building meters\r\n          set((state) => {\r\n            const otherMeters = state.meters.filter((m) => m.buildingId !== buildingId);\r\n            return { meters: [...otherMeters, ...meters], isLoadingMeters: false };\r\n          });\r\n\r\n          return meters;\r\n        } catch (error) {\r\n          console.error('Failed to fetch building meters:', error);\r\n          set({ isLoadingMeters: false });\r\n          return [];\r\n        }\r\n      },\r\n\r\n      fetchMeterById: async (id: string) => {\r\n        try {\r\n          const response = await metersApi.getById(id);\r\n          if (!response.meter) return null;\r\n\r\n          const meter = mapMeterFromApi(response.meter);\r\n          const readings = (response.readings || []).map(mapMeterReadingFromApi);\r\n\r\n          // Update local state\r\n          set((state) => {\r\n            const updatedMeters = state.meters.some((m) => m.id === id)\r\n              ? state.meters.map((m) => (m.id === id ? meter : m))\r\n              : [...state.meters, meter];\r\n\r\n            // Replace readings for this meter\r\n            const otherReadings = state.meterReadings.filter((r) => r.meterId !== id);\r\n            return { meters: updatedMeters, meterReadings: [...otherReadings, ...readings] };\r\n          });\r\n\r\n          return { meter, readings };\r\n        } catch (error) {\r\n          console.error('Failed to fetch meter:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      addMeter: async (meterData) => {\r\n        try {\r\n          const response = await metersApi.create({\r\n            apartmentId: meterData.apartmentId,\r\n            buildingId: meterData.buildingId,\r\n            type: meterData.type as any,\r\n            isCommon: meterData.isCommon,\r\n            serialNumber: meterData.serialNumber,\r\n            model: meterData.model,\r\n            brand: meterData.brand,\r\n            installDate: meterData.installDate,\r\n            location: meterData.location,\r\n            initialValue: meterData.initialValue,\r\n            verificationDate: meterData.verificationDate,\r\n            nextVerificationDate: meterData.nextVerificationDate,\r\n            sealNumber: meterData.sealNumber,\r\n          });\r\n          if (response.meter) {\r\n            const newMeter = mapMeterFromApi(response.meter);\r\n            set((state) => ({ meters: [...state.meters, newMeter] }));\r\n            return newMeter;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create meter:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateMeter: async (id, data) => {\r\n        try {\r\n          await metersApi.update(id, data as any);\r\n          set((state) => ({\r\n            meters: state.meters.map((m) =>\r\n              m.id === id ? { ...m, ...data, updatedAt: new Date().toISOString() } : m\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to update meter:', error);\r\n        }\r\n      },\r\n\r\n      deleteMeter: async (id) => {\r\n        try {\r\n          await metersApi.delete(id);\r\n          set((state) => ({\r\n            meters: state.meters.filter((m) => m.id !== id),\r\n            meterReadings: state.meterReadings.filter((r) => r.meterId !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to delete meter:', error);\r\n        }\r\n      },\r\n\r\n      decommissionMeter: async (id, reason) => {\r\n        try {\r\n          await metersApi.decommission(id, reason);\r\n          set((state) => ({\r\n            meters: state.meters.map((m) =>\r\n              m.id === id ? { ...m, isActive: false } : m\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to decommission meter:', error);\r\n        }\r\n      },\r\n\r\n      getMetersByApartment: (apartmentId) => {\r\n        return get().meters.filter((m) => m.apartmentId === apartmentId);\r\n      },\r\n\r\n      getCommonMetersByBuilding: (buildingId) => {\r\n        return get().meters.filter((m) => m.buildingId === buildingId && m.isCommon);\r\n      },\r\n\r\n      // ========== API-DRIVEN METER READING ACTIONS ==========\r\n\r\n      fetchMeterReadings: async (meterId: string, options?: { limit?: number; offset?: number }) => {\r\n        try {\r\n          const response = await meterReadingsApi.getByMeter(meterId, options);\r\n          const readings = (response.readings || []).map(mapMeterReadingFromApi);\r\n\r\n          // Replace readings for this meter\r\n          set((state) => {\r\n            const otherReadings = state.meterReadings.filter((r) => r.meterId !== meterId);\r\n            return { meterReadings: [...otherReadings, ...readings] };\r\n          });\r\n\r\n          return readings;\r\n        } catch (error) {\r\n          console.error('Failed to fetch meter readings:', error);\r\n          return [];\r\n        }\r\n      },\r\n\r\n      submitMeterReading: async (meterId, readingData) => {\r\n        try {\r\n          const response = await meterReadingsApi.submit(meterId, readingData);\r\n          if (response.reading) {\r\n            const newReading = mapMeterReadingFromApi(response.reading);\r\n\r\n            // Update meter's current value and add reading to state\r\n            set((state) => ({\r\n              meterReadings: [...state.meterReadings, newReading],\r\n              meters: state.meters.map((m) =>\r\n                m.id === meterId\r\n                  ? {\r\n                      ...m,\r\n                      currentValue: readingData.value,\r\n                      lastReadingDate: readingData.readingDate || new Date().toISOString().split('T')[0],\r\n                    }\r\n                  : m\r\n              ),\r\n            }));\r\n\r\n            return newReading;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to submit meter reading:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      verifyMeterReading: async (readingId, approved, rejectionReason) => {\r\n        try {\r\n          await meterReadingsApi.verify(readingId, { approved, rejectionReason });\r\n\r\n          set((state) => ({\r\n            meterReadings: state.meterReadings.map((r) =>\r\n              r.id === readingId\r\n                ? { ...r, isVerified: approved, status: approved ? 'approved' : 'rejected', rejectionReason }\r\n                : r\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to verify meter reading:', error);\r\n        }\r\n      },\r\n\r\n      getMeterReadings: (meterId) => {\r\n        return get()\r\n          .meterReadings.filter((r) => r.meterId === meterId)\r\n          .sort((a, b) => new Date(b.readingDate).getTime() - new Date(a.readingDate).getTime());\r\n      },\r\n\r\n      getLastReading: (meterId) => {\r\n        const readings = get().getMeterReadings(meterId);\r\n        return readings.length > 0 ? readings[0] : undefined;\r\n      },\r\n\r\n      // ========== API-DRIVEN OWNER ACTIONS ==========\r\n\r\n      fetchOwners: async (options?: { type?: string; search?: string }) => {\r\n        set({ isLoadingOwners: true });\r\n        try {\r\n          const response = await ownersApi.getAll(options);\r\n          const owners = (response.owners || []).map(mapOwnerFromApi);\r\n          set({ owners, isLoadingOwners: false });\r\n          return owners;\r\n        } catch (error) {\r\n          console.error('Failed to fetch owners:', error);\r\n          set({ isLoadingOwners: false });\r\n          return [];\r\n        }\r\n      },\r\n\r\n      fetchOwnerById: async (id: string) => {\r\n        try {\r\n          const response = await ownersApi.getById(id);\r\n          if (!response.owner) return null;\r\n\r\n          const owner = mapOwnerFromApi(response.owner);\r\n          const apartments = (response.apartments || []).map(mapApartmentFromApi);\r\n\r\n          // Update local state\r\n          set((state) => {\r\n            const updatedOwners = state.owners.some((o) => o.id === id)\r\n              ? state.owners.map((o) => (o.id === id ? owner : o))\r\n              : [...state.owners, owner];\r\n            return { owners: updatedOwners };\r\n          });\r\n\r\n          return { owner, apartments };\r\n        } catch (error) {\r\n          console.error('Failed to fetch owner:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      addOwner: async (ownerData) => {\r\n        try {\r\n          const response = await ownersApi.create({\r\n            type: ownerData.type,\r\n            lastName: ownerData.lastName,\r\n            firstName: ownerData.firstName,\r\n            middleName: ownerData.middleName,\r\n            fullName: ownerData.fullName,\r\n            phone: ownerData.phone,\r\n            email: ownerData.email,\r\n            ownershipType: ownerData.ownershipType,\r\n            ownershipShare: ownerData.ownershipShare,\r\n          });\r\n          if (response.owner) {\r\n            const newOwner = mapOwnerFromApi(response.owner);\r\n            set((state) => ({ owners: [...state.owners, newOwner] }));\r\n            return newOwner;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create owner:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateOwner: async (id, data) => {\r\n        try {\r\n          await ownersApi.update(id, data as any);\r\n          set((state) => ({\r\n            owners: state.owners.map((o) =>\r\n              o.id === id ? { ...o, ...data, updatedAt: new Date().toISOString() } : o\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to update owner:', error);\r\n        }\r\n      },\r\n\r\n      deleteOwner: async (id) => {\r\n        try {\r\n          await ownersApi.delete(id);\r\n          set((state) => ({\r\n            owners: state.owners.filter((o) => o.id !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to delete owner:', error);\r\n        }\r\n      },\r\n\r\n      linkOwnerToApartment: async (ownerId, apartmentId, data) => {\r\n        try {\r\n          await ownersApi.linkToApartment(ownerId, apartmentId, data);\r\n          // Update local state - add apartment to owner's apartmentIds\r\n          set((state) => ({\r\n            owners: state.owners.map((o) =>\r\n              o.id === ownerId\r\n                ? { ...o, apartmentIds: [...(o.apartmentIds || []), apartmentId] }\r\n                : o\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to link owner to apartment:', error);\r\n        }\r\n      },\r\n\r\n      unlinkOwnerFromApartment: async (ownerId, apartmentId) => {\r\n        try {\r\n          await ownersApi.unlinkFromApartment(ownerId, apartmentId);\r\n          set((state) => ({\r\n            owners: state.owners.map((o) =>\r\n              o.id === ownerId\r\n                ? { ...o, apartmentIds: (o.apartmentIds || []).filter((id) => id !== apartmentId) }\r\n                : o\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to unlink owner from apartment:', error);\r\n        }\r\n      },\r\n\r\n      getOwnerById: (id) => {\r\n        return get().owners.find((o) => o.id === id);\r\n      },\r\n\r\n      getOwnersByApartment: (apartmentId) => {\r\n        return get().owners.filter((o) => o.apartmentIds?.includes(apartmentId));\r\n      },\r\n\r\n      searchOwners: (query) => {\r\n        const lowerQuery = query.toLowerCase();\r\n        return get().owners.filter(\r\n          (o) =>\r\n            o.fullName?.toLowerCase().includes(lowerQuery) ||\r\n            o.phone?.includes(query) ||\r\n            o.email?.toLowerCase().includes(lowerQuery)\r\n        );\r\n      },\r\n\r\n      // ========== API-DRIVEN RESIDENT ACTIONS ==========\r\n\r\n      fetchResidentsByApartment: async (apartmentId: string, options?: { isActive?: boolean }) => {\r\n        set({ isLoadingResidents: true });\r\n        try {\r\n          const response = await crmResidentsApi.getByApartment(apartmentId, options);\r\n          const residents = (response.residents || []).map(mapResidentFromApi);\r\n\r\n          // Replace residents for this apartment\r\n          set((state) => {\r\n            const otherResidents = state.residents.filter((r) => r.apartmentId !== apartmentId);\r\n            return { residents: [...otherResidents, ...residents], isLoadingResidents: false };\r\n          });\r\n\r\n          return residents;\r\n        } catch (error) {\r\n          console.error('Failed to fetch residents:', error);\r\n          set({ isLoadingResidents: false });\r\n          return [];\r\n        }\r\n      },\r\n\r\n      fetchResidentById: async (id: string) => {\r\n        try {\r\n          const response = await crmResidentsApi.getById(id);\r\n          if (!response.resident) return null;\r\n\r\n          const resident = mapResidentFromApi(response.resident);\r\n\r\n          // Update local state\r\n          set((state) => {\r\n            const updatedResidents = state.residents.some((r) => r.id === id)\r\n              ? state.residents.map((r) => (r.id === id ? resident : r))\r\n              : [...state.residents, resident];\r\n            return { residents: updatedResidents };\r\n          });\r\n\r\n          return resident;\r\n        } catch (error) {\r\n          console.error('Failed to fetch resident:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      addResident: async (apartmentId, residentData) => {\r\n        try {\r\n          const response = await crmResidentsApi.create(apartmentId, {\r\n            lastName: residentData.lastName,\r\n            firstName: residentData.firstName,\r\n            middleName: residentData.middleName,\r\n            fullName: residentData.fullName,\r\n            birthDate: residentData.birthDate,\r\n            residentType: residentData.residentType,\r\n            relationToOwner: residentData.relationToOwner,\r\n            registrationType: residentData.registrationType,\r\n            registrationDate: residentData.registrationDate,\r\n            phone: residentData.phone,\r\n            email: residentData.email,\r\n            movedInDate: residentData.movedInDate,\r\n            ownerId: residentData.ownerId,\r\n          });\r\n          if (response.resident) {\r\n            const newResident = mapResidentFromApi(response.resident);\r\n            set((state) => ({ residents: [...state.residents, newResident] }));\r\n            return newResident;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create resident:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateResident: async (id, data) => {\r\n        try {\r\n          await crmResidentsApi.update(id, data as any);\r\n          set((state) => ({\r\n            residents: state.residents.map((r) =>\r\n              r.id === id ? { ...r, ...data, updatedAt: new Date().toISOString() } : r\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to update resident:', error);\r\n        }\r\n      },\r\n\r\n      deleteResident: async (id) => {\r\n        try {\r\n          await crmResidentsApi.delete(id);\r\n          set((state) => ({\r\n            residents: state.residents.filter((r) => r.id !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to delete resident:', error);\r\n        }\r\n      },\r\n\r\n      moveOutResident: async (id, data) => {\r\n        try {\r\n          await crmResidentsApi.moveOut(id, data);\r\n          set((state) => ({\r\n            residents: state.residents.map((r) =>\r\n              r.id === id ? { ...r, isActive: false, movedOutDate: data.movedOutDate, movedOutReason: data.reason } : r\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to move out resident:', error);\r\n        }\r\n      },\r\n\r\n      getResidentsByApartment: (apartmentId) => {\r\n        return get().residents.filter((r) => r.apartmentId === apartmentId);\r\n      },\r\n\r\n      // ========== API-DRIVEN PERSONAL ACCOUNT ACTIONS ==========\r\n\r\n      fetchAccountsByBuilding: async (buildingId: string, options?: { status?: string; hasDebt?: boolean }) => {\r\n        set({ isLoadingAccounts: true });\r\n        try {\r\n          const response = await personalAccountsApi.getByBuilding(buildingId, options);\r\n          const accounts = (response.accounts || []).map(mapAccountFromApi);\r\n\r\n          // Replace accounts for this building\r\n          set((state) => {\r\n            const otherAccounts = state.personalAccounts.filter((a) => a.buildingId !== buildingId);\r\n            return { personalAccounts: [...otherAccounts, ...accounts], isLoadingAccounts: false };\r\n          });\r\n\r\n          return accounts;\r\n        } catch (error) {\r\n          console.error('Failed to fetch accounts:', error);\r\n          set({ isLoadingAccounts: false });\r\n          return [];\r\n        }\r\n      },\r\n\r\n      addPersonalAccount: async (accountData) => {\r\n        try {\r\n          const response = await personalAccountsApi.create({\r\n            apartmentId: accountData.apartmentId,\r\n            buildingId: accountData.buildingId,\r\n            primaryOwnerId: accountData.primaryOwnerId,\r\n            ownerName: accountData.ownerName,\r\n            apartmentNumber: accountData.apartmentNumber,\r\n            totalArea: accountData.totalArea,\r\n            residentsCount: accountData.residentsCount,\r\n            balance: accountData.balance,\r\n            currentDebt: accountData.currentDebt,\r\n          });\r\n          if (response.account) {\r\n            const newAccount = mapAccountFromApi(response.account);\r\n            set((state) => ({ personalAccounts: [...state.personalAccounts, newAccount] }));\r\n            return newAccount;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create account:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updatePersonalAccount: async (id, data) => {\r\n        try {\r\n          await personalAccountsApi.update(id, data as any);\r\n          set((state) => ({\r\n            personalAccounts: state.personalAccounts.map((a) =>\r\n              a.id === id ? { ...a, ...data, updatedAt: new Date().toISOString() } : a\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to update account:', error);\r\n        }\r\n      },\r\n\r\n      getPersonalAccountById: (id) => {\r\n        return get().personalAccounts.find((a) => a.id === id);\r\n      },\r\n\r\n      getPersonalAccountByApartment: (apartmentId) => {\r\n        return get().personalAccounts.find((a) => a.apartmentId === apartmentId);\r\n      },\r\n\r\n      getPersonalAccountsByBuilding: (buildingId) => {\r\n        return get().personalAccounts.filter((a) => a.buildingId === buildingId);\r\n      },\r\n\r\n      fetchDebtors: async (options?: { minDebt?: number; buildingId?: string }) => {\r\n        try {\r\n          const response = await personalAccountsApi.getDebtors(options);\r\n          return (response.debtors || []).map(mapAccountFromApi);\r\n        } catch (error) {\r\n          console.error('Failed to fetch debtors:', error);\r\n          return [];\r\n        }\r\n      },\r\n\r\n      getDebtors: (minDebt = 0) => {\r\n        return get()\r\n          .personalAccounts.filter((a) => a.currentDebt > minDebt)\r\n          .sort((a, b) => b.currentDebt - a.currentDebt);\r\n      },\r\n\r\n      // Stats\r\n      getBuildingStats: () => {\r\n        const { buildings, apartments, residents, owners, personalAccounts } = get();\r\n        const totalDebt = personalAccounts.reduce((sum, a) => sum + a.currentDebt, 0);\r\n        const totalCollectionRates = buildings.reduce((sum, b) => sum + b.collectionRate, 0);\r\n\r\n        return {\r\n          totalBuildings: buildings.length,\r\n          totalApartments: apartments.length,\r\n          totalResidents: residents.length,\r\n          totalOwners: owners.length,\r\n          totalDebt,\r\n          avgCollectionRate: buildings.length > 0 ? totalCollectionRates / buildings.length : 0,\r\n        };\r\n      },\r\n    }),\r\n    {\r\n      name: 'uk-crm-storage',\r\n      version: 4, // Increment to clear old cache - all data now comes from API\r\n      // Do NOT persist data that should come from API\r\n      // Only persist UI state if needed\r\n      partialize: () => ({\r\n        // All data now loaded from API - no local caching\r\n        // This ensures data is consistent across all browsers/devices\r\n      }),\r\n      // Migration to add branchCode and fix duplicate IDs\r\n      migrate: (persistedState: unknown, _version: number) => {\r\n        const state = persistedState as Partial<CRMState>;\r\n\r\n        // Helper function to extract building number from address\r\n        // Supports: \"8-\", \" 8\", \". 8\", \"8B-\", etc.\r\n        const extractBuildingFromAddress = (address: string): string => {\r\n          if (!address) return '';\r\n\r\n          // Uzbek format: \"8-\" or \" 8\"\r\n          const uzMatch = address.match(/(\\d+[--A-Za-z]?)-|\\s*(\\d+[--A-Za-z]?)/i);\r\n          if (uzMatch) {\r\n            const num = (uzMatch[1] || uzMatch[2]).toUpperCase();\r\n            // Convert Cyrillic to Latin:  -> B,  -> A\r\n            return num.replace(//gi, 'B').replace(//gi, 'A');\r\n          }\r\n\r\n          // Russian format: \" 8\", \". 8\"\r\n          const ruMatch = address.match(/(?:|\\.?)\\s*(\\d+[--A-Za-z]?)/i);\r\n          if (ruMatch) {\r\n            const num = ruMatch[1].toUpperCase();\r\n            return num.replace(//gi, 'B').replace(//gi, 'A');\r\n          }\r\n\r\n          return '';\r\n        };\r\n\r\n        if (state.buildings) {\r\n          // Ensure each building has unique ID, branchCode and buildingNumber\r\n          const seenIds = new Set<string>();\r\n          state.buildings = state.buildings.map((building, index) => {\r\n            let updatedBuilding = { ...building };\r\n\r\n            // Fix duplicate or missing IDs\r\n            if (!updatedBuilding.id || seenIds.has(updatedBuilding.id)) {\r\n              updatedBuilding.id = `building_${Date.now()}_${index}`;\r\n            }\r\n            seenIds.add(updatedBuilding.id);\r\n\r\n            // Add branchCode if missing\r\n            if (!updatedBuilding.branchCode) {\r\n              updatedBuilding.branchCode = updatedBuilding.name?.includes('') ? 'YS' :\r\n                                           updatedBuilding.name?.includes('') ? 'CH' :\r\n                                           updatedBuilding.name?.includes('') ? 'SR' :\r\n                                           'YS';\r\n            }\r\n\r\n            // Add buildingNumber if missing - try to extract from address first\r\n            if (!updatedBuilding.buildingNumber) {\r\n              const extractedNumber = extractBuildingFromAddress(updatedBuilding.address || '');\r\n              updatedBuilding.buildingNumber = extractedNumber || `${index + 1}A`;\r\n            }\r\n\r\n            return updatedBuilding;\r\n          });\r\n        }\r\n        return state as CRMState;\r\n      },\r\n    }\r\n  )\r\n);\r\n","// Browser Push Notifications Service with Web Push API\r\nimport { apiRequest } from './api';\r\n\r\nexport type PushNotificationType =\r\n  | 'request_completed'      //   -  \r\n  | 'announcement_urgent'    //    \r\n  | 'announcement_meeting'   //  \r\n  | 'request_assigned'       //   \r\n  | 'request_started'        //  \r\n  | 'chat_message'           //    \r\n  | 'meeting'                // /\r\n  | 'announcement';          // \r\n\r\ninterface PushNotificationOptions {\r\n  title: string;\r\n  body: string;\r\n  icon?: string;\r\n  tag?: string;\r\n  requireInteraction?: boolean; //   \r\n  data?: {\r\n    url?: string;\r\n    requestId?: string;\r\n    announcementId?: string;\r\n    channelId?: string;\r\n    meetingId?: string;\r\n    type?: PushNotificationType;\r\n    priority?: 'low' | 'normal' | 'urgent';\r\n  };\r\n}\r\n\r\n// VAPID public key for Web Push (must match server's public key)\r\nconst VAPID_PUBLIC_KEY = 'BMTJw9s4vAY9Bzb05L8--r0XUDirigcJ0_yTTGuCLZL2uk8693U82ef7LLlWyLf9T-3PucveTAjYS_I36uv7RY4';\r\n\r\n// Convert VAPID key to Uint8Array (for applicationServerKey)\r\nfunction urlBase64ToUint8Array(base64String: string): ArrayBuffer {\r\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n  const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\r\n  const rawData = window.atob(base64);\r\n  const outputArray = new Uint8Array(rawData.length);\r\n  for (let i = 0; i < rawData.length; ++i) {\r\n    outputArray[i] = rawData.charCodeAt(i);\r\n  }\r\n  return outputArray.buffer;\r\n}\r\n\r\nclass PushNotificationService {\r\n  private permission: NotificationPermission = 'default';\r\n  private swRegistration: ServiceWorkerRegistration | null = null;\r\n  private pushSubscription: PushSubscription | null = null;\r\n\r\n  constructor() {\r\n    if ('Notification' in window) {\r\n      this.permission = Notification.permission;\r\n    }\r\n    this.initServiceWorker();\r\n  }\r\n\r\n  // Initialize service worker connection\r\n  private async initServiceWorker(): Promise<void> {\r\n    if ('serviceWorker' in navigator) {\r\n      try {\r\n        this.swRegistration = await navigator.serviceWorker.ready;\r\n        console.log('[Push] Service Worker ready');\r\n\r\n        // Check existing subscription\r\n        this.pushSubscription = await this.swRegistration.pushManager.getSubscription();\r\n        if (this.pushSubscription) {\r\n          console.log('[Push] Existing subscription found');\r\n        }\r\n      } catch (error) {\r\n        console.error('[Push] Service Worker init failed:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  //   \r\n  isSupported(): boolean {\r\n    return 'Notification' in window && 'serviceWorker' in navigator && 'PushManager' in window;\r\n  }\r\n\r\n  //     \r\n  isBrowserNotificationsSupported(): boolean {\r\n    return 'Notification' in window;\r\n  }\r\n\r\n  //   \r\n  getPermission(): NotificationPermission {\r\n    return this.permission;\r\n  }\r\n\r\n  // ,     push\r\n  isSubscribed(): boolean {\r\n    return this.pushSubscription !== null;\r\n  }\r\n\r\n  //    \r\n  async requestPermission(): Promise<boolean> {\r\n    if (!this.isBrowserNotificationsSupported()) {\r\n      console.warn('Push notifications are not supported in this browser');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const permission = await Notification.requestPermission();\r\n      this.permission = permission;\r\n      return permission === 'granted';\r\n    } catch (error) {\r\n      console.error('Failed to request notification permission:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //   Web Push \r\n  async subscribe(): Promise<PushSubscription | null> {\r\n    console.log('[Push] Starting subscription process...');\r\n    console.log('[Push] isSupported:', this.isSupported());\r\n    console.log('[Push] Permission:', this.permission);\r\n\r\n    if (!this.isSupported()) {\r\n      console.warn('[Push] Web Push not supported in this browser');\r\n      // Check specific APIs\r\n      console.log('[Push] Notification API:', 'Notification' in window);\r\n      console.log('[Push] ServiceWorker API:', 'serviceWorker' in navigator);\r\n      console.log('[Push] PushManager API:', 'PushManager' in window);\r\n      return null;\r\n    }\r\n\r\n    // Request permission first\r\n    if (this.permission !== 'granted') {\r\n      console.log('[Push] Requesting permission...');\r\n      const granted = await this.requestPermission();\r\n      console.log('[Push] Permission result:', granted, 'Current permission:', this.permission);\r\n      if (!granted) {\r\n        console.warn('[Push] Permission not granted');\r\n        return null;\r\n      }\r\n    }\r\n\r\n    // Wait for service worker\r\n    if (!this.swRegistration) {\r\n      console.log('[Push] Waiting for Service Worker...');\r\n      await this.initServiceWorker();\r\n    }\r\n\r\n    if (!this.swRegistration) {\r\n      console.error('[Push] Service Worker not available after init');\r\n      return null;\r\n    }\r\n    console.log('[Push] Service Worker ready:', this.swRegistration.scope);\r\n\r\n    try {\r\n      // Check for existing subscription\r\n      const existingSub = await this.swRegistration.pushManager.getSubscription();\r\n      if (existingSub) {\r\n        console.log('[Push] Found existing subscription, using it');\r\n        this.pushSubscription = existingSub;\r\n      } else {\r\n        // Subscribe to push\r\n        console.log('[Push] Creating new subscription with VAPID key...');\r\n        this.pushSubscription = await this.swRegistration.pushManager.subscribe({\r\n          userVisibleOnly: true,\r\n          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\r\n        });\r\n      }\r\n\r\n      console.log('[Push] Subscribed successfully!');\r\n      console.log('[Push] Endpoint:', this.pushSubscription.endpoint.substring(0, 60) + '...');\r\n\r\n      // Send subscription to server\r\n      console.log('[Push] Sending subscription to backend...');\r\n      await this.sendSubscriptionToServer(this.pushSubscription);\r\n\r\n      return this.pushSubscription;\r\n    } catch (error) {\r\n      console.error('[Push] Subscribe failed:', error);\r\n      // Log more details about the error\r\n      if (error instanceof Error) {\r\n        console.error('[Push] Error name:', error.name);\r\n        console.error('[Push] Error message:', error.message);\r\n      }\r\n      return null;\r\n    }\r\n  }\r\n\r\n  //   Web Push\r\n  async unsubscribe(): Promise<boolean> {\r\n    if (!this.pushSubscription) {\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      await this.pushSubscription.unsubscribe();\r\n\r\n      // Remove from server\r\n      await this.removeSubscriptionFromServer();\r\n\r\n      this.pushSubscription = null;\r\n      console.log('[Push] Unsubscribed');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('[Push] Unsubscribe failed:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //    \r\n  private async sendSubscriptionToServer(subscription: PushSubscription): Promise<void> {\r\n    try {\r\n      const subscriptionData = subscription.toJSON();\r\n      console.log('[Push] Sending subscription to server:', {\r\n        endpoint: subscriptionData.endpoint?.substring(0, 60) + '...',\r\n        hasP256dh: !!subscriptionData.keys?.p256dh,\r\n        hasAuth: !!subscriptionData.keys?.auth\r\n      });\r\n\r\n      const result = await apiRequest('/api/push/subscribe', {\r\n        method: 'POST',\r\n        body: JSON.stringify({\r\n          endpoint: subscriptionData.endpoint,\r\n          keys: subscriptionData.keys\r\n        })\r\n      });\r\n      console.log('[Push] Subscription sent to server, result:', result);\r\n    } catch (error) {\r\n      console.error('[Push] Failed to send subscription to server:', error);\r\n      // Re-throw to let caller know about failure\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  //    \r\n  private async removeSubscriptionFromServer(): Promise<void> {\r\n    try {\r\n      await apiRequest('/api/push/unsubscribe', {\r\n        method: 'POST'\r\n      });\r\n      console.log('[Push] Subscription removed from server');\r\n    } catch (error) {\r\n      console.error('[Push] Failed to remove subscription from server:', error);\r\n    }\r\n  }\r\n\r\n  //   \r\n  getSubscription(): PushSubscription | null {\r\n    return this.pushSubscription;\r\n  }\r\n\r\n  //  push-\r\n  async show(options: PushNotificationOptions): Promise<Notification | null> {\r\n    if (!this.isSupported()) {\r\n      console.warn('Push notifications are not supported');\r\n      return null;\r\n    }\r\n\r\n    //    , \r\n    if (this.permission !== 'granted') {\r\n      const granted = await this.requestPermission();\r\n      if (!granted) {\r\n        console.warn('Notification permission not granted');\r\n        return null;\r\n      }\r\n    }\r\n\r\n    try {\r\n      const notification = new Notification(options.title, {\r\n        body: options.body,\r\n        icon: options.icon || '/favicon.ico',\r\n        tag: options.tag,\r\n        requireInteraction: options.requireInteraction ?? true, //    \r\n        data: options.data,\r\n      });\r\n\r\n      //    \r\n      notification.onclick = (event) => {\r\n        event.preventDefault();\r\n        window.focus();\r\n\r\n        //   URL  data,   \r\n        if (options.data?.url) {\r\n          window.location.href = options.data.url;\r\n        }\r\n\r\n        notification.close();\r\n      };\r\n\r\n      return notification;\r\n    } catch (error) {\r\n      console.error('Failed to show notification:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  //     ( )\r\n  async notifyRequestCompleted(requestNumber: string | number, executorName: string, requestId: string): Promise<void> {\r\n    await this.show({\r\n      title: '  !',\r\n      body: ` ${requestNumber}: ${executorName}  . ,     .`,\r\n      tag: `request-completed-${requestId}`,\r\n      requireInteraction: true, //  -     \r\n      data: {\r\n        requestId,\r\n        url: '/', //    (dashboard)\r\n      },\r\n    });\r\n  }\r\n\r\n  //    \r\n  async notifyUrgentAnnouncement(title: string, message: string, announcementId: string): Promise<void> {\r\n    await this.show({\r\n      title: ` ${title}`,\r\n      body: message,\r\n      tag: `announcement-${announcementId}`,\r\n      requireInteraction: true,\r\n      data: {\r\n        announcementId,\r\n        url: '/',\r\n      },\r\n    });\r\n  }\r\n\r\n  //  \r\n  async notifyMeeting(title: string, date: string, time: string, announcementId: string): Promise<void> {\r\n    await this.show({\r\n      title: `  `,\r\n      body: `${title}\\n${date}  ${time}`,\r\n      tag: `meeting-${announcementId}`,\r\n      requireInteraction: true,\r\n      data: {\r\n        announcementId,\r\n        url: '/meetings',\r\n      },\r\n    });\r\n  }\r\n\r\n  //   \r\n  async notifyNewMeeting(meetingId: string, buildingAddress: string): Promise<void> {\r\n    await this.show({\r\n      title: '   ',\r\n      body: `    ${buildingAddress}.     !`,\r\n      tag: `new-meeting-${meetingId}`,\r\n      requireInteraction: true,\r\n      data: {\r\n        url: '/meetings',\r\n      },\r\n    });\r\n  }\r\n\r\n  //  \r\n  async notifyVotingOpen(meetingId: string, buildingAddress: string): Promise<void> {\r\n    await this.show({\r\n      title: '  !',\r\n      body: `     ${buildingAddress} .  !`,\r\n      tag: `voting-open-${meetingId}`,\r\n      requireInteraction: true,\r\n      data: {\r\n        url: '/meetings',\r\n      },\r\n    });\r\n  }\r\n\r\n  //   \r\n  async notifyVotingReminder(meetingId: string, hoursLeft: number): Promise<void> {\r\n    await this.show({\r\n      title: '   ',\r\n      body: ` ${hoursLeft}    .   !`,\r\n      tag: `voting-reminder-${meetingId}`,\r\n      requireInteraction: true,\r\n      data: {\r\n        url: '/meetings',\r\n      },\r\n    });\r\n  }\r\n\r\n  //  \r\n  async notifyProtocolReady(meetingId: string, buildingAddress: string): Promise<void> {\r\n    await this.show({\r\n      title: '   ',\r\n      body: `    ${buildingAddress} .`,\r\n      tag: `protocol-ready-${meetingId}`,\r\n      requireInteraction: false,\r\n      data: {\r\n        url: '/meetings',\r\n      },\r\n    });\r\n  }\r\n\r\n  //  \r\n  async notifyAnnouncement(title: string, content: string, announcementId: string, priority: 'low' | 'normal' | 'urgent' = 'normal'): Promise<void> {\r\n    const icon = priority === 'urgent' ? '' : '';\r\n    await this.show({\r\n      title: `${icon} ${title}`,\r\n      body: content.length > 200 ? content.substring(0, 200) + '...' : content,\r\n      tag: `announcement-${announcementId}`,\r\n      requireInteraction: priority === 'urgent',\r\n      data: {\r\n        announcementId,\r\n        priority,\r\n        url: '/announcements',\r\n        type: 'announcement'\r\n      },\r\n    });\r\n  }\r\n\r\n  //     ( )\r\n  async notifyRequestAssigned(requestNumber: string | number, title: string, requestId: string): Promise<void> {\r\n    await this.show({\r\n      title: '   ',\r\n      body: ` ${requestNumber}: ${title}`,\r\n      tag: `request-assigned-${requestId}`,\r\n      requireInteraction: true,\r\n      data: {\r\n        requestId,\r\n        url: '/',\r\n      },\r\n    });\r\n  }\r\n\r\n  //     ( )\r\n  async notifyRequestStarted(requestNumber: string | number, executorName: string, requestId: string): Promise<void> {\r\n    await this.show({\r\n      title: '  ',\r\n      body: ` ${requestNumber}: ${executorName}  `,\r\n      tag: `request-started-${requestId}`,\r\n      requireInteraction: false, //   \r\n      data: {\r\n        requestId,\r\n        url: '/',\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const pushNotifications = new PushNotificationService();\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport type { Executor, Request, ChartData, Notification, ActivityLog, CancelledBy, RentalApartment, RentalRecord, Announcement, Vehicle, GuestAccessCode, GuestAccessLog, GuestAccessStats, VisitorType, AccessType, UserRole, RescheduleRequest, RescheduleReason, RescheduleInitiator } from '../types';\r\nimport { useAuthStore } from './authStore';\r\nimport { requestsApi, executorsApi, vehiclesApi, guestCodesApi, authApi, usersApi, rentalsApi } from '../services/api';\r\nimport { pushNotifications } from '../services/pushNotifications';\r\n\r\n// Settings interface\r\ninterface AppSettings {\r\n  companyName: string;\r\n  companyInn: string;\r\n  companyAddress: string;\r\n  companyPhone: string;\r\n  routingMode: 'manual' | 'auto' | 'hybrid';\r\n  workingHoursStart: string;\r\n  workingHoursEnd: string;\r\n  autoAssign: boolean;\r\n  notifyOnNew: boolean;\r\n  notifyOnComplete: boolean;\r\n  notifyOnRating: boolean;\r\n  smsNotifications: boolean;\r\n  emailNotifications: boolean;\r\n  pushNotifications: boolean;\r\n}\r\n\r\ninterface DataState {\r\n  executors: Executor[];\r\n  requests: Request[];\r\n  notifications: Notification[];\r\n  activityLogs: ActivityLog[];\r\n  settings: AppSettings;\r\n  rentalApartments: RentalApartment[];\r\n  rentalRecords: RentalRecord[];\r\n  announcements: Announcement[];\r\n  vehicles: Vehicle[];\r\n  guestAccessCodes: GuestAccessCode[];\r\n  guestAccessLogs: GuestAccessLog[];\r\n  rescheduleRequests: RescheduleRequest[];\r\n\r\n  // API loading states\r\n  isLoadingRequests: boolean;\r\n  isLoadingExecutors: boolean;\r\n  isLoadingVehicles: boolean;\r\n  isLoadingGuestCodes: boolean;\r\n\r\n  // API fetch actions\r\n  fetchRequests: (status?: string, category?: string) => Promise<void>;\r\n  fetchExecutors: (showAll?: boolean) => Promise<void>;\r\n  fetchVehicles: (forStaff?: boolean) => Promise<void>;\r\n  fetchGuestCodes: () => Promise<void>;\r\n\r\n  // Guest Access actions\r\n  createGuestAccessCode: (data: {\r\n    residentId: string;\r\n    residentName: string;\r\n    residentPhone: string;\r\n    residentApartment: string;\r\n    residentAddress: string;\r\n    visitorType: VisitorType;\r\n    visitorName?: string;\r\n    visitorPhone?: string;\r\n    visitorVehiclePlate?: string;\r\n    accessType: AccessType;\r\n    validFrom?: string;\r\n    validUntil?: string;\r\n    notes?: string;\r\n  }) => Promise<GuestAccessCode | null>;\r\n  revokeGuestAccessCode: (id: string, revokedBy: string, revokedByName: string, revokedByRole: UserRole, reason: string) => Promise<void>;\r\n  useGuestAccessCode: (id: string, fullCode?: GuestAccessCode) => boolean;\r\n  validateGuestAccessCode: (qrToken: string) => { valid: boolean; code?: GuestAccessCode; error?: string };\r\n  getGuestAccessCodesByResident: (residentId: string) => GuestAccessCode[];\r\n  getAllGuestAccessCodes: () => GuestAccessCode[];\r\n  addGuestAccessLog: (log: Omit<GuestAccessLog, 'id' | 'timestamp'>) => void;\r\n  getGuestAccessLogs: (accessCodeId?: string) => GuestAccessLog[];\r\n  getGuestAccessStats: () => GuestAccessStats;\r\n\r\n  // Announcement actions\r\n  addAnnouncement: (announcement: Omit<Announcement, 'id' | 'createdAt' | 'isActive' | 'viewedBy'>) => Promise<Announcement | null>;\r\n  updateAnnouncement: (id: string, data: Partial<Announcement>) => void;\r\n  deleteAnnouncement: (id: string) => Promise<void>;\r\n  markAnnouncementAsViewed: (announcementId: string, userId: string) => void;\r\n  getAnnouncementsForResidents: (userLogin: string, buildingId?: string, entrance?: string, floor?: string, branch?: string) => Announcement[];\r\n  getAnnouncementsForEmployees: () => Announcement[];\r\n  getAnnouncementsByAuthor: (authorId: string) => Announcement[];\r\n  fetchAnnouncements: () => Promise<void>;\r\n\r\n  // Vehicle actions\r\n  addVehicle: (vehicle: Omit<Vehicle, 'id' | 'createdAt'>) => Promise<Vehicle | null>;\r\n  updateVehicle: (id: string, data: Partial<Vehicle>) => Promise<void>;\r\n  deleteVehicle: (id: string) => Promise<void>;\r\n  getVehiclesByOwner: (ownerId: string) => Vehicle[];\r\n  searchVehicleByPlate: (plateNumber: string) => Promise<Vehicle | undefined>;\r\n  searchVehiclesByPlate: (plateNumber: string) => Promise<Vehicle[]>;\r\n\r\n  // Rental actions\r\n  fetchRentals: () => Promise<void>;\r\n  fetchMyRentals: () => Promise<void>;  // For tenants/commercial_owners\r\n  addRentalApartment: (apartment: Omit<RentalApartment, 'id' | 'createdAt' | 'isActive'> & { password: string; ownerType?: 'tenant' | 'commercial_owner' }) => Promise<RentalApartment | null>;\r\n  updateRentalApartment: (id: string, data: Partial<RentalApartment>) => Promise<void>;\r\n  deleteRentalApartment: (id: string) => Promise<void>;\r\n  getRentalApartmentsByOwner: (ownerId: string) => RentalApartment[];\r\n  addRentalRecord: (record: Omit<RentalRecord, 'id' | 'createdAt'>) => Promise<RentalRecord | null>;\r\n  updateRentalRecord: (id: string, data: Partial<RentalRecord>) => Promise<void>;\r\n  deleteRentalRecord: (id: string) => Promise<void>;\r\n  getRentalRecordsByApartment: (apartmentId: string) => RentalRecord[];\r\n\r\n  // Executor actions\r\n  addExecutor: (executor: Omit<Executor, 'id' | 'createdAt' | 'rating' | 'completedCount' | 'activeRequests' | 'status' | 'totalEarnings' | 'avgCompletionTime'> & { password: string; role?: string }) => Promise<Executor | null>;\r\n  updateExecutor: (id: string, data: Partial<Executor>) => void;\r\n  deleteExecutor: (id: string) => Promise<void>;\r\n  getExecutorStats: (executorId: string) => {\r\n    totalRequests: number;\r\n    completedRequests: number;\r\n    avgRating: number;\r\n    avgTime: number;\r\n    thisWeek: number;\r\n    thisMonth: number;\r\n  };\r\n\r\n  // Request actions (API-backed)\r\n  addRequest: (request: Omit<Request, 'id' | 'number' | 'createdAt' | 'status'>) => Promise<Request | null>;\r\n  assignRequest: (requestId: string, executorId: string) => Promise<void>;\r\n  acceptRequest: (requestId: string) => Promise<void>;\r\n  startWork: (requestId: string) => Promise<void>;\r\n  pauseWork: (requestId: string) => Promise<void>;\r\n  resumeWork: (requestId: string) => Promise<void>;\r\n  completeWork: (requestId: string, workDuration: number) => Promise<void>;\r\n  approveRequest: (requestId: string, rating: number, feedback?: string) => Promise<void>;\r\n  rejectRequest: (requestId: string, reason: string) => Promise<void>;\r\n  cancelRequest: (requestId: string, cancelledBy: CancelledBy, reason: string) => Promise<void>;\r\n  declineRequest: (requestId: string, reason: string) => Promise<void>; // Executor declines assigned request\r\n  getRequestsByResident: (residentId: string) => Request[];\r\n  getRequestsByExecutor: (executorId: string) => Request[];\r\n\r\n  // Notification actions\r\n  addNotification: (notification: Omit<Notification, 'id' | 'createdAt' | 'read'>) => void;\r\n  markNotificationAsRead: (id: string) => void;\r\n  markAllNotificationsAsRead: (userId: string) => void;\r\n  getUnreadCount: (userId: string) => number;\r\n\r\n  // Activity log\r\n  addActivityLog: (log: Omit<ActivityLog, 'id' | 'timestamp'>) => void;\r\n\r\n  // Stats\r\n  getStats: () => {\r\n    totalRequests: number;\r\n    newRequests: number;\r\n    inProgress: number;\r\n    pendingApproval: number;\r\n    completedToday: number;\r\n    completedWeek: number;\r\n    avgCompletionTime: number;\r\n    executorsOnline: number;\r\n    executorsTotal: number;\r\n  };\r\n  getChartData: () => ChartData[];\r\n\r\n  // Settings actions\r\n  fetchSettings: () => Promise<void>;\r\n  updateSettings: (settings: Partial<AppSettings>) => Promise<void>;\r\n\r\n  // Reschedule actions\r\n  fetchPendingReschedules: () => Promise<void>;\r\n  createRescheduleRequest: (data: {\r\n    requestId: string;\r\n    proposedDate: string;\r\n    proposedTime: string;\r\n    reason: RescheduleReason;\r\n    reasonText?: string;\r\n  }) => Promise<RescheduleRequest | null>;\r\n  respondToRescheduleRequest: (rescheduleId: string, accepted: boolean, responseNote?: string) => Promise<void>;\r\n  getRescheduleRequestsByRequest: (requestId: string) => RescheduleRequest[];\r\n  getPendingRescheduleForUser: (userId: string) => RescheduleRequest[];\r\n  getActiveRescheduleForRequest: (requestId: string) => RescheduleRequest | undefined;\r\n  getConfirmedRescheduleForRequest: (requestId: string) => RescheduleRequest | undefined;\r\n}\r\n\r\nconst generateId = () => Math.random().toString(36).substr(2, 9);\r\n\r\n// Demo QR code for testing\r\nconst createDemoGuestAccessCode = (): GuestAccessCode => {\r\n  const now = new Date();\r\n  const validUntil = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000); // Valid for 7 days\r\n\r\n  return {\r\n    id: 'demo-code-1',\r\n    residentId: 'resident1',\r\n    residentName: '  ',\r\n    residentPhone: '+998901234567',\r\n    residentApartment: '42',\r\n    residentAddress: '. , 15',\r\n    visitorType: 'guest' as VisitorType,\r\n    visitorName: ' ',\r\n    visitorPhone: '+998901111111',\r\n    accessType: 'week' as AccessType,\r\n    qrToken: 'GA-demo-test-code123',\r\n    status: 'active',\r\n    validFrom: now.toISOString(),\r\n    validUntil: validUntil.toISOString(),\r\n    maxUses: 999,\r\n    currentUses: 0,\r\n    createdAt: now.toISOString(),\r\n    updatedAt: now.toISOString(),\r\n  };\r\n};\r\n\r\n// Default settings\r\nconst defaultSettings: AppSettings = {\r\n  companyName: ' ',\r\n  companyInn: '305123456',\r\n  companyAddress: '. ,  ',\r\n  companyPhone: '+998 71 123 45 67',\r\n  routingMode: 'hybrid',\r\n  workingHoursStart: '08:00',\r\n  workingHoursEnd: '20:00',\r\n  autoAssign: true,\r\n  notifyOnNew: true,\r\n  notifyOnComplete: true,\r\n  notifyOnRating: true,\r\n  smsNotifications: false,\r\n  emailNotifications: true,\r\n  pushNotifications: true,\r\n};\r\n\r\nexport const useDataStore = create<DataState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      executors: [], // Start empty, will be loaded from API\r\n      requests: [], // Start with empty, will be loaded from API\r\n      notifications: [],\r\n      activityLogs: [],\r\n      settings: defaultSettings,\r\n      rentalApartments: [],\r\n      rentalRecords: [],\r\n      announcements: [],\r\n      vehicles: [],\r\n      guestAccessCodes: [createDemoGuestAccessCode()],\r\n      guestAccessLogs: [],\r\n      rescheduleRequests: [],\r\n      isLoadingRequests: false,\r\n      isLoadingExecutors: false,\r\n      isLoadingVehicles: false,\r\n      isLoadingGuestCodes: false,\r\n\r\n      // Fetch requests from D1 database via API\r\n      fetchRequests: async (status?: string, category?: string) => {\r\n        set({ isLoadingRequests: true });\r\n        try {\r\n          const response = await requestsApi.getAll(status, category);\r\n          // Map API response to Request type\r\n          const requests = response.requests || [];\r\n          const mappedRequests: Request[] = requests.map((r: any) => ({\r\n            id: r.id,\r\n            // Use prefixed request_number first, then number, then generate from id\r\n            number: r.request_number || r.number || `#${r.id?.substring(0, 6).toUpperCase() || '000000'}`,\r\n            title: r.title,\r\n            description: r.description || '',\r\n            category: r.category_id,\r\n            status: r.status,\r\n            priority: r.priority || 'medium',\r\n            residentId: r.resident_id,\r\n            residentName: r.resident_name || '',\r\n            residentPhone: r.resident_phone || '',\r\n            address: r.address || '',\r\n            apartment: r.apartment || '',\r\n            executorId: r.executor_id,\r\n            executorName: r.executor_name,\r\n            executorPhone: r.executor_phone,\r\n            accessInfo: r.access_info,\r\n            scheduledDate: r.scheduled_at ? r.scheduled_at.split('T')[0] : undefined,\r\n            scheduledTime: r.scheduled_at ? r.scheduled_at.split('T')[1]?.substring(0, 5) : undefined,\r\n            createdAt: r.created_at,\r\n            assignedAt: r.assigned_at,\r\n            acceptedAt: r.accepted_at,\r\n            startedAt: r.started_at,\r\n            completedAt: r.completed_at,\r\n            approvedAt: r.approved_at,\r\n            rating: r.rating,\r\n            feedback: r.feedback,\r\n            workDuration: r.work_duration,\r\n            buildingId: r.building_id,\r\n            buildingName: r.building_name,\r\n            // Pause fields from DB\r\n            isPaused: r.is_paused === 1 || r.is_paused === true,\r\n            pausedAt: r.paused_at,\r\n            totalPausedTime: r.total_paused_time || 0,\r\n          }));\r\n\r\n          // Keep pending/optimistic requests (temp-*) that are still being created\r\n          // This prevents losing requests that haven't been saved to API yet\r\n          set((state) => {\r\n            const pendingRequests = state.requests.filter(r => r.id.startsWith('temp-'));\r\n            // Merge: API data + pending requests (that aren't already in API response)\r\n            const mergedRequests = [\r\n              ...pendingRequests,\r\n              ...mappedRequests.filter(apiReq => !pendingRequests.some(p => p.id === apiReq.id))\r\n            ];\r\n            return { requests: mergedRequests, isLoadingRequests: false };\r\n          });\r\n        } catch (error) {\r\n          console.error('Failed to fetch requests:', error);\r\n          set({ isLoadingRequests: false });\r\n        }\r\n      },\r\n\r\n      // Fetch executors from D1 database via API\r\n      fetchExecutors: async (showAll = false) => {\r\n        console.log('[fetchExecutors] Starting fetch... showAll:', showAll);\r\n        set({ isLoadingExecutors: true });\r\n        try {\r\n          const response = await executorsApi.getAll(showAll);\r\n          console.log('[fetchExecutors] API response:', response);\r\n          // Map API response to Executor type\r\n          const mappedExecutors: Executor[] = response.executors.map((e: any) => ({\r\n            id: e.id,\r\n            name: e.name,\r\n            phone: e.phone,\r\n            login: e.login,\r\n            specialization: e.specialization,\r\n            status: e.status || 'offline',\r\n            rating: e.rating || 5.0,\r\n            completedCount: e.completed_count || 0,\r\n            activeRequests: e.active_requests || 0,\r\n            totalEarnings: e.total_earnings || 0,\r\n            avgCompletionTime: e.avg_completion_time || 0,\r\n            createdAt: e.created_at,\r\n          }));\r\n          console.log('[fetchExecutors] Mapped executors:', mappedExecutors);\r\n          set({ executors: mappedExecutors, isLoadingExecutors: false });\r\n        } catch (error) {\r\n          console.error('[fetchExecutors] Failed to fetch executors:', error);\r\n          set({ isLoadingExecutors: false });\r\n        }\r\n      },\r\n\r\n      // Fetch vehicles from D1 database via API\r\n      fetchVehicles: async (forStaff = false) => {\r\n        set({ isLoadingVehicles: true });\r\n        try {\r\n          // Use different endpoint based on whether we need all vehicles or just user's own\r\n          const response = forStaff\r\n            ? await vehiclesApi.getAll()  // /api/vehicles/all - all vehicles for staff\r\n            : await vehiclesApi.getMyVehicles();  // /api/vehicles - only user's vehicles\r\n          // Map API response to Vehicle type (API now returns all fields from DB + owner info)\r\n          const mappedVehicles: Vehicle[] = response.vehicles.map((v: any) => ({\r\n            id: v.id,\r\n            ownerId: v.user_id,\r\n            ownerName: v.owner_name || '',\r\n            ownerPhone: v.owner_phone || '',\r\n            apartment: v.apartment || '',\r\n            address: v.address || '',\r\n            plateNumber: v.plate_number,\r\n            brand: v.brand || '',\r\n            model: v.model || '',\r\n            color: v.color || '',\r\n            year: v.year || undefined,\r\n            type: (v.vehicle_type || 'car') as Vehicle['type'],\r\n            ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\r\n            companyName: v.company_name || undefined,\r\n            parkingSpot: v.parking_spot || undefined,\r\n            notes: v.notes || undefined,\r\n            createdAt: v.created_at,\r\n            updatedAt: v.updated_at || undefined,\r\n          }));\r\n          set({ vehicles: mappedVehicles, isLoadingVehicles: false });\r\n        } catch (error) {\r\n          console.error('Failed to fetch vehicles:', error);\r\n          set({ isLoadingVehicles: false });\r\n        }\r\n      },\r\n\r\n      // Fetch guest codes from D1 database via API\r\n      fetchGuestCodes: async () => {\r\n        set({ isLoadingGuestCodes: true });\r\n        try {\r\n          const response = await guestCodesApi.getAll();\r\n          const codes = response.codes || [];\r\n          const mappedCodes: GuestAccessCode[] = codes.map((c: any) => ({\r\n            id: c.id,\r\n            residentId: c.user_id,\r\n            residentName: c.resident_name || '',\r\n            residentPhone: c.resident_phone || '',\r\n            residentApartment: c.resident_apartment || '',\r\n            residentAddress: c.resident_address || '',\r\n            visitorType: c.visitor_type as VisitorType,\r\n            visitorName: c.visitor_name || undefined,\r\n            visitorPhone: c.visitor_phone || undefined,\r\n            visitorVehiclePlate: c.visitor_vehicle_plate || undefined,\r\n            accessType: c.access_type as AccessType,\r\n            validFrom: c.valid_from,\r\n            validUntil: c.valid_until,\r\n            maxUses: c.max_uses,\r\n            currentUses: c.current_uses || 0,\r\n            qrToken: c.qr_token,\r\n            status: c.status as 'active' | 'used' | 'expired' | 'revoked',\r\n            notes: c.notes || undefined,\r\n            createdAt: c.created_at,\r\n            updatedAt: c.updated_at || undefined,\r\n            revokedAt: c.revoked_at || undefined,\r\n            revokedBy: c.revoked_by || undefined,\r\n            revocationReason: c.revoked_reason || undefined,\r\n          }));\r\n          set({ guestAccessCodes: mappedCodes, isLoadingGuestCodes: false });\r\n        } catch (error) {\r\n          console.error('Failed to fetch guest codes:', error);\r\n          set({ isLoadingGuestCodes: false });\r\n        }\r\n      },\r\n\r\n      // Guest Access actions\r\n      createGuestAccessCode: async (data) => {\r\n        try {\r\n          const response = await guestCodesApi.create({\r\n            visitor_type: data.visitorType,\r\n            visitor_name: data.visitorName,\r\n            visitor_phone: data.visitorPhone,\r\n            visitor_vehicle_plate: data.visitorVehiclePlate,\r\n            access_type: data.accessType,\r\n            valid_from: data.validFrom,\r\n            valid_until: data.validUntil,\r\n            resident_name: data.residentName,\r\n            resident_phone: data.residentPhone,\r\n            resident_apartment: data.residentApartment,\r\n            resident_address: data.residentAddress,\r\n            notes: data.notes,\r\n          });\r\n\r\n          const c = response.code;\r\n          const newCode: GuestAccessCode = {\r\n            id: c.id,\r\n            residentId: c.user_id || data.residentId,\r\n            residentName: c.resident_name || data.residentName,\r\n            residentPhone: c.resident_phone || data.residentPhone,\r\n            residentApartment: c.resident_apartment || data.residentApartment,\r\n            residentAddress: c.resident_address || data.residentAddress,\r\n            visitorType: c.visitor_type as VisitorType,\r\n            visitorName: c.visitor_name || undefined,\r\n            visitorPhone: c.visitor_phone || undefined,\r\n            visitorVehiclePlate: c.visitor_vehicle_plate || undefined,\r\n            accessType: c.access_type as AccessType,\r\n            validFrom: c.valid_from,\r\n            validUntil: c.valid_until,\r\n            maxUses: c.max_uses,\r\n            currentUses: c.current_uses || 0,\r\n            qrToken: c.qr_token,\r\n            status: c.status as 'active' | 'used' | 'expired' | 'revoked',\r\n            notes: c.notes || undefined,\r\n            createdAt: c.created_at,\r\n          };\r\n\r\n          set((state) => ({\r\n            guestAccessCodes: [newCode, ...state.guestAccessCodes],\r\n          }));\r\n\r\n          return newCode;\r\n        } catch (error) {\r\n          console.error('Failed to create guest code:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      revokeGuestAccessCode: async (id, revokedBy, revokedByName, revokedByRole, reason) => {\r\n        try {\r\n          await guestCodesApi.revoke(id, reason);\r\n          set((state) => ({\r\n            guestAccessCodes: state.guestAccessCodes.map((code) =>\r\n              code.id === id\r\n                ? {\r\n                    ...code,\r\n                    status: 'revoked' as const,\r\n                    revokedAt: new Date().toISOString(),\r\n                    revokedBy,\r\n                    revokedByName,\r\n                    revokedByRole,\r\n                    revocationReason: reason,\r\n                    updatedAt: new Date().toISOString(),\r\n                  }\r\n                : code\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to revoke guest code:', error);\r\n        }\r\n      },\r\n\r\n      useGuestAccessCode: (id, fullCode?: GuestAccessCode) => {\r\n        console.log('=== USING GUEST ACCESS CODE ===');\r\n        console.log('Code ID:', id);\r\n        console.log('Full code provided:', !!fullCode);\r\n\r\n        const state = get();\r\n        let code = state.guestAccessCodes.find((c) => c.id === id);\r\n\r\n        // If code not found in local storage but fullCode provided (self-contained token)\r\n        // Add it to local storage for tracking\r\n        if (!code && fullCode) {\r\n          console.log('Code not in local storage, adding from self-contained token');\r\n          code = { ...fullCode, currentUses: 0, status: 'active' };\r\n\r\n          // Add to state\r\n          set((state) => ({\r\n            guestAccessCodes: [code!, ...state.guestAccessCodes],\r\n          }));\r\n        }\r\n\r\n        console.log('Found code:', code ? {\r\n          id: code.id,\r\n          status: code.status,\r\n          currentUses: code.currentUses,\r\n          maxUses: code.maxUses,\r\n          accessType: code.accessType\r\n        } : 'NOT FOUND');\r\n\r\n        if (!code || code.status !== 'active') {\r\n          console.log('Code not active or not found, returning false');\r\n          return false;\r\n        }\r\n\r\n        const now = new Date();\r\n        if (now > new Date(code.validUntil)) {\r\n          console.log('Code has expired');\r\n          // Code has expired\r\n          set((state) => ({\r\n            guestAccessCodes: state.guestAccessCodes.map((c) =>\r\n              c.id === id ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() } : c\r\n            ),\r\n          }));\r\n          return false;\r\n        }\r\n\r\n        const newUses = code.currentUses + 1;\r\n        const newStatus = newUses >= code.maxUses ? 'used' : 'active';\r\n\r\n        console.log('Updating code:');\r\n        console.log('  Old uses:', code.currentUses);\r\n        console.log('  New uses:', newUses);\r\n        console.log('  Max uses:', code.maxUses);\r\n        console.log('  New status:', newStatus);\r\n\r\n        set((state) => ({\r\n          guestAccessCodes: state.guestAccessCodes.map((c) =>\r\n            c.id === id\r\n              ? {\r\n                  ...c,\r\n                  currentUses: newUses,\r\n                  status: newStatus as 'active' | 'used',\r\n                  lastUsedAt: now.toISOString(),\r\n                  updatedAt: now.toISOString(),\r\n                }\r\n              : c\r\n          ),\r\n        }));\r\n\r\n        console.log('Code used successfully');\r\n        return true;\r\n      },\r\n\r\n      validateGuestAccessCode: (qrToken) => {\r\n        console.log('=== VALIDATING QR CODE ===');\r\n        console.log('Input token:', qrToken);\r\n\r\n        const now = new Date();\r\n\r\n        // Check if this is a self-contained token (starts with GAPASS:)\r\n        if (qrToken.startsWith('GAPASS:')) {\r\n          console.log('Detected self-contained GAPASS token');\r\n          try {\r\n            const base64Data = qrToken.substring(7); // Remove 'GAPASS:' prefix\r\n            // Decode base64 and then use TextDecoder to handle UTF-8 (Cyrillic, etc.)\r\n            const decoded = atob(base64Data);\r\n            // Convert string to Uint8Array\r\n            const bytes = new Uint8Array(decoded.length);\r\n            for (let i = 0; i < decoded.length; i++) {\r\n              bytes[i] = decoded.charCodeAt(i);\r\n            }\r\n            // Decode UTF-8 bytes to string\r\n            const decoder = new TextDecoder('utf-8');\r\n            const utf8Decoded = decoder.decode(bytes);\r\n            const tokenData = JSON.parse(utf8Decoded);\r\n            console.log('Decoded token data:', tokenData);\r\n\r\n            // Create a GuestAccessCode object from the token data\r\n            const code: GuestAccessCode = {\r\n              id: tokenData.i,\r\n              residentId: 'from-token',\r\n              residentName: tokenData.rn,\r\n              residentPhone: tokenData.rp,\r\n              residentApartment: tokenData.ra,\r\n              residentAddress: tokenData.rd,\r\n              visitorType: tokenData.vt as VisitorType,\r\n              visitorName: tokenData.vn || undefined,\r\n              visitorPhone: tokenData.vp || undefined,\r\n              visitorVehiclePlate: tokenData.vv || undefined,\r\n              accessType: tokenData.at as AccessType,\r\n              validFrom: new Date(tokenData.vf).toISOString(),\r\n              validUntil: new Date(tokenData.vu).toISOString(),\r\n              maxUses: tokenData.mx,\r\n              currentUses: 0, // We track usage locally for self-contained tokens\r\n              qrToken: qrToken,\r\n              status: 'active',\r\n              createdAt: new Date(tokenData.vf).toISOString(),\r\n            };\r\n\r\n            // Check if expired\r\n            if (now.getTime() > tokenData.vu) {\r\n              console.log('Self-contained code EXPIRED:', now.getTime(), '>', tokenData.vu);\r\n              return { valid: false, code, error: 'expired' };\r\n            }\r\n\r\n            // Check if not yet valid\r\n            if (now.getTime() < tokenData.vf) {\r\n              console.log('Self-contained code NOT YET VALID:', now.getTime(), '<', tokenData.vf);\r\n              return { valid: false, code, error: 'not_yet_valid' };\r\n            }\r\n\r\n            // Check if this code was already used (stored in local tracking)\r\n            const state = get();\r\n            const usedCodes = state.guestAccessCodes.filter(c => c.id === tokenData.i);\r\n            const localCode = usedCodes.length > 0 ? usedCodes[0] : null;\r\n\r\n            if (localCode) {\r\n              console.log('Found local tracking for this code:', {\r\n                id: localCode.id,\r\n                status: localCode.status,\r\n                currentUses: localCode.currentUses,\r\n                maxUses: localCode.maxUses\r\n              });\r\n\r\n              // Use local tracking for status\r\n              if (localCode.status === 'revoked') {\r\n                console.log('Code REVOKED (local)');\r\n                return { valid: false, code: { ...code, ...localCode }, error: 'revoked' };\r\n              }\r\n\r\n              if (localCode.status === 'used' || localCode.currentUses >= tokenData.mx) {\r\n                console.log('Code USED (local)');\r\n                return { valid: false, code: { ...code, ...localCode }, error: 'already_used' };\r\n              }\r\n\r\n              // Update code with local data\r\n              code.currentUses = localCode.currentUses;\r\n              code.status = localCode.status;\r\n            }\r\n\r\n            console.log('Self-contained code is VALID!');\r\n            return { valid: true, code };\r\n          } catch (err) {\r\n            console.error('Failed to decode GAPASS token:', err);\r\n            return { valid: false, error: 'invalid' };\r\n          }\r\n        }\r\n\r\n        // Legacy: check local storage for old-style tokens (GA-xxx-xxx)\r\n        const state = get();\r\n        console.log('Checking legacy token in local storage');\r\n        console.log('All codes:', state.guestAccessCodes.map(c => ({\r\n          id: c.id,\r\n          qrToken: c.qrToken.substring(0, 30) + '...',\r\n          status: c.status,\r\n          currentUses: c.currentUses,\r\n          maxUses: c.maxUses,\r\n          accessType: c.accessType\r\n        })));\r\n\r\n        const code = state.guestAccessCodes.find((c) => c.qrToken === qrToken);\r\n\r\n        if (!code) {\r\n          console.log('Code NOT FOUND for token:', qrToken);\r\n          return { valid: false, error: 'invalid' };\r\n        }\r\n\r\n        console.log('Found code:', {\r\n          id: code.id,\r\n          status: code.status,\r\n          currentUses: code.currentUses,\r\n          maxUses: code.maxUses,\r\n          accessType: code.accessType,\r\n          validFrom: code.validFrom,\r\n          validUntil: code.validUntil\r\n        });\r\n\r\n        // Check if expired\r\n        if (now > new Date(code.validUntil)) {\r\n          console.log('Code EXPIRED:', now, '>', new Date(code.validUntil));\r\n          // Update status if needed\r\n          if (code.status === 'active') {\r\n            set((state) => ({\r\n              guestAccessCodes: state.guestAccessCodes.map((c) =>\r\n                c.id === code.id ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() } : c\r\n              ),\r\n            }));\r\n          }\r\n          return { valid: false, code, error: 'expired' };\r\n        }\r\n\r\n        // Check if not yet valid\r\n        if (now < new Date(code.validFrom)) {\r\n          console.log('Code NOT YET VALID:', now, '<', new Date(code.validFrom));\r\n          return { valid: false, code, error: 'not_yet_valid' };\r\n        }\r\n\r\n        // Check status\r\n        if (code.status === 'revoked') {\r\n          console.log('Code REVOKED');\r\n          return { valid: false, code, error: 'revoked' };\r\n        }\r\n\r\n        if (code.status === 'used') {\r\n          console.log('Code status is USED');\r\n          return { valid: false, code, error: 'already_used' };\r\n        }\r\n\r\n        if (code.status === 'expired') {\r\n          console.log('Code status is EXPIRED');\r\n          return { valid: false, code, error: 'expired' };\r\n        }\r\n\r\n        // Check max uses\r\n        if (code.currentUses >= code.maxUses) {\r\n          console.log('Code MAX USES REACHED:', code.currentUses, '>=', code.maxUses);\r\n          return { valid: false, code, error: 'max_uses_reached' };\r\n        }\r\n\r\n        console.log('Code is VALID!');\r\n        return { valid: true, code };\r\n      },\r\n\r\n      getGuestAccessCodesByResident: (residentId) => {\r\n        // Update expired codes first\r\n        const now = new Date();\r\n        const state = get();\r\n        const needsUpdate = state.guestAccessCodes.some(\r\n          (c) => c.residentId === residentId && c.status === 'active' && now > new Date(c.validUntil)\r\n        );\r\n\r\n        if (needsUpdate) {\r\n          set((state) => ({\r\n            guestAccessCodes: state.guestAccessCodes.map((c) =>\r\n              c.residentId === residentId && c.status === 'active' && now > new Date(c.validUntil)\r\n                ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() }\r\n                : c\r\n            ),\r\n          }));\r\n        }\r\n\r\n        return get().guestAccessCodes.filter((c) => c.residentId === residentId);\r\n      },\r\n\r\n      getAllGuestAccessCodes: () => {\r\n        // Update expired codes\r\n        const now = new Date();\r\n        const state = get();\r\n        const needsUpdate = state.guestAccessCodes.some(\r\n          (c) => c.status === 'active' && now > new Date(c.validUntil)\r\n        );\r\n\r\n        if (needsUpdate) {\r\n          set((state) => ({\r\n            guestAccessCodes: state.guestAccessCodes.map((c) =>\r\n              c.status === 'active' && now > new Date(c.validUntil)\r\n                ? { ...c, status: 'expired' as const, updatedAt: now.toISOString() }\r\n                : c\r\n            ),\r\n          }));\r\n        }\r\n\r\n        return get().guestAccessCodes;\r\n      },\r\n\r\n      addGuestAccessLog: (logData) => {\r\n        const newLog: GuestAccessLog = {\r\n          ...logData,\r\n          id: generateId(),\r\n          timestamp: new Date().toISOString(),\r\n        };\r\n        set((state) => ({\r\n          guestAccessLogs: [newLog, ...state.guestAccessLogs].slice(0, 500), // Keep last 500 logs\r\n        }));\r\n      },\r\n\r\n      getGuestAccessLogs: (accessCodeId) => {\r\n        const logs = get().guestAccessLogs;\r\n        if (accessCodeId) {\r\n          return logs.filter((l) => l.accessCodeId === accessCodeId);\r\n        }\r\n        return logs;\r\n      },\r\n\r\n      getGuestAccessStats: () => {\r\n        const state = get();\r\n        const now = new Date();\r\n        const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n\r\n        // Update expired codes first\r\n        const codes = state.guestAccessCodes.map((c) =>\r\n          c.status === 'active' && now > new Date(c.validUntil)\r\n            ? { ...c, status: 'expired' as const }\r\n            : c\r\n        );\r\n\r\n        const activeCodes = codes.filter((c) => c.status === 'active');\r\n        const usedToday = state.guestAccessLogs.filter(\r\n          (l) => new Date(l.timestamp) >= todayStart && l.action === 'entry_allowed'\r\n        ).length;\r\n        const createdToday = codes.filter(\r\n          (c) => new Date(c.createdAt) >= todayStart\r\n        ).length;\r\n\r\n        const byVisitorType = {\r\n          courier: activeCodes.filter((c) => c.visitorType === 'courier').length,\r\n          guest: activeCodes.filter((c) => c.visitorType === 'guest').length,\r\n          taxi: activeCodes.filter((c) => c.visitorType === 'taxi').length,\r\n          other: activeCodes.filter((c) => c.visitorType === 'other').length,\r\n        };\r\n\r\n        const recentScans = state.guestAccessLogs.slice(0, 10);\r\n\r\n        return {\r\n          totalActive: activeCodes.length,\r\n          totalUsedToday: usedToday,\r\n          totalCreatedToday: createdToday,\r\n          byVisitorType,\r\n          recentScans,\r\n        };\r\n      },\r\n\r\n      // Vehicle actions (API-backed with all fields) - OPTIMISTIC UPDATES\r\n      addVehicle: async (vehicleData) => {\r\n        // Generate temporary ID for optimistic update\r\n        const tempId = `temp-${generateId()}`;\r\n        const now = new Date().toISOString();\r\n\r\n        // Create optimistic vehicle immediately\r\n        const optimisticVehicle: Vehicle = {\r\n          id: tempId,\r\n          ownerId: vehicleData.ownerId,\r\n          ownerName: vehicleData.ownerName,\r\n          ownerPhone: vehicleData.ownerPhone,\r\n          apartment: vehicleData.apartment,\r\n          address: vehicleData.address,\r\n          plateNumber: vehicleData.plateNumber,\r\n          brand: vehicleData.brand || '',\r\n          model: vehicleData.model || '',\r\n          color: vehicleData.color || '',\r\n          year: vehicleData.year,\r\n          type: vehicleData.type || 'car',\r\n          ownerType: vehicleData.ownerType || 'individual',\r\n          companyName: vehicleData.companyName,\r\n          parkingSpot: vehicleData.parkingSpot,\r\n          notes: vehicleData.notes,\r\n          createdAt: now,\r\n        };\r\n\r\n        // Immediately add to UI (optimistic)\r\n        set((state) => ({ vehicles: [...state.vehicles, optimisticVehicle] }));\r\n\r\n        try {\r\n          // Call API in background\r\n          const response = await vehiclesApi.create({\r\n            plate_number: vehicleData.plateNumber,\r\n            brand: vehicleData.brand,\r\n            model: vehicleData.model,\r\n            color: vehicleData.color,\r\n            year: vehicleData.year,\r\n            vehicle_type: vehicleData.type,\r\n            owner_type: vehicleData.ownerType,\r\n            company_name: vehicleData.companyName,\r\n            parking_spot: vehicleData.parkingSpot,\r\n            notes: vehicleData.notes,\r\n            is_primary: false,\r\n          });\r\n\r\n          // Replace temp with real data from server\r\n          const v = response.vehicle;\r\n          const realVehicle: Vehicle = {\r\n            id: v.id,\r\n            ownerId: v.user_id,\r\n            ownerName: v.owner_name || vehicleData.ownerName,\r\n            ownerPhone: v.owner_phone || vehicleData.ownerPhone,\r\n            apartment: v.apartment || vehicleData.apartment,\r\n            address: v.address || vehicleData.address,\r\n            plateNumber: v.plate_number,\r\n            brand: v.brand || '',\r\n            model: v.model || '',\r\n            color: v.color || '',\r\n            year: v.year || undefined,\r\n            type: (v.vehicle_type || 'car') as Vehicle['type'],\r\n            ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\r\n            companyName: v.company_name || undefined,\r\n            parkingSpot: v.parking_spot || undefined,\r\n            notes: v.notes || undefined,\r\n            createdAt: v.created_at || now,\r\n            updatedAt: v.updated_at || undefined,\r\n          };\r\n\r\n          // Replace optimistic with real\r\n          set((state) => ({\r\n            vehicles: state.vehicles.map((veh) =>\r\n              veh.id === tempId ? realVehicle : veh\r\n            ),\r\n          }));\r\n\r\n          return realVehicle;\r\n        } catch (error) {\r\n          console.error('Failed to create vehicle:', error);\r\n          // Rollback on error\r\n          set((state) => ({\r\n            vehicles: state.vehicles.filter((v) => v.id !== tempId),\r\n          }));\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateVehicle: async (id, data) => {\r\n        // Save original for rollback\r\n        const originalVehicle = get().vehicles.find((v) => v.id === id);\r\n        if (!originalVehicle) return;\r\n\r\n        // Optimistic update immediately\r\n        set((state) => ({\r\n          vehicles: state.vehicles.map((v) =>\r\n            v.id === id ? { ...v, ...data, updatedAt: new Date().toISOString() } : v\r\n          ),\r\n        }));\r\n\r\n        try {\r\n          // Call API in background\r\n          await vehiclesApi.update(id, {\r\n            plate_number: data.plateNumber,\r\n            brand: data.brand,\r\n            model: data.model,\r\n            color: data.color,\r\n            year: data.year,\r\n            vehicle_type: data.type,\r\n            owner_type: data.ownerType,\r\n            company_name: data.companyName,\r\n            parking_spot: data.parkingSpot,\r\n            notes: data.notes,\r\n          });\r\n        } catch (error) {\r\n          console.error('Failed to update vehicle:', error);\r\n          // Rollback on error\r\n          set((state) => ({\r\n            vehicles: state.vehicles.map((v) =>\r\n              v.id === id ? originalVehicle : v\r\n            ),\r\n          }));\r\n        }\r\n      },\r\n\r\n      deleteVehicle: async (id) => {\r\n        // Save for rollback\r\n        const deletedVehicle = get().vehicles.find((v) => v.id === id);\r\n\r\n        // Optimistic delete immediately\r\n        set((state) => ({\r\n          vehicles: state.vehicles.filter((v) => v.id !== id),\r\n        }));\r\n\r\n        try {\r\n          // Call API in background\r\n          await vehiclesApi.delete(id);\r\n        } catch (error) {\r\n          console.error('Failed to delete vehicle:', error);\r\n          // Rollback on error - restore deleted vehicle\r\n          if (deletedVehicle) {\r\n            set((state) => ({\r\n              vehicles: [...state.vehicles, deletedVehicle],\r\n            }));\r\n          }\r\n        }\r\n      },\r\n\r\n      getVehiclesByOwner: (ownerId) => {\r\n        return get().vehicles.filter((v) => v.ownerId === ownerId);\r\n      },\r\n\r\n      searchVehicleByPlate: async (plateNumber) => {\r\n        try {\r\n          // Call API to search vehicles (returns all fields + owner info)\r\n          const response = await vehiclesApi.search(plateNumber);\r\n          if (response.vehicles && response.vehicles.length > 0) {\r\n            const v = response.vehicles[0];\r\n            return {\r\n              id: v.id,\r\n              ownerId: v.user_id,\r\n              ownerName: v.owner_name || '',\r\n              ownerPhone: v.owner_phone || '',\r\n              apartment: v.apartment || '',\r\n              address: v.address || '',\r\n              plateNumber: v.plate_number,\r\n              brand: v.brand || '',\r\n              model: v.model || '',\r\n              color: v.color || '',\r\n              year: v.year || undefined,\r\n              type: (v.vehicle_type || 'car') as Vehicle['type'],\r\n              ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\r\n              companyName: v.company_name || undefined,\r\n              parkingSpot: v.parking_spot || undefined,\r\n              notes: v.notes || undefined,\r\n              createdAt: v.created_at,\r\n              updatedAt: v.updated_at || undefined,\r\n            } as Vehicle;\r\n          }\r\n          return undefined;\r\n        } catch (error) {\r\n          console.error('Failed to search vehicle:', error);\r\n          // Fallback to local search\r\n          const normalized = plateNumber.toUpperCase().replace(/\\s+/g, '');\r\n          return get().vehicles.find((v) =>\r\n            v.plateNumber.toUpperCase().replace(/\\s+/g, '') === normalized\r\n          );\r\n        }\r\n      },\r\n\r\n      searchVehiclesByPlate: async (plateNumber) => {\r\n        try {\r\n          const response = await vehiclesApi.search(plateNumber);\r\n          if (response.vehicles && response.vehicles.length > 0) {\r\n            return response.vehicles.map((v: any) => ({\r\n              id: v.id,\r\n              ownerId: v.user_id,\r\n              ownerName: v.owner_name || '',\r\n              ownerPhone: v.owner_phone || '',\r\n              apartment: v.apartment || '',\r\n              address: v.address || '',\r\n              plateNumber: v.plate_number,\r\n              brand: v.brand || '',\r\n              model: v.model || '',\r\n              color: v.color || '',\r\n              year: v.year || undefined,\r\n              type: (v.vehicle_type || 'car') as Vehicle['type'],\r\n              ownerType: (v.owner_type || 'individual') as Vehicle['ownerType'],\r\n              companyName: v.company_name || undefined,\r\n              parkingSpot: v.parking_spot || undefined,\r\n              notes: v.notes || undefined,\r\n              createdAt: v.created_at,\r\n              updatedAt: v.updated_at || undefined,\r\n            } as Vehicle));\r\n          }\r\n          return [];\r\n        } catch (error) {\r\n          console.error('Failed to search vehicles:', error);\r\n          return [];\r\n        }\r\n      },\r\n\r\n      // Announcement actions\r\n      addAnnouncement: async (announcementData) => {\r\n        try {\r\n          const { announcementsApi } = await import('../services/api');\r\n\r\n          // Build target for API\r\n          const target = announcementData.target;\r\n          const apiData = {\r\n            title: announcementData.title,\r\n            content: announcementData.content,\r\n            type: announcementData.type as 'residents' | 'employees' | 'all',\r\n            priority: announcementData.priority,\r\n            expires_at: announcementData.expiresAt,\r\n            target_type: target?.type,\r\n            target_branch: target?.branchId,\r\n            target_building_id: target?.buildingId,\r\n            target_entrance: target?.entrance,\r\n            target_floor: target?.floor,\r\n            target_logins: target?.customLogins?.join(','),\r\n            attachments: announcementData.attachments,\r\n          };\r\n\r\n          const result = await announcementsApi.create(apiData);\r\n\r\n          // Refetch announcements from server to avoid duplicates\r\n          await get().fetchAnnouncements();\r\n\r\n          // Return the created announcement info\r\n          const newAnnouncement: Announcement = {\r\n            ...announcementData,\r\n            id: (result as any).id || generateId(),\r\n            createdAt: new Date().toISOString(),\r\n            isActive: true,\r\n            viewedBy: [],\r\n          };\r\n\r\n          console.log('[DataStore] Announcement created via API:', newAnnouncement.id);\r\n          return newAnnouncement;\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to create announcement via API:', error);\r\n          // Fallback to local-only (for demo mode)\r\n          const newAnnouncement: Announcement = {\r\n            ...announcementData,\r\n            id: generateId(),\r\n            createdAt: new Date().toISOString(),\r\n            isActive: true,\r\n            viewedBy: [],\r\n          };\r\n          set((state) => ({ announcements: [newAnnouncement, ...state.announcements] }));\r\n          return newAnnouncement;\r\n        }\r\n      },\r\n\r\n      updateAnnouncement: async (id, data) => {\r\n        // Update local state immediately\r\n        set((state) => ({\r\n          announcements: state.announcements.map((a) =>\r\n            a.id === id ? { ...a, ...data } : a\r\n          ),\r\n        }));\r\n\r\n        // Sync with API\r\n        try {\r\n          const { announcementsApi } = await import('../services/api');\r\n          await announcementsApi.update(id, {\r\n            title: data.title,\r\n            content: data.content,\r\n            type: data.type,\r\n            priority: data.priority,\r\n            target_type: data.target?.type,\r\n            target_building_id: data.target?.buildingId,\r\n            target_entrance: data.target?.entrance,\r\n            target_floor: data.target?.floor,\r\n            target_logins: data.target?.customLogins?.join(','),\r\n            expires_at: data.expiresAt,\r\n          });\r\n          console.log('[DataStore] Announcement updated via API:', id);\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to update announcement via API:', error);\r\n        }\r\n      },\r\n\r\n      deleteAnnouncement: async (id) => {\r\n        try {\r\n          const { announcementsApi } = await import('../services/api');\r\n          await announcementsApi.delete(id);\r\n          console.log('[DataStore] Announcement deleted via API:', id);\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to delete announcement via API:', error);\r\n        }\r\n        set((state) => ({\r\n          announcements: state.announcements.filter((a) => a.id !== id),\r\n        }));\r\n      },\r\n\r\n      markAnnouncementAsViewed: async (announcementId, userId) => {\r\n        // Save to localStorage for persistence across page reloads (backup)\r\n        const readAnnouncementsKey = `read_announcements_${userId}`;\r\n        const readAnnouncements = JSON.parse(localStorage.getItem(readAnnouncementsKey) || '[]');\r\n        if (!readAnnouncements.includes(announcementId)) {\r\n          readAnnouncements.push(announcementId);\r\n          localStorage.setItem(readAnnouncementsKey, JSON.stringify(readAnnouncements));\r\n        }\r\n\r\n        // Update local state immediately\r\n        set((state) => ({\r\n          announcements: state.announcements.map((a) =>\r\n            a.id === announcementId && !a.viewedBy.includes(userId)\r\n              ? { ...a, viewedBy: [...a.viewedBy, userId] }\r\n              : a\r\n          ),\r\n        }));\r\n\r\n        // Sync with API in background\r\n        try {\r\n          const { announcementsApi } = await import('../services/api');\r\n          await announcementsApi.markAsViewed(announcementId);\r\n          console.log('[DataStore] Announcement view synced to API:', announcementId);\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to sync announcement view:', error);\r\n        }\r\n      },\r\n\r\n      getAnnouncementsForResidents: (userLogin: string, buildingId?: string, entrance?: string, floor?: string, branch?: string) => {\r\n        const now = new Date();\r\n        return get().announcements.filter((a) => {\r\n          // Basic filters - show 'residents' and 'all' types\r\n          if ((a.type !== 'residents' && a.type !== 'all') || !a.isActive) return false;\r\n          if (a.expiresAt && new Date(a.expiresAt) <= now) return false;\r\n\r\n          // If no targeting, show to all\r\n          if (!a.target || a.target.type === 'all') return true;\r\n\r\n          // Check targeting\r\n          switch (a.target.type) {\r\n            case 'building':\r\n              // Show if user's building matches\r\n              return buildingId && a.target.buildingId === buildingId;\r\n\r\n            case 'entrance':\r\n              // Show if user's building AND entrance match\r\n              return buildingId === a.target.buildingId && entrance === a.target.entrance;\r\n\r\n            case 'floor':\r\n              // Show if user's building, entrance AND floor match\r\n              return buildingId === a.target.buildingId &&\r\n                     entrance === a.target.entrance &&\r\n                     floor === a.target.floor;\r\n\r\n            case 'custom':\r\n              // Check if user's login is in the custom list\r\n              return a.target.customLogins?.includes(userLogin) || false;\r\n\r\n            case 'branch':\r\n              // Branch filtering is done on the server side\r\n              // If we got this announcement from API, it means user is in the target branch\r\n              // Only filter locally if branch is provided (for offline mode)\r\n              return !branch || a.target.branchId === branch;\r\n\r\n            default:\r\n              return true;\r\n          }\r\n        });\r\n      },\r\n\r\n      getAnnouncementsForEmployees: () => {\r\n        const now = new Date();\r\n        return get().announcements.filter((a) =>\r\n          (a.type === 'employees' || a.type === 'all') &&\r\n          a.isActive &&\r\n          (!a.expiresAt || new Date(a.expiresAt) > now)\r\n        );\r\n      },\r\n\r\n      getAnnouncementsByAuthor: (authorId) => {\r\n        return get().announcements.filter((a) => a.authorId === authorId);\r\n      },\r\n\r\n      fetchAnnouncements: async () => {\r\n        try {\r\n          const { announcementsApi } = await import('../services/api');\r\n          const result = await announcementsApi.getAll();\r\n          const authState = JSON.parse(localStorage.getItem('uk-auth-storage') || '{}');\r\n          const userId = authState?.state?.user?.id;\r\n\r\n          const announcements: Announcement[] = (result.announcements || []).map((a: any) => {\r\n            // Use API view_count and viewed_by_user if available\r\n            const viewedByUser = a.viewed_by_user === true || a.viewed_by_user === 1;\r\n\r\n            // Build viewedBy array - include current user if they viewed\r\n            const viewedBy: string[] = [];\r\n            if (viewedByUser && userId) {\r\n              viewedBy.push(userId);\r\n            }\r\n\r\n            // Also check localStorage as fallback\r\n            if (userId) {\r\n              const readAnnouncementsKey = `read_announcements_${userId}`;\r\n              const readAnnouncements: string[] = JSON.parse(localStorage.getItem(readAnnouncementsKey) || '[]');\r\n              if (readAnnouncements.includes(a.id) && !viewedBy.includes(userId)) {\r\n                viewedBy.push(userId);\r\n              }\r\n            }\r\n\r\n            // Parse attachments from JSON string\r\n            let attachments = undefined;\r\n            if (a.attachments) {\r\n              try {\r\n                attachments = typeof a.attachments === 'string'\r\n                  ? JSON.parse(a.attachments)\r\n                  : a.attachments;\r\n              } catch {\r\n                attachments = undefined;\r\n              }\r\n            }\r\n\r\n            // Map 'staff' from API back to 'employees' for UI compatibility\r\n            const typeForUI = a.type === 'staff' ? 'employees' : a.type;\r\n            return {\r\n              id: a.id,\r\n              title: a.title,\r\n              content: a.content,\r\n              type: typeForUI as 'residents' | 'employees' | 'all',\r\n              priority: a.priority || 'normal',\r\n              authorId: a.created_by || '',\r\n              authorName: a.author_name || '',\r\n              authorRole: 'manager' as const,\r\n              createdAt: a.created_at,\r\n              expiresAt: a.expires_at,\r\n              isActive: a.is_active === 1,\r\n              viewedBy,\r\n              viewCount: a.view_count || 0, // Total view count from API\r\n              attachments, // File attachments\r\n              target: a.target_type ? {\r\n                type: a.target_type,\r\n                branchId: a.target_branch,\r\n                buildingId: a.target_building_id,\r\n                entrance: a.target_entrance,\r\n                floor: a.target_floor,\r\n                customLogins: a.target_logins?.split(',').filter(Boolean),\r\n              } : undefined,\r\n            };\r\n          });\r\n\r\n          set({ announcements });\r\n          console.log('[DataStore] Fetched', announcements.length, 'announcements from API');\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to fetch announcements:', error);\r\n        }\r\n      },\r\n\r\n      // Rental apartment actions - now using real API\r\n      fetchRentals: async () => {\r\n        try {\r\n          const [apartmentsRes, recordsRes] = await Promise.all([\r\n            rentalsApi.getApartments(),\r\n            rentalsApi.getRecords(),\r\n          ]);\r\n          set({\r\n            rentalApartments: apartmentsRes.apartments || [],\r\n            rentalRecords: recordsRes.records || [],\r\n          });\r\n          console.log('[DataStore] Fetched', apartmentsRes.apartments?.length || 0, 'rental apartments from API');\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to fetch rentals:', error);\r\n        }\r\n      },\r\n\r\n      // For tenants/commercial_owners to fetch their own apartments\r\n      fetchMyRentals: async () => {\r\n        try {\r\n          const response = await rentalsApi.getMyApartments();\r\n          set({\r\n            rentalApartments: response.apartments || [],\r\n            rentalRecords: response.records || [],\r\n          });\r\n          console.log('[DataStore] Fetched', response.apartments?.length || 0, 'my rental apartments from API');\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to fetch my rentals:', error);\r\n        }\r\n      },\r\n\r\n      addRentalApartment: async (apartmentData) => {\r\n        try {\r\n          const response = await rentalsApi.createApartment({\r\n            name: apartmentData.name,\r\n            address: apartmentData.address,\r\n            apartment: apartmentData.apartment,\r\n            ownerName: apartmentData.ownerName,\r\n            ownerPhone: apartmentData.ownerPhone,\r\n            ownerLogin: apartmentData.ownerLogin,\r\n            ownerPassword: apartmentData.password,\r\n            ownerType: apartmentData.ownerType || 'tenant',\r\n          });\r\n\r\n          console.log('[DataStore] API response:', response);\r\n          if (response.apartment) {\r\n            set((state) => ({ rentalApartments: [...state.rentalApartments, response.apartment] }));\r\n            return response.apartment;\r\n          }\r\n          console.error('[DataStore] No apartment in response:', response);\r\n          return null;\r\n        } catch (error: any) {\r\n          console.error('[DataStore] Failed to create rental apartment:', error);\r\n          console.error('[DataStore] Error details:', error.message, error.stack);\r\n          throw error; // Re-throw to allow UI to show the error\r\n        }\r\n      },\r\n\r\n      updateRentalApartment: async (id, data) => {\r\n        try {\r\n          await rentalsApi.updateApartment(id, data);\r\n          set((state) => ({\r\n            rentalApartments: state.rentalApartments.map((a) =>\r\n              a.id === id ? { ...a, ...data } : a\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to update rental apartment:', error);\r\n        }\r\n      },\r\n\r\n      deleteRentalApartment: async (id) => {\r\n        try {\r\n          await rentalsApi.deleteApartment(id);\r\n          set((state) => ({\r\n            rentalApartments: state.rentalApartments.filter((a) => a.id !== id),\r\n            rentalRecords: state.rentalRecords.filter((r) => r.apartmentId !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to delete rental apartment:', error);\r\n        }\r\n      },\r\n\r\n      getRentalApartmentsByOwner: (ownerId) => {\r\n        return get().rentalApartments.filter((a) => a.ownerId === ownerId);\r\n      },\r\n\r\n      addRentalRecord: async (recordData) => {\r\n        try {\r\n          const response = await rentalsApi.createRecord({\r\n            apartmentId: recordData.apartmentId,\r\n            guestNames: recordData.guestNames,\r\n            passportInfo: recordData.passportInfo,\r\n            checkInDate: recordData.checkInDate,\r\n            checkOutDate: recordData.checkOutDate,\r\n            amount: recordData.amount,\r\n            currency: recordData.currency,\r\n            notes: recordData.notes,\r\n          });\r\n\r\n          if (response.record) {\r\n            set((state) => ({ rentalRecords: [response.record, ...state.rentalRecords] }));\r\n            return response.record;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to create rental record:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      updateRentalRecord: async (id, data) => {\r\n        try {\r\n          await rentalsApi.updateRecord(id, data);\r\n          set((state) => ({\r\n            rentalRecords: state.rentalRecords.map((r) =>\r\n              r.id === id ? { ...r, ...data } : r\r\n            ),\r\n          }));\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to update rental record:', error);\r\n        }\r\n      },\r\n\r\n      deleteRentalRecord: async (id) => {\r\n        try {\r\n          await rentalsApi.deleteRecord(id);\r\n          set((state) => ({\r\n            rentalRecords: state.rentalRecords.filter((r) => r.id !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('[DataStore] Failed to delete rental record:', error);\r\n        }\r\n      },\r\n\r\n      getRentalRecordsByApartment: (apartmentId) => {\r\n        return get().rentalRecords.filter((r) => r.apartmentId === apartmentId);\r\n      },\r\n\r\n      addExecutor: async (executorData) => {\r\n        try {\r\n          // Call real API to register user\r\n          const response = await authApi.register({\r\n            login: executorData.login,\r\n            password: executorData.password,\r\n            name: executorData.name,\r\n            role: executorData.role || 'executor',\r\n            phone: executorData.phone,\r\n            specialization: executorData.specialization,\r\n          });\r\n\r\n          if (response.user) {\r\n            const newExecutor: Executor = {\r\n              id: response.user.id,\r\n              name: response.user.name,\r\n              phone: response.user.phone || executorData.phone,\r\n              login: response.user.login,\r\n              specialization: response.user.specialization || executorData.specialization,\r\n              createdAt: new Date().toISOString(),\r\n              rating: 5.0,\r\n              completedCount: 0,\r\n              activeRequests: 0,\r\n              totalEarnings: 0,\r\n              avgCompletionTime: 0,\r\n              status: 'offline',\r\n            };\r\n\r\n            // Add locally first for immediate UI update\r\n            set((state) => ({ executors: [...state.executors, newExecutor] }));\r\n\r\n            // Then refetch from server to ensure sync\r\n            get().fetchExecutors();\r\n\r\n            return newExecutor;\r\n          }\r\n          return null;\r\n        } catch (error: any) {\r\n          console.error('Failed to add executor:', error);\r\n          throw error; // Re-throw so UI can show error message\r\n        }\r\n      },\r\n\r\n      updateExecutor: (id, data) => {\r\n        set((state) => ({\r\n          executors: state.executors.map((e) =>\r\n            e.id === id ? { ...e, ...data } : e\r\n          ),\r\n        }));\r\n      },\r\n\r\n      deleteExecutor: async (id) => {\r\n        try {\r\n          await usersApi.delete(id);\r\n          set((state) => ({\r\n            executors: state.executors.filter((e) => e.id !== id),\r\n          }));\r\n        } catch (error) {\r\n          console.error('Failed to delete executor:', error);\r\n          throw error;\r\n        }\r\n      },\r\n\r\n      getExecutorStats: (executorId) => {\r\n        const { requests } = get();\r\n        const executorRequests = requests.filter(r => r.executorId === executorId);\r\n        const completed = executorRequests.filter(r => r.status === 'completed');\r\n        const now = new Date();\r\n        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\r\n\r\n        const thisWeek = completed.filter(r => r.approvedAt && new Date(r.approvedAt) >= weekAgo).length;\r\n        const thisMonth = completed.filter(r => r.approvedAt && new Date(r.approvedAt) >= monthAgo).length;\r\n\r\n        const ratings = completed.filter(r => r.rating).map(r => r.rating!);\r\n        const avgRating = ratings.length > 0 ? ratings.reduce((a, b) => a + b, 0) / ratings.length : 5;\r\n\r\n        const times = completed.filter(r => r.workDuration).map(r => r.workDuration!);\r\n        const avgTime = times.length > 0 ? Math.round(times.reduce((a, b) => a + b, 0) / times.length / 60) : 0;\r\n\r\n        return {\r\n          totalRequests: executorRequests.length,\r\n          completedRequests: completed.length,\r\n          avgRating: Math.round(avgRating * 10) / 10,\r\n          avgTime,\r\n          thisWeek,\r\n          thisMonth,\r\n        };\r\n      },\r\n\r\n      addRequest: async (requestData) => {\r\n        // Generate temp ID and number for optimistic update\r\n        const tempId = `temp-${generateId()}`;\r\n        const tempNumber = `#${tempId.substring(5, 11).toUpperCase()}`;\r\n        const now = new Date().toISOString();\r\n\r\n        // Create optimistic request immediately\r\n        const optimisticRequest: Request = {\r\n          id: tempId,\r\n          number: tempNumber,\r\n          title: requestData.title,\r\n          description: requestData.description || '',\r\n          category: requestData.category,\r\n          status: 'new',\r\n          priority: requestData.priority || 'medium',\r\n          residentId: requestData.residentId,\r\n          residentName: requestData.residentName,\r\n          residentPhone: requestData.residentPhone,\r\n          address: requestData.address,\r\n          apartment: requestData.apartment,\r\n          accessInfo: requestData.accessInfo,\r\n          scheduledDate: requestData.scheduledDate,\r\n          scheduledTime: requestData.scheduledTime,\r\n          createdAt: now,\r\n        };\r\n\r\n        // Add to UI immediately (optimistic)\r\n        set((state) => ({ requests: [optimisticRequest, ...state.requests] }));\r\n\r\n        // Add notification for managers immediately\r\n        get().addNotification({\r\n          userId: 'manager',\r\n          type: 'request_created',\r\n          title: ' ',\r\n          message: ` ${tempNumber}: ${requestData.title}`,\r\n          requestId: tempId,\r\n        });\r\n\r\n        try {\r\n          // Call API in background\r\n          const response = await requestsApi.create({\r\n            category_id: requestData.category,\r\n            title: requestData.title,\r\n            description: requestData.description,\r\n            priority: requestData.priority,\r\n            access_info: requestData.accessInfo,\r\n            scheduled_at: requestData.scheduledDate && requestData.scheduledTime\r\n              ? `${requestData.scheduledDate}T${requestData.scheduledTime}:00`\r\n              : undefined,\r\n            // For manual creation by managers - pass the resident_id\r\n            resident_id: requestData.residentId,\r\n          });\r\n\r\n          // Replace temp with real data\r\n          const apiRequest = response.request;\r\n          const realRequest: Request = {\r\n            id: apiRequest.id,\r\n            number: apiRequest.request_number || apiRequest.number,\r\n            title: apiRequest.title,\r\n            description: apiRequest.description,\r\n            category: apiRequest.category_id,\r\n            status: apiRequest.status,\r\n            priority: apiRequest.priority || 'medium',\r\n            residentId: apiRequest.resident_id,\r\n            residentName: apiRequest.resident_name,\r\n            residentPhone: apiRequest.resident_phone,\r\n            address: apiRequest.address,\r\n            apartment: apiRequest.apartment,\r\n            createdAt: apiRequest.created_at,\r\n          };\r\n\r\n          // Replace optimistic with real\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === tempId ? realRequest : r\r\n            ),\r\n          }));\r\n\r\n          // Add activity log\r\n          get().addActivityLog({\r\n            userId: requestData.residentId,\r\n            userName: requestData.residentName,\r\n            userRole: 'resident',\r\n            action: ' ',\r\n            details: ` #${realRequest.number}: ${realRequest.title}`,\r\n            requestId: realRequest.id,\r\n          });\r\n\r\n          return realRequest;\r\n        } catch (error) {\r\n          console.error('Failed to create request:', error);\r\n          // Rollback on error\r\n          set((state) => ({\r\n            requests: state.requests.filter((r) => r.id !== tempId),\r\n          }));\r\n          return null;\r\n        }\r\n      },\r\n\r\n      assignRequest: async (requestId, executorId) => {\r\n        const state = get();\r\n        const executor = state.executors.find(e => e.id === executorId);\r\n        const request = state.requests.find(r => r.id === requestId);\r\n\r\n        if (!request) {\r\n          console.error('[assignRequest] Request not found in local state!');\r\n          return;\r\n        }\r\n\r\n        const { user } = useAuthStore.getState();\r\n        const isSelfAssign = user?.role === 'executor' && user?.id === executorId;\r\n        const executorName = executor?.name || '';\r\n        const executorPhone = executor?.phone || '';\r\n\r\n        // Save original state for rollback\r\n        const originalRequest = { ...request };\r\n        const originalExecutor = executor ? { ...executor } : null;\r\n\r\n        // OPTIMISTIC UPDATE - immediately update UI\r\n        set((state) => ({\r\n          requests: state.requests.map((r) =>\r\n            r.id === requestId\r\n              ? {\r\n                  ...r,\r\n                  status: 'assigned' as const,\r\n                  executorId,\r\n                  executorName,\r\n                  executorPhone,\r\n                  executorRating: executor?.rating || 5.0,\r\n                  assignedAt: new Date().toISOString(),\r\n                }\r\n              : r\r\n          ),\r\n          executors: state.executors.map((e) =>\r\n            e.id === executorId\r\n              ? { ...e, status: 'busy' as const, activeRequests: (e.activeRequests || 0) + 1 }\r\n              : e\r\n          ),\r\n        }));\r\n\r\n        // Send notifications immediately\r\n        if (isSelfAssign) {\r\n          get().addNotification({\r\n            userId: 'manager1',\r\n            type: 'request_assigned',\r\n            title: '  ',\r\n            message: `${executorName}   #${request.number}: ${request.title}`,\r\n            requestId,\r\n          });\r\n          get().addActivityLog({\r\n            userId: executorId,\r\n            userName: executorName,\r\n            userRole: 'executor',\r\n            action: ' ',\r\n            details: ` #${request.number}: ${request.title}`,\r\n            requestId,\r\n          });\r\n        } else {\r\n          get().addNotification({\r\n            userId: executorId,\r\n            type: 'request_assigned',\r\n            title: '  ',\r\n            message: `   #${request.number}: ${request.title}`,\r\n            requestId,\r\n          });\r\n          get().addActivityLog({\r\n            userId: user?.id || 'system',\r\n            userName: user?.name || '',\r\n            userRole: user?.role || 'manager',\r\n            action: ' ',\r\n            details: ` #${request.number}  ${executorName}`,\r\n            requestId,\r\n          });\r\n        }\r\n\r\n        try {\r\n          // Call API in background\r\n          await requestsApi.assign(requestId, executorId);\r\n        } catch (error) {\r\n          console.error('Failed to assign request:', error);\r\n          // Rollback on error\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId ? originalRequest : r\r\n            ),\r\n            executors: originalExecutor\r\n              ? state.executors.map((e) =>\r\n                  e.id === executorId ? originalExecutor : e\r\n                )\r\n              : state.executors,\r\n          }));\r\n        }\r\n      },\r\n\r\n      acceptRequest: async (requestId) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request) return;\r\n\r\n        // Save original for rollback\r\n        const originalRequest = { ...request };\r\n\r\n        // OPTIMISTIC UPDATE - immediately update UI\r\n        set((state) => ({\r\n          requests: state.requests.map((r) =>\r\n            r.id === requestId\r\n              ? { ...r, status: 'accepted' as const, acceptedAt: new Date().toISOString() }\r\n              : r\r\n          ),\r\n        }));\r\n\r\n        // Send notifications immediately\r\n        get().addNotification({\r\n          userId: request.residentId,\r\n          type: 'request_accepted',\r\n          title: ' ',\r\n          message: ` ${request.executorName}    #${request.number}`,\r\n          requestId,\r\n        });\r\n        get().addNotification({\r\n          userId: 'manager',\r\n          type: 'request_accepted',\r\n          title: '  ',\r\n          message: `${request.executorName}   #${request.number}`,\r\n          requestId,\r\n        });\r\n        get().addActivityLog({\r\n          userId: request.executorId!,\r\n          userName: request.executorName!,\r\n          userRole: 'executor',\r\n          action: ' ',\r\n          details: ` #${request.number}`,\r\n          requestId,\r\n        });\r\n\r\n        try {\r\n          // Call API in background\r\n          await requestsApi.accept(requestId);\r\n        } catch (error) {\r\n          console.error('Failed to accept request:', error);\r\n          // Rollback on error\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId ? originalRequest : r\r\n            ),\r\n          }));\r\n        }\r\n      },\r\n\r\n      startWork: async (requestId) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request) return;\r\n\r\n        // Check if executor already has a task in progress\r\n        const executorId = request.executorId;\r\n        if (executorId) {\r\n          const hasActiveWork = state.requests.some(\r\n            r => r.executorId === executorId && r.status === 'in_progress' && r.id !== requestId\r\n          );\r\n          if (hasActiveWork) {\r\n            console.error('Executor already has a task in progress. Complete it first.');\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Save original for rollback\r\n        const originalRequest = { ...request };\r\n\r\n        // OPTIMISTIC UPDATE - immediately update UI\r\n        set((state) => ({\r\n          requests: state.requests.map((r) =>\r\n            r.id === requestId\r\n              ? { ...r, status: 'in_progress' as const, startedAt: new Date().toISOString() }\r\n              : r\r\n          ),\r\n        }));\r\n\r\n        // Send notifications immediately\r\n        get().addNotification({\r\n          userId: request.residentId,\r\n          type: 'request_started',\r\n          title: ' ',\r\n          message: ` ${request.executorName}     #${request.number}`,\r\n          requestId,\r\n        });\r\n        get().addActivityLog({\r\n          userId: request.executorId!,\r\n          userName: request.executorName!,\r\n          userRole: 'executor',\r\n          action: ' ',\r\n          details: ` #${request.number}`,\r\n          requestId,\r\n        });\r\n\r\n        try {\r\n          // Call API in background\r\n          await requestsApi.start(requestId);\r\n        } catch (error) {\r\n          console.error('Failed to start work:', error);\r\n          // Rollback on error\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId ? originalRequest : r\r\n            ),\r\n          }));\r\n        }\r\n      },\r\n\r\n      pauseWork: async (requestId) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request || request.status !== 'in_progress' || request.isPaused) return;\r\n\r\n        try {\r\n          // Call API to pause work in D1 database\r\n          await requestsApi.pause(requestId);\r\n\r\n          // Update local state\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId\r\n                ? { ...r, isPaused: true, pausedAt: new Date().toISOString() }\r\n                : r\r\n            ),\r\n          }));\r\n\r\n          // Activity log\r\n          get().addActivityLog({\r\n            userId: request.executorId!,\r\n            userName: request.executorName!,\r\n            userRole: 'executor',\r\n            action: ' ',\r\n            details: ` #${request.number}`,\r\n            requestId,\r\n          });\r\n        } catch (error) {\r\n          console.error('Failed to pause work:', error);\r\n        }\r\n      },\r\n\r\n      resumeWork: async (requestId) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request || request.status !== 'in_progress' || !request.isPaused) return;\r\n\r\n        try {\r\n          // Call API to resume work in D1 database\r\n          const result = await requestsApi.resume(requestId);\r\n\r\n          // Use totalPausedTime from server response for accuracy\r\n          const totalPausedTime = result.totalPausedTime || (request.totalPausedTime || 0);\r\n\r\n          // Update local state\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId\r\n                ? { ...r, isPaused: false, pausedAt: undefined, totalPausedTime }\r\n                : r\r\n            ),\r\n          }));\r\n\r\n          // Activity log\r\n          get().addActivityLog({\r\n            userId: request.executorId!,\r\n            userName: request.executorName!,\r\n            userRole: 'executor',\r\n            action: ' ',\r\n            details: ` #${request.number}`,\r\n            requestId,\r\n          });\r\n        } catch (error) {\r\n          console.error('Failed to resume work:', error);\r\n        }\r\n      },\r\n\r\n      completeWork: async (requestId, workDuration) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request) return;\r\n\r\n        const wasRejected = !!request.rejectionReason;\r\n\r\n        try {\r\n          // Call API to complete work in D1 database\r\n          await requestsApi.complete(requestId);\r\n\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId\r\n                ? {\r\n                    ...r,\r\n                    status: 'pending_approval' as const,\r\n                    completedAt: new Date().toISOString(),\r\n                    workDuration,\r\n                    // Clear pause and rejection info when work is completed\r\n                    isPaused: undefined,\r\n                    pausedAt: undefined,\r\n                    rejectedAt: undefined,\r\n                    rejectionReason: undefined,\r\n                  }\r\n                : r\r\n            ),\r\n          }));\r\n\r\n          // Different message if this is a re-submission after rejection\r\n          const notifyMessage = wasRejected\r\n            ? `     #${request.number}. ,   .`\r\n            : `     #${request.number}. ,  .`;\r\n\r\n          get().addNotification({\r\n            userId: request.residentId,\r\n            type: 'request_completed',\r\n            title: wasRejected ? ' ' : ' ',\r\n            message: notifyMessage,\r\n            requestId,\r\n          });\r\n\r\n          // Push-   ( -  )\r\n          const { user } = useAuthStore.getState();\r\n          if (user?.id === request.residentId) {\r\n            //     -  push\r\n            pushNotifications.notifyRequestCompleted(\r\n              request.number,\r\n              request.executorName || '',\r\n              requestId\r\n            );\r\n          }\r\n\r\n          get().addNotification({\r\n            userId: 'manager',\r\n            type: 'request_completed',\r\n            title: ' ',\r\n            message: `${request.executorName}   #${request.number}.   .`,\r\n            requestId,\r\n          });\r\n\r\n          get().addActivityLog({\r\n            userId: request.executorId!,\r\n            userName: request.executorName!,\r\n            userRole: 'executor',\r\n            action: ' ',\r\n            details: ` #${request.number},  : ${Math.round(workDuration / 60)} `,\r\n            requestId,\r\n          });\r\n        } catch (error) {\r\n          console.error('Failed to complete work:', error);\r\n        }\r\n      },\r\n\r\n      approveRequest: async (requestId, rating, feedback) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request) return;\r\n\r\n        try {\r\n          // Call API to approve request in D1 database\r\n          await requestsApi.approve(requestId, rating, feedback);\r\n\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId\r\n                ? {\r\n                    ...r,\r\n                    status: 'completed' as const,\r\n                    approvedAt: new Date().toISOString(),\r\n                    rating,\r\n                    feedback,\r\n                  }\r\n                : r\r\n            ),\r\n          }));\r\n\r\n          // Update executor stats (local)\r\n          if (request.executorId) {\r\n            const executor = state.executors.find(e => e.id === request.executorId);\r\n            if (executor) {\r\n              const completedRequests = state.requests.filter(\r\n                r => r.executorId === request.executorId && r.status === 'completed'\r\n              );\r\n              const ratings = [...completedRequests.map(r => r.rating || 5), rating];\r\n              const newRating = ratings.reduce((a, b) => a + b, 0) / ratings.length;\r\n\r\n              set((state) => ({\r\n                executors: state.executors.map((e) =>\r\n                  e.id === request.executorId\r\n                    ? {\r\n                        ...e,\r\n                        completedCount: e.completedCount + 1,\r\n                        rating: Math.round(newRating * 10) / 10,\r\n                        totalEarnings: e.totalEarnings + 100000,\r\n                      }\r\n                    : e\r\n                ),\r\n              }));\r\n            }\r\n          }\r\n\r\n          get().addNotification({\r\n            userId: request.executorId!,\r\n            type: 'request_approved',\r\n            title: ' ',\r\n            message: ` #${request.number} . : ${rating}/5`,\r\n            requestId,\r\n          });\r\n\r\n          get().addActivityLog({\r\n            userId: request.residentId,\r\n            userName: request.residentName,\r\n            userRole: 'resident',\r\n            action: ' ',\r\n            details: ` #${request.number}, : ${rating}/5`,\r\n            requestId,\r\n          });\r\n        } catch (error) {\r\n          console.error('Failed to approve request:', error);\r\n        }\r\n      },\r\n\r\n      rejectRequest: async (requestId, reason) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request) return;\r\n\r\n        try {\r\n          // Call API to reject request in D1 database\r\n          await requestsApi.reject(requestId, reason);\r\n\r\n          const newRejectionCount = (request.rejectionCount || 0) + 1;\r\n\r\n          // Return to in_progress status but keep rejection info visible\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId\r\n                ? {\r\n                    ...r,\r\n                    status: 'in_progress' as const,\r\n                    completedAt: undefined,\r\n                    workDuration: undefined,\r\n                    rejectedAt: new Date().toISOString(),\r\n                    rejectionReason: reason,\r\n                    rejectionCount: newRejectionCount,\r\n                  }\r\n                : r\r\n            ),\r\n          }));\r\n\r\n          // Activity log\r\n          get().addActivityLog({\r\n            userId: request.residentId,\r\n            userName: request.residentName,\r\n            userRole: 'resident',\r\n            action: ' ',\r\n            details: ` #${request.number}, : ${reason}`,\r\n            requestId,\r\n          });\r\n        } catch (error) {\r\n          console.error('Failed to reject request:', error);\r\n        }\r\n      },\r\n\r\n      cancelRequest: async (requestId, cancelledBy, reason) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request) return;\r\n\r\n        const { user } = useAuthStore.getState();\r\n        const cancellerName = user?.name || '';\r\n\r\n        // Check if cancellation is allowed\r\n        // Residents can cancel only before work starts (new, assigned, accepted)\r\n        // Managers/Admins can cancel any request not completed\r\n        const canResidentCancel = ['new', 'assigned', 'accepted'].includes(request.status);\r\n        const canManagerCancel = request.status !== 'completed';\r\n\r\n        if (cancelledBy === 'resident' && !canResidentCancel) {\r\n          console.error('Resident cannot cancel request in this status');\r\n          return;\r\n        }\r\n\r\n        if ((cancelledBy === 'manager' || cancelledBy === 'admin') && !canManagerCancel) {\r\n          console.error('Cannot cancel completed request');\r\n          return;\r\n        }\r\n\r\n        const previousExecutorId = request.executorId;\r\n\r\n        // Call API to persist cancellation\r\n        try {\r\n          await requestsApi.cancel(requestId, reason);\r\n        } catch (error) {\r\n          console.error('Failed to cancel request on server:', error);\r\n          // Continue with local update even if API fails\r\n        }\r\n\r\n        set((state) => ({\r\n          requests: state.requests.map((r) =>\r\n            r.id === requestId\r\n              ? {\r\n                  ...r,\r\n                  status: 'cancelled' as const,\r\n                  cancelledAt: new Date().toISOString(),\r\n                  cancelledBy,\r\n                  cancellationReason: reason,\r\n                }\r\n              : r\r\n          ),\r\n        }));\r\n\r\n        // Update executor's active request count if there was one\r\n        if (previousExecutorId) {\r\n          const activeCount = state.requests.filter(\r\n            r => r.executorId === previousExecutorId && ['assigned', 'accepted', 'in_progress'].includes(r.status) && r.id !== requestId\r\n          ).length;\r\n\r\n          set((state) => ({\r\n            executors: state.executors.map((e) =>\r\n              e.id === previousExecutorId\r\n                ? { ...e, activeRequests: activeCount, status: activeCount > 0 ? 'busy' : 'available' }\r\n                : e\r\n            ),\r\n          }));\r\n        }\r\n\r\n        // Notifications based on who cancelled\r\n        const cancellerLabels: Record<CancelledBy, string> = {\r\n          resident: '',\r\n          executor: '',\r\n          manager: '',\r\n          admin: '',\r\n        };\r\n\r\n        // Notify resident (if not cancelled by resident)\r\n        if (cancelledBy !== 'resident') {\r\n          get().addNotification({\r\n            userId: request.residentId,\r\n            type: 'request_cancelled',\r\n            title: ' ',\r\n            message: ` #${request.number}  . : ${reason}`,\r\n            requestId,\r\n          });\r\n        }\r\n\r\n        // Notify executor (if assigned and not cancelled by executor)\r\n        if (previousExecutorId && cancelledBy !== 'executor') {\r\n          get().addNotification({\r\n            userId: previousExecutorId,\r\n            type: 'request_cancelled',\r\n            title: ' ',\r\n            message: ` #${request.number}   ${cancellerLabels[cancelledBy]}. : ${reason}`,\r\n            requestId,\r\n          });\r\n        }\r\n\r\n        // Notify manager (if not cancelled by manager/admin)\r\n        if (cancelledBy === 'resident' || cancelledBy === 'executor') {\r\n          get().addNotification({\r\n            userId: 'manager1',\r\n            type: 'request_cancelled',\r\n            title: ' ',\r\n            message: `${cancellerLabels[cancelledBy]}   #${request.number}. : ${reason}`,\r\n            requestId,\r\n          });\r\n        }\r\n\r\n        // Activity log\r\n        get().addActivityLog({\r\n          userId: user?.id || 'system',\r\n          userName: cancellerName,\r\n          userRole: cancelledBy,\r\n          action: ' ',\r\n          details: ` #${request.number}: ${reason}`,\r\n          requestId,\r\n        });\r\n      },\r\n\r\n      declineRequest: async (requestId, reason) => {\r\n        // Executor declines/releases an assigned request - returns it to 'new' status\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === requestId);\r\n        if (!request) return;\r\n\r\n        // Can decline if assigned, accepted, or in_progress (for illness, etc.)\r\n        if (!['assigned', 'accepted', 'in_progress'].includes(request.status)) {\r\n          console.error('Cannot decline request in this status');\r\n          return;\r\n        }\r\n\r\n        const previousExecutorId = request.executorId;\r\n        const executorName = request.executorName;\r\n\r\n        // Save original state for rollback\r\n        const originalRequest = { ...request };\r\n\r\n        // OPTIMISTIC UPDATE - immediately update UI\r\n        set((state) => ({\r\n          requests: state.requests.map((r) =>\r\n            r.id === requestId\r\n              ? {\r\n                  ...r,\r\n                  status: 'new' as const,\r\n                  executorId: undefined,\r\n                  executorName: undefined,\r\n                  executorPhone: undefined,\r\n                  executorRating: undefined,\r\n                  assignedAt: undefined,\r\n                  acceptedAt: undefined,\r\n                  startedAt: undefined,\r\n                }\r\n              : r\r\n          ),\r\n        }));\r\n\r\n        // Update executor's active request count\r\n        if (previousExecutorId) {\r\n          const activeCount = state.requests.filter(\r\n            r => r.executorId === previousExecutorId && ['assigned', 'accepted', 'in_progress'].includes(r.status) && r.id !== requestId\r\n          ).length;\r\n\r\n          set((state) => ({\r\n            executors: state.executors.map((e) =>\r\n              e.id === previousExecutorId\r\n                ? { ...e, activeRequests: activeCount, status: activeCount > 0 ? 'busy' : 'available' }\r\n                : e\r\n            ),\r\n          }));\r\n        }\r\n\r\n        // Notify resident (local notification)\r\n        get().addNotification({\r\n          userId: request.residentId,\r\n          type: 'request_declined',\r\n          title: ' ',\r\n          message: ` ${executorName}    #${request.number}.    .`,\r\n          requestId,\r\n        });\r\n\r\n        // Notify manager (local notification)\r\n        get().addNotification({\r\n          userId: 'manager1',\r\n          type: 'request_declined',\r\n          title: '   ',\r\n          message: `${executorName}    #${request.number}. : ${reason}.    .`,\r\n          requestId,\r\n        });\r\n\r\n        // Activity log\r\n        get().addActivityLog({\r\n          userId: previousExecutorId || 'system',\r\n          userName: executorName || '',\r\n          userRole: 'executor',\r\n          action: '  ',\r\n          details: ` #${request.number}: ${reason}`,\r\n          requestId,\r\n        });\r\n\r\n        try {\r\n          // Call API to persist the change\r\n          await requestsApi.decline(requestId, reason);\r\n        } catch (error) {\r\n          console.error('Failed to decline request:', error);\r\n          // Rollback on error\r\n          set((state) => ({\r\n            requests: state.requests.map((r) =>\r\n              r.id === requestId ? originalRequest : r\r\n            ),\r\n          }));\r\n          // Re-throw to notify caller\r\n          throw error;\r\n        }\r\n      },\r\n\r\n      getRequestsByResident: (residentId) => {\r\n        return get().requests.filter(r => r.residentId === residentId);\r\n      },\r\n\r\n      getRequestsByExecutor: (executorId) => {\r\n        return get().requests.filter(r => r.executorId === executorId);\r\n      },\r\n\r\n      addNotification: (notification) => {\r\n        const newNotification: Notification = {\r\n          ...notification,\r\n          id: generateId(),\r\n          read: false,\r\n          createdAt: new Date().toISOString(),\r\n        };\r\n        // Limit notifications to 200 to prevent memory bloat\r\n        set((state) => ({\r\n          notifications: [newNotification, ...state.notifications].slice(0, 200),\r\n        }));\r\n      },\r\n\r\n      markNotificationAsRead: (id) => {\r\n        set((state) => ({\r\n          notifications: state.notifications.map((n) =>\r\n            n.id === id ? { ...n, read: true } : n\r\n          ),\r\n        }));\r\n      },\r\n\r\n      markAllNotificationsAsRead: (userId) => {\r\n        set((state) => ({\r\n          notifications: state.notifications.map((n) =>\r\n            n.userId === userId ? { ...n, read: true } : n\r\n          ),\r\n        }));\r\n      },\r\n\r\n      getUnreadCount: (userId) => {\r\n        return get().notifications.filter(n => n.userId === userId && !n.read).length;\r\n      },\r\n\r\n      addActivityLog: (log) => {\r\n        const newLog: ActivityLog = {\r\n          ...log,\r\n          id: generateId(),\r\n          timestamp: new Date().toISOString(),\r\n        };\r\n        set((state) => ({\r\n          activityLogs: [newLog, ...state.activityLogs].slice(0, 100),\r\n        }));\r\n      },\r\n\r\n      getStats: () => {\r\n        const { requests, executors } = get();\r\n        const now = new Date();\r\n        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n        const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n\r\n        const completedRequests = requests.filter(r => r.status === 'completed' && r.approvedAt);\r\n        const completedToday = completedRequests.filter(r =>\r\n          new Date(r.approvedAt!) >= today\r\n        ).length;\r\n        const completedWeek = completedRequests.filter(r =>\r\n          new Date(r.approvedAt!) >= weekAgo\r\n        ).length;\r\n\r\n        let totalTime = 0;\r\n        let count = 0;\r\n        completedRequests.forEach(r => {\r\n          if (r.workDuration) {\r\n            totalTime += r.workDuration;\r\n            count++;\r\n          }\r\n        });\r\n        const avgCompletionTime = count > 0 ? Math.round(totalTime / count / 60) : 0;\r\n\r\n        return {\r\n          totalRequests: requests.length,\r\n          newRequests: requests.filter(r => r.status === 'new').length,\r\n          inProgress: requests.filter(r => ['assigned', 'accepted', 'in_progress'].includes(r.status)).length,\r\n          pendingApproval: requests.filter(r => r.status === 'pending_approval').length,\r\n          completedToday,\r\n          completedWeek,\r\n          avgCompletionTime,\r\n          executorsOnline: executors.filter(e => e.status !== 'offline').length,\r\n          executorsTotal: executors.length,\r\n        };\r\n      },\r\n\r\n      getChartData: () => {\r\n        const { requests } = get();\r\n        const now = new Date();\r\n        const days = ['', '', '', '', '', '', ''];\r\n        const chartData: ChartData[] = [];\r\n\r\n        for (let i = 6; i >= 0; i--) {\r\n          const date = new Date(now);\r\n          date.setDate(date.getDate() - i);\r\n          const dayStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n          const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);\r\n\r\n          const created = requests.filter(r => {\r\n            const createdAt = new Date(r.createdAt);\r\n            return createdAt >= dayStart && createdAt < dayEnd;\r\n          }).length;\r\n\r\n          const completed = requests.filter(r => {\r\n            if (!r.approvedAt) return false;\r\n            const approvedAt = new Date(r.approvedAt);\r\n            return approvedAt >= dayStart && approvedAt < dayEnd;\r\n          }).length;\r\n\r\n          chartData.push({\r\n            date: dayStart.toISOString(),\r\n            name: days[date.getDay() === 0 ? 6 : date.getDay() - 1],\r\n            created,\r\n            completed,\r\n          });\r\n        }\r\n\r\n        return chartData;\r\n      },\r\n\r\n      fetchSettings: async () => {\r\n        try {\r\n          const { settingsApi } = await import('../services/api');\r\n          const response = await settingsApi.getAll();\r\n          if (response.success && response.data?.settings) {\r\n            const apiSettings = response.data.settings;\r\n            // Map API settings to local format\r\n            set((state) => ({\r\n              settings: {\r\n                ...state.settings,\r\n                companyName: apiSettings.companyName ?? state.settings.companyName,\r\n                companyInn: apiSettings.companyInn ?? state.settings.companyInn,\r\n                companyAddress: apiSettings.companyAddress ?? state.settings.companyAddress,\r\n                companyPhone: apiSettings.companyPhone ?? state.settings.companyPhone,\r\n                routingMode: apiSettings.routingMode ?? state.settings.routingMode,\r\n                workingHoursStart: apiSettings.workingHoursStart ?? state.settings.workingHoursStart,\r\n                workingHoursEnd: apiSettings.workingHoursEnd ?? state.settings.workingHoursEnd,\r\n                autoAssign: apiSettings.autoAssign ?? state.settings.autoAssign,\r\n                notifyOnNew: apiSettings.notifyOnNew ?? state.settings.notifyOnNew,\r\n                notifyOnComplete: apiSettings.notifyOnComplete ?? state.settings.notifyOnComplete,\r\n                notifyOnRating: apiSettings.notifyOnRating ?? state.settings.notifyOnRating,\r\n                smsNotifications: apiSettings.smsNotifications ?? state.settings.smsNotifications,\r\n                emailNotifications: apiSettings.emailNotifications ?? state.settings.emailNotifications,\r\n                pushNotifications: apiSettings.pushNotifications ?? state.settings.pushNotifications,\r\n              },\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to fetch settings:', error);\r\n        }\r\n      },\r\n\r\n      updateSettings: async (newSettings) => {\r\n        // Optimistically update local state\r\n        set((state) => ({\r\n          settings: { ...state.settings, ...newSettings },\r\n        }));\r\n\r\n        // Sync to API\r\n        try {\r\n          const { settingsApi } = await import('../services/api');\r\n          await settingsApi.updateMany(newSettings);\r\n        } catch (error) {\r\n          console.error('Failed to save settings to API:', error);\r\n          // Settings already updated locally, API will sync on next fetch\r\n        }\r\n      },\r\n\r\n      // Reschedule actions - using API for cross-user sync\r\n      fetchPendingReschedules: async () => {\r\n        try {\r\n          const { rescheduleApi } = await import('../services/api');\r\n          const response = await rescheduleApi.getPending();\r\n          const reschedules = response.reschedules || [];\r\n\r\n          // Map API response to RescheduleRequest type\r\n          const mappedReschedules: RescheduleRequest[] = reschedules.map((r: any) => ({\r\n            id: r.id,\r\n            requestId: r.request_id,\r\n            requestNumber: r.request_number || r.request_title || `#${r.request_id?.substring(0, 6)}`,\r\n            initiator: r.initiator as RescheduleInitiator,\r\n            initiatorId: r.initiator_id,\r\n            initiatorName: r.initiator_name,\r\n            recipientId: r.recipient_id,\r\n            recipientName: r.recipient_name,\r\n            recipientRole: r.recipient_role as 'resident' | 'executor',\r\n            currentDate: r.current_date,\r\n            currentTime: r.current_time,\r\n            proposedDate: r.proposed_date,\r\n            proposedTime: r.proposed_time,\r\n            reason: r.reason as RescheduleReason,\r\n            reasonText: r.reason_text,\r\n            status: r.status as 'pending' | 'accepted' | 'rejected' | 'expired',\r\n            responseNote: r.response_note,\r\n            createdAt: r.created_at,\r\n            respondedAt: r.responded_at,\r\n            expiresAt: r.expires_at,\r\n          }));\r\n\r\n          set({ rescheduleRequests: mappedReschedules });\r\n        } catch (error) {\r\n          console.error('Failed to fetch pending reschedules:', error);\r\n        }\r\n      },\r\n\r\n      createRescheduleRequest: async (data) => {\r\n        const state = get();\r\n        const request = state.requests.find(r => r.id === data.requestId);\r\n        if (!request) return null;\r\n\r\n        const { user } = useAuthStore.getState();\r\n        if (!user) return null;\r\n\r\n        try {\r\n          const { requestsApi } = await import('../services/api');\r\n          const response = await requestsApi.createReschedule(data.requestId, {\r\n            proposed_date: data.proposedDate,\r\n            proposed_time: data.proposedTime,\r\n            reason: data.reason,\r\n            reason_text: data.reasonText,\r\n          });\r\n\r\n          if (response.reschedule) {\r\n            const r = response.reschedule;\r\n            const newReschedule: RescheduleRequest = {\r\n              id: r.id,\r\n              requestId: r.request_id,\r\n              requestNumber: request.number,\r\n              initiator: r.initiator as RescheduleInitiator,\r\n              initiatorId: r.initiator_id,\r\n              initiatorName: r.initiator_name,\r\n              recipientId: r.recipient_id,\r\n              recipientName: r.recipient_name,\r\n              recipientRole: r.recipient_role as 'resident' | 'executor',\r\n              currentDate: r.current_date,\r\n              currentTime: r.current_time,\r\n              proposedDate: r.proposed_date,\r\n              proposedTime: r.proposed_time,\r\n              reason: r.reason as RescheduleReason,\r\n              reasonText: r.reason_text,\r\n              status: 'pending',\r\n              createdAt: r.created_at,\r\n              expiresAt: r.expires_at,\r\n            };\r\n\r\n            set((state) => ({\r\n              rescheduleRequests: [newReschedule, ...state.rescheduleRequests],\r\n            }));\r\n\r\n            return newReschedule;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to create reschedule request:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      respondToRescheduleRequest: async (rescheduleId, accepted, responseNote) => {\r\n        const state = get();\r\n        const reschedule = state.rescheduleRequests.find(r => r.id === rescheduleId);\r\n        if (!reschedule || reschedule.status !== 'pending') return;\r\n\r\n        try {\r\n          const { rescheduleApi } = await import('../services/api');\r\n          const response = await rescheduleApi.respond(rescheduleId, accepted, responseNote);\r\n\r\n          if (response.reschedule) {\r\n            // Update local state\r\n            set((state) => ({\r\n              rescheduleRequests: state.rescheduleRequests.map((r) =>\r\n                r.id === rescheduleId\r\n                  ? {\r\n                      ...r,\r\n                      status: accepted ? 'accepted' as const : 'rejected' as const,\r\n                      respondedAt: new Date().toISOString(),\r\n                      responseNote,\r\n                    }\r\n                  : r\r\n              ),\r\n            }));\r\n\r\n            // If accepted, update the request's scheduled date/time\r\n            if (accepted) {\r\n              set((state) => ({\r\n                requests: state.requests.map((r) =>\r\n                  r.id === reschedule.requestId\r\n                    ? {\r\n                        ...r,\r\n                        scheduledDate: reschedule.proposedDate,\r\n                        scheduledTime: reschedule.proposedTime,\r\n                      }\r\n                    : r\r\n                ),\r\n              }));\r\n\r\n              // Refresh requests to get updated data from server\r\n              get().fetchRequests();\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to respond to reschedule request:', error);\r\n        }\r\n      },\r\n\r\n      getRescheduleRequestsByRequest: (requestId) => {\r\n        return get().rescheduleRequests.filter(r => r.requestId === requestId);\r\n      },\r\n\r\n      getPendingRescheduleForUser: (userId) => {\r\n        return get().rescheduleRequests.filter(\r\n          r => r.recipientId === userId && r.status === 'pending'\r\n        );\r\n      },\r\n\r\n      getActiveRescheduleForRequest: (requestId) => {\r\n        return get().rescheduleRequests.find(\r\n          r => r.requestId === requestId && r.status === 'pending'\r\n        );\r\n      },\r\n\r\n      getConfirmedRescheduleForRequest: (requestId) => {\r\n        // Find recently accepted reschedule (within last 24 hours)\r\n        const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000;\r\n        return get().rescheduleRequests.find(\r\n          r => r.requestId === requestId &&\r\n               r.status === 'accepted' &&\r\n               r.respondedAt &&\r\n               new Date(r.respondedAt).getTime() > oneDayAgo\r\n        );\r\n      },\r\n    }),\r\n    {\r\n      name: 'uk-data-storage',\r\n      // MINIMAL PERSISTENCE - only settings that are truly local\r\n      // All data now comes from API (D1 database)\r\n      partialize: (state) => ({\r\n        // Only persist local UI settings that don't have API endpoints yet\r\n        settings: state.settings,\r\n        // Keep notifications for offline display\r\n        notifications: state.notifications.slice(0, 100),\r\n      }),\r\n      merge: (persistedState, currentState) => {\r\n        const persisted = persistedState as Partial<DataState>;\r\n        // Demo code for QR testing\r\n        const demoCode = createDemoGuestAccessCode();\r\n\r\n        return {\r\n          ...currentState,\r\n          settings: persisted.settings || currentState.settings,\r\n          notifications: persisted.notifications || [],\r\n          // All data starts empty - will be fetched from API\r\n          vehicles: [],\r\n          announcements: [],\r\n          requests: [],\r\n          guestAccessCodes: [demoCode],\r\n          executors: [], // Empty - will be fetched from API\r\n          rescheduleRequests: [],\r\n          rentalApartments: [],\r\n          rentalRecords: [],\r\n        };\r\n      },\r\n    }\r\n  )\r\n);\r\n\r\n// Cross-tab synchronization for localStorage changes\r\n// This ensures QR code status updates are synced between guard and resident\r\nif (typeof window !== 'undefined') {\r\n  window.addEventListener('storage', (event) => {\r\n    if (event.key === 'uk-data-storage' && event.newValue) {\r\n      try {\r\n        const parsed = JSON.parse(event.newValue);\r\n        if (parsed.state?.guestAccessCodes) {\r\n          // Update guestAccessCodes from another tab\r\n          useDataStore.setState({ guestAccessCodes: parsed.state.guestAccessCodes });\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to sync storage:', e);\r\n      }\r\n    }\r\n  });\r\n}\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\n\r\nexport type Language = 'ru' | 'uz';\r\n\r\ninterface LanguageState {\r\n  language: Language;\r\n  setLanguage: (lang: Language) => void;\r\n  t: (key: string) => string;\r\n}\r\n\r\n// Translations\r\nconst translations: Record<Language, Record<string, string>> = {\r\n  ru: {\r\n    // App name\r\n    'app.name': 'Kamizo',\r\n    'app.subtitle': 'CRM ',\r\n\r\n    // Auth\r\n    'auth.title': '  ',\r\n    'auth.login': '',\r\n    'auth.password': '',\r\n    'auth.enter': '',\r\n    'auth.error': '   ',\r\n    'auth.logout': '',\r\n\r\n    // Navigation\r\n    'nav.dashboard': '',\r\n    'nav.requests': '',\r\n    'nav.executors': '',\r\n    'nav.residents': '',\r\n    'nav.buildings': '',\r\n    'nav.activity': ' ',\r\n    'nav.reports': '',\r\n    'nav.settings': '',\r\n    'nav.monitoring': '',\r\n    'nav.myRequests': ' ',\r\n    'nav.services': '',\r\n    'nav.profile': '',\r\n    'nav.more': '',\r\n    'nav.rentals': ' ',\r\n    'nav.myApartments': ' ',\r\n    'nav.accounts': ' ',\r\n    'nav.owners': '',\r\n    'nav.workOrders': '  ',\r\n    'nav.trainings': '',\r\n\r\n    // Dashboard\r\n    'dashboard.manager': ' ',\r\n    'dashboard.admin': ' ',\r\n    'dashboard.newRequests': ' ',\r\n    'dashboard.inProgress': ' ',\r\n    'dashboard.pendingApproval': ' ',\r\n    'dashboard.completedWeek': '  ',\r\n    'dashboard.weeklyRequests': '  ',\r\n    'dashboard.byCategory': ' ',\r\n    'dashboard.recentRequests': ' ',\r\n    'dashboard.viewAll': '',\r\n\r\n    // Requests\r\n    'request.assign': '',\r\n    'request.reassign': '',\r\n    'request.executor': '',\r\n    'request.search': '...',\r\n    'request.allStatuses': ' ',\r\n    'request.notFound': '  ',\r\n    'request.changeFilters': '  ',\r\n\r\n    // Executors\r\n    'executor.available': '',\r\n    'executor.busy': '',\r\n    'executor.offline': '',\r\n    'executor.all': ' ',\r\n    'executor.add': ' ',\r\n    'executor.completed': '',\r\n    'executor.active': '',\r\n\r\n    // Residents\r\n    'resident.add': ' ',\r\n    'resident.total': '',\r\n    'resident.noResidents': '  ',\r\n    'resident.willAppear': '    ',\r\n\r\n    // Status\r\n    'status.new': '',\r\n    'status.assigned': '',\r\n    'status.accepted': '',\r\n    'status.in_progress': ' ',\r\n    'status.pending_approval': ' ',\r\n    'status.completed': '',\r\n    'status.cancelled': '',\r\n\r\n    // Priority\r\n    'priority.low': '',\r\n    'priority.medium': '',\r\n    'priority.high': '',\r\n    'priority.urgent': '',\r\n\r\n    // Forms\r\n    'form.name': '',\r\n    'form.phone': '',\r\n    'form.address': '',\r\n    'form.apartment': '',\r\n    'form.login': '',\r\n    'form.password': '',\r\n    'form.specialization': '',\r\n    'form.generate': '',\r\n    'form.cancel': '',\r\n    'form.add': '',\r\n    'form.save': '',\r\n    'form.done': '',\r\n    'form.copy': '',\r\n    'form.copied': '!',\r\n    'form.fillAll': '  ',\r\n    'form.credentials': '  ',\r\n\r\n    // Timer\r\n    'timer.start': ' ',\r\n    'timer.pause': '',\r\n    'timer.resume': '',\r\n    'timer.finish': '',\r\n    'timer.elapsed': ' ',\r\n\r\n    // Settings\r\n    'settings.general': '',\r\n    'settings.notifications': '',\r\n    'settings.integrations': '',\r\n    'settings.users': '',\r\n    'settings.language': '',\r\n\r\n    // Common\r\n    'common.all': '',\r\n    'common.delete': '',\r\n    'common.edit': '',\r\n    'common.view': '',\r\n    'common.refresh': '',\r\n    'common.loading': '...',\r\n    'common.noData': ' ',\r\n\r\n    // Rentals\r\n    'rental.title': ' ',\r\n    'rental.addApartment': ' ',\r\n    'rental.noApartments': '  ',\r\n    'rental.addFirst': '     ',\r\n    'rental.occupied': '',\r\n    'rental.available': '',\r\n    'rental.records': '',\r\n    'rental.currentGuest': ' ',\r\n    'rental.until': '',\r\n    'rental.deleteApartment': ' ',\r\n    'rental.owner': '',\r\n    'rental.addRecord': ' ',\r\n    'rental.rentalHistory': ' ',\r\n    'rental.noRecords': '  ',\r\n    'rental.active': '',\r\n    'rental.apartmentName': '',\r\n    'rental.ownerData': '  ()',\r\n    'rental.guestNames': ' ',\r\n    'rental.passportInfo': ' ',\r\n    'rental.checkIn': ' ',\r\n    'rental.checkOut': ' ',\r\n    'rental.amount': '',\r\n    'rental.currency': '',\r\n    'rental.notes': ' ()',\r\n    'rental.apartmentAdded': ' !',\r\n    'rental.ownerCredentials': '   :',\r\n    'rental.generateCredentials': ' /',\r\n    'rental.confirmDelete': ' ',\r\n    'rental.enterOwnerPassword': '      ',\r\n    'rental.wrongPassword': ' ',\r\n\r\n    // Tenant Dashboard\r\n    'tenant.myApartments': ' ',\r\n    'tenant.welcome': ' ',\r\n    'tenant.apartments': '',\r\n    'tenant.records': '',\r\n    'tenant.totalGuests': ' ',\r\n    'tenant.income': ' ()',\r\n    'tenant.noAssigned': '  ',\r\n    'tenant.contactManager': '     ',\r\n    'tenant.now': '',\r\n    'tenant.completed': '',\r\n    'tenant.moreRecords': '  ...',\r\n    'tenant.guest': '',\r\n    'tenant.guests': '',\r\n    'tenant.guestsMany': '',\r\n    'tenant.checkInLabel': '',\r\n    'tenant.checkOutLabel': '',\r\n\r\n    // Announcements\r\n    'announcements.title': '',\r\n    'announcements.forResidents': ' ',\r\n    'announcements.forStaff': ' ',\r\n    'announcements.add': ' ',\r\n    'announcements.noAnnouncements': '  ',\r\n    'announcements.addFirst': '  ',\r\n    'announcements.titleLabel': '',\r\n    'announcements.content': '',\r\n    'announcements.type': '',\r\n    'announcements.priority': '',\r\n    'announcements.expiresAt': '  ()',\r\n    'announcements.priorityNormal': '',\r\n    'announcements.priorityImportant': '',\r\n    'announcements.priorityUrgent': '',\r\n    'announcements.views': '',\r\n    'announcements.author': '',\r\n    'announcements.createdAt': '',\r\n    'announcements.myAnnouncements': ' ',\r\n    'announcements.allAnnouncements': ' ',\r\n    'announcements.noNew': '  ',\r\n    'announcements.new': '',\r\n\r\n    // Meetings - \r\n    'meetings.title': ' ',\r\n    'meetings.subtitle': '   ',\r\n    'meetings.create': ' ',\r\n    'meetings.noMeetings': '  ',\r\n    'meetings.createFirst': '  ',\r\n\r\n    // Meeting statuses\r\n    'meetings.status.draft': '',\r\n    'meetings.status.pending_moderation': ' ',\r\n    'meetings.status.schedule_poll_open': ' ',\r\n    'meetings.status.schedule_confirmed': ' ',\r\n    'meetings.status.voting_open': '',\r\n    'meetings.status.voting_closed': ' ',\r\n    'meetings.status.results_published': ' ',\r\n    'meetings.status.protocol_generated': ' ',\r\n    'meetings.status.protocol_approved': ' ',\r\n    'meetings.status.cancelled': '',\r\n\r\n    // Meeting format\r\n    'meetings.format.online': '',\r\n    'meetings.format.offline': '',\r\n    'meetings.format.hybrid': '',\r\n\r\n    // Meeting creation wizard\r\n    'meetings.wizard.step1': ' ',\r\n    'meetings.wizard.step2': ' ',\r\n    'meetings.wizard.step3': '  ',\r\n    'meetings.wizard.step4': '',\r\n    'meetings.wizard.organizerType': '',\r\n    'meetings.wizard.organizerResident': ' ()',\r\n    'meetings.wizard.organizerManagement': ' ',\r\n    'meetings.wizard.selectFormat': ' ',\r\n    'meetings.wizard.selectAgenda': '  ',\r\n    'meetings.wizard.addCustomQuestion': '  ',\r\n    'meetings.wizard.questionTitle': ' ',\r\n    'meetings.wizard.questionDescription': '',\r\n    'meetings.wizard.attachMaterials': ' ',\r\n    'meetings.wizard.threshold': ' ',\r\n    'meetings.wizard.scheduleDatetime': ' 3    ',\r\n    'meetings.wizard.autoGenerate': ' ',\r\n    'meetings.wizard.location': '  ( /)',\r\n    'meetings.wizard.publish': ' ',\r\n    'meetings.wizard.saveDraft': ' ',\r\n\r\n    // Schedule voting\r\n    'meetings.schedule.title': '  ',\r\n    'meetings.schedule.voteFor': '',\r\n    'meetings.schedule.yourVote': ' ',\r\n    'meetings.schedule.votes': '',\r\n    'meetings.schedule.endsAt': ' ',\r\n    'meetings.schedule.confirmed': ' ',\r\n\r\n    // Agenda voting\r\n    'meetings.voting.title': '  ',\r\n    'meetings.voting.for': '',\r\n    'meetings.voting.against': '',\r\n    'meetings.voting.abstain': '',\r\n    'meetings.voting.voted': ' ',\r\n    'meetings.voting.notVoted': '   ',\r\n    'meetings.voting.changeVote': ' ',\r\n    'meetings.voting.confirmVote': ' ',\r\n    'meetings.voting.verifyIdentity': ' ',\r\n    'meetings.voting.enterOTP': '   SMS',\r\n    'meetings.voting.sendOTP': ' ',\r\n    'meetings.voting.resendOTP': ' ',\r\n    'meetings.voting.otpSent': '  ',\r\n    'meetings.voting.otpInvalid': ' ',\r\n    'meetings.voting.otpExpired': ' ,  ',\r\n\r\n    // Results\r\n    'meetings.results.title': ' ',\r\n    'meetings.results.approved': '',\r\n    'meetings.results.rejected': ' ',\r\n    'meetings.results.quorum': '',\r\n    'meetings.results.quorumReached': ' ',\r\n    'meetings.results.quorumNotReached': '  ',\r\n    'meetings.results.participation': '',\r\n    'meetings.results.votesFor': '',\r\n    'meetings.results.votesAgainst': '',\r\n    'meetings.results.votesAbstain': '',\r\n    'meetings.results.threshold': '',\r\n\r\n    // Protocol\r\n    'meetings.protocol.title': ' ',\r\n    'meetings.protocol.generate': ' ',\r\n    'meetings.protocol.download': ' PDF',\r\n    'meetings.protocol.sign': ' ',\r\n    'meetings.protocol.signed': ' ',\r\n    'meetings.protocol.signedBy': '',\r\n\r\n    // Actions\r\n    'meetings.actions.approve': '',\r\n    'meetings.actions.reject': '',\r\n    'meetings.actions.openVoting': ' ',\r\n    'meetings.actions.closeVoting': ' ',\r\n    'meetings.actions.publishResults': ' ',\r\n    'meetings.actions.cancel': ' ',\r\n    'meetings.actions.viewDetails': '',\r\n    'meetings.actions.viewAgenda': ' ',\r\n    'meetings.actions.viewMaterials': '',\r\n\r\n    // Notifications\r\n    'meetings.notify.created': '  ',\r\n    'meetings.notify.scheduleVote': '  ',\r\n    'meetings.notify.scheduleConfirmed': '  ',\r\n    'meetings.notify.votingOpen': ' ',\r\n    'meetings.notify.votingReminder': '  ',\r\n    'meetings.notify.resultsPublished': '  ',\r\n    'meetings.notify.protocolReady': '  ',\r\n\r\n    // Settings\r\n    'meetings.settings.title': ' ',\r\n    'meetings.settings.votingUnit': ' ',\r\n    'meetings.settings.votingUnitApartment': '1  = 1 ',\r\n    'meetings.settings.votingUnitOwner': '1  = 1 ',\r\n    'meetings.settings.votingUnitShare': '  ',\r\n    'meetings.settings.quorum': ' (%)',\r\n    'meetings.settings.allowResidentInitiative': '  ',\r\n    'meetings.settings.requireModeration': '  ',\r\n    'meetings.settings.requireOTP': '  SMS',\r\n    'meetings.settings.showIntermediateResults': '  ',\r\n\r\n    // Evidence\r\n    'meetings.evidence.title': ' ',\r\n    'meetings.evidence.download': ' ',\r\n    'meetings.evidence.totalVotes': ' ',\r\n    'meetings.evidence.otpVerified': '  SMS',\r\n    'meetings.evidence.uniqueVoters': ' ',\r\n\r\n    // Login Page\r\n    'login.enterLogin': ' ',\r\n    'login.enterPassword': ' ',\r\n    'login.mustAcceptTerms': '    ',\r\n    'login.wrongCredentials': '   ',\r\n    'login.loginError': '  ',\r\n    'login.loading': '...',\r\n    'login.agreeWith': '   ',\r\n    'login.publicOffer': ' ',\r\n    'login.acceptFirst': '    ',\r\n    'login.offerTitle': ' ',\r\n    'login.scrollToAccept': '   ,    ',\r\n    'login.documentRead': '  ',\r\n    'login.scrollDown': '   ',\r\n    'login.close': '',\r\n    'login.accept': '',\r\n\r\n    // Roles\r\n    'role.admin': '',\r\n    'role.manager': '',\r\n    'role.department_head': ' ',\r\n    'role.executor': '',\r\n    'role.resident': '',\r\n    'role.plumber': '',\r\n    'role.electrician': '',\r\n    'role.security': '',\r\n\r\n    // Buildings / CRM\r\n    'building.title': '',\r\n    'building.add': ' ',\r\n    'building.edit': ' ',\r\n    'building.delete': ' ',\r\n    'building.address': '',\r\n    'building.name': '',\r\n    'building.floors': '',\r\n    'building.entrances': '',\r\n    'building.apartments': '',\r\n    'building.residents': '',\r\n    'building.noBuildings': '  ',\r\n    'building.addFirst': '  ',\r\n\r\n    // Owners\r\n    'owner.title': '',\r\n    'owner.add': ' ',\r\n    'owner.edit': '',\r\n    'owner.delete': '',\r\n    'owner.name': ' ',\r\n    'owner.phone': '',\r\n    'owner.email': 'Email',\r\n    'owner.share': ' ',\r\n    'owner.noOwners': '  ',\r\n\r\n    // Personal Accounts\r\n    'account.title': ' ',\r\n    'account.number': ' ',\r\n    'account.balance': '',\r\n    'account.debt': '',\r\n    'account.lastPayment': ' ',\r\n    'account.noAccounts': '  ',\r\n\r\n    // Work Orders\r\n    'workorder.title': '  ',\r\n    'workorder.create': ' ',\r\n    'workorder.number': ' ',\r\n    'workorder.status': '',\r\n    'workorder.executor': '',\r\n    'workorder.deadline': ' ',\r\n    'workorder.noWorkOrders': '  ',\r\n\r\n    // Activity Log\r\n    'activity.title': ' ',\r\n    'activity.created': '',\r\n    'activity.updated': '',\r\n    'activity.deleted': '',\r\n    'activity.login': '  ',\r\n    'activity.logout': '  ',\r\n    'activity.noActivity': ' ',\r\n    'activity.user': '',\r\n    'activity.action': '',\r\n    'activity.timestamp': '',\r\n    'activity.details': '',\r\n\r\n    // Monitoring\r\n    'monitoring.title': ' ',\r\n    'monitoring.health': ' ',\r\n    'monitoring.uptime': ' ',\r\n    'monitoring.requests': '',\r\n    'monitoring.errors': '',\r\n    'monitoring.latency': '',\r\n    'monitoring.healthy': '',\r\n    'monitoring.degraded': '',\r\n    'monitoring.down': '',\r\n\r\n    // Executor Stats\r\n    'stats.title': '',\r\n    'stats.completed': '',\r\n    'stats.thisWeek': ' ',\r\n    'stats.thisMonth': ' ',\r\n    'stats.rating': '',\r\n    'stats.avgTime': ' ',\r\n    'stats.noStats': '   ',\r\n\r\n    // Schedule\r\n    'schedule.title': '',\r\n    'schedule.today': '',\r\n    'schedule.tomorrow': '',\r\n    'schedule.thisWeek': '  ',\r\n    'schedule.noSchedule': '  ',\r\n    'schedule.addEvent': ' ',\r\n\r\n    // Chat\r\n    'chat.title': '',\r\n    'chat.support': '',\r\n    'chat.newMessage': ' ',\r\n    'chat.typeMessage': ' ...',\r\n    'chat.send': '',\r\n    'chat.noMessages': ' ',\r\n    'chat.startConversation': ' ',\r\n\r\n    // Guest Access\r\n    'guest.title': ' ',\r\n    'guest.createCode': ' ',\r\n    'guest.validUntil': ' ',\r\n    'guest.usages': '',\r\n    'guest.active': '',\r\n    'guest.expired': '',\r\n    'guest.used': '',\r\n    'guest.noGuests': '  ',\r\n    'guest.generate': ' QR-',\r\n    'guest.copyCode': ' ',\r\n    'guest.shareCode': ' ',\r\n\r\n    // QR Scanner\r\n    'scanner.title': ' QR-',\r\n    'scanner.scan': '',\r\n    'scanner.scanning': '...',\r\n    'scanner.valid': ' ',\r\n    'scanner.invalid': ' ',\r\n    'scanner.expired': ' ',\r\n    'scanner.allow': ' ',\r\n    'scanner.deny': ' ',\r\n\r\n    // Vehicles\r\n    'vehicle.title': '',\r\n    'vehicle.add': ' ',\r\n    'vehicle.plate': '',\r\n    'vehicle.brand': '',\r\n    'vehicle.model': '',\r\n    'vehicle.color': '',\r\n    'vehicle.owner': '',\r\n    'vehicle.noVehicles': '  ',\r\n    'vehicle.search': '  ',\r\n\r\n    // Contract\r\n    'contract.title': '',\r\n    'contract.number': ' ',\r\n    'contract.status': '',\r\n    'contract.signed': '',\r\n    'contract.pending': ' ',\r\n    'contract.startDate': ' ',\r\n    'contract.endDate': ' ',\r\n    'contract.download': ' PDF',\r\n    'contract.sign': '',\r\n\r\n    // Profile\r\n    'profile.title': ' ',\r\n    'profile.personalData': '  ',\r\n    'profile.personalAccount': ' ',\r\n    'profile.loginHint': '  ',\r\n    'profile.cannotChange': ' ',\r\n    'profile.phone': '',\r\n    'profile.notSpecified': ' ',\r\n    'profile.password': '',\r\n    'profile.currentPassword': ' ',\r\n    'profile.newPassword': ' ',\r\n    'profile.confirmPassword': ' ',\r\n    'profile.passwordChanged': '  ',\r\n    'profile.phoneSaved': ' ',\r\n\r\n    // Errors\r\n    'error.generic': ' ',\r\n    'error.network': ' ',\r\n    'error.unauthorized': ' ',\r\n    'error.forbidden': ' ',\r\n    'error.notFound': ' ',\r\n    'error.tryAgain': ' ',\r\n\r\n    // Confirmations\r\n    'confirm.delete': ' ',\r\n    'confirm.cancel': '',\r\n    'confirm.yes': '',\r\n    'confirm.no': '',\r\n    'confirm.sure': ' ?',\r\n\r\n    // Time\r\n    'time.today': '',\r\n    'time.yesterday': '',\r\n    'time.daysAgo': ' ',\r\n    'time.hoursAgo': ' ',\r\n    'time.minutesAgo': ' ',\r\n    'time.justNow': ' ',\r\n  },\r\n  uz: {\r\n    // App name\r\n    'app.name': 'Kamizo',\r\n    'app.subtitle': 'CRM Tizimi',\r\n\r\n    // Auth\r\n    'auth.title': 'Tizimga kirish',\r\n    'auth.login': 'Login',\r\n    'auth.password': 'Parol',\r\n    'auth.enter': 'Kirish',\r\n    'auth.error': 'Login yoki parol noto\\'g\\'ri',\r\n    'auth.logout': 'Chiqish',\r\n\r\n    // Navigation\r\n    'nav.dashboard': 'Boshqaruv paneli',\r\n    'nav.requests': 'Arizalar',\r\n    'nav.executors': 'Ijrochilar',\r\n    'nav.residents': 'Aholi',\r\n    'nav.buildings': 'Binolar',\r\n    'nav.activity': 'Faoliyat jurnali',\r\n    'nav.reports': 'Hisobotlar',\r\n    'nav.settings': 'Sozlamalar',\r\n    'nav.monitoring': 'Monitoring',\r\n    'nav.myRequests': 'Mening arizalarim',\r\n    'nav.services': 'Xizmatlar',\r\n    'nav.profile': 'Profil',\r\n    'nav.more': 'Ko\\'proq',\r\n    'nav.rentals': 'Kvartira ijarasi',\r\n    'nav.myApartments': 'Mening kvartiram',\r\n    'nav.accounts': 'Shaxsiy hisoblar',\r\n    'nav.owners': 'Mulkdorlar',\r\n    'nav.workOrders': 'Ish buyruqlari',\r\n    'nav.trainings': 'Treninglar',\r\n\r\n    // Dashboard\r\n    'dashboard.manager': 'Menejer paneli',\r\n    'dashboard.admin': 'Administrator paneli',\r\n    'dashboard.newRequests': 'Yangi arizalar',\r\n    'dashboard.inProgress': 'Jarayonda',\r\n    'dashboard.pendingApproval': 'Tasdiqlash kutilmoqda',\r\n    'dashboard.completedWeek': 'Hafta davomida bajarilgan',\r\n    'dashboard.weeklyRequests': 'Haftalik arizalar',\r\n    'dashboard.byCategory': 'Kategoriya bo\\'yicha',\r\n    'dashboard.recentRequests': 'So\\'nggi arizalar',\r\n    'dashboard.viewAll': 'Hammasi',\r\n\r\n    // Requests\r\n    'request.assign': 'Tayinlash',\r\n    'request.reassign': 'Qayta tayinlash',\r\n    'request.executor': 'Ijrochi',\r\n    'request.search': 'Qidirish...',\r\n    'request.allStatuses': 'Barcha holatlar',\r\n    'request.notFound': 'Arizalar topilmadi',\r\n    'request.changeFilters': 'Filtrlarni o\\'zgartirib ko\\'ring',\r\n\r\n    // Executors\r\n    'executor.available': 'Mavjud',\r\n    'executor.busy': 'Band',\r\n    'executor.offline': 'Oflayn',\r\n    'executor.all': 'Barcha ijrochilar',\r\n    'executor.add': 'Ijrochi qo\\'shish',\r\n    'executor.completed': 'bajarilgan',\r\n    'executor.active': 'faol',\r\n\r\n    // Residents\r\n    'resident.add': 'Aholi qo\\'shish',\r\n    'resident.total': 'jami',\r\n    'resident.noResidents': 'Aholi hali yo\\'q',\r\n    'resident.willAppear': 'Arizalar yaratilgandan keyin aholi paydo bo\\'ladi',\r\n\r\n    // Status\r\n    'status.new': 'Yangi',\r\n    'status.assigned': 'Tayinlangan',\r\n    'status.accepted': 'Qabul qilingan',\r\n    'status.in_progress': 'Jarayonda',\r\n    'status.pending_approval': 'Tasdiqlash kutilmoqda',\r\n    'status.completed': 'Bajarilgan',\r\n    'status.cancelled': 'Bekor qilingan',\r\n\r\n    // Priority\r\n    'priority.low': 'Past',\r\n    'priority.medium': 'O\\'rta',\r\n    'priority.high': 'Yuqori',\r\n    'priority.urgent': 'Shoshilinch',\r\n\r\n    // Forms\r\n    'form.name': 'F.I.O.',\r\n    'form.phone': 'Telefon',\r\n    'form.address': 'Manzil',\r\n    'form.apartment': 'Kvartira',\r\n    'form.login': 'Login',\r\n    'form.password': 'Parol',\r\n    'form.specialization': 'Mutaxassislik',\r\n    'form.generate': 'Yaratish',\r\n    'form.cancel': 'Bekor qilish',\r\n    'form.add': 'Qo\\'shish',\r\n    'form.save': 'Saqlash',\r\n    'form.done': 'Tayyor',\r\n    'form.copy': 'Nusxalash',\r\n    'form.copied': 'Nusxalandi!',\r\n    'form.fillAll': 'Barcha maydonlarni to\\'ldiring',\r\n    'form.credentials': 'Kirish ma\\'lumotlari',\r\n\r\n    // Timer\r\n    'timer.start': 'Ishni boshlash',\r\n    'timer.pause': 'Pauza',\r\n    'timer.resume': 'Davom ettirish',\r\n    'timer.finish': 'Tugatish',\r\n    'timer.elapsed': 'O\\'tgan vaqt',\r\n\r\n    // Settings\r\n    'settings.general': 'Umumiy',\r\n    'settings.notifications': 'Bildirishnomalar',\r\n    'settings.integrations': 'Integratsiyalar',\r\n    'settings.users': 'Foydalanuvchilar',\r\n    'settings.language': 'Til',\r\n\r\n    // Common\r\n    'common.all': 'Hammasi',\r\n    'common.delete': 'O\\'chirish',\r\n    'common.edit': 'Tahrirlash',\r\n    'common.view': 'Ko\\'rish',\r\n    'common.refresh': 'Yangilash',\r\n    'common.loading': 'Yuklanmoqda...',\r\n    'common.noData': 'Ma\\'lumot yo\\'q',\r\n\r\n    // Rentals\r\n    'rental.title': 'Kvartira ijarasi',\r\n    'rental.addApartment': 'Kvartira qo\\'shish',\r\n    'rental.noApartments': 'Kvartiralar hali yo\\'q',\r\n    'rental.addFirst': 'Ijarani boshqarish uchun birinchi kvartirani qo\\'shing',\r\n    'rental.occupied': 'Band',\r\n    'rental.available': 'Bo\\'sh',\r\n    'rental.records': 'yozuvlar',\r\n    'rental.currentGuest': 'Hozirgi mehmon',\r\n    'rental.until': 'gacha',\r\n    'rental.deleteApartment': 'Kvartirani o\\'chirish',\r\n    'rental.owner': 'Egasi',\r\n    'rental.addRecord': 'Yozuv qo\\'shish',\r\n    'rental.rentalHistory': 'Ijara tarixi',\r\n    'rental.noRecords': 'Yozuvlar hali yo\\'q',\r\n    'rental.active': 'Faol',\r\n    'rental.apartmentName': 'Nomi',\r\n    'rental.ownerData': 'Egasi ma\\'lumotlari (tenant)',\r\n    'rental.guestNames': 'Mehmonlar ismi',\r\n    'rental.passportInfo': 'Pasport ma\\'lumotlari',\r\n    'rental.checkIn': 'Kirish sanasi',\r\n    'rental.checkOut': 'Chiqish sanasi',\r\n    'rental.amount': 'Summa',\r\n    'rental.currency': 'Valyuta',\r\n    'rental.notes': 'Izohlar (ixtiyoriy)',\r\n    'rental.apartmentAdded': 'Kvartira qo\\'shildi!',\r\n    'rental.ownerCredentials': 'Egasi kirish ma\\'lumotlari:',\r\n    'rental.generateCredentials': 'Login/parol yaratish',\r\n    'rental.confirmDelete': 'O\\'chirishni tasdiqlang',\r\n    'rental.enterOwnerPassword': 'O\\'chirishni tasdiqlash uchun kvartira egasining parolini kiriting',\r\n    'rental.wrongPassword': 'Parol noto\\'g\\'ri',\r\n\r\n    // Tenant Dashboard\r\n    'tenant.myApartments': 'Mening kvartiram',\r\n    'tenant.welcome': 'Xush kelibsiz',\r\n    'tenant.apartments': 'Kvartiralar',\r\n    'tenant.records': 'Yozuvlar',\r\n    'tenant.totalGuests': 'Jami mehmonlar',\r\n    'tenant.income': 'Daromad (so\\'m)',\r\n    'tenant.noAssigned': 'Tayinlangan kvartiralar yo\\'q',\r\n    'tenant.contactManager': 'Kvartira qo\\'shish uchun menejer bilan bog\\'laning',\r\n    'tenant.now': 'Hozir',\r\n    'tenant.completed': 'Tugallangan',\r\n    'tenant.moreRecords': 'Va yana yozuvlar...',\r\n    'tenant.guest': 'mehmon',\r\n    'tenant.guests': 'mehmon',\r\n    'tenant.guestsMany': 'mehmon',\r\n    'tenant.checkInLabel': 'Kirish',\r\n    'tenant.checkOutLabel': 'Chiqish',\r\n\r\n    // Announcements\r\n    'announcements.title': 'E\\'lonlar',\r\n    'announcements.forResidents': 'Aholiga',\r\n    'announcements.forStaff': 'Xodimlarga',\r\n    'announcements.add': 'E\\'lon qo\\'shish',\r\n    'announcements.noAnnouncements': 'E\\'lonlar hali yo\\'q',\r\n    'announcements.addFirst': 'Birinchi e\\'lonni qo\\'shing',\r\n    'announcements.titleLabel': 'Sarlavha',\r\n    'announcements.content': 'Mazmuni',\r\n    'announcements.type': 'Turi',\r\n    'announcements.priority': 'Muhimlik',\r\n    'announcements.expiresAt': 'Amal qilish muddati (ixtiyoriy)',\r\n    'announcements.priorityNormal': 'Oddiy',\r\n    'announcements.priorityImportant': 'Muhim',\r\n    'announcements.priorityUrgent': 'Shoshilinch',\r\n    'announcements.views': 'ko\\'rishlar',\r\n    'announcements.author': 'Muallif',\r\n    'announcements.createdAt': 'Yaratilgan',\r\n    'announcements.myAnnouncements': 'Mening e\\'lonlarim',\r\n    'announcements.allAnnouncements': 'Barcha e\\'lonlar',\r\n    'announcements.noNew': 'Yangi e\\'lonlar yo\\'q',\r\n    'announcements.new': 'Yangi',\r\n\r\n    // Meetings - Yig'ilishlar\r\n    'meetings.title': 'Aholining yig\\'ilishlari',\r\n    'meetings.subtitle': 'Yig\\'ilishlarni tashkil etish va o\\'tkazish',\r\n    'meetings.create': 'Yig\\'ilish chaqirish',\r\n    'meetings.noMeetings': 'Yig\\'ilishlar hali yo\\'q',\r\n    'meetings.createFirst': 'Birinchi yig\\'ilishni yarating',\r\n\r\n    // Meeting statuses\r\n    'meetings.status.draft': 'Qoralama',\r\n    'meetings.status.pending_moderation': 'Moderatsiyada',\r\n    'meetings.status.schedule_poll_open': 'Sana tanlash',\r\n    'meetings.status.schedule_confirmed': 'Sana tasdiqlangan',\r\n    'meetings.status.voting_open': 'Ovoz berish',\r\n    'meetings.status.voting_closed': 'Ovoz berish yopildi',\r\n    'meetings.status.results_published': 'Natijalar e\\'lon qilindi',\r\n    'meetings.status.protocol_generated': 'Bayonnoma tayyor',\r\n    'meetings.status.protocol_approved': 'Bayonnoma tasdiqlangan',\r\n    'meetings.status.cancelled': 'Bekor qilindi',\r\n\r\n    // Meeting format\r\n    'meetings.format.online': 'Onlayn',\r\n    'meetings.format.offline': 'Yuzma-yuz',\r\n    'meetings.format.hybrid': 'Aralash',\r\n\r\n    // Meeting creation wizard\r\n    'meetings.wizard.step1': 'Yig\\'ilish turi',\r\n    'meetings.wizard.step2': 'Kun tartibi',\r\n    'meetings.wizard.step3': 'Sana va vaqt',\r\n    'meetings.wizard.step4': 'Nashr',\r\n    'meetings.wizard.organizerType': 'Tashkilotchi',\r\n    'meetings.wizard.organizerResident': 'Aholi (tashabbusi)',\r\n    'meetings.wizard.organizerManagement': 'Boshqaruv kompaniyasi',\r\n    'meetings.wizard.selectFormat': 'O\\'tkazish formati',\r\n    'meetings.wizard.selectAgenda': 'Kun tartibi savollarini tanlang',\r\n    'meetings.wizard.addCustomQuestion': 'O\\'z savolingizni qo\\'shing',\r\n    'meetings.wizard.questionTitle': 'Savol sarlavhasi',\r\n    'meetings.wizard.questionDescription': 'Tavsif',\r\n    'meetings.wizard.attachMaterials': 'Materiallarni biriktiring',\r\n    'meetings.wizard.threshold': 'Qabul qilish chegarasi',\r\n    'meetings.wizard.scheduleDatetime': 'Sana va vaqtning 3 variantini taklif qiling',\r\n    'meetings.wizard.autoGenerate': 'Avtomatik yaratish',\r\n    'meetings.wizard.location': 'O\\'tkazish joyi (yuzma-yuz/aralash uchun)',\r\n    'meetings.wizard.publish': 'Tashabbusni e\\'lon qilish',\r\n    'meetings.wizard.saveDraft': 'Qoralama saqlash',\r\n\r\n    // Schedule voting\r\n    'meetings.schedule.title': 'Qulay sanani tanlang',\r\n    'meetings.schedule.voteFor': 'Ovoz berish',\r\n    'meetings.schedule.yourVote': 'Sizning ovozingiz',\r\n    'meetings.schedule.votes': 'ovoz',\r\n    'meetings.schedule.endsAt': 'Ovoz berish tugaydi',\r\n    'meetings.schedule.confirmed': 'Sana tasdiqlangan',\r\n\r\n    // Agenda voting\r\n    'meetings.voting.title': 'Savollarga ovoz berish',\r\n    'meetings.voting.for': 'Yoqlab',\r\n    'meetings.voting.against': 'Qarshi',\r\n    'meetings.voting.abstain': 'Betaraf',\r\n    'meetings.voting.voted': 'Siz ovoz berdingiz',\r\n    'meetings.voting.notVoted': 'Siz hali ovoz bermadingiz',\r\n    'meetings.voting.changeVote': 'Ovozni o\\'zgartirish',\r\n    'meetings.voting.confirmVote': 'Ovozni tasdiqlash',\r\n    'meetings.voting.verifyIdentity': 'Shaxsingizni tasdiqlang',\r\n    'meetings.voting.enterOTP': 'SMS kodini kiriting',\r\n    'meetings.voting.sendOTP': 'Kod yuborish',\r\n    'meetings.voting.resendOTP': 'Qayta yuborish',\r\n    'meetings.voting.otpSent': 'Kod yuborildi',\r\n    'meetings.voting.otpInvalid': 'Kod noto\\'g\\'ri',\r\n    'meetings.voting.otpExpired': 'Kod muddati tugadi, yangi so\\'rang',\r\n\r\n    // Results\r\n    'meetings.results.title': 'Ovoz berish natijalari',\r\n    'meetings.results.approved': 'Qabul qilindi',\r\n    'meetings.results.rejected': 'Qabul qilinmadi',\r\n    'meetings.results.quorum': 'Kvorum',\r\n    'meetings.results.quorumReached': 'Kvorum yetdi',\r\n    'meetings.results.quorumNotReached': 'Kvorum yetmadi',\r\n    'meetings.results.participation': 'Ishtirok',\r\n    'meetings.results.votesFor': 'Yoqlab',\r\n    'meetings.results.votesAgainst': 'Qarshi',\r\n    'meetings.results.votesAbstain': 'Betaraf',\r\n    'meetings.results.threshold': 'Kerak',\r\n\r\n    // Protocol\r\n    'meetings.protocol.title': 'Yig\\'ilish bayonnomasi',\r\n    'meetings.protocol.generate': 'Bayonnoma yaratish',\r\n    'meetings.protocol.download': 'PDF yuklash',\r\n    'meetings.protocol.sign': 'Bayonnomani imzolash',\r\n    'meetings.protocol.signed': 'Bayonnoma imzolangan',\r\n    'meetings.protocol.signedBy': 'Imzolagan',\r\n\r\n    // Actions\r\n    'meetings.actions.approve': 'Tasdiqlash',\r\n    'meetings.actions.reject': 'Rad etish',\r\n    'meetings.actions.openVoting': 'Ovoz berishni ochish',\r\n    'meetings.actions.closeVoting': 'Ovoz berishni yopish',\r\n    'meetings.actions.publishResults': 'Natijalarni e\\'lon qilish',\r\n    'meetings.actions.cancel': 'Yig\\'ilishni bekor qilish',\r\n    'meetings.actions.viewDetails': 'Batafsil',\r\n    'meetings.actions.viewAgenda': 'Kun tartibi',\r\n    'meetings.actions.viewMaterials': 'Materiallar',\r\n\r\n    // Notifications\r\n    'meetings.notify.created': 'Yangi yig\\'ilish boshlandi',\r\n    'meetings.notify.scheduleVote': 'Qulay sanani tanlang',\r\n    'meetings.notify.scheduleConfirmed': 'Yig\\'ilish sanasi tasdiqlandi',\r\n    'meetings.notify.votingOpen': 'Ovoz berish ochildi',\r\n    'meetings.notify.votingReminder': 'Ovoz berishni unutmang',\r\n    'meetings.notify.resultsPublished': 'Yig\\'ilish natijalari e\\'lon qilindi',\r\n    'meetings.notify.protocolReady': 'Yig\\'ilish bayonnomasi tayyor',\r\n\r\n    // Settings\r\n    'meetings.settings.title': 'Yig\\'ilish sozlamalari',\r\n    'meetings.settings.votingUnit': 'Ovoz birligi',\r\n    'meetings.settings.votingUnitApartment': '1 kvartira = 1 ovoz',\r\n    'meetings.settings.votingUnitOwner': '1 egasi = 1 ovoz',\r\n    'meetings.settings.votingUnitShare': 'Ulush bo\\'yicha',\r\n    'meetings.settings.quorum': 'Kvorum (%)',\r\n    'meetings.settings.allowResidentInitiative': 'Aholi tashabbusiga ruxsat',\r\n    'meetings.settings.requireModeration': 'UK moderatsiyasi kerak',\r\n    'meetings.settings.requireOTP': 'SMS orqali tasdiqlash',\r\n    'meetings.settings.showIntermediateResults': 'Oraliq natijalarni ko\\'rsatish',\r\n\r\n    // Evidence\r\n    'meetings.evidence.title': 'Dalillar hisoboti',\r\n    'meetings.evidence.download': 'Hisobotni yuklash',\r\n    'meetings.evidence.totalVotes': 'Jami ovozlar',\r\n    'meetings.evidence.otpVerified': 'SMS orqali tasdiqlangan',\r\n    'meetings.evidence.uniqueVoters': 'Noyob ovoz beruvchilar',\r\n\r\n    // Login Page\r\n    'login.enterLogin': 'Login kiriting',\r\n    'login.enterPassword': 'Parol kiriting',\r\n    'login.mustAcceptTerms': 'Ommaviy oferta shartlarini qabul qilish kerak',\r\n    'login.wrongCredentials': 'Login yoki parol noto\\'g\\'ri',\r\n    'login.loginError': 'Kirishda xatolik',\r\n    'login.loading': 'Kirish...',\r\n    'login.agreeWith': 'Men shartlarga roziman',\r\n    'login.publicOffer': 'ommaviy oferta',\r\n    'login.acceptFirst': 'Avval ommaviy oferta shartlarini qabul qiling',\r\n    'login.offerTitle': 'Ommaviy oferta',\r\n    'login.scrollToAccept': 'Oferta shartlarini qabul qilish uchun hujjat oxirigacha aylantiring',\r\n    'login.documentRead': 'Siz hujjatni o\\'qidingiz',\r\n    'login.scrollDown': 'O\\'qish uchun pastga aylantiring',\r\n    'login.close': 'Yopish',\r\n    'login.accept': 'Qabul qilish',\r\n\r\n    // Roles\r\n    'role.admin': 'Administrator',\r\n    'role.manager': 'Menejer',\r\n    'role.department_head': 'Bo\\'lim boshlig\\'i',\r\n    'role.executor': 'Ijrochi',\r\n    'role.resident': 'Aholi',\r\n    'role.plumber': 'Santexnik',\r\n    'role.electrician': 'Elektrik',\r\n    'role.security': 'Qorovul',\r\n\r\n    // Buildings / CRM\r\n    'building.title': 'Binolar',\r\n    'building.add': 'Bino qo\\'shish',\r\n    'building.edit': 'Binoni tahrirlash',\r\n    'building.delete': 'Binoni o\\'chirish',\r\n    'building.address': 'Manzil',\r\n    'building.name': 'Nomi',\r\n    'building.floors': 'Qavatlar',\r\n    'building.entrances': 'Kirishlar',\r\n    'building.apartments': 'Kvartiralar',\r\n    'building.residents': 'Aholisi',\r\n    'building.noBuildings': 'Binolar hali yo\\'q',\r\n    'building.addFirst': 'Birinchi binoni qo\\'shing',\r\n\r\n    // Owners\r\n    'owner.title': 'Mulkdorlar',\r\n    'owner.add': 'Mulkdor qo\\'shish',\r\n    'owner.edit': 'Tahrirlash',\r\n    'owner.delete': 'O\\'chirish',\r\n    'owner.name': 'Mulkdor ismi',\r\n    'owner.phone': 'Telefon',\r\n    'owner.email': 'Email',\r\n    'owner.share': 'Mulk ulushi',\r\n    'owner.noOwners': 'Mulkdorlar hali yo\\'q',\r\n\r\n    // Personal Accounts\r\n    'account.title': 'Shaxsiy hisoblar',\r\n    'account.number': 'Hisob raqami',\r\n    'account.balance': 'Balans',\r\n    'account.debt': 'Qarz',\r\n    'account.lastPayment': 'Oxirgi to\\'lov',\r\n    'account.noAccounts': 'Hisoblar hali yo\\'q',\r\n\r\n    // Work Orders\r\n    'workorder.title': 'Ish buyruqlari',\r\n    'workorder.create': 'Buyruq yaratish',\r\n    'workorder.number': 'Buyruq raqami',\r\n    'workorder.status': 'Holat',\r\n    'workorder.executor': 'Ijrochi',\r\n    'workorder.deadline': 'Muddat',\r\n    'workorder.noWorkOrders': 'Buyruqlar hali yo\\'q',\r\n\r\n    // Activity Log\r\n    'activity.title': 'Faoliyat jurnali',\r\n    'activity.created': 'Yaratildi',\r\n    'activity.updated': 'Yangilandi',\r\n    'activity.deleted': 'O\\'chirildi',\r\n    'activity.login': 'Tizimga kirish',\r\n    'activity.logout': 'Tizimdan chiqish',\r\n    'activity.noActivity': 'Yozuvlar yo\\'q',\r\n    'activity.user': 'Foydalanuvchi',\r\n    'activity.action': 'Harakat',\r\n    'activity.timestamp': 'Vaqt',\r\n    'activity.details': 'Tafsilotlar',\r\n\r\n    // Monitoring\r\n    'monitoring.title': 'Tizim monitoringi',\r\n    'monitoring.health': 'Tizim holati',\r\n    'monitoring.uptime': 'Ishlash vaqti',\r\n    'monitoring.requests': 'So\\'rovlar',\r\n    'monitoring.errors': 'Xatolar',\r\n    'monitoring.latency': 'Kechikish',\r\n    'monitoring.healthy': 'Ishlayapti',\r\n    'monitoring.degraded': 'Sekinlashish',\r\n    'monitoring.down': 'Mavjud emas',\r\n\r\n    // Executor Stats\r\n    'stats.title': 'Statistika',\r\n    'stats.completed': 'Bajarilgan',\r\n    'stats.thisWeek': 'Bu hafta',\r\n    'stats.thisMonth': 'Bu oy',\r\n    'stats.rating': 'Reyting',\r\n    'stats.avgTime': 'O\\'rtacha vaqt',\r\n    'stats.noStats': 'Ko\\'rsatish uchun ma\\'lumot yo\\'q',\r\n\r\n    // Schedule\r\n    'schedule.title': 'Jadval',\r\n    'schedule.today': 'Bugun',\r\n    'schedule.tomorrow': 'Ertaga',\r\n    'schedule.thisWeek': 'Bu hafta',\r\n    'schedule.noSchedule': 'Rejalashtirilgan ishlar yo\\'q',\r\n    'schedule.addEvent': 'Voqea qo\\'shish',\r\n\r\n    // Chat\r\n    'chat.title': 'Chat',\r\n    'chat.support': 'Yordam',\r\n    'chat.newMessage': 'Yangi xabar',\r\n    'chat.typeMessage': 'Xabar yozing...',\r\n    'chat.send': 'Yuborish',\r\n    'chat.noMessages': 'Xabarlar yo\\'q',\r\n    'chat.startConversation': 'Suhbatni boshlang',\r\n\r\n    // Guest Access\r\n    'guest.title': 'Mehmon kirishi',\r\n    'guest.createCode': 'Kod yaratish',\r\n    'guest.validUntil': 'Amal qiladi',\r\n    'guest.usages': 'Foydalanishlar',\r\n    'guest.active': 'Faol',\r\n    'guest.expired': 'Muddati tugagan',\r\n    'guest.used': 'Ishlatilgan',\r\n    'guest.noGuests': 'Mehmon kodlari yo\\'q',\r\n    'guest.generate': 'QR-kod yaratish',\r\n    'guest.copyCode': 'Kodni nusxalash',\r\n    'guest.shareCode': 'Kodni ulashish',\r\n\r\n    // QR Scanner\r\n    'scanner.title': 'QR-kod skaneri',\r\n    'scanner.scan': 'Skanerlash',\r\n    'scanner.scanning': 'Skanerlanmoqda...',\r\n    'scanner.valid': 'Kod to\\'g\\'ri',\r\n    'scanner.invalid': 'Kod noto\\'g\\'ri',\r\n    'scanner.expired': 'Kod muddati tugagan',\r\n    'scanner.allow': 'O\\'tishga ruxsat',\r\n    'scanner.deny': 'O\\'tishni taqiqlash',\r\n\r\n    // Vehicles\r\n    'vehicle.title': 'Transport',\r\n    'vehicle.add': 'Transport qo\\'shish',\r\n    'vehicle.plate': 'Raqam',\r\n    'vehicle.brand': 'Marka',\r\n    'vehicle.model': 'Model',\r\n    'vehicle.color': 'Rang',\r\n    'vehicle.owner': 'Egasi',\r\n    'vehicle.noVehicles': 'Transport ro\\'yxatdan o\\'tmagan',\r\n    'vehicle.search': 'Raqam bo\\'yicha qidirish',\r\n\r\n    // Contract\r\n    'contract.title': 'Shartnoma',\r\n    'contract.number': 'Shartnoma raqami',\r\n    'contract.status': 'Holat',\r\n    'contract.signed': 'Imzolangan',\r\n    'contract.pending': 'Imzo kutilmoqda',\r\n    'contract.startDate': 'Boshlanish sanasi',\r\n    'contract.endDate': 'Tugash sanasi',\r\n    'contract.download': 'PDF yuklash',\r\n    'contract.sign': 'Imzolash',\r\n\r\n    // Profile\r\n    'profile.title': 'Mening profilim',\r\n    'profile.personalData': 'Shaxsiy ma\\'lumotlaringiz',\r\n    'profile.personalAccount': 'Shaxsiy hisob',\r\n    'profile.loginHint': 'Kirish logini',\r\n    'profile.cannotChange': 'O\\'zgartirib bo\\'lmaydi',\r\n    'profile.phone': 'Telefon',\r\n    'profile.notSpecified': 'Ko\\'rsatilmagan',\r\n    'profile.password': 'Parol',\r\n    'profile.currentPassword': 'Joriy parol',\r\n    'profile.newPassword': 'Yangi parol',\r\n    'profile.confirmPassword': 'Parolni tasdiqlang',\r\n    'profile.passwordChanged': 'Parol muvaffaqiyatli o\\'zgartirildi',\r\n    'profile.phoneSaved': 'Telefon saqlandi',\r\n\r\n    // Errors\r\n    'error.generic': 'Xatolik yuz berdi',\r\n    'error.network': 'Tarmoq xatosi',\r\n    'error.unauthorized': 'Avtorizatsiya talab qilinadi',\r\n    'error.forbidden': 'Kirish taqiqlangan',\r\n    'error.notFound': 'Topilmadi',\r\n    'error.tryAgain': 'Keyinroq urinib ko\\'ring',\r\n\r\n    // Confirmations\r\n    'confirm.delete': 'O\\'chirishni tasdiqlang',\r\n    'confirm.cancel': 'Bekor qilish',\r\n    'confirm.yes': 'Ha',\r\n    'confirm.no': 'Yo\\'q',\r\n    'confirm.sure': 'Ishonchingiz komilmi?',\r\n\r\n    // Time\r\n    'time.today': 'Bugun',\r\n    'time.yesterday': 'Kecha',\r\n    'time.daysAgo': 'kun oldin',\r\n    'time.hoursAgo': 'soat oldin',\r\n    'time.minutesAgo': 'daqiqa oldin',\r\n    'time.justNow': 'Hozirgina',\r\n  }\r\n};\r\n\r\nexport const useLanguageStore = create<LanguageState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      language: 'ru',\r\n      setLanguage: (lang) => set({ language: lang }),\r\n      t: (key) => {\r\n        const { language } = get();\r\n        return translations[language][key] || key;\r\n      },\r\n    }),\r\n    {\r\n      name: 'language-storage',\r\n    }\r\n  )\r\n);\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport type {\r\n  Meeting,\r\n  MeetingFormat,\r\n  MeetingOrganizerType,\r\n  AgendaItem,\r\n  VoteRecord,\r\n  VoteChoice,\r\n  MeetingProtocol,\r\n  OTPRecord,\r\n  VotingUnit,\r\n  BuildingMeetingSettings,\r\n} from '../types';\r\nimport {\r\n  meetingsFullApi,\r\n  meetingScheduleVotesApi,\r\n  meetingAgendaVotesApi,\r\n  meetingOtpApi,\r\n  meetingBuildingSettingsApi,\r\n  meetingVotingUnitsApi,\r\n  meetingEligibleVotersApi,\r\n} from '../services/api';\r\n\r\n// ============ Mappers: snake_case (API) <-> camelCase (Frontend) ============\r\n\r\nconst mapMeetingFromApi = (data: any): Meeting => {\r\n  // Helper to safely parse JSON or return as-is if already parsed\r\n  const parseJson = (value: any, defaultValue: any = []) => {\r\n    if (value === null || value === undefined) return defaultValue;\r\n    if (typeof value === 'string') {\r\n      try { return JSON.parse(value); } catch { return defaultValue; }\r\n    }\r\n    return value; // Already an object/array\r\n  };\r\n\r\n  // Map agenda items from snake_case to camelCase\r\n  const mapAgendaItem = (item: any) => ({\r\n    id: item.id,\r\n    type: item.type,\r\n    title: item.title,\r\n    description: item.description,\r\n    threshold: item.threshold,\r\n    votesFor: item.votes_for_area || item.votesFor || 0,\r\n    votesAgainst: item.votes_against_area || item.votesAgainst || 0,\r\n    votesAbstain: item.votes_abstain_area || item.votesAbstain || 0,\r\n    order: item.item_order || item.order || 0,\r\n    isApproved: item.is_approved,\r\n    decision: item.decision,\r\n    materials: parseJson(item.materials, []),\r\n  });\r\n\r\n  // Map schedule options from snake_case to camelCase\r\n  const mapScheduleOption = (opt: any) => ({\r\n    id: opt.id,\r\n    dateTime: opt.date_time || opt.dateTime,\r\n    votesByShare: opt.vote_weight || opt.voteWeight || opt.votes_by_share || opt.votesByShare || 0,\r\n    voteWeight: opt.vote_weight || opt.voteWeight || 0,\r\n    voteCount: opt.vote_count || opt.voteCount || (opt.votes?.length ?? 0),\r\n    voters: opt.voters || [],\r\n    votes: opt.votes || opt.voters || [], // For backward compatibility with UI\r\n  });\r\n\r\n  return {\r\n    id: data.id,\r\n    number: data.number,\r\n    buildingId: data.building_id || data.buildingId,\r\n    buildingAddress: data.building_address || data.buildingAddress,\r\n    organizerType: data.organizer_type || data.organizerType,\r\n    organizerId: data.organizer_id || data.organizerId,\r\n    organizerName: data.organizer_name || data.organizerName,\r\n    format: data.format,\r\n    status: data.status,\r\n    scheduleOptions: parseJson(data.schedule_options || data.scheduleOptions, []).map(mapScheduleOption),\r\n    schedulePollEndsAt: data.schedule_poll_ends_at || data.schedulePollEndsAt,\r\n    confirmedDateTime: data.confirmed_date_time || data.confirmedDateTime,\r\n    location: data.location,\r\n    agendaItems: (data.agendaItems || parseJson(data.agenda_items, [])).map(mapAgendaItem),\r\n    materials: parseJson(data.materials, []),\r\n    votingSettings: parseJson(data.voting_settings || data.votingSettings, {}),\r\n    eligibleVoters: parseJson(data.eligible_voters || data.eligibleVoters, []),\r\n    totalEligibleCount: data.total_eligible_count || data.totalEligibleCount || 0,\r\n    participatedVoters: parseJson(data.participated_voters || data.participatedVoters, []),\r\n    quorumReached: Boolean(data.quorum_reached || data.quorumReached),\r\n    participationPercent: data.participation_percent || data.participationPercent || 0,\r\n    moderatedAt: data.moderated_at || data.moderatedAt,\r\n    moderationComment: data.moderation_comment || data.moderationComment,\r\n    schedulePollOpenedAt: data.schedule_poll_opened_at || data.schedulePollOpenedAt,\r\n    scheduleConfirmedAt: data.schedule_confirmed_at || data.scheduleConfirmedAt,\r\n    votingOpenedAt: data.voting_opened_at || data.votingOpenedAt,\r\n    votingClosedAt: data.voting_closed_at || data.votingClosedAt,\r\n    resultsPublishedAt: data.results_published_at || data.resultsPublishedAt,\r\n    protocolId: data.protocol_id || data.protocolId,\r\n    protocolGeneratedAt: data.protocol_generated_at || data.protocolGeneratedAt,\r\n    protocolApprovedAt: data.protocol_approved_at || data.protocolApprovedAt,\r\n    cancelledAt: data.cancelled_at || data.cancelledAt,\r\n    cancellationReason: data.cancellation_reason || data.cancellationReason,\r\n    remindersSent: parseJson(data.reminders_sent || data.remindersSent, []),\r\n    notificationLogs: parseJson(data.notification_logs || data.notificationLogs, []),\r\n    createdAt: data.created_at || data.createdAt,\r\n  };\r\n};\r\n\r\ninterface VoteRecordApiData {\r\n  id: string;\r\n  meeting_id: string;\r\n  agenda_item_id: string;\r\n  voter_id: string;\r\n  voter_name: string;\r\n  apartment_id?: string;\r\n  apartment_number?: string;\r\n  ownership_share?: number;\r\n  choice: VoteChoice;\r\n  verification_method: VoteRecord['verificationMethod'];\r\n  otp_verified: number;\r\n  voted_at: string;\r\n  vote_hash: string;\r\n  is_revote: number;\r\n  previous_vote_id?: string;\r\n}\r\n\r\nconst mapVoteRecordFromApi = (data: VoteRecordApiData): VoteRecord => ({\r\n  id: data.id,\r\n  meetingId: data.meeting_id,\r\n  agendaItemId: data.agenda_item_id,\r\n  voterId: data.voter_id,\r\n  voterName: data.voter_name,\r\n  apartmentId: data.apartment_id,\r\n  apartmentNumber: data.apartment_number,\r\n  ownershipShare: data.ownership_share,\r\n  choice: data.choice,\r\n  verificationMethod: data.verification_method,\r\n  otpVerified: Boolean(data.otp_verified),\r\n  votedAt: data.voted_at,\r\n  voteHash: data.vote_hash,\r\n  isRevote: Boolean(data.is_revote),\r\n  previousVoteId: data.previous_vote_id,\r\n});\r\n\r\ninterface ProtocolApiData {\r\n  id: string;\r\n  meeting_id: string;\r\n  number: string;\r\n  generated_at: string;\r\n  content: string;\r\n  protocol_hash: string;\r\n  signed_by_uk_user_id?: string;\r\n  signed_by_uk_name?: string;\r\n  signed_by_uk_role?: string;\r\n  signed_by_uk_at?: string;\r\n  signed_by_uk_hash?: string;\r\n  attachments: string;\r\n}\r\n\r\nconst mapProtocolFromApi = (data: ProtocolApiData): MeetingProtocol => ({\r\n  id: data.id,\r\n  meetingId: data.meeting_id,\r\n  number: data.number,\r\n  generatedAt: data.generated_at,\r\n  content: data.content,\r\n  protocolHash: data.protocol_hash,\r\n  signedByUK: data.signed_by_uk_user_id ? {\r\n    userId: data.signed_by_uk_user_id,\r\n    name: data.signed_by_uk_name || '',\r\n    role: data.signed_by_uk_role || '',\r\n    signedAt: data.signed_by_uk_at || '',\r\n    signatureHash: data.signed_by_uk_hash || '',\r\n  } : undefined,\r\n  attachments: JSON.parse(data.attachments || '[]'),\r\n});\r\n\r\ninterface OTPRecordApiData {\r\n  id: string;\r\n  user_id: string;\r\n  phone: string;\r\n  code: string;\r\n  purpose: OTPRecord['purpose'];\r\n  meeting_id?: string;\r\n  agenda_item_id?: string;\r\n  attempts: number;\r\n  max_attempts: number;\r\n  created_at: string;\r\n  expires_at: string;\r\n  is_used: number;\r\n  verified_at?: string;\r\n}\r\n\r\nconst mapOTPRecordFromApi = (data: OTPRecordApiData): OTPRecord => ({\r\n  id: data.id,\r\n  userId: data.user_id,\r\n  phone: data.phone,\r\n  code: data.code,\r\n  purpose: data.purpose,\r\n  meetingId: data.meeting_id,\r\n  agendaItemId: data.agenda_item_id,\r\n  attempts: data.attempts,\r\n  maxAttempts: data.max_attempts,\r\n  createdAt: data.created_at,\r\n  expiresAt: data.expires_at,\r\n  isUsed: Boolean(data.is_used),\r\n  verifiedAt: data.verified_at,\r\n});\r\n\r\ninterface VotingUnitApiData {\r\n  id: string;\r\n  building_id: string;\r\n  apartment_id?: string;\r\n  apartment_number: string;\r\n  total_area: number;\r\n  ownership_share: number;\r\n  owner_id: string;\r\n  owner_name: string;\r\n  co_owner_ids: string;\r\n  is_verified: number;\r\n  verified_at?: string;\r\n  verified_by?: string;\r\n}\r\n\r\nconst mapVotingUnitFromApi = (data: VotingUnitApiData): VotingUnit => ({\r\n  id: data.id,\r\n  buildingId: data.building_id,\r\n  apartmentId: data.apartment_id,\r\n  apartmentNumber: data.apartment_number,\r\n  totalArea: data.total_area,\r\n  ownershipShare: data.ownership_share,\r\n  ownerId: data.owner_id,\r\n  ownerName: data.owner_name,\r\n  coOwnerIds: JSON.parse(data.co_owner_ids || '[]'),\r\n  isVerified: Boolean(data.is_verified),\r\n  verifiedAt: data.verified_at,\r\n  verifiedBy: data.verified_by,\r\n});\r\n\r\ninterface BuildingSettingsApiData {\r\n  id: string;\r\n  building_id: string;\r\n  voting_unit: BuildingMeetingSettings['votingUnit'];\r\n  default_quorum_percent: number;\r\n  schedule_poll_duration_days: number;\r\n  voting_duration_hours: number;\r\n  allow_resident_initiative: number;\r\n  require_moderation: number;\r\n  default_meeting_time: string;\r\n  reminder_hours_before: string;\r\n  notification_channels: string;\r\n}\r\n\r\nconst mapBuildingSettingsFromApi = (data: BuildingSettingsApiData): BuildingMeetingSettings => ({\r\n  buildingId: data.building_id,\r\n  votingUnit: data.voting_unit,\r\n  defaultQuorumPercent: data.default_quorum_percent,\r\n  schedulePollDurationDays: data.schedule_poll_duration_days,\r\n  votingDurationHours: data.voting_duration_hours,\r\n  allowResidentInitiative: Boolean(data.allow_resident_initiative),\r\n  requireModeration: Boolean(data.require_moderation),\r\n  defaultMeetingTime: data.default_meeting_time,\r\n  reminderHoursBefore: JSON.parse(data.reminder_hours_before || '[48, 2]'),\r\n  notificationChannels: JSON.parse(data.notification_channels || '[\"in_app\", \"push\"]'),\r\n});\r\n\r\n// Default building meeting settings\r\nconst defaultBuildingSettings: Omit<BuildingMeetingSettings, 'buildingId'> = {\r\n  votingUnit: 'apartment',\r\n  defaultQuorumPercent: 50,\r\n  schedulePollDurationDays: 3,\r\n  votingDurationHours: 48,\r\n  allowResidentInitiative: true,\r\n  requireModeration: true,\r\n  defaultMeetingTime: '19:00',\r\n  reminderHoursBefore: [48, 2],\r\n  notificationChannels: ['in_app', 'push'],\r\n};\r\n\r\n// ============ Store Interface ============\r\n\r\ninterface MeetingState {\r\n  meetings: Meeting[];\r\n  voteRecords: VoteRecord[];\r\n  protocols: MeetingProtocol[];\r\n  otpRecords: OTPRecord[];\r\n  votingUnits: VotingUnit[];\r\n  buildingSettings: BuildingMeetingSettings[];\r\n  loading: boolean;\r\n  error: string | null;\r\n\r\n  // Data fetching\r\n  fetchMeetings: () => Promise<void>;\r\n  fetchMeetingsByBuilding: (buildingId: string) => Promise<void>;\r\n  fetchVotingUnitsByBuilding: (buildingId: string) => Promise<void>;\r\n\r\n  // Meeting CRUD\r\n  createMeeting: (data: {\r\n    buildingId: string;\r\n    buildingAddress: string;\r\n    organizerType: MeetingOrganizerType;\r\n    organizerId: string;\r\n    organizerName: string;\r\n    format: MeetingFormat;\r\n    agendaItems: Omit<AgendaItem, 'id' | 'votesFor' | 'votesAgainst' | 'votesAbstain' | 'order'>[];\r\n    location?: string;\r\n    description?: string;\r\n  }) => Promise<Meeting>;\r\n\r\n  updateMeeting: (id: string, data: Partial<Meeting>) => Promise<void>;\r\n  deleteMeeting: (id: string) => Promise<void>;\r\n  getMeeting: (id: string) => Meeting | undefined;\r\n  getMeetingsByBuilding: (buildingId: string) => Meeting[];\r\n  getMeetingsByOrganizer: (organizerId: string) => Meeting[];\r\n  getActiveMeetingsForResident: (userId: string) => Meeting[];\r\n\r\n  // Status transitions (state machine)\r\n  submitForModeration: (meetingId: string) => Promise<void>;\r\n  approveMeeting: (meetingId: string) => Promise<void>;\r\n  rejectMeeting: (meetingId: string, reason: string) => Promise<void>;\r\n  openSchedulePoll: (meetingId: string) => Promise<void>;\r\n  confirmSchedule: (meetingId: string, selectedOptionId?: string) => Promise<void>;\r\n  openVoting: (meetingId: string) => Promise<void>;\r\n  closeVoting: (meetingId: string) => Promise<void>;\r\n  publishResults: (meetingId: string) => Promise<void>;\r\n  generateProtocol: (meetingId: string) => Promise<MeetingProtocol>;\r\n  approveProtocol: (meetingId: string) => Promise<void>;\r\n  cancelMeeting: (meetingId: string, reason: string) => Promise<void>;\r\n\r\n  // Schedule voting\r\n  voteForSchedule: (meetingId: string, optionId: string) => Promise<{ success: boolean; error?: string }>;\r\n  getScheduleVoteByUser: (meetingId: string) => Promise<string | null>;\r\n\r\n  // Agenda voting\r\n  voteOnAgendaItem: (\r\n    meetingId: string,\r\n    agendaItemId: string,\r\n    voterId: string,\r\n    voterName: string,\r\n    choice: VoteChoice,\r\n    verificationData: {\r\n      method: VoteRecord['verificationMethod'];\r\n      otpVerified: boolean;\r\n      apartmentId?: string;\r\n      apartmentNumber?: string;\r\n      ownershipShare?: number;\r\n    },\r\n    comment?: string // /  \r\n  ) => Promise<VoteRecord>;\r\n\r\n  getVoteByUser: (meetingId: string, agendaItemId: string, voterId: string) => VoteRecord | undefined;\r\n  getUserVotesForMeeting: (meetingId: string, voterId: string) => Promise<VoteRecord[]>;\r\n\r\n  // OTP Management\r\n  requestOTP: (userId: string, phone: string, purpose: OTPRecord['purpose'], meetingId?: string, agendaItemId?: string) => Promise<OTPRecord>;\r\n  verifyOTP: (otpId: string, code: string) => Promise<boolean>;\r\n  getActiveOTP: (userId: string, purpose: OTPRecord['purpose']) => OTPRecord | undefined;\r\n\r\n  // Results calculation (local, based on cached data)\r\n  calculateAgendaItemResult: (meetingId: string, agendaItemId: string) => {\r\n    votesFor: number;\r\n    votesAgainst: number;\r\n    votesAbstain: number;\r\n    totalVotes: number;\r\n    percentFor: number;\r\n    isApproved: boolean;\r\n    thresholdMet: boolean;\r\n  };\r\n\r\n  calculateMeetingQuorum: (meetingId: string) => {\r\n    participated: number;\r\n    total: number;\r\n    percent: number;\r\n    quorumReached: boolean;\r\n  };\r\n\r\n  // Building settings\r\n  getBuildingSettings: (buildingId: string) => BuildingMeetingSettings;\r\n  fetchBuildingSettings: (buildingId: string) => Promise<BuildingMeetingSettings>;\r\n  updateBuildingSettings: (buildingId: string, settings: Partial<BuildingMeetingSettings>) => Promise<void>;\r\n\r\n  // Voting units (apartments)\r\n  addVotingUnit: (unit: Omit<VotingUnit, 'id'>) => Promise<VotingUnit>;\r\n  updateVotingUnit: (id: string, data: Partial<VotingUnit>) => Promise<void>;\r\n  getVotingUnitsByBuilding: (buildingId: string) => VotingUnit[];\r\n  getVotingUnitByOwner: (ownerId: string) => VotingUnit | undefined;\r\n  verifyVotingUnit: (id: string, verifiedBy: string) => Promise<void>;\r\n\r\n  // Eligible voters\r\n  setEligibleVoters: (meetingId: string, voterIds: string[], totalCount: number) => Promise<void>;\r\n\r\n  // Audit & Evidence\r\n  getVoteRecordsForMeeting: (meetingId: string) => VoteRecord[];\r\n  fetchVoteRecordsForMeeting: (meetingId: string) => Promise<VoteRecord[]>;\r\n  generateEvidenceReport: (meetingId: string) => {\r\n    meeting: Meeting;\r\n    votes: VoteRecord[];\r\n    protocol?: MeetingProtocol;\r\n    verificationSummary: {\r\n      totalVotes: number;\r\n      otpVerified: number;\r\n      uniqueVoters: number;\r\n    };\r\n  };\r\n}\r\n\r\n// ============ Store Implementation ============\r\n\r\nexport const useMeetingStore = create<MeetingState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      meetings: [],\r\n      voteRecords: [],\r\n      protocols: [],\r\n      otpRecords: [],\r\n      votingUnits: [],\r\n      buildingSettings: [],\r\n      loading: false,\r\n      error: null,\r\n\r\n      // ========== Data Fetching ==========\r\n\r\n      fetchMeetings: async () => {\r\n        set({ loading: true, error: null });\r\n        try {\r\n          //  OPTIMIZED: Fetch only active meetings (reduces payload by ~90%)\r\n          const response = await meetingsFullApi.getAll({ onlyActive: true });\r\n          if (response.success && response.data) {\r\n            const meetings = Array.isArray(response.data) ? response.data.map(mapMeetingFromApi) : [];\r\n            set({ meetings, loading: false });\r\n          } else {\r\n            set({ error: response.error || 'Failed to fetch meetings', loading: false });\r\n          }\r\n        } catch (error) {\r\n          set({ error: 'Network error', loading: false });\r\n        }\r\n      },\r\n\r\n      fetchMeetingsByBuilding: async (buildingId) => {\r\n        set({ loading: true, error: null });\r\n        try {\r\n          const response = await meetingsFullApi.getAll({ buildingId });\r\n          if (response.success && response.data) {\r\n            const newMeetings = Array.isArray(response.data) ? response.data.map(mapMeetingFromApi) : [];\r\n            set((state) => {\r\n              // Update only meetings for this building\r\n              const otherMeetings = state.meetings.filter(m => m.buildingId !== buildingId);\r\n              return { meetings: [...otherMeetings, ...newMeetings], loading: false };\r\n            });\r\n          } else {\r\n            set({ error: response.error || 'Failed to fetch meetings', loading: false });\r\n          }\r\n        } catch (error) {\r\n          set({ error: 'Network error', loading: false });\r\n        }\r\n      },\r\n\r\n      fetchVotingUnitsByBuilding: async (buildingId) => {\r\n        try {\r\n          const response = await meetingVotingUnitsApi.getByBuilding(buildingId);\r\n          if (response.success && response.data) {\r\n            const newUnits = Array.isArray(response.data) ? response.data.map(mapVotingUnitFromApi) : [];\r\n            set((state) => {\r\n              const otherUnits = state.votingUnits.filter(u => u.buildingId !== buildingId);\r\n              return { votingUnits: [...otherUnits, ...newUnits] };\r\n            });\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to fetch voting units:', error);\r\n        }\r\n      },\r\n\r\n      // ========== Meeting CRUD ==========\r\n\r\n      createMeeting: async (data) => {\r\n        set({ loading: true, error: null });\r\n        try {\r\n          const response = await meetingsFullApi.create({\r\n            buildingId: data.buildingId,\r\n            buildingAddress: data.buildingAddress,\r\n            organizerType: data.organizerType === 'management' ? 'uk' : data.organizerType,\r\n            format: data.format,\r\n            location: data.location,\r\n            description: data.description,\r\n            agendaItems: data.agendaItems.map(item => ({\r\n              title: item.title,\r\n              description: item.description,\r\n              threshold: item.threshold,\r\n            })),\r\n          });\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({ meetings: [...state.meetings, meeting], loading: false }));\r\n            return meeting;\r\n          } else {\r\n            set({ error: response.error || 'Failed to create meeting', loading: false });\r\n            throw new Error(response.error || 'Failed to create meeting');\r\n          }\r\n        } catch (error) {\r\n          set({ error: 'Network error', loading: false });\r\n          throw error;\r\n        }\r\n      },\r\n\r\n      updateMeeting: async (id, data) => {\r\n        set({ loading: true, error: null });\r\n        try {\r\n          // Convert camelCase to snake_case for API\r\n          const apiData: Record<string, unknown> = {};\r\n          if (data.location !== undefined) apiData.location = data.location;\r\n          if (data.agendaItems !== undefined) apiData.agenda_items = JSON.stringify(data.agendaItems);\r\n          if (data.materials !== undefined) apiData.materials = JSON.stringify(data.materials);\r\n          if (data.votingSettings !== undefined) apiData.voting_settings = JSON.stringify(data.votingSettings);\r\n\r\n          const response = await meetingsFullApi.update(id, apiData);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === id ? meeting : m),\r\n              loading: false\r\n            }));\r\n          } else {\r\n            set({ error: response.error || 'Failed to update meeting', loading: false });\r\n          }\r\n        } catch (error) {\r\n          set({ error: 'Network error', loading: false });\r\n        }\r\n      },\r\n\r\n      deleteMeeting: async (id) => {\r\n        set({ loading: true, error: null });\r\n        try {\r\n          await meetingsFullApi.delete(id);\r\n          set((state) => ({\r\n            meetings: state.meetings.filter(m => m.id !== id),\r\n            voteRecords: state.voteRecords.filter(v => v.meetingId !== id),\r\n            loading: false\r\n          }));\r\n        } catch (error) {\r\n          set({ error: 'Network error', loading: false });\r\n        }\r\n      },\r\n\r\n      getMeeting: (id) => {\r\n        return get().meetings.find(m => m.id === id);\r\n      },\r\n\r\n      getMeetingsByBuilding: (buildingId) => {\r\n        return get().meetings.filter(m => m.buildingId === buildingId);\r\n      },\r\n\r\n      getMeetingsByOrganizer: (organizerId) => {\r\n        return get().meetings.filter(m => m.organizerId === organizerId);\r\n      },\r\n\r\n      getActiveMeetingsForResident: (userId) => {\r\n        return get().meetings.filter(m => {\r\n          // Check status first\r\n          if (!['schedule_poll_open', 'schedule_confirmed', 'voting_open'].includes(m.status)) {\r\n            return false;\r\n          }\r\n\r\n          // If eligibleVoters is empty, it means all residents of the building are eligible (general meeting)\r\n          // In this case, we can't filter by eligibleVoters, so we just show all active meetings\r\n          if (m.eligibleVoters.length === 0) {\r\n            return true;\r\n          }\r\n\r\n          // If eligibleVoters has entries, check if user is in the list\r\n          return m.eligibleVoters.includes(userId);\r\n        });\r\n      },\r\n\r\n      // ========== Status Transitions ==========\r\n\r\n      submitForModeration: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.submit(meetingId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to submit for moderation:', error);\r\n        }\r\n      },\r\n\r\n      approveMeeting: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.approve(meetingId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to approve meeting:', error);\r\n        }\r\n      },\r\n\r\n      rejectMeeting: async (meetingId, reason) => {\r\n        try {\r\n          const response = await meetingsFullApi.reject(meetingId, reason);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to reject meeting:', error);\r\n        }\r\n      },\r\n\r\n      openSchedulePoll: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.openSchedulePoll(meetingId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to open schedule poll:', error);\r\n        }\r\n      },\r\n\r\n      confirmSchedule: async (meetingId, selectedOptionId) => {\r\n        try {\r\n          const response = await meetingsFullApi.confirmSchedule(meetingId, selectedOptionId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to confirm schedule:', error);\r\n        }\r\n      },\r\n\r\n      openVoting: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.openVoting(meetingId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to open voting:', error);\r\n        }\r\n      },\r\n\r\n      closeVoting: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.closeVoting(meetingId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to close voting:', error);\r\n        }\r\n      },\r\n\r\n      publishResults: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.publishResults(meetingId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to publish results:', error);\r\n        }\r\n      },\r\n\r\n      generateProtocol: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.generateProtocol(meetingId);\r\n          if (response.success && response.data) {\r\n            const protocol = mapProtocolFromApi(response.data);\r\n            set((state) => ({\r\n              protocols: [...state.protocols, protocol]\r\n            }));\r\n            return protocol;\r\n          }\r\n          throw new Error('Failed to generate protocol');\r\n        } catch (error) {\r\n          console.error('Failed to generate protocol:', error);\r\n          throw error;\r\n        }\r\n      },\r\n\r\n      approveProtocol: async (meetingId) => {\r\n        try {\r\n          const response = await meetingsFullApi.approveProtocol(meetingId);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to approve protocol:', error);\r\n        }\r\n      },\r\n\r\n      cancelMeeting: async (meetingId, reason) => {\r\n        try {\r\n          const response = await meetingsFullApi.cancel(meetingId, reason);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to cancel meeting:', error);\r\n        }\r\n      },\r\n\r\n      // ========== Schedule Voting ==========\r\n\r\n      voteForSchedule: async (meetingId, optionId) => {\r\n        try {\r\n          const response = await meetingScheduleVotesApi.vote(meetingId, optionId);\r\n          if (response.success) {\r\n            // Refetch meetings to get accurate vote counts from server\r\n            await get().fetchMeetings();\r\n          }\r\n          return { success: true };\r\n        } catch (error: any) {\r\n          console.error('Failed to vote for schedule:', error);\r\n          const errorMessage = error?.message || '  .     .';\r\n          return { success: false, error: errorMessage };\r\n        }\r\n      },\r\n\r\n      getScheduleVoteByUser: async (meetingId) => {\r\n        try {\r\n          const response = await meetingScheduleVotesApi.getMyVote(meetingId);\r\n          if (response.success && response.data) {\r\n            return response.data.optionId || null;\r\n          }\r\n          return null;\r\n        } catch (error) {\r\n          console.error('Failed to get schedule vote:', error);\r\n          return null;\r\n        }\r\n      },\r\n\r\n      // ========== Agenda Voting ==========\r\n\r\n      voteOnAgendaItem: async (meetingId, agendaItemId, voterId, voterName, choice, verificationData, comment) => {\r\n        try {\r\n          // Validate choice - API only accepts 'for', 'against', 'abstain'\r\n          if (choice === 'not_voted') {\r\n            throw new Error('Cannot submit \"not_voted\" as a vote choice');\r\n          }\r\n\r\n          // Map verification method to API format\r\n          const apiMethod = verificationData.method === 'otp' ? 'otp' :\r\n                           verificationData.method === 'in_person' ? 'in_person' :\r\n                           verificationData.method === 'proxy' ? 'proxy' : 'login';\r\n\r\n          const response = await meetingAgendaVotesApi.vote(meetingId, agendaItemId, {\r\n            voterId,\r\n            voterName,\r\n            choice: choice as 'for' | 'against' | 'abstain',\r\n            verificationMethod: apiMethod,\r\n            otpVerified: verificationData.otpVerified,\r\n            apartmentId: verificationData.apartmentId,\r\n            apartmentNumber: verificationData.apartmentNumber,\r\n            ownershipShare: verificationData.ownershipShare,\r\n            comment, //   \r\n          });\r\n\r\n          // Create a temporary vote record based on the response\r\n          const voteRecord: VoteRecord = {\r\n            id: crypto.randomUUID(),\r\n            meetingId,\r\n            agendaItemId,\r\n            voterId,\r\n            voterName,\r\n            choice,\r\n            verificationMethod: apiMethod,\r\n            otpVerified: verificationData.otpVerified,\r\n            apartmentId: verificationData.apartmentId,\r\n            apartmentNumber: verificationData.apartmentNumber,\r\n            ownershipShare: verificationData.ownershipShare,\r\n            votedAt: new Date().toISOString(),\r\n            voteHash: response.data?.voteHash || '',\r\n            isRevote: false,\r\n          };\r\n\r\n          set((state) => ({\r\n            voteRecords: [...state.voteRecords, voteRecord],\r\n            // Also update the meeting's participatedVoters list locally\r\n            meetings: state.meetings.map(m => {\r\n              if (m.id === meetingId && !m.participatedVoters.includes(voterId)) {\r\n                return {\r\n                  ...m,\r\n                  participatedVoters: [...m.participatedVoters, voterId]\r\n                };\r\n              }\r\n              return m;\r\n            })\r\n          }));\r\n\r\n          return voteRecord;\r\n        } catch (error) {\r\n          console.error('Failed to vote on agenda item:', error);\r\n          throw error;\r\n        }\r\n      },\r\n\r\n      getVoteByUser: (meetingId, agendaItemId, voterId) => {\r\n        return get().voteRecords\r\n          .filter(v => v.meetingId === meetingId && v.agendaItemId === agendaItemId && v.voterId === voterId)\r\n          .sort((a, b) => new Date(b.votedAt).getTime() - new Date(a.votedAt).getTime())[0];\r\n      },\r\n\r\n      getUserVotesForMeeting: async (meetingId: string) => {\r\n        try {\r\n          const response = await meetingAgendaVotesApi.getMyVotes(meetingId);\r\n          if (response.success && response.data) {\r\n            const votes = (response.data as any[]).map(mapVoteRecordFromApi);\r\n\r\n            // Update store with fetched votes (merge with existing, avoiding duplicates)\r\n            set((state) => {\r\n              const existingIds = new Set(state.voteRecords.map(v => v.id));\r\n              const newVotes = votes.filter(v => !existingIds.has(v.id));\r\n              return {\r\n                voteRecords: [...state.voteRecords, ...newVotes]\r\n              };\r\n            });\r\n\r\n            return votes;\r\n          }\r\n          return [];\r\n        } catch (error) {\r\n          console.error('Failed to get user votes:', error);\r\n          return [];\r\n        }\r\n      },\r\n\r\n      // ========== OTP Management ==========\r\n\r\n      requestOTP: async (userId, phone, purpose, meetingId, agendaItemId) => {\r\n        try {\r\n          // Map purpose to API format\r\n          const apiPurpose = purpose === 'meeting_vote' ? 'agenda_vote' : purpose;\r\n          const response = await meetingOtpApi.request({\r\n            userId, phone,\r\n            purpose: apiPurpose as 'schedule_vote' | 'agenda_vote' | 'protocol_sign',\r\n            meetingId, agendaItemId\r\n          });\r\n          if (response.success && response.data) {\r\n            const otpRecord = mapOTPRecordFromApi(response.data);\r\n            set((state) => ({ otpRecords: [...state.otpRecords, otpRecord] }));\r\n            return otpRecord;\r\n          }\r\n          throw new Error('Failed to request OTP');\r\n        } catch (error) {\r\n          console.error('Failed to request OTP:', error);\r\n          throw error;\r\n        }\r\n      },\r\n\r\n      verifyOTP: async (otpId, code) => {\r\n        try {\r\n          const response = await meetingOtpApi.verify(otpId, code);\r\n          if (response.success && response.data?.verified) {\r\n            set((state) => ({\r\n              otpRecords: state.otpRecords.map(o =>\r\n                o.id === otpId ? { ...o, isUsed: true, verifiedAt: new Date().toISOString() } : o\r\n              )\r\n            }));\r\n            return true;\r\n          }\r\n          // Update attempts on failed verify\r\n          set((state) => ({\r\n            otpRecords: state.otpRecords.map(o =>\r\n              o.id === otpId ? { ...o, attempts: o.attempts + 1 } : o\r\n            )\r\n          }));\r\n          return false;\r\n        } catch (error) {\r\n          console.error('Failed to verify OTP:', error);\r\n          return false;\r\n        }\r\n      },\r\n\r\n      getActiveOTP: (userId, purpose) => {\r\n        const now = new Date();\r\n        return get().otpRecords.find(\r\n          o =>\r\n            o.userId === userId &&\r\n            o.purpose === purpose &&\r\n            !o.isUsed &&\r\n            new Date(o.expiresAt) > now &&\r\n            o.attempts < o.maxAttempts\r\n        );\r\n      },\r\n\r\n      // ========== Results Calculation ==========\r\n\r\n      calculateAgendaItemResult: (meetingId, agendaItemId) => {\r\n        const meeting = get().getMeeting(meetingId);\r\n        if (!meeting) {\r\n          return {\r\n            votesFor: 0,\r\n            votesAgainst: 0,\r\n            votesAbstain: 0,\r\n            totalVotes: 0,\r\n            percentFor: 0,\r\n            isApproved: false,\r\n            thresholdMet: false,\r\n          };\r\n        }\r\n\r\n        const item = meeting.agendaItems.find(i => i.id === agendaItemId);\r\n        if (!item) {\r\n          return {\r\n            votesFor: 0,\r\n            votesAgainst: 0,\r\n            votesAbstain: 0,\r\n            totalVotes: 0,\r\n            percentFor: 0,\r\n            isApproved: false,\r\n            thresholdMet: false,\r\n          };\r\n        }\r\n\r\n        // votesFor/Against/Abstain are now numbers (area in sq.m), not arrays\r\n        const votesFor = typeof item.votesFor === 'number' ? item.votesFor : (item.votesFor as any)?.length || 0;\r\n        const votesAgainst = typeof item.votesAgainst === 'number' ? item.votesAgainst : (item.votesAgainst as any)?.length || 0;\r\n        const votesAbstain = typeof item.votesAbstain === 'number' ? item.votesAbstain : (item.votesAbstain as any)?.length || 0;\r\n        const totalVotes = votesFor + votesAgainst + votesAbstain;\r\n\r\n        const percentFor = totalVotes > 0 ? (votesFor / totalVotes) * 100 : 0;\r\n\r\n        const thresholdPercent = {\r\n          simple_majority: 50,\r\n          qualified_majority: 60,\r\n          two_thirds: 66.67,\r\n          three_quarters: 75,\r\n          unanimous: 100,\r\n        }[item.threshold];\r\n\r\n        const thresholdMet = percentFor > thresholdPercent;\r\n        const isApproved = thresholdMet && meeting.quorumReached;\r\n\r\n        return {\r\n          votesFor,\r\n          votesAgainst,\r\n          votesAbstain,\r\n          totalVotes,\r\n          percentFor,\r\n          isApproved,\r\n          thresholdMet,\r\n        };\r\n      },\r\n\r\n      calculateMeetingQuorum: (meetingId) => {\r\n        const meeting = get().getMeeting(meetingId);\r\n        if (!meeting) {\r\n          return { participated: 0, total: 0, percent: 0, quorumReached: false };\r\n        }\r\n\r\n        const participated = meeting.participatedVoters?.length || 0;\r\n        const total = meeting.totalEligibleCount || meeting.eligibleVoters?.length || 0;\r\n        const percent = total > 0 ? (participated / total) * 100 : 0;\r\n        // Use quorumReached from server if available, otherwise calculate from votingSettings\r\n        const quorumPercent = meeting.votingSettings?.quorumPercent || 50;\r\n        const quorumReached = meeting.quorumReached ?? (percent >= quorumPercent);\r\n\r\n        return { participated, total, percent, quorumReached };\r\n      },\r\n\r\n      // ========== Building Settings ==========\r\n\r\n      getBuildingSettings: (buildingId) => {\r\n        const existing = get().buildingSettings.find(s => s.buildingId === buildingId);\r\n        if (existing) return existing;\r\n        return { ...defaultBuildingSettings, buildingId };\r\n      },\r\n\r\n      fetchBuildingSettings: async (buildingId) => {\r\n        try {\r\n          const response = await meetingBuildingSettingsApi.get(buildingId);\r\n          if (response.success && response.data) {\r\n            const settings = mapBuildingSettingsFromApi(response.data);\r\n            set((state) => {\r\n              const existing = state.buildingSettings.find(s => s.buildingId === buildingId);\r\n              if (existing) {\r\n                return {\r\n                  buildingSettings: state.buildingSettings.map(s =>\r\n                    s.buildingId === buildingId ? settings : s\r\n                  )\r\n                };\r\n              }\r\n              return { buildingSettings: [...state.buildingSettings, settings] };\r\n            });\r\n            return settings;\r\n          }\r\n          return { ...defaultBuildingSettings, buildingId };\r\n        } catch (error) {\r\n          console.error('Failed to fetch building settings:', error);\r\n          return { ...defaultBuildingSettings, buildingId };\r\n        }\r\n      },\r\n\r\n      updateBuildingSettings: async (buildingId, settings) => {\r\n        try {\r\n          // Convert to API format\r\n          const apiData: Record<string, unknown> = {};\r\n          if (settings.votingUnit !== undefined) apiData.voting_unit = settings.votingUnit;\r\n          if (settings.defaultQuorumPercent !== undefined) apiData.default_quorum_percent = settings.defaultQuorumPercent;\r\n          if (settings.schedulePollDurationDays !== undefined) apiData.schedule_poll_duration_days = settings.schedulePollDurationDays;\r\n          if (settings.votingDurationHours !== undefined) apiData.voting_duration_hours = settings.votingDurationHours;\r\n          if (settings.allowResidentInitiative !== undefined) apiData.allow_resident_initiative = settings.allowResidentInitiative;\r\n          if (settings.requireModeration !== undefined) apiData.require_moderation = settings.requireModeration;\r\n          if (settings.defaultMeetingTime !== undefined) apiData.default_meeting_time = settings.defaultMeetingTime;\r\n          if (settings.reminderHoursBefore !== undefined) apiData.reminder_hours_before = JSON.stringify(settings.reminderHoursBefore);\r\n          if (settings.notificationChannels !== undefined) apiData.notification_channels = JSON.stringify(settings.notificationChannels);\r\n\r\n          const response = await meetingBuildingSettingsApi.update(buildingId, apiData);\r\n          if (response.success && response.data) {\r\n            const updatedSettings = mapBuildingSettingsFromApi(response.data);\r\n            set((state) => {\r\n              const existing = state.buildingSettings.find(s => s.buildingId === buildingId);\r\n              if (existing) {\r\n                return {\r\n                  buildingSettings: state.buildingSettings.map(s =>\r\n                    s.buildingId === buildingId ? updatedSettings : s\r\n                  )\r\n                };\r\n              }\r\n              return { buildingSettings: [...state.buildingSettings, updatedSettings] };\r\n            });\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to update building settings:', error);\r\n        }\r\n      },\r\n\r\n      // ========== Voting Units ==========\r\n\r\n      addVotingUnit: async (unit) => {\r\n        try {\r\n          // API already handles camelCase -> snake_case conversion\r\n          const response = await meetingVotingUnitsApi.create({\r\n            buildingId: unit.buildingId,\r\n            apartmentId: unit.apartmentId,\r\n            apartmentNumber: unit.apartmentNumber,\r\n            totalArea: unit.totalArea,\r\n            ownershipShare: unit.ownershipShare,\r\n            ownerId: unit.ownerId,\r\n            ownerName: unit.ownerName,\r\n            coOwnerIds: unit.coOwnerIds || [],\r\n          });\r\n          if (response.success && response.data) {\r\n            const votingUnit = mapVotingUnitFromApi(response.data);\r\n            set((state) => ({ votingUnits: [...state.votingUnits, votingUnit] }));\r\n            return votingUnit;\r\n          }\r\n          throw new Error('Failed to create voting unit');\r\n        } catch (error) {\r\n          console.error('Failed to add voting unit:', error);\r\n          throw error;\r\n        }\r\n      },\r\n\r\n      updateVotingUnit: async (id, data) => {\r\n        // This would require a PATCH endpoint - for now, use local update\r\n        set((state) => ({\r\n          votingUnits: state.votingUnits.map(u => u.id === id ? { ...u, ...data } : u)\r\n        }));\r\n      },\r\n\r\n      getVotingUnitsByBuilding: (buildingId) => {\r\n        return get().votingUnits.filter(u => u.buildingId === buildingId);\r\n      },\r\n\r\n      getVotingUnitByOwner: (ownerId) => {\r\n        return get().votingUnits.find(\r\n          u => u.ownerId === ownerId || u.coOwnerIds?.includes(ownerId)\r\n        );\r\n      },\r\n\r\n      verifyVotingUnit: async (id, verifiedBy) => {\r\n        try {\r\n          const response = await meetingVotingUnitsApi.verify(id, verifiedBy);\r\n          if (response.success && response.data) {\r\n            const votingUnit = mapVotingUnitFromApi(response.data);\r\n            set((state) => ({\r\n              votingUnits: state.votingUnits.map(u => u.id === id ? votingUnit : u)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to verify voting unit:', error);\r\n        }\r\n      },\r\n\r\n      // ========== Eligible Voters ==========\r\n\r\n      setEligibleVoters: async (meetingId, voterIds, totalCount) => {\r\n        try {\r\n          const response = await meetingEligibleVotersApi.set(meetingId, voterIds, totalCount);\r\n          if (response.success && response.data) {\r\n            const meeting = mapMeetingFromApi(response.data);\r\n            set((state) => ({\r\n              meetings: state.meetings.map(m => m.id === meetingId ? meeting : m)\r\n            }));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to set eligible voters:', error);\r\n        }\r\n      },\r\n\r\n      // ========== Audit & Evidence ==========\r\n\r\n      getVoteRecordsForMeeting: (meetingId) => {\r\n        return get().voteRecords.filter(v => v.meetingId === meetingId);\r\n      },\r\n\r\n      fetchVoteRecordsForMeeting: async (meetingId) => {\r\n        try {\r\n          const response = await meetingAgendaVotesApi.getVoteRecords(meetingId);\r\n          if (response.success && response.data) {\r\n            const dataArray = Array.isArray(response.data) ? response.data : [];\r\n            const records = dataArray.map(mapVoteRecordFromApi);\r\n            // Merge with existing records\r\n            set((state) => {\r\n              const otherRecords = state.voteRecords.filter(v => v.meetingId !== meetingId);\r\n              return { voteRecords: [...otherRecords, ...records] };\r\n            });\r\n            return records;\r\n          }\r\n          return [];\r\n        } catch (error) {\r\n          console.error('Failed to fetch vote records:', error);\r\n          return [];\r\n        }\r\n      },\r\n\r\n      generateEvidenceReport: (meetingId) => {\r\n        const meeting = get().getMeeting(meetingId);\r\n        if (!meeting) throw new Error('Meeting not found');\r\n\r\n        const votes = get().getVoteRecordsForMeeting(meetingId);\r\n        const protocol = get().protocols.find(p => p.meetingId === meetingId);\r\n\r\n        const uniqueVoters = new Set(votes.map(v => v.voterId)).size;\r\n        const otpVerified = votes.filter(v => v.otpVerified).length;\r\n\r\n        return {\r\n          meeting,\r\n          votes,\r\n          protocol,\r\n          verificationSummary: {\r\n            totalVotes: votes.length,\r\n            otpVerified,\r\n            uniqueVoters,\r\n          },\r\n        };\r\n      },\r\n    }),\r\n    {\r\n      name: 'uk-meeting-storage',\r\n      partialize: (state) => ({\r\n        // Only persist locally cached data for offline support\r\n        otpRecords: state.otpRecords,\r\n        buildingSettings: state.buildingSettings,\r\n      }),\r\n    }\r\n  )\r\n);\r\n","interface AppLogoProps {\r\n  size?: 'sm' | 'md' | 'lg' | 'xl';\r\n}\r\n\r\nexport function AppLogo({ size = 'md' }: AppLogoProps) {\r\n  const sizeClasses = {\r\n    sm: 'w-8 h-8',\r\n    md: 'w-10 h-10',\r\n    lg: 'w-12 h-12',\r\n    xl: 'w-16 h-16 md:w-20 md:h-20'\r\n  };\r\n\r\n  return (\r\n    <img\r\n      src=\"/favicon.svg\"\r\n      alt=\"Kamizo\"\r\n      className={`${sizeClasses[size]} object-contain`}\r\n    />\r\n  );\r\n}\r\n","import { Link, useLocation } from 'react-router-dom';\r\nimport { useMemo, useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  LayoutDashboard, FileText, Users, Wrench, Building2, Settings,\r\n  LogOut, User, Home, Shield, BarChart3,\r\n  Megaphone, Vote, GraduationCap,\r\n  CalendarDays, Car, QrCode, MessageCircle, ScrollText, Key,\r\n  X as CloseIcon, Star, StickyNote, Phone, Ticket, ShoppingBag, Package\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useLanguageStore } from '../../stores/languageStore';\r\nimport { useDataStore } from '../../stores/dataStore';\r\nimport { useMeetingStore } from '../../stores/meetingStore';\r\nimport { AppLogo } from '../common/AppLogo';\r\nimport { chatApi } from '../../services/api';\r\n\r\ninterface SidebarProps {\r\n  onLogout: () => void;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function Sidebar({ onLogout, isOpen, onClose }: SidebarProps) {\r\n  const location = useLocation();\r\n  const { user } = useAuthStore();\r\n  const { t, language } = useLanguageStore();\r\n  const { requests, announcements, executors, getAnnouncementsForEmployees } = useDataStore();\r\n  const { meetings } = useMeetingStore();\r\n\r\n  // Chat unread count state\r\n  const [chatUnreadCount, setChatUnreadCount] = useState(0);\r\n\r\n  // Fetch chat unread count\r\n  const fetchChatUnreadCount = useCallback(async () => {\r\n    if (!user) return;\r\n    // Only fetch for users who have chat access\r\n    if (!['admin', 'manager', 'resident'].includes(user.role)) return;\r\n\r\n    try {\r\n      const response = await chatApi.getUnreadCount();\r\n      setChatUnreadCount(response.unread_count || 0);\r\n    } catch (error) {\r\n      console.error('Failed to fetch chat unread count:', error);\r\n    }\r\n  }, [user]);\r\n\r\n  // Initial fetch and polling every 10 seconds\r\n  useEffect(() => {\r\n    fetchChatUnreadCount();\r\n    const interval = setInterval(fetchChatUnreadCount, 10000);\r\n    return () => clearInterval(interval);\r\n  }, [fetchChatUnreadCount]);\r\n\r\n  // Calculate meeting status for badge color\r\n  const meetingStatus = useMemo(() => {\r\n    if (!user) return null;\r\n    const now = new Date();\r\n    const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\r\n\r\n    // Find meetings relevant to user\r\n    const relevantMeetings = meetings.filter(m => {\r\n      if (m.status === 'cancelled') return false;\r\n\r\n      // Show badge for meetings with open schedule poll or voting\r\n      if (m.status === 'schedule_poll_open' || m.status === 'voting_open') {\r\n        return true;\r\n      }\r\n\r\n      // For other statuses, check if meeting is within next week\r\n      if (!m.confirmedDateTime) return false;\r\n      const meetingDate = new Date(m.confirmedDateTime);\r\n      return meetingDate >= now && meetingDate <= weekFromNow;\r\n    });\r\n\r\n    if (relevantMeetings.length === 0) return null;\r\n\r\n    // Check if any meeting has active voting (voting_open status)\r\n    const hasActiveVoting = relevantMeetings.some(m =>\r\n      m.status === 'voting_open' || m.status === 'schedule_poll_open'\r\n    );\r\n\r\n    // Check if any meeting is confirmed/completed (voting finished, results published)\r\n    const hasConfirmedMeeting = relevantMeetings.some(m =>\r\n      m.status === 'voting_closed' ||\r\n      m.status === 'results_published' ||\r\n      m.status === 'protocol_generated' ||\r\n      m.status === 'protocol_approved'\r\n    );\r\n\r\n    if (hasActiveVoting) return 'voting'; // blue\r\n    if (hasConfirmedMeeting) return 'confirmed'; // green\r\n    return 'upcoming'; // normal count\r\n  }, [user, meetings]);\r\n\r\n  // Calculate notification badges\r\n  const badges = useMemo(() => {\r\n    if (!user) return {};\r\n\r\n    // For executors\r\n    if (user.role === 'executor') {\r\n      const currentExecutor = executors.find(e => e.login === user.login);\r\n      const mySpecialization = currentExecutor?.specialization || user.specialization;\r\n\r\n      // Count new requests matching executor's specialization\r\n      const availableRequestsCount = requests.filter(r =>\r\n        r.status === 'new' && r.category === mySpecialization\r\n      ).length;\r\n\r\n      // Count assigned requests waiting for action\r\n      const assignedRequestsCount = requests.filter(r =>\r\n        r.executorId === currentExecutor?.id && (r.status === 'assigned' || r.status === 'accepted')\r\n      ).length;\r\n\r\n      // Count unread announcements for employees\r\n      const employeeAnnouncements = getAnnouncementsForEmployees();\r\n      const unreadAnnouncementsCount = employeeAnnouncements.filter(a =>\r\n        !a.viewedBy?.includes(user.id)\r\n      ).length;\r\n\r\n      return {\r\n        '/': availableRequestsCount + assignedRequestsCount,\r\n        '/announcements': unreadAnnouncementsCount,\r\n      };\r\n    }\r\n\r\n    // For residents\r\n    if (user.role === 'resident') {\r\n      // Count active requests (not completed)\r\n      const activeRequestsCount = requests.filter(r =>\r\n        r.residentId === user.id && !['completed', 'closed', 'cancelled'].includes(r.status)\r\n      ).length;\r\n\r\n      // Count unread announcements\r\n      const unreadAnnouncementsCount = announcements.filter(a =>\r\n        a.isActive && !a.viewedBy?.includes(user.id) && (a.type === 'residents' || a.type === 'all')\r\n      ).length;\r\n\r\n      // Count upcoming meetings\r\n      const now = new Date();\r\n      const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\r\n      const upcomingMeetingsCount = meetings.filter(m => {\r\n        if (m.status === 'cancelled') return false;\r\n        if (!m.confirmedDateTime) return false;\r\n        const meetingDate = new Date(m.confirmedDateTime);\r\n        return meetingDate >= now && meetingDate <= weekFromNow;\r\n      }).length;\r\n\r\n      return {\r\n        '/': activeRequestsCount,\r\n        '/announcements': unreadAnnouncementsCount,\r\n        '/meetings': upcomingMeetingsCount,\r\n        '/chat': chatUnreadCount,\r\n      };\r\n    }\r\n\r\n    // For managers/admins/director\r\n    if (user.role === 'manager' || user.role === 'admin' || user.role === 'department_head' || user.role === 'director') {\r\n      // Count new unassigned requests\r\n      const newRequestsCount = requests.filter(r => r.status === 'new').length;\r\n\r\n      // Count upcoming meetings for managers\r\n      const now = new Date();\r\n      const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\r\n      const upcomingMeetingsCount = meetings.filter(m => {\r\n        if (m.status === 'cancelled') return false;\r\n        if (!m.confirmedDateTime) return false;\r\n        const meetingDate = new Date(m.confirmedDateTime);\r\n        return meetingDate >= now && meetingDate <= weekFromNow;\r\n      }).length;\r\n\r\n      return {\r\n        '/requests': newRequestsCount,\r\n        '/meetings': upcomingMeetingsCount,\r\n        '/chat': chatUnreadCount,\r\n      };\r\n    }\r\n\r\n    return {};\r\n  }, [user, requests, announcements, executors, getAnnouncementsForEmployees, chatUnreadCount, meetings]);\r\n\r\n  // Different nav items based on role and account_type\r\n  const getNavItems = () => {\r\n    // Special account types first (check both account_type and role)\r\n    if (user?.account_type === 'advertiser' || user?.role === 'advertiser') {\r\n      return [\r\n        { path: '/', icon: LayoutDashboard, label: language === 'ru' ? ' ' : 'Mening e\\'lonlarim' },\r\n      ];\r\n    }\r\n    if (user?.account_type === 'coupon_checker' || user?.role === 'coupon_checker') {\r\n      return [\r\n        { path: '/', icon: Ticket, label: language === 'ru' ? ' ' : 'Kuponlarni tekshirish' },\r\n      ];\r\n    }\r\n    if (user?.role === 'marketplace_manager') {\r\n      return [\r\n        { path: '/', icon: ShoppingBag, label: language === 'ru' ? ' ' : 'Do\\'konni boshqarish' },\r\n        { path: '/marketplace-orders', icon: ShoppingBag, label: language === 'ru' ? ' ' : 'Do\\'kon buyurtmalari' },\r\n      ];\r\n    }\r\n\r\n    if (user?.role === 'executor') {\r\n      // Security guards get QR scanner\r\n      // Couriers see \"\" instead of \"\"\r\n      const baseItems = [\r\n        { path: '/', icon: FileText, label: language === 'ru' ? (user?.specialization === 'courier' ? '' : '') : (user?.specialization === 'courier' ? 'Buyurtmalar' : 'Arizalar') },\r\n        { path: '/schedule', icon: CalendarDays, label: language === 'ru' ? '' : 'Jadval' },\r\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\r\n      ];\r\n\r\n      // Add QR scanner for security guards\r\n      if (user?.specialization === 'security') {\r\n        baseItems.push({ path: '/qr-scanner', icon: QrCode, label: language === 'ru' ? ' QR' : 'QR skaner' });\r\n      }\r\n\r\n      return [\r\n        ...baseItems,\r\n        { path: '/stats', icon: BarChart3, label: language === 'ru' ? '' : 'Statistika' },\r\n        { path: '/announcements', icon: Megaphone, label: language === 'ru' ? '' : 'E\\'lonlar' },\r\n        { path: '/trainings', icon: GraduationCap, label: language === 'ru' ? '' : 'Treninglar' },\r\n        { path: '/colleagues', icon: Users, label: language === 'ru' ? '' : 'Hamkasblar' },\r\n        { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Eslatmalar' },\r\n      ];\r\n    }\r\n    if (user?.role === 'resident') {\r\n      return [\r\n        { path: '/', icon: Home, label: t('nav.services') },\r\n        { path: '/marketplace', icon: ShoppingBag, label: language === 'ru' ? '' : 'Do\\'kon' },\r\n        { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '  ' : 'UK ga yozish' },\r\n        { path: '/vehicles', icon: Car, label: language === 'ru' ? ' ' : 'Mening avtomobillarim' },\r\n        { path: '/guest-access', icon: QrCode, label: language === 'ru' ? ' ' : 'Mehmon kirishi' },\r\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\r\n        { path: '/meetings', icon: Vote, label: t('meetings.title') },\r\n        { path: '/useful-contacts', icon: Phone, label: language === 'ru' ? ' ' : 'Foydali kontaktlar' },\r\n        { path: '/rate-employees', icon: Star, label: language === 'ru' ? '' : 'Baholash' },\r\n        { path: '/contract', icon: ScrollText, label: language === 'ru' ? '' : 'Shartnoma' },\r\n      ];\r\n    }\r\n    if (user?.role === 'tenant' || user?.role === 'commercial_owner') {\r\n      return [\r\n        { path: '/', icon: Key, label: t('nav.myApartments') },\r\n      ];\r\n    }\r\n    if (user?.role === 'admin') {\r\n      return [\r\n        { path: '/', icon: Shield, label: t('nav.monitoring') },\r\n        { path: '/requests', icon: FileText, label: t('nav.requests') },\r\n        { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '' : 'Chatlar' },\r\n        { path: '/team', icon: Users, label: language === 'ru' ? '' : 'Xodimlar' },\r\n        { path: '/residents', icon: Users, label: t('nav.residents') },\r\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\r\n        { path: '/buildings', icon: Building2, label: t('nav.buildings') },\r\n        { path: '/work-orders', icon: Wrench, label: t('nav.workOrders') },\r\n        { path: '/meetings', icon: Vote, label: t('meetings.title') },\r\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\r\n        { path: '/trainings', icon: GraduationCap, label: t('nav.trainings') },\r\n        { path: '/reports', icon: BarChart3, label: t('nav.reports') },\r\n        { path: '/settings', icon: Settings, label: t('nav.settings') },\r\n      ];\r\n    }\r\n    // Director ( ) -   \r\n    if (user?.role === 'director') {\r\n      return [\r\n        { path: '/', icon: LayoutDashboard, label: language === 'ru' ? ' ' : 'Kompaniya sharhi' },\r\n        { path: '/requests', icon: FileText, label: t('nav.requests') },\r\n        { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '' : 'Chatlar' },\r\n        { path: '/team', icon: Users, label: language === 'ru' ? '' : 'Xodimlar' },\r\n        { path: '/residents', icon: Users, label: t('nav.residents') },\r\n        { path: '/buildings', icon: Building2, label: t('nav.buildings') },\r\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\r\n        { path: '/guest-access', icon: QrCode, label: language === 'ru' ? ' ' : 'Mehmon ruxsatnomalari' },\r\n        { path: '/rentals', icon: Key, label: language === 'ru' ? '' : 'Ijara' },\r\n        { path: '/meetings', icon: Vote, label: t('meetings.title') },\r\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\r\n        { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Bloknot' },\r\n        { path: '/reports', icon: BarChart3, label: t('nav.reports') },\r\n        { path: '/settings', icon: Settings, label: t('nav.settings') },\r\n      ];\r\n    }\r\n    // Department Head ( ) - limited manager view for their department\r\n    if (user?.role === 'department_head') {\r\n      return [\r\n        { path: '/', icon: LayoutDashboard, label: language === 'ru' ? ' ' : 'Mening bo\\'limim' },\r\n        { path: '/requests', icon: FileText, label: language === 'ru' ? '' : 'Arizalar' },\r\n        { path: '/executors', icon: Wrench, label: language === 'ru' ? '' : 'Xodimlar' },\r\n        { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\r\n        { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\r\n        { path: '/trainings', icon: GraduationCap, label: t('nav.trainings') },\r\n        { path: '/colleagues', icon: Users, label: language === 'ru' ? '' : 'Hamkasblar' },\r\n        { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Bloknot' },\r\n      ];\r\n    }\r\n    // Manager -  \r\n    return [\r\n      { path: '/', icon: LayoutDashboard, label: t('nav.dashboard') },\r\n      { path: '/requests', icon: FileText, label: t('nav.requests') },\r\n      { path: '/marketplace-orders', icon: ShoppingBag, label: language === 'ru' ? ' ' : 'Do\\'kon buyurtmalari' },\r\n      { path: '/marketplace-products', icon: Package, label: language === 'ru' ? '  ' : 'Mahsulotlar va ombor' },\r\n      { path: '/chat', icon: MessageCircle, label: language === 'ru' ? '' : 'Chatlar' },\r\n      { path: '/executors', icon: Wrench, label: t('nav.executors') },\r\n      { path: '/residents', icon: Users, label: t('nav.residents') },\r\n      { path: '/vehicle-search', icon: Car, label: language === 'ru' ? ' ' : 'Avto qidirish' },\r\n      { path: '/guest-access', icon: QrCode, label: language === 'ru' ? ' ' : 'Mehmon ruxsatnomalari' },\r\n      { path: '/rentals', icon: Key, label: t('nav.rentals') },\r\n      { path: '/buildings', icon: Building2, label: t('nav.buildings') },\r\n      { path: '/work-orders', icon: Wrench, label: t('nav.workOrders') },\r\n      { path: '/meetings', icon: Vote, label: t('meetings.title') },\r\n      { path: '/announcements', icon: Megaphone, label: t('announcements.title') },\r\n      { path: '/trainings', icon: GraduationCap, label: t('nav.trainings') },\r\n      { path: '/colleagues', icon: Users, label: language === 'ru' ? ' ' : 'Hamkasblar' },\r\n      { path: '/notepad', icon: StickyNote, label: language === 'ru' ? '' : 'Eslatmalar' },\r\n      { path: '/reports', icon: BarChart3, label: t('nav.reports') },\r\n      { path: '/settings', icon: Settings, label: t('nav.settings') },\r\n    ];\r\n  };\r\n\r\n  const navItems = getNavItems();\r\n\r\n  const handleNavClick = () => {\r\n    // Close sidebar on mobile after navigation\r\n    if (window.innerWidth < 768) {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Mobile overlay */}\r\n      <div\r\n        className={`sidebar-overlay ${isOpen ? 'open' : ''}`}\r\n        onClick={onClose}\r\n      />\r\n\r\n      <div className={`sidebar ${isOpen ? 'open' : ''}`}>\r\n        <div className=\"p-4 md:p-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <AppLogo size=\"md\" />\r\n              <div>\r\n                <div className=\"font-bold text-gray-900\">Kamizo</div>\r\n                <div className=\"text-xs text-gray-500\">CRM</div>\r\n              </div>\r\n            </div>\r\n            {/* Close button for mobile */}\r\n            <button\r\n              onClick={onClose}\r\n              className=\"md:hidden p-2 hover:bg-white/30 rounded-lg\"\r\n            >\r\n              <CloseIcon className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <nav className=\"flex-1 py-4 overflow-y-auto\">\r\n          {navItems.map((item: { path: string; icon: React.ElementType; label: string; separator?: boolean }) => {\r\n            const badgeCount = badges[item.path as keyof typeof badges] || 0;\r\n            // Special color for meetings based on voting status\r\n            const isMeetingsTab = item.path === '/meetings';\r\n            const badgeColor = isMeetingsTab && meetingStatus\r\n              ? (meetingStatus === 'voting' ? 'bg-blue-500' : meetingStatus === 'confirmed' ? 'bg-green-500' : 'bg-red-500')\r\n              : 'bg-red-500';\r\n            const shouldAnimate = !isMeetingsTab || meetingStatus === 'voting';\r\n\r\n            return (\r\n              <div key={item.path}>\r\n                {item.separator && (\r\n                  <div className=\"my-3 mx-4 border-t border-white/20\" />\r\n                )}\r\n                <Link\r\n                  to={item.path}\r\n                  onClick={handleNavClick}\r\n                  className={`sidebar-item ${location.pathname === item.path ? 'active' : ''}`}\r\n                >\r\n                  <div className=\"relative\">\r\n                    <item.icon className=\"w-5 h-5\" />\r\n                    {badgeCount > 0 && (\r\n                      <span className={`absolute -top-2 -right-2 min-w-[18px] h-[18px] flex items-center justify-center px-1 text-[10px] font-bold text-white ${badgeColor} rounded-full ${shouldAnimate ? 'animate-pulse' : ''}`}>\r\n                        {badgeCount > 99 ? '99+' : badgeCount}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  <span className=\"flex-1\">{item.label}</span>\r\n                  {badgeCount > 0 && (\r\n                    <span className={`ml-auto px-2 py-0.5 text-xs font-bold text-white ${badgeColor} rounded-full`}>\r\n                      {badgeCount > 99 ? '99+' : badgeCount}\r\n                    </span>\r\n                  )}\r\n                </Link>\r\n              </div>\r\n            );\r\n          })}\r\n        </nav>\r\n\r\n        <div className=\"p-4 border-t border-white/20 space-y-1\">\r\n          {/* Profile link for residents and rental users */}\r\n          {(user?.role === 'resident' || user?.role === 'tenant' || user?.role === 'commercial_owner') && (\r\n            <Link\r\n              to=\"/profile\"\r\n              onClick={handleNavClick}\r\n              className={`sidebar-item ${location.pathname === '/profile' ? 'active' : ''}`}\r\n            >\r\n              <User className=\"w-5 h-5\" />\r\n              <span>{language === 'ru' ? ' ' : 'Mening profilim'}</span>\r\n            </Link>\r\n          )}\r\n          <button onClick={onLogout} className=\"sidebar-item w-full text-red-500 hover:bg-red-50\">\r\n            <LogOut className=\"w-5 h-5\" />\r\n            <span>{language === 'ru' ? '' : 'Chiqish'}</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import { useState, useMemo } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { Bell, Menu, Megaphone, Users, Key, Phone, FileText, Car, CheckCircle } from 'lucide-react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useDataStore } from '../../stores/dataStore';\r\nimport { useMeetingStore } from '../../stores/meetingStore';\r\nimport { AppLogo } from '../common/AppLogo';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\ninterface MobileHeaderProps {\r\n  onMenuClick: () => void;\r\n  unreadCount: number;\r\n}\r\n\r\nexport function MobileHeader({ onMenuClick, unreadCount }: MobileHeaderProps) {\r\n  const { user } = useAuthStore();\r\n  const navigate = useNavigate();\r\n  const [showNotifications, setShowNotifications] = useState(false);\r\n  const { notifications, markNotificationAsRead, markAllNotificationsAsRead, getAnnouncementsForResidents, getAnnouncementsForEmployees, vehicles } = useDataStore();\r\n  const { meetings } = useMeetingStore();\r\n\r\n  // Check if resident and get onboarding tasks\r\n  const isResident = user?.role?.toLowerCase() === 'resident' || user?.role?.toLowerCase() === 'tenant';\r\n\r\n  // Get unread announcements\r\n  const userAnnouncements = useMemo(() => {\r\n    if (!user) return [];\r\n    return isResident\r\n      ? getAnnouncementsForResidents(user.login || '', user.buildingId || '', user.entrance || '', user.floor || '', user.branch || '')\r\n      : getAnnouncementsForEmployees();\r\n  }, [user, isResident, getAnnouncementsForResidents, getAnnouncementsForEmployees]);\r\n\r\n  const unreadAnnouncementsCount = userAnnouncements.filter(a => !a.viewedBy?.includes(user?.id || '')).length;\r\n\r\n  // Get upcoming meetings\r\n  const upcomingMeetings = useMemo(() => {\r\n    const nowDate = new Date();\r\n    const weekFromNow = new Date(nowDate.getTime() + 7 * 24 * 60 * 60 * 1000);\r\n    return meetings.filter(m => {\r\n      if (!m.confirmedDateTime) return false;\r\n      const meetingDate = new Date(m.confirmedDateTime);\r\n      return meetingDate >= nowDate && meetingDate <= weekFromNow && m.status !== 'cancelled';\r\n    });\r\n  }, [meetings]);\r\n\r\n  // Calculate pending onboarding tasks with details\r\n  const pendingTasks = useMemo(() => {\r\n    if (!isResident || !user) return [];\r\n    const tasks: { id: string; title: string; description: string; icon: typeof Key; path: string; completed: boolean }[] = [\r\n      {\r\n        id: 'password',\r\n        title: ' ',\r\n        description: '  ',\r\n        icon: Key,\r\n        path: '/profile',\r\n        completed: !!user.passwordChangedAt\r\n      },\r\n      {\r\n        id: 'phone',\r\n        title: ' ',\r\n        description: '   ',\r\n        icon: Phone,\r\n        path: '/profile',\r\n        completed: !!(user.phone && user.phone.length >= 5)\r\n      },\r\n      {\r\n        id: 'contract',\r\n        title: ' ',\r\n        description: '   ',\r\n        icon: FileText,\r\n        path: '/contract',\r\n        completed: !!user.contractSignedAt\r\n      },\r\n      {\r\n        id: 'vehicle',\r\n        title: ' ',\r\n        description: '  ',\r\n        icon: Car,\r\n        path: '/vehicles',\r\n        completed: vehicles.some(v => v.ownerId === user.id)\r\n      }\r\n    ];\r\n    return tasks;\r\n  }, [isResident, user, vehicles]);\r\n\r\n  const pendingTasksCount = pendingTasks.filter(t => !t.completed).length;\r\n\r\n  // Menu badge - only sidebar tab notifications (announcements, meetings), NOT onboarding tasks\r\n  const totalMenuBadge = unreadAnnouncementsCount + upcomingMeetings.length;\r\n\r\n  const userNotifications = notifications.filter(n => n.userId === user?.id).slice(0, 10);\r\n\r\n  const formatTime = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n\r\n    if (diffMins < 1) return ' ';\r\n    if (diffMins < 60) return `${diffMins} `;\r\n    if (diffHours < 24) return `${diffHours} `;\r\n    return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });\r\n  };\r\n\r\n  const getNotificationIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'request_created': return '';\r\n      case 'request_assigned': return '';\r\n      case 'request_accepted': return '';\r\n      case 'request_started': return '';\r\n      case 'request_completed': return '';\r\n      case 'request_approved': return '';\r\n      case 'request_rejected': return '';\r\n      case 'request_cancelled': return '';\r\n      case 'request_declined': return '';\r\n      default: return '';\r\n    }\r\n  };\r\n\r\n  // Total badge for notifications button - includes onboarding tasks for residents\r\n  const totalNotificationsBadge = unreadCount + unreadAnnouncementsCount + upcomingMeetings.length + pendingTasksCount;\r\n\r\n  return (\r\n    <>\r\n      <header className=\"mobile-header\">\r\n        <button onClick={onMenuClick} className=\"p-2 hover:bg-white/30 rounded-lg relative\">\r\n          <Menu className=\"w-6 h-6\" />\r\n          {/* Badge on menu button for pending tasks */}\r\n          {totalMenuBadge > 0 && (\r\n            <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-amber-500 rounded-full text-white text-[10px] flex items-center justify-center\">\r\n              {totalMenuBadge > 9 ? '9+' : totalMenuBadge}\r\n            </span>\r\n          )}\r\n        </button>\r\n\r\n        <div className=\"flex items-center gap-2\">\r\n          <AppLogo size=\"sm\" />\r\n          <span className=\"font-bold text-gray-900 text-sm\">Kamizo</span>\r\n        </div>\r\n\r\n        <button\r\n          onClick={() => setShowNotifications(!showNotifications)}\r\n          className=\"p-2 hover:bg-white/30 rounded-lg relative\"\r\n        >\r\n          <Bell className=\"w-6 h-6\" />\r\n          {totalNotificationsBadge > 0 && (\r\n            <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center\">\r\n              {totalNotificationsBadge > 9 ? '9+' : totalNotificationsBadge}\r\n            </span>\r\n          )}\r\n        </button>\r\n      </header>\r\n\r\n      {/* Mobile Notifications Dropdown - Full categories like desktop */}\r\n      {showNotifications && createPortal(\r\n        <div className=\"notifications-portal\">\r\n          <div\r\n            className=\"fixed inset-0 bg-black/20\"\r\n            style={{ zIndex: 10000 }}\r\n            onClick={() => setShowNotifications(false)}\r\n          />\r\n          <div\r\n            className=\"fixed left-2 right-2 bottom-16 bg-white rounded-2xl border border-gray-200 shadow-2xl overflow-hidden\"\r\n            style={{ zIndex: 10001, maxHeight: '70vh' }}\r\n          >\r\n            <div className=\"p-3 border-b border-gray-200 flex items-center justify-between bg-gray-50\">\r\n              <h3 className=\"font-semibold text-sm\"></h3>\r\n              {unreadCount > 0 && (\r\n                <button\r\n                  onClick={() => user && markAllNotificationsAsRead(user.id)}\r\n                  className=\"text-xs text-blue-600\"\r\n                >\r\n                   \r\n                </button>\r\n              )}\r\n            </div>\r\n            <div className=\"overflow-y-auto\" style={{ maxHeight: 'calc(70vh - 90px)' }}>\r\n              {/* Onboarding Tasks Section - for residents */}\r\n              {isResident && pendingTasks.length > 0 && (\r\n                <div className=\"border-b border-gray-200\">\r\n                  <div className=\"px-3 py-2 bg-amber-50 border-b border-amber-100\">\r\n                    <p className=\"text-xs font-medium text-amber-700 flex items-center gap-1\">\r\n                      <CheckCircle className=\"w-3 h-3\" />\r\n                       ({pendingTasksCount}/{pendingTasks.length})\r\n                    </p>\r\n                  </div>\r\n                  {pendingTasks.map((task) => (\r\n                    <div\r\n                      key={task.id}\r\n                      onClick={() => { setShowNotifications(false); navigate(task.path); }}\r\n                      className={`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 flex items-center gap-2 ${task.completed ? 'bg-green-50/50' : 'bg-amber-50/50'}`}\r\n                    >\r\n                      <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${task.completed ? 'bg-green-100' : 'bg-amber-100'}`}>\r\n                        <task.icon className={`w-4 h-4 ${task.completed ? 'text-green-600' : 'text-amber-600'}`} />\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className={`text-sm font-medium ${task.completed ? 'text-green-700 line-through' : 'text-gray-900'}`}>\r\n                          {task.title}\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-500\">{task.description}</p>\r\n                      </div>\r\n                      {task.completed ? (\r\n                        <CheckCircle className=\"w-4 h-4 text-green-500 flex-shrink-0\" />\r\n                      ) : (\r\n                        <span className=\"w-2 h-2 bg-amber-500 rounded-full flex-shrink-0\" />\r\n                      )}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n\r\n              {/* Announcements Section */}\r\n              {unreadAnnouncementsCount > 0 && (\r\n                <div className=\"border-b border-gray-200\">\r\n                  <div className=\"px-3 py-2 bg-blue-50 border-b border-blue-100\">\r\n                    <p className=\"text-xs font-medium text-blue-700 flex items-center gap-1\">\r\n                      <Megaphone className=\"w-3 h-3\" />\r\n                       ({unreadAnnouncementsCount})\r\n                    </p>\r\n                  </div>\r\n                  {userAnnouncements.filter(a => !a.viewedBy?.includes(user?.id || '')).slice(0, 3).map((announcement) => (\r\n                    <div\r\n                      key={announcement.id}\r\n                      onClick={() => { setShowNotifications(false); navigate('/announcements'); }}\r\n                      className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 bg-blue-50/50 flex items-center gap-2\"\r\n                    >\r\n                      <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\r\n                        <Megaphone className=\"w-4 h-4 text-blue-600\" />\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className=\"text-sm font-medium truncate\">{announcement.title}</p>\r\n                        <p className=\"text-xs text-gray-500 line-clamp-1\">{announcement.content}</p>\r\n                      </div>\r\n                      <span className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0\" />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n\r\n              {/* Meetings Section */}\r\n              {upcomingMeetings.length > 0 && (\r\n                <div className=\"border-b border-gray-200\">\r\n                  <div className=\"px-3 py-2 bg-purple-50 border-b border-purple-100\">\r\n                    <p className=\"text-xs font-medium text-purple-700 flex items-center gap-1\">\r\n                      <Users className=\"w-3 h-3\" />\r\n                       ({upcomingMeetings.length})\r\n                    </p>\r\n                  </div>\r\n                  {upcomingMeetings.slice(0, 2).map((meeting) => (\r\n                    <div\r\n                      key={meeting.id}\r\n                      onClick={() => { setShowNotifications(false); navigate('/meetings'); }}\r\n                      className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 bg-purple-50/50 flex items-center gap-2\"\r\n                    >\r\n                      <div className=\"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0\">\r\n                        <Users className=\"w-4 h-4 text-purple-600\" />\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className=\"text-sm font-medium truncate\"> </p>\r\n                        <p className=\"text-xs text-gray-500\">\r\n                          {meeting.confirmedDateTime\r\n                            ? new Date(meeting.confirmedDateTime).toLocaleDateString('ru-RU', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' })\r\n                            : ' '}\r\n                        </p>\r\n                      </div>\r\n                      <span className=\"w-2 h-2 bg-purple-500 rounded-full flex-shrink-0\" />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n\r\n              {/* Regular Notifications */}\r\n              {userNotifications.length === 0 && unreadAnnouncementsCount === 0 && upcomingMeetings.length === 0 && pendingTasksCount === 0 ? (\r\n                <div className=\"p-6 text-center text-gray-500\">\r\n                  <Bell className=\"w-10 h-10 mx-auto mb-2 text-gray-300\" />\r\n                  <p> </p>\r\n                </div>\r\n              ) : userNotifications.length > 0 && (\r\n                <>\r\n                  <div className=\"px-3 py-2 bg-gray-50 border-b border-gray-100\">\r\n                    <p className=\"text-xs font-medium text-gray-500\"></p>\r\n                  </div>\r\n                  {userNotifications.map((notification) => (\r\n                    <div\r\n                      key={notification.id}\r\n                      onClick={() => {\r\n                        if (!notification.read) {\r\n                          markNotificationAsRead(notification.id);\r\n                        }\r\n                      }}\r\n                      className={`p-3 border-b border-gray-100 ${!notification.read ? 'bg-blue-50' : 'bg-white'}`}\r\n                    >\r\n                      <div className=\"flex gap-2\">\r\n                        <span className=\"text-lg\">{getNotificationIcon(notification.type)}</span>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-start justify-between gap-2\">\r\n                            <h4 className=\"font-medium text-sm truncate\">{notification.title}</h4>\r\n                            <span className=\"text-xs text-gray-400 flex-shrink-0\">{formatTime(notification.createdAt)}</span>\r\n                          </div>\r\n                          <p className=\"text-xs text-gray-500 mt-0.5 line-clamp-2\">{notification.message}</p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </>\r\n              )}\r\n            </div>\r\n            <div className=\"p-2 border-t border-gray-200 bg-gray-50\">\r\n              <button\r\n                onClick={() => setShowNotifications(false)}\r\n                className=\"w-full text-center text-sm text-gray-600 py-1\"\r\n              >\r\n                \r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","export type UserRole = 'admin' | 'director' | 'manager' | 'department_head' | 'executor' | 'resident' | 'commercial_owner' | 'tenant' | 'advertiser' | 'coupon_checker' | 'dispatcher' | 'security' | 'marketplace_manager';\r\nexport type ExecutorSpecialization = 'plumber' | 'electrician' | 'elevator' | 'intercom' | 'cleaning' | 'security' | 'carpenter' | 'boiler' | 'ac' | 'courier' | 'other';\r\nexport type RequestStatus = 'new' | 'assigned' | 'accepted' | 'in_progress' | 'pending_approval' | 'completed' | 'cancelled';\r\nexport type CancelledBy = 'resident' | 'executor' | 'manager' | 'admin';\r\nexport type RequestPriority = 'low' | 'medium' | 'high' | 'urgent';\r\n\r\nexport type ContractType = 'standard' | 'commercial' | 'temporary';\r\n\r\nexport interface User {\r\n  id: string;\r\n  phone: string;\r\n  name: string;\r\n  login: string;\r\n  email?: string;\r\n  role: UserRole;\r\n  specialization?: ExecutorSpecialization;\r\n  avatar?: string;\r\n  address?: string;\r\n  apartment?: string;\r\n  branch?: string; //  (YS, CH, etc.)\r\n  building?: string; //   (8A, 15, etc.)\r\n  buildingId?: string;\r\n  entrance?: string; // \r\n  floor?: string; // \r\n  totalArea?: number; //    .\r\n\r\n  // Contract fields (for residents)\r\n  qrCode?: string; //  QR-   \r\n  signatureKey?: string; //     ( )\r\n  contractSignedAt?: string; //   \r\n  agreedToTermsAt?: string; //   \r\n  contractNumber?: string; //   (-2024-00001)\r\n  contractStartDate?: string; //   \r\n  contractEndDate?: string; //   (null = )\r\n  contractType?: ContractType; //  \r\n\r\n  // Onboarding tracking (from DB, works across devices)\r\n  passwordChangedAt?: string; //   \r\n\r\n  // Timestamps\r\n  createdAt?: string;\r\n\r\n  // Special account types (for advertising platform)\r\n  account_type?: 'advertiser' | 'coupon_checker';\r\n}\r\n\r\nexport interface Executor {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  login: string;\r\n  password?: string;\r\n  specialization: ExecutorSpecialization;\r\n  status: 'available' | 'busy' | 'offline';\r\n  rating: number;\r\n  completedCount: number;\r\n  activeRequests: number;\r\n  totalEarnings: number;\r\n  avgCompletionTime: number;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface Request {\r\n  id: string;\r\n  number: number | string;  // Can be numeric (1001) or with prefix (YS-1001)\r\n  title: string;\r\n  description: string;\r\n  category: ExecutorSpecialization;\r\n  status: RequestStatus;\r\n  priority: RequestPriority;\r\n  residentId: string;\r\n  residentName: string;\r\n  residentPhone: string;\r\n  address: string;\r\n  apartment: string;\r\n  executorId?: string;\r\n  executorName?: string;\r\n  executorPhone?: string;\r\n  executorRating?: number;\r\n  createdAt: string;\r\n  scheduledDate?: string; //   \r\n  scheduledTime?: string; //    ( \"09:00-12:00\")\r\n  accessInfo?: string; //     \r\n  assignedAt?: string;\r\n  acceptedAt?: string;\r\n  startedAt?: string;\r\n  completedAt?: string;\r\n  approvedAt?: string;\r\n  rating?: number;\r\n  feedback?: string;\r\n  workDuration?: number; // in seconds\r\n  pausedAt?: string; // when work was paused\r\n  totalPausedTime?: number; // total paused time in seconds\r\n  isPaused?: boolean; // current pause state\r\n  cancelledAt?: string;\r\n  cancelledBy?: CancelledBy;\r\n  cancellationReason?: string;\r\n  rejectedAt?: string;\r\n  rejectionReason?: string;\r\n  rejectionCount?: number; //     \r\n  buildingId?: string; // ID  \r\n  buildingName?: string; //  \r\n}\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  userId: string;\r\n  type: 'request_created' | 'request_assigned' | 'request_accepted' | 'request_started' | 'request_completed' | 'request_approved' | 'request_rejected' | 'request_cancelled' | 'request_declined';\r\n  title: string;\r\n  message: string;\r\n  requestId?: string;\r\n  read: boolean;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface ActivityLog {\r\n  id: string;\r\n  userId: string;\r\n  userName: string;\r\n  userRole: UserRole;\r\n  action: string;\r\n  details: string;\r\n  requestId?: string;\r\n  timestamp: string;\r\n}\r\n\r\nexport interface DashboardStats {\r\n  totalRequests: number;\r\n  newRequests: number;\r\n  inProgress: number;\r\n  completedToday: number;\r\n  completedWeek: number;\r\n  avgCompletionTime: number;\r\n  executorsOnline: number;\r\n  executorsTotal: number;\r\n}\r\n\r\nexport interface ChartData {\r\n  date: string;\r\n  name: string;\r\n  created: number;\r\n  completed: number;\r\n}\r\n\r\nexport interface Building {\r\n  id: string;\r\n  name: string;\r\n  address: string;\r\n  floors: number;\r\n  apartments: number;\r\n  entrances: number;\r\n  yearBuilt?: number;\r\n  managerId?: string;\r\n  createdAt: string;\r\n  residentsCount: number;\r\n  activeRequestsCount: number;\r\n}\r\n\r\n// Rental apartment for commercial owners (tenants)\r\nexport interface RentalApartment {\r\n  id: string;\r\n  name: string; // e.g., \" 42\" or custom name\r\n  address: string;\r\n  apartment: string;\r\n  ownerId: string; // tenant user id\r\n  ownerName: string;\r\n  ownerPhone: string;\r\n  ownerLogin: string;\r\n  ownerPassword?: string; // stored for delete confirmation\r\n  ownerType: 'tenant' | 'commercial_owner'; // tenant =  , commercial_owner =  \r\n  createdAt: string;\r\n  isActive: boolean;\r\n}\r\n\r\n// Rental record (guest check-in/check-out)\r\nexport interface RentalRecord {\r\n  id: string;\r\n  apartmentId: string;\r\n  guestNames: string; // comma separated or single name\r\n  passportInfo: string;\r\n  checkInDate: string;\r\n  checkOutDate: string;\r\n  amount: number; // rental amount\r\n  currency: string; // UZS, USD, etc.\r\n  notes?: string;\r\n  createdAt: string;\r\n  createdBy: string; // manager id\r\n}\r\n\r\n// Announcement types\r\nexport type AnnouncementType = 'residents' | 'employees' | 'all';\r\nexport type AnnouncementPriority = 'normal' | 'important' | 'urgent';\r\nexport type AnnouncementTargetType = 'all' | 'branch' | 'building' | 'entrance' | 'floor' | 'custom';\r\n\r\n// Announcement targeting\r\nexport interface AnnouncementTarget {\r\n  type: AnnouncementTargetType;\r\n  branchId?: string; // for branch targeting\r\n  buildingId?: string; // for building targeting\r\n  entrance?: string; // for entrance/ targeting\r\n  floor?: string; // for floor targeting\r\n  customLogins?: string[]; // for custom targeting (from Excel import)\r\n}\r\n\r\n// File attachment for announcements\r\nexport interface FileAttachment {\r\n  name: string;\r\n  url: string; // data URL or external URL\r\n  type: string; // MIME type\r\n  size: number; // in bytes\r\n}\r\n\r\n// Announcement for residents or staff\r\nexport interface Announcement {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  type: AnnouncementType; // 'residents' = for residents, 'employees' = for UK workers, 'all' = everyone\r\n  priority: AnnouncementPriority;\r\n  authorId: string;\r\n  authorName: string;\r\n  authorRole: UserRole;\r\n  createdAt: string;\r\n  expiresAt?: string; // optional expiration date\r\n  isActive: boolean;\r\n  viewedBy: string[]; // array of user IDs who viewed (for current user check)\r\n  viewCount?: number; // total view count from API (for admin/manager display)\r\n  attachments?: FileAttachment[]; // file attachments\r\n  // Targeting fields\r\n  target?: AnnouncementTarget;\r\n}\r\n\r\n// Chat types\r\nexport type ChatChannelType = 'uk_general' | 'building_general' | 'entrance' | 'floor' | 'admin_support' | 'private_support';\r\n\r\nexport interface ChatChannel {\r\n  id: string;\r\n  type: ChatChannelType;\r\n  name: string;\r\n  description?: string;\r\n  buildingId?: string;\r\n  entrance?: string;\r\n  floor?: string;\r\n  participants: string[]; // user IDs\r\n  createdAt: string;\r\n  lastMessageAt?: string;\r\n  unreadCount?: number;\r\n  // For private_support channels\r\n  residentId?: string; // The resident who owns this support channel\r\n  residentName?: string;\r\n  residentApartment?: string;\r\n  lastMessage?: string; // Preview of last message for listing\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  channelId: string;\r\n  senderId: string;\r\n  senderName: string;\r\n  senderRole: UserRole;\r\n  senderApartment?: string;\r\n  content: string;\r\n  createdAt: string;\r\n  readBy: string[]; // user IDs who read the message\r\n  replyToId?: string; // for reply functionality\r\n  attachments?: ChatAttachment[];\r\n}\r\n\r\nexport interface ChatAttachment {\r\n  id: string;\r\n  type: 'image' | 'file';\r\n  name: string;\r\n  url: string;\r\n  size?: number;\r\n}\r\n\r\nexport const CHAT_CHANNEL_LABELS: Record<ChatChannelType, { label: string; labelUz: string; icon: string; description: string; descriptionUz: string }> = {\r\n  uk_general: {\r\n    label: '  ',\r\n    labelUz: 'UK umumiy chat',\r\n    icon: '',\r\n    description: '     ',\r\n    descriptionUz: 'Boshqaruv kompaniyasi barcha turar joy egalari uchun umumiy chat'\r\n  },\r\n  building_general: {\r\n    label: ' ',\r\n    labelUz: 'TJM chat',\r\n    icon: '',\r\n    description: '    ',\r\n    descriptionUz: 'Sizning turar joy majmuangiz aholisi uchun chat'\r\n  },\r\n  entrance: {\r\n    label: ' ',\r\n    labelUz: 'Kirish chati',\r\n    icon: '',\r\n    description: '   ',\r\n    descriptionUz: 'Sizning kirishingiz aholisi uchun chat'\r\n  },\r\n  floor: {\r\n    label: ' ',\r\n    labelUz: 'Qavat chati',\r\n    icon: '',\r\n    description: '   ',\r\n    descriptionUz: 'Sizning qavatingiz aholisi uchun chat'\r\n  },\r\n  admin_support: {\r\n    label: '  ',\r\n    labelUz: 'Administratsiya bilan chat',\r\n    icon: '',\r\n    description: '    ',\r\n    descriptionUz: 'UK administratsiyasi bilan to\\'g\\'ridan-to\\'g\\'ri chat'\r\n  },\r\n  private_support: {\r\n    label: '   ',\r\n    labelUz: 'UK bilan shaxsiy chat',\r\n    icon: '',\r\n    description: '    ',\r\n    descriptionUz: 'Administratsiya bilan shaxsiy chatizngiz'\r\n  }\r\n};\r\n\r\n// Service categories for residents\r\nexport interface ServiceCategory {\r\n  id: ExecutorSpecialization;\r\n  name: string;\r\n  icon: string;\r\n  description: string;\r\n}\r\n\r\nexport const SERVICE_CATEGORIES: ServiceCategory[] = [\r\n  // Popular services (first 4 shown in grid)\r\n  { id: 'plumber', name: '', icon: '', description: ' , , ' },\r\n  { id: 'electrician', name: '', icon: '', description: ', , ' },\r\n  { id: 'security', name: '', icon: '', description: '   ' },\r\n  { id: 'cleaning', name: '', icon: '', description: '   ' },\r\n  // Other services\r\n  { id: 'elevator', name: '', icon: '', description: '   ' },\r\n  { id: 'intercom', name: '', icon: '', description: '   ' },\r\n  { id: 'carpenter', name: ' ', icon: '', description: ' , , ' },\r\n  { id: 'boiler', name: '', icon: '', description: '   ' },\r\n  { id: 'ac', name: '', icon: '', description: '   ' },\r\n  { id: 'other', name: '', icon: '', description: ' ' },\r\n];\r\n\r\n// Labels\r\nexport const SPECIALIZATION_LABELS: Record<ExecutorSpecialization, string> = {\r\n  plumber: '',\r\n  electrician: '',\r\n  elevator: '',\r\n  intercom: '',\r\n  cleaning: '',\r\n  security: '',\r\n  carpenter: '',\r\n  boiler: '',\r\n  ac: '',\r\n  courier: '',\r\n  other: ''\r\n};\r\n\r\nexport const STATUS_LABELS: Record<RequestStatus, string> = {\r\n  new: '',\r\n  assigned: '',\r\n  accepted: '',\r\n  in_progress: ' ',\r\n  pending_approval: ' ',\r\n  completed: '',\r\n  cancelled: ''\r\n};\r\n\r\nexport const PRIORITY_LABELS: Record<RequestPriority, string> = {\r\n  low: '',\r\n  medium: '',\r\n  high: '',\r\n  urgent: ''\r\n};\r\n\r\n// ============================================\r\n// MEETINGS MODULE -  \r\n// ============================================\r\n\r\n// Meeting status - state machine\r\nexport type MeetingStatus =\r\n  | 'draft'                    // \r\n  | 'pending_moderation'       //   \r\n  | 'schedule_poll_open'       //  /\r\n  | 'schedule_confirmed'       // / \r\n  | 'voting_open'              //  \r\n  | 'voting_closed'            //  \r\n  | 'results_published'        //  \r\n  | 'protocol_generated'       //  \r\n  | 'protocol_approved'        //  /\r\n  | 'cancelled';               // \r\n\r\n// Meeting format\r\nexport type MeetingFormat = 'online' | 'offline' | 'hybrid';\r\n\r\n// Meeting organizer type\r\nexport type MeetingOrganizerType = 'resident' | 'management';\r\n\r\n// Vote choice for agenda items\r\nexport type VoteChoice = 'for' | 'against' | 'abstain' | 'not_voted';\r\n\r\n// Voting unit type - what counts as one vote\r\nexport type VotingUnitType = 'apartment' | 'owner' | 'share';\r\n\r\n// Decision threshold type\r\nexport type DecisionThreshold = 'simple_majority' | 'qualified_majority' | 'two_thirds' | 'three_quarters' | 'unanimous';\r\n\r\n// Agenda item type (predefined categories)\r\nexport type AgendaItemType =\r\n  | 'budget_approval'          //  \r\n  | 'tariff_change'            //  \r\n  | 'major_repair'             //  \r\n  | 'common_property'          //   \r\n  | 'management_contract'      //  \r\n  | 'chairman_election'        //  \r\n  | 'audit_commission'         //  \r\n  | 'rules_amendment'          //  \r\n  | 'landscaping'              // \r\n  | 'security'                 //   \r\n  | 'parking'                  // \r\n  | 'other';                   // \r\n\r\n// Schedule option for date/time voting\r\nexport interface ScheduleOption {\r\n  id: string;\r\n  dateTime: string;            // ISO datetime\r\n  votes: string[];             // Array of voter IDs\r\n  votesByShare?: number;       // Sum of shares if voting by shares\r\n}\r\n\r\n// Agenda item\r\nexport interface AgendaItem {\r\n  id: string;\r\n  type: AgendaItemType;\r\n  title: string;\r\n  description: string;\r\n  threshold: DecisionThreshold;\r\n  materials: MeetingMaterial[];\r\n  votesFor: number;           // Votes by area (sq.m) as per Uzbekistan law\r\n  votesAgainst: number;\r\n  votesAbstain: number;\r\n  votesForByShare?: number;   // Alias for compatibility\r\n  votesAgainstByShare?: number;\r\n  votesAbstainByShare?: number;\r\n  isApproved?: boolean;\r\n  decision?: string;\r\n  order: number;               // Order in agenda\r\n}\r\n\r\n// Meeting material (attachment)\r\nexport interface MeetingMaterial {\r\n  id: string;\r\n  name: string;\r\n  type: 'document' | 'image' | 'link';\r\n  url: string;\r\n  size?: number;\r\n  uploadedAt: string;\r\n  uploadedBy: string;\r\n}\r\n\r\n// Agenda item comment (/    )\r\nexport interface AgendaComment {\r\n  id: string;\r\n  agendaItemId: string;\r\n  meetingId: string;\r\n  residentId: string;\r\n  residentName: string;\r\n  apartmentNumber?: string;\r\n  content: string;\r\n  includeInProtocol: boolean;\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n}\r\n\r\n// Vote record with audit trail\r\nexport interface VoteRecord {\r\n  id: string;\r\n  meetingId: string;\r\n  agendaItemId?: string;       // null for schedule votes\r\n  scheduleOptionId?: string;   // for schedule votes\r\n  voterId: string;\r\n  voterName: string;\r\n  apartmentId?: string;\r\n  apartmentNumber?: string;\r\n  ownershipShare?: number;     //   (0-100)\r\n  choice: VoteChoice | 'schedule';\r\n\r\n  // Audit & verification\r\n  verificationMethod: 'otp_sms' | 'otp_push' | 'password' | 'e_signature' | 'otp' | 'login' | 'in_person' | 'proxy';\r\n  otpVerified: boolean;\r\n  ipAddress?: string;\r\n  userAgent?: string;\r\n  sessionId?: string;\r\n  votedAt: string;\r\n  voteHash: string;            // SHA-256 hash for immutability proof\r\n\r\n  // Re-vote tracking\r\n  isRevote?: boolean;\r\n  previousVoteId?: string;\r\n}\r\n\r\n// OTP verification record\r\nexport interface OTPRecord {\r\n  id: string;\r\n  userId: string;\r\n  phone: string;\r\n  code: string;\r\n  purpose: 'meeting_vote' | 'schedule_vote' | 'phone_verification';\r\n  meetingId?: string;\r\n  agendaItemId?: string;\r\n  attempts: number;\r\n  maxAttempts: number;\r\n  createdAt: string;\r\n  expiresAt: string;\r\n  verifiedAt?: string;\r\n  isUsed: boolean;\r\n}\r\n\r\n// Notification log for meetings\r\nexport interface MeetingNotificationLog {\r\n  id: string;\r\n  meetingId: string;\r\n  recipientId: string;\r\n  recipientPhone?: string;\r\n  recipientEmail?: string;\r\n  channel: 'sms' | 'push' | 'email' | 'in_app';\r\n  type: 'meeting_created' | 'schedule_poll' | 'schedule_confirmed' | 'voting_open' | 'voting_reminder' | 'results_published' | 'protocol_ready';\r\n  status: 'pending' | 'sent' | 'delivered' | 'failed';\r\n  sentAt?: string;\r\n  deliveredAt?: string;\r\n  errorMessage?: string;\r\n}\r\n\r\n// Meeting protocol\r\nexport interface MeetingProtocol {\r\n  id: string;\r\n  meetingId: string;\r\n  number: string;              // Protocol number\r\n  generatedAt: string;\r\n  content: string;             // HTML or markdown content\r\n\r\n  // Signatures\r\n  signedByUK?: {\r\n    userId: string;\r\n    name: string;\r\n    role: string;\r\n    signedAt: string;\r\n    signatureHash: string;\r\n  };\r\n  signedByChairman?: {\r\n    userId: string;\r\n    name: string;\r\n    signedAt: string;\r\n    signatureHash: string;\r\n  };\r\n  signedBySecretary?: {\r\n    userId: string;\r\n    name: string;\r\n    signedAt: string;\r\n    signatureHash: string;\r\n  };\r\n\r\n  // Integrity\r\n  protocolHash: string;        // Hash of entire protocol for verification\r\n  attachments: string[];       // IDs of related materials\r\n}\r\n\r\n// Main Meeting entity\r\nexport interface Meeting {\r\n  id: string;\r\n  number: number;              // Sequential meeting number\r\n  buildingId: string;\r\n  buildingAddress: string;\r\n\r\n  // Organization\r\n  organizerType: MeetingOrganizerType;\r\n  organizerId: string;\r\n  organizerName: string;\r\n  format: MeetingFormat;\r\n  status: MeetingStatus;\r\n\r\n  // Schedule\r\n  scheduleOptions: ScheduleOption[];\r\n  schedulePollEndsAt?: string;\r\n  confirmedDateTime?: string;\r\n  location?: string;           // For offline/hybrid meetings\r\n\r\n  // Agenda\r\n  agendaItems: AgendaItem[];\r\n  materials: MeetingMaterial[];\r\n\r\n  // Voting settings (per building/meeting)\r\n  votingSettings: {\r\n    votingUnit: VotingUnitType;\r\n    quorumPercent: number;     // % required for valid meeting\r\n    allowRevote: boolean;      // Can change vote before closing\r\n    requireOTP: boolean;       // Require OTP for each vote\r\n    showIntermediateResults: boolean;\r\n  };\r\n\r\n  // Participation\r\n  eligibleVoters: string[];    // User IDs who can vote\r\n  totalEligibleCount: number;\r\n  totalEligibleShares?: number;\r\n  participatedVoters: string[];\r\n\r\n  // Results\r\n  quorumReached: boolean;\r\n  participationPercent: number;\r\n  participationByShares?: number;\r\n\r\n  // Protocol\r\n  protocolId?: string;\r\n\r\n  // Timestamps\r\n  createdAt: string;\r\n  moderatedAt?: string;\r\n  moderationComment?: string;      //  \r\n  schedulePollOpenedAt?: string;\r\n  scheduleConfirmedAt?: string;\r\n  votingOpenedAt?: string;\r\n  votingClosedAt?: string;\r\n  resultsPublishedAt?: string;\r\n  protocolGeneratedAt?: string;\r\n  protocolApprovedAt?: string;\r\n  cancelledAt?: string;\r\n  cancellationReason?: string;\r\n\r\n  // Reminders sent\r\n  remindersSent: {\r\n    type: string;\r\n    sentAt: string;\r\n  }[];\r\n\r\n  // Audit\r\n  notificationLogs: MeetingNotificationLog[];\r\n}\r\n\r\n// Building meeting settings (configurable per building)\r\nexport interface BuildingMeetingSettings {\r\n  buildingId: string;\r\n  votingUnit: VotingUnitType;\r\n  defaultQuorumPercent: number;\r\n  schedulePollDurationDays: number;\r\n  votingDurationHours: number;\r\n  allowResidentInitiative: boolean;\r\n  requireModeration: boolean;\r\n  defaultMeetingTime: string;  // e.g., \"19:00\"\r\n  reminderHoursBefore: number[];\r\n  notificationChannels: ('sms' | 'push' | 'email' | 'in_app')[];\r\n}\r\n\r\n// Apartment/Unit for voting\r\nexport interface VotingUnit {\r\n  id: string;\r\n  buildingId: string;\r\n  apartmentId?: string;        // ID \r\n  apartmentNumber: string;\r\n  totalArea?: number;          //  \r\n  floor?: number;\r\n  entrance?: number;\r\n  ownershipShare: number;      // % of total building (for share-based voting)\r\n  ownerId: string;             // Primary owner user ID\r\n  ownerName?: string;          //  \r\n  coOwnerIds: string[];        // Co-owners user IDs\r\n  residentIds?: string[];      // All residents (including renters)\r\n  isVerified: boolean;         // KYC verified\r\n  verifiedAt?: string;\r\n  verifiedBy?: string;\r\n}\r\n\r\n// Predefined agenda item templates\r\nexport const AGENDA_ITEM_TYPES: Record<AgendaItemType, {\r\n  label: string;\r\n  labelUz: string;\r\n  defaultThreshold: DecisionThreshold;\r\n  requiresMaterials: boolean;\r\n  description: string;\r\n  descriptionUz: string;\r\n}> = {\r\n  budget_approval: {\r\n    label: ' ',\r\n    labelUz: 'Byudjetni tasdiqlash',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: true,\r\n    description: '     ',\r\n    descriptionUz: 'Yillik uy byudjetini ko\\'rib chiqish va tasdiqlash'\r\n  },\r\n  tariff_change: {\r\n    label: ' ',\r\n    labelUz: 'Tariflarni o\\'zgartirish',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: true,\r\n    description: '   ',\r\n    descriptionUz: 'Oylik to\\'lovlar miqdorini o\\'zgartirish'\r\n  },\r\n  major_repair: {\r\n    label: ' ',\r\n    labelUz: 'Asosiy ta\\'mirlash',\r\n    defaultThreshold: 'two_thirds',\r\n    requiresMaterials: true,\r\n    description: '    ',\r\n    descriptionUz: 'Asosiy ta\\'mirlash to\\'g\\'risida qaror'\r\n  },\r\n  common_property: {\r\n    label: ' ',\r\n    labelUz: 'Umumiy mulk',\r\n    defaultThreshold: 'two_thirds',\r\n    requiresMaterials: false,\r\n    description: '   ',\r\n    descriptionUz: 'Umumiy uy mulkidan foydalanish'\r\n  },\r\n  management_contract: {\r\n    label: ' ',\r\n    labelUz: 'Boshqaruv shartnomasi',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: true,\r\n    description: '     ',\r\n    descriptionUz: 'Boshqaruv kompaniyasi bilan shartnoma tuzish yoki o\\'zgartirish'\r\n  },\r\n  chairman_election: {\r\n    label: ' ',\r\n    labelUz: 'Rais saylov',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: false,\r\n    description: '   ',\r\n    descriptionUz: 'Uy kengashi raisi saylovi'\r\n  },\r\n  audit_commission: {\r\n    label: ' ',\r\n    labelUz: 'Taftish komissiyasi',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: false,\r\n    description: '  ',\r\n    descriptionUz: 'Taftish komissiyasini shakllantirish'\r\n  },\r\n  rules_amendment: {\r\n    label: ' ',\r\n    labelUz: 'Qoidalarni o\\'zgartirish',\r\n    defaultThreshold: 'two_thirds',\r\n    requiresMaterials: true,\r\n    description: '    ',\r\n    descriptionUz: 'Uyda yashash qoidalarini o\\'zgartirish'\r\n  },\r\n  landscaping: {\r\n    label: '',\r\n    labelUz: 'Obodonlashtirish',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: true,\r\n    description: '   ',\r\n    descriptionUz: 'Hududni obodonlashtirish ishlari'\r\n  },\r\n  security: {\r\n    label: '  ',\r\n    labelUz: 'Xavfsizlik',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: false,\r\n    description: '    ',\r\n    descriptionUz: 'Uy xavfsizligi masalalari'\r\n  },\r\n  parking: {\r\n    label: '',\r\n    labelUz: 'Avtoturargoh',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: false,\r\n    description: '   ',\r\n    descriptionUz: 'Hududda avtoturargoh tashkil etish'\r\n  },\r\n  other: {\r\n    label: '',\r\n    labelUz: 'Boshqa',\r\n    defaultThreshold: 'simple_majority',\r\n    requiresMaterials: false,\r\n    description: ' ',\r\n    descriptionUz: 'Boshqa masalalar'\r\n  }\r\n};\r\n\r\n// Decision threshold labels\r\nexport const DECISION_THRESHOLD_LABELS: Record<DecisionThreshold, { label: string; labelUz: string; percent: number }> = {\r\n  simple_majority: { label: '  (50%+1)', labelUz: 'Oddiy ko\\'pchilik (50%+1)', percent: 50 },\r\n  qualified_majority: { label: '  (60%)', labelUz: 'Malakali ko\\'pchilik (60%)', percent: 60 },\r\n  two_thirds: { label: '  (66.7%)', labelUz: 'Uchdan ikki (66.7%)', percent: 66.67 },\r\n  three_quarters: { label: '  (75%)', labelUz: 'To\\'rtdan uch (75%)', percent: 75 },\r\n  unanimous: { label: ' (100%)', labelUz: 'Bir ovozdan (100%)', percent: 100 }\r\n};\r\n\r\n// Meeting status labels\r\nexport const MEETING_STATUS_LABELS: Record<MeetingStatus, { label: string; labelUz: string; color: string }> = {\r\n  draft: { label: '', labelUz: 'Qoralama', color: 'gray' },\r\n  pending_moderation: { label: ' ', labelUz: 'Moderatsiyada', color: 'yellow' },\r\n  schedule_poll_open: { label: ' ', labelUz: 'Sana tanlash', color: 'blue' },\r\n  schedule_confirmed: { label: ' ', labelUz: 'Sana tasdiqlangan', color: 'indigo' },\r\n  voting_open: { label: '', labelUz: 'Ovoz berish', color: 'green' },\r\n  voting_closed: { label: ' ', labelUz: 'Ovoz berish yopildi', color: 'orange' },\r\n  results_published: { label: ' ', labelUz: 'Natijalar e\\'lon qilindi', color: 'purple' },\r\n  protocol_generated: { label: ' ', labelUz: 'Bayonnoma tayyor', color: 'teal' },\r\n  protocol_approved: { label: ' ', labelUz: 'Bayonnoma tasdiqlangan', color: 'emerald' },\r\n  cancelled: { label: '', labelUz: 'Bekor qilindi', color: 'red' }\r\n};\r\n\r\n// ============================================\r\n// CRM MODULE -    \r\n// ============================================\r\n\r\n//     \r\nexport interface BuildingFull {\r\n  id: string;\r\n  name: string;\r\n  address: string;\r\n  zone?: string;                   //  / (,   ..)\r\n  cadastralNumber?: string;        //  \r\n  branchCode?: string;             //   (YS, CH, etc.)\r\n  buildingNumber?: string;         //   (8A, 15, etc.)\r\n\r\n  //  \r\n  floors: number;\r\n  entrances: number;\r\n  totalApartments: number;\r\n  totalArea: number;               //   \r\n  livingArea: number;              //   \r\n  commonArea: number;              //   \r\n  landArea?: number;               //   \r\n  yearBuilt: number;\r\n  yearRenovated?: number;\r\n  buildingType: 'panel' | 'brick' | 'monolith' | 'block' | 'wooden' | 'mixed';\r\n  roofType: 'flat' | 'pitched' | 'combined';\r\n  wallMaterial: string;\r\n  foundationType: string;\r\n\r\n  //  \r\n  hasElevator: boolean;\r\n  elevatorCount: number;\r\n  hasGas: boolean;\r\n  heatingType: 'central' | 'individual' | 'autonomous';\r\n  hasHotWater: boolean;\r\n  waterSupplyType: 'central' | 'autonomous';\r\n  sewerageType: 'central' | 'autonomous';\r\n  hasIntercom: boolean;\r\n  hasVideoSurveillance: boolean;\r\n  hasConcierge: boolean;\r\n  hasParkingLot: boolean;\r\n  parkingSpaces: number;\r\n  hasPlayground: boolean;\r\n\r\n  // \r\n  managerId?: string;\r\n  managerName?: string;\r\n  managementStartDate?: string;\r\n  contractNumber?: string;\r\n  contractEndDate?: string;\r\n\r\n  //  \r\n  monthlyBudget: number;\r\n  reserveFund: number;\r\n  totalDebt: number;\r\n  collectionRate: number;          // % \r\n\r\n  // \r\n  residentsCount: number;\r\n  ownersCount: number;\r\n  tenantsCount: number;\r\n  vacantApartments: number;\r\n  activeRequestsCount: number;\r\n\r\n  // \r\n  documents: BuildingDocument[];\r\n\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n//  \r\nexport interface BuildingDocument {\r\n  id: string;\r\n  buildingId: string;\r\n  name: string;\r\n  type: 'contract' | 'act' | 'protocol' | 'passport' | 'license' | 'certificate' | 'other';\r\n  fileUrl: string;\r\n  fileSize: number;\r\n  uploadedAt: string;\r\n  uploadedBy: string;\r\n  expiresAt?: string;\r\n  isActive: boolean;\r\n}\r\n\r\n// \r\nexport interface Entrance {\r\n  id: string;\r\n  buildingId: string;\r\n  number: number;\r\n  floorsFrom: number;\r\n  floorsTo: number;\r\n  apartmentsFrom: number;\r\n  apartmentsTo: number;\r\n  hasElevator: boolean;\r\n  elevatorId?: string;\r\n  intercomType?: 'audio' | 'video' | 'smart' | 'none';\r\n  intercomCode?: string;\r\n  cleaningSchedule?: string;\r\n  responsibleId?: string;          //  \r\n  lastInspection?: string;\r\n  notes?: string;\r\n}\r\n\r\n//  ()\r\nexport interface Apartment {\r\n  id: string;\r\n  buildingId: string;\r\n  entranceId: string;\r\n  number: string;                  //  \r\n  floor: number;\r\n\r\n  // \r\n  rooms: number;\r\n  totalArea: number;               //   \r\n  livingArea: number;              //   \r\n  kitchenArea?: number;\r\n  balconyArea?: number;\r\n  loggiaArea?: number;             //  \r\n  ceilingHeight?: number;          //  \r\n  hasBalcony: boolean;\r\n  hasLoggia: boolean;\r\n  hasStorage?: boolean;            // \r\n  hasParking?: boolean;            // \r\n  parkingNumber?: string;          //  \r\n\r\n  //  \r\n  ownershipType: 'private' | 'municipal' | 'state' | 'cooperative';\r\n  ownershipShare?: number;          //     %\r\n  registrationNumber?: string;     //  \r\n  registrationDate?: string;       //  \r\n  cadastralValue?: number;\r\n\r\n  //  \r\n  status: 'occupied' | 'vacant' | 'rented' | 'commercial' | 'under_repair';\r\n  isCommercial: boolean;           //  \r\n  commercialType?: string;         //   \r\n\r\n  // \r\n  meters: Meter[];\r\n\r\n  // \r\n  personalAccountId?: string;\r\n  primaryOwnerId?: string;\r\n\r\n  notes?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n//  ()\r\nexport interface Meter {\r\n  id: string;\r\n  apartmentId?: string;\r\n  buildingId?: string;             //  \r\n  type: 'cold_water' | 'hot_water' | 'electricity' | 'gas' | 'heat';\r\n  serialNumber: string;\r\n  model?: string;\r\n  brand?: string;                  // /\r\n  manufacturer?: string;\r\n  installDate: string;\r\n  verificationDate: string;\r\n  nextVerificationDate: string;\r\n  sealNumber?: string;\r\n  location: string;\r\n  initialValue: number;\r\n  currentValue: number;\r\n  lastReadingDate?: string;\r\n  isActive: boolean;\r\n  isCommon: boolean;               // \r\n  tariffZone?: string;             //  \r\n  notes?: string;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\n//  \r\nexport interface MeterReading {\r\n  id: string;\r\n  meterId: string;\r\n  apartmentId?: string;\r\n  value: number;\r\n  previousValue: number;\r\n  consumption: number;\r\n  readingDate: string;\r\n  source: 'manual' | 'online' | 'auto' | 'calculated';\r\n  submittedBy?: string;\r\n  submittedAt: string;\r\n  isVerified: boolean;\r\n  verifiedBy?: string;\r\n  verifiedAt?: string;\r\n  photoUrl?: string;\r\n  status?: 'pending' | 'approved' | 'rejected';\r\n  rejectionReason?: string;\r\n  notes?: string;\r\n  createdAt?: string;\r\n}\r\n\r\n// /\r\nexport interface Owner {\r\n  id: string;\r\n\r\n  //  \r\n  type: 'individual' | 'legal_entity';\r\n  lastName: string;\r\n  firstName: string;\r\n  middleName?: string;\r\n  fullName: string;                //    .\r\n\r\n  //  ( )\r\n  passportSeries?: string;\r\n  passportNumber?: string;\r\n  passportIssuedBy?: string;\r\n  passportIssuedDate?: string;\r\n  inn?: string;\r\n  snils?: string;\r\n  birthDate?: string;\r\n  birthPlace?: string;             //  \r\n\r\n  //  .\r\n  companyName?: string;\r\n  ogrn?: string;\r\n  kpp?: string;\r\n  legalAddress?: string;\r\n  directorName?: string;\r\n\r\n  // \r\n  phone: string;\r\n  additionalPhone?: string;        //  \r\n  phoneAdditional?: string;\r\n  email?: string;\r\n  preferredContact: 'phone' | 'sms' | 'email' | 'whatsapp' | 'telegram';\r\n\r\n  //  \r\n  registrationAddress?: string;\r\n  actualAddress?: string;          //  \r\n\r\n  //  \r\n  ownershipType: 'owner' | 'co_owner' | 'tenant' | 'representative';\r\n  ownershipShare?: number;         //  %\r\n  ownershipDocument?: string;      // /\r\n  ownershipDocumentDate?: string;  //  \r\n  ownershipDate?: string;          //   \r\n\r\n  //  \r\n  bankName?: string;\r\n  bankBik?: string;\r\n  bankAccount?: string;\r\n\r\n  // \r\n  apartmentIds: string[];          //    \r\n  personalAccountIds: string[];\r\n\r\n  // \r\n  isActive: boolean;\r\n  isVerified: boolean;\r\n  verifiedAt?: string;\r\n  verifiedBy?: string;\r\n\r\n  // \r\n  notes?: string;\r\n  tags: string[];\r\n\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n//  (   )\r\nexport interface Resident {\r\n  id: string;\r\n  apartmentId: string;\r\n  ownerId?: string;                //   ,  \r\n\r\n  // \r\n  lastName: string;\r\n  firstName: string;\r\n  middleName?: string;\r\n  fullName: string;\r\n  birthDate?: string;\r\n\r\n  //  \r\n  residentType: 'owner' | 'family_member' | 'tenant' | 'registered' | 'temporary';\r\n  relationToOwner?: string;        //   \r\n\r\n  // \r\n  registrationType: 'permanent' | 'temporary' | 'none';\r\n  registrationDate?: string;\r\n  registrationEndDate?: string;\r\n\r\n  // \r\n  phone?: string;\r\n  additionalPhone?: string;        //  \r\n  email?: string;\r\n\r\n  //  \r\n  passportSeries?: string;\r\n  passportNumber?: string;\r\n\r\n  // \r\n  isActive: boolean;\r\n  movedInDate?: string;\r\n  movedOutDate?: string;\r\n  movedOutReason?: string;\r\n\r\n  notes?: string;\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n}\r\n\r\n//  \r\nexport interface PersonalAccount {\r\n  id: string;\r\n  number: string;                  //  \r\n\r\n  // \r\n  apartmentId: string;\r\n  buildingId: string;\r\n  primaryOwnerId: string;\r\n\r\n  // \r\n  ownerName: string;\r\n  apartmentNumber: string;\r\n  address: string;\r\n\r\n  //   \r\n  totalArea: number;\r\n  heatedArea?: number;\r\n  residentsCount: number;\r\n  registeredCount: number;\r\n\r\n  // \r\n  balance: number;                 //   (+ , - )\r\n  currentDebt: number;\r\n  penaltyAmount: number;\r\n  lastPaymentDate?: string;\r\n  lastPaymentAmount?: number;\r\n  lastChargeDate?: string;         //   \r\n  lastChargeAmount?: number;       //   \r\n\r\n  // \r\n  hasSubsidy: boolean;\r\n  subsidyAmount?: number;\r\n  subsidyPercent?: number;         //  \r\n  subsidyEndDate?: string;\r\n  hasDiscount: boolean;\r\n  discountPercent?: number;\r\n  discountReason?: string;\r\n\r\n  // \r\n  status: 'active' | 'closed' | 'blocked' | 'archived';\r\n  blockReason?: string;\r\n  closedAt?: string;               //  \r\n  closedReason?: string;           //  \r\n\r\n  //  \r\n  tariffPlanId?: string;\r\n\r\n  notes?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// ============================================\r\n//   \r\n// ============================================\r\n\r\n//  \r\nexport interface Service {\r\n  id: string;\r\n  code: string;                    //  \r\n  name: string;\r\n  shortName: string;\r\n  category: 'housing' | 'utility' | 'additional' | 'repair' | 'other';\r\n  unit: 'sqm' | 'person' | 'apartment' | 'kwh' | 'cbm' | 'gcal' | 'fixed';\r\n\r\n  // \r\n  isMetered: boolean;              //  \r\n  isActive: boolean;\r\n  sortOrder: number;\r\n}\r\n\r\n// \r\nexport interface Tariff {\r\n  id: string;\r\n  serviceId: string;\r\n  serviceName: string;\r\n  buildingId?: string;             // null =   \r\n\r\n  // \r\n  rate: number;                    //  \r\n  ratePer: 'sqm' | 'person' | 'apartment' | 'unit';\r\n  normative?: number;              //  \r\n  normativeUnit?: string;\r\n\r\n  // \r\n  hasDayNightRates: boolean;\r\n  dayRate?: number;\r\n  nightRate?: number;\r\n\r\n  //  \r\n  effectiveFrom: string;\r\n  effectiveTo?: string;\r\n\r\n  // \r\n  includesVat: boolean;\r\n  vatRate: number;\r\n\r\n  createdAt: string;\r\n  createdBy: string;\r\n}\r\n\r\n// \r\nexport interface Charge {\r\n  id: string;\r\n  personalAccountId: string;\r\n  apartmentId: string;\r\n  buildingId: string;\r\n\r\n  // \r\n  period: string;                  // YYYY-MM\r\n\r\n  // \r\n  serviceId: string;\r\n  serviceName: string;\r\n  tariffId: string;\r\n\r\n  // \r\n  quantity: number;                //  (/-/)\r\n  rate: number;                    // \r\n  amount: number;                  //   \r\n  subsidyAmount: number;           //  \r\n  discountAmount: number;          // \r\n  recalculationAmount: number;     // \r\n  penaltyAmount: number;           // \r\n  totalAmount: number;             //   \r\n\r\n  //  \r\n  meterReadingId?: string;\r\n  previousReading?: number;\r\n  currentReading?: number;\r\n  consumption?: number;\r\n\r\n  // \r\n  status: 'draft' | 'calculated' | 'approved' | 'billed' | 'paid' | 'partially_paid';\r\n\r\n  calculatedAt: string;\r\n  calculatedBy: string;\r\n  approvedAt?: string;\r\n  approvedBy?: string;\r\n}\r\n\r\n//  ()\r\nexport interface Invoice {\r\n  id: string;\r\n  number: string;\r\n  personalAccountId: string;\r\n\r\n  // \r\n  period: string;\r\n  dueDate: string;\r\n\r\n  // \r\n  previousBalance: number;\r\n  totalCharges: number;\r\n  totalPayments: number;\r\n  currentBalance: number;\r\n  amountDue: number;\r\n\r\n  // \r\n  charges: Charge[];\r\n\r\n  // \r\n  status: 'draft' | 'sent' | 'viewed' | 'paid' | 'overdue' | 'cancelled';\r\n  sentAt?: string;\r\n  sentVia?: 'email' | 'sms' | 'post' | 'personal';\r\n  viewedAt?: string;\r\n  paidAt?: string;\r\n\r\n  // QR-  \r\n  qrCode?: string;\r\n  paymentUrl?: string;\r\n\r\n  createdAt: string;\r\n}\r\n\r\n// \r\nexport interface Payment {\r\n  id: string;\r\n  personalAccountId: string;\r\n  invoiceId?: string;\r\n\r\n  // \r\n  amount: number;\r\n\r\n  // \r\n  source: 'bank' | 'card' | 'cash' | 'terminal' | 'online' | 'mobile' | 'auto';\r\n  transactionId?: string;\r\n  bankName?: string;\r\n  payerName?: string;\r\n\r\n  //   \r\n  distribution: {\r\n    chargeId: string;\r\n    serviceId: string;\r\n    amount: number;\r\n  }[];\r\n\r\n  // \r\n  status: 'pending' | 'completed' | 'failed' | 'refunded' | 'cancelled';\r\n\r\n  paymentDate: string;\r\n  processedAt?: string;\r\n  processedBy?: string;\r\n\r\n  notes?: string;\r\n}\r\n\r\n//  \r\nexport interface ReconciliationAct {\r\n  id: string;\r\n  number: string;\r\n  personalAccountId: string;\r\n  ownerName: string;\r\n\r\n  // \r\n  periodFrom: string;\r\n  periodTo: string;\r\n\r\n  // \r\n  openingBalance: number;\r\n  totalCharges: number;\r\n  totalPayments: number;\r\n  closingBalance: number;\r\n\r\n  // \r\n  items: {\r\n    date: string;\r\n    description: string;\r\n    debit: number;\r\n    credit: number;\r\n    balance: number;\r\n  }[];\r\n\r\n  // \r\n  status: 'draft' | 'sent' | 'confirmed' | 'disputed';\r\n\r\n  createdAt: string;\r\n  createdBy: string;\r\n  sentAt?: string;\r\n  confirmedAt?: string;\r\n}\r\n\r\n//  (   )\r\nexport interface DebtClaim {\r\n  id: string;\r\n  number: string;\r\n  personalAccountId: string;\r\n  ownerId: string;\r\n\r\n  // \r\n  debtAmount: number;\r\n  penaltyAmount: number;\r\n  totalAmount: number;\r\n  debtPeriods: string[];           //  \r\n\r\n  //  \r\n  stage: 'reminder' | 'warning' | 'pretrial' | 'court' | 'enforcement' | 'restructured' | 'written_off';\r\n\r\n  //  \r\n  actions: {\r\n    date: string;\r\n    type: 'sms' | 'call' | 'letter' | 'visit' | 'meeting' | 'agreement' | 'court_filing';\r\n    description: string;\r\n    result?: string;\r\n    performedBy: string;\r\n    documents?: string[];\r\n  }[];\r\n\r\n  // \r\n  hasRestructuring: boolean;\r\n  restructuringSchedule?: {\r\n    date: string;\r\n    amount: number;\r\n    isPaid: boolean;\r\n  }[];\r\n\r\n  // \r\n  status: 'active' | 'resolved' | 'court' | 'closed';\r\n  closedReason?: string;\r\n\r\n  assignedTo?: string;\r\n\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// ============================================\r\n// WORKFORCE -  \r\n// ============================================\r\n\r\n//  \r\nexport type WorkType =\r\n  | 'scheduled_maintenance'      //  \r\n  | 'seasonal_inspection'        //  \r\n  | 'emergency_repair'           //  \r\n  | 'current_repair'             //  \r\n  | 'capital_repair'             //  \r\n  | 'cleaning'                   // \r\n  | 'landscaping'                // \r\n  | 'meter_inspection'           //  \r\n  | 'deratization'               // \r\n  | 'disinfection'               // \r\n  | 'fire_safety'                //  \r\n  | 'elevator_maintenance'       //  \r\n  | 'itp_maintenance'            //  \r\n  | 'other';\r\n\r\n// - \r\nexport interface WorkSchedule {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n\r\n  //   \r\n  workType: WorkType;\r\n  category: ExecutorSpecialization;\r\n\r\n  // \r\n  buildingIds: string[];           //   \r\n  scope: 'building' | 'entrance' | 'apartment' | 'common_area' | 'territory';\r\n\r\n  // \r\n  scheduleType: 'once' | 'daily' | 'weekly' | 'monthly' | 'quarterly' | 'yearly' | 'custom';\r\n  startDate: string;\r\n  endDate?: string;\r\n  recurrenceRule?: string;         // RRULE format\r\n  plannedDates: string[];          //  \r\n\r\n  // \r\n  estimatedDuration: number;       // \r\n  requiredWorkers: number;\r\n  assignedTeamId?: string;\r\n  assignedExecutorIds: string[];\r\n\r\n  // \r\n  requiredMaterials: {\r\n    materialId: string;\r\n    quantity: number;\r\n  }[];\r\n  estimatedCost: number;\r\n\r\n  // -\r\n  checklistTemplateId?: string;\r\n\r\n  // \r\n  isActive: boolean;\r\n  isPaused: boolean;\r\n  pauseReason?: string;\r\n\r\n  createdAt: string;\r\n  createdBy: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// / \r\nexport interface WorkOrder {\r\n  id: string;\r\n  number: string;\r\n\r\n  // \r\n  source: 'schedule' | 'request' | 'emergency' | 'inspection' | 'manual';\r\n  scheduleId?: string;\r\n  requestId?: string;\r\n  emergencyId?: string;\r\n\r\n  // \r\n  workType: WorkType;\r\n  category: ExecutorSpecialization;\r\n  title: string;\r\n  description: string;\r\n\r\n  // \r\n  buildingId: string;\r\n  buildingAddress: string;\r\n  entranceId?: string;\r\n  apartmentId?: string;\r\n  location: string;                //  \r\n\r\n  // \r\n  plannedStartDate: string;\r\n  plannedEndDate: string;\r\n  actualStartDate?: string;\r\n  actualEndDate?: string;\r\n\r\n  // \r\n  assignedTeamId?: string;\r\n  assignedExecutorIds: string[];\r\n  primaryExecutorId?: string;\r\n\r\n  // \r\n  plannedMaterials: {\r\n    materialId: string;\r\n    materialName: string;\r\n    quantity: number;\r\n    unit: string;\r\n    unitCost: number;\r\n    totalCost: number;\r\n  }[];\r\n  actualMaterials: {\r\n    materialId: string;\r\n    materialName: string;\r\n    quantity: number;\r\n    unit: string;\r\n    unitCost: number;\r\n    totalCost: number;\r\n    warehouseId: string;\r\n  }[];\r\n\r\n  // \r\n  plannedLabor: number;            // -\r\n  actualLabor: number;\r\n  laborCost: number;\r\n\r\n  // \r\n  estimatedCost: number;\r\n  actualCost: number;\r\n\r\n  // -\r\n  checklist: ChecklistItem[];\r\n  checklistCompletedAt?: string;\r\n\r\n  // \r\n  photosBefore: WorkPhoto[];\r\n  photosAfter: WorkPhoto[];\r\n  photosProcess: WorkPhoto[];\r\n\r\n  // \r\n  executorSignature?: string;\r\n  residentSignature?: string;\r\n  managerSignature?: string;\r\n\r\n  // \r\n  status: 'draft' | 'planned' | 'assigned' | 'in_progress' | 'paused' | 'completed' | 'verified' | 'cancelled';\r\n  priority: 'low' | 'normal' | 'high' | 'urgent';\r\n\r\n  // /\r\n  cancelledAt?: string;\r\n  cancelledBy?: string;\r\n  cancelReason?: string;\r\n\r\n  // \r\n  rating?: number;\r\n  feedback?: string;\r\n\r\n  createdAt: string;\r\n  createdBy: string;\r\n  updatedAt: string;\r\n}\r\n\r\n//  -\r\nexport interface ChecklistItem {\r\n  id: string;\r\n  order: number;\r\n  title: string;\r\n  description?: string;\r\n  isRequired: boolean;\r\n  isCompleted: boolean;\r\n  completedAt?: string;\r\n  completedBy?: string;\r\n  notes?: string;\r\n  photoRequired: boolean;\r\n  photoId?: string;\r\n}\r\n\r\n//  \r\nexport interface WorkPhoto {\r\n  id: string;\r\n  workOrderId: string;\r\n  type: 'before' | 'after' | 'process' | 'defect' | 'materials';\r\n  url: string;\r\n  thumbnailUrl: string;\r\n  takenAt: string;\r\n  takenBy: string;\r\n  geoLocation?: {\r\n    latitude: number;\r\n    longitude: number;\r\n  };\r\n  notes?: string;\r\n}\r\n\r\n//  -\r\nexport interface ChecklistTemplate {\r\n  id: string;\r\n  name: string;\r\n  workType: WorkType;\r\n  category: ExecutorSpecialization;\r\n  items: {\r\n    order: number;\r\n    title: string;\r\n    description?: string;\r\n    isRequired: boolean;\r\n    photoRequired: boolean;\r\n  }[];\r\n  isActive: boolean;\r\n  createdAt: string;\r\n  createdBy: string;\r\n}\r\n\r\n// ============================================\r\n//   \r\n// ============================================\r\n\r\n// \r\nexport interface Warehouse {\r\n  id: string;\r\n  name: string;\r\n  address: string;\r\n  type: 'main' | 'building' | 'mobile';\r\n  buildingId?: string;\r\n  responsibleId: string;\r\n  responsibleName: string;\r\n  isActive: boolean;\r\n}\r\n\r\n// \r\nexport interface Material {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  category: string;\r\n  unit: string;\r\n\r\n  // \r\n  averageCost: number;\r\n  lastPurchasePrice: number;\r\n\r\n  // \r\n  totalQuantity: number;\r\n  reservedQuantity: number;\r\n  availableQuantity: number;\r\n  minQuantity: number;             //  \r\n\r\n  // \r\n  manufacturer?: string;\r\n  specifications?: string;\r\n  shelfLife?: number;              //    \r\n\r\n  isActive: boolean;\r\n}\r\n\r\n//    \r\nexport interface StockItem {\r\n  id: string;\r\n  warehouseId: string;\r\n  materialId: string;\r\n  quantity: number;\r\n  reservedQuantity: number;\r\n  lotNumber?: string;\r\n  expirationDate?: string;\r\n  location?: string;               // /\r\n  lastMovementAt: string;\r\n}\r\n\r\n//  \r\nexport interface StockMovement {\r\n  id: string;\r\n  warehouseId: string;\r\n  materialId: string;\r\n\r\n  type: 'receipt' | 'issue' | 'transfer' | 'write_off' | 'inventory' | 'return';\r\n  quantity: number;\r\n\r\n  // \r\n  workOrderId?: string;\r\n  purchaseOrderId?: string;\r\n  transferFromWarehouseId?: string;\r\n\r\n  // \r\n  unitCost: number;\r\n  totalCost: number;\r\n  lotNumber?: string;\r\n\r\n  // \r\n  performedBy: string;\r\n  performedAt: string;\r\n  approvedBy?: string;\r\n  approvedAt?: string;\r\n\r\n  notes?: string;\r\n}\r\n\r\n// ============================================\r\n// - \r\n// ============================================\r\n\r\n//  \r\nexport type EmergencyType =\r\n  | 'water_leak'                 //  \r\n  | 'water_main_break'           //  \r\n  | 'sewage_backup'              //  \r\n  | 'no_water'                   //  \r\n  | 'no_hot_water'               //   \r\n  | 'power_outage'               //  \r\n  | 'electrical_short'           //  \r\n  | 'gas_leak'                   //  \r\n  | 'elevator_stuck'             //   \r\n  | 'elevator_malfunction'       //  \r\n  | 'heating_failure'            //  \r\n  | 'fire'                       // \r\n  | 'flooding'                   // \r\n  | 'roof_leak'                  //  \r\n  | 'door_lock_failure'          //   \r\n  | 'intercom_failure'           //   \r\n  | 'other';\r\n\r\n//  \r\nexport interface EmergencyRequest {\r\n  id: string;\r\n  number: string;\r\n\r\n  //   \r\n  emergencyType: EmergencyType;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n\r\n  // \r\n  title: string;\r\n  description: string;\r\n\r\n  // \r\n  buildingId: string;\r\n  buildingAddress: string;\r\n  entranceId?: string;\r\n  apartmentId?: string;\r\n  apartmentNumber?: string;\r\n  floor?: number;\r\n  location: string;\r\n\r\n  // \r\n  reporterId?: string;\r\n  reporterName: string;\r\n  reporterPhone: string;\r\n  reporterType: 'resident' | 'employee' | 'security' | 'anonymous' | 'auto';\r\n\r\n  //  \r\n  receivedAt: string;\r\n  receivedBy: string;\r\n  receivedVia: 'phone' | 'app' | 'web' | 'sms' | 'intercom' | 'auto';\r\n\r\n  // \r\n  dispatchedAt?: string;\r\n  dispatchedBy?: string;\r\n  assignedTeamId?: string;\r\n  assignedExecutorIds: string[];\r\n\r\n  //  \r\n  estimatedArrival?: string;\r\n  actualArrival?: string;\r\n\r\n  // \r\n  workStartedAt?: string;\r\n  workCompletedAt?: string;\r\n\r\n  // \r\n  resolution?: string;\r\n  workOrderId?: string;\r\n  requiresFollowUp: boolean;\r\n  followUpWorkOrderId?: string;\r\n\r\n  // -  \r\n  scenarioChecklist: {\r\n    step: string;\r\n    isCompleted: boolean;\r\n    completedAt?: string;\r\n    notes?: string;\r\n  }[];\r\n\r\n  // \r\n  status: 'received' | 'dispatched' | 'en_route' | 'on_site' | 'in_progress' | 'completed' | 'cancelled' | 'false_alarm';\r\n\r\n  // \r\n  causeCategory?: string;\r\n  rootCause?: string;\r\n  preventionMeasures?: string;\r\n\r\n  // /\r\n  photos: string[];\r\n  documents: string[];\r\n\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  closedAt?: string;\r\n  closedBy?: string;\r\n}\r\n\r\n//  \r\nexport interface EmergencyScenario {\r\n  id: string;\r\n  emergencyType: EmergencyType;\r\n  name: string;\r\n  description: string;\r\n\r\n  // - \r\n  steps: {\r\n    order: number;\r\n    action: string;\r\n    description: string;\r\n    isRequired: boolean;\r\n    timeLimit?: number;            // \r\n  }[];\r\n\r\n  // \r\n  notifications: {\r\n    role: UserRole;\r\n    channel: 'sms' | 'push' | 'call' | 'email';\r\n    template: string;\r\n    delayMinutes: number;\r\n  }[];\r\n\r\n  // SLA\r\n  responseTimeMinutes: number;\r\n  resolutionTimeMinutes: number;\r\n\r\n  isActive: boolean;\r\n}\r\n\r\n// ============================================\r\n//    KPI\r\n// ============================================\r\n\r\n// KPI \r\nexport interface KPIMetric {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  description: string;\r\n\r\n  //   \r\n  type: 'time' | 'percentage' | 'count' | 'rating' | 'money';\r\n  aggregation: 'avg' | 'sum' | 'min' | 'max' | 'count' | 'latest';\r\n  formula?: string;\r\n\r\n  //  \r\n  targetValue: number;\r\n  warningThreshold: number;\r\n  criticalThreshold: number;\r\n  isHigherBetter: boolean;\r\n\r\n  // \r\n  category: 'response' | 'resolution' | 'quality' | 'financial' | 'satisfaction';\r\n  applicableTo: 'executor' | 'team' | 'building' | 'company';\r\n\r\n  isActive: boolean;\r\n}\r\n\r\n//  KPI\r\nexport interface KPIValue {\r\n  id: string;\r\n  metricId: string;\r\n\r\n  // \r\n  period: string;                  // YYYY-MM  YYYY-WW\r\n  periodType: 'day' | 'week' | 'month' | 'quarter' | 'year';\r\n\r\n  // \r\n  subjectType: 'executor' | 'team' | 'building' | 'company';\r\n  subjectId: string;\r\n  subjectName: string;\r\n\r\n  // \r\n  value: number;\r\n  targetValue: number;\r\n  previousValue?: number;\r\n\r\n  // \r\n  status: 'green' | 'yellow' | 'red';\r\n  trend: 'up' | 'down' | 'stable';\r\n\r\n  calculatedAt: string;\r\n}\r\n\r\n//  /\r\nexport interface DelayReason {\r\n  id: string;\r\n  requestId?: string;\r\n  workOrderId?: string;\r\n\r\n  category: 'no_access' | 'no_materials' | 'wrong_category' | 'overload' | 'waiting_approval' | 'external' | 'other';\r\n  description: string;\r\n\r\n  delayMinutes: number;\r\n\r\n  reportedBy: string;\r\n  reportedAt: string;\r\n\r\n  isResolved: boolean;\r\n  resolution?: string;\r\n  resolvedAt?: string;\r\n}\r\n\r\n// /  \r\nexport interface QualityComplaint {\r\n  id: string;\r\n  number: string;\r\n\r\n  // \r\n  relatedTo: 'request' | 'work_order' | 'service' | 'employee' | 'other';\r\n  relatedId?: string;\r\n\r\n  // \r\n  complainantId: string;\r\n  complainantName: string;\r\n  complainantPhone: string;\r\n\r\n  // \r\n  category: 'quality' | 'timeliness' | 'behavior' | 'damage' | 'billing' | 'other';\r\n  description: string;\r\n\r\n  // \r\n  assignedTo?: string;\r\n  investigation?: string;\r\n  resolution?: string;\r\n\r\n  // \r\n  compensationType?: 'none' | 'refund' | 'discount' | 'free_service' | 'other';\r\n  compensationAmount?: number;\r\n  compensationDescription?: string;\r\n\r\n  // \r\n  status: 'new' | 'investigating' | 'resolved' | 'rejected' | 'escalated';\r\n  priority: 'low' | 'normal' | 'high';\r\n\r\n  createdAt: string;\r\n  resolvedAt?: string;\r\n  resolvedBy?: string;\r\n}\r\n\r\n// ============================================\r\n//    \r\n// ============================================\r\n\r\n//  \r\nexport type ExtendedUserRole =\r\n  | 'super_admin'                // - ( )\r\n  | 'admin'                      //  \r\n  | 'director'                   // \r\n  | 'accountant'                 // \r\n  | 'chief_engineer'             //  \r\n  | 'dispatcher'                 // \r\n  | 'manager'                    //     \r\n  | 'foreman'                    // /\r\n  | 'executor'                   // \r\n  | 'resident'                   // \r\n  | 'owner_representative';      //  \r\n\r\n// \r\nexport interface Permission {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  description: string;\r\n  module: 'crm' | 'requests' | 'workforce' | 'finance' | 'emergency' | 'reports' | 'settings' | 'audit';\r\n  action: 'view' | 'create' | 'edit' | 'delete' | 'approve' | 'export' | 'manage';\r\n}\r\n\r\n//   \r\nexport interface Role {\r\n  id: string;\r\n  code: ExtendedUserRole;\r\n  name: string;\r\n  description: string;\r\n\r\n  permissions: string[];           // Permission IDs\r\n\r\n  //   \r\n  buildingScope: 'all' | 'assigned' | 'none';\r\n  canViewFinancials: boolean;\r\n  canViewPersonalData: boolean;\r\n  canExportData: boolean;\r\n\r\n  isSystem: boolean;               //   ( )\r\n  isActive: boolean;\r\n\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n//   ()\r\nexport interface AuditLog {\r\n  id: string;\r\n\r\n  // \r\n  userId: string;\r\n  userName: string;\r\n  userRole: string;\r\n  ipAddress?: string;\r\n  userAgent?: string;\r\n  sessionId?: string;\r\n\r\n  // \r\n  action: 'create' | 'read' | 'update' | 'delete' | 'login' | 'logout' | 'export' | 'approve' | 'reject' | 'assign' | 'other';\r\n  module: string;\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n\r\n  //  \r\n  previousValue?: Record<string, unknown>;\r\n  newValue?: Record<string, unknown>;\r\n  changedFields?: string[];\r\n\r\n  // \r\n  status: 'success' | 'failure' | 'partial';\r\n  errorMessage?: string;\r\n\r\n  // \r\n  buildingId?: string;\r\n  requestId?: string;\r\n\r\n  timestamp: string;\r\n}\r\n\r\n// ============================================\r\n//    \r\n// ============================================\r\n\r\nexport const WORK_TYPE_LABELS: Record<WorkType, string> = {\r\n  scheduled_maintenance: ' ',\r\n  seasonal_inspection: ' ',\r\n  emergency_repair: ' ',\r\n  current_repair: ' ',\r\n  capital_repair: ' ',\r\n  cleaning: '',\r\n  landscaping: '',\r\n  meter_inspection: ' ',\r\n  deratization: '',\r\n  disinfection: '',\r\n  fire_safety: ' ',\r\n  elevator_maintenance: ' ',\r\n  itp_maintenance: ' ',\r\n  other: ''\r\n};\r\n\r\nexport const EMERGENCY_TYPE_LABELS: Record<EmergencyType, string> = {\r\n  water_leak: ' ',\r\n  water_main_break: ' ',\r\n  sewage_backup: ' ',\r\n  no_water: ' ',\r\n  no_hot_water: '  ',\r\n  power_outage: ' ',\r\n  electrical_short: ' ',\r\n  gas_leak: ' ',\r\n  elevator_stuck: '  ',\r\n  elevator_malfunction: ' ',\r\n  heating_failure: ' ',\r\n  fire: '',\r\n  flooding: '',\r\n  roof_leak: ' ',\r\n  door_lock_failure: '  ',\r\n  intercom_failure: '  ',\r\n  other: ''\r\n};\r\n\r\nexport const ROLE_LABELS: Record<ExtendedUserRole, string> = {\r\n  super_admin: '-',\r\n  admin: '',\r\n  director: '',\r\n  accountant: '',\r\n  chief_engineer: ' ',\r\n  dispatcher: '',\r\n  manager: '',\r\n  foreman: '',\r\n  executor: '',\r\n  resident: '',\r\n  owner_representative: ' '\r\n};\r\n\r\nexport const BUILDING_TYPE_LABELS: Record<BuildingFull['buildingType'], string> = {\r\n  panel: '',\r\n  brick: '',\r\n  monolith: '',\r\n  block: '',\r\n  wooden: '',\r\n  mixed: ''\r\n};\r\n\r\nexport const SERVICE_CATEGORY_LABELS: Record<Service['category'], string> = {\r\n  housing: ' ',\r\n  utility: ' ',\r\n  additional: ' ',\r\n  repair: ' ',\r\n  other: ''\r\n};\r\n\r\nexport const DEBT_STAGE_LABELS: Record<DebtClaim['stage'], string> = {\r\n  reminder: '',\r\n  warning: '',\r\n  pretrial: ' ',\r\n  court: ' ',\r\n  enforcement: ' ',\r\n  restructured: '',\r\n  written_off: ''\r\n};\r\n\r\n// ============================================\r\n//  \r\n// ============================================\r\n\r\n//   \r\nexport type TrainingProposalStatus =\r\n  | 'voting'        //  \r\n  | 'review'        //  ( )\r\n  | 'approved'      //  \r\n  | 'scheduled'     //  \r\n  | 'completed'     // \r\n  | 'rejected';     // \r\n\r\n//  \r\nexport type TrainingFormat = 'online' | 'offline' | 'any';\r\n\r\n//  \r\nexport type TrainingTimeSlot = 'morning' | 'afternoon' | 'evening' | 'weekend';\r\n\r\n//  \r\nexport type ParticipationIntent = 'definitely' | 'maybe' | 'support_only';\r\n\r\n//  ()\r\nexport interface Partner {\r\n  id: string;\r\n  name: string;\r\n  position: string;\r\n  specialization?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  bio?: string;\r\n  avatar?: string;\r\n  avatarUrl?: string;\r\n  isActive: boolean;\r\n  trainingsonducted?: number;\r\n  averageRating?: number;\r\n}\r\n\r\n//    \r\nexport interface TrainingVote {\r\n  id: string;\r\n  proposalId: string;\r\n  voterId: string;\r\n  voterName: string;\r\n  participationIntent: ParticipationIntent;\r\n  isAnonymous: boolean;\r\n  votedAt: string;\r\n}\r\n\r\n//  \r\nexport interface TrainingProposal {\r\n  id: string;\r\n\r\n  //  \r\n  topic: string;\r\n  description?: string;\r\n\r\n  // \r\n  authorId: string;\r\n  authorName: string;\r\n  isAuthorAnonymous: boolean;\r\n\r\n  // \r\n  partnerId: string;\r\n  partnerName: string;\r\n  format: TrainingFormat;\r\n  preferredTimeSlots: TrainingTimeSlot[];\r\n\r\n  // \r\n  votes: TrainingVote[];\r\n  voteThreshold: number; //   \r\n\r\n  // \r\n  status: TrainingProposalStatus;\r\n  partnerResponse?: 'accepted' | 'rejected';\r\n  partnerResponseAt?: string;\r\n  partnerResponseNote?: string;\r\n\r\n  //  \r\n  scheduledDate?: string;\r\n  scheduledTime?: string;\r\n  scheduledLocation?: string;\r\n  scheduledLink?: string; //  \r\n\r\n  // \r\n  maxParticipants?: number;\r\n  registeredParticipants?: string[];\r\n\r\n  // \r\n  feedback?: TrainingFeedback[];\r\n\r\n  // \r\n  createdAt: string;\r\n  updatedAt: string;\r\n  completedAt?: string;\r\n  actualParticipantsCount?: number;\r\n\r\n  // Computed fields from API\r\n  voteCount?: number;\r\n  registeredCount?: number;\r\n}\r\n\r\n//   \r\nexport interface TrainingFeedback {\r\n  id: string;\r\n  proposalId: string;\r\n  reviewerId: string;\r\n  reviewerName: string;\r\n  isAnonymous: boolean;\r\n  rating: number; // 1-5\r\n  contentRating?: number;\r\n  presenterRating?: number;\r\n  usefulnessRating?: number;\r\n  comment?: string;\r\n  createdAt: string;\r\n}\r\n\r\n//   \r\nexport interface TrainingNotification {\r\n  id: string;\r\n  type:\r\n    | 'new_proposal'           //  \r\n    | 'threshold_reached'      //   \r\n    | 'partner_response'       //  \r\n    | 'training_scheduled'     //  \r\n    | 'reminder_day_before'    //   \r\n    | 'reminder_hour_before'   //   \r\n    | 'feedback_request';      //  \r\n  proposalId: string;\r\n  recipientId: string;\r\n  recipientRole: 'employee' | 'partner' | 'admin';\r\n  title: string;\r\n  message: string;\r\n  isRead: boolean;\r\n  createdAt: string;\r\n}\r\n\r\n//   \r\nexport interface TrainingSettings {\r\n  voteThreshold: number;           //     (  5)\r\n  allowAnonymousProposals: boolean;\r\n  allowAnonymousVotes: boolean;\r\n  allowAnonymousFeedback: boolean;\r\n  notifyAllOnNewProposal: boolean;\r\n  autoCloseAfterDays?: number;     //   \r\n}\r\n\r\n//   UI\r\nexport const TRAINING_STATUS_LABELS: Record<TrainingProposalStatus, { label: string; labelUz: string; color: string }> = {\r\n  voting: { label: '', labelUz: 'Ovoz berish', color: 'blue' },\r\n  review: { label: '', labelUz: 'Ko\\'rib chiqish', color: 'yellow' },\r\n  approved: { label: '', labelUz: 'Tasdiqlangan', color: 'green' },\r\n  scheduled: { label: '', labelUz: 'Belgilangan', color: 'purple' },\r\n  completed: { label: '', labelUz: 'O\\'tkazildi', color: 'gray' },\r\n  rejected: { label: '', labelUz: 'Rad etilgan', color: 'red' },\r\n};\r\n\r\nexport const TRAINING_FORMAT_LABELS: Record<TrainingFormat, { label: string; labelUz: string }> = {\r\n  online: { label: '', labelUz: 'Onlayn' },\r\n  offline: { label: '', labelUz: 'Oflayn' },\r\n  any: { label: '', labelUz: 'Farqi yo\\'q' },\r\n};\r\n\r\nexport const TRAINING_TIME_LABELS: Record<TrainingTimeSlot, { label: string; labelUz: string }> = {\r\n  morning: { label: '', labelUz: 'Ertalab' },\r\n  afternoon: { label: '', labelUz: 'Kunduzi' },\r\n  evening: { label: '', labelUz: 'Kechqurun' },\r\n  weekend: { label: '', labelUz: 'Dam olish kuni' },\r\n};\r\n\r\nexport const PARTICIPATION_LABELS: Record<ParticipationIntent, { label: string; labelUz: string }> = {\r\n  definitely: { label: ' ', labelUz: 'Albatta kelaman' },\r\n  maybe: { label: ' ', labelUz: 'Balki kelaman' },\r\n  support_only: { label: ' ', labelUz: 'Faqat qo\\'llab-quvvatlayman' },\r\n};\r\n\r\n// ============================================\r\n// VEHICLES MODULE -  \r\n// ============================================\r\n\r\nexport type VehicleType = 'car' | 'motorcycle' | 'truck' | 'other';\r\nexport type VehicleOwnerType = 'individual' | 'legal_entity' | 'service';\r\n\r\nexport interface Vehicle {\r\n  id: string;\r\n  ownerId: string;           // ID    ( )\r\n  ownerName: string;\r\n  ownerPhone: string;\r\n  apartment: string;\r\n  address: string;\r\n  plateNumber: string;       //   (01A123BC)\r\n  brand: string;             //  (Toyota, Chevrolet, etc)\r\n  model: string;             //  (Camry, Nexia, etc)\r\n  color: string;             // \r\n  year?: number;             //  \r\n  type: VehicleType;\r\n  ownerType: VehicleOwnerType; //  : , , \r\n  companyName?: string;      //   ( /)\r\n  parkingSpot?: string;      //   \r\n  notes?: string;            // \r\n  createdAt: string;\r\n  updatedAt?: string;\r\n}\r\n\r\nexport const VEHICLE_TYPE_LABELS: Record<VehicleType, { label: string; labelUz: string }> = {\r\n  car: { label: ' ', labelUz: 'Yengil avtomobil' },\r\n  motorcycle: { label: '', labelUz: 'Mototsikl' },\r\n  truck: { label: '', labelUz: 'Yuk mashinasi' },\r\n  other: { label: '', labelUz: 'Boshqa' },\r\n};\r\n\r\nexport const VEHICLE_OWNER_TYPE_LABELS: Record<VehicleOwnerType, { label: string; labelUz: string; icon: string }> = {\r\n  individual: { label: '. ', labelUz: 'Jismoniy shaxs', icon: '' },\r\n  legal_entity: { label: '. ', labelUz: 'Yuridik shaxs', icon: '' },\r\n  service: { label: '', labelUz: 'Xizmat', icon: '' },\r\n};\r\n\r\n// ============================================\r\n// GUEST QR ACCESS MODULE - QR-  \r\n// ============================================\r\n\r\n//  \r\nexport type VisitorType = 'courier' | 'guest' | 'taxi' | 'other';\r\n\r\n//   (  )\r\nexport type AccessType = 'single_use' | 'day' | 'week' | 'custom';\r\n\r\n//  QR-\r\nexport type GuestAccessStatus = 'active' | 'expired' | 'used' | 'revoked';\r\n\r\n// QR-  \r\nexport interface GuestAccessCode {\r\n  id: string;\r\n\r\n  //  ()\r\n  residentId: string;\r\n  residentName: string;\r\n  residentPhone: string;\r\n  residentApartment: string;\r\n  residentAddress: string;\r\n\r\n  //  \r\n  visitorType: VisitorType;\r\n  visitorName?: string;          //   (  /)\r\n  visitorPhone?: string;         //  ()\r\n  visitorVehiclePlate?: string;  //    ( )\r\n\r\n  //  \r\n  accessType: AccessType;\r\n  validFrom: string;             // ISO datetime -  \r\n  validUntil: string;            // ISO datetime -  \r\n  maxUses: number;               // .   (1  single_use)\r\n  currentUses: number;           //   \r\n\r\n  // QR-\r\n  qrToken: string;               //    QR (UUID + )\r\n  qrImageUrl?: string;           // URL  QR \r\n\r\n  // \r\n  status: GuestAccessStatus;\r\n\r\n  //   ( revoked)\r\n  revokedAt?: string;\r\n  revokedBy?: string;\r\n  revokedByName?: string;\r\n  revokedByRole?: UserRole;\r\n  revocationReason?: string;\r\n\r\n  //   \r\n  notes?: string;\r\n\r\n  // \r\n  createdAt: string;\r\n  updatedAt?: string;\r\n  lastUsedAt?: string;\r\n}\r\n\r\n//   QR-\r\nexport interface GuestAccessLog {\r\n  id: string;\r\n  accessCodeId: string;\r\n\r\n  //  \r\n  scannedById: string;\r\n  scannedByName: string;\r\n  scannedByRole: UserRole;       // security, manager, admin\r\n\r\n  //  \r\n  action: 'scan_success' | 'scan_expired' | 'scan_used' | 'scan_revoked' | 'scan_invalid' | 'entry_allowed' | 'entry_denied';\r\n\r\n  //    \r\n  visitorType: VisitorType;\r\n  residentName: string;\r\n  residentApartment: string;\r\n\r\n  // \r\n  notes?: string;\r\n\r\n  //   ()\r\n  geoLocation?: {\r\n    latitude: number;\r\n    longitude: number;\r\n  };\r\n\r\n  // \r\n  timestamp: string;\r\n}\r\n\r\n//     \r\nexport interface GuestAccessStats {\r\n  totalActive: number;           //  \r\n  totalUsedToday: number;        //  \r\n  totalCreatedToday: number;     //  \r\n  byVisitorType: {\r\n    courier: number;\r\n    guest: number;\r\n    taxi: number;\r\n    other: number;\r\n  };\r\n  recentScans: GuestAccessLog[]; //  \r\n}\r\n\r\n//   \r\nexport interface GuestAccessLimits {\r\n  maxActivePerResident: number;  // .    \r\n  maxDayPassDuration: number;    // .    ()\r\n  maxWeekPassDuration: number;   // .    ()\r\n  maxCustomDuration: number;     // .    ()\r\n  allowVehiclePlate: boolean;    //    \r\n}\r\n\r\n//   UI\r\nexport const VISITOR_TYPE_LABELS: Record<VisitorType, { label: string; labelUz: string; icon: string }> = {\r\n  courier: { label: '', labelUz: 'Kuryer', icon: '' },\r\n  guest: { label: '', labelUz: 'Mehmon', icon: '' },\r\n  taxi: { label: '', labelUz: 'Taksi', icon: '' },\r\n  other: { label: '', labelUz: 'Boshqa', icon: '' },\r\n};\r\n\r\nexport const ACCESS_TYPE_LABELS: Record<AccessType, { label: string; labelUz: string; description: string; descriptionUz: string }> = {\r\n  single_use: {\r\n    label: '',\r\n    labelUz: 'Bir martalik',\r\n    description: '   ',\r\n    descriptionUz: 'Birinchi foydalanishgacha amal qiladi'\r\n  },\r\n  day: {\r\n    label: ' ',\r\n    labelUz: 'Kunlik',\r\n    description: '   ',\r\n    descriptionUz: 'Kun oxirigacha amal qiladi'\r\n  },\r\n  week: {\r\n    label: ' ',\r\n    labelUz: 'Haftalik',\r\n    description: ' 7 ',\r\n    descriptionUz: '7 kun amal qiladi'\r\n  },\r\n  custom: {\r\n    label: ' ',\r\n    labelUz: 'Maxsus muddat',\r\n    description: '  ',\r\n    descriptionUz: 'Amal qilish muddatini belgilang'\r\n  },\r\n};\r\n\r\nexport const GUEST_ACCESS_STATUS_LABELS: Record<GuestAccessStatus, { label: string; labelUz: string; color: string }> = {\r\n  active: { label: '', labelUz: 'Faol', color: 'green' },\r\n  expired: { label: '', labelUz: 'Muddati tugagan', color: 'gray' },\r\n  used: { label: '', labelUz: 'Ishlatilgan', color: 'blue' },\r\n  revoked: { label: '', labelUz: 'Bekor qilingan', color: 'red' },\r\n};\r\n\r\nexport const GUEST_ACCESS_LOG_ACTION_LABELS: Record<GuestAccessLog['action'], { label: string; labelUz: string; color: string }> = {\r\n  scan_success: { label: ' ', labelUz: 'Muvaffaqiyatli skanerlash', color: 'green' },\r\n  scan_expired: { label: ' ', labelUz: 'Ruxsatnoma muddati tugagan', color: 'orange' },\r\n  scan_used: { label: '  ', labelUz: 'Ruxsatnoma ishlatilgan', color: 'yellow' },\r\n  scan_revoked: { label: ' ', labelUz: 'Ruxsatnoma bekor qilingan', color: 'red' },\r\n  scan_invalid: { label: ' QR', labelUz: 'Noto\\'g\\'ri QR', color: 'red' },\r\n  entry_allowed: { label: ' ', labelUz: 'Kirish ruxsat etildi', color: 'green' },\r\n  entry_denied: { label: ' ', labelUz: 'Kirish rad etildi', color: 'red' },\r\n};\r\n\r\n// ============================================\r\n// RESCHEDULE/FEEDBACK SYSTEM -  \r\n// ============================================\r\n\r\n//    \r\nexport type RescheduleRequestStatus = 'pending' | 'accepted' | 'rejected' | 'expired';\r\n\r\n//   \r\nexport type RescheduleInitiator = 'resident' | 'executor';\r\n\r\n//  \r\nexport type RescheduleReason =\r\n  | 'busy_time'           //    \r\n  | 'emergency'           //  \r\n  | 'not_at_home'         //   \r\n  | 'need_preparation'    //    \r\n  | 'other';              // \r\n\r\n//     \r\nexport interface RescheduleRequest {\r\n  id: string;\r\n  requestId: string;              // ID \r\n  requestNumber: number | string; //     (   , e.g. YS-1001)\r\n\r\n  // \r\n  initiator: RescheduleInitiator;\r\n  initiatorId: string;\r\n  initiatorName: string;\r\n\r\n  //  (   )\r\n  recipientId: string;\r\n  recipientName: string;\r\n  recipientRole: 'resident' | 'executor';\r\n\r\n  //   \r\n  currentDate?: string;\r\n  currentTime?: string;\r\n\r\n  //   \r\n  proposedDate: string;\r\n  proposedTime: string;\r\n\r\n  //  \r\n  reason: RescheduleReason;\r\n  reasonText?: string;            //  \r\n\r\n  // \r\n  status: RescheduleRequestStatus;\r\n\r\n  // \r\n  respondedAt?: string;\r\n  responseNote?: string;          //   /\r\n\r\n  // \r\n  createdAt: string;\r\n  expiresAt: string;              //    24 \r\n}\r\n\r\n//    (  )\r\nexport type RescheduleNotificationType =\r\n  | 'reschedule_requested'        //  \r\n  | 'reschedule_accepted'         //  \r\n  | 'reschedule_rejected'         //  \r\n  | 'reschedule_expired';         //  \r\n\r\n//   \r\nexport const RESCHEDULE_REASON_LABELS: Record<RescheduleReason, { label: string; labelUz: string }> = {\r\n  busy_time: { label: '   ', labelUz: 'Bu vaqtda band' },\r\n  emergency: { label: ' ', labelUz: 'Kutilmagan holat' },\r\n  not_at_home: { label: '  ', labelUz: 'Uyda bo\\'lmayman' },\r\n  need_preparation: { label: '   ', labelUz: 'Tayyorgarlik kerak' },\r\n  other: { label: ' ', labelUz: 'Boshqa sabab' },\r\n};\r\n\r\nexport const RESCHEDULE_STATUS_LABELS: Record<RescheduleRequestStatus, { label: string; labelUz: string; color: string }> = {\r\n  pending: { label: ' ', labelUz: 'Javob kutilmoqda', color: 'yellow' },\r\n  accepted: { label: '', labelUz: 'Qabul qilindi', color: 'green' },\r\n  rejected: { label: '', labelUz: 'Rad etildi', color: 'red' },\r\n  expired: { label: ' ', labelUz: 'Muddati tugadi', color: 'gray' },\r\n};\r\n\r\n// ============================================\r\n// MARKETPLACE TYPES\r\n// ============================================\r\n\r\nexport type MarketplaceOrderStatus =\r\n  | 'new'           //  \r\n  | 'confirmed'     // \r\n  | 'preparing'     // \r\n  | 'ready'         //   \r\n  | 'delivering'    // \r\n  | 'delivered'     // \r\n  | 'cancelled';    // \r\n\r\nexport interface MarketplaceCategory {\r\n  id: string;\r\n  name: string;\r\n  nameUz: string;\r\n  icon: string;\r\n  sortOrder: number;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface MarketplaceProduct {\r\n  id: string;\r\n  categoryId: string;\r\n  categoryName?: string;\r\n  categoryNameUz?: string;\r\n  name: string;\r\n  nameUz: string;\r\n  description?: string;\r\n  descriptionUz?: string;\r\n  price: number;\r\n  unit: string;        // , , , \r\n  unitUz: string;\r\n  image?: string;\r\n  images?: string[];   //  \r\n  stock: number;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface MarketplaceCartItem {\r\n  id: string;\r\n  productId: string;\r\n  product?: MarketplaceProduct;\r\n  quantity: number;\r\n  addedAt: string;\r\n}\r\n\r\nexport interface MarketplaceOrder {\r\n  id: string;\r\n  orderNumber: string;  // MKT-2024-00001\r\n  residentId: string;\r\n  residentName?: string;\r\n  residentPhone?: string;\r\n  residentAddress?: string;\r\n  residentApartment?: string;\r\n  status: MarketplaceOrderStatus;\r\n  items: MarketplaceOrderItem[];\r\n  totalAmount: number;\r\n  itemsCount: number;\r\n  deliveryNote?: string;\r\n  rating?: number;\r\n  feedback?: string;\r\n  createdAt: string;\r\n  confirmedAt?: string;\r\n  preparingAt?: string;\r\n  readyAt?: string;\r\n  deliveringAt?: string;\r\n  deliveredAt?: string;\r\n  cancelledAt?: string;\r\n  cancellationReason?: string;\r\n}\r\n\r\nexport interface MarketplaceOrderItem {\r\n  id: string;\r\n  orderId: string;\r\n  productId: string;\r\n  productName?: string;\r\n  productNameUz?: string;\r\n  productImage?: string;\r\n  quantity: number;\r\n  price: number;\r\n  total: number;\r\n}\r\n\r\nexport interface MarketplaceFavorite {\r\n  id: string;\r\n  productId: string;\r\n  product?: MarketplaceProduct;\r\n  addedAt: string;\r\n}\r\n\r\nexport interface MarketplaceReview {\r\n  id: string;\r\n  productId: string;\r\n  residentId: string;\r\n  residentName?: string;\r\n  orderId: string;\r\n  rating: number;\r\n  comment?: string;\r\n  createdAt: string;\r\n}\r\n\r\nexport const MARKETPLACE_ORDER_STATUS_LABELS: Record<MarketplaceOrderStatus, { label: string; labelUz: string; color: string }> = {\r\n  new: { label: '', labelUz: 'Yangi', color: 'blue' },\r\n  confirmed: { label: '', labelUz: 'Tasdiqlandi', color: 'indigo' },\r\n  preparing: { label: '', labelUz: 'Tayyorlanmoqda', color: 'yellow' },\r\n  ready: { label: '  ', labelUz: 'Berishga tayyor', color: 'orange' },\r\n  delivering: { label: '', labelUz: 'Yetkazilmoqda', color: 'purple' },\r\n  delivered: { label: '', labelUz: 'Yetkazildi', color: 'green' },\r\n  cancelled: { label: '', labelUz: 'Bekor qilindi', color: 'red' },\r\n};\r\n\r\nexport const MARKETPLACE_CATEGORY_ICONS: Record<string, string> = {\r\n  groceries: '',\r\n  dairy: '',\r\n  meat: '',\r\n  bakery: '',\r\n  fruits: '',\r\n  vegetables: '',\r\n  beverages: '',\r\n  household: '',\r\n  personal: '',\r\n  baby: '',\r\n  pets: '',\r\n  frozen: '',\r\n  snacks: '',\r\n};\r\n","import { useState, useEffect, useRef } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Bell, Clock, Search, Lock, Phone, FileText, Car, ChevronRight, Megaphone, Users } from 'lucide-react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useDataStore } from '../../stores/dataStore';\r\nimport { useMeetingStore } from '../../stores/meetingStore';\r\nimport { SPECIALIZATION_LABELS } from '../../types';\r\nimport type { ExecutorSpecialization } from '../../types';\r\n\r\n// Onboarding tasks for residents\r\ninterface OnboardingTask {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  icon: React.ReactNode;\r\n  route: string;\r\n  checkComplete: (user: any, vehicles: any[]) => boolean;\r\n}\r\n\r\n// NOTE: Onboarding completion is now tracked in the database (password_changed_at, contract_signed_at)\r\n// This ensures the status persists across devices and browsers.\r\n// The markOnboardingComplete function is kept for backward compatibility but the primary\r\n// source of truth is now the user object from the API.\r\n\r\n// Mark action as completed (legacy - kept for backward compatibility during transition)\r\nexport const markOnboardingComplete = (userId: string, action: string): void => {\r\n  // This is now handled by the API automatically\r\n  // password_changed_at is set when user changes password\r\n  // contract_signed_at is set when user downloads contract\r\n  console.log(`[Onboarding] Action ${action} for user ${userId} - now tracked in DB`);\r\n};\r\n\r\nconst ONBOARDING_TASKS: OnboardingTask[] = [\r\n  {\r\n    id: 'change_password',\r\n    title: ' ',\r\n    description: '     ',\r\n    icon: <Lock className=\"w-5 h-5 text-amber-500\" />,\r\n    route: '/profile',\r\n    // Check if user has changed password (stored in DB - passwordChangedAt field)\r\n    checkComplete: (user) => !!user?.passwordChangedAt,\r\n  },\r\n  {\r\n    id: 'add_phone',\r\n    title: '  ',\r\n    description: '    ',\r\n    icon: <Phone className=\"w-5 h-5 text-blue-500\" />,\r\n    route: '/profile',\r\n    checkComplete: (user) => !!user?.phone && user.phone.length > 5,\r\n  },\r\n  {\r\n    id: 'sign_contract',\r\n    title: ' ',\r\n    description: '     ',\r\n    icon: <FileText className=\"w-5 h-5 text-green-500\" />,\r\n    route: '/', // Goes to dashboard where contract section is\r\n    // Check if user has downloaded contract (stored in DB - contractSignedAt field)\r\n    checkComplete: (user) => !!user?.contractSignedAt,\r\n  },\r\n  {\r\n    id: 'add_vehicle',\r\n    title: ' ',\r\n    description: '    ',\r\n    icon: <Car className=\"w-5 h-5 text-purple-500\" />,\r\n    route: '/vehicles',\r\n    checkComplete: (user, vehicles) => vehicles.some(v => v.ownerId === user?.id),\r\n  },\r\n];\r\n\r\nexport function Header() {\r\n  const { user } = useAuthStore();\r\n  const { notifications, requests, vehicles, getUnreadCount, markNotificationAsRead, markAllNotificationsAsRead, getAnnouncementsForResidents, getAnnouncementsForEmployees } = useDataStore();\r\n  const { meetings } = useMeetingStore();\r\n  const navigate = useNavigate();\r\n  const [showNotifications, setShowNotifications] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n  const sentRemindersRef = useRef<Set<string>>(new Set());\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [showSearchResults, setShowSearchResults] = useState(false);\r\n\r\n  // Get pending onboarding tasks for residents - tasks stay until completed\r\n  // Check for 'resident' role (case-insensitive) or tenant\r\n  const isResident = user?.role?.toLowerCase() === 'resident' || user?.role?.toLowerCase() === 'tenant';\r\n  // Check if user is tenant or commercial_owner (rental users - don't have access to requests)\r\n  const isRentalUser = user?.role === 'tenant' || user?.role === 'commercial_owner';\r\n  const pendingOnboardingTasks = isResident\r\n    ? ONBOARDING_TASKS.filter(task => !task.checkComplete(user, vehicles))\r\n    : [];\r\n\r\n  // Get unread announcements count\r\n  const userAnnouncements = isResident\r\n    ? getAnnouncementsForResidents(user?.login || '', user?.buildingId || '', user?.entrance || '', user?.floor || '', user?.branch || '')\r\n    : getAnnouncementsForEmployees();\r\n  const unreadAnnouncementsCount = userAnnouncements.filter(a => !a.viewedBy.includes(user?.id || '')).length;\r\n\r\n  // Get upcoming meetings count (meetings in next 7 days that user hasn't seen)\r\n  const nowDate = new Date();\r\n  const weekFromNow = new Date(nowDate.getTime() + 7 * 24 * 60 * 60 * 1000);\r\n  const upcomingMeetings = meetings.filter(m => {\r\n    if (!m.confirmedDateTime) return false;\r\n    const meetingDate = new Date(m.confirmedDateTime);\r\n    return meetingDate >= nowDate && meetingDate <= weekFromNow && m.status !== 'cancelled';\r\n  });\r\n  const unreadMeetingsCount = upcomingMeetings.length;\r\n\r\n  const handleTaskClick = (task: OnboardingTask) => {\r\n    setShowNotifications(false);\r\n    navigate(task.route);\r\n  };\r\n\r\n  // Update clock every second\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      setCurrentTime(new Date());\r\n    }, 1000);\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  // Check for upcoming scheduled requests (every minute)\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    const checkUpcomingRequests = () => {\r\n      const currentUser = useAuthStore.getState().user;\r\n      const { requests: currentRequests, executors: currentExecutors, addNotification: notify } = useDataStore.getState();\r\n\r\n      if (!currentUser) return;\r\n\r\n      const now = new Date();\r\n      const tenMinutesLater = new Date(now.getTime() + 10 * 60 * 1000);\r\n      const fiveMinutesLater = new Date(now.getTime() + 5 * 60 * 1000);\r\n\r\n      // Get requests that are relevant to current user\r\n      const relevantRequests = currentRequests.filter(r => {\r\n        if (!r.scheduledDate || !r.scheduledTime) return false;\r\n        if (!['assigned', 'accepted'].includes(r.status)) return false;\r\n\r\n        // For executors - their assigned requests\r\n        if (currentUser.role === 'executor') {\r\n          const executor = currentExecutors.find(e => e.login === currentUser.login);\r\n          return r.executorId === executor?.id;\r\n        }\r\n        // For residents - their own requests\r\n        if (currentUser.role === 'resident') {\r\n          return r.residentId === currentUser.id;\r\n        }\r\n        return false;\r\n      });\r\n\r\n      relevantRequests.forEach(request => {\r\n        // Parse scheduled time (format: \"09:00-12:00\" or \"14:00\")\r\n        const timeStr = request.scheduledTime!;\r\n        const startTime = timeStr.split('-')[0]; // Take start time\r\n        const [hours, minutes] = startTime.split(':').map(Number);\r\n\r\n        const scheduledDateTime = new Date(request.scheduledDate!);\r\n        scheduledDateTime.setHours(hours, minutes, 0, 0);\r\n\r\n        const reminderKey = `${request.id}-10min`;\r\n        const reminder5Key = `${request.id}-5min`;\r\n\r\n        // 10-minute reminder\r\n        if (scheduledDateTime > now && scheduledDateTime <= tenMinutesLater && !sentRemindersRef.current.has(reminderKey)) {\r\n          const minutesUntil = Math.round((scheduledDateTime.getTime() - now.getTime()) / 60000);\r\n\r\n          notify({\r\n            userId: currentUser.id,\r\n            type: 'request_assigned',\r\n            title: `:  ${minutesUntil} `,\r\n            message: ` #${request.number} \"${request.title}\"   ${startTime}. ${request.address}, . ${request.apartment}`,\r\n            requestId: request.id,\r\n          });\r\n\r\n          sentRemindersRef.current.add(reminderKey);\r\n        }\r\n\r\n        // 5-minute reminder (more urgent)\r\n        if (scheduledDateTime > now && scheduledDateTime <= fiveMinutesLater && !sentRemindersRef.current.has(reminder5Key)) {\r\n          const minutesUntil = Math.round((scheduledDateTime.getTime() - now.getTime()) / 60000);\r\n\r\n          if (minutesUntil <= 5 && !sentRemindersRef.current.has(reminderKey)) {\r\n            notify({\r\n              userId: currentUser.id,\r\n              type: 'request_assigned',\r\n              title: `:  ${minutesUntil} !`,\r\n              message: ` #${request.number}   ${minutesUntil} ! : ${request.address}, . ${request.apartment}`,\r\n              requestId: request.id,\r\n            });\r\n          }\r\n\r\n          sentRemindersRef.current.add(reminder5Key);\r\n        }\r\n      });\r\n    };\r\n\r\n    // Check immediately and then every minute\r\n    checkUpcomingRequests();\r\n    const reminderTimer = setInterval(checkUpcomingRequests, 60000);\r\n    return () => clearInterval(reminderTimer);\r\n  }, [user?.id]);\r\n\r\n  const unreadCount = user ? getUnreadCount(user.id) : 0;\r\n  const totalBadgeCount = unreadCount + pendingOnboardingTasks.length + unreadAnnouncementsCount + unreadMeetingsCount;\r\n  const userNotifications = notifications.filter(n => n.userId === user?.id).slice(0, 10);\r\n\r\n  // Format current time\r\n  const formatCurrentTime = () => {\r\n    return currentTime.toLocaleTimeString('ru-RU', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      second: '2-digit'\r\n    });\r\n  };\r\n\r\n  const formatCurrentDate = () => {\r\n    return currentTime.toLocaleDateString('ru-RU', {\r\n      weekday: 'short',\r\n      day: 'numeric',\r\n      month: 'short'\r\n    });\r\n  };\r\n\r\n  const getRoleLabel = () => {\r\n    switch (user?.role) {\r\n      case 'admin': return '';\r\n      case 'manager': return '';\r\n      case 'department_head': return `  ${SPECIALIZATION_LABELS[user?.specialization as ExecutorSpecialization] || ''}`.trim();\r\n      case 'executor': return SPECIALIZATION_LABELS[user?.specialization as ExecutorSpecialization] || '';\r\n      case 'resident': return '';\r\n      default: return '';\r\n    }\r\n  };\r\n\r\n  const formatTime = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n    const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n    if (diffMins < 1) return ' ';\r\n    if (diffMins < 60) return `${diffMins}  `;\r\n    if (diffHours < 24) return `${diffHours}  `;\r\n    if (diffDays < 7) return `${diffDays}  `;\r\n    return date.toLocaleDateString('ru-RU');\r\n  };\r\n\r\n  const getNotificationIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'request_created': return '';\r\n      case 'request_assigned': return '';\r\n      case 'request_accepted': return '';\r\n      case 'request_started': return '';\r\n      case 'request_completed': return '';\r\n      case 'request_approved': return '';\r\n      case 'request_rejected': return '';\r\n      case 'request_cancelled': return '';\r\n      case 'request_declined': return '';\r\n      default: return '';\r\n    }\r\n  };\r\n\r\n  // Search functionality\r\n  const searchResults = searchQuery.trim()\r\n    ? requests.filter(r =>\r\n        r.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        r.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        r.number.toString().includes(searchQuery) ||\r\n        r.residentName.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        r.address.toLowerCase().includes(searchQuery.toLowerCase())\r\n      ).slice(0, 5)\r\n    : [];\r\n\r\n  // Handle clock click - navigate based on user role\r\n  const handleClockClick = () => {\r\n    if (user?.role === 'executor') {\r\n      // For executors - go to schedule view\r\n      navigate('/');\r\n      // Will need to trigger schedule view in ExecutorDashboard\r\n      window.dispatchEvent(new CustomEvent('openSchedule'));\r\n    } else if (user?.role === 'resident') {\r\n      // For residents - go to my requests\r\n      navigate('/');\r\n    } else {\r\n      // For managers/admins - go to requests page\r\n      navigate('/requests');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <header className=\"h-16 glass-card rounded-none border-x-0 border-t-0 flex items-center justify-between px-6\">\r\n      <div className=\"flex items-center gap-4\">\r\n        {/* Hide search for rental users (tenant/commercial_owner) - they don't have requests */}\r\n        {!isRentalUser && (\r\n        <div className=\"relative\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\" ...\"\r\n            value={searchQuery}\r\n            onChange={(e) => {\r\n              setSearchQuery(e.target.value);\r\n              setShowSearchResults(e.target.value.trim().length > 0);\r\n            }}\r\n            onFocus={() => searchQuery.trim() && setShowSearchResults(true)}\r\n            className=\"glass-input pl-10 w-64\"\r\n          />\r\n          {/* Search Results Dropdown */}\r\n          {showSearchResults && createPortal(\r\n            <div className=\"search-results-portal\">\r\n              <div\r\n                className=\"fixed inset-0\"\r\n                onClick={() => setShowSearchResults(false)}\r\n              />\r\n              <div\r\n                className=\"fixed left-[280px] top-14 w-96 bg-white rounded-xl border border-gray-200 shadow-xl overflow-hidden\"\r\n                style={{ zIndex: 10002 }}\r\n              >\r\n                {searchResults.length === 0 ? (\r\n                  <div className=\"p-4 text-center text-gray-500\">\r\n                    <Search className=\"w-8 h-8 mx-auto mb-2 text-gray-300\" />\r\n                    <p>  </p>\r\n                  </div>\r\n                ) : (\r\n                  <div>\r\n                    <div className=\"p-2 bg-gray-50 border-b text-xs text-gray-500\">\r\n                      : {searchResults.length} \r\n                    </div>\r\n                    {searchResults.map((request) => (\r\n                      <div\r\n                        key={request.id}\r\n                        onClick={() => {\r\n                          navigate('/requests');\r\n                          setShowSearchResults(false);\r\n                          setSearchQuery('');\r\n                        }}\r\n                        className=\"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0\"\r\n                      >\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-xs text-gray-400\">#{request.number}</span>\r\n                          <span className=\"font-medium text-sm\">{request.title}</span>\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 mt-1\">{request.address}, . {request.apartment}</div>\r\n                        <div className=\"flex items-center gap-2 mt-1\">\r\n                          <span className={`text-xs px-2 py-0.5 rounded-full ${\r\n                            request.status === 'new' ? 'bg-blue-100 text-blue-700' :\r\n                            request.status === 'in_progress' ? 'bg-amber-100 text-amber-700' :\r\n                            request.status === 'completed' ? 'bg-green-100 text-green-700' :\r\n                            'bg-gray-100 text-gray-700'\r\n                          }`}>\r\n                            {request.status === 'new' ? '' :\r\n                             request.status === 'in_progress' ? ' ' :\r\n                             request.status === 'completed' ? '' :\r\n                             request.status}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>,\r\n            document.body\r\n          )}\r\n        </div>\r\n        )}\r\n      </div>\r\n      <div className=\"flex items-center gap-4\">\r\n        {/* Current Time Clock - clickable */}\r\n        <button\r\n          onClick={handleClockClick}\r\n          className=\"flex items-center gap-2 px-3 py-1.5 bg-white/50 rounded-xl border border-white/30 hover:bg-white/70 transition-colors cursor-pointer\"\r\n          title=\"  \"\r\n        >\r\n          <Clock className=\"w-4 h-4 text-primary-600\" />\r\n          <div className=\"text-right\">\r\n            <div className=\"text-sm font-mono font-semibold text-gray-800\">{formatCurrentTime()}</div>\r\n            <div className=\"text-xs text-gray-500\">{formatCurrentDate()}</div>\r\n          </div>\r\n        </button>\r\n\r\n        {/* Notifications Button */}\r\n        <div className=\"relative\">\r\n          <button\r\n            onClick={() => setShowNotifications(!showNotifications)}\r\n            className=\"p-2 hover:bg-white/30 rounded-lg relative\"\r\n          >\r\n            <Bell className=\"w-5 h-5 text-gray-600\" />\r\n            {totalBadgeCount > 0 && (\r\n              <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center\">\r\n                {totalBadgeCount > 9 ? '9+' : totalBadgeCount}\r\n              </span>\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"text-right\">\r\n          <div className=\"text-sm font-medium\">{user?.name}</div>\r\n          <div className=\"text-xs text-gray-500\">{getRoleLabel()}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Notifications Portal - rendered at body level for proper z-index */}\r\n      {showNotifications && createPortal(\r\n        <div className=\"notifications-portal\">\r\n          {/* Backdrop */}\r\n          <div\r\n            className=\"fixed inset-0 bg-black/20\"\r\n            style={{ zIndex: 10000 }}\r\n            onClick={() => setShowNotifications(false)}\r\n          />\r\n          {/* Dropdown */}\r\n          <div\r\n            className=\"fixed right-6 top-20 w-96 bg-white rounded-2xl border border-gray-200 shadow-2xl overflow-hidden flex flex-col\"\r\n            style={{ zIndex: 10001, maxHeight: 'calc(100vh - 100px)' }}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"p-4 border-b border-gray-200 flex items-center justify-between bg-gray-50\">\r\n              <h3 className=\"font-semibold text-lg\"></h3>\r\n              {unreadCount > 0 && (\r\n                <button\r\n                  onClick={() => user && markAllNotificationsAsRead(user.id)}\r\n                  className=\"text-sm text-blue-600 hover:text-blue-800\"\r\n                >\r\n                   \r\n                </button>\r\n              )}\r\n            </div>\r\n\r\n            {/* Onboarding Tasks for Residents */}\r\n            {pendingOnboardingTasks.length > 0 && (\r\n              <div className=\"border-b border-gray-200\">\r\n                <div className=\"px-4 py-2 bg-amber-50 border-b border-amber-100\">\r\n                  <p className=\"text-xs font-medium text-amber-700\"> </p>\r\n                </div>\r\n                {pendingOnboardingTasks.map((task) => (\r\n                  <div\r\n                    key={task.id}\r\n                    onClick={() => handleTaskClick(task)}\r\n                    className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"flex-shrink-0 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center\">\r\n                        {task.icon}\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <h4 className=\"font-medium text-sm text-gray-900\">{task.title}</h4>\r\n                        <p className=\"text-xs text-gray-500 mt-0.5\">{task.description}</p>\r\n                      </div>\r\n                      <ChevronRight className=\"w-4 h-4 text-gray-400 flex-shrink-0\" />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Announcements Section */}\r\n            {unreadAnnouncementsCount > 0 && (\r\n              <div className=\"border-b border-gray-200\">\r\n                <div className=\"px-4 py-2 bg-blue-50 border-b border-blue-100\">\r\n                  <p className=\"text-xs font-medium text-blue-700 flex items-center gap-1\">\r\n                    <Megaphone className=\"w-3 h-3\" />\r\n                     ({unreadAnnouncementsCount})\r\n                  </p>\r\n                </div>\r\n                {userAnnouncements.filter(a => !a.viewedBy.includes(user?.id || '')).slice(0, 3).map((announcement) => (\r\n                  <div\r\n                    key={announcement.id}\r\n                    onClick={() => {\r\n                      setShowNotifications(false);\r\n                      navigate(isResident ? '/announcements' : '/staff/announcements');\r\n                    }}\r\n                    className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 bg-blue-50/50\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                        <Megaphone className=\"w-5 h-5 text-blue-600\" />\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <h4 className=\"font-medium text-sm text-gray-900 truncate\">{announcement.title}</h4>\r\n                        <p className=\"text-xs text-gray-500 mt-0.5 line-clamp-1\">{announcement.content}</p>\r\n                      </div>\r\n                      <span className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0\" />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Meetings Section */}\r\n            {unreadMeetingsCount > 0 && (\r\n              <div className=\"border-b border-gray-200\">\r\n                <div className=\"px-4 py-2 bg-purple-50 border-b border-purple-100\">\r\n                  <p className=\"text-xs font-medium text-purple-700 flex items-center gap-1\">\r\n                    <Users className=\"w-3 h-3\" />\r\n                     ({unreadMeetingsCount})\r\n                  </p>\r\n                </div>\r\n                {upcomingMeetings.slice(0, 3).map((meeting) => (\r\n                  <div\r\n                    key={meeting.id}\r\n                    onClick={() => {\r\n                      setShowNotifications(false);\r\n                      navigate(isResident ? '/meetings' : '/staff/meetings');\r\n                    }}\r\n                    className=\"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 bg-purple-50/50\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center\">\r\n                        <Users className=\"w-5 h-5 text-purple-600\" />\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <h4 className=\"font-medium text-sm text-gray-900 truncate\">\r\n                            {meeting.buildingAddress}\r\n                        </h4>\r\n                        <p className=\"text-xs text-gray-500 mt-0.5\">\r\n                          {meeting.confirmedDateTime ? new Date(meeting.confirmedDateTime).toLocaleDateString('ru-RU', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' }) : ' '}\r\n                        </p>\r\n                      </div>\r\n                      <span className=\"w-2 h-2 bg-purple-500 rounded-full flex-shrink-0\" />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Notifications List */}\r\n            <div className=\"overflow-y-auto flex-1\" style={{ maxHeight: '400px' }}>\r\n              {userNotifications.length === 0 && pendingOnboardingTasks.length === 0 && unreadAnnouncementsCount === 0 && unreadMeetingsCount === 0 ? (\r\n                <div className=\"p-8 text-center text-gray-500\">\r\n                  <Bell className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\r\n                  <p> </p>\r\n                </div>\r\n              ) : userNotifications.length === 0 ? (\r\n                null\r\n              ) : (\r\n                userNotifications.map((notification) => (\r\n                  <div\r\n                    key={notification.id}\r\n                    onClick={() => {\r\n                      if (!notification.read) {\r\n                        markNotificationAsRead(notification.id);\r\n                      }\r\n                    }}\r\n                    className={`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors ${\r\n                      !notification.read ? 'bg-blue-50' : 'bg-white'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex gap-3\">\r\n                      <span className=\"text-2xl flex-shrink-0\">{getNotificationIcon(notification.type)}</span>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-start justify-between gap-2\">\r\n                          <h4 className={`font-medium text-sm ${!notification.read ? 'text-gray-900' : 'text-gray-600'}`}>\r\n                            {notification.title}\r\n                          </h4>\r\n                          {!notification.read && (\r\n                            <span className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-1.5\" />\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 mt-0.5 line-clamp-2\">\r\n                          {notification.message}\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-400 mt-1\">\r\n                          {formatTime(notification.createdAt)}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            {userNotifications.length > 0 && (\r\n              <div className=\"p-3 border-t border-gray-200 bg-gray-50\">\r\n                <button\r\n                  onClick={() => setShowNotifications(false)}\r\n                  className=\"w-full text-center text-sm text-gray-600 hover:text-gray-900\"\r\n                >\r\n                  \r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </header>\r\n  );\r\n}\r\n","import { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useDataStore } from '../stores/dataStore';\r\nimport { apiRequest } from '../services/api';\r\nimport type { PopupType } from '../components/PopupNotification';\r\n\r\n// Interface for marketplace orders\r\ninterface MarketplaceOrderForNotification {\r\n  id: string;\r\n  order_number: string;\r\n  status: string;\r\n  rating?: number;\r\n}\r\n\r\nexport interface PopupItem {\r\n  id: string;\r\n  type: PopupType;\r\n  title: string;\r\n  message: string;\r\n  actionLabel?: string;\r\n  onAction?: () => void;\r\n}\r\n\r\n// Store shown popup IDs in sessionStorage to persist across re-renders but not page reloads\r\nconst getShownIds = (): Set<string> => {\r\n  try {\r\n    const stored = sessionStorage.getItem('shown_popup_ids');\r\n    return stored ? new Set(JSON.parse(stored)) : new Set();\r\n  } catch {\r\n    return new Set();\r\n  }\r\n};\r\n\r\nconst saveShownId = (id: string) => {\r\n  try {\r\n    const shown = getShownIds();\r\n    shown.add(id);\r\n    sessionStorage.setItem('shown_popup_ids', JSON.stringify([...shown]));\r\n  } catch {\r\n    // Ignore\r\n  }\r\n};\r\n\r\nexport function usePopupNotifications() {\r\n  const { user } = useAuthStore();\r\n  const {\r\n    announcements,\r\n    getAnnouncementsForResidents,\r\n    markAnnouncementAsViewed,\r\n    requests,\r\n  } = useDataStore();\r\n\r\n  const [popups, setPopups] = useState<PopupItem[]>([]);\r\n  const processedRef = useRef(false);\r\n\r\n  // Check for new urgent announcements (for residents)\r\n  useEffect(() => {\r\n    // Only run once per mount\r\n    if (processedRef.current) return;\r\n\r\n    if (!user || user.role !== 'resident') {\r\n      return;\r\n    }\r\n\r\n    console.log('[PopupNotifications] Checking for resident:', user.login);\r\n    console.log('[PopupNotifications] All announcements:', announcements.length);\r\n\r\n    // Get announcements for this resident\r\n    const relevantAnnouncements = getAnnouncementsForResidents(\r\n      user.login,\r\n      user.buildingId,\r\n      user.entrance,\r\n      user.floor,\r\n      user.branch\r\n    );\r\n\r\n    console.log('[PopupNotifications] Relevant announcements:', relevantAnnouncements.length);\r\n\r\n    const shownIds = getShownIds();\r\n\r\n    // Filter important/urgent announcements not yet shown\r\n    const urgentAnnouncements = relevantAnnouncements.filter(a => {\r\n      const isUrgent = a.priority === 'urgent' || a.priority === 'important';\r\n      const notViewed = !a.viewedBy.includes(user.id);\r\n      const notShown = !shownIds.has(`announcement-${a.id}`);\r\n      console.log(`[PopupNotifications] Announcement \"${a.title}\": urgent=${isUrgent}, notViewed=${notViewed}, notShown=${notShown}`);\r\n      return isUrgent && notViewed && notShown;\r\n    });\r\n\r\n    console.log('[PopupNotifications] Urgent to show:', urgentAnnouncements.length);\r\n\r\n    // Create popups for new announcements\r\n    const newPopups: PopupItem[] = urgentAnnouncements.map(a => {\r\n      const isMeeting = /|||/i.test(a.title + ' ' + a.content);\r\n\r\n      saveShownId(`announcement-${a.id}`);\r\n\r\n      return {\r\n        id: `announcement-${a.id}`,\r\n        type: isMeeting ? 'announcement_meeting' : 'announcement_urgent',\r\n        title: a.title,\r\n        message: a.content.length > 200 ? a.content.substring(0, 200) + '...' : a.content,\r\n        actionLabel: '',\r\n        onAction: () => {\r\n          markAnnouncementAsViewed(a.id, user.id);\r\n        },\r\n      };\r\n    });\r\n\r\n    if (newPopups.length > 0) {\r\n      console.log('[PopupNotifications] Adding popups:', newPopups);\r\n      setPopups(prev => [...prev, ...newPopups]);\r\n    }\r\n\r\n    processedRef.current = true;\r\n  }, [user, announcements, getAnnouncementsForResidents, markAnnouncementAsViewed]);\r\n\r\n  // Check for requests pending approval (for residents)\r\n  useEffect(() => {\r\n    if (!user || user.role !== 'resident') {\r\n      return;\r\n    }\r\n\r\n    const shownIds = getShownIds();\r\n\r\n    // Find requests that are pending approval for this resident\r\n    const pendingApproval = requests.filter(r =>\r\n      r.residentId === user.id &&\r\n      r.status === 'pending_approval' &&\r\n      !shownIds.has(`request-completed-${r.id}`)\r\n    );\r\n\r\n    console.log('[PopupNotifications] Pending approval requests:', pendingApproval.length);\r\n\r\n    const newPopups: PopupItem[] = pendingApproval.map(r => {\r\n      saveShownId(`request-completed-${r.id}`);\r\n\r\n      return {\r\n        id: `request-completed-${r.id}`,\r\n        type: 'request_completed' as PopupType,\r\n        title: ' !',\r\n        message: ` ${r.number}: ${r.executorName || ''}  . ,     .`,\r\n        actionLabel: ' ',\r\n        onAction: () => {\r\n          // Store request ID to open rating modal directly\r\n          sessionStorage.setItem('open_rating_for_request', r.id);\r\n          // Navigate to home page where ResidentDashboard is mounted\r\n          // ResidentDashboard will check sessionStorage on mount/update\r\n          if (window.location.pathname !== '/') {\r\n            window.location.href = '/';\r\n          } else {\r\n            // Already on home page, dispatch event\r\n            window.dispatchEvent(new CustomEvent('openRatingModal', { detail: { requestId: r.id } }));\r\n          }\r\n        },\r\n      };\r\n    });\r\n\r\n    if (newPopups.length > 0) {\r\n      console.log('[PopupNotifications] Adding request popups:', newPopups);\r\n      setPopups(prev => [...prev, ...newPopups]);\r\n    }\r\n  }, [user, requests]);\r\n\r\n  // Check for delivered marketplace orders that need rating (for residents) - with polling\r\n  useEffect(() => {\r\n    if (!user || user.role !== 'resident') {\r\n      return;\r\n    }\r\n\r\n    const checkDeliveredOrders = async () => {\r\n      try {\r\n        const response = await apiRequest<{ orders: MarketplaceOrderForNotification[] }>('/api/marketplace/orders?status=delivered');\r\n        const deliveredOrders = response?.orders || [];\r\n\r\n        const shownIds = getShownIds();\r\n\r\n        // Filter delivered orders that haven't been rated and popup not shown\r\n        const unratedDelivered = deliveredOrders.filter(o =>\r\n          o.status === 'delivered' &&\r\n          !o.rating &&\r\n          !shownIds.has(`delivery-completed-${o.id}`)\r\n        );\r\n\r\n        console.log('[PopupNotifications] Unrated delivered orders:', unratedDelivered.length);\r\n\r\n        const newPopups: PopupItem[] = unratedDelivered.map(o => {\r\n          saveShownId(`delivery-completed-${o.id}`);\r\n\r\n          return {\r\n            id: `delivery-completed-${o.id}`,\r\n            type: 'delivery_completed' as PopupType,\r\n            title: ' !',\r\n            message: `  ${o.order_number}  . ,  .`,\r\n            actionLabel: ' ',\r\n            onAction: () => {\r\n              // Store order ID to open rating modal\r\n              sessionStorage.setItem('open_delivery_rating_for_order', o.id);\r\n              // Navigate to marketplace page or dispatch event\r\n              if (window.location.pathname !== '/marketplace') {\r\n                window.location.href = '/marketplace';\r\n              } else {\r\n                window.dispatchEvent(new CustomEvent('openDeliveryRatingModal', { detail: { orderId: o.id } }));\r\n              }\r\n            },\r\n          };\r\n        });\r\n\r\n        if (newPopups.length > 0) {\r\n          console.log('[PopupNotifications] Adding delivery popups:', newPopups);\r\n          setPopups(prev => [...prev, ...newPopups]);\r\n        }\r\n      } catch (err) {\r\n        console.error('[PopupNotifications] Error checking delivered orders:', err);\r\n      }\r\n    };\r\n\r\n    // Check immediately on mount\r\n    checkDeliveredOrders();\r\n\r\n    // Poll every 15 seconds for new delivered orders\r\n    const interval = setInterval(checkDeliveredOrders, 15000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [user]);\r\n\r\n  const dismissPopup = useCallback((id: string) => {\r\n    setPopups(prev => prev.filter(p => p.id !== id));\r\n  }, []);\r\n\r\n  const addPopup = useCallback((popup: Omit<PopupItem, 'id'>) => {\r\n    const id = `custom-${Date.now()}`;\r\n    setPopups(prev => [...prev, { ...popup, id }]);\r\n  }, []);\r\n\r\n  return {\r\n    popups,\r\n    dismissPopup,\r\n    addPopup,\r\n  };\r\n}\r\n","import { useEffect, useRef, useCallback } from 'react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useDataStore } from '../stores/dataStore';\r\nimport { useMeetingStore } from '../stores/meetingStore';\r\nimport { pushNotifications } from '../services/pushNotifications';\r\n\r\n// Global event emitter for chat messages\r\ntype ChatMessageListener = (message: any) => void;\r\nconst chatListeners: Set<ChatMessageListener> = new Set();\r\n\r\nexport function subscribeToChatMessages(listener: ChatMessageListener) {\r\n  chatListeners.add(listener);\r\n  return () => chatListeners.delete(listener);\r\n}\r\n\r\nfunction emitChatMessage(message: any) {\r\n  chatListeners.forEach(listener => listener(message));\r\n}\r\n\r\n// Global event emitter for reschedule updates\r\ntype RescheduleListener = (reschedule: any) => void;\r\nconst rescheduleListeners: Set<RescheduleListener> = new Set();\r\n\r\nexport function subscribeToRescheduleUpdates(listener: RescheduleListener) {\r\n  rescheduleListeners.add(listener);\r\n  return () => rescheduleListeners.delete(listener);\r\n}\r\n\r\nfunction emitRescheduleUpdate(reschedule: any) {\r\n  rescheduleListeners.forEach(listener => listener(reschedule));\r\n}\r\n\r\n/**\r\n * WebSocket hook  real-time  \r\n *  SSE   \r\n *\r\n * :\r\n * -   (  )\r\n * - Durable Objects   \r\n * - 99.99%    D1 (6 polls/min  60,000)\r\n * -    polling  \r\n * -    exponential backoff\r\n */\r\nexport function useWebSocketSync() {\r\n  const { user, token } = useAuthStore();\r\n  const { fetchRequests, fetchExecutors, fetchAnnouncements, fetchPendingReschedules } = useDataStore();\r\n  const { fetchMeetings } = useMeetingStore();\r\n\r\n  const wsRef = useRef<WebSocket | null>(null);\r\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const reconnectAttempts = useRef(0);\r\n  const heartbeatIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const lastSyncRef = useRef<number>(0);\r\n\r\n  const MAX_RECONNECT_ATTEMPTS = 10;\r\n  const SYNC_DEBOUNCE = 500; // Debounce sync calls\r\n  const HEARTBEAT_INTERVAL = 30000; // 30 seconds\r\n\r\n  const syncData = useCallback(async () => {\r\n    if (!user) return;\r\n\r\n    // Debounce: prevent multiple syncs in quick succession\r\n    const now = Date.now();\r\n    if (now - lastSyncRef.current < SYNC_DEBOUNCE) {\r\n      return;\r\n    }\r\n    lastSyncRef.current = now;\r\n\r\n    try {\r\n      // Parallel fetch for speed\r\n      const promises: Promise<void>[] = [fetchRequests()];\r\n\r\n      if (['manager', 'admin', 'director', 'dispatcher', 'department_head'].includes(user.role)) {\r\n        promises.push(fetchExecutors());\r\n      }\r\n\r\n      await Promise.all(promises);\r\n    } catch (error) {\r\n      console.error('[WS] Error syncing data:', error);\r\n    }\r\n  }, [user, fetchRequests, fetchExecutors]);\r\n\r\n  const syncMeetings = useCallback(async () => {\r\n    if (!user) return;\r\n    try {\r\n      console.log('[WS] Syncing meetings...');\r\n      await fetchMeetings();\r\n    } catch (error) {\r\n      console.error('[WS] Error syncing meetings:', error);\r\n    }\r\n  }, [user, fetchMeetings]);\r\n\r\n  const startHeartbeat = useCallback(() => {\r\n    if (heartbeatIntervalRef.current) {\r\n      clearInterval(heartbeatIntervalRef.current);\r\n    }\r\n\r\n    heartbeatIntervalRef.current = setInterval(() => {\r\n      if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n        console.log('[WS] Sending heartbeat...');\r\n        wsRef.current.send(JSON.stringify({ type: 'ping' }));\r\n      }\r\n    }, HEARTBEAT_INTERVAL);\r\n  }, []);\r\n\r\n  const stopHeartbeat = useCallback(() => {\r\n    if (heartbeatIntervalRef.current) {\r\n      clearInterval(heartbeatIntervalRef.current);\r\n      heartbeatIntervalRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const connect = useCallback(() => {\r\n    if (!user || !token) return;\r\n\r\n    // Close existing connection\r\n    if (wsRef.current) {\r\n      wsRef.current.close();\r\n      wsRef.current = null;\r\n    }\r\n\r\n    console.log('[WS] Connecting...');\r\n\r\n    // Determine protocol (ws:// or wss://)\r\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n    const wsUrl = `${protocol}//${window.location.host}/api/ws?token=${token}`;\r\n\r\n    try {\r\n      const ws = new WebSocket(wsUrl);\r\n      wsRef.current = ws;\r\n\r\n      ws.onopen = () => {\r\n        console.log('[WS] Connected');\r\n        reconnectAttempts.current = 0;\r\n        startHeartbeat();\r\n      };\r\n\r\n      ws.onmessage = async (event) => {\r\n        try {\r\n          const message = JSON.parse(event.data);\r\n          console.log('[WS] Received:', message.type);\r\n\r\n          switch (message.type) {\r\n            case 'connected':\r\n              console.log('[WS] Connection confirmed:', message.data);\r\n              // Initial sync\r\n              await syncData();\r\n              await syncMeetings();\r\n              break;\r\n\r\n            case 'pong':\r\n              // Heartbeat response - connection is alive\r\n              break;\r\n\r\n            case 'request_update':\r\n              console.log('[WS] Requests updated');\r\n              await syncData();\r\n              break;\r\n\r\n            case 'meeting_update':\r\n              console.log('[WS] Meetings updated');\r\n              await syncMeetings();\r\n\r\n              // Show push notification for new/updated meetings\r\n              if (message.data?.meetings && message.data.meetings.length > 0) {\r\n                const activeMeeting = message.data.meetings.find((m: any) =>\r\n                  m.status === 'voting_open' || m.status === 'schedule_poll_open'\r\n                );\r\n                if (activeMeeting) {\r\n                  await pushNotifications.show({\r\n                    title: '  ',\r\n                    body: activeMeeting.status === 'voting_open'\r\n                      ? ' !    .'\r\n                      : '  .   .',\r\n                    tag: `meeting-${activeMeeting.id}`,\r\n                    requireInteraction: true,\r\n                    data: { url: '/meetings' }\r\n                  });\r\n                }\r\n              }\r\n              break;\r\n\r\n            case 'announcement_update':\r\n              console.log('[WS] Announcements updated, fetching new data');\r\n              await fetchAnnouncements();\r\n              break;\r\n\r\n            case 'chat_message':\r\n              console.log('[WS] New chat message received');\r\n              emitChatMessage(message.data?.message || message.data);\r\n              break;\r\n\r\n            case 'chat_read':\r\n              console.log('[WS] Chat read receipt received');\r\n              emitChatMessage({ type: 'read', ...message.data });\r\n              break;\r\n\r\n            case 'executor_update':\r\n              console.log('[WS] Executors updated');\r\n              if (['manager', 'admin', 'director', 'dispatcher', 'department_head'].includes(user.role)) {\r\n                await fetchExecutors();\r\n              }\r\n              break;\r\n\r\n            case 'reschedule_update':\r\n              console.log('[WS] Reschedule update received');\r\n              await fetchPendingReschedules();\r\n              if (message.data?.reschedule) {\r\n                emitRescheduleUpdate(message.data.reschedule);\r\n              }\r\n              break;\r\n\r\n            default:\r\n              console.warn('[WS] Unknown message type:', message.type);\r\n          }\r\n        } catch (error) {\r\n          console.error('[WS] Error processing message:', error);\r\n        }\r\n      };\r\n\r\n      ws.onerror = (error) => {\r\n        console.error('[WS] Error:', error);\r\n      };\r\n\r\n      ws.onclose = (event) => {\r\n        console.log('[WS] Connection closed:', event.code, event.reason);\r\n        stopHeartbeat();\r\n        wsRef.current = null;\r\n\r\n        // Attempt reconnect with exponential backoff\r\n        if (reconnectAttempts.current < MAX_RECONNECT_ATTEMPTS) {\r\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 30000);\r\n          console.log(`[WS] Reconnecting in ${delay}ms (attempt ${reconnectAttempts.current + 1})`);\r\n\r\n          reconnectTimeoutRef.current = setTimeout(() => {\r\n            reconnectAttempts.current++;\r\n            connect();\r\n          }, delay);\r\n        } else {\r\n          console.error('[WS] Max reconnect attempts reached');\r\n          // Could fallback to polling here if needed\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('[WS] Failed to create WebSocket:', error);\r\n    }\r\n  }, [user, token, syncData, syncMeetings, startHeartbeat, stopHeartbeat, fetchPendingReschedules]);\r\n\r\n  useEffect(() => {\r\n    if (!user || !token) {\r\n      // Cleanup on logout\r\n      if (wsRef.current) {\r\n        wsRef.current.close();\r\n        wsRef.current = null;\r\n      }\r\n      stopHeartbeat();\r\n      return;\r\n    }\r\n\r\n    // Initial data fetch\r\n    syncData();\r\n    syncMeetings();\r\n\r\n    // Connect via WebSocket\r\n    connect();\r\n\r\n    // Cleanup on unmount\r\n    return () => {\r\n      if (wsRef.current) {\r\n        wsRef.current.close();\r\n        wsRef.current = null;\r\n      }\r\n      if (reconnectTimeoutRef.current) {\r\n        clearTimeout(reconnectTimeoutRef.current);\r\n      }\r\n      stopHeartbeat();\r\n    };\r\n  }, [user, token, connect, syncData, syncMeetings, stopHeartbeat]);\r\n\r\n  // Handle visibility change - reconnect if disconnected\r\n  useEffect(() => {\r\n    const handleVisibilityChange = () => {\r\n      if (!document.hidden) {\r\n        // Tab became visible - sync data\r\n        syncData();\r\n        syncMeetings();\r\n\r\n        // Reconnect WebSocket if disconnected\r\n        if (!wsRef.current || wsRef.current.readyState === WebSocket.CLOSED) {\r\n          reconnectAttempts.current = 0;\r\n          connect();\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, [connect, syncData, syncMeetings]);\r\n\r\n  // Manual refresh function\r\n  const refresh = useCallback(() => {\r\n    syncData();\r\n    syncMeetings();\r\n  }, [syncData, syncMeetings]);\r\n\r\n  return { refresh };\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { X, Bell, AlertTriangle, Users, CheckCircle, Truck } from 'lucide-react';\r\n\r\nexport type PopupType =\r\n  | 'announcement_urgent'    //  \r\n  | 'announcement_meeting'   //  \r\n  | 'request_completed'      //   - \r\n  | 'delivery_completed'     //   - \r\n  | 'info';                  //  \r\n\r\ninterface PopupNotificationProps {\r\n  type: PopupType;\r\n  title: string;\r\n  message: string;\r\n  onClose: () => void;\r\n  onAction?: () => void;\r\n  actionLabel?: string;\r\n  autoClose?: number; // ms, 0 = don't auto close\r\n}\r\n\r\nexport function PopupNotification({\r\n  type,\r\n  title,\r\n  message,\r\n  onClose,\r\n  onAction,\r\n  actionLabel,\r\n  autoClose = 0,\r\n}: PopupNotificationProps) {\r\n  const [isClosing, setIsClosing] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (autoClose > 0) {\r\n      const timer = setTimeout(() => handleClose(), autoClose);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [autoClose]);\r\n\r\n  const handleClose = () => {\r\n    setIsClosing(true);\r\n    setTimeout(() => onClose(), 300);\r\n  };\r\n\r\n  const handleAction = () => {\r\n    if (onAction) {\r\n      onAction();\r\n    }\r\n    handleClose();\r\n  };\r\n\r\n  const getIcon = () => {\r\n    switch (type) {\r\n      case 'announcement_urgent':\r\n        return <AlertTriangle className=\"w-8 h-8 text-red-500\" />;\r\n      case 'announcement_meeting':\r\n        return <Users className=\"w-8 h-8 text-blue-500\" />;\r\n      case 'request_completed':\r\n        return <CheckCircle className=\"w-8 h-8 text-green-500\" />;\r\n      case 'delivery_completed':\r\n        return <Truck className=\"w-8 h-8 text-orange-500\" />;\r\n      default:\r\n        return <Bell className=\"w-8 h-8 text-yellow-500\" />;\r\n    }\r\n  };\r\n\r\n  const getBgColor = () => {\r\n    switch (type) {\r\n      case 'announcement_urgent':\r\n        return 'bg-gradient-to-br from-red-50 to-orange-50 border-red-200';\r\n      case 'announcement_meeting':\r\n        return 'bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200';\r\n      case 'request_completed':\r\n        return 'bg-gradient-to-br from-green-50 to-emerald-50 border-green-200';\r\n      case 'delivery_completed':\r\n        return 'bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200';\r\n      default:\r\n        return 'bg-gradient-to-br from-yellow-50 to-amber-50 border-yellow-200';\r\n    }\r\n  };\r\n\r\n  const getActionBtnColor = () => {\r\n    switch (type) {\r\n      case 'announcement_urgent':\r\n        return 'bg-red-500 hover:bg-red-600 text-white';\r\n      case 'announcement_meeting':\r\n        return 'bg-blue-500 hover:bg-blue-600 text-white';\r\n      case 'request_completed':\r\n        return 'bg-green-500 hover:bg-green-600 text-white';\r\n      case 'delivery_completed':\r\n        return 'bg-orange-500 hover:bg-orange-600 text-white';\r\n      default:\r\n        return 'bg-orange-400 hover:bg-orange-500 text-black';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n      <div\r\n        className={`\r\n          relative w-full max-w-sm rounded-2xl border-2 shadow-2xl p-6\r\n          ${getBgColor()}\r\n          ${isClosing ? 'animate-out zoom-out-95 fade-out duration-300' : 'animate-in zoom-in-95 fade-in duration-300'}\r\n        `}\r\n      >\r\n        {/* Close button */}\r\n        <button\r\n          onClick={handleClose}\r\n          className=\"absolute top-3 right-3 p-2 rounded-full hover:bg-black/10 transition-colors\"\r\n        >\r\n          <X className=\"w-5 h-5 text-gray-500\" />\r\n        </button>\r\n\r\n        {/* Icon */}\r\n        <div className=\"flex justify-center mb-4\">\r\n          <div className=\"w-16 h-16 rounded-full bg-white shadow-lg flex items-center justify-center\">\r\n            {getIcon()}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Title */}\r\n        <h3 className=\"text-xl font-bold text-center text-gray-900 mb-2\">\r\n          {title}\r\n        </h3>\r\n\r\n        {/* Message */}\r\n        <p className=\"text-center text-gray-600 mb-6 leading-relaxed\">\r\n          {message}\r\n        </p>\r\n\r\n        {/* Actions */}\r\n        <div className=\"flex flex-col gap-2\">\r\n          {onAction && actionLabel && (\r\n            <button\r\n              onClick={handleAction}\r\n              className={`w-full py-3 px-4 rounded-xl font-semibold transition-colors ${getActionBtnColor()}`}\r\n            >\r\n              {actionLabel}\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={handleClose}\r\n            className=\"w-full py-3 px-4 rounded-xl font-medium text-gray-600 hover:bg-black/5 transition-colors\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Manager for multiple popups (queue)\r\ninterface PopupItem {\r\n  id: string;\r\n  type: PopupType;\r\n  title: string;\r\n  message: string;\r\n  actionLabel?: string;\r\n  onAction?: () => void;\r\n}\r\n\r\ninterface PopupManagerProps {\r\n  popups: PopupItem[];\r\n  onDismiss: (id: string) => void;\r\n}\r\n\r\nexport function PopupManager({ popups, onDismiss }: PopupManagerProps) {\r\n  const currentPopup = popups[0]; // Show one at a time\r\n\r\n  if (!currentPopup) return null;\r\n\r\n  return (\r\n    <PopupNotification\r\n      type={currentPopup.type}\r\n      title={currentPopup.title}\r\n      message={currentPopup.message}\r\n      actionLabel={currentPopup.actionLabel}\r\n      onAction={currentPopup.onAction}\r\n      onClose={() => onDismiss(currentPopup.id)}\r\n    />\r\n  );\r\n}\r\n","import { memo, useEffect, useState } from 'react';\r\nimport { AlertCircle, CheckCircle, Clock, TrendingUp, Zap } from 'lucide-react';\r\n\r\ninterface PerformanceStats {\r\n  fps: number;\r\n  memory: number;\r\n  renderTime: number;\r\n  apiLatency: number;\r\n}\r\n\r\ninterface PerformanceMonitorProps {\r\n  enabled?: boolean;\r\n  position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\r\n}\r\n\r\n/**\r\n * Real-time Performance Monitor Component\r\n *\r\n * Displays live performance metrics in development mode:\r\n * - FPS (frames per second)\r\n * - Memory usage\r\n * - Render time\r\n * - API latency\r\n *\r\n * Only visible in development or when explicitly enabled\r\n */\r\nexport const PerformanceMonitor = memo<PerformanceMonitorProps>(\r\n  ({ enabled = import.meta.env.DEV, position = 'bottom-right' }) => {\r\n    const [stats, setStats] = useState<PerformanceStats>({\r\n      fps: 60,\r\n      memory: 0,\r\n      renderTime: 0,\r\n      apiLatency: 0,\r\n    });\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n\r\n    useEffect(() => {\r\n      if (!enabled) return;\r\n\r\n      // FPS measurement\r\n      let frameCount = 0;\r\n      let lastTime = performance.now();\r\n      let animationFrameId: number;\r\n\r\n      const measureFPS = () => {\r\n        frameCount++;\r\n        const currentTime = performance.now();\r\n\r\n        if (currentTime >= lastTime + 1000) {\r\n          const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));\r\n          frameCount = 0;\r\n          lastTime = currentTime;\r\n\r\n          setStats(prev => ({ ...prev, fps }));\r\n        }\r\n\r\n        animationFrameId = requestAnimationFrame(measureFPS);\r\n      };\r\n\r\n      animationFrameId = requestAnimationFrame(measureFPS);\r\n\r\n      // Memory measurement (if available)\r\n      const memoryInterval = setInterval(() => {\r\n        if ('memory' in performance) {\r\n          const mem = (performance as any).memory;\r\n          const usedMB = Math.round(mem.usedJSHeapSize / 1024 / 1024);\r\n          setStats(prev => ({ ...prev, memory: usedMB }));\r\n        }\r\n      }, 1000);\r\n\r\n      // Render time from custom performance monitor\r\n      const renderInterval = setInterval(() => {\r\n        if ((window as any).perfMonitor) {\r\n          const averages = (window as any).perfMonitor.getAverages();\r\n          const renderMetrics = averages.filter((m: any) => m.name.startsWith('render:'));\r\n\r\n          if (renderMetrics.length > 0) {\r\n            const avgRenderTime = renderMetrics.reduce((sum: number, m: any) => sum + m.avg, 0) / renderMetrics.length;\r\n            setStats(prev => ({ ...prev, renderTime: Math.round(avgRenderTime) }));\r\n          }\r\n        }\r\n      }, 2000);\r\n\r\n      // API latency measurement\r\n      const originalFetch = window.fetch;\r\n      let apiLatencies: number[] = [];\r\n\r\n      window.fetch = async (...args) => {\r\n        const startTime = performance.now();\r\n        const response = await originalFetch(...args);\r\n        const duration = performance.now() - startTime;\r\n\r\n        // Only track API calls\r\n        if (typeof args[0] === 'string' && args[0].includes('/api/')) {\r\n          apiLatencies.push(duration);\r\n          if (apiLatencies.length > 10) apiLatencies = apiLatencies.slice(-10);\r\n\r\n          const avgLatency = apiLatencies.reduce((sum, l) => sum + l, 0) / apiLatencies.length;\r\n          setStats(prev => ({ ...prev, apiLatency: Math.round(avgLatency) }));\r\n        }\r\n\r\n        return response;\r\n      };\r\n\r\n      return () => {\r\n        cancelAnimationFrame(animationFrameId);\r\n        clearInterval(memoryInterval);\r\n        clearInterval(renderInterval);\r\n        window.fetch = originalFetch;\r\n      };\r\n    }, [enabled]);\r\n\r\n    if (!enabled) return null;\r\n\r\n    const positionClasses = {\r\n      'top-left': 'top-4 left-4',\r\n      'top-right': 'top-4 right-4',\r\n      'bottom-left': 'bottom-4 left-4',\r\n      'bottom-right': 'bottom-4 right-4',\r\n    };\r\n\r\n    const getStatusColor = (metric: keyof PerformanceStats, value: number): string => {\r\n      const thresholds = {\r\n        fps: { good: 55, warning: 30 },\r\n        memory: { good: 100, warning: 150 },\r\n        renderTime: { good: 50, warning: 100 },\r\n        apiLatency: { good: 200, warning: 500 },\r\n      };\r\n\r\n      const threshold = thresholds[metric];\r\n      if (metric === 'fps') {\r\n        // Higher is better for FPS\r\n        if (value >= threshold.good) return 'text-green-500';\r\n        if (value >= threshold.warning) return 'text-yellow-500';\r\n        return 'text-red-500';\r\n      } else {\r\n        // Lower is better for other metrics\r\n        if (value <= threshold.good) return 'text-green-500';\r\n        if (value <= threshold.warning) return 'text-yellow-500';\r\n        return 'text-red-500';\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div\r\n        className={`fixed ${positionClasses[position]} z-50 bg-gray-900/95 backdrop-blur-sm rounded-lg shadow-2xl border border-gray-700 transition-all duration-200 ${\r\n          isExpanded ? 'w-64' : 'w-12 h-12'\r\n        }`}\r\n      >\r\n        {/* Toggle button */}\r\n        <button\r\n          onClick={() => setIsExpanded(!isExpanded)}\r\n          className=\"w-full h-12 flex items-center justify-center text-gray-400 hover:text-white transition-colors\"\r\n          title=\"Performance Monitor\"\r\n        >\r\n          <Zap className=\"w-5 h-5\" />\r\n        </button>\r\n\r\n        {/* Expanded metrics */}\r\n        {isExpanded && (\r\n          <div className=\"px-3 pb-3 space-y-2 text-xs\">\r\n            {/* FPS */}\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Zap className=\"w-4 h-4 text-purple-400\" />\r\n                <span className=\"text-gray-400\">FPS</span>\r\n              </div>\r\n              <span className={`font-mono font-bold ${getStatusColor('fps', stats.fps)}`}>\r\n                {stats.fps}\r\n              </span>\r\n            </div>\r\n\r\n            {/* Memory */}\r\n            {stats.memory > 0 && (\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <TrendingUp className=\"w-4 h-4 text-blue-400\" />\r\n                  <span className=\"text-gray-400\">Memory</span>\r\n                </div>\r\n                <span className={`font-mono font-bold ${getStatusColor('memory', stats.memory)}`}>\r\n                  {stats.memory} MB\r\n                </span>\r\n              </div>\r\n            )}\r\n\r\n            {/* Render Time */}\r\n            {stats.renderTime > 0 && (\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Clock className=\"w-4 h-4 text-green-400\" />\r\n                  <span className=\"text-gray-400\">Render</span>\r\n                </div>\r\n                <span className={`font-mono font-bold ${getStatusColor('renderTime', stats.renderTime)}`}>\r\n                  {stats.renderTime} ms\r\n                </span>\r\n              </div>\r\n            )}\r\n\r\n            {/* API Latency */}\r\n            {stats.apiLatency > 0 && (\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Zap className=\"w-4 h-4 text-yellow-400\" />\r\n                  <span className=\"text-gray-400\">API</span>\r\n                </div>\r\n                <span className={`font-mono font-bold ${getStatusColor('apiLatency', stats.apiLatency)}`}>\r\n                  {stats.apiLatency} ms\r\n                </span>\r\n              </div>\r\n            )}\r\n\r\n            {/* Overall status */}\r\n            <div className=\"pt-2 border-t border-gray-700\">\r\n              <div className=\"flex items-center gap-2\">\r\n                {stats.fps >= 55 && stats.renderTime <= 50 && stats.apiLatency <= 200 ? (\r\n                  <>\r\n                    <CheckCircle className=\"w-4 h-4 text-green-500\" />\r\n                    <span className=\"text-green-500 font-medium\">Excellent</span>\r\n                  </>\r\n                ) : stats.fps >= 30 && stats.renderTime <= 100 && stats.apiLatency <= 500 ? (\r\n                  <>\r\n                    <AlertCircle className=\"w-4 h-4 text-yellow-500\" />\r\n                    <span className=\"text-yellow-500 font-medium\">Good</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <AlertCircle className=\"w-4 h-4 text-red-500\" />\r\n                    <span className=\"text-red-500 font-medium\">Poor</span>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"pt-2 border-t border-gray-700 flex gap-2\">\r\n              <button\r\n                onClick={() => {\r\n                  if ((window as any).perfReport) {\r\n                    const report = (window as any).perfReport();\r\n                    console.log('Performance Report:', report);\r\n                  }\r\n                }}\r\n                className=\"flex-1 px-2 py-1 bg-gray-800 hover:bg-gray-700 rounded text-gray-300 hover:text-white transition-colors\"\r\n              >\r\n                Report\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  if ((window as any).perfMonitor) {\r\n                    (window as any).perfMonitor.clear();\r\n                  }\r\n                }}\r\n                className=\"flex-1 px-2 py-1 bg-gray-800 hover:bg-gray-700 rounded text-gray-300 hover:text-white transition-colors\"\r\n              >\r\n                Clear\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nPerformanceMonitor.displayName = 'PerformanceMonitor';\r\n","import { useState, useEffect, lazy, Suspense } from 'react';\r\nimport { Routes, Route, useLocation } from 'react-router-dom';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useDataStore } from '../../stores/dataStore';\r\nimport { usePopupNotifications } from '../../hooks/usePopupNotifications';\r\nimport { useWebSocketSync } from '../../hooks/useWebSocketSync';\r\nimport { Sidebar } from './Sidebar';\r\nimport { Header } from './Header';\r\nimport { MobileHeader } from './MobileHeader';\r\nimport { PopupManager } from '../PopupNotification';\r\nimport { PerformanceMonitor } from '../PerformanceMonitor';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\n// Page loading fallback\r\nconst PageLoader = () => (\r\n  <div className=\"flex items-center justify-center h-64\">\r\n    <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\r\n  </div>\r\n);\r\n\r\n// Lazy loaded pages - code splitting for optimal bundle size\r\nconst ManagerDashboard = lazy(() => import('../../pages/ManagerDashboard').then(m => ({ default: m.ManagerDashboard })));\r\nconst DepartmentHeadDashboard = lazy(() => import('../../pages/DepartmentHeadDashboard').then(m => ({ default: m.DepartmentHeadDashboard })));\r\nconst ExecutorDashboard = lazy(() => import('../../pages/ExecutorDashboard').then(m => ({ default: m.ExecutorDashboard })));\r\nconst ExecutorSchedulePage = lazy(() => import('../../pages/ExecutorSchedulePage').then(m => ({ default: m.ExecutorSchedulePage })));\r\nconst ExecutorStatsPage = lazy(() => import('../../pages/ExecutorStatsPage').then(m => ({ default: m.ExecutorStatsPage })));\r\nconst ExecutorAnnouncementsPage = lazy(() => import('../../pages/ExecutorAnnouncementsPage').then(m => ({ default: m.ExecutorAnnouncementsPage })));\r\nconst ResidentDashboard = lazy(() => import('../../pages/ResidentDashboard').then(m => ({ default: m.ResidentDashboard })));\r\nconst AdminDashboard = lazy(() => import('../../pages/AdminDashboard').then(m => ({ default: m.AdminDashboard })));\r\nconst DirectorDashboard = lazy(() => import('../../pages/DirectorDashboard').then(m => ({ default: m.DirectorDashboard })));\r\nconst BuildingsPage = lazy(() => import('../../pages/BuildingsPage').then(m => ({ default: m.BuildingsPage })));\r\nconst AnnouncementsPage = lazy(() => import('../../pages/AnnouncementsPage').then(m => ({ default: m.AnnouncementsPage })));\r\nconst MeetingsPage = lazy(() => import('../../pages/MeetingsPage').then(m => ({ default: m.MeetingsPage })));\r\nconst ResidentAnnouncementsPage = lazy(() => import('../../pages/ResidentAnnouncementsPage').then(m => ({ default: m.ResidentAnnouncementsPage })));\r\nconst ResidentMeetingsPage = lazy(() => import('../../pages/ResidentMeetingsPage').then(m => ({ default: m.ResidentMeetingsPage })));\r\nconst ResidentRateEmployeesPage = lazy(() => import('../../pages/ResidentRateEmployeesPage').then(m => ({ default: m.ResidentRateEmployeesPage })));\r\nconst WorkOrdersPage = lazy(() => import('../../pages/WorkOrdersPage').then(m => ({ default: m.WorkOrdersPage })));\r\nconst TrainingsPage = lazy(() => import('../../pages/TrainingsPage'));\r\nconst ColleaguesSection = lazy(() => import('../../pages/ColleaguesSection').then(m => ({ default: m.ColleaguesSection })));\r\nconst ResidentVehiclesPage = lazy(() => import('../../pages/ResidentVehiclesPage').then(m => ({ default: m.ResidentVehiclesPage })));\r\nconst VehicleSearchPage = lazy(() => import('../../pages/VehicleSearchPage').then(m => ({ default: m.VehicleSearchPage })));\r\nconst ResidentGuestAccessPage = lazy(() => import('../../pages/ResidentGuestAccessPage').then(m => ({ default: m.ResidentGuestAccessPage })));\r\nconst GuardQRScannerPage = lazy(() => import('../../pages/GuardQRScannerPage').then(m => ({ default: m.GuardQRScannerPage })));\r\nconst ManagerGuestAccessPage = lazy(() => import('../../pages/ManagerGuestAccessPage').then(m => ({ default: m.ManagerGuestAccessPage })));\r\nconst ResidentsPage = lazy(() => import('../../pages/ResidentsPage').then(m => ({ default: m.ResidentsPage })));\r\nconst ChatPage = lazy(() => import('../../pages/ChatPage').then(m => ({ default: m.ChatPage })));\r\nconst ResidentProfilePage = lazy(() => import('../../pages/ResidentProfilePage').then(m => ({ default: m.ResidentProfilePage })));\r\nconst ResidentContractPage = lazy(() => import('../../pages/ResidentContractPage').then(m => ({ default: m.ResidentContractPage })));\r\nconst ResidentUsefulContactsPage = lazy(() => import('../../pages/ResidentUsefulContactsPage'));\r\nconst AdvertiserDashboard = lazy(() => import('../../pages/AdvertiserDashboard').then(m => ({ default: m.AdvertiserDashboard })));\r\nconst CouponCheckerDashboard = lazy(() => import('../../pages/CouponCheckerDashboard').then(m => ({ default: m.CouponCheckerDashboard })));\r\nconst NotepadPage = lazy(() => import('../../pages/NotepadPage').then(m => ({ default: m.NotepadPage })));\r\nconst TenantDashboard = lazy(() => import('../../pages/tenant/TenantDashboard').then(m => ({ default: m.TenantDashboard })));\r\nconst ExecutorsPage = lazy(() => import('../../pages/shared/ExecutorsPage').then(m => ({ default: m.ExecutorsPage })));\r\nconst RequestsPage = lazy(() => import('../../pages/shared/RequestsPage').then(m => ({ default: m.RequestsPage })));\r\nconst RentalsPage = lazy(() => import('../../pages/manager/RentalsPage').then(m => ({ default: m.RentalsPage })));\r\nconst TeamPage = lazy(() => import('../../pages/admin/TeamPage').then(m => ({ default: m.TeamPage })));\r\nconst ReportsPage = lazy(() => import('../../pages/admin/ReportsPage').then(m => ({ default: m.ReportsPage })));\r\nconst SettingsPage = lazy(() => import('../../pages/admin/SettingsPage').then(m => ({ default: m.SettingsPage })));\r\nconst MonitoringPage = lazy(() => import('../../pages/admin/MonitoringPage').then(m => ({ default: m.MonitoringPage })));\r\nconst MarketplacePage = lazy(() => import('../../pages/MarketplacePage').then(m => ({ default: m.MarketplacePage })));\r\nconst MarketplaceManagerDashboard = lazy(() => import('../../pages/MarketplaceManagerDashboard').then(m => ({ default: m.MarketplaceManagerDashboard })));\r\nconst MarketplaceOrdersPage = lazy(() => import('../../pages/MarketplaceOrdersPage').then(m => ({ default: m.MarketplaceOrdersPage })));\r\n\r\nexport function Layout() {\r\n  const location = useLocation();\r\n  const { user, logout } = useAuthStore();\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const { getUnreadCount, fetchAnnouncements } = useDataStore();\r\n  const unreadCount = user ? getUnreadCount(user.id) : 0;\r\n\r\n  // Hook for popup notifications (urgent announcements, completed requests)\r\n  const { popups, dismissPopup } = usePopupNotifications();\r\n\r\n  // Real-time sync via WebSocket (replaces SSE polling)\r\n  useWebSocketSync();\r\n\r\n  // Fetch announcements on mount (for badge in sidebar)\r\n  useEffect(() => {\r\n    fetchAnnouncements();\r\n  }, [fetchAnnouncements]);\r\n\r\n  // Close sidebar when route changes on mobile\r\n  useEffect(() => {\r\n    setSidebarOpen(false);\r\n  }, [location.pathname]);\r\n\r\n  // Determine which dashboard to show based on role and account_type\r\n  const getDashboard = () => {\r\n    // Check account_type or role for special accounts\r\n    if (user?.account_type === 'advertiser' || user?.role === 'advertiser') {\r\n      return <AdvertiserDashboard />;\r\n    }\r\n    if (user?.account_type === 'coupon_checker' || user?.role === 'coupon_checker') {\r\n      return <CouponCheckerDashboard />;\r\n    }\r\n    if (user?.role === 'marketplace_manager') {\r\n      return <MarketplaceManagerDashboard />;\r\n    }\r\n\r\n    switch (user?.role) {\r\n      case 'admin':\r\n        return <AdminDashboard />;\r\n      case 'director':\r\n        return <DirectorDashboard />;\r\n      case 'department_head':\r\n        return <DepartmentHeadDashboard />;\r\n      case 'executor':\r\n        return <ExecutorDashboard />;\r\n      case 'resident':\r\n        return <ResidentDashboard />;\r\n      case 'tenant':\r\n      case 'commercial_owner':\r\n        return <TenantDashboard />;\r\n      default:\r\n        return <ManagerDashboard />;\r\n    }\r\n  };\r\n\r\n  // Determine which announcements page to show based on role\r\n  const getAnnouncementsPage = () => {\r\n    if (user?.role === 'resident') {\r\n      return <ResidentAnnouncementsPage />;\r\n    }\r\n    if (user?.role === 'executor') {\r\n      return <ExecutorAnnouncementsPage />;\r\n    }\r\n    return <AnnouncementsPage />;\r\n  };\r\n\r\n  // Determine which meetings page to show based on role\r\n  const getMeetingsPage = () => {\r\n    if (user?.role === 'resident') {\r\n      return <ResidentMeetingsPage />;\r\n    }\r\n    return <MeetingsPage />;\r\n  };\r\n\r\n  // Determine which guest access page to show based on role\r\n  const getGuestAccessPage = () => {\r\n    if (user?.role === 'resident') {\r\n      return <ResidentGuestAccessPage />;\r\n    }\r\n    return <ManagerGuestAccessPage />;\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen min-h-dvh\">\r\n      <Sidebar\r\n        onLogout={logout}\r\n        isOpen={sidebarOpen}\r\n        onClose={() => setSidebarOpen(false)}\r\n      />\r\n\r\n      {/* Mobile Header */}\r\n      <MobileHeader\r\n        onMenuClick={() => setSidebarOpen(true)}\r\n        unreadCount={unreadCount}\r\n      />\r\n\r\n      <div className=\"main-content\">\r\n        {/* Desktop Header */}\r\n        <div className=\"hide-mobile\">\r\n          <Header />\r\n        </div>\r\n\r\n        <main className=\"p-4 md:p-6 page-content\">\r\n          <Suspense fallback={<PageLoader />}>\r\n            <Routes>\r\n              <Route path=\"/\" element={getDashboard()} />\r\n              <Route path=\"/requests\" element={<RequestsPage />} />\r\n              <Route path=\"/residents\" element={<ResidentsPage />} />\r\n              <Route path=\"/executors\" element={<ExecutorsPage />} />\r\n              <Route path=\"/rentals\" element={<RentalsPage />} />\r\n              <Route path=\"/buildings\" element={<BuildingsPage />} />\r\n              <Route path=\"/work-orders\" element={<WorkOrdersPage />} />\r\n              <Route path=\"/meetings\" element={getMeetingsPage()} />\r\n              <Route path=\"/announcements\" element={getAnnouncementsPage()} />\r\n              <Route path=\"/schedule\" element={<ExecutorSchedulePage />} />\r\n              <Route path=\"/stats\" element={<ExecutorStatsPage />} />\r\n              <Route path=\"/rate-employees\" element={<ResidentRateEmployeesPage />} />\r\n              <Route path=\"/vehicles\" element={<ResidentVehiclesPage />} />\r\n              <Route path=\"/vehicle-search\" element={<VehicleSearchPage />} />\r\n              <Route path=\"/guest-access\" element={getGuestAccessPage()} />\r\n              <Route path=\"/qr-scanner\" element={<GuardQRScannerPage />} />\r\n              <Route path=\"/chat\" element={<ChatPage />} />\r\n              <Route path=\"/profile\" element={<ResidentProfilePage />} />\r\n              <Route path=\"/contract\" element={<ResidentContractPage />} />\r\n              <Route path=\"/useful-contacts\" element={<ResidentUsefulContactsPage />} />\r\n              <Route path=\"/colleagues\" element={<ColleaguesSection />} />\r\n              <Route path=\"/notepad\" element={<NotepadPage />} />\r\n              <Route path=\"/trainings\" element={<TrainingsPage />} />\r\n              <Route path=\"/team\" element={<TeamPage />} />\r\n              <Route path=\"/reports\" element={<ReportsPage />} />\r\n              <Route path=\"/settings\" element={<SettingsPage />} />\r\n              <Route path=\"/monitoring\" element={<MonitoringPage />} />\r\n              <Route path=\"/marketplace\" element={<MarketplacePage />} />\r\n              <Route path=\"/marketplace-orders\" element={<MarketplaceOrdersPage />} />\r\n              <Route path=\"/marketplace-products\" element={<MarketplaceManagerDashboard />} />\r\n            </Routes>\r\n          </Suspense>\r\n        </main>\r\n      </div>\r\n\r\n      {/* Popup notifications for urgent announcements and completed requests */}\r\n      <PopupManager popups={popups} onDismiss={dismissPopup} />\r\n\r\n      {/* Performance Monitor (  dev mode) */}\r\n      <PerformanceMonitor />\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useRef, useEffect } from 'react';\r\nimport { Eye, EyeOff, AlertCircle, X, FileText, Check, Users, UserCog, Wrench, ShieldCheck, Crown, Briefcase } from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useLanguageStore, type Language } from '../stores/languageStore';\r\nimport { AppLogo } from '../components/common/AppLogo';\r\n\r\n// Demo accounts for all roles\r\nconst DEMO_ACCOUNTS = [\r\n  { login: 'director', password: 'kamizo', role: 'director', labelRu: '', labelUz: 'Direktor', icon: Briefcase, color: 'bg-rose-600' },\r\n  { login: 'manager', password: 'kamizo', role: 'manager', labelRu: '', labelUz: 'Boshqaruvchi', icon: UserCog, color: 'bg-blue-500' },\r\n  { login: 'department_head', password: 'kamizo', role: 'department_head', labelRu: ' ', labelUz: 'Bo\\'lim boshlig\\'i', icon: Crown, color: 'bg-indigo-500' },\r\n  { login: 'resident', password: 'kamizo', role: 'resident', labelRu: '', labelUz: 'Aholi', icon: Users, color: 'bg-green-500' },\r\n  { login: 'executor', password: 'kamizo', role: 'executor', labelRu: '', labelUz: 'Ijrochi', icon: Wrench, color: 'bg-amber-500' },\r\n  { login: 'security', password: 'kamizo', role: 'security', labelRu: '', labelUz: 'Qo\\'riqchi', icon: ShieldCheck, color: 'bg-slate-500' },\r\n];\r\n\r\n// Hidden accounts (not shown in demo buttons, but can login manually)\r\n// admin: login='admin', password='kamizo'\r\n// dispatcher: login='dispatcher', password='kamizo'\r\n// coupon_checker: login='coupon_checker', password='kamizo'\r\n// advertiser: login='advertiser', password='kamizo'\r\n\r\nexport function LoginPage() {\r\n  const { login, isLoading: authLoading, error: authError } = useAuthStore();\r\n  const { language, setLanguage, t } = useLanguageStore();\r\n\r\n  const [loginValue, setLoginValue] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [agreedToTerms, setAgreedToTerms] = useState(false);\r\n  const [showOfferModal, setShowOfferModal] = useState(false);\r\n  const [canAcceptOffer, setCanAcceptOffer] = useState(false);\r\n  const offerScrollRef = useRef<HTMLDivElement>(null);\r\n\r\n  const languages: { code: Language; label: string; flag: string }[] = [\r\n    { code: 'ru', label: 'RU', flag: '' },\r\n    { code: 'uz', label: 'UZ', flag: '' },\r\n  ];\r\n\r\n  // Check if user scrolled to bottom of offer\r\n  const handleOfferScroll = () => {\r\n    if (offerScrollRef.current) {\r\n      const { scrollTop, scrollHeight, clientHeight } = offerScrollRef.current;\r\n      // Allow acceptance when scrolled to within 50px of bottom\r\n      if (scrollTop + clientHeight >= scrollHeight - 50) {\r\n        setCanAcceptOffer(true);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Reset scroll check when modal opens\r\n  useEffect(() => {\r\n    if (showOfferModal) {\r\n      setCanAcceptOffer(false);\r\n      // Check initial state in case content is short\r\n      setTimeout(() => {\r\n        if (offerScrollRef.current) {\r\n          const { scrollHeight, clientHeight } = offerScrollRef.current;\r\n          if (clientHeight >= scrollHeight) {\r\n            setCanAcceptOffer(true);\r\n          }\r\n        }\r\n      }, 100);\r\n    }\r\n  }, [showOfferModal]);\r\n\r\n  const handleAcceptOffer = () => {\r\n    setAgreedToTerms(true);\r\n    setShowOfferModal(false);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n\r\n    if (!agreedToTerms) {\r\n      setError(language === 'ru' ? '    ' : 'Ommaviy oferta shartlarini qabul qilish kerak');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const success = await login(loginValue, password);\r\n      if (!success) {\r\n        setError(language === 'ru' ? '   ' : 'Login yoki parol noto\\'g\\'ri');\r\n      }\r\n      // No need to navigate - App component will re-render with Layout when user is set\r\n    } catch {\r\n      setError(language === 'ru' ? '  ' : 'Kirishda xatolik');\r\n    }\r\n  };\r\n\r\n  const displayError = error || authError;\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\r\n      {/* Language Switcher */}\r\n      <div className=\"absolute top-4 right-4 z-20\">\r\n        <div className=\"flex items-center gap-1 bg-white/80 backdrop-blur-sm rounded-xl p-1 shadow-sm\">\r\n          {languages.map((lang) => (\r\n            <button\r\n              key={lang.code}\r\n              onClick={() => setLanguage(lang.code)}\r\n              className={`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors touch-manipulation ${\r\n                language === lang.code\r\n                  ? 'bg-orange-400 text-gray-900'\r\n                  : 'hover:bg-gray-100 text-gray-600'\r\n              }`}\r\n            >\r\n              <span>{lang.flag}</span>\r\n              <span>{lang.label}</span>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Decorative elements */}\r\n      <div className=\"absolute top-20 left-20 w-72 h-72 bg-primary-300/30 rounded-full blur-3xl\" />\r\n      <div className=\"absolute bottom-20 right-20 w-96 h-96 bg-primary-200/40 rounded-full blur-3xl\" />\r\n      <div className=\"absolute top-1/2 left-1/3 w-64 h-64 bg-orange-200/30 rounded-full blur-3xl\" />\r\n\r\n      <div className=\"glass-card p-6 md:p-8 w-full max-w-md relative z-10\">\r\n        {/* Logo */}\r\n        <div className=\"text-center mb-6 md:mb-8\">\r\n          <div className=\"flex items-center justify-center gap-5\">\r\n            <AppLogo size=\"xl\" />\r\n            <div className=\"text-left\">\r\n              <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">kamizo</h1>\r\n              <p className=\"text-gray-500 text-sm md:text-base\">{language === 'ru' ? ' ' : 'Uy-joy boshqaruvi'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Login Form */}\r\n        <form onSubmit={handleSubmit} className=\"space-y-4 md:space-y-5\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1.5 md:mb-2\">{t('auth.login')}</label>\r\n            <input\r\n              type=\"text\"\r\n              value={loginValue}\r\n              onChange={(e) => setLoginValue(e.target.value)}\r\n              placeholder={language === 'ru' ? ' ' : 'Login kiriting'}\r\n              className=\"glass-input text-base\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1.5 md:mb-2\">{t('auth.password')}</label>\r\n            <div className=\"relative\">\r\n              <input\r\n                type={showPassword ? 'text' : 'password'}\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                placeholder={language === 'ru' ? ' ' : 'Parol kiriting'}\r\n                className=\"glass-input pr-12 text-base\"\r\n                required\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={(e) => {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  setShowPassword(!showPassword);\r\n                }}\r\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 active:text-gray-800 touch-manipulation p-2 z-10\"\r\n                aria-label={showPassword ? ' ' : ' '}\r\n              >\r\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {displayError && (\r\n            <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm\">\r\n              <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\r\n              {displayError}\r\n            </div>\r\n          )}\r\n\r\n          {/* User Agreement Checkbox - Touch-friendly 44px target */}\r\n          <div className=\"flex items-start gap-3\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                if (!agreedToTerms) {\r\n                  setShowOfferModal(true);\r\n                } else {\r\n                  setAgreedToTerms(false);\r\n                }\r\n              }}\r\n              className={`flex-shrink-0 w-11 h-11 md:w-6 md:h-6 rounded-lg md:rounded border-2 flex items-center justify-center transition-colors touch-manipulation active:scale-95 ${\r\n                agreedToTerms\r\n                  ? 'bg-orange-400 border-orange-400'\r\n                  : 'border-gray-300 hover:border-orange-400 bg-white/50'\r\n              }`}\r\n            >\r\n              {agreedToTerms && <Check className=\"w-5 h-5 md:w-4 md:h-4 text-gray-800\" />}\r\n            </button>\r\n            <div className=\"text-sm text-gray-600\">\r\n              {language === 'ru' ? (\r\n                <>\r\n                     {' '}\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowOfferModal(true)}\r\n                    className=\"text-orange-600 hover:text-orange-700 underline font-medium touch-manipulation\"\r\n                  >\r\n                     \r\n                  </button>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  Men{' '}\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowOfferModal(true)}\r\n                    className=\"text-orange-600 hover:text-orange-700 underline font-medium touch-manipulation\"\r\n                  >\r\n                    ommaviy oferta\r\n                  </button>\r\n                  {' '}shartlariga roziman\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={authLoading || !agreedToTerms}\r\n            className=\"btn-primary w-full text-center disabled:opacity-50 py-3 text-base touch-manipulation\"\r\n          >\r\n            {authLoading ? (language === 'ru' ? '...' : 'Kirish...') : t('auth.enter')}\r\n          </button>\r\n        </form>\r\n\r\n        {/* Demo Accounts Section */}\r\n        <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n          <p className=\"text-xs text-gray-500 text-center mb-3\">\r\n            {language === 'ru' ? '-  :' : 'Test uchun demo-kirish:'}\r\n          </p>\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {DEMO_ACCOUNTS.map((account) => {\r\n              const Icon = account.icon;\r\n              return (\r\n                <button\r\n                  key={account.login}\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    setLoginValue(account.login);\r\n                    setPassword(account.password);\r\n                    if (!agreedToTerms) {\r\n                      setShowOfferModal(true);\r\n                    }\r\n                  }}\r\n                  className=\"flex items-center gap-2 px-3 py-2 bg-gray-50 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation text-left\"\r\n                >\r\n                  <div className={`w-7 h-7 ${account.color} rounded-lg flex items-center justify-center flex-shrink-0`}>\r\n                    <Icon className=\"w-4 h-4 text-white\" />\r\n                  </div>\r\n                  <span className=\"text-xs font-medium text-gray-700 truncate\">\r\n                    {language === 'ru' ? account.labelRu : account.labelUz}\r\n                  </span>\r\n                </button>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Public Offer Modal */}\r\n      {showOfferModal && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4\">\r\n          <div className=\"bg-white rounded-t-2xl sm:rounded-2xl shadow-2xl w-full sm:max-w-2xl max-h-[95vh] sm:max-h-[90vh] flex flex-col\">\r\n            {/* Modal Header */}\r\n            <div className=\"flex items-center justify-between p-4 md:p-6 border-b border-gray-200\">\r\n              <div className=\"flex items-center gap-2 sm:gap-3\">\r\n                <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-orange-100 rounded-xl flex items-center justify-center flex-shrink-0\">\r\n                  <FileText className=\"w-4 h-4 sm:w-5 sm:h-5 text-orange-600\" />\r\n                </div>\r\n                <h2 className=\"text-base sm:text-lg md:text-xl font-bold text-gray-900\">\r\n                  {language === 'ru' ? ' ' : 'Ommaviy oferta'}\r\n                </h2>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowOfferModal(false)}\r\n                className=\"p-2 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation\"\r\n              >\r\n                <X className=\"w-5 h-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Modal Content - Scrollable */}\r\n            <div\r\n              ref={offerScrollRef}\r\n              onScroll={handleOfferScroll}\r\n              className=\"flex-1 overflow-y-auto p-4 md:p-6 text-sm text-gray-700 leading-relaxed\"\r\n            >\r\n              {language === 'ru' ? (\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"font-bold text-base\"> </h3>\r\n                  <p className=\"font-medium\">     \"Kamizo\"</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">1.  </h4>\r\n                  <p>1.1.    (  )     \"Kamizo\" (  )       (  )         .</p>\r\n                  <p>1.2.              .</p>\r\n                  <p>1.3.                .</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">2.  </h4>\r\n                  <p>2.1.         , :</p>\r\n                  <ul className=\"list-disc pl-6 space-y-1\">\r\n                    <li>      ;</li>\r\n                    <li>    ;</li>\r\n                    <li>  - ;</li>\r\n                    <li>      ;</li>\r\n                    <li>  ;</li>\r\n                    <li>     ;</li>\r\n                    <li>   .</li>\r\n                  </ul>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">3.    </h4>\r\n                  <p>3.1.  :</p>\r\n                  <ul className=\"list-disc pl-6 space-y-1\">\r\n                    <li>       ;</li>\r\n                    <li>      ;</li>\r\n                    <li>    ;</li>\r\n                    <li>   .</li>\r\n                  </ul>\r\n                  <p className=\"mt-2\">3.2.  :</p>\r\n                  <ul className=\"list-disc pl-6 space-y-1\">\r\n                    <li>     ;</li>\r\n                    <li>      ;</li>\r\n                    <li>     ;</li>\r\n                    <li>     .</li>\r\n                  </ul>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">4.    </h4>\r\n                  <p>4.1.        .</p>\r\n                  <p>4.2.     10  ,   .</p>\r\n                  <p>4.3.        0,1%       .</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">5.  </h4>\r\n                  <p>5.1.               .</p>\r\n                  <p>5.2.      ,     .</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">6.  </h4>\r\n                  <p>6.1.            .</p>\r\n                  <p>6.2.               .</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">7.   </h4>\r\n                  <p>7.1.     .</p>\r\n                  <p>7.2.              .</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">8.  </h4>\r\n                  <p>8.1.                 30 .</p>\r\n                  <p>8.2.            .</p>\r\n\r\n                  <div className=\"mt-6 p-4 bg-orange-50 rounded-xl border border-orange-200\">\r\n                    <p className=\"font-medium text-orange-800\">\r\n                         ,    .\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"font-bold text-base\">OMMAVIY OFERTA</h3>\r\n                  <p className=\"font-medium\">\"Kamizo\" boshqaruv kompaniyasi xizmatlarini ko'rsatish bo'yicha</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">1. UMUMIY QOIDALAR</h4>\r\n                  <p>1.1. Ushbu ommaviy oferta (keyingi o'rinlarda - Oferta) \"Kamizo\" MChJ (keyingi o'rinlarda - Ijrochi) tomonidan cheklanmagan doiradagi jismoniy va yuridik shaxslarga (keyingi o'rinlarda - Buyurtmachi) ko'p qavatli uyni boshqarish xizmatlarini ko'rsatish bo'yicha shartnoma tuzish haqidagi rasmiy taklifdir.</p>\r\n                  <p>1.2. Ushbu Ofertaning to'liq va shartsiz aksepti - Buyurtmachining tizimda ro'yxatdan o'tishi va xizmatdan foydalanishidir.</p>\r\n                  <p>1.3. Oferta aksept qilingan paytdan boshlab kuchga kiradi va tomonlar o'z majburiyatlarini to'liq bajargunga qadar amal qiladi.</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">2. OFERTA PREDMETI</h4>\r\n                  <p>2.1. Ijrochi Buyurtmachiga ko'p qavatli uyni boshqarish xizmatlarini ko'rsatishni o'z zimmasiga oladi, jumladan:</p>\r\n                  <ul className=\"list-disc pl-6 space-y-1\">\r\n                    <li>Umumiy mulkning texnik xizmati va joriy ta'miri;</li>\r\n                    <li>Umumiy foydalanish joylarini sanitariya-gigienik holatda saqlash;</li>\r\n                    <li>Kun-tun avariya-dispetcherlik xizmatini tashkil etish;</li>\r\n                    <li>Qattiq maishiy chiqindilarni yig'ish va olib chiqishni ta'minlash;</li>\r\n                    <li>Uy atrofi hududini saqlash;</li>\r\n                    <li>Liftlar va muhandislik tizimlariga texnik xizmat ko'rsatish;</li>\r\n                    <li>Qo'riqlash va video kuzatuvni tashkil etish.</li>\r\n                  </ul>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">3. TOMONLARNING HUQUQ VA MAJBURIYATLARI</h4>\r\n                  <p>3.1. Ijrochi majburiyatlari:</p>\r\n                  <ul className=\"list-disc pl-6 space-y-1\">\r\n                    <li>Xizmat ko'rsatish bo'yicha arizalarni sifatli va o'z vaqtida bajarish;</li>\r\n                    <li>Ariza berish xizmatiga kun-tun kirish imkoniyatini ta'minlash;</li>\r\n                    <li>Bajarilgan ishlar bo'yicha hisobotlarni taqdim etish;</li>\r\n                    <li>Shaxsiy ma'lumotlar maxfiyligini saqlash.</li>\r\n                  </ul>\r\n                  <p className=\"mt-2\">3.2. Buyurtmachi majburiyatlari:</p>\r\n                  <ul className=\"list-disc pl-6 space-y-1\">\r\n                    <li>Ko'rsatilgan xizmatlar uchun o'z vaqtida to'lov qilish;</li>\r\n                    <li>Ishlarni bajarish uchun xonaga kirishni ta'minlash;</li>\r\n                    <li>Uyning umumiy mulkiga ehtiyotkorona munosabatda bo'lish;</li>\r\n                    <li>Ko'p qavatli uyda yashash qoidalariga rioya qilish.</li>\r\n                  </ul>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">4. NARX VA TO'LOV TARTIBI</h4>\r\n                  <p>4.1. Xizmatlar narxi boshqaruv kompaniyasining tasdiqlangan tariflariga muvofiq belgilanadi.</p>\r\n                  <p>4.2. To'lov hisob-kitob oyidan keyingi oyning 10-sanasigacha har oy amalga oshiriladi.</p>\r\n                  <p>4.3. To'lovni kechiktirgan taqdirda, har bir kechiktirilgan kun uchun qarz summasining 0,1% miqdorida jarima hisoblanadi.</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">5. TOMONLARNING JAVOBGARLIGI</h4>\r\n                  <p>5.1. Tomonlar o'z majburiyatlarini bajarmaslik yoki lozim darajada bajarmaslik uchun amaldagi qonunchilikka muvofiq javobgar bo'ladi.</p>\r\n                  <p>5.2. Ijrochi fors-major holatlari tufayli yetkazilgan zarar uchun javobgar emas.</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">6. SHAXSIY MA'LUMOTLAR</h4>\r\n                  <p>6.1. Buyurtmachi Maxfiylik siyosatiga muvofiq shaxsiy ma'lumotlarni qayta ishlashga rozilik beradi.</p>\r\n                  <p>6.2. Shaxsiy ma'lumotlar faqat xizmatlar ko'rsatish uchun ishlatiladi va Buyurtmachining roziligisiz uchinchi shaxslarga berilmaydi.</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">7. NIZOLARNI HAL ETISH TARTIBI</h4>\r\n                  <p>7.1. Barcha nizolar muzokaralar yo'li bilan hal etiladi.</p>\r\n                  <p>7.2. Kelishuvga erishish imkonsiz bo'lganda, nizo Ijrochi joylashgan joy sudiga ko'rib chiqish uchun topshiriladi.</p>\r\n\r\n                  <h4 className=\"font-semibold mt-4\">8. YAKUNIY QOIDALAR</h4>\r\n                  <p>8.1. Ushbu Oferta Ijrochi tomonidan bir tomonlama tartibda, Buyurtmachini kamida 30 kun oldin xabardor qilgan holda o'zgartirilishi mumkin.</p>\r\n                  <p>8.2. O'zgartirishlar kiritilganidan keyin xizmatdan foydalanishni davom ettirish Ofertaning yangi tahririga rozilikni bildiradi.</p>\r\n\r\n                  <div className=\"mt-6 p-4 bg-orange-50 rounded-xl border border-orange-200\">\r\n                    <p className=\"font-medium text-orange-800\">\r\n                      Oferta shartlarini qabul qilish uchun hujjat oxirigacha aylantiring.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Modal Footer */}\r\n            <div className=\"p-4 md:p-6 border-t border-gray-200 bg-gray-50 sm:rounded-b-2xl\">\r\n              <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4\">\r\n                <p className={`text-xs sm:text-sm text-center sm:text-left ${canAcceptOffer ? 'text-green-600' : 'text-gray-500'}`}>\r\n                  {canAcceptOffer\r\n                    ? (language === 'ru' ? '   ' : ' Siz hujjatni o\\'qidingiz')\r\n                    : (language === 'ru' ? '   ' : 'O\\'qish uchun pastga aylantiring')\r\n                  }\r\n                </p>\r\n                <div className=\"flex gap-2 sm:gap-3\">\r\n                  <button\r\n                    onClick={() => setShowOfferModal(false)}\r\n                    className=\"flex-1 sm:flex-none px-4 py-3 sm:py-2 text-gray-600 hover:bg-gray-100 active:bg-gray-200 rounded-xl transition-colors touch-manipulation text-sm sm:text-base\"\r\n                  >\r\n                    {language === 'ru' ? '' : 'Yopish'}\r\n                  </button>\r\n                  <button\r\n                    onClick={handleAcceptOffer}\r\n                    disabled={!canAcceptOffer}\r\n                    className={`flex-1 sm:flex-none px-6 py-3 sm:py-2 rounded-xl font-medium transition-colors touch-manipulation text-sm sm:text-base ${\r\n                      canAcceptOffer\r\n                        ? 'bg-orange-400 hover:bg-orange-500 active:bg-orange-600 text-gray-900'\r\n                        : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n                    }`}\r\n                  >\r\n                    {language === 'ru' ? '' : 'Qabul qilish'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { Bell, X, Loader2 } from 'lucide-react';\r\nimport { pushNotifications } from '../services/pushNotifications';\r\nimport { useAuthStore } from '../stores/authStore';\r\n\r\nexport function PushNotificationPrompt() {\r\n  const [show, setShow] = useState(false);\r\n  const [dismissed, setDismissed] = useState(false);\r\n  const [isSubscribing, setIsSubscribing] = useState(false);\r\n  const { user } = useAuthStore();\r\n\r\n  useEffect(() => {\r\n    // ,   \r\n    if (!pushNotifications.isBrowserNotificationsSupported()) {\r\n      return;\r\n    }\r\n\r\n    const permission = pushNotifications.getPermission();\r\n    const dismissedKey = `push_prompt_dismissed_${user?.id || 'anon'}`;\r\n    const wasDismissed = localStorage.getItem(dismissedKey);\r\n    const lastDismissedTime = wasDismissed ? parseInt(wasDismissed) : 0;\r\n    const daysSinceDismissed = (Date.now() - lastDismissedTime) / (1000 * 60 * 60 * 24);\r\n\r\n    //   :\r\n    // 1. permission === 'default'    \r\n    // 2.    7    \r\n    const shouldShow = permission === 'default' && (!wasDismissed || daysSinceDismissed > 7);\r\n\r\n    if (shouldShow) {\r\n      //     UX\r\n      const timer = setTimeout(() => setShow(true), 2000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [user?.id]);\r\n\r\n  const handleAllow = async () => {\r\n    setIsSubscribing(true);\r\n    try {\r\n      // Subscribe to Web Push (this also requests permission)\r\n      const subscription = await pushNotifications.subscribe();\r\n\r\n      // Show test notification via Service Worker for better mobile support\r\n      if ('serviceWorker' in navigator) {\r\n        try {\r\n          const swRegistration = await navigator.serviceWorker.ready;\r\n          await swRegistration.showNotification('  !', {\r\n            body: subscription\r\n              ? '       Kamizo    .'\r\n              : '         .',\r\n            icon: '/favicon.ico',\r\n            badge: '/favicon.ico',\r\n            tag: 'welcome-notification',\r\n            requireInteraction: false,\r\n          });\r\n        } catch (swError) {\r\n          console.warn('Service Worker notification failed, falling back:', swError);\r\n          // Fallback to browser Notification API\r\n          await pushNotifications.show({\r\n            title: '  !',\r\n            body: '         .',\r\n            requireInteraction: false,\r\n          });\r\n        }\r\n      } else if (!subscription) {\r\n        // No Service Worker, try browser notifications\r\n        const granted = await pushNotifications.requestPermission();\r\n        if (granted) {\r\n          await pushNotifications.show({\r\n            title: ' !',\r\n            body: '         .',\r\n            requireInteraction: false,\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to subscribe to push notifications:', error);\r\n    } finally {\r\n      setIsSubscribing(false);\r\n      setShow(false);\r\n      setDismissed(true);\r\n    }\r\n  };\r\n\r\n  const handleDismiss = () => {\r\n    const dismissedKey = `push_prompt_dismissed_${user?.id || 'anon'}`;\r\n    localStorage.setItem(dismissedKey, Date.now().toString());\r\n    setShow(false);\r\n    setDismissed(true);\r\n  };\r\n\r\n  if (!show || dismissed) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-in slide-in-from-bottom-4 duration-300\">\r\n      <div className=\"bg-white rounded-xl shadow-xl border border-gray-200 p-4\">\r\n        <div className=\"flex items-start gap-3\">\r\n          <div className=\"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0\">\r\n            <Bell className=\"w-5 h-5 text-yellow-600\" />\r\n          </div>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <h3 className=\"font-semibold text-gray-900\"> ?</h3>\r\n            <p className=\"text-sm text-gray-600 mt-1\">\r\n                   ,     .\r\n            </p>\r\n            <div className=\"flex gap-2 mt-3\">\r\n              <button\r\n                onClick={handleAllow}\r\n                disabled={isSubscribing}\r\n                className=\"px-4 py-2 bg-orange-400 hover:bg-orange-500 text-black font-medium rounded-lg transition-colors text-sm disabled:opacity-50 flex items-center gap-2\"\r\n              >\r\n                {isSubscribing ? (\r\n                  <>\r\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                    ...\r\n                  </>\r\n                ) : (\r\n                  ''\r\n                )}\r\n              </button>\r\n              <button\r\n                onClick={handleDismiss}\r\n                className=\"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors text-sm\"\r\n              >\r\n                \r\n              </button>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={handleDismiss}\r\n            className=\"text-gray-400 hover:text-gray-600 p-1\"\r\n          >\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { Component } from 'react';\r\nimport type { ErrorInfo, ReactNode } from 'react';\r\nimport { AlertTriangle, RefreshCw, Home } from 'lucide-react';\r\n\r\n/**\r\n * Production-Grade Error Boundary\r\n *\r\n * Features:\r\n * - Catches React errors in component tree\r\n * - Logs errors with context\r\n * - Shows user-friendly error UI\r\n * - Provides recovery options\r\n * - Sends errors to monitoring service\r\n */\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\r\n  isolate?: boolean; // If true, only catches errors in this subtree\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean;\r\n  error: Error | null;\r\n  errorInfo: ErrorInfo | null;\r\n  errorCount: number;\r\n}\r\n\r\nexport class ErrorBoundary extends Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n      errorCount: 0,\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): Partial<State> {\r\n    return {\r\n      hasError: true,\r\n      error,\r\n    };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    // Update state with error details\r\n    this.setState(prev => ({\r\n      errorInfo,\r\n      errorCount: prev.errorCount + 1,\r\n    }));\r\n\r\n    // Log to console\r\n    console.error(' ErrorBoundary caught error:', {\r\n      error: error.message,\r\n      componentStack: errorInfo.componentStack,\r\n    });\r\n\r\n    // Send to monitoring service\r\n    this.logError(error, errorInfo);\r\n\r\n    // Call custom error handler\r\n    this.props.onError?.(error, errorInfo);\r\n\r\n    // Send to external monitoring (if available)\r\n    if (import.meta.env.PROD) {\r\n      this.sendToMonitoring(error, errorInfo);\r\n    }\r\n  }\r\n\r\n  logError(error: Error, errorInfo: ErrorInfo) {\r\n    // Store in localStorage for debugging\r\n    try {\r\n      const errorLog = {\r\n        timestamp: new Date().toISOString(),\r\n        message: error.message,\r\n        stack: error.stack,\r\n        componentStack: errorInfo.componentStack,\r\n        userAgent: navigator.userAgent,\r\n        url: window.location.href,\r\n      };\r\n\r\n      const logs = JSON.parse(localStorage.getItem('error_logs') || '[]');\r\n      logs.push(errorLog);\r\n\r\n      // Keep only last 50 errors\r\n      if (logs.length > 50) {\r\n        logs.shift();\r\n      }\r\n\r\n      localStorage.setItem('error_logs', JSON.stringify(logs));\r\n    } catch (err) {\r\n      console.warn('Failed to log error to localStorage:', err);\r\n    }\r\n  }\r\n\r\n  async sendToMonitoring(error: Error, errorInfo: ErrorInfo) {\r\n    try {\r\n      // Send to backend monitoring endpoint\r\n      await fetch('/api/admin/monitoring/frontend-error', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          error: {\r\n            message: error.message,\r\n            stack: error.stack,\r\n            name: error.name,\r\n          },\r\n          componentStack: errorInfo.componentStack,\r\n          timestamp: new Date().toISOString(),\r\n          userAgent: navigator.userAgent,\r\n          url: window.location.href,\r\n          userId: localStorage.getItem('user_id'),\r\n        }),\r\n      });\r\n    } catch (err) {\r\n      console.warn('Failed to send error to monitoring:', err);\r\n    }\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n    });\r\n  };\r\n\r\n  handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  handleGoHome = () => {\r\n    window.location.href = '/';\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Use custom fallback if provided\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      // Default error UI\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50 px-4\">\r\n          <div className=\"max-w-2xl w-full\">\r\n            <div className=\"bg-white rounded-lg shadow-lg p-8\">\r\n              {/* Error Icon */}\r\n              <div className=\"flex items-center justify-center mb-6\">\r\n                <div className=\"bg-red-100 rounded-full p-4\">\r\n                  <AlertTriangle className=\"w-12 h-12 text-red-600\" />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Error Title */}\r\n              <h1 className=\"text-2xl font-bold text-gray-900 text-center mb-4\">\r\n                ! -   \r\n              </h1>\r\n\r\n              {/* Error Message */}\r\n              <p className=\"text-gray-600 text-center mb-6\">\r\n                  .      .\r\n              </p>\r\n\r\n              {/* Error Details (dev mode only) */}\r\n              {import.meta.env.DEV && this.state.error && (\r\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\r\n                  <p className=\"font-mono text-sm text-red-900 mb-2\">\r\n                    <strong>Error:</strong> {this.state.error.message}\r\n                  </p>\r\n                  {this.state.error.stack && (\r\n                    <details className=\"mt-2\">\r\n                      <summary className=\"cursor-pointer text-sm text-red-800 hover:text-red-900\">\r\n                        Stack Trace\r\n                      </summary>\r\n                      <pre className=\"mt-2 text-xs text-red-800 overflow-x-auto whitespace-pre-wrap\">\r\n                        {this.state.error.stack}\r\n                      </pre>\r\n                    </details>\r\n                  )}\r\n                  {this.state.errorInfo && (\r\n                    <details className=\"mt-2\">\r\n                      <summary className=\"cursor-pointer text-sm text-red-800 hover:text-red-900\">\r\n                        Component Stack\r\n                      </summary>\r\n                      <pre className=\"mt-2 text-xs text-red-800 overflow-x-auto whitespace-pre-wrap\">\r\n                        {this.state.errorInfo.componentStack}\r\n                      </pre>\r\n                    </details>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Recovery Actions */}\r\n              <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                <button\r\n                  onClick={this.handleReset}\r\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors\"\r\n                >\r\n                  <RefreshCw className=\"w-5 h-5\" />\r\n                   \r\n                </button>\r\n\r\n                <button\r\n                  onClick={this.handleGoHome}\r\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors\"\r\n                >\r\n                  <Home className=\"w-5 h-5\" />\r\n                   \r\n                </button>\r\n\r\n                <button\r\n                  onClick={this.handleReload}\r\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors\"\r\n                >\r\n                  <RefreshCw className=\"w-5 h-5\" />\r\n                  \r\n                </button>\r\n              </div>\r\n\r\n              {/* Error Count Warning */}\r\n              {this.state.errorCount > 1 && (\r\n                <div className=\"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3\">\r\n                  <p className=\"text-sm text-yellow-800 text-center\">\r\n                       ({this.state.errorCount} ).  \r\n                    .\r\n                  </p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Help Text */}\r\n              <p className=\"text-sm text-gray-500 text-center mt-6\">\r\n                  ,       .\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\n/**\r\n * Smaller error boundary for isolating specific components\r\n */\r\nexport function ComponentErrorBoundary({\r\n  children,\r\n  componentName,\r\n}: {\r\n  children: ReactNode;\r\n  componentName?: string;\r\n}) {\r\n  return (\r\n    <ErrorBoundary\r\n      fallback={\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 my-4\">\r\n          <div className=\"flex items-center gap-2 text-red-900 mb-2\">\r\n            <AlertTriangle className=\"w-5 h-5\" />\r\n            <p className=\"font-medium\">\r\n                {componentName || ''}\r\n            </p>\r\n          </div>\r\n          <p className=\"text-sm text-red-700\">\r\n               .   .\r\n          </p>\r\n        </div>\r\n      }\r\n      isolate\r\n    >\r\n      {children}\r\n    </ErrorBoundary>\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for manual error reporting\r\n */\r\nexport function useErrorReporter() {\r\n  return (error: Error, context?: Record<string, any>) => {\r\n    console.error('Manual error report:', error, context);\r\n\r\n    // Log to localStorage\r\n    try {\r\n      const errorLog = {\r\n        timestamp: new Date().toISOString(),\r\n        message: error.message,\r\n        stack: error.stack,\r\n        context,\r\n        userAgent: navigator.userAgent,\r\n        url: window.location.href,\r\n      };\r\n\r\n      const logs = JSON.parse(localStorage.getItem('error_logs') || '[]');\r\n      logs.push(errorLog);\r\n      if (logs.length > 50) logs.shift();\r\n      localStorage.setItem('error_logs', JSON.stringify(logs));\r\n    } catch (err) {\r\n      console.warn('Failed to log error:', err);\r\n    }\r\n\r\n    // Send to monitoring\r\n    if (import.meta.env.PROD) {\r\n      fetch('/api/admin/monitoring/frontend-error', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          error: {\r\n            message: error.message,\r\n            stack: error.stack,\r\n            name: error.name,\r\n          },\r\n          context,\r\n          timestamp: new Date().toISOString(),\r\n          userAgent: navigator.userAgent,\r\n          url: window.location.href,\r\n        }),\r\n      }).catch(err => console.warn('Failed to send error:', err));\r\n    }\r\n  };\r\n}\r\n","import { useEffect } from 'react';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport { useAuthStore } from './stores/authStore';\r\nimport { useCRMStore } from './stores/crmStore';\r\nimport { useDataStore } from './stores/dataStore';\r\nimport { Layout } from './components/layout';\r\nimport { LoginPage } from './pages/LoginPage';\r\nimport { PushNotificationPrompt } from './components/PushNotificationPrompt';\r\nimport { ErrorBoundary } from './components/ErrorBoundary';\r\n\r\nfunction App() {\r\n  const { user } = useAuthStore();\r\n  const { fetchBuildings } = useCRMStore();\r\n  const { fetchExecutors, fetchRequests, fetchVehicles } = useDataStore();\r\n\r\n  // Load data from API when user logs in\r\n  useEffect(() => {\r\n    if (user) {\r\n      console.log('User logged in, fetching data from API...');\r\n      fetchBuildings();\r\n\r\n      // Load executors for staff roles\r\n      if (['admin', 'manager', 'department_head', 'dispatcher'].includes(user.role)) {\r\n        fetchExecutors();\r\n      }\r\n\r\n      // Load requests for all roles\r\n      fetchRequests();\r\n\r\n      // Load vehicles for residents (needed for onboarding check)\r\n      if (user.role === 'resident') {\r\n        fetchVehicles();\r\n      }\r\n    }\r\n  }, [user, fetchBuildings, fetchExecutors, fetchRequests, fetchVehicles]);\r\n\r\n  return (\r\n    <ErrorBoundary>\r\n      <BrowserRouter>\r\n        {user ? (\r\n          <>\r\n            <Layout />\r\n            <PushNotificationPrompt />\r\n          </>\r\n        ) : (\r\n          <LoginPage />\r\n        )}\r\n      </BrowserRouter>\r\n    </ErrorBoundary>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { StrictMode } from 'react'\r\nimport { createRoot } from 'react-dom/client'\r\nimport './index.css'\r\nimport App from './App.tsx'\r\n\r\ncreateRoot(document.getElementById('root')!).render(\r\n  <StrictMode>\r\n    <App />\r\n  </StrictMode>,\r\n)\r\n"],"file":"index-1768935444692-CsUEvcLn.js"}
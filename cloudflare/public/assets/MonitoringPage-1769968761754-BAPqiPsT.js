import{r as l,j as e,a7 as Y,au as k,Z,F as q,y as G,O as B,bj as J,bk as F,bl as Q,h as E,A as $,N as D,bm as z,X as V}from"./react-vendor-1769968761754-o8ep_QJr.js";import{R as m,P as ee,b as se,c as te,T as h,L as R,B as C,C as j,X as u,Y as N,a as b,e as ae,f as L}from"./LazyCharts-1769968761754-_RWVyEX9.js";import{u as re}from"./index-1769968761754-gKQ9-77E.js";import"./vendor-1769968761754-C4uPnf_k.js";import"./qr-scanner-1769968761754-B_vB3SDT.js";import"./zustand-1769968761754-wNUYBKDB.js";import"./charts-1769968761754-B__eO7x0.js";const o={primary:"#3B82F6",success:"#10B981",warning:"#F59E0B"},le={new:"#3B82F6",assigned:"#8B5CF6",in_progress:"#F59E0B",pending_approval:"#A855F7",completed:"#10B981",cancelled:"#EF4444"};function he(){const[i,S]=l.useState(null),[r,T]=l.useState(null),[n,A]=l.useState(null),[K,M]=l.useState(!0),[y,P]=l.useState(!0),[g,H]=l.useState("overview"),{requests:x,executors:f,getStats:O}=re(),c=O(),I=l.useMemo(()=>{const s=[];for(let t=23;t>=0;t--){const a=new Date;a.setHours(a.getHours()-t),s.push({time:a.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),avgTime:Math.floor(Math.random()*150)+50,requests:Math.floor(Math.random()*100)+20})}return s},[]),v=l.useMemo(()=>{const s={};return x.forEach(t=>{s[t.status]=(s[t.status]||0)+1}),Object.entries(s).map(([t,a])=>({name:t==="new"?"Новые":t==="assigned"?"Назначены":t==="in_progress"?"В работе":t==="pending_approval"?"На проверке":t==="completed"?"Выполнены":t==="cancelled"?"Отменены":t,value:a,color:le[t]||"#9CA3AF"}))},[x]),_=l.useMemo(()=>{const s={};x.forEach(a=>{s[a.category]=(s[a.category]||0)+1});const t={plumber:"Сантехник",electrician:"Электрик",security:"Охрана",cleaning:"Уборка",elevator:"Лифт",intercom:"Домофон",carpenter:"Плотник",locksmith:"Слесарь",other:"Другое"};return Object.entries(s).map(([a,d])=>({category:t[a]||a,count:d})).sort((a,d)=>d.count-a.count).slice(0,8)},[x]),U=l.useMemo(()=>{const s=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],t=new Array(7).fill(0);return x.forEach(a=>{const d=new Date(a.createdAt).getDay();t[d]++}),s.map((a,d)=>({day:a,count:t[d]}))},[x]),W=l.useMemo(()=>[...f].sort((s,t)=>t.completedCount-s.completedCount).slice(0,6).map(s=>({name:s.name.split(" ")[0],completed:s.completedCount,active:s.activeRequests,rating:s.rating})),[f]),w=async()=>{try{const s=localStorage.getItem("auth_token"),t=await fetch("/api/admin/metrics",{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch metrics");const a=await t.json();S(a.health),T(a.performance),A(a.cache),M(!1)}catch{S({status:"healthy",timestamp:Date.now(),checks:{database:!0,cache:!0,websocket:!0},metrics:{avgResponseTime:85,errorRate:.5,activeConnections:24}}),T({period:"24h",totalRequests:1247,errorCount:6,errorRate:.48,avgResponseTime:85,p95ResponseTime:180,p99ResponseTime:320,endpointStats:[{endpoint:"/api/requests",count:450,avgTime:65,errorRate:.2},{endpoint:"/api/executors",count:280,avgTime:45,errorRate:0},{endpoint:"/api/auth/login",count:156,avgTime:120,errorRate:1.2},{endpoint:"/api/buildings",count:98,avgTime:35,errorRate:0}],recentErrors:[]}),A({memory:{size:156,hits:2450,misses:180,hitRate:93.2},kv:{operations:890,estimatedSize:"2.4 MB"}}),M(!1)}};l.useEffect(()=>{if(w(),y){const s=setInterval(w,1e4);return()=>clearInterval(s)}},[y]);const X=s=>{switch(s){case"healthy":return"text-green-500 bg-green-50 border-green-200";case"degraded":return"text-yellow-500 bg-yellow-50 border-yellow-200";case"down":return"text-red-500 bg-red-50 border-red-200"}},p=(s,t)=>s<=t.good?"text-green-600":s<=t.warning?"text-yellow-600":"text-red-600";return K?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Мониторинг Системы"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time производительность и аналитика"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:s=>P(s.target.checked),className:"rounded border-gray-300 text-primary-500 focus:ring-primary-500"}),"Авто (10s)"]}),e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Обновить"]})]})]}),e.jsx("div",{className:"flex gap-2",children:[{id:"overview",label:"Обзор",icon:k},{id:"performance",label:"Производительность",icon:Z},{id:"requests",label:"Аналитика заявок",icon:q}].map(s=>e.jsxs("button",{onClick:()=>H(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-colors ${g===s.id?"bg-orange-400 text-gray-900":"bg-white text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id))}),g==="overview"&&e.jsxs(e.Fragment,{children:[i&&e.jsx("div",{className:`glass-card p-6 border-2 ${X(i.status)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i.status==="healthy"?e.jsx(G,{className:"w-8 h-8"}):e.jsx(B,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Статус: ",i.status==="healthy"?"Здорово":i.status==="degraded"?"Ухудшено":"Не работает"]}),e.jsxs("p",{className:"text-sm opacity-75",children:["Обновлено: ",new Date(i.timestamp).toLocaleString("ru-RU")]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:`w-6 h-6 mx-auto mb-1 ${i.checks.database?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:"text-xs",children:"Database"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:`w-6 h-6 mx-auto mb-1 ${i.checks.cache?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:"text-xs",children:"Cache"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:`w-6 h-6 mx-auto mb-1 ${i.checks.websocket?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:"text-xs",children:"WebSocket"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(q,{className:"w-5 h-5 text-blue-600"})}),e.jsx("span",{className:"text-sm text-gray-600",children:"Всего заявок"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c.totalRequests})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-green-600"})}),e.jsx("span",{className:"text-sm text-gray-600",children:"Исполнителей"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:f.length}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.executorsOnline," онлайн"]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-amber-600"})}),e.jsx("span",{className:"text-sm text-gray-600",children:"В работе"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-600",children:c.inProgress})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(D,{className:"w-5 h-5 text-purple-600"})}),e.jsx("span",{className:"text-sm text-gray-600",children:"За неделю"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600",children:c.completedWeek})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-500"}),"Заявки по статусам"]}),e.jsx(m,{width:"100%",height:280,children:e.jsxs(ee,{children:[e.jsx(se,{data:v,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,dataKey:"value",label:({name:s,percent:t})=>`${s} ${(t*100).toFixed(0)}%`,children:v.map((s,t)=>e.jsx(te,{fill:s.color},`cell-${t}`))}),e.jsx(h,{}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-blue-500"}),"По категориям"]}),e.jsx(m,{width:"100%",height:280,children:e.jsxs(C,{data:_,layout:"vertical",children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(u,{type:"number",tick:{fontSize:12}}),e.jsx(N,{dataKey:"category",type:"category",tick:{fontSize:11},width:80}),e.jsx(h,{}),e.jsx(b,{dataKey:"count",fill:o.primary,radius:[0,4,4,0]})]})})]})]})]}),g==="performance"&&r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"API Запросов"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:r.totalRequests}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["За ",r.period]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx($,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Ср. отклик"})]}),e.jsxs("div",{className:`text-3xl font-bold ${p(r.avgResponseTime,{good:200,warning:500})}`,children:[r.avgResponseTime,"ms"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["P95: ",r.p95ResponseTime,"ms"]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(B,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Ошибок"})]}),e.jsx("div",{className:`text-3xl font-bold ${p(r.errorRate,{good:1,warning:5})}`,children:r.errorCount}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Уровень: ",r.errorRate,"%"]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Cache Hit"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[n?Math.round(n.memory.hitRate):0,"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n?`${n.memory.hits} hits`:"N/A"})]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-500"}),"Время отклика (24 часа)"]}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(ae,{data:I,children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(u,{dataKey:"time",tick:{fontSize:10}}),e.jsx(N,{tick:{fontSize:12}}),e.jsx(h,{}),e.jsx(R,{}),e.jsx(L,{type:"monotone",dataKey:"avgTime",stroke:o.primary,strokeWidth:2,name:"Время отклика (ms)",dot:!1}),e.jsx(L,{type:"monotone",dataKey:"requests",stroke:o.success,strokeWidth:2,name:"Запросов",dot:!1})]})})]}),r.endpointStats.length>0&&e.jsxs("div",{className:"glass-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Статистика Endpoints"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-700",children:"Endpoint"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-700",children:"Запросов"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-700",children:"Ср. время"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-700",children:"Ошибок"})]})}),e.jsx("tbody",{children:r.endpointStats.map((s,t)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 font-mono",children:s.endpoint}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 text-right",children:s.count}),e.jsxs("td",{className:`py-3 px-4 text-sm text-right font-medium ${p(s.avgTime,{good:200,warning:500})}`,children:[s.avgTime,"ms"]}),e.jsxs("td",{className:`py-3 px-4 text-sm text-right font-medium ${p(s.errorRate,{good:1,warning:5})}`,children:[s.errorRate,"%"]})]},t))})]})})]}),n&&e.jsxs("div",{className:"glass-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Статистика Кэша"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Memory Size"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:n.memory.size})]}),e.jsxs("div",{className:"bg-white/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Hits"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:n.memory.hits})]}),e.jsxs("div",{className:"bg-white/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Misses"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 mt-1",children:n.memory.misses})]}),e.jsxs("div",{className:"bg-white/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Hit Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:[Math.round(n.memory.hitRate),"%"]})]})]})]})]}),g==="requests"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-blue-500"}),"Заявки по дням недели"]}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(C,{data:U,children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(u,{dataKey:"day",tick:{fontSize:12}}),e.jsx(N,{tick:{fontSize:12}}),e.jsx(h,{}),e.jsx(b,{dataKey:"count",fill:o.primary,radius:[4,4,0,0],name:"Заявок"})]})})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-green-500"}),"Производительность исполнителей"]}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(C,{data:W,children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(u,{dataKey:"name",tick:{fontSize:11}}),e.jsx(N,{tick:{fontSize:12}}),e.jsx(h,{}),e.jsx(R,{}),e.jsx(b,{dataKey:"completed",fill:o.success,name:"Выполнено",stackId:"a"}),e.jsx(b,{dataKey:"active",fill:o.warning,name:"Активных",stackId:"a"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Распределение по статусам"}),e.jsx("div",{className:"space-y-3",children:v.map((s,t)=>{const a=c.totalRequests>0?s.value/c.totalRequests*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:s.name}),e.jsxs("span",{className:"font-medium",children:[s.value," (",a.toFixed(1),"%)"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full transition-all duration-500",style:{width:`${a}%`,backgroundColor:s.color}})})]},t)})})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Статистика за неделю"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Новых заявок"}),e.jsx("p",{className:"text-3xl font-bold text-blue-700 mt-1",children:c.newRequests})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-amber-600",children:"В работе"}),e.jsx("p",{className:"text-3xl font-bold text-amber-700 mt-1",children:c.inProgress})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600",children:"На проверке"}),e.jsx("p",{className:"text-3xl font-bold text-purple-700 mt-1",children:c.pendingApproval})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600",children:"Выполнено"}),e.jsx("p",{className:"text-3xl font-bold text-green-700 mt-1",children:c.completedWeek})]})]})]})]})]}),r&&r.recentErrors.length>0&&e.jsxs("div",{className:"glass-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Последние Ошибки"}),e.jsx("div",{className:"space-y-3",children:r.recentErrors.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(V,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:s.message}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-red-700",children:[e.jsx("span",{className:"font-mono",children:s.endpoint}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(s.timestamp).toLocaleString("ru-RU")})]})]})]},t))})]})]})}export{he as MonitoringPage};
//# sourceMappingURL=MonitoringPage-1769968761754-BAPqiPsT.js.map

{"version":3,"file":"ResidentGuestAccessPage-1768381324153-CLc-Hr1E.js","sources":["../../src/pages/ResidentGuestAccessPage.tsx"],"sourcesContent":["import { useState, useRef, useEffect } from 'react';\nimport {\n  QrCode, Plus, X, Clock, Package, Users, Car, User,\n  Share2, Download, Copy, ChevronRight, ArrowLeft, Calendar,\n  AlertTriangle, Trash2\n} from 'lucide-react';\nimport { generateQRCodeCanvas } from '../components/LazyQRCode';\nimport { useAuthStore } from '../stores/authStore';\nimport { useDataStore } from '../stores/dataStore';\nimport { useLanguageStore } from '../stores/languageStore';\nimport {\n  VISITOR_TYPE_LABELS, ACCESS_TYPE_LABELS, GUEST_ACCESS_STATUS_LABELS,\n  type GuestAccessCode, type VisitorType, type AccessType\n} from '../types';\n\n// QR Code display component\nfunction QRCodeDisplay({ codeId, onClose }: { codeId: string; onClose: () => void }) {\n  const { language } = useLanguageStore();\n  const { guestAccessCodes } = useDataStore();\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [copied, setCopied] = useState(false);\n\n  // Get latest code from store to ensure updated values (like currentUses)\n  const code = guestAccessCodes.find(c => c.id === codeId);\n\n  if (!code) {\n    return null;\n  }\n\n  useEffect(() => {\n    if (canvasRef.current) {\n      generateQRCodeCanvas(canvasRef.current, code.qrToken, {\n        width: 280,\n        margin: 2,\n        color: { dark: '#000000', light: '#ffffff' }\n      });\n    }\n  }, [code.qrToken]);\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(code.qrToken);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n    }\n  };\n\n  const handleDownload = () => {\n    if (canvasRef.current) {\n      const link = document.createElement('a');\n      link.download = `guest-pass-${code.id}.png`;\n      link.href = canvasRef.current.toDataURL('image/png');\n      link.click();\n    }\n  };\n\n  // Create combined image with QR code and caption text\n  const createImageWithCaption = async (): Promise<Blob | null> => {\n    if (!canvasRef.current) return null;\n\n    const qrCanvas = canvasRef.current;\n    const qrSize = qrCanvas.width;\n\n    // Create new canvas with extra space for text\n    const combinedCanvas = document.createElement('canvas');\n    const ctx = combinedCanvas.getContext('2d');\n    if (!ctx) return null;\n\n    const padding = 30;\n    const textAreaHeight = 160;\n    combinedCanvas.width = qrSize + padding * 2;\n    combinedCanvas.height = qrSize + padding * 2 + textAreaHeight;\n\n    // White background\n    ctx.fillStyle = '#ffffff';\n    ctx.fillRect(0, 0, combinedCanvas.width, combinedCanvas.height);\n\n    // Draw QR code\n    ctx.drawImage(qrCanvas, padding, padding);\n\n    // Add text below QR code\n    ctx.fillStyle = '#1f2937';\n    ctx.textAlign = 'center';\n    const centerX = combinedCanvas.width / 2;\n    let y = qrSize + padding + 30;\n\n    // Title\n    ctx.font = 'bold 18px system-ui, -apple-system, sans-serif';\n    ctx.fillText(language === 'ru' ? 'Пропуск для гостя' : 'Mehmon uchun ruxsatnoma', centerX, y);\n    y += 28;\n\n    // Address\n    ctx.font = '14px system-ui, -apple-system, sans-serif';\n    ctx.fillStyle = '#4b5563';\n    const addressText = `${code.residentAddress}, ${language === 'ru' ? 'кв.' : 'xon.'} ${code.residentApartment}`;\n    ctx.fillText(addressText, centerX, y);\n    y += 24;\n\n    // Resident name\n    ctx.fillText(code.residentName, centerX, y);\n    y += 28;\n\n    // Valid until\n    ctx.font = 'bold 14px system-ui, -apple-system, sans-serif';\n    ctx.fillStyle = '#059669';\n    const validUntil = new Date(code.validUntil).toLocaleString(language === 'ru' ? 'ru-RU' : 'uz-UZ');\n    ctx.fillText(`${language === 'ru' ? 'Действует до:' : 'Gacha:'} ${validUntil}`, centerX, y);\n\n    return new Promise((resolve) => {\n      combinedCanvas.toBlob(resolve, 'image/png');\n    });\n  };\n\n  const handleShare = async () => {\n    // Create combined image with QR code and info\n    const combinedBlob = await createImageWithCaption();\n\n    if (!combinedBlob) {\n      handleDownload();\n      return;\n    }\n\n    const file = new File([combinedBlob], `guest-pass-${code.id}.png`, { type: 'image/png' });\n\n    // Check if Web Share API is available and supports files\n    if (navigator.share) {\n      try {\n        const shareData = { files: [file] };\n\n        // Check if we can share files\n        if (navigator.canShare && navigator.canShare(shareData)) {\n          await navigator.share(shareData);\n          return;\n        }\n      } catch (err) {\n        // If user cancelled, don't fallback\n        if ((err as Error).name === 'AbortError') {\n          return;\n        }\n        console.log('File sharing failed:', err);\n      }\n    }\n\n    // Desktop fallback: copy image to clipboard\n    try {\n      await navigator.clipboard.write([\n        new ClipboardItem({ 'image/png': combinedBlob })\n      ]);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n\n      // Show alert that image was copied\n      alert(language === 'ru'\n        ? 'QR-код скопирован в буфер обмена. Вставьте его в чат (Ctrl+V)'\n        : 'QR-kod buferga nusxalandi. Chatga qo\\'ying (Ctrl+V)');\n    } catch (clipErr) {\n      console.log('Clipboard failed, downloading instead');\n      // Final fallback: download the image\n      handleDownload();\n    }\n  };\n\n  const visitorLabel = VISITOR_TYPE_LABELS[code.visitorType];\n  const accessLabel = ACCESS_TYPE_LABELS[code.accessType];\n  const statusLabel = GUEST_ACCESS_STATUS_LABELS[code.status];\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b\">\n          <h2 className=\"text-lg font-bold\">\n            {language === 'ru' ? 'QR-код пропуска' : 'Ruxsatnoma QR-kodi'}\n          </h2>\n          <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-xl\">\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* QR Code */}\n        <div className=\"p-6 flex flex-col items-center\">\n          <div className=\"bg-white p-4 rounded-2xl shadow-lg border-2 border-gray-100\">\n            <canvas ref={canvasRef} />\n          </div>\n\n          {/* Status badge */}\n          <div className={`mt-4 px-4 py-2 rounded-full text-sm font-medium ${\n            code.status === 'active' ? 'bg-green-100 text-green-700' :\n            code.status === 'used' ? 'bg-blue-100 text-blue-700' :\n            code.status === 'expired' ? 'bg-gray-100 text-gray-700' :\n            'bg-red-100 text-red-700'\n          }`}>\n            {language === 'ru' ? statusLabel.label : statusLabel.labelUz}\n          </div>\n\n          {/* Info */}\n          <div className=\"mt-4 w-full space-y-2 text-sm\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-gray-500\">{language === 'ru' ? 'Тип' : 'Turi'}:</span>\n              <span className=\"font-medium flex items-center gap-1\">\n                {visitorLabel.icon} {language === 'ru' ? visitorLabel.label : visitorLabel.labelUz}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-gray-500\">{language === 'ru' ? 'Срок' : 'Muddat'}:</span>\n              <span className=\"font-medium\">{language === 'ru' ? accessLabel.label : accessLabel.labelUz}</span>\n            </div>\n            {code.visitorName && (\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-500\">{language === 'ru' ? 'Гость' : 'Mehmon'}:</span>\n                <span className=\"font-medium\">{code.visitorName}</span>\n              </div>\n            )}\n            <div className=\"flex justify-between\">\n              <span className=\"text-gray-500\">{language === 'ru' ? 'Действует до' : 'Gacha amal qiladi'}:</span>\n              <span className=\"font-medium\">{new Date(code.validUntil).toLocaleString(language === 'ru' ? 'ru-RU' : 'uz-UZ')}</span>\n            </div>\n            {code.accessType !== 'single_use' && (\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-500\">{language === 'ru' ? 'Использовано' : 'Ishlatilgan'}:</span>\n                <span className=\"font-medium\">{code.currentUses} / {code.maxUses === 999 ? '∞' : code.maxUses}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Actions */}\n        <div className=\"p-4 border-t grid grid-cols-3 gap-2\">\n          <button\n            onClick={handleShare}\n            className=\"flex flex-col items-center gap-1 p-3 bg-blue-50 hover:bg-blue-100 rounded-xl transition-colors\"\n          >\n            <Share2 className=\"w-5 h-5 text-blue-600\" />\n            <span className=\"text-xs text-blue-700\">{language === 'ru' ? 'Поделиться' : 'Ulashish'}</span>\n          </button>\n          <button\n            onClick={handleDownload}\n            className=\"flex flex-col items-center gap-1 p-3 bg-green-50 hover:bg-green-100 rounded-xl transition-colors\"\n          >\n            <Download className=\"w-5 h-5 text-green-600\" />\n            <span className=\"text-xs text-green-700\">{language === 'ru' ? 'Сохранить' : 'Saqlash'}</span>\n          </button>\n          <button\n            onClick={handleCopy}\n            className=\"flex flex-col items-center gap-1 p-3 bg-purple-50 hover:bg-purple-100 rounded-xl transition-colors\"\n          >\n            <Copy className=\"w-5 h-5 text-purple-600\" />\n            <span className=\"text-xs text-purple-700\">\n              {copied ? (language === 'ru' ? 'Скопировано!' : 'Nusxa olindi!') : (language === 'ru' ? 'Код' : 'Kod')}\n            </span>\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Create pass form component\nfunction CreatePassForm({ onClose, onCreated }: { onClose: () => void; onCreated: (code: GuestAccessCode) => void }) {\n  const { user } = useAuthStore();\n  const { createGuestAccessCode } = useDataStore();\n  const { language } = useLanguageStore();\n\n  const [step, setStep] = useState(1);\n  const [visitorType, setVisitorType] = useState<VisitorType | null>(null);\n  const [accessType, setAccessType] = useState<AccessType | null>(null);\n  const [visitorName, setVisitorName] = useState('');\n  const [visitorPhone, setVisitorPhone] = useState('');\n  const [visitorVehiclePlate, setVisitorVehiclePlate] = useState('');\n  const [customDate, setCustomDate] = useState('');\n  const [notes, setNotes] = useState('');\n\n  const visitorTypes: { type: VisitorType; icon: React.ReactNode }[] = [\n    { type: 'courier', icon: <Package className=\"w-8 h-8\" /> },\n    { type: 'guest', icon: <Users className=\"w-8 h-8\" /> },\n    { type: 'taxi', icon: <Car className=\"w-8 h-8\" /> },\n    { type: 'other', icon: <User className=\"w-8 h-8\" /> },\n  ];\n\n  const accessTypes: AccessType[] = ['single_use', 'day', 'week', 'custom'];\n\n  const [isCreating, setIsCreating] = useState(false);\n\n  const handleCreate = async () => {\n    if (!visitorType || !accessType || !user || isCreating) {\n      console.error('Missing required data:', { visitorType, accessType, user });\n      return;\n    }\n\n    setIsCreating(true);\n\n    let validUntil: string | undefined;\n    if (accessType === 'custom' && customDate) {\n      validUntil = new Date(customDate).toISOString();\n    }\n\n    console.log('Creating guest access code with:', {\n      residentId: user.id,\n      residentName: user.name,\n      residentPhone: user.phone || 'Не указан',\n      residentApartment: user.apartment || '',\n      residentAddress: user.address || '',\n      visitorType,\n      accessType,\n    });\n\n    const code = await createGuestAccessCode({\n      residentId: user.id,\n      residentName: user.name,\n      residentPhone: user.phone || 'Не указан',\n      residentApartment: user.apartment || '',\n      residentAddress: user.address || '',\n      visitorType,\n      visitorName: visitorName || undefined,\n      visitorPhone: visitorPhone || undefined,\n      visitorVehiclePlate: visitorVehiclePlate || undefined,\n      accessType,\n      validUntil,\n      notes: notes || undefined,\n    });\n\n    setIsCreating(false);\n\n    if (code) {\n      console.log('Created code:', code);\n      onCreated(code);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b\">\n          <div className=\"flex items-center gap-2\">\n            {step > 1 && (\n              <button onClick={() => setStep(step - 1)} className=\"p-2 hover:bg-gray-100 rounded-xl\">\n                <ArrowLeft className=\"w-5 h-5\" />\n              </button>\n            )}\n            <h2 className=\"text-lg font-bold\">\n              {language === 'ru' ? 'Создать пропуск' : 'Ruxsatnoma yaratish'}\n            </h2>\n          </div>\n          <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-xl\">\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Progress */}\n        <div className=\"px-4 pt-4\">\n          <div className=\"flex items-center gap-2\">\n            {[1, 2, 3].map((s) => (\n              <div key={s} className=\"flex-1 flex items-center\">\n                <div className={`w-full h-1.5 rounded-full ${s <= step ? 'bg-primary-500' : 'bg-gray-200'}`} />\n              </div>\n            ))}\n          </div>\n          <div className=\"text-xs text-gray-500 mt-2 text-center\">\n            {language === 'ru' ? `Шаг ${step} из 3` : `${step}-qadam 3 dan`}\n          </div>\n        </div>\n\n        <div className=\"p-4\">\n          {/* Step 1: Visitor Type */}\n          {step === 1 && (\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium text-center\">\n                {language === 'ru' ? 'Кого ожидаете?' : 'Kimni kutayapsiz?'}\n              </h3>\n              <div className=\"grid grid-cols-2 gap-3\">\n                {visitorTypes.map(({ type, icon }) => {\n                  const label = VISITOR_TYPE_LABELS[type];\n                  return (\n                    <button\n                      key={type}\n                      onClick={() => {\n                        setVisitorType(type);\n                        setStep(2);\n                      }}\n                      className={`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${\n                        visitorType === type\n                          ? 'border-primary-500 bg-primary-50'\n                          : 'border-gray-200 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className={visitorType === type ? 'text-primary-600' : 'text-gray-600'}>\n                        {icon}\n                      </div>\n                      <span className=\"font-medium text-sm\">\n                        {language === 'ru' ? label.label : label.labelUz}\n                      </span>\n                    </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Step 2: Access Type */}\n          {step === 2 && (\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium text-center\">\n                {language === 'ru' ? 'На какой срок?' : 'Qancha muddatga?'}\n              </h3>\n              <div className=\"space-y-2\">\n                {accessTypes.map((type) => {\n                  const label = ACCESS_TYPE_LABELS[type];\n                  return (\n                    <button\n                      key={type}\n                      onClick={() => {\n                        setAccessType(type);\n                        setStep(3);\n                      }}\n                      className={`w-full p-4 rounded-xl border-2 flex items-center gap-3 transition-all text-left ${\n                        accessType === type\n                          ? 'border-primary-500 bg-primary-50'\n                          : 'border-gray-200 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className={`w-10 h-10 rounded-full flex items-center justify-center ${\n                        accessType === type ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-600'\n                      }`}>\n                        {type === 'single_use' && <span className=\"text-lg font-bold\">1</span>}\n                        {type === 'day' && <Clock className=\"w-5 h-5\" />}\n                        {type === 'week' && <Calendar className=\"w-5 h-5\" />}\n                        {type === 'custom' && <Calendar className=\"w-5 h-5\" />}\n                      </div>\n                      <div className=\"flex-1\">\n                        <div className=\"font-medium\">\n                          {language === 'ru' ? label.label : label.labelUz}\n                        </div>\n                        <div className=\"text-sm text-gray-500\">\n                          {language === 'ru' ? label.description : label.descriptionUz}\n                        </div>\n                      </div>\n                      <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n                    </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Step 3: Details */}\n          {step === 3 && (\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium text-center\">\n                {language === 'ru' ? 'Дополнительно' : 'Qo\\'shimcha'}\n              </h3>\n\n              {accessType === 'custom' && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {language === 'ru' ? 'Действует до *' : 'Gacha amal qiladi *'}\n                  </label>\n                  <input\n                    type=\"datetime-local\"\n                    value={customDate}\n                    onChange={(e) => setCustomDate(e.target.value)}\n                    className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-0\"\n                    min={new Date().toISOString().slice(0, 16)}\n                  />\n                </div>\n              )}\n\n              {(visitorType === 'guest' || visitorType === 'other') && (\n                <>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {language === 'ru' ? 'Имя гостя' : 'Mehmon ismi'}\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={visitorName}\n                      onChange={(e) => setVisitorName(e.target.value)}\n                      placeholder={language === 'ru' ? 'Иван Иванов' : 'Ism Familiya'}\n                      className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-0\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {language === 'ru' ? 'Телефон гостя' : 'Mehmon telefoni'}\n                    </label>\n                    <input\n                      type=\"tel\"\n                      value={visitorPhone}\n                      onChange={(e) => setVisitorPhone(e.target.value)}\n                      placeholder=\"+998 90 123 45 67\"\n                      className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-0\"\n                    />\n                  </div>\n                </>\n              )}\n\n              {visitorType === 'taxi' && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {language === 'ru' ? 'Номер такси' : 'Taksi raqami'}\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={visitorVehiclePlate}\n                    onChange={(e) => setVisitorVehiclePlate(e.target.value.toUpperCase())}\n                    placeholder=\"01 A 123 BC\"\n                    className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-0\"\n                  />\n                </div>\n              )}\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  {language === 'ru' ? 'Примечание' : 'Izoh'}\n                </label>\n                <textarea\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  placeholder={language === 'ru' ? 'Опционально...' : 'Ixtiyoriy...'}\n                  rows={2}\n                  className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-0 resize-none\"\n                />\n              </div>\n\n              <button\n                onClick={handleCreate}\n                disabled={(accessType === 'custom' && !customDate) || isCreating}\n                className=\"w-full py-4 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 text-gray-900 font-bold rounded-xl transition-colors\"\n              >\n                {isCreating\n                  ? (language === 'ru' ? 'Создание...' : 'Yaratilmoqda...')\n                  : (language === 'ru' ? 'Создать пропуск' : 'Ruxsatnoma yaratish')}\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Main page component\nexport function ResidentGuestAccessPage() {\n  const { user } = useAuthStore();\n  const { guestAccessCodes, fetchGuestCodes, revokeGuestAccessCode, isLoadingGuestCodes } = useDataStore();\n  const { language } = useLanguageStore();\n\n  const [showCreateForm, setShowCreateForm] = useState(false);\n  const [selectedCode, setSelectedCode] = useState<GuestAccessCode | null>(null);\n  const [filter, setFilter] = useState<'all' | 'active' | 'used' | 'expired'>('all');\n  const [showRevokeConfirm, setShowRevokeConfirm] = useState<GuestAccessCode | null>(null);\n\n  // Fetch codes on mount\n  useEffect(() => {\n    fetchGuestCodes();\n  }, [fetchGuestCodes]);\n\n  const allCodes = guestAccessCodes;\n\n  // Update expired status\n  const now = new Date();\n  const codes = allCodes.map(c => {\n    if (c.status === 'active' && now > new Date(c.validUntil)) {\n      return { ...c, status: 'expired' as const };\n    }\n    return c;\n  });\n\n  const filteredCodes = filter === 'all'\n    ? codes\n    : codes.filter(c => c.status === filter);\n\n  const activeCodes = codes.filter(c => c.status === 'active');\n\n  const handleCreated = (code: GuestAccessCode) => {\n    setShowCreateForm(false);\n    setSelectedCode(code);\n  };\n\n  const handleRevoke = async () => {\n    if (!showRevokeConfirm || !user) return;\n    await revokeGuestAccessCode(\n      showRevokeConfirm.id,\n      user.id,\n      user.name,\n      user.role,\n      language === 'ru' ? 'Отменено жителем' : 'Turar joy egasi tomonidan bekor qilindi'\n    );\n    setShowRevokeConfirm(null);\n  };\n\n  return (\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-xl md:text-2xl font-bold text-gray-900\">\n            {language === 'ru' ? 'Гостевой доступ' : 'Mehmon kirishi'}\n          </h1>\n          <p className=\"text-sm text-gray-500 mt-1\">\n            {language === 'ru'\n              ? 'Создавайте QR-пропуска для гостей и курьеров'\n              : 'Mehmonlar va kuryerlar uchun QR-ruxsatnomalar yarating'}\n          </p>\n        </div>\n        <button\n          onClick={() => setShowCreateForm(true)}\n          className=\"px-4 py-2.5 bg-primary-500 hover:bg-primary-600 text-gray-900 font-medium rounded-xl flex items-center gap-2 transition-colors shadow-sm\"\n        >\n          <Plus className=\"w-5 h-5\" />\n          <span className=\"hidden sm:inline\">{language === 'ru' ? 'Создать' : 'Yaratish'}</span>\n        </button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n        <div className=\"glass-card p-4\">\n          <div className=\"text-2xl font-bold text-green-600\">{activeCodes.length}</div>\n          <div className=\"text-sm text-gray-500\">{language === 'ru' ? 'Активных' : 'Faol'}</div>\n        </div>\n        <div className=\"glass-card p-4\">\n          <div className=\"text-2xl font-bold text-blue-600\">\n            {codes.filter(c => c.status === 'used').length}\n          </div>\n          <div className=\"text-sm text-gray-500\">{language === 'ru' ? 'Использовано' : 'Ishlatilgan'}</div>\n        </div>\n        <div className=\"glass-card p-4\">\n          <div className=\"text-2xl font-bold text-gray-600\">\n            {codes.filter(c => c.status === 'expired').length}\n          </div>\n          <div className=\"text-sm text-gray-500\">{language === 'ru' ? 'Истекло' : 'Muddati tugagan'}</div>\n        </div>\n        <div className=\"glass-card p-4\">\n          <div className=\"text-2xl font-bold text-purple-600\">{codes.length}</div>\n          <div className=\"text-sm text-gray-500\">{language === 'ru' ? 'Всего' : 'Jami'}</div>\n        </div>\n      </div>\n\n      {/* Filter tabs */}\n      <div className=\"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 md:mx-0 md:px-0\">\n        {[\n          { id: 'all' as const, label: language === 'ru' ? 'Все' : 'Barchasi' },\n          { id: 'active' as const, label: language === 'ru' ? 'Активные' : 'Faol' },\n          { id: 'used' as const, label: language === 'ru' ? 'Использованные' : 'Ishlatilgan' },\n          { id: 'expired' as const, label: language === 'ru' ? 'Истекшие' : 'Muddati tugagan' },\n        ].map((tab) => (\n          <button\n            key={tab.id}\n            onClick={() => setFilter(tab.id)}\n            className={`px-4 py-2 rounded-xl font-medium whitespace-nowrap transition-colors ${\n              filter === tab.id\n                ? 'bg-primary-500 text-gray-900'\n                : 'bg-white/50 text-gray-600 hover:bg-white'\n            }`}\n          >\n            {tab.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Codes list */}\n      {isLoadingGuestCodes ? (\n        <div className=\"glass-card p-8 text-center\">\n          <div className=\"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center animate-pulse\">\n            <QrCode className=\"w-8 h-8 text-gray-400\" />\n          </div>\n          <h3 className=\"font-medium text-gray-500\">\n            {language === 'ru' ? 'Загрузка...' : 'Yuklanmoqda...'}\n          </h3>\n        </div>\n      ) : filteredCodes.length === 0 ? (\n        <div className=\"glass-card p-8 text-center\">\n          <div className=\"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center\">\n            <QrCode className=\"w-8 h-8 text-gray-400\" />\n          </div>\n          <h3 className=\"font-medium text-gray-900 mb-1\">\n            {language === 'ru' ? 'Пропусков нет' : 'Ruxsatnomalar yo\\'q'}\n          </h3>\n          <p className=\"text-sm text-gray-500 mb-4\">\n            {language === 'ru'\n              ? 'Создайте первый пропуск для гостя или курьера'\n              : 'Mehmon yoki kuryer uchun birinchi ruxsatnomani yarating'}\n          </p>\n          <button\n            onClick={() => setShowCreateForm(true)}\n            className=\"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-gray-900 font-medium rounded-xl inline-flex items-center gap-2\"\n          >\n            <Plus className=\"w-5 h-5\" />\n            {language === 'ru' ? 'Создать пропуск' : 'Ruxsatnoma yaratish'}\n          </button>\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {filteredCodes.map((code) => {\n            const visitorLabel = VISITOR_TYPE_LABELS[code.visitorType];\n            const statusLabel = GUEST_ACCESS_STATUS_LABELS[code.status];\n            const isExpired = code.status === 'expired';\n            const isRevoked = code.status === 'revoked';\n            const isUsed = code.status === 'used';\n\n            return (\n              <div\n                key={code.id}\n                className={`glass-card p-4 ${\n                  isExpired || isRevoked ? 'opacity-60' : ''\n                }`}\n              >\n                <div className=\"flex items-start gap-3\">\n                  {/* Icon */}\n                  <button\n                    onClick={() => setSelectedCode(code)}\n                    className={`w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${\n                      code.status === 'active' ? 'bg-green-100 text-green-600' :\n                      isUsed ? 'bg-blue-100 text-blue-600' :\n                      isRevoked ? 'bg-red-100 text-red-600' :\n                      'bg-gray-100 text-gray-600'\n                    }`}\n                  >\n                    <QrCode className=\"w-6 h-6\" />\n                  </button>\n\n                  {/* Info */}\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"text-lg\">{visitorLabel.icon}</span>\n                      <span className=\"font-medium\">\n                        {language === 'ru' ? visitorLabel.label : visitorLabel.labelUz}\n                      </span>\n                      <span className={`px-2 py-0.5 text-xs rounded-full font-medium ${\n                        code.status === 'active' ? 'bg-green-100 text-green-700' :\n                        isUsed ? 'bg-blue-100 text-blue-700' :\n                        isRevoked ? 'bg-red-100 text-red-700' :\n                        'bg-gray-100 text-gray-700'\n                      }`}>\n                        {language === 'ru' ? statusLabel.label : statusLabel.labelUz}\n                      </span>\n                    </div>\n\n                    {code.visitorName && (\n                      <div className=\"text-sm text-gray-600 flex items-center gap-1\">\n                        <User className=\"w-3.5 h-3.5\" />\n                        {code.visitorName}\n                      </div>\n                    )}\n\n                    <div className=\"text-sm text-gray-500 flex items-center gap-1 mt-0.5\">\n                      <Clock className=\"w-3.5 h-3.5\" />\n                      {language === 'ru' ? 'до' : 'gacha'} {new Date(code.validUntil).toLocaleString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n                        day: 'numeric',\n                        month: 'short',\n                        hour: '2-digit',\n                        minute: '2-digit'\n                      })}\n                    </div>\n\n                    {code.accessType !== 'single_use' && !isExpired && !isRevoked && (\n                      <div className=\"text-xs text-gray-400 mt-1\">\n                        {language === 'ru' ? 'Использований' : 'Ishlatilgan'}: {code.currentUses}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Actions */}\n                  <div className=\"flex items-center gap-1\">\n                    {code.status === 'active' && (\n                      <button\n                        onClick={() => setShowRevokeConfirm(code)}\n                        className=\"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\n                        title={language === 'ru' ? 'Отменить' : 'Bekor qilish'}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </button>\n                    )}\n                    <button\n                      onClick={() => setSelectedCode(code)}\n                      className=\"p-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors\"\n                    >\n                      <ChevronRight className=\"w-5 h-5\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Modals */}\n      {showCreateForm && (\n        <CreatePassForm\n          onClose={() => setShowCreateForm(false)}\n          onCreated={handleCreated}\n        />\n      )}\n\n      {selectedCode && (\n        <QRCodeDisplay\n          codeId={selectedCode.id}\n          onClose={() => setSelectedCode(null)}\n        />\n      )}\n\n      {/* Revoke confirmation */}\n      {showRevokeConfirm && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-2xl max-w-sm w-full p-6\">\n            <div className=\"text-center mb-4\">\n              <div className=\"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center\">\n                <AlertTriangle className=\"w-8 h-8 text-red-600\" />\n              </div>\n              <h3 className=\"text-lg font-bold mb-2\">\n                {language === 'ru' ? 'Отменить пропуск?' : 'Ruxsatnomani bekor qilasizmi?'}\n              </h3>\n              <p className=\"text-gray-600 text-sm\">\n                {language === 'ru'\n                  ? 'Пропуск будет деактивирован и не сможет быть использован'\n                  : 'Ruxsatnoma o\\'chiriladi va ishlatib bo\\'lmaydi'}\n              </p>\n            </div>\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setShowRevokeConfirm(null)}\n                className=\"flex-1 py-3 border-2 border-gray-200 rounded-xl font-medium hover:bg-gray-50\"\n              >\n                {language === 'ru' ? 'Нет' : 'Yo\\'q'}\n              </button>\n              <button\n                onClick={handleRevoke}\n                className=\"flex-1 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl font-medium\"\n              >\n                {language === 'ru' ? 'Да, отменить' : 'Ha, bekor qilish'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["QRCodeDisplay","codeId","onClose","language","useLanguageStore","guestAccessCodes","useDataStore","canvasRef","useRef","copied","setCopied","useState","code","c","useEffect","generateQRCodeCanvas","handleCopy","handleDownload","link","createImageWithCaption","qrCanvas","qrSize","combinedCanvas","ctx","padding","textAreaHeight","centerX","y","addressText","validUntil","resolve","handleShare","combinedBlob","file","shareData","err","visitorLabel","VISITOR_TYPE_LABELS","accessLabel","ACCESS_TYPE_LABELS","statusLabel","GUEST_ACCESS_STATUS_LABELS","jsxs","jsx","X","Share2","Download","Copy","CreatePassForm","onCreated","user","useAuthStore","createGuestAccessCode","step","setStep","visitorType","setVisitorType","accessType","setAccessType","visitorName","setVisitorName","visitorPhone","setVisitorPhone","visitorVehiclePlate","setVisitorVehiclePlate","customDate","setCustomDate","notes","setNotes","visitorTypes","Package","Users","Car","User","accessTypes","isCreating","setIsCreating","handleCreate","ArrowLeft","s","type","icon","label","Clock","Calendar","ChevronRight","e","Fragment","ResidentGuestAccessPage","fetchGuestCodes","revokeGuestAccessCode","isLoadingGuestCodes","showCreateForm","setShowCreateForm","selectedCode","setSelectedCode","filter","setFilter","showRevokeConfirm","setShowRevokeConfirm","allCodes","now","codes","filteredCodes","activeCodes","handleCreated","handleRevoke","Plus","tab","QrCode","isExpired","isRevoked","isUsed","Trash2","AlertTriangle"],"mappings":"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"}
import{r as l,j as e,at as B,Y as g,y as E,x as j,al as $,l as P,U as I,z as T,E as K,b8 as O}from"./react-vendor-1768595896775-BqYfO4Ra.js";import{b as J}from"./index-1768595896775-BdNu4r8w.js";import"./vendor-1768595896775-BDsimyYc.js";import"./qr-scanner-1768595896775-cr32YHjo.js";import"./zustand-1768595896775-wNUYBKDB.js";function M(){const{token:x}=J(),[c,f]=l.useState(""),[b,N]=l.useState(!1),[t,m]=l.useState(null),[r,o]=l.useState(null),[v,d]=l.useState(""),[i,y]=l.useState(""),[w,S]=l.useState(!1),[a,h]=l.useState(null),[C,H]=l.useState([]),[R,_]=l.useState(!1),[U,k]=l.useState(!1),u="",L=async()=>{if(!(!c.trim()||c.length<6)){N(!0),m(null),o(null),d(""),h(null);try{const s=await fetch(`${u}/api/coupons/check/${c.trim().toUpperCase()}`,{headers:{Authorization:`Bearer ${x}`}}),n=await s.json();s.ok?(m(n.coupon),o(n.valid),d(n.reason||"")):(o(!1),d(n.error||"Купон не найден"))}catch{o(!1),d("Ошибка проверки купона")}finally{N(!1)}}},z=async()=>{if(!t||!r)return;const s=parseFloat(i);if(isNaN(s)||s<=0){alert("Введите корректную сумму");return}S(!0);try{const n=await fetch(`${u}/api/coupons/activate/${t.code}`,{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify({amount:s})}),p=await n.json();n.ok?(h({discount_amount:p.discount_amount,final_amount:p.final_amount}),o(!1),d("Купон успешно активирован!")):alert(p.error||"Ошибка активации")}catch{alert("Ошибка активации купона")}finally{S(!1)}},D=async()=>{k(!0);try{const s=await fetch(`${u}/api/coupons/history`,{headers:{Authorization:`Bearer ${x}`}});if(s.ok){const n=await s.json();H(n.activations||[])}}catch{}finally{k(!1)}},A=()=>{f(""),m(null),o(null),d(""),y(""),h(null)},F=s=>{s.key==="Enter"&&L()};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Проверка купонов"}),e.jsx("p",{className:"text-gray-500",children:"Введите код для проверки и активации"})]}),e.jsxs("button",{onClick:()=>{_(!0),D()},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[e.jsx(B,{className:"w-5 h-5"}),"История"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border p-6 mb-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx("input",{type:"text",value:c,onChange:s=>f(s.target.value.toUpperCase()),onKeyPress:F,placeholder:"Введите код купона (6 символов)",maxLength:6,className:"w-full px-4 py-4 text-2xl font-mono tracking-widest text-center border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 uppercase",autoFocus:!0})}),e.jsx("button",{onClick:L,disabled:b||c.length<6,className:"px-6 py-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:b?e.jsx(g,{className:"w-6 h-6 animate-spin"}):e.jsx(E,{className:"w-6 h-6"})})]}),c&&e.jsx("button",{onClick:A,className:"mt-3 text-sm text-gray-500 hover:text-gray-700",children:"Очистить"})]}),(t||r===!1)&&e.jsxs("div",{className:`bg-white rounded-2xl shadow-lg border overflow-hidden ${a?"border-green-300":r?"border-green-200":"border-red-200"}`,children:[e.jsx("div",{className:`p-4 ${a?"bg-green-500":r?"bg-green-100":"bg-red-100"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[a?e.jsx(j,{className:"w-8 h-8 text-white"}):r?e.jsx(j,{className:"w-8 h-8 text-green-600"}):e.jsx($,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:`font-bold text-lg ${a?"text-white":r?"text-green-800":"text-red-800"}`,children:a?"Купон активирован!":r?"Купон действителен":"Купон недействителен"}),v&&e.jsx("div",{className:`text-sm ${a?"text-green-100":r?"text-green-600":"text-red-600"}`,children:v})]})]})}),t&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsx("code",{className:"text-3xl font-mono font-bold tracking-widest text-gray-900",children:t.code})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"px-6 py-3 bg-purple-100 rounded-xl",children:e.jsxs("span",{className:"text-3xl font-bold text-purple-700",children:["-",t.discount_percent,"%"]})})}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-2",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.ad_title}),t.ad_description&&e.jsx("div",{className:"text-sm text-gray-500",children:t.ad_description}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:t.ad_phone})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-blue-700"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.user_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.user_phone})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),"Выдан: ",new Date(t.issued_at).toLocaleDateString("ru-RU")]}),t.expires_at&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),"Истекает: ",new Date(t.expires_at).toLocaleDateString("ru-RU")]})]}),r&&!a&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Сумма покупки (сум)"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"number",value:i,onChange:s=>y(s.target.value),placeholder:"0",className:"w-full pl-10 pr-4 py-3 border rounded-xl text-lg",min:"0"})]}),e.jsxs("button",{onClick:z,disabled:w||!i,className:"px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[w?e.jsx(g,{className:"w-5 h-5 animate-spin"}):e.jsx(j,{className:"w-5 h-5"}),"Активировать"]})]}),i&&parseFloat(i)>0&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Сумма покупки:"}),e.jsxs("span",{children:[parseFloat(i).toLocaleString()," сум"]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{children:["Скидка ",t.discount_percent,"%:"]}),e.jsxs("span",{children:["-",(parseFloat(i)*t.discount_percent/100).toLocaleString()," сум"]})]}),e.jsxs("div",{className:"flex justify-between font-bold mt-1 pt-1 border-t border-green-200",children:[e.jsx("span",{children:"К оплате:"}),e.jsxs("span",{children:[(parseFloat(i)*(1-t.discount_percent/100)).toLocaleString()," сум"]})]})]})]}),a&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-xl space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Сумма покупки:"}),e.jsxs("span",{className:"font-medium",children:[(a.final_amount+a.discount_amount).toLocaleString()," сум"]})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Скидка:"}),e.jsxs("span",{className:"font-medium",children:["-",a.discount_amount.toLocaleString()," сум"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-green-200",children:[e.jsx("span",{children:"К оплате:"}),e.jsxs("span",{className:"text-green-700",children:[a.final_amount.toLocaleString()," сум"]})]})]}),e.jsx("button",{onClick:A,className:"w-full mt-4 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:"Проверить другой купон"})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"История активаций"}),e.jsx("button",{onClick:()=>_(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:U?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(g,{className:"w-6 h-6 animate-spin text-blue-600"})}):C.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"История пуста"}):e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"px-2 py-1 bg-white border rounded font-mono text-sm",children:s.code}),e.jsx("span",{className:"text-sm text-gray-500",children:s.ad_title})]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:s.user_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-green-600 font-medium",children:["-",s.discount_amount?.toLocaleString()," сум"]}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(s.activated_at).toLocaleString("ru-RU")})]})]})},s.id))})})]})})]})}export{M as CouponCheckerDashboard};
//# sourceMappingURL=CouponCheckerDashboard-1768595896775-CCXeofz6.js.map

{"version":3,"file":"ResidentAnnouncementsPage-1768381324153-2Zg6SbJ5.js","sources":["../../src/pages/ResidentAnnouncementsPage.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { Megaphone, AlertTriangle, AlertCircle, Info, ChevronRight, Check } from 'lucide-react';\nimport { useAuthStore } from '../stores/authStore';\nimport { useDataStore } from '../stores/dataStore';\nimport { useLanguageStore } from '../stores/languageStore';\nimport type { Announcement, AnnouncementPriority } from '../types';\n\nexport function ResidentAnnouncementsPage() {\n  const { user } = useAuthStore();\n  const { getAnnouncementsForResidents, markAnnouncementAsViewed, fetchAnnouncements } = useDataStore();\n  const { language } = useLanguageStore();\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [filter, setFilter] = useState<'all' | 'unread'>('all');\n\n  // Fetch announcements on component mount\n  useEffect(() => {\n    fetchAnnouncements();\n  }, [fetchAnnouncements]);\n\n  // Get user's targeting info\n  const userLogin = user?.login || '';\n  const userBuilding = user?.buildingId || '';\n  const userEntrance = user?.entrance || '';\n  const userFloor = user?.floor || '';\n  const userBranch = user?.branch || '';\n\n  const announcements = getAnnouncementsForResidents(userLogin, userBuilding, userEntrance, userFloor, userBranch);\n\n  const filteredAnnouncements = filter === 'unread'\n    ? announcements.filter(a => !a.viewedBy.includes(user?.id || ''))\n    : announcements;\n\n  const unreadCount = announcements.filter(a => !a.viewedBy.includes(user?.id || '')).length;\n\n  const handleExpand = (announcement: Announcement) => {\n    if (expandedId === announcement.id) {\n      setExpandedId(null);\n    } else {\n      setExpandedId(announcement.id);\n      // Mark as viewed when expanded\n      if (user?.id && !announcement.viewedBy.includes(user.id)) {\n        markAnnouncementAsViewed(announcement.id, user.id);\n      }\n    }\n  };\n\n  const getPriorityStyles = (priority: AnnouncementPriority) => {\n    switch (priority) {\n      case 'urgent':\n        return {\n          bg: 'bg-red-50 border-red-200',\n          badge: 'bg-red-100 text-red-700',\n          icon: <AlertTriangle className=\"w-5 h-5 text-red-500\" />,\n          label: language === 'ru' ? 'Срочно' : 'Shoshilinch'\n        };\n      case 'important':\n        return {\n          bg: 'bg-amber-50 border-amber-200',\n          badge: 'bg-amber-100 text-amber-700',\n          icon: <AlertCircle className=\"w-5 h-5 text-amber-500\" />,\n          label: language === 'ru' ? 'Важно' : 'Muhim'\n        };\n      default:\n        return {\n          bg: 'bg-blue-50 border-blue-200',\n          badge: 'bg-blue-100 text-blue-700',\n          icon: <Info className=\"w-5 h-5 text-blue-500\" />,\n          label: language === 'ru' ? 'Информация' : 'Ma\\'lumot'\n        };\n    }\n  };\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(language === 'ru' ? 'ru-RU' : 'uz-UZ', {\n      day: '2-digit',\n      month: 'long',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  return (\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-xl md:text-2xl font-bold flex items-center gap-3\">\n          <Megaphone className=\"w-7 h-7 text-primary-500\" />\n          {language === 'ru' ? 'Объявления' : 'E\\'lonlar'}\n        </h1>\n\n        {unreadCount > 0 && (\n          <span className=\"px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-sm font-medium\">\n            {unreadCount} {language === 'ru' ? 'новых' : 'yangi'}\n          </span>\n        )}\n      </div>\n\n      {/* Filter */}\n      <div className=\"flex gap-2\">\n        <button\n          onClick={() => setFilter('all')}\n          className={`px-4 py-2 rounded-xl font-medium text-sm transition-colors ${\n            filter === 'all'\n              ? 'bg-primary-500 text-gray-900'\n              : 'bg-white/60 text-gray-600 hover:bg-white/80'\n          }`}\n        >\n          {language === 'ru' ? 'Все' : 'Hammasi'} ({announcements.length})\n        </button>\n        <button\n          onClick={() => setFilter('unread')}\n          className={`px-4 py-2 rounded-xl font-medium text-sm transition-colors ${\n            filter === 'unread'\n              ? 'bg-primary-500 text-gray-900'\n              : 'bg-white/60 text-gray-600 hover:bg-white/80'\n          }`}\n        >\n          {language === 'ru' ? 'Непрочитанные' : 'O\\'qilmagan'} ({unreadCount})\n        </button>\n      </div>\n\n      {/* Announcements List */}\n      {filteredAnnouncements.length === 0 ? (\n        <div className=\"glass-card p-8 text-center\">\n          <Megaphone className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n          <p className=\"text-gray-500\">\n            {filter === 'unread'\n              ? (language === 'ru' ? 'Нет новых объявлений' : 'Yangi e\\'lonlar yo\\'q')\n              : (language === 'ru' ? 'Объявлений пока нет' : 'E\\'lonlar yo\\'q')}\n          </p>\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {filteredAnnouncements.map((announcement) => {\n            const isUnread = !announcement.viewedBy.includes(user?.id || '');\n            const isExpanded = expandedId === announcement.id;\n            const styles = getPriorityStyles(announcement.priority);\n\n            return (\n              <div\n                key={announcement.id}\n                className={`glass-card p-4 border-2 cursor-pointer transition-all ${styles.bg} ${\n                  isUnread ? 'ring-2 ring-yellow-400 ring-offset-2' : ''\n                }`}\n                onClick={() => handleExpand(announcement)}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"flex-shrink-0 mt-0.5\">\n                    {styles.icon}\n                  </div>\n\n                  <div className=\"flex-1 min-w-0\">\n                    {/* Header */}\n                    <div className=\"flex items-center gap-2 flex-wrap mb-2\">\n                      {isUnread && (\n                        <span className=\"px-2 py-0.5 rounded-full bg-yellow-400 text-yellow-900 text-xs font-medium\">\n                          {language === 'ru' ? 'Новое' : 'Yangi'}\n                        </span>\n                      )}\n                      <span className={`px-2 py-0.5 rounded-lg text-xs font-medium ${styles.badge}`}>\n                        {styles.label}\n                      </span>\n                    </div>\n\n                    {/* Title */}\n                    <h3 className=\"font-semibold text-base text-gray-900 mb-1\">\n                      {announcement.title}\n                    </h3>\n\n                    {/* Content */}\n                    <p className={`text-gray-600 text-sm ${isExpanded ? '' : 'line-clamp-2'}`}>\n                      {announcement.content}\n                    </p>\n\n                    {/* Meta */}\n                    <div className=\"flex items-center gap-3 mt-3 text-xs text-gray-500\">\n                      <span>{formatDate(announcement.createdAt)}</span>\n                      <span>{announcement.authorName}</span>\n                      {!isUnread && (\n                        <span className=\"flex items-center gap-1 text-green-600\">\n                          <Check className=\"w-3 h-3\" />\n                          {language === 'ru' ? 'Прочитано' : 'O\\'qilgan'}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n\n                  <ChevronRight className={`w-5 h-5 text-gray-400 flex-shrink-0 transition-transform ${\n                    isExpanded ? 'rotate-90' : ''\n                  }`} />\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["ResidentAnnouncementsPage","user","useAuthStore","getAnnouncementsForResidents","markAnnouncementAsViewed","fetchAnnouncements","useDataStore","language","useLanguageStore","expandedId","setExpandedId","useState","filter","setFilter","useEffect","userLogin","userBuilding","userEntrance","userFloor","userBranch","announcements","filteredAnnouncements","a","unreadCount","handleExpand","announcement","getPriorityStyles","priority","jsx","AlertTriangle","AlertCircle","Info","formatDate","dateStr","jsxs","Megaphone","isUnread","isExpanded","styles","Check","ChevronRight"],"mappings":"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"}
import{h as ys,b as vs,e as Oe,x as te,_ as ws,y as Ve}from"./index-1768381324153-B4P3M79T.js";import{r,j as e,Y as V,aB as Cs,A as y,B as qe,h as Ne,aA as be,H as q,a9 as ye,aG as Ge,ac as He,aJ as ve,x as Je,X as ae,aI as ks,J as Ke,a0 as Ss,K as we,ad as Qe,_ as As,$ as Rs,aZ as Es,a_ as _s,l as Fs,a8 as G,y as $s,a5 as Ps}from"./react-vendor-1768381324153-Du7V7gfh.js";import"./zustand-1768381324153-wNUYBKDB.js";import"./vendor-1768381324153-D5z5YOOo.js";import"./qr-scanner-1768381324153-cr32YHjo.js";function zs(){const{buildings:le,fetchBuildings:Ce}=ys(),{addMockUser:Ze,additionalUsers:ke,removeUser:Se,updateUserPassword:We,getUserPassword:Ye}=vs(),[C,j]=r.useState("branches"),[f,H]=r.useState(null),[l,P]=r.useState(null),[J,K]=r.useState(null),[Ae,es]=r.useState([]),[Re,ne]=r.useState([]),[ss,Ee]=r.useState(!1),[ts,_e]=r.useState(!1),[Q,re]=r.useState([]),[as,Fe]=r.useState(!1),[ls,B]=r.useState(!1),[ns,L]=r.useState(!1),[ie,I]=r.useState(""),[k,M]=r.useState([]),[$e,S]=r.useState(""),[Pe,Be]=r.useState([]),[m,U]=r.useState(null),[ce,D]=r.useState(!1),[A,z]=r.useState(""),[de,Z]=r.useState(!1),[oe,me]=r.useState(null),[rs,xe]=r.useState(!1),[p,W]=r.useState(!1),[T,Y]=r.useState(!1),[ee,h]=r.useState(""),Le=r.useRef(null),R="kamizo";r.useEffect(()=>{is()},[]),r.useEffect(()=>{f&&Ce()},[f,Ce]),r.useEffect(()=>{l&&(cs(l.id),E(l.id))},[l]);const is=async()=>{Ee(!0);try{const s=await Oe("/api/branches");es(s.branches||[])}catch{}finally{Ee(!1)}},cs=async s=>{_e(!0);try{const t=await Oe(`/api/buildings/${s}/entrances`);ne(t.entrances||[])}catch{ne([])}finally{_e(!1)}},E=async s=>{Fe(!0);try{const t=await te.getAll({role:"resident",building_id:s,limit:5e3});re(t.users||[])}catch{re([])}finally{Fe(!1)}},Ie=f?le.filter(s=>s.branchCode===f.code):le,ds=s=>{H(s),j("buildings"),I("")},os=s=>{P(s),j("entrances"),I("")},ms=s=>{K(s),j("residents"),I("")},X=()=>{C==="residents"?(K(null),j("entrances")):C==="entrances"?(P(null),ne([]),re([]),j("buildings")):C==="buildings"&&(H(null),j("branches")),I("")},Me=s=>{if(!s)return"";const t="(\\d+(?:[/\\-]\\d+)?[А-Яа-яA-Za-z]?)",a=s.match(new RegExp(t+"-уй|уй\\s*"+t,"i"));if(a)return(a[1]||a[2]).toUpperCase().replace(/Б/gi,"B").replace(/А/gi,"A");const i=s.match(new RegExp("(?:дом|д\\.?)\\s*"+t,"i"));return i?i[1].toUpperCase().replace(/Б/gi,"B").replace(/А/gi,"A"):""},Ue=(s,t,a)=>{if(!s?.branchCode)return R;const i=s.branchCode.toUpperCase();let n=a?Me(a):"";return!n&&s?.buildingNumber&&(n=s.buildingNumber.toUpperCase()),n?`${i}/${n}/${t||"0"}`:R},he=s=>{if(s.password)return s.password;const t=Ye(s.login);if(t)return t;const a=le.find(o=>o.id===s.buildingId)||l,i=s.address?ge(s.address):"",n=s.apartment||i||"0",d=s.address?Me(s.address):"";if(a?.branchCode){const o=d||a?.buildingNumber?.toUpperCase()||"";if(o)return`${a.branchCode.toUpperCase()}/${o}/${n}`}if(s.branch&&(d||s.building)){const o=d||s.building?.toUpperCase()||"";return`${s.branch.toUpperCase()}/${o}/${n}`}return R},xs=Object.entries(ke).filter(([s,t])=>t.user.role==="resident").map(([s,t])=>({...t.user,login:s,password:t.password})),ue=Q.length>0?Q.map(s=>({id:s.id,login:s.login,name:s.name,phone:s.phone,address:s.address,apartment:s.apartment,buildingId:s.building_id,entrance:s.entrance,floor:s.floor,createdAt:s.created_at})):xs,N=(J?ue.filter(s=>s.buildingId===l?.id&&s.entrance===String(J.number)):ue.filter(s=>s.buildingId===l?.id)).filter(s=>{if(!ie)return!0;const t=ie.toLowerCase();return s.name.toLowerCase().includes(t)||s.login.toLowerCase().includes(t)||s.address?.toLowerCase().includes(t)||s.apartment?.toLowerCase().includes(t)||s.phone?.toLowerCase().includes(t)}),ge=s=>{const t=s.match(/(\d+)-хонадон|хонадон\s*(\d+)/i);if(t)return t[1]||t[2];const a=s.match(/(?:кв\.?|kv\.?|квартира|apt\.?)\s*(\d+)/i);if(a)return a[1];const i=s.match(/,\s*(\d+)\s*$/);return i?i[1]:""},hs=s=>{const t=parseInt(s);if(isNaN(t)||t<=0)return{entrance:"",floor:""};const a=4,n=a*9,d=Math.ceil(t/n),o=(t-1)%n,v=Math.floor(o/a)+1;return{entrance:String(d),floor:String(v)}},us=s=>/(?:неж\.?|нежилое)/i.test(s),gs=r.useCallback(async s=>{const t=s.target.files?.[0];if(t){S("");try{const a=await ws(()=>import("./xlsx-1768381324153-Ca2gZxVo.js"),[]),i=await t.arrayBuffer(),n=a.read(i,{type:"array"}),d=n.SheetNames[0],o=n.Sheets[d],v=a.utils.sheet_to_json(o,{header:1});if(v.length<2){S("Файл пустой или имеет неверный формат");return}const _=js(v);if(_.length===0){S("Не удалось найти данные. Проверьте формат файла.");return}M(_)}catch{S("Ошибка при чтении файла")}s.target&&(s.target.value="")}},[]),js=s=>{if(s.length<1)return[];let t=-1,a=-1,i=-1,n=-1,d=-1;const o=(u,x)=>{if(!u)return-1;for(const w of x){const g=u.findIndex(F=>String(F||"").toLowerCase().trim().includes(w));if(g!==-1)return g}return-1};for(let u=0;u<Math.min(10,s.length);u++){const x=s[u];if(!x)continue;const w=o(x,["л/с","лицевой","л.с","лс"]),g=o(x,["фио","абонент"]),F=o(x,["адрес"]),se=o(x,["площадь","кв.м","кв м","s кв","sкв","общая площадь"]);if([w,g,F].filter(pe=>pe>=0).length>=2){t=u,a=w,i=g,n=F,d=se;break}}const v=t>=0?t+1:0,_=a>=0?a:0,je=i>=0?i:1,fe=n>=0?n:2,Te=[];for(let u=v;u<s.length;u++){const x=s[u];if(!x||x.every($=>!$))continue;let w=String(x[_]||"").trim();w=w.replace(/\s+/g,"");const g=String(x[je]||"").trim(),F=String(x[fe]||"").trim();let se;if(d>=0&&x[d]){const $=x[d];let pe=String($).replace(",",".").replace(/[^\d.]/g,""),b=parseFloat(pe);if(!isNaN(b)&&b>0){const Xe=String($).includes(".")||String($).includes(",");!Xe&&b>1e3&&(b=b/100),b>500&&!Xe&&(b=b/10),se=Math.round(b*100)/100}}g&&(g.toLowerCase().includes("фио")||g.toLowerCase().includes("абонент")||Te.push({personalAccount:w,fullName:g,address:F||l?.address||"",totalArea:se}))}return Te},fs=async()=>{const s=[];let t=0;if(k.forEach((a,i)=>{if(!a.fullName)return;if(us(a.address)){t++;return}const n=a.personalAccount?a.personalAccount.trim().replace(/\s+/g,""):`${Date.now()}_${i}`;if(ke[n])return;const d=ge(a.address),{entrance:o,floor:v}=hs(d),_=l?.id||"",je=a.address||l?.address||"",fe=Ue(l,d,je);s.push({login:n,password:fe,name:a.fullName,role:"resident",phone:"",address:a.address||l?.address||"",apartment:d,building_id:_,entrance:o,floor:v,total_area:a.totalArea||null})}),s.length===0){const a=t>0?`Нет новых пользователей для создания. Пропущено ${t} нежилых помещений.`:"Нет новых пользователей для создания";S(a);return}Y(!0),h(`Создание ${s.length} аккаунтов...`);try{const a=await Ve.registerBulk(s),i=a.created?.length||0,n=a.updated?.length||0;if(i>0||n>0){const d=[...a.created||[],...a.updated||[]];Be(d.map(o=>({login:o.login,name:o.name})))}M([]),B(!1),h(`Готово! Создано: ${i}, Обновлено: ${n}`),l&&await E(l.id),setTimeout(()=>h(""),3e3)}catch(a){S(a.message||"Ошибка при массовой регистрации"),h("")}finally{Y(!1)}},[c,O]=r.useState({fullName:"",phone:"",address:"",personalAccount:""}),ps=async()=>{if(!c.fullName)return;const s=c.personalAccount?c.personalAccount.trim():`${Date.now()}`,t=ge(c.address),a=l?.id||"",i=c.address||l?.address||"",n=Ue(l,t,i);Y(!0),h("Создание аккаунта...");try{await Ve.register({login:s,password:n,name:c.fullName,role:"resident",phone:c.phone,address:c.address||l?.address||"",apartment:t,building_id:a,entrance:"",floor:"",branch:l?.branchCode,building:l?.buildingNumber}),Ze(s,n,{id:`res_${Date.now()}`,phone:c.phone,name:c.fullName,login:s,role:"resident",address:c.address||l?.address||"",apartment:t,buildingId:a,branch:l?.branchCode,building:l?.buildingNumber}),U({login:s,name:c.fullName,address:c.address||l?.address||"",apartment:t,phone:c.phone}),Z(!0),O({fullName:"",phone:"",address:"",personalAccount:""}),L(!1),l&&await E(l.id),h("Аккаунт создан!"),setTimeout(()=>h(""),2e3)}catch(d){alert("Ошибка создания: "+(d.message||"Неизвестная ошибка")),h("")}finally{Y(!1)}},Ns=async s=>{W(!0);try{const t=Q.find(a=>a.login===s);t?.id&&await te.delete(t.id),Se(s),l&&await E(l.id)}catch(t){alert("Ошибка при удалении: "+t.message)}finally{W(!1),me(null),U(null)}},bs=async()=>{W(!0),h(`Удаление ${N.length} жителей...`);let s=0;const t=N.length;try{for(let a=0;a<N.length;a++){const i=N[a];h(`Удаление ${a+1}/${t}: ${i.name.split(" ")[0]}...`);try{let n=i.id;n||(n=Q.find(o=>o.login===i.login)?.id),n&&(await te.delete(n),s++),Se(i.login)}catch{}}h(`Удалено ${s} жителей`),l&&await E(l.id),setTimeout(()=>h(""),3e3)}finally{W(!1),xe(!1)}},De=s=>{navigator.clipboard.writeText(s)},ze=()=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx($s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Поиск по имени, телефону, квартире...",value:ie,onChange:s=>I(s.target.value),className:"input-field pl-10"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Найдено: ",e.jsx("strong",{children:N.length})," жителей"]}),N.length>0&&e.jsxs("button",{onClick:()=>xe(!0),className:"btn-secondary flex items-center gap-2 text-red-600 border-red-200 hover:bg-red-50 text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),"Удалить всех"]})]}),as?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin"}),e.jsx("p",{className:"text-gray-500",children:"Загрузка жителей..."})]}):N.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600",children:"Жители не найдены"}),e.jsx("p",{className:"text-gray-400 mt-1 mb-4",children:"Загрузите Excel файл с данными жителей"}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsxs("button",{onClick:()=>l&&E(l.id),className:"btn-secondary inline-flex items-center gap-2",children:[e.jsx(Ps,{className:"w-4 h-4"}),"Обновить"]}),e.jsxs("button",{onClick:()=>B(!0),className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Загрузить Excel"]})]})]}):N.map(s=>e.jsx("div",{className:"glass-card p-4 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>{U(s),D(!1),z(""),Z(!1)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center text-lg font-medium text-white shadow-sm",children:s.name.split(" ").map(t=>t[0]).join("").slice(0,2)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2 text-sm mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-mono text-xs",children:[e.jsx(we,{className:"w-3 h-3"}),s.login]}),s.apartment&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(q,{className:"w-3.5 h-3.5"}),"кв. ",s.apartment]})]}),s.address&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mt-1 truncate",children:[e.jsx(ye,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address})]})]})]}),e.jsx(y,{className:"w-5 h-5 text-gray-400"})]})},s.login))]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Жители"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Управление аккаунтами жителей"})]})}),C==="branches"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Выберите филиал"}),ss?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin"}),e.jsx("p",{className:"text-gray-500",children:"Загрузка филиалов..."})]}):Ae.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(Cs,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600",children:"Филиалы не найдены"}),e.jsx("p",{className:"text-gray-400 mt-1",children:'Добавьте филиалы в разделе "Дома/Объекты"'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Ae.map(s=>e.jsxs("button",{onClick:()=>ds(s),className:"glass-card p-5 text-left hover:shadow-lg transition-shadow group",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:s.code})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Филиал ",s.code]})]})]}),e.jsx(y,{className:"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[s.buildings_count," домов"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[s.residents_count," жителей"]})]})]})]},s.id))})]}),C==="buildings"&&f&&e.jsxs("div",{children:[e.jsx("div",{className:"glass-card p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:X,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:f.code})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:f.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Выберите дом"})]})]})}),Ie.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600",children:"Дома не найдены"}),e.jsx("p",{className:"text-gray-400 mt-1",children:'Добавьте дома в этот филиал в разделе "Дома/Объекты"'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Ie.map(s=>e.jsxs("button",{onClick:()=>os(s),className:"glass-card p-5 text-left hover:shadow-lg transition-shadow group",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-xl flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["Дом ",s.buildingNumber||s.name]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(ye,{className:"w-3 h-3"}),s.address]})]})]}),e.jsx(y,{className:"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[s.totalApartments," кв."]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[s.entrances," подъездов"]})]})]})]},s.id))})]}),C==="entrances"&&l&&e.jsxs("div",{children:[e.jsx("div",{className:"glass-card p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:X,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("button",{onClick:()=>{j("branches"),H(null),P(null)},className:"text-gray-500 hover:text-primary-600",children:"Филиалы"}),e.jsx(y,{className:"w-4 h-4 text-gray-300"}),e.jsx("button",{onClick:X,className:"text-gray-500 hover:text-primary-600",children:f?.name}),e.jsx(y,{className:"w-4 h-4 text-gray-300"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Дом ",l.buildingNumber||l.name]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>L(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Добавить"})]}),e.jsxs("button",{onClick:()=>B(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Excel"})]})]})]})}),ts?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin"}),e.jsx("p",{className:"text-gray-500",children:"Загрузка подъездов..."})]}):Re.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Re.map(s=>{const t=ue.filter(a=>a.buildingId===l.id&&a.entrance===String(s.number));return e.jsxs("button",{onClick:()=>ms(s),className:"glass-card p-5 text-left hover:shadow-lg transition-shadow group",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-400 to-teal-500 rounded-xl flex items-center justify-center",children:e.jsx(Ge,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["Подъезд ",s.number]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.floors_from&&s.floors_to&&e.jsxs("span",{children:["Этажи ",s.floors_from,"-",s.floors_to]})})]})]}),e.jsx(y,{className:"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-sm",children:[s.apartments_from&&s.apartments_to&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:["кв. ",s.apartments_from,"-",s.apartments_to]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[t.length," жителей"]})]})]})]},s.id)})}):ze()]}),C==="residents"&&J&&l&&e.jsxs("div",{children:[e.jsx("div",{className:"glass-card p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:X,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm flex-wrap",children:[e.jsx("button",{onClick:()=>{j("branches"),H(null),P(null),K(null)},className:"text-gray-500 hover:text-primary-600",children:"Филиалы"}),e.jsx(y,{className:"w-4 h-4 text-gray-300"}),e.jsx("button",{onClick:()=>{j("buildings"),P(null),K(null)},className:"text-gray-500 hover:text-primary-600",children:f?.name}),e.jsx(y,{className:"w-4 h-4 text-gray-300"}),e.jsxs("button",{onClick:X,className:"text-gray-500 hover:text-primary-600",children:["Дом ",l.buildingNumber||l.name]}),e.jsx(y,{className:"w-4 h-4 text-gray-300"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Подъезд ",J.number]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>L(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Добавить"})]}),e.jsxs("button",{onClick:()=>B(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Excel"})]})]})]})}),ze()]}),(T||p||ee)&&e.jsx("div",{className:"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 z-50 glass-card p-4 max-w-sm shadow-xl animate-fade-in",children:e.jsxs("div",{className:"flex items-center gap-3",children:[(T||p)&&e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(V,{className:"w-5 h-5 text-primary-600 animate-spin"})}),!T&&!p&&ee&&e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Je,{className:"w-5 h-5 text-green-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-gray-900",children:ee})})]})}),Pe.length>0&&!ee&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 glass-card p-4 max-w-sm shadow-xl animate-fade-in",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Je,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-semibold text-green-800",children:["Обработано ",Pe.length," аккаунтов"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l?.branchCode&&l?.buildingNumber?e.jsxs(e.Fragment,{children:["Формат пароля: ",e.jsxs("code",{className:"bg-gray-100 px-1 rounded",children:[l.branchCode,"/",l.buildingNumber,"/[кв]"]})]}):e.jsxs(e.Fragment,{children:["Пароль по умолчанию: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:R})]})}),e.jsx("button",{onClick:()=>Be([]),className:"text-sm text-primary-600 hover:text-primary-700 mt-2",children:"Понятно"})]})]})}),ls&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Загрузка данных жителей"}),e.jsx("button",{onClick:()=>{B(!1),M([]),S("")},className:"p-2 hover:bg-white/30 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5"})})]}),k.length===0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-primary-400 transition-colors cursor-pointer",onClick:()=>Le.current?.click(),children:[e.jsx(ks,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Загрузите XLS/XLSX файл"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Файл должен содержать столбцы: ",e.jsx("strong",{children:"Л/С"}),", ",e.jsx("strong",{children:"ФИО абонента"}),", ",e.jsx("strong",{children:"Адрес"}),", ",e.jsx("strong",{children:"Площадь (кв.м)"})]}),e.jsx("button",{className:"btn-primary",children:"Выбрать файл"})]}),e.jsx("input",{ref:Le,type:"file",accept:".csv,.xlsx,.xls",onChange:gs,className:"hidden"}),$e&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 text-red-700 rounded-lg flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 flex-shrink-0"}),$e]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Пример формата файла:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Л/С"}),e.jsx("th",{className:"text-left p-2",children:"ФИО абонента"}),e.jsx("th",{className:"text-left p-2",children:"Адрес"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:"12345678"}),e.jsx("td",{className:"p-2",children:"Иванов Иван Иванович"}),e.jsx("td",{className:"p-2",children:"ул. Мустакиллик, 15, кв. 42"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:"12345679"}),e.jsx("td",{className:"p-2",children:"Петрова Анна Сергеевна"}),e.jsx("td",{className:"p-2",children:"ул. Мустакиллик, 15, кв. 18"})]})]})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold",children:["Найдено записей: ",k.length]}),e.jsx("button",{onClick:()=>M([]),className:"text-sm text-gray-500 hover:text-gray-700",children:"Загрузить другой файл"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-xl",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Л/С"}),e.jsx("th",{className:"text-left p-3",children:"ФИО абонента"}),e.jsx("th",{className:"text-left p-3",children:"Адрес"}),e.jsx("th",{className:"text-left p-3",children:"Площадь, м²"})]})}),e.jsxs("tbody",{children:[k.slice(0,20).map((s,t)=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"p-3",children:s.personalAccount}),e.jsx("td",{className:"p-3",children:s.fullName}),e.jsx("td",{className:"p-3",children:s.address}),e.jsx("td",{className:"p-3",children:s.totalArea?`${s.totalArea} м²`:"—"})]},t)),k.length>20&&e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"p-3 text-center text-gray-500",children:["и еще ",k.length-20," записей..."]})})]})]})})]}),e.jsx("div",{className:"p-3 bg-blue-50 text-blue-700 rounded-xl mb-4 text-sm",children:l?.branchCode&&l?.buildingNumber?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Формат пароля:"})," ",l.branchCode,"/",l.buildingNumber,"/[номер квартиры]",e.jsx("br",{}),e.jsxs("span",{className:"text-blue-600",children:["Например: ",l.branchCode,"/",l.buildingNumber,"/23 для квартиры 23"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Пароль по умолчанию:"})," ",R,e.jsx("br",{}),e.jsx("span",{className:"text-blue-600",children:"Жители смогут изменить пароль в личном кабинете"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>M([]),className:"btn-secondary flex-1",children:"Отмена"}),e.jsx("button",{onClick:fs,disabled:T,className:"btn-primary flex-1 flex items-center justify-center gap-2 disabled:opacity-50",children:T?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 animate-spin"}),"Создание..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ss,{className:"w-4 h-4"}),"Создать ",k.length," аккаунтов"]})})]})]})]})}),ns&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Добавить жителя"}),e.jsx("button",{onClick:()=>L(!1),className:"p-2 hover:bg-white/30 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Л/С (Лицевой счет)"}),e.jsx("input",{type:"text",value:c.personalAccount,onChange:s=>O({...c,personalAccount:s.target.value}),className:"input-field",placeholder:"12345678"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ФИО абонента *"}),e.jsx("input",{type:"text",value:c.fullName,onChange:s=>O({...c,fullName:s.target.value}),className:"input-field",placeholder:"Иванов Иван Иванович"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Адрес"}),e.jsx("input",{type:"text",value:c.address,onChange:s=>O({...c,address:s.target.value}),className:"input-field",placeholder:"ул. Мустакиллик, 15, кв. 42"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Телефон"}),e.jsx("input",{type:"tel",value:c.phone,onChange:s=>O({...c,phone:s.target.value}),className:"input-field",placeholder:"+998 90 123 45 67"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-xl text-sm text-gray-600",children:[e.jsx("strong",{children:"Пароль:"})," ",l?.branchCode&&l?.buildingNumber?`${l.branchCode}/${l.buildingNumber}/[кв]`:R]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>L(!1),className:"btn-secondary flex-1",children:"Отмена"}),e.jsx("button",{onClick:ps,disabled:!c.fullName,className:"btn-primary flex-1 disabled:opacity-50",children:"Создать аккаунт"})]})]})}),m&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Карточка жителя"}),e.jsx("button",{onClick:()=>{U(null),D(!1),z("")},className:"p-2 hover:bg-white/30 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:m.name.split(" ").map(s=>s[0]).join("").slice(0,2)})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:m.name})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:"Л/С (Логин)"}),e.jsx("div",{className:"font-mono font-bold text-blue-900",children:m.login})]})]}),e.jsx("button",{onClick:()=>De(m.login),className:"p-2 hover:bg-blue-100 rounded-lg transition-colors",title:"Копировать",children:e.jsx(Qe,{className:"w-4 h-4 text-blue-600"})})]})}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Пароль"}),ce?e.jsx("input",{type:"text",value:A,onChange:s=>z(s.target.value),placeholder:"Новый пароль",className:"input-field text-sm py-1 px-2 w-40",autoFocus:!0}):e.jsxs("div",{className:"font-mono font-bold text-gray-900 flex items-center gap-2",children:[de?he(m):"••••••••",e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),Z(!de)},className:"p-2 hover:bg-gray-200 active:bg-gray-300 rounded touch-manipulation z-10",children:de?e.jsx(As,{className:"w-4 h-4"}):e.jsx(Rs,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:ce?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{if(A.length>=4&&m.id)try{await te.adminChangePassword(m.id,A),We(m.login,A),D(!1),Z(!0)}catch(s){alert("Ошибка сохранения пароля: "+s.message)}},disabled:A.length<4,className:"p-2 hover:bg-green-100 rounded-lg transition-colors disabled:opacity-50",title:"Сохранить",children:e.jsx(_s,{className:"w-4 h-4 text-green-600"})}),e.jsx("button",{onClick:()=>{D(!1),z("")},className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",title:"Отмена",children:e.jsx(ae,{className:"w-4 h-4 text-gray-600"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>De(he(m)),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",title:"Копировать",children:e.jsx(Qe,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>{D(!0),z(he(m))},className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",title:"Изменить пароль",children:e.jsx(Es,{className:"w-4 h-4 text-gray-600"})})]})})]}),ce&&A.length>0&&A.length<4&&e.jsx("p",{className:"text-xs text-red-500 mt-1 ml-13",children:"Минимум 4 символа"})]}),m.address&&e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ye,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Адрес"}),e.jsx("div",{className:"font-medium text-gray-900",children:m.address})]})]})}),m.apartment&&e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Квартира / Помещение"}),e.jsx("div",{className:"font-bold text-gray-900",children:m.apartment})]})]})}),m.phone&&e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(Fs,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Телефон"}),e.jsx("div",{className:"font-medium text-gray-900",children:m.phone})]})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>me({login:m.login,name:m.name}),className:"btn-secondary flex-1 flex items-center justify-center gap-2 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(G,{className:"w-4 h-4"}),"Удалить"]}),e.jsx("button",{onClick:()=>U(null),className:"btn-primary flex-1",children:"Закрыть"})]})]})}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl",children:[e.jsx("div",{className:"flex items-center justify-center w-14 h-14 rounded-full bg-red-100 mx-auto mb-4",children:e.jsx(Ke,{className:"w-7 h-7 text-red-600"})}),e.jsx("h3",{className:"text-lg font-bold text-center mb-2",children:"Удалить жителя?"}),e.jsx("p",{className:"text-gray-500 text-center text-sm mb-2",children:oe.name}),e.jsx("p",{className:"text-gray-400 text-center text-xs mb-6",children:"Это действие нельзя отменить. Житель потеряет доступ к системе."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>me(null),disabled:p,className:"flex-1 py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Отмена"}),e.jsx("button",{onClick:()=>Ns(oe.login),disabled:p,className:"flex-1 py-3 px-4 rounded-xl font-medium text-white bg-red-500 hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Удаление..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4"}),"Удалить"]})})]})]})}),rs&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl",children:[e.jsx("div",{className:"flex items-center justify-center w-14 h-14 rounded-full bg-red-100 mx-auto mb-4",children:e.jsx(G,{className:"w-7 h-7 text-red-600"})}),e.jsx("h3",{className:"text-lg font-bold text-center mb-2",children:"Удалить всех жителей?"}),e.jsxs("p",{className:"text-gray-500 text-center text-sm mb-2",children:["Будет удалено: ",e.jsx("strong",{children:N.length})," жителей"]}),e.jsx("p",{className:"text-gray-400 text-center text-xs mb-6",children:"Это действие нельзя отменить. Все жители потеряют доступ к системе."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>xe(!1),disabled:p,className:"flex-1 py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Отмена"}),e.jsx("button",{onClick:bs,disabled:p,className:"flex-1 py-3 px-4 rounded-xl font-medium text-white bg-red-500 hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Удаление..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4"}),"Удалить всех"]})})]})]})})]})}export{zs as ResidentsPage};
//# sourceMappingURL=ResidentsPage-1768381324153-CjWZbXHo.js.map

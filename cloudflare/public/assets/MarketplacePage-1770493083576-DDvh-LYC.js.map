{"version":3,"file":"MarketplacePage-1770493083576-DDvh-LYC.js","sources":["../../src/pages/MarketplacePage.tsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  ShoppingCart, Search, Heart, Package, Plus, Minus, X,\r\n  CheckCircle, ShoppingBag, Trash2, User, Star, History, XCircle, ChevronLeft, ChevronRight\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useLanguageStore } from '../stores/languageStore';\r\nimport { apiRequest } from '../services/api';\r\n\r\n// Types for API responses (snake_case from backend)\r\ninterface MarketplaceCategoryAPI {\r\n  id: string;\r\n  name_ru: string;\r\n  name_uz: string;\r\n  icon?: string;\r\n  sort_order: number;\r\n  is_active: boolean;\r\n  created_at: string;\r\n}\r\n\r\ninterface MarketplaceProductAPI {\r\n  id: string;\r\n  category_id: string;\r\n  name_ru: string;\r\n  name_uz: string;\r\n  description_ru?: string;\r\n  description_uz?: string;\r\n  price: number;\r\n  old_price?: number;\r\n  unit: string;\r\n  stock_quantity: number;\r\n  image_url?: string;\r\n  is_active: boolean;\r\n  is_featured: boolean;\r\n  created_at: string;\r\n}\r\n\r\ninterface MarketplaceCartItemAPI {\r\n  id: string;\r\n  product_id: string;\r\n  quantity: number;\r\n  added_at: string;\r\n}\r\n\r\ninterface MarketplaceOrderAPI {\r\n  id: string;\r\n  order_number: string;\r\n  resident_id: string;\r\n  resident_name?: string;\r\n  resident_phone?: string;\r\n  resident_address?: string;\r\n  resident_apartment?: string;\r\n  status: MarketplaceOrderStatus;\r\n  items: MarketplaceOrderItemAPI[];\r\n  total_amount: number;\r\n  items_count: number;\r\n  delivery_note?: string;\r\n  created_at: string;\r\n  rating?: number;\r\n  review?: string;\r\n}\r\n\r\ninterface MarketplaceOrderItemAPI {\r\n  id: string;\r\n  order_id?: string;\r\n  product_id: string;\r\n  product_name?: string;\r\n  product_image?: string;\r\n  quantity: number;\r\n  price?: number;\r\n  unit_price?: number;\r\n  total_price?: number;\r\n}\r\n\r\ntype MarketplaceOrderStatus = 'new' | 'confirmed' | 'preparing' | 'ready' | 'delivering' | 'delivered' | 'cancelled';\r\n\r\n// –≠—Ç–∞–ø—ã –∑–∞–∫–∞–∑–∞ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–∫–µ—Ä–∞\r\nconst ORDER_STAGES = [\r\n  {\r\n    id: 'created',\r\n    statuses: ['new'],\r\n    labelRu: '–ù–æ–≤—ã–π',\r\n    labelUz: 'Yangi',\r\n    icon: ShoppingBag,\r\n    descRu: '–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω',\r\n    descUz: 'Buyurtma yaratildi',\r\n  },\r\n  {\r\n    id: 'confirmed',\r\n    statuses: ['confirmed'],\r\n    labelRu: '–ù–∞–∑–Ω–∞—á–µ–Ω',\r\n    labelUz: 'Tayinlangan',\r\n    icon: CheckCircle,\r\n    descRu: '–ó–∞–∫–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω',\r\n    descUz: 'Buyurtma tasdiqlandi',\r\n  },\r\n  {\r\n    id: 'preparing',\r\n    statuses: ['preparing'],\r\n    labelRu: '–°–æ–±–∏—Ä–∞–µ—Ç—Å—è',\r\n    labelUz: 'Yig\\'ilmoqda',\r\n    icon: Package,\r\n    descRu: '–°–æ–±–∏—Ä–∞–µ–º –∑–∞–∫–∞–∑',\r\n    descUz: 'Buyurtma yig\\'ilmoqda',\r\n  },\r\n  {\r\n    id: 'delivering',\r\n    statuses: ['delivering'],\r\n    labelRu: '–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è',\r\n    labelUz: 'Yetkazilmoqda',\r\n    icon: User,\r\n    descRu: '–í –ø—É—Ç–∏ –∫ –≤–∞–º',\r\n    descUz: 'Sizga yo\\'lda',\r\n  },\r\n  {\r\n    id: 'ready',\r\n    statuses: ['ready'],\r\n    labelRu: '–ì–æ—Ç–æ–≤',\r\n    labelUz: 'Tayyor',\r\n    icon: CheckCircle,\r\n    descRu: '–ì–æ—Ç–æ–≤ –∫ –ø–æ–ª—É—á–µ–Ω–∏—é',\r\n    descUz: 'Qabul qilishga tayyor',\r\n  },\r\n  {\r\n    id: 'delivered',\r\n    statuses: ['delivered'],\r\n    labelRu: '–ü–æ–ª—É—á–µ–Ω',\r\n    labelUz: 'Qabul qilindi',\r\n    icon: CheckCircle,\r\n    descRu: '–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω',\r\n    descUz: 'Buyurtma yetkazildi',\r\n  },\r\n];\r\n\r\nfunction getOrderStageIndex(status: MarketplaceOrderStatus): number {\r\n  if (status === 'cancelled') return -1;\r\n  for (let i = 0; i < ORDER_STAGES.length; i++) {\r\n    if (ORDER_STAGES[i].statuses.includes(status)) {\r\n      return i;\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getOrderStatusMessage(status: MarketplaceOrderStatus, language: 'ru' | 'uz'): { title: string; subtitle: string } {\r\n  switch (status) {\r\n    case 'new':\r\n      return {\r\n        title: language === 'ru' ? '–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω' : 'Buyurtma yaratildi',\r\n        subtitle: language === 'ru' ? '–û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è' : 'Tasdiqlanishini kutmoqdamiz'\r\n      };\r\n    case 'confirmed':\r\n      return {\r\n        title: language === 'ru' ? '–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç' : 'Buyurtma qabul qilindi',\r\n        subtitle: language === 'ru' ? '–ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É' : 'Yig\\'ishni boshlaymiz'\r\n      };\r\n    case 'preparing':\r\n      return {\r\n        title: language === 'ru' ? '–°–æ–±–∏—Ä–∞–µ–º –∑–∞–∫–∞–∑' : 'Buyurtma yig\\'ilmoqda',\r\n        subtitle: language === 'ru' ? '–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤' : 'Tez orada tayyor bo\\'ladi'\r\n      };\r\n    case 'ready':\r\n      return {\r\n        title: language === 'ru' ? '–ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤' : 'Buyurtma tayyor',\r\n        subtitle: language === 'ru' ? '–ü–µ—Ä–µ–¥–∞—ë–º –∫—É—Ä—å–µ—Ä—É' : 'Kuryerga topshirilmoqda'\r\n      };\r\n    case 'delivering':\r\n      return {\r\n        title: language === 'ru' ? '–ö—É—Ä—å–µ—Ä –≤ –ø—É—Ç–∏' : 'Kuryer yo\\'lda',\r\n        subtitle: language === 'ru' ? '–°–∫–æ—Ä–æ –±—É–¥–µ—Ç —É –≤–∞—Å' : 'Tez orada sizda bo\\'ladi'\r\n      };\r\n    case 'delivered':\r\n      return {\r\n        title: language === 'ru' ? '–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω' : 'Buyurtma yetkazildi',\r\n        subtitle: language === 'ru' ? '–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!' : 'Yoqimli ishtaha!'\r\n      };\r\n    case 'cancelled':\r\n      return {\r\n        title: language === 'ru' ? '–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω' : 'Buyurtma bekor qilindi',\r\n        subtitle: language === 'ru' ? '' : ''\r\n      };\r\n    default:\r\n      return { title: '', subtitle: '' };\r\n  }\r\n}\r\n\r\nconst CATEGORY_ICONS: Record<string, string> = {\r\n  cat_groceries: 'üõí',\r\n  cat_dairy: 'ü•õ',\r\n  cat_meat: 'ü•©',\r\n  cat_bakery: 'üçû',\r\n  cat_fruits: 'üçé',\r\n  cat_beverages: 'ü•§',\r\n  cat_household: 'üßπ',\r\n  cat_personal: 'üß¥',\r\n  cat_baby: 'üë∂',\r\n  cat_pets: 'üêæ',\r\n  cat_frozen: '‚ùÑÔ∏è',\r\n  cat_snacks: 'üçø',\r\n};\r\n\r\nexport function MarketplacePage() {\r\n  const { user } = useAuthStore();\r\n  const { language } = useLanguageStore();\r\n\r\n  const [activeTab, setActiveTab] = useState<'shop' | 'cart' | 'orders' | 'history' | 'favorites'>('shop');\r\n  const [categories, setCategories] = useState<MarketplaceCategoryAPI[]>([]);\r\n  const [products, setProducts] = useState<MarketplaceProductAPI[]>([]);\r\n  const [cart, setCart] = useState<MarketplaceCartItemAPI[]>([]);\r\n  const [orders, setOrders] = useState<MarketplaceOrderAPI[]>([]);\r\n  const [favorites, setFavorites] = useState<string[]>([]);\r\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedProduct, setSelectedProduct] = useState<MarketplaceProductAPI | null>(null);\r\n  const [showOrderModal, setShowOrderModal] = useState(false);\r\n  const [deliveryNote, setDeliveryNote] = useState('');\r\n  const [orderSuccess, setOrderSuccess] = useState(false);\r\n  const [cancellingOrderId, setCancellingOrderId] = useState<string | null>(null);\r\n\r\n  // Pagination state\r\n  const [productsPage, setProductsPage] = useState(1);\r\n  const [ordersPage, setOrdersPage] = useState(1);\r\n  const [historyPage, setHistoryPage] = useState(1);\r\n  const ITEMS_PER_PAGE = 10;\r\n\r\n  // Delivery rating modal state\r\n  const [showDeliveryRatingModal, setShowDeliveryRatingModal] = useState(false);\r\n  const [ratingOrderId, setRatingOrderId] = useState<string | null>(null);\r\n  const [deliveryRating, setDeliveryRating] = useState(5);\r\n  const [deliveryReview, setDeliveryReview] = useState('');\r\n  const [isSubmittingRating, setIsSubmittingRating] = useState(false);\r\n\r\n  // Fetch data\r\n  const fetchData = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Fetch public data first (no auth required)\r\n      const [categoriesRes, productsRes] = await Promise.all([\r\n        apiRequest<{ categories: MarketplaceCategoryAPI[] }>('/api/marketplace/categories'),\r\n        apiRequest<{ products: MarketplaceProductAPI[], total: number }>('/api/marketplace/products'),\r\n      ]);\r\n\r\n      setCategories(categoriesRes?.categories || []);\r\n      setProducts(productsRes?.products || []);\r\n\r\n      // Fetch user-specific data only if logged in\r\n      if (user) {\r\n        try {\r\n          const [cartRes, ordersRes, favoritesRes] = await Promise.all([\r\n            apiRequest<{ cart: MarketplaceCartItemAPI[], total: number, itemsCount: number }>('/api/marketplace/cart'),\r\n            apiRequest<{ orders: MarketplaceOrderAPI[] }>('/api/marketplace/orders'),\r\n            apiRequest<{ favorites: { id: string }[] }>('/api/marketplace/favorites'),\r\n          ]);\r\n          setCart(cartRes?.cart || []);\r\n          setOrders(ordersRes?.orders || []);\r\n          setFavorites((favoritesRes?.favorites || []).map(f => f.id));\r\n        } catch (err) {\r\n          console.error('Error fetching user marketplace data:', err);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching marketplace data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [fetchData]);\r\n\r\n  // Poll for order status updates every 10 seconds (only if user has active orders)\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    const hasActiveOrders = orders.some(o => !['delivered', 'cancelled'].includes(o.status));\r\n    if (!hasActiveOrders) return;\r\n\r\n    const pollOrderUpdates = async () => {\r\n      try {\r\n        const ordersRes = await apiRequest<{ orders: MarketplaceOrderAPI[] }>('/api/marketplace/orders');\r\n        if (ordersRes?.orders) {\r\n          setOrders(ordersRes.orders);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error polling order updates:', err);\r\n      }\r\n    };\r\n\r\n    // Poll every 10 seconds for order status updates\r\n    const interval = setInterval(pollOrderUpdates, 10000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [user, orders.length > 0 && orders.some(o => !['delivered', 'cancelled'].includes(o.status))]);\r\n\r\n  // Listen for openDeliveryRatingModal event from popup notifications\r\n  useEffect(() => {\r\n    const handleOpenDeliveryRatingModal = (event: CustomEvent<{ orderId: string }>) => {\r\n      const { orderId } = event.detail;\r\n      const order = orders.find(o => o.id === orderId);\r\n      if (order && order.status === 'delivered') {\r\n        setRatingOrderId(orderId);\r\n        setShowDeliveryRatingModal(true);\r\n        sessionStorage.removeItem('open_delivery_rating_for_order');\r\n      }\r\n    };\r\n\r\n    window.addEventListener('openDeliveryRatingModal', handleOpenDeliveryRatingModal as EventListener);\r\n    return () => {\r\n      window.removeEventListener('openDeliveryRatingModal', handleOpenDeliveryRatingModal as EventListener);\r\n    };\r\n  }, [orders]);\r\n\r\n  // Check sessionStorage for pending delivery rating modal (after navigation or page load)\r\n  useEffect(() => {\r\n    if (orders.length === 0) return;\r\n\r\n    const pendingOrderId = sessionStorage.getItem('open_delivery_rating_for_order');\r\n    if (pendingOrderId) {\r\n      const order = orders.find(o => o.id === pendingOrderId);\r\n      if (order && order.status === 'delivered') {\r\n        setRatingOrderId(pendingOrderId);\r\n        setShowDeliveryRatingModal(true);\r\n        sessionStorage.removeItem('open_delivery_rating_for_order');\r\n      }\r\n    }\r\n  }, [orders]);\r\n\r\n  // Add to cart\r\n  const addToCart = async (productId: string, quantity: number = 1) => {\r\n    try {\r\n      await apiRequest('/api/marketplace/cart', {\r\n        method: 'POST',\r\n        body: JSON.stringify({ product_id: productId, quantity }),\r\n      });\r\n      const cartRes = await apiRequest<{ cart: MarketplaceCartItemAPI[] }>('/api/marketplace/cart');\r\n      setCart(cartRes?.cart || []);\r\n    } catch (error) {\r\n      console.error('Error adding to cart:', error);\r\n    }\r\n  };\r\n\r\n  // Update cart quantity\r\n  const updateCartQuantity = async (productId: string, quantity: number) => {\r\n    if (quantity <= 0) {\r\n      await removeFromCart(productId);\r\n      return;\r\n    }\r\n    try {\r\n      await apiRequest('/api/marketplace/cart', {\r\n        method: 'POST',\r\n        body: JSON.stringify({ product_id: productId, quantity }),\r\n      });\r\n      const cartRes = await apiRequest<{ cart: MarketplaceCartItemAPI[] }>('/api/marketplace/cart');\r\n      setCart(cartRes?.cart || []);\r\n    } catch (error) {\r\n      console.error('Error updating cart:', error);\r\n    }\r\n  };\r\n\r\n  // Remove from cart\r\n  const removeFromCart = async (productId: string) => {\r\n    try {\r\n      await apiRequest(`/api/marketplace/cart/${productId}`, { method: 'DELETE' });\r\n      const cartRes = await apiRequest<{ cart: MarketplaceCartItemAPI[] }>('/api/marketplace/cart');\r\n      setCart(cartRes?.cart || []);\r\n    } catch (error) {\r\n      console.error('Error removing from cart:', error);\r\n    }\r\n  };\r\n\r\n  // Toggle favorite\r\n  const toggleFavorite = async (productId: string) => {\r\n    // Optimistic update for instant UI feedback\r\n    const isFavorite = favorites.includes(productId);\r\n    if (isFavorite) {\r\n      setFavorites(favorites.filter(id => id !== productId));\r\n    } else {\r\n      setFavorites([...favorites, productId]);\r\n    }\r\n\r\n    try {\r\n      await apiRequest(`/api/marketplace/favorites/${productId}`, { method: 'POST' });\r\n    } catch (error) {\r\n      console.error('Error toggling favorite:', error);\r\n      // Revert on error\r\n      if (isFavorite) {\r\n        setFavorites([...favorites, productId]);\r\n      } else {\r\n        setFavorites(favorites.filter(id => id !== productId));\r\n      }\r\n    }\r\n  };\r\n\r\n  // Create order\r\n  const createOrder = async () => {\r\n    try {\r\n      await apiRequest('/api/marketplace/orders', {\r\n        method: 'POST',\r\n        body: JSON.stringify({ delivery_notes: deliveryNote }),\r\n      });\r\n      setOrderSuccess(true);\r\n      setShowOrderModal(false);\r\n      setDeliveryNote('');\r\n      // Refresh cart and orders\r\n      const [cartRes, ordersRes] = await Promise.all([\r\n        apiRequest<{ cart: MarketplaceCartItemAPI[] }>('/api/marketplace/cart'),\r\n        apiRequest<{ orders: MarketplaceOrderAPI[] }>('/api/marketplace/orders'),\r\n      ]);\r\n      setCart(cartRes?.cart || []);\r\n      setOrders(ordersRes?.orders || []);\r\n      setTimeout(() => {\r\n        setOrderSuccess(false);\r\n        setActiveTab('orders');\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error('Error creating order:', error);\r\n    }\r\n  };\r\n\r\n  // Submit delivery rating\r\n  const submitDeliveryRating = async () => {\r\n    if (!ratingOrderId) return;\r\n\r\n    try {\r\n      setIsSubmittingRating(true);\r\n      await apiRequest(`/api/marketplace/orders/${ratingOrderId}/rate`, {\r\n        method: 'POST',\r\n        body: JSON.stringify({ rating: deliveryRating, review: deliveryReview || undefined }),\r\n      });\r\n\r\n      // Refresh orders to update the rating\r\n      const ordersRes = await apiRequest<{ orders: MarketplaceOrderAPI[] }>('/api/marketplace/orders');\r\n      setOrders(ordersRes?.orders || []);\r\n\r\n      // Close modal and reset state\r\n      setShowDeliveryRatingModal(false);\r\n      setRatingOrderId(null);\r\n      setDeliveryRating(5);\r\n      setDeliveryReview('');\r\n    } catch (error) {\r\n      console.error('Error submitting delivery rating:', error);\r\n    } finally {\r\n      setIsSubmittingRating(false);\r\n    }\r\n  };\r\n\r\n  // Cancel order\r\n  const cancelOrder = async (orderId: string) => {\r\n    if (!confirm(language === 'ru' ? '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?' : 'Buyurtmani bekor qilmoqchimisiz?')) {\r\n      return;\r\n    }\r\n    try {\r\n      setCancellingOrderId(orderId);\r\n      await apiRequest(`/api/marketplace/orders/${orderId}/cancel`, {\r\n        method: 'POST',\r\n        body: JSON.stringify({ reason: '–û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º' }),\r\n      });\r\n      // Refresh orders\r\n      const ordersRes = await apiRequest<{ orders: MarketplaceOrderAPI[] }>('/api/marketplace/orders');\r\n      setOrders(ordersRes?.orders || []);\r\n    } catch (error) {\r\n      console.error('Error cancelling order:', error);\r\n      alert(language === 'ru' ? '–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞' : 'Buyurtmani bekor qilishda xato');\r\n    } finally {\r\n      setCancellingOrderId(null);\r\n    }\r\n  };\r\n\r\n  // Filter products\r\n  const filteredProducts = products.filter(p => {\r\n    const matchesCategory = !selectedCategory || p.category_id === selectedCategory;\r\n    const matchesSearch = !searchQuery ||\r\n      (language === 'ru' ? p.name_ru : p.name_uz).toLowerCase().includes(searchQuery.toLowerCase());\r\n    return matchesCategory && matchesSearch;\r\n  });\r\n\r\n  // Get cart item quantity for a product\r\n  const getCartQuantity = (productId: string) => {\r\n    const item = cart.find(c => c.product_id === productId);\r\n    return item?.quantity || 0;\r\n  };\r\n\r\n  // Calculate cart total\r\n  const cartTotal = cart.reduce((sum, item) => {\r\n    const product = products.find(p => p.id === item.product_id);\r\n    return sum + (product?.price || 0) * item.quantity;\r\n  }, 0);\r\n\r\n  const formatPrice = (price: number) => {\r\n    return new Intl.NumberFormat('ru-RU').format(price) + ' —Å—É–º';\r\n  };\r\n\r\n  // Split orders into active and history\r\n  const activeOrders = orders.filter(o => !['delivered', 'cancelled'].includes(o.status));\r\n  const historyOrders = orders.filter(o => ['delivered', 'cancelled'].includes(o.status));\r\n\r\n  // Paginated products\r\n  const paginatedProducts = filteredProducts.slice((productsPage - 1) * ITEMS_PER_PAGE, productsPage * ITEMS_PER_PAGE);\r\n  const totalProductPages = Math.ceil(filteredProducts.length / ITEMS_PER_PAGE);\r\n\r\n  // Paginated active orders\r\n  const paginatedActiveOrders = activeOrders.slice((ordersPage - 1) * ITEMS_PER_PAGE, ordersPage * ITEMS_PER_PAGE);\r\n  const totalOrderPages = Math.ceil(activeOrders.length / ITEMS_PER_PAGE);\r\n\r\n  // Paginated history orders\r\n  const paginatedHistoryOrders = historyOrders.slice((historyPage - 1) * ITEMS_PER_PAGE, historyPage * ITEMS_PER_PAGE);\r\n  const totalHistoryPages = Math.ceil(historyOrders.length / ITEMS_PER_PAGE);\r\n\r\n  const tabs = [\r\n    { id: 'shop' as const, label: language === 'ru' ? '–ú–∞–≥–∞–∑–∏–Ω' : 'Do\\'kon', shortLabel: language === 'ru' ? '–¢–æ–≤–∞—Ä—ã' : 'Do\\'kon', icon: ShoppingBag },\r\n    { id: 'cart' as const, label: language === 'ru' ? '–ö–æ—Ä–∑–∏–Ω–∞' : 'Savat', shortLabel: language === 'ru' ? '–ö–æ—Ä–∑–∏–Ω–∞' : 'Savat', icon: ShoppingCart, count: cart.length },\r\n    { id: 'orders' as const, label: language === 'ru' ? '–ê–∫—Ç–∏–≤–Ω—ã–µ' : 'Faol', shortLabel: language === 'ru' ? '–ê–∫—Ç–∏–≤.' : 'Faol', icon: Package, count: activeOrders.length },\r\n    { id: 'history' as const, label: language === 'ru' ? '–ò—Å—Ç–æ—Ä–∏—è' : 'Tarix', shortLabel: language === 'ru' ? '–ò—Å—Ç–æ—Ä.' : 'Tarix', icon: History },\r\n    { id: 'favorites' as const, label: language === 'ru' ? '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ' : 'Sevimlilar', shortLabel: language === 'ru' ? '–ò–∑–±—Ä.' : 'Sevim.', icon: Heart, count: favorites.length },\r\n  ];\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 bg-orange-50/50\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\r\n      {/* Success Toast */}\r\n      {orderSuccess && (\r\n        <div className=\"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2\">\r\n          <CheckCircle className=\"w-5 h-5\" />\r\n          <span>{language === 'ru' ? '–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!' : 'Buyurtma muvaffaqiyatli yaratildi!'}</span>\r\n        </div>\r\n      )}\r\n\r\n      {/* Tabs */}\r\n      <div className=\"glass-card sticky top-0 z-40\">\r\n        <div className=\"flex\">\r\n          {tabs.map(tab => (\r\n            <button\r\n              key={tab.id}\r\n              onClick={() => setActiveTab(tab.id)}\r\n              className={`flex-1 py-3 px-2 sm:px-4 flex items-center justify-center gap-1 sm:gap-2 border-b-2 transition-colors ${\r\n                activeTab === tab.id\r\n                  ? 'border-orange-500 text-orange-600 bg-orange-50/50'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              <tab.icon className=\"w-5 h-5 flex-shrink-0\" />\r\n              <span className=\"text-xs sm:text-sm font-medium whitespace-nowrap\">{tab.shortLabel || tab.label}</span>\r\n              {tab.count !== undefined && tab.count > 0 && (\r\n                <span className=\"bg-orange-500 text-white text-xs px-1.5 sm:px-2 py-0.5 rounded-full flex-shrink-0\">\r\n                  {tab.count}\r\n                </span>\r\n              )}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"p-4 pb-20\">\r\n        {/* Shop Tab */}\r\n        {activeTab === 'shop' && (\r\n          <div>\r\n            {/* Search */}\r\n            <div className=\"relative mb-4\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <input\r\n                type=\"text\"\r\n                placeholder={language === 'ru' ? '–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...' : 'Mahsulot qidirish...'}\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n                className=\"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\r\n              />\r\n            </div>\r\n\r\n            {/* Categories Grid */}\r\n            <div className=\"grid grid-cols-4 gap-2 mb-4\">\r\n              <button\r\n                onClick={() => setSelectedCategory(null)}\r\n                className={`flex flex-col items-center justify-center p-3 rounded-xl transition-all ${\r\n                  !selectedCategory\r\n                    ? 'bg-orange-500 text-white shadow-md'\r\n                    : 'glass-card text-gray-700 hover:bg-white/60'\r\n                }`}\r\n              >\r\n                <span className=\"text-2xl mb-1\">üè™</span>\r\n                <span className=\"text-xs font-medium text-center\">{language === 'ru' ? '–í—Å–µ' : 'Hammasi'}</span>\r\n              </button>\r\n              {categories.map(cat => (\r\n                <button\r\n                  key={cat.id}\r\n                  onClick={() => setSelectedCategory(cat.id)}\r\n                  className={`flex flex-col items-center justify-center p-3 rounded-xl transition-all ${\r\n                    selectedCategory === cat.id\r\n                      ? 'bg-orange-500 text-white shadow-md'\r\n                      : 'glass-card text-gray-700 hover:bg-white/60'\r\n                  }`}\r\n                >\r\n                  <span className=\"text-2xl mb-1\">{CATEGORY_ICONS[cat.id] || 'üì¶'}</span>\r\n                  <span className=\"text-xs font-medium text-center line-clamp-1\">{language === 'ru' ? cat.name_ru : cat.name_uz}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Products Grid */}\r\n            <div className=\"grid grid-cols-2 gap-3\">\r\n              {paginatedProducts.map(product => {\r\n                const cartQty = getCartQuantity(product.id);\r\n                const isFavorite = favorites.includes(product.id);\r\n\r\n                return (\r\n                  <div\r\n                    key={product.id}\r\n                    className=\"glass-card overflow-hidden\"\r\n                  >\r\n                    {/* Product Image */}\r\n                    <div\r\n                      className=\"relative aspect-square bg-gray-100 flex items-center justify-center cursor-pointer\"\r\n                      onClick={() => setSelectedProduct(product)}\r\n                    >\r\n                      {product.image_url ? (\r\n                        <img\r\n                          src={product.image_url}\r\n                          alt={language === 'ru' ? product.name_ru : product.name_uz}\r\n                          className=\"w-full h-full object-cover\"\r\n                        />\r\n                      ) : (\r\n                        <span className=\"text-4xl\">\r\n                          {CATEGORY_ICONS[product.category_id] || 'üì¶'}\r\n                        </span>\r\n                      )}\r\n                      {/* Favorite Button */}\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          toggleFavorite(product.id);\r\n                        }}\r\n                        className=\"absolute top-2 right-2 p-1.5 rounded-full bg-white shadow-sm\"\r\n                      >\r\n                        <Heart\r\n                          className={`w-4 h-4 ${isFavorite ? 'fill-red-500 text-red-500' : 'text-gray-400'}`}\r\n                        />\r\n                      </button>\r\n                      {/* Featured Badge */}\r\n                      {product.is_featured && (\r\n                        <div className=\"absolute top-2 left-2 bg-orange-500 text-white text-xs px-2 py-0.5 rounded-full\">\r\n                          {language === 'ru' ? '–•–∏—Ç' : 'Hit'}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Product Info */}\r\n                    <div className=\"p-3\">\r\n                      <h3 className=\"font-medium text-sm text-gray-900 line-clamp-2 min-h-[40px]\">\r\n                        {language === 'ru' ? product.name_ru : product.name_uz}\r\n                      </h3>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">{product.unit}</p>\r\n                      {/* Stock indicator */}\r\n                      <p className={`text-xs mt-1 ${\r\n                        product.stock_quantity === 0\r\n                          ? 'text-red-500'\r\n                          : product.stock_quantity <= 5\r\n                            ? 'text-amber-500'\r\n                            : 'text-green-600'\r\n                      }`}>\r\n                        {product.stock_quantity === 0\r\n                          ? (language === 'ru' ? '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' : 'Mavjud emas')\r\n                          : (language === 'ru'\r\n                              ? `–í –Ω–∞–ª–∏—á–∏–∏: ${product.stock_quantity} ${product.unit}`\r\n                              : `Mavjud: ${product.stock_quantity} ${product.unit}`)\r\n                        }\r\n                      </p>\r\n                      <div className=\"flex items-center justify-between mt-2\">\r\n                        <div>\r\n                          <p className=\"font-bold text-orange-600\">\r\n                            {formatPrice(product.price)}\r\n                          </p>\r\n                          {product.old_price && (\r\n                            <p className=\"text-xs text-gray-400 line-through\">\r\n                              {formatPrice(product.old_price)}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Add to Cart */}\r\n                      {cartQty > 0 ? (\r\n                        <div className=\"flex items-center justify-between mt-3 bg-orange-50 rounded-lg p-1\">\r\n                          <button\r\n                            onClick={() => updateCartQuantity(product.id, cartQty - 1)}\r\n                            className=\"p-1.5 rounded-md bg-white shadow-sm\"\r\n                          >\r\n                            <Minus className=\"w-4 h-4 text-orange-600\" />\r\n                          </button>\r\n                          <span className=\"font-medium text-orange-600\">{cartQty}</span>\r\n                          <button\r\n                            onClick={() => updateCartQuantity(product.id, cartQty + 1)}\r\n                            className=\"p-1.5 rounded-md bg-white shadow-sm\"\r\n                          >\r\n                            <Plus className=\"w-4 h-4 text-orange-600\" />\r\n                          </button>\r\n                        </div>\r\n                      ) : (\r\n                        <button\r\n                          onClick={() => addToCart(product.id)}\r\n                          disabled={product.stock_quantity === 0}\r\n                          className={`w-full mt-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${\r\n                            product.stock_quantity === 0\r\n                              ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n                              : 'bg-orange-500 text-white hover:bg-orange-600'\r\n                          }`}\r\n                        >\r\n                          <Plus className=\"w-4 h-4\" />\r\n                          <span>{product.stock_quantity === 0\r\n                            ? (language === 'ru' ? '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' : 'Mavjud emas')\r\n                            : (language === 'ru' ? '–í –∫–æ—Ä–∑–∏–Ω—É' : 'Savatga')\r\n                          }</span>\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            {filteredProducts.length === 0 && (\r\n              <div className=\"text-center py-12\">\r\n                <Package className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n                <p className=\"text-gray-500\">\r\n                  {language === 'ru' ? '–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : 'Mahsulotlar topilmadi'}\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Pagination */}\r\n            {totalProductPages > 1 && (\r\n              <div className=\"flex items-center justify-center gap-2 mt-6\">\r\n                <button\r\n                  onClick={() => setProductsPage(p => Math.max(1, p - 1))}\r\n                  disabled={productsPage === 1}\r\n                  className=\"p-2 rounded-lg bg-white shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  <ChevronLeft className=\"w-5 h-5\" />\r\n                </button>\r\n                <span className=\"text-sm text-gray-600\">\r\n                  {productsPage} / {totalProductPages}\r\n                </span>\r\n                <button\r\n                  onClick={() => setProductsPage(p => Math.min(totalProductPages, p + 1))}\r\n                  disabled={productsPage === totalProductPages}\r\n                  className=\"p-2 rounded-lg bg-white shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  <ChevronRight className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Cart Tab */}\r\n        {activeTab === 'cart' && (\r\n          <div>\r\n            {cart.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <ShoppingCart className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n                <p className=\"text-gray-500 mb-4\">\r\n                  {language === 'ru' ? '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞' : 'Savat bo\\'sh'}\r\n                </p>\r\n                <button\r\n                  onClick={() => setActiveTab('shop')}\r\n                  className=\"text-orange-600 font-medium\"\r\n                >\r\n                  {language === 'ru' ? '–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º' : 'Xaridga o\\'tish'}\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"space-y-3 mb-4\">\r\n                  {cart.map(item => {\r\n                    const product = products.find(p => p.id === item.product_id);\r\n                    if (!product) return null;\r\n\r\n                    return (\r\n                      <div key={item.id} className=\"glass-card p-4 flex gap-3\">\r\n                        <div className=\"w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                          {product.image_url ? (\r\n                            <img\r\n                              src={product.image_url}\r\n                              alt=\"\"\r\n                              className=\"w-full h-full object-cover rounded-lg\"\r\n                            />\r\n                          ) : (\r\n                            <span className=\"text-2xl\">\r\n                              {CATEGORY_ICONS[product.category_id] || 'üì¶'}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <h3 className=\"font-medium text-gray-900 line-clamp-2\">\r\n                            {language === 'ru' ? product.name_ru : product.name_uz}\r\n                          </h3>\r\n                          <p className=\"text-sm text-gray-500\">{product.unit}</p>\r\n                          <p className=\"font-bold text-orange-600 mt-1\">\r\n                            {formatPrice(product.price * item.quantity)}\r\n                          </p>\r\n                        </div>\r\n                        <div className=\"flex flex-col items-end justify-between\">\r\n                          <button\r\n                            onClick={() => removeFromCart(product.id)}\r\n                            className=\"p-1 text-gray-400 hover:text-red-500\"\r\n                          >\r\n                            <Trash2 className=\"w-4 h-4\" />\r\n                          </button>\r\n                          <div className=\"flex items-center gap-2 bg-gray-100 rounded-lg p-1\">\r\n                            <button\r\n                              onClick={() => updateCartQuantity(product.id, item.quantity - 1)}\r\n                              className=\"p-1 rounded bg-white shadow-sm\"\r\n                            >\r\n                              <Minus className=\"w-3 h-3\" />\r\n                            </button>\r\n                            <span className=\"w-6 text-center text-sm font-medium\">{item.quantity}</span>\r\n                            <button\r\n                              onClick={() => updateCartQuantity(product.id, item.quantity + 1)}\r\n                              className=\"p-1 rounded bg-white shadow-sm\"\r\n                            >\r\n                              <Plus className=\"w-3 h-3\" />\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n\r\n                {/* Cart Total */}\r\n                <div className=\"glass-card p-4 mb-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <span className=\"text-gray-600\">\r\n                      {language === 'ru' ? '–¢–æ–≤–∞—Ä–æ–≤:' : 'Mahsulotlar:'}\r\n                    </span>\r\n                    <span className=\"font-medium\">{cart.reduce((sum, i) => sum + i.quantity, 0)} —à—Ç</span>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between text-lg font-bold\">\r\n                    <span>{language === 'ru' ? '–ò—Ç–æ–≥–æ:' : 'Jami:'}</span>\r\n                    <span className=\"text-orange-600\">{formatPrice(cartTotal)}</span>\r\n                  </div>\r\n                </div>\r\n\r\n                <button\r\n                  onClick={() => setShowOrderModal(true)}\r\n                  className=\"w-full py-4 bg-orange-500 text-white rounded-xl font-medium hover:bg-orange-600 transition-colors\"\r\n                >\r\n                  {language === 'ru' ? '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑' : 'Buyurtma berish'}\r\n                </button>\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Orders Tab (Active Orders) */}\r\n        {activeTab === 'orders' && (\r\n          <div>\r\n            {activeOrders.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <Package className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n                <p className=\"text-gray-500 mb-4\">\r\n                  {language === 'ru' ? '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤' : 'Faol buyurtmalar yo\\'q'}\r\n                </p>\r\n                <button\r\n                  onClick={() => setActiveTab('shop')}\r\n                  className=\"text-orange-600 font-medium\"\r\n                >\r\n                  {language === 'ru' ? '–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º' : 'Xaridga o\\'tish'}\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {paginatedActiveOrders.map(order => {\r\n                  const currentStageIndex = getOrderStageIndex(order.status);\r\n                  const statusMessage = getOrderStatusMessage(order.status, language);\r\n                  const canCancel = ['new', 'confirmed'].includes(order.status);\r\n\r\n                  return (\r\n                    <div key={order.id} className=\"glass-card overflow-hidden\">\r\n                      {/* Header */}\r\n                      <div className=\"p-4 bg-gradient-to-r from-orange-500/10 to-amber-400/10 border-b border-orange-100\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div>\r\n                            <p className=\"font-bold text-gray-900\">\r\n                              {language === 'ru' ? '–ó–∞–∫–∞–∑' : 'Buyurtma'} #{order.order_number}\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-500\">\r\n                              {new Date(order.created_at).toLocaleDateString('ru-RU', {\r\n                                day: 'numeric',\r\n                                month: 'long',\r\n                                hour: '2-digit',\r\n                                minute: '2-digit'\r\n                              })}\r\n                            </p>\r\n                          </div>\r\n                          <span className=\"font-bold text-orange-600\">\r\n                            {formatPrice(order.total_amount)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Status Message */}\r\n                      <div className=\"px-4 pt-4 pb-2 text-center\">\r\n                        <h3 className=\"text-lg font-bold text-gray-900\">\r\n                          {statusMessage.title}\r\n                        </h3>\r\n                        <p className=\"text-sm text-gray-500\">\r\n                          {statusMessage.subtitle}\r\n                        </p>\r\n                      </div>\r\n\r\n                      {/* Status Progress Chain */}\r\n                      <div className=\"px-4 py-4\">\r\n                        <div className=\"flex items-center justify-between relative\">\r\n                          {/* Progress Line Background */}\r\n                          <div className=\"absolute top-4 left-4 right-4 h-1 bg-gray-200 rounded-full\" />\r\n                          {/* Progress Line Active */}\r\n                          <div\r\n                            className=\"absolute top-4 left-4 h-1 bg-orange-500 rounded-full transition-all duration-500\"\r\n                            style={{\r\n                              width: `calc(${Math.min((currentStageIndex / (ORDER_STAGES.length - 1)) * 100, 100)}% - 32px)`\r\n                            }}\r\n                          />\r\n\r\n                          {/* Stage Icons */}\r\n                          {ORDER_STAGES.map((stage, index) => {\r\n                            const isCompleted = currentStageIndex >= index;\r\n                            const isCurrent = currentStageIndex === index;\r\n                            const StageIcon = stage.icon;\r\n\r\n                            return (\r\n                              <div key={stage.id} className=\"relative z-10 flex flex-col items-center\">\r\n                                <div\r\n                                  className={`w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 ${\r\n                                    isCompleted\r\n                                      ? isCurrent\r\n                                        ? 'bg-orange-500 text-white ring-4 ring-orange-200 shadow-lg'\r\n                                        : 'bg-orange-500 text-white'\r\n                                      : 'bg-gray-200 text-gray-400'\r\n                                  }`}\r\n                                >\r\n                                  <StageIcon className=\"w-4 h-4\" />\r\n                                </div>\r\n                                <span className={`text-[10px] mt-1.5 font-medium text-center max-w-[50px] leading-tight ${\r\n                                  isCompleted ? 'text-gray-900' : 'text-gray-400'\r\n                                }`}>\r\n                                  {language === 'ru' ? stage.labelRu : stage.labelUz}\r\n                                </span>\r\n                              </div>\r\n                            );\r\n                          })}\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Order Items List */}\r\n                      <div className=\"px-4 pb-4 border-t border-gray-100 pt-3\">\r\n                        <p className=\"text-xs font-medium text-gray-700 mb-2\">{language === 'ru' ? '–¢–æ–≤–∞—Ä—ã:' : 'Mahsulotlar:'}</p>\r\n                        <div className=\"space-y-2\">\r\n                          {(order.items || []).map((item, idx) => (\r\n                            <div key={item.id || idx} className=\"flex items-center gap-2\">\r\n                              <div className=\"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                                {item.product_image ? (\r\n                                  <img src={item.product_image} alt=\"\" className=\"w-full h-full object-cover rounded-lg\" />\r\n                                ) : (\r\n                                  <span className=\"text-xs\">üì¶</span>\r\n                                )}\r\n                              </div>\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <span className=\"text-sm text-gray-700 truncate block\">\r\n                                  {item.product_name || (language === 'ru' ? '–¢–æ–≤–∞—Ä' : 'Mahsulot')}\r\n                                </span>\r\n                              </div>\r\n                              <span className=\"text-xs text-gray-500 whitespace-nowrap\">\r\n                                {item.quantity} √ó {(item.unit_price || item.price || 0).toLocaleString()} —Å—É–º\r\n                              </span>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                        <div className=\"mt-2 pt-2 border-t border-gray-100 flex justify-between items-center\">\r\n                          <span className=\"text-sm text-gray-500\">\r\n                            {(order.items || []).reduce((sum, i) => sum + i.quantity, 0)} {language === 'ru' ? '—Ç–æ–≤–∞—Ä–æ–≤' : 'mahsulot'}\r\n                          </span>\r\n                          <span className=\"text-sm font-semibold text-orange-600\">\r\n                            {order.total_amount.toLocaleString()} —Å—É–º\r\n                          </span>\r\n                        </div>\r\n\r\n                        {/* Cancel Button */}\r\n                        {canCancel && (\r\n                          <button\r\n                            onClick={() => cancelOrder(order.id)}\r\n                            disabled={cancellingOrderId === order.id}\r\n                            className=\"mt-3 w-full py-2 px-4 bg-red-50 text-red-600 rounded-lg text-sm font-medium hover:bg-red-100 transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                          >\r\n                            {cancellingOrderId === order.id ? (\r\n                              <div className=\"w-4 h-4 border-2 border-red-300 border-t-red-600 rounded-full animate-spin\" />\r\n                            ) : (\r\n                              <XCircle className=\"w-4 h-4\" />\r\n                            )}\r\n                            {language === 'ru' ? '–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑' : 'Bekor qilish'}\r\n                          </button>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n\r\n                {/* Pagination */}\r\n                {totalOrderPages > 1 && (\r\n                  <div className=\"flex items-center justify-center gap-2 mt-4\">\r\n                    <button\r\n                      onClick={() => setOrdersPage(p => Math.max(1, p - 1))}\r\n                      disabled={ordersPage === 1}\r\n                      className=\"p-2 rounded-lg bg-white shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      <ChevronLeft className=\"w-5 h-5\" />\r\n                    </button>\r\n                    <span className=\"text-sm text-gray-600\">\r\n                      {ordersPage} / {totalOrderPages}\r\n                    </span>\r\n                    <button\r\n                      onClick={() => setOrdersPage(p => Math.min(totalOrderPages, p + 1))}\r\n                      disabled={ordersPage === totalOrderPages}\r\n                      className=\"p-2 rounded-lg bg-white shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      <ChevronRight className=\"w-5 h-5\" />\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* History Tab (Delivered/Cancelled Orders) */}\r\n        {activeTab === 'history' && (\r\n          <div>\r\n            {historyOrders.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <History className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n                <p className=\"text-gray-500 mb-4\">\r\n                  {language === 'ru' ? '–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—É—Å—Ç–∞' : 'Buyurtmalar tarixi bo\\'sh'}\r\n                </p>\r\n                <button\r\n                  onClick={() => setActiveTab('shop')}\r\n                  className=\"text-orange-600 font-medium\"\r\n                >\r\n                  {language === 'ru' ? '–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º' : 'Xaridga o\\'tish'}\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {paginatedHistoryOrders.map(order => {\r\n                  const isCancelled = order.status === 'cancelled';\r\n                  const isDelivered = order.status === 'delivered';\r\n\r\n                  return (\r\n                    <div key={order.id} className=\"glass-card overflow-hidden\">\r\n                      {/* Header */}\r\n                      <div className={`p-4 border-b ${isCancelled ? 'bg-red-50 border-red-100' : 'bg-green-50 border-green-100'}`}>\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <p className=\"font-bold text-gray-900\">\r\n                                {language === 'ru' ? '–ó–∞–∫–∞–∑' : 'Buyurtma'} #{order.order_number}\r\n                              </p>\r\n                              <span className={`text-xs px-2 py-0.5 rounded-full ${\r\n                                isCancelled ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'\r\n                              }`}>\r\n                                {isCancelled\r\n                                  ? (language === 'ru' ? '–û—Ç–º–µ–Ω—ë–Ω' : 'Bekor qilindi')\r\n                                  : (language === 'ru' ? '–î–æ—Å—Ç–∞–≤–ª–µ–Ω' : 'Yetkazildi')\r\n                                }\r\n                              </span>\r\n                            </div>\r\n                            <p className=\"text-sm text-gray-500\">\r\n                              {new Date(order.created_at).toLocaleDateString('ru-RU', {\r\n                                day: 'numeric',\r\n                                month: 'long',\r\n                                year: 'numeric'\r\n                              })}\r\n                            </p>\r\n                          </div>\r\n                          <span className=\"font-bold text-gray-700\">\r\n                            {formatPrice(order.total_amount)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Order Items List */}\r\n                      <div className=\"px-4 py-3\">\r\n                        <div className=\"space-y-2\">\r\n                          {(order.items || []).slice(0, 3).map((item, idx) => (\r\n                            <div key={item.id || idx} className=\"flex items-center gap-2\">\r\n                              <div className=\"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                                {item.product_image ? (\r\n                                  <img src={item.product_image} alt=\"\" className=\"w-full h-full object-cover rounded-lg\" />\r\n                                ) : (\r\n                                  <span className=\"text-xs\">üì¶</span>\r\n                                )}\r\n                              </div>\r\n                              <span className=\"text-sm text-gray-700 flex-1 truncate\">\r\n                                {item.product_name || (language === 'ru' ? '–¢–æ–≤–∞—Ä' : 'Mahsulot')}\r\n                              </span>\r\n                              <span className=\"text-xs text-gray-500\">√ó{item.quantity}</span>\r\n                            </div>\r\n                          ))}\r\n                          {(order.items || []).length > 3 && (\r\n                            <p className=\"text-xs text-gray-400\">\r\n                              +{(order.items || []).length - 3} {language === 'ru' ? '–µ—â—ë' : 'yana'}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Rate delivery button for delivered orders without rating */}\r\n                      {isDelivered && !order.rating && (\r\n                        <div className=\"px-4 pb-4\">\r\n                          <button\r\n                            onClick={() => {\r\n                              setRatingOrderId(order.id);\r\n                              setShowDeliveryRatingModal(true);\r\n                            }}\r\n                            className=\"w-full py-2 px-4 bg-orange-50 text-orange-600 rounded-lg text-sm font-medium hover:bg-orange-100 transition-colors flex items-center justify-center gap-2\"\r\n                          >\r\n                            <Star className=\"w-4 h-4\" />\r\n                            {language === 'ru' ? '–û—Ü–µ–Ω–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É' : 'Yetkazishni baholash'}\r\n                          </button>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Show rating if exists */}\r\n                      {isDelivered && order.rating && (\r\n                        <div className=\"px-4 pb-4\">\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {[1, 2, 3, 4, 5].map((star) => (\r\n                              <Star\r\n                                key={star}\r\n                                className={`w-4 h-4 ${star <= (order.rating || 0) ? 'text-yellow-400 fill-yellow-400' : 'text-gray-300'}`}\r\n                              />\r\n                            ))}\r\n                            <span className=\"text-sm text-gray-500 ml-2\">\r\n                              {language === 'ru' ? '–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞' : 'Sizning bahongiz'}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })}\r\n\r\n                {/* Pagination */}\r\n                {totalHistoryPages > 1 && (\r\n                  <div className=\"flex items-center justify-center gap-2 mt-4\">\r\n                    <button\r\n                      onClick={() => setHistoryPage(p => Math.max(1, p - 1))}\r\n                      disabled={historyPage === 1}\r\n                      className=\"p-2 rounded-lg bg-white shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      <ChevronLeft className=\"w-5 h-5\" />\r\n                    </button>\r\n                    <span className=\"text-sm text-gray-600\">\r\n                      {historyPage} / {totalHistoryPages}\r\n                    </span>\r\n                    <button\r\n                      onClick={() => setHistoryPage(p => Math.min(totalHistoryPages, p + 1))}\r\n                      disabled={historyPage === totalHistoryPages}\r\n                      className=\"p-2 rounded-lg bg-white shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      <ChevronRight className=\"w-5 h-5\" />\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Favorites Tab */}\r\n        {activeTab === 'favorites' && (\r\n          <div>\r\n            {favorites.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <Heart className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n                <p className=\"text-gray-500 mb-4\">\r\n                  {language === 'ru' ? '–ò–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç' : 'Sevimli mahsulotlar yo\\'q'}\r\n                </p>\r\n                <button\r\n                  onClick={() => setActiveTab('shop')}\r\n                  className=\"text-orange-600 font-medium\"\r\n                >\r\n                  {language === 'ru' ? '–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º' : 'Xaridga o\\'tish'}\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                {products.filter(p => favorites.includes(p.id)).map(product => {\r\n                  const cartQty = getCartQuantity(product.id);\r\n\r\n                  return (\r\n                    <div key={product.id} className=\"glass-card overflow-hidden\">\r\n                      <div className=\"relative aspect-square bg-gray-100 flex items-center justify-center\">\r\n                        {product.image_url ? (\r\n                          <img\r\n                            src={product.image_url}\r\n                            alt={language === 'ru' ? product.name_ru : product.name_uz}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        ) : (\r\n                          <span className=\"text-4xl\">\r\n                            {CATEGORY_ICONS[product.category_id] || 'üì¶'}\r\n                          </span>\r\n                        )}\r\n                        <button\r\n                          onClick={() => toggleFavorite(product.id)}\r\n                          className=\"absolute top-2 right-2 p-1.5 rounded-full bg-white shadow-sm\"\r\n                        >\r\n                          <Heart className=\"w-4 h-4 fill-red-500 text-red-500\" />\r\n                        </button>\r\n                      </div>\r\n                      <div className=\"p-3\">\r\n                        <h3 className=\"font-medium text-sm text-gray-900 line-clamp-2 min-h-[40px]\">\r\n                          {language === 'ru' ? product.name_ru : product.name_uz}\r\n                        </h3>\r\n                        <p className=\"font-bold text-orange-600 mt-2\">\r\n                          {formatPrice(product.price)}\r\n                        </p>\r\n                        {cartQty > 0 ? (\r\n                          <div className=\"flex items-center justify-between mt-3 bg-orange-50 rounded-lg p-1\">\r\n                            <button\r\n                              onClick={() => updateCartQuantity(product.id, cartQty - 1)}\r\n                              className=\"p-1.5 rounded-md bg-white shadow-sm\"\r\n                            >\r\n                              <Minus className=\"w-4 h-4 text-orange-600\" />\r\n                            </button>\r\n                            <span className=\"font-medium text-orange-600\">{cartQty}</span>\r\n                            <button\r\n                              onClick={() => updateCartQuantity(product.id, cartQty + 1)}\r\n                              className=\"p-1.5 rounded-md bg-white shadow-sm\"\r\n                            >\r\n                              <Plus className=\"w-4 h-4 text-orange-600\" />\r\n                            </button>\r\n                          </div>\r\n                        ) : (\r\n                          <button\r\n                            onClick={() => addToCart(product.id)}\r\n                            className=\"w-full mt-3 py-2 bg-orange-500 text-white rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors flex items-center justify-center gap-1\"\r\n                          >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>{language === 'ru' ? '–í –∫–æ—Ä–∑–∏–Ω—É' : 'Savatga'}</span>\r\n                          </button>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Product Detail Modal */}\r\n      {selectedProduct && (\r\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-end\">\r\n          <div className=\"bg-white/95 backdrop-blur-md w-full rounded-t-3xl max-h-[90vh] overflow-y-auto animate-slide-up\">\r\n            <div className=\"sticky top-0 bg-white/90 backdrop-blur-md p-4 border-b flex items-center justify-between z-10\">\r\n              <h2 className=\"font-bold text-lg\">\r\n                {language === 'ru' ? selectedProduct.name_ru : selectedProduct.name_uz}\r\n              </h2>\r\n              <button\r\n                onClick={() => setSelectedProduct(null)}\r\n                className=\"p-2 hover:bg-gray-100 rounded-full\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"p-4\">\r\n              <div className=\"aspect-square bg-gray-100 rounded-xl flex items-center justify-center mb-4\">\r\n                {selectedProduct.image_url ? (\r\n                  <img\r\n                    src={selectedProduct.image_url}\r\n                    alt=\"\"\r\n                    className=\"w-full h-full object-cover rounded-xl\"\r\n                  />\r\n                ) : (\r\n                  <span className=\"text-6xl\">\r\n                    {CATEGORY_ICONS[selectedProduct.category_id] || 'üì¶'}\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              <p className=\"text-gray-600 mb-4\">\r\n                {language === 'ru' ? selectedProduct.description_ru : selectedProduct.description_uz}\r\n              </p>\r\n\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <div>\r\n                  <p className=\"text-2xl font-bold text-orange-600\">\r\n                    {formatPrice(selectedProduct.price)}\r\n                  </p>\r\n                  {selectedProduct.old_price && (\r\n                    <p className=\"text-gray-400 line-through\">\r\n                      {formatPrice(selectedProduct.old_price)}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n                <p className=\"text-gray-500\">{selectedProduct.unit}</p>\r\n              </div>\r\n\r\n              {selectedProduct.stock_quantity > 0 ? (\r\n                <p className=\"text-green-600 text-sm mb-4\">\r\n                  {language === 'ru' ? '–í –Ω–∞–ª–∏—á–∏–∏' : 'Mavjud'}\r\n                </p>\r\n              ) : (\r\n                <p className=\"text-red-600 text-sm mb-4\">\r\n                  {language === 'ru' ? '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' : 'Mavjud emas'}\r\n                </p>\r\n              )}\r\n\r\n              <div className=\"flex gap-3\">\r\n                <button\r\n                  onClick={() => toggleFavorite(selectedProduct.id)}\r\n                  className=\"p-3 border rounded-xl\"\r\n                >\r\n                  <Heart\r\n                    className={`w-6 h-6 ${\r\n                      favorites.includes(selectedProduct.id)\r\n                        ? 'fill-red-500 text-red-500'\r\n                        : 'text-gray-400'\r\n                    }`}\r\n                  />\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    addToCart(selectedProduct.id);\r\n                    setSelectedProduct(null);\r\n                  }}\r\n                  disabled={selectedProduct.stock_quantity === 0}\r\n                  className=\"flex-1 py-3 bg-orange-500 text-white rounded-xl font-medium hover:bg-orange-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                >\r\n                  <ShoppingCart className=\"w-5 h-5\" />\r\n                  <span>{language === 'ru' ? '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É' : 'Savatga qo\\'shish'}</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Order Confirmation Modal */}\r\n      {showOrderModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\r\n          <div className=\"bg-white w-full max-w-md rounded-2xl overflow-hidden\">\r\n            <div className=\"p-4 border-b flex items-center justify-between\">\r\n              <h2 className=\"font-bold text-lg\">\r\n                {language === 'ru' ? '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞' : 'Buyurtmani rasmiylashtirish'}\r\n              </h2>\r\n              <button\r\n                onClick={() => setShowOrderModal(false)}\r\n                className=\"p-2 hover:bg-gray-100 rounded-full\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"p-4\">\r\n              <div className=\"bg-gray-50 rounded-xl p-4 mb-4\">\r\n                <p className=\"text-sm text-gray-600 mb-2\">\r\n                  {language === 'ru' ? '–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:' : 'Yetkazish manzili:'}\r\n                </p>\r\n                <p className=\"font-medium\">\r\n                  {user?.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}, {language === 'ru' ? '–∫–≤.' : 'xonadon'} {user?.apartment || '-'}\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"mb-4\">\r\n                <label className=\"block text-sm text-gray-600 mb-2\">\r\n                  {language === 'ru' ? '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É:' : 'Buyurtmaga izoh:'}\r\n                </label>\r\n                <textarea\r\n                  value={deliveryNote}\r\n                  onChange={(e) => setDeliveryNote(e.target.value)}\r\n                  placeholder={language === 'ru' ? '–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –∑–∞ 10 –º–∏–Ω—É—Ç –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏' : 'Masalan: yetkazishdan 10 daqiqa oldin qo\\'ng\\'iroq qiling'}\r\n                  className=\"w-full p-3 border rounded-xl resize-none\"\r\n                  rows={3}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"bg-orange-50 rounded-xl p-4 mb-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-gray-700\">\r\n                    {language === 'ru' ? '–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:' : 'To\\'lanishi kerak:'}\r\n                  </span>\r\n                  <span className=\"text-xl font-bold text-orange-600\">\r\n                    {formatPrice(cartTotal)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              <button\r\n                onClick={createOrder}\r\n                className=\"w-full py-4 bg-orange-500 text-white rounded-xl font-medium hover:bg-orange-600 transition-colors\"\r\n              >\r\n                {language === 'ru' ? '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑' : 'Buyurtmani tasdiqlash'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Delivery Rating Modal */}\r\n      {showDeliveryRatingModal && ratingOrderId && (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n          <div className=\"bg-white rounded-2xl w-full max-w-md overflow-hidden shadow-xl\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between p-4 border-b border-gray-100 bg-gradient-to-r from-orange-500 to-amber-500\">\r\n              <h2 className=\"text-lg font-bold text-white\">\r\n                {language === 'ru' ? '–û—Ü–µ–Ω–∏—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É' : 'Yetkazishni baholang'}\r\n              </h2>\r\n              <button\r\n                onClick={() => {\r\n                  setShowDeliveryRatingModal(false);\r\n                  setRatingOrderId(null);\r\n                  setDeliveryRating(5);\r\n                  setDeliveryReview('');\r\n                }}\r\n                className=\"p-2 hover:bg-white/20 rounded-full transition-colors\"\r\n              >\r\n                <X className=\"w-5 h-5 text-white\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"p-6\">\r\n              {/* Order Info */}\r\n              <div className=\"bg-orange-50 rounded-xl p-4 mb-6\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center\">\r\n                    <ShoppingBag className=\"w-6 h-6 text-orange-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-sm text-gray-500\">\r\n                      {language === 'ru' ? '–ó–∞–∫–∞–∑' : 'Buyurtma'}\r\n                    </div>\r\n                    <div className=\"font-semibold text-gray-900\">\r\n                      #{orders.find(o => o.id === ratingOrderId)?.order_number || ''}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Star Rating */}\r\n              <div className=\"text-center mb-6\">\r\n                <p className=\"text-sm text-gray-600 mb-4\">\r\n                  {language === 'ru' ? '–ö–∞–∫ –≤–∞–º –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞–≤–∫–∏?' : 'Yetkazish sifati qanday edi?'}\r\n                </p>\r\n                <div className=\"flex justify-center gap-2 mb-2\">\r\n                  {[1, 2, 3, 4, 5].map((star) => (\r\n                    <button\r\n                      key={star}\r\n                      onClick={() => setDeliveryRating(star)}\r\n                      className=\"p-1 active:scale-90 transition-transform touch-manipulation\"\r\n                    >\r\n                      <Star\r\n                        className={`w-10 h-10 ${\r\n                          star <= deliveryRating\r\n                            ? 'text-yellow-400 fill-yellow-400'\r\n                            : 'text-gray-300'\r\n                        }`}\r\n                      />\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n                <div className=\"text-sm font-medium text-gray-700\">\r\n                  {deliveryRating === 5 && (language === 'ru' ? '–û—Ç–ª–∏—á–Ω–æ!' : 'Ajoyib!')}\r\n                  {deliveryRating === 4 && (language === 'ru' ? '–•–æ—Ä–æ—à–æ' : 'Yaxshi')}\r\n                  {deliveryRating === 3 && (language === 'ru' ? '–ù–æ—Ä–º–∞–ª—å–Ω–æ' : 'O\\'rtacha')}\r\n                  {deliveryRating === 2 && (language === 'ru' ? '–ü–ª–æ—Ö–æ' : 'Yomon')}\r\n                  {deliveryRating === 1 && (language === 'ru' ? '–û—á–µ–Ω—å –ø–ª–æ—Ö–æ' : 'Juda yomon')}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Review textarea */}\r\n              <div className=\"mb-6\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {language === 'ru' ? '–û—Ç–∑—ã–≤ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)' : 'Sharh (ixtiyoriy)'}\r\n                </label>\r\n                <textarea\r\n                  value={deliveryReview}\r\n                  onChange={(e) => setDeliveryReview(e.target.value)}\r\n                  placeholder={language === 'ru' ? '–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤ –æ –¥–æ—Å—Ç–∞–≤–∫–µ...' : 'Yetkazish haqida sharh yozing...'}\r\n                  className=\"w-full px-4 py-3 border border-gray-200 rounded-xl resize-none focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n                  rows={3}\r\n                />\r\n              </div>\r\n\r\n              {/* Submit button */}\r\n              <button\r\n                onClick={submitDeliveryRating}\r\n                disabled={isSubmittingRating}\r\n                className=\"w-full py-4 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-xl font-semibold hover:from-orange-600 hover:to-amber-600 transition-all disabled:opacity-50 flex items-center justify-center gap-2\"\r\n              >\r\n                {isSubmittingRating ? (\r\n                  <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                ) : (\r\n                  <>\r\n                    <CheckCircle className=\"w-5 h-5\" />\r\n                    {language === 'ru' ? '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É' : 'Bahoni yuborish'}\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ORDER_STAGES","ShoppingBag","CheckCircle","Package","User","getOrderStageIndex","status","i","getOrderStatusMessage","language","CATEGORY_ICONS","MarketplacePage","user","useAuthStore","useLanguageStore","activeTab","setActiveTab","useState","categories","setCategories","products","setProducts","cart","setCart","orders","setOrders","favorites","setFavorites","selectedCategory","setSelectedCategory","searchQuery","setSearchQuery","loading","setLoading","selectedProduct","setSelectedProduct","showOrderModal","setShowOrderModal","deliveryNote","setDeliveryNote","orderSuccess","setOrderSuccess","cancellingOrderId","setCancellingOrderId","productsPage","setProductsPage","ordersPage","setOrdersPage","historyPage","setHistoryPage","ITEMS_PER_PAGE","showDeliveryRatingModal","setShowDeliveryRatingModal","ratingOrderId","setRatingOrderId","deliveryRating","setDeliveryRating","deliveryReview","setDeliveryReview","isSubmittingRating","setIsSubmittingRating","fetchData","useCallback","categoriesRes","productsRes","apiRequest","cartRes","ordersRes","favoritesRes","f","useEffect","o","interval","handleOpenDeliveryRatingModal","event","orderId","order","pendingOrderId","addToCart","productId","quantity","updateCartQuantity","removeFromCart","toggleFavorite","isFavorite","id","createOrder","submitDeliveryRating","cancelOrder","filteredProducts","p","matchesCategory","matchesSearch","getCartQuantity","c","cartTotal","sum","item","product","formatPrice","price","activeOrders","historyOrders","paginatedProducts","totalProductPages","paginatedActiveOrders","totalOrderPages","paginatedHistoryOrders","totalHistoryPages","tabs","ShoppingCart","History","Heart","jsx","jsxs","tab","Search","e","cat","cartQty","Minus","Plus","ChevronLeft","ChevronRight","Fragment","Trash2","currentStageIndex","statusMessage","canCancel","stage","index","isCompleted","isCurrent","StageIcon","idx","XCircle","isCancelled","isDelivered","Star","star","X"],"mappings":"iZA6EA,MAAMA,EAAe,CACnB,CACE,GAAI,UACJ,SAAU,CAAC,KAAK,EAChB,QAAS,QACT,QAAS,QACT,KAAMC,GACN,OAAQ,iBACR,OAAQ,oBAAA,EAEV,CACE,GAAI,YACJ,SAAU,CAAC,WAAW,EACtB,QAAS,WACT,QAAS,cACT,KAAMC,EACN,OAAQ,oBACR,OAAQ,sBAAA,EAEV,CACE,GAAI,YACJ,SAAU,CAAC,WAAW,EACtB,QAAS,aACT,QAAS,cACT,KAAMC,EACN,OAAQ,iBACR,OAAQ,sBAAA,EAEV,CACE,GAAI,aACJ,SAAU,CAAC,YAAY,EACvB,QAAS,eACT,QAAS,gBACT,KAAMC,GACN,OAAQ,eACR,OAAQ,cAAA,EAEV,CACE,GAAI,QACJ,SAAU,CAAC,OAAO,EAClB,QAAS,QACT,QAAS,SACT,KAAMF,EACN,OAAQ,oBACR,OAAQ,uBAAA,EAEV,CACE,GAAI,YACJ,SAAU,CAAC,WAAW,EACtB,QAAS,UACT,QAAS,gBACT,KAAMA,EACN,OAAQ,kBACR,OAAQ,qBAAA,CAEZ,EAEA,SAASG,GAAmBC,EAAwC,CAClE,GAAIA,IAAW,YAAa,MAAO,GACnC,QAASC,EAAI,EAAGA,EAAIP,EAAa,OAAQO,IACvC,GAAIP,EAAaO,CAAC,EAAE,SAAS,SAASD,CAAM,EAC1C,OAAOC,EAGX,MAAO,EACT,CAEA,SAASC,GAAsBF,EAAgCG,EAA4D,CACzH,OAAQH,EAAA,CACN,IAAK,MACH,MAAO,CACL,MAAOG,IAAa,KAAO,iBAAmB,qBAC9C,SAAUA,IAAa,KAAO,wBAA0B,6BAAA,EAE5D,IAAK,YACH,MAAO,CACL,MAAOA,IAAa,KAAO,eAAiB,yBAC5C,SAAUA,IAAa,KAAO,kBAAoB,sBAAA,EAEtD,IAAK,YACH,MAAO,CACL,MAAOA,IAAa,KAAO,iBAAmB,uBAC9C,SAAUA,IAAa,KAAO,oBAAsB,0BAAA,EAExD,IAAK,QACH,MAAO,CACL,MAAOA,IAAa,KAAO,cAAgB,kBAC3C,SAAUA,IAAa,KAAO,mBAAqB,yBAAA,EAEvD,IAAK,aACH,MAAO,CACL,MAAOA,IAAa,KAAO,gBAAkB,gBAC7C,SAAUA,IAAa,KAAO,oBAAsB,yBAAA,EAExD,IAAK,YACH,MAAO,CACL,MAAOA,IAAa,KAAO,kBAAoB,sBAC/C,SAAUA,IAAa,KAAO,sBAAwB,kBAAA,EAE1D,IAAK,YACH,MAAO,CACL,MAAOA,IAAa,KAAO,gBAAkB,yBAC7C,SAA8B,EAAK,EAEvC,QACE,MAAO,CAAE,MAAO,GAAI,SAAU,EAAA,CAAG,CAEvC,CAEA,MAAMC,EAAyC,CAC7C,cAAe,KACf,UAAW,KACX,SAAU,KACV,WAAY,KACZ,WAAY,KACZ,cAAe,KACf,cAAe,KACf,aAAc,KACd,SAAU,KACV,SAAU,KACV,WAAY,KACZ,WAAY,IACd,EAEO,SAASC,IAAkB,CAChC,KAAM,CAAE,KAAAC,CAAA,EAASC,GAAA,EACX,CAAE,SAAAJ,CAAA,EAAaK,GAAA,EAEf,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAA+D,MAAM,EACjG,CAACC,GAAYC,EAAa,EAAIF,EAAAA,SAAmC,CAAA,CAAE,EACnE,CAACG,EAAUC,EAAW,EAAIJ,EAAAA,SAAkC,CAAA,CAAE,EAC9D,CAACK,EAAMC,CAAO,EAAIN,EAAAA,SAAmC,CAAA,CAAE,EACvD,CAACO,EAAQC,CAAS,EAAIR,EAAAA,SAAgC,CAAA,CAAE,EACxD,CAACS,EAAWC,CAAY,EAAIV,EAAAA,SAAmB,CAAA,CAAE,EACjD,CAACW,EAAkBC,EAAmB,EAAIZ,EAAAA,SAAwB,IAAI,EACtE,CAACa,EAAaC,EAAc,EAAId,EAAAA,SAAS,EAAE,EAC3C,CAACe,GAASC,EAAU,EAAIhB,EAAAA,SAAS,EAAI,EACrC,CAACiB,EAAiBC,CAAkB,EAAIlB,EAAAA,SAAuC,IAAI,EACnF,CAACmB,GAAgBC,CAAiB,EAAIpB,EAAAA,SAAS,EAAK,EACpD,CAACqB,GAAcC,EAAe,EAAItB,EAAAA,SAAS,EAAE,EAC7C,CAACuB,GAAcC,EAAe,EAAIxB,EAAAA,SAAS,EAAK,EAChD,CAACyB,GAAmBC,EAAoB,EAAI1B,EAAAA,SAAwB,IAAI,EAGxE,CAAC2B,EAAcC,EAAe,EAAI5B,EAAAA,SAAS,CAAC,EAC5C,CAAC6B,EAAYC,EAAa,EAAI9B,EAAAA,SAAS,CAAC,EACxC,CAAC+B,EAAaC,EAAc,EAAIhC,EAAAA,SAAS,CAAC,EAC1CiC,EAAiB,GAGjB,CAACC,GAAyBC,CAA0B,EAAInC,EAAAA,SAAS,EAAK,EACtE,CAACoC,EAAeC,CAAgB,EAAIrC,EAAAA,SAAwB,IAAI,EAChE,CAACsC,EAAgBC,CAAiB,EAAIvC,EAAAA,SAAS,CAAC,EAChD,CAACwC,GAAgBC,CAAiB,EAAIzC,EAAAA,SAAS,EAAE,EACjD,CAAC0C,GAAoBC,EAAqB,EAAI3C,EAAAA,SAAS,EAAK,EAG5D4C,GAAYC,EAAAA,YAAY,SAAY,CACxC,GAAI,CACF7B,GAAW,EAAI,EAGf,KAAM,CAAC8B,EAAeC,CAAW,EAAI,MAAM,QAAQ,IAAI,CACrDC,EAAqD,6BAA6B,EAClFA,EAAiE,2BAA2B,CAAA,CAC7F,EAMD,GAJA9C,GAAc4C,GAAe,YAAc,EAAE,EAC7C1C,GAAY2C,GAAa,UAAY,EAAE,EAGnCpD,EACF,GAAI,CACF,KAAM,CAACsD,EAASC,EAAWC,CAAY,EAAI,MAAM,QAAQ,IAAI,CAC3DH,EAAkF,uBAAuB,EACzGA,EAA8C,yBAAyB,EACvEA,EAA4C,4BAA4B,CAAA,CACzE,EACD1C,EAAQ2C,GAAS,MAAQ,EAAE,EAC3BzC,EAAU0C,GAAW,QAAU,EAAE,EACjCxC,GAAcyC,GAAc,WAAa,CAAA,GAAI,IAAIC,GAAKA,EAAE,EAAE,CAAC,CAC7D,MAAc,CAEd,CAEJ,MAAgB,CAEhB,QAAA,CACEpC,GAAW,EAAK,CAClB,CACF,EAAG,CAACrB,CAAI,CAAC,EAET0D,EAAAA,UAAU,IAAM,CACdT,GAAA,CACF,EAAG,CAACA,EAAS,CAAC,EAGdS,EAAAA,UAAU,IAAM,CAId,GAHI,CAAC1D,GAGD,CADoBY,EAAO,KAAK+C,GAAK,CAAC,CAAC,YAAa,WAAW,EAAE,SAASA,EAAE,MAAM,CAAC,EACjE,OActB,MAAMC,EAAW,YAZQ,SAAY,CACnC,GAAI,CACF,MAAML,EAAY,MAAMF,EAA8C,yBAAyB,EAC3FE,GAAW,QACb1C,EAAU0C,EAAU,MAAM,CAE9B,MAAc,CAEd,CACF,EAG+C,GAAK,EAEpD,MAAO,IAAM,cAAcK,CAAQ,CACrC,EAAG,CAAC5D,EAAMY,EAAO,OAAS,GAAKA,EAAO,KAAK+C,GAAK,CAAC,CAAC,YAAa,WAAW,EAAE,SAASA,EAAE,MAAM,CAAC,CAAC,CAAC,EAGhGD,EAAAA,UAAU,IAAM,CACd,MAAMG,EAAiCC,GAA4C,CACjF,KAAM,CAAE,QAAAC,GAAYD,EAAM,OACpBE,EAAQpD,EAAO,KAAK+C,GAAKA,EAAE,KAAOI,CAAO,EAC3CC,GAASA,EAAM,SAAW,cAC5BtB,EAAiBqB,CAAO,EACxBvB,EAA2B,EAAI,EAC/B,eAAe,WAAW,gCAAgC,EAE9D,EAEA,cAAO,iBAAiB,0BAA2BqB,CAA8C,EAC1F,IAAM,CACX,OAAO,oBAAoB,0BAA2BA,CAA8C,CACtG,CACF,EAAG,CAACjD,CAAM,CAAC,EAGX8C,EAAAA,UAAU,IAAM,CACd,GAAI9C,EAAO,SAAW,EAAG,OAEzB,MAAMqD,EAAiB,eAAe,QAAQ,gCAAgC,EAC9E,GAAIA,EAAgB,CAClB,MAAMD,EAAQpD,EAAO,KAAK+C,GAAKA,EAAE,KAAOM,CAAc,EAClDD,GAASA,EAAM,SAAW,cAC5BtB,EAAiBuB,CAAc,EAC/BzB,EAA2B,EAAI,EAC/B,eAAe,WAAW,gCAAgC,EAE9D,CACF,EAAG,CAAC5B,CAAM,CAAC,EAGX,MAAMsD,EAAY,MAAOC,EAAmBC,EAAmB,IAAM,CACnE,GAAI,CACF,MAAMf,EAAW,wBAAyB,CACxC,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,WAAYc,EAAW,SAAAC,EAAU,CAAA,CACzD,EACD,MAAMd,EAAU,MAAMD,EAA+C,uBAAuB,EAC5F1C,EAAQ2C,GAAS,MAAQ,EAAE,CAC7B,MAAgB,CAEhB,CACF,EAGMe,EAAqB,MAAOF,EAAmBC,IAAqB,CACxE,GAAIA,GAAY,EAAG,CACjB,MAAME,GAAeH,CAAS,EAC9B,MACF,CACA,GAAI,CACF,MAAMd,EAAW,wBAAyB,CACxC,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,WAAYc,EAAW,SAAAC,EAAU,CAAA,CACzD,EACD,MAAMd,EAAU,MAAMD,EAA+C,uBAAuB,EAC5F1C,EAAQ2C,GAAS,MAAQ,EAAE,CAC7B,MAAgB,CAEhB,CACF,EAGMgB,GAAiB,MAAOH,GAAsB,CAClD,GAAI,CACF,MAAMd,EAAW,yBAAyBc,CAAS,GAAI,CAAE,OAAQ,SAAU,EAC3E,MAAMb,EAAU,MAAMD,EAA+C,uBAAuB,EAC5F1C,EAAQ2C,GAAS,MAAQ,EAAE,CAC7B,MAAgB,CAEhB,CACF,EAGMiB,EAAiB,MAAOJ,GAAsB,CAElD,MAAMK,EAAa1D,EAAU,SAASqD,CAAS,EAE7CpD,EADEyD,EACW1D,EAAU,OAAO2D,GAAMA,IAAON,CAAS,EAEvC,CAAC,GAAGrD,EAAWqD,CAAS,CAFgB,EAKvD,GAAI,CACF,MAAMd,EAAW,8BAA8Bc,CAAS,GAAI,CAAE,OAAQ,OAAQ,CAChF,MAAgB,CAIZpD,EADEyD,EACW,CAAC,GAAG1D,EAAWqD,CAAS,EAExBrD,EAAU,OAAO2D,GAAMA,IAAON,CAAS,CAFd,CAI1C,CACF,EAGMO,GAAc,SAAY,CAC9B,GAAI,CACF,MAAMrB,EAAW,0BAA2B,CAC1C,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,eAAgB3B,GAAc,CAAA,CACtD,EACDG,GAAgB,EAAI,EACpBJ,EAAkB,EAAK,EACvBE,GAAgB,EAAE,EAElB,KAAM,CAAC2B,EAASC,CAAS,EAAI,MAAM,QAAQ,IAAI,CAC7CF,EAA+C,uBAAuB,EACtEA,EAA8C,yBAAyB,CAAA,CACxE,EACD1C,EAAQ2C,GAAS,MAAQ,EAAE,EAC3BzC,EAAU0C,GAAW,QAAU,EAAE,EACjC,WAAW,IAAM,CACf1B,GAAgB,EAAK,EACrBzB,EAAa,QAAQ,CACvB,EAAG,GAAI,CACT,MAAgB,CAEhB,CACF,EAGMuE,GAAuB,SAAY,CACvC,GAAKlC,EAEL,GAAI,CACFO,GAAsB,EAAI,EAC1B,MAAMK,EAAW,2BAA2BZ,CAAa,QAAS,CAChE,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAQE,EAAgB,OAAQE,IAAkB,MAAA,CAAW,CAAA,CACrF,EAGD,MAAMU,EAAY,MAAMF,EAA8C,yBAAyB,EAC/FxC,EAAU0C,GAAW,QAAU,EAAE,EAGjCf,EAA2B,EAAK,EAChCE,EAAiB,IAAI,EACrBE,EAAkB,CAAC,EACnBE,EAAkB,EAAE,CACtB,MAAgB,CAEhB,QAAA,CACEE,GAAsB,EAAK,CAC7B,CACF,EAGM4B,GAAc,MAAOb,GAAoB,CAC7C,GAAK,QAAQlE,IAAa,KAAO,yCAA2C,kCAAkC,EAG9G,GAAI,CACFkC,GAAqBgC,CAAO,EAC5B,MAAMV,EAAW,2BAA2BU,CAAO,UAAW,CAC5D,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAQ,yBAA0B,CAAA,CAC1D,EAED,MAAMR,EAAY,MAAMF,EAA8C,yBAAyB,EAC/FxC,EAAU0C,GAAW,QAAU,EAAE,CACnC,MAAgB,CAEd,MAAM1D,IAAa,KAAO,uBAAyB,gCAAgC,CACrF,QAAA,CACEkC,GAAqB,IAAI,CAC3B,CACF,EAGM8C,EAAmBrE,EAAS,OAAOsE,GAAK,CAC5C,MAAMC,EAAkB,CAAC/D,GAAoB8D,EAAE,cAAgB9D,EACzDgE,EAAgB,CAAC9D,IACpBrB,IAAa,KAAOiF,EAAE,QAAUA,EAAE,SAAS,YAAA,EAAc,SAAS5D,EAAY,aAAa,EAC9F,OAAO6D,GAAmBC,CAC5B,CAAC,EAGKC,GAAmBd,GACVzD,EAAK,KAAKwE,GAAKA,EAAE,aAAef,CAAS,GACzC,UAAY,EAIrBgB,GAAYzE,EAAK,OAAO,CAAC0E,EAAKC,IAAS,CAC3C,MAAMC,EAAU9E,EAAS,QAAUsE,EAAE,KAAOO,EAAK,UAAU,EAC3D,OAAOD,GAAOE,GAAS,OAAS,GAAKD,EAAK,QAC5C,EAAG,CAAC,EAEEE,EAAeC,GACZ,IAAI,KAAK,aAAa,OAAO,EAAE,OAAOA,CAAK,EAAI,OAIlDC,EAAe7E,EAAO,OAAO+C,GAAK,CAAC,CAAC,YAAa,WAAW,EAAE,SAASA,EAAE,MAAM,CAAC,EAChF+B,EAAgB9E,EAAO,OAAO+C,GAAK,CAAC,YAAa,WAAW,EAAE,SAASA,EAAE,MAAM,CAAC,EAGhFgC,GAAoBd,EAAiB,OAAO7C,EAAe,GAAKM,EAAgBN,EAAeM,CAAc,EAC7GsD,EAAoB,KAAK,KAAKf,EAAiB,OAASvC,CAAc,EAGtEuD,GAAwBJ,EAAa,OAAOvD,EAAa,GAAKI,EAAgBJ,EAAaI,CAAc,EACzGwD,EAAkB,KAAK,KAAKL,EAAa,OAASnD,CAAc,EAGhEyD,GAAyBL,EAAc,OAAOtD,EAAc,GAAKE,EAAgBF,EAAcE,CAAc,EAC7G0D,EAAoB,KAAK,KAAKN,EAAc,OAASpD,CAAc,EAEnE2D,GAAO,CACX,CAAE,GAAI,OAAiB,MAAOpG,IAAa,KAAO,UAAY,SAAW,WAAYA,IAAa,KAAO,SAAW,SAAW,KAAMR,EAAA,EACrI,CAAE,GAAI,OAAiB,MAAOQ,IAAa,KAAO,UAAY,QAAS,WAAYA,IAAa,KAAO,UAAY,QAAS,KAAMqG,EAAc,MAAOxF,EAAK,MAAA,EAC5J,CAAE,GAAI,SAAmB,MAAOb,IAAa,KAAO,WAAa,OAAQ,WAAYA,IAAa,KAAO,SAAW,OAAQ,KAAMN,EAAS,MAAOkG,EAAa,MAAA,EAC/J,CAAE,GAAI,UAAoB,MAAO5F,IAAa,KAAO,UAAY,QAAS,WAAYA,IAAa,KAAO,SAAW,QAAS,KAAMsG,EAAA,EACpI,CAAE,GAAI,YAAsB,MAAOtG,IAAa,KAAO,YAAc,aAAc,WAAYA,IAAa,KAAO,QAAU,SAAU,KAAMuG,EAAO,MAAOtF,EAAU,MAAA,CAAO,EAG9K,OAAIM,GAEAiF,MAAC,OAAI,UAAU,wCACb,eAAC,MAAA,CAAI,UAAU,iFAAiF,CAAA,CAClG,EAKFC,EAAAA,KAAC,MAAA,CAAI,UAAU,uCAEZ,SAAA,CAAA1E,IACC0E,EAAAA,KAAC,MAAA,CAAI,UAAU,sIACb,SAAA,CAAAD,EAAAA,IAAC/G,EAAA,CAAY,UAAU,SAAA,CAAU,EACjC+G,EAAAA,IAAC,OAAA,CAAM,SAAAxG,IAAa,KAAO,wBAA0B,oCAAA,CAAqC,CAAA,EAC5F,EAIFwG,EAAAA,IAAC,MAAA,CAAI,UAAU,+BACb,SAAAA,EAAAA,IAAC,OAAI,UAAU,OACZ,SAAAJ,GAAK,IAAIM,GACRD,EAAAA,KAAC,SAAA,CAEC,QAAS,IAAMlG,EAAamG,EAAI,EAAE,EAClC,UAAW,yGACTpG,IAAcoG,EAAI,GACd,oDACA,sDACN,GAEA,SAAA,CAAAF,EAAAA,IAACE,EAAI,KAAJ,CAAS,UAAU,uBAAA,CAAwB,QAC3C,OAAA,CAAK,UAAU,mDAAoD,SAAAA,EAAI,YAAcA,EAAI,MAAM,EAC/FA,EAAI,QAAU,QAAaA,EAAI,MAAQ,GACtCF,EAAAA,IAAC,OAAA,CAAK,UAAU,oFACb,SAAAE,EAAI,KAAA,CACP,CAAA,CAAA,EAbGA,EAAI,EAAA,CAgBZ,EACH,CAAA,CACF,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,YAEZ,SAAA,CAAAnG,IAAc,eACZ,MAAA,CAEC,SAAA,CAAAmG,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAD,EAAAA,IAACG,GAAA,CAAO,UAAU,0EAAA,CAA2E,EAC7FH,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,YAAaxG,IAAa,KAAO,mBAAqB,uBACtD,MAAOqB,EACP,SAAWuF,GAAMtF,GAAesF,EAAE,OAAO,KAAK,EAC9C,UAAU,qHAAA,CAAA,CACZ,EACF,EAGAH,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,QAAS,IAAMrF,GAAoB,IAAI,EACvC,UAAW,2EACRD,EAEG,6CADA,oCAEN,GAEA,SAAA,CAAAqF,EAAAA,IAAC,OAAA,CAAK,UAAU,gBAAgB,SAAA,KAAE,QACjC,OAAA,CAAK,UAAU,kCAAmC,SAAAxG,IAAa,KAAO,MAAQ,SAAA,CAAU,CAAA,CAAA,CAAA,EAE1FS,GAAW,IAAIoG,GACdJ,EAAAA,KAAC,SAAA,CAEC,QAAS,IAAMrF,GAAoByF,EAAI,EAAE,EACzC,UAAW,2EACT1F,IAAqB0F,EAAI,GACrB,qCACA,4CACN,GAEA,SAAA,CAAAL,EAAAA,IAAC,QAAK,UAAU,gBAAiB,WAAeK,EAAI,EAAE,GAAK,KAAK,EAChEL,EAAAA,IAAC,QAAK,UAAU,+CAAgD,aAAa,KAAOK,EAAI,QAAUA,EAAI,OAAA,CAAQ,CAAA,CAAA,EATzGA,EAAI,EAAA,CAWZ,CAAA,EACH,QAGC,MAAA,CAAI,UAAU,yBACZ,SAAAf,GAAkB,IAAIL,GAAW,CAChC,MAAMqB,EAAU1B,GAAgBK,EAAQ,EAAE,EACpCd,EAAa1D,EAAU,SAASwE,EAAQ,EAAE,EAEhD,OACEgB,EAAAA,KAAC,MAAA,CAEC,UAAU,6BAGV,SAAA,CAAAA,EAAAA,KAAC,MAAA,CACC,UAAU,qFACV,QAAS,IAAM/E,EAAmB+D,CAAO,EAExC,SAAA,CAAAA,EAAQ,UACPe,EAAAA,IAAC,MAAA,CACC,IAAKf,EAAQ,UACb,IAAKzF,IAAa,KAAOyF,EAAQ,QAAUA,EAAQ,QACnD,UAAU,4BAAA,CAAA,QAGX,OAAA,CAAK,UAAU,WACb,SAAAxF,EAAewF,EAAQ,WAAW,GAAK,IAAA,CAC1C,EAGFe,EAAAA,IAAC,SAAA,CACC,QAAUI,GAAM,CACdA,EAAE,gBAAA,EACFlC,EAAee,EAAQ,EAAE,CAC3B,EACA,UAAU,+DAEV,SAAAe,EAAAA,IAACD,EAAA,CACC,UAAW,WAAW5B,EAAa,4BAA8B,eAAe,EAAA,CAAA,CAClF,CAAA,EAGDc,EAAQ,aACPe,MAAC,MAAA,CAAI,UAAU,kFACZ,SAAAxG,IAAa,KAAO,MAAQ,KAAA,CAC/B,CAAA,CAAA,CAAA,EAKJyG,EAAAA,KAAC,MAAA,CAAI,UAAU,MACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,8DACX,SAAAxG,IAAa,KAAOyF,EAAQ,QAAUA,EAAQ,OAAA,CACjD,EACAe,EAAAA,IAAC,IAAA,CAAE,UAAU,6BAA8B,WAAQ,KAAK,QAEvD,IAAA,CAAE,UAAW,gBACZf,EAAQ,iBAAmB,EACvB,eACAA,EAAQ,gBAAkB,EACxB,iBACA,gBACR,GACG,SAAAA,EAAQ,iBAAmB,EACvBzF,IAAa,KAAO,gBAAkB,cACtCA,IAAa,KACV,cAAcyF,EAAQ,cAAc,IAAIA,EAAQ,IAAI,GACpD,WAAWA,EAAQ,cAAc,IAAIA,EAAQ,IAAI,GAE3D,EACAe,MAAC,MAAA,CAAI,UAAU,yCACb,gBAAC,MAAA,CACC,SAAA,CAAAA,MAAC,KAAE,UAAU,4BACV,SAAAd,EAAYD,EAAQ,KAAK,EAC5B,EACCA,EAAQ,WACPe,MAAC,IAAA,CAAE,UAAU,qCACV,SAAAd,EAAYD,EAAQ,SAAS,CAAA,CAChC,CAAA,CAAA,CAEJ,CAAA,CACF,EAGCqB,EAAU,EACTL,OAAC,MAAA,CAAI,UAAU,qEACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhC,EAAmBiB,EAAQ,GAAIqB,EAAU,CAAC,EACzD,UAAU,sCAEV,SAAAN,EAAAA,IAACO,EAAA,CAAM,UAAU,yBAAA,CAA0B,CAAA,CAAA,EAE7CP,EAAAA,IAAC,OAAA,CAAK,UAAU,8BAA+B,SAAAM,EAAQ,EACvDN,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhC,EAAmBiB,EAAQ,GAAIqB,EAAU,CAAC,EACzD,UAAU,sCAEV,SAAAN,EAAAA,IAACQ,EAAA,CAAK,UAAU,yBAAA,CAA0B,CAAA,CAAA,CAC5C,CAAA,CACF,EAEAP,EAAAA,KAAC,SAAA,CACC,QAAS,IAAMpC,EAAUoB,EAAQ,EAAE,EACnC,SAAUA,EAAQ,iBAAmB,EACrC,UAAW,4GACTA,EAAQ,iBAAmB,EACvB,+CACA,8CACN,GAEA,SAAA,CAAAe,EAAAA,IAACQ,EAAA,CAAK,UAAU,SAAA,CAAU,EAC1BR,EAAAA,IAAC,OAAA,CAAM,SAAAf,EAAQ,iBAAmB,EAC7BzF,IAAa,KAAO,gBAAkB,cACtCA,IAAa,KAAO,YAAc,SAAA,CACtC,CAAA,CAAA,CAAA,CACH,CAAA,CAEJ,CAAA,CAAA,EA3GKyF,EAAQ,EAAA,CA8GnB,CAAC,CAAA,CACH,EAECT,EAAiB,SAAW,GAC3ByB,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAD,EAAAA,IAAC9G,EAAA,CAAQ,UAAU,sCAAA,CAAuC,QACzD,IAAA,CAAE,UAAU,gBACV,SAAAM,IAAa,KAAO,oBAAsB,uBAAA,CAC7C,CAAA,EACF,EAID+F,EAAoB,GACnBU,OAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMpE,GAAgB6C,GAAK,KAAK,IAAI,EAAGA,EAAI,CAAC,CAAC,EACtD,SAAU9C,IAAiB,EAC3B,UAAU,oFAEV,SAAAqE,EAAAA,IAACS,EAAA,CAAY,UAAU,SAAA,CAAU,CAAA,CAAA,EAEnCR,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACb,SAAA,CAAAtE,EAAa,MAAI4D,CAAA,EACpB,EACAS,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMpE,GAAgB6C,GAAK,KAAK,IAAIc,EAAmBd,EAAI,CAAC,CAAC,EACtE,SAAU9C,IAAiB4D,EAC3B,UAAU,oFAEV,SAAAS,EAAAA,IAACU,GAAA,CAAa,UAAU,SAAA,CAAU,CAAA,CAAA,CACpC,CAAA,CACF,CAAA,EAEJ,EAID5G,IAAc,QACbkG,EAAAA,IAAC,MAAA,CACE,SAAA3F,EAAK,SAAW,EACf4F,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAD,EAAAA,IAACH,EAAA,CAAa,UAAU,sCAAA,CAAuC,QAC9D,IAAA,CAAE,UAAU,qBACV,SAAArG,IAAa,KAAO,gBAAkB,cACzC,EACAwG,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMjG,EAAa,MAAM,EAClC,UAAU,8BAET,SAAAP,IAAa,KAAO,qBAAuB,gBAAA,CAAA,CAC9C,CAAA,CACF,EAEAyG,EAAAA,KAAAU,EAAAA,SAAA,CACE,SAAA,CAAAX,MAAC,MAAA,CAAI,UAAU,iBACZ,SAAA3F,EAAK,IAAI2E,GAAQ,CAChB,MAAMC,EAAU9E,EAAS,QAAUsE,EAAE,KAAOO,EAAK,UAAU,EAC3D,OAAKC,EAGHgB,EAAAA,KAAC,MAAA,CAAkB,UAAU,4BAC3B,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,kFACZ,SAAAf,EAAQ,UACPe,EAAAA,IAAC,MAAA,CACC,IAAKf,EAAQ,UACb,IAAI,GACJ,UAAU,uCAAA,CAAA,EAGZe,MAAC,OAAA,CAAK,UAAU,WACb,WAAef,EAAQ,WAAW,GAAK,IAAA,CAC1C,CAAA,CAEJ,EACAgB,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,yCACX,SAAAxG,IAAa,KAAOyF,EAAQ,QAAUA,EAAQ,OAAA,CACjD,EACAe,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAyB,WAAQ,KAAK,EACnDA,EAAAA,IAAC,KAAE,UAAU,iCACV,WAAYf,EAAQ,MAAQD,EAAK,QAAQ,CAAA,CAC5C,CAAA,EACF,EACAiB,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM/B,GAAegB,EAAQ,EAAE,EACxC,UAAU,uCAEV,SAAAe,EAAAA,IAACY,GAAA,CAAO,UAAU,SAAA,CAAU,CAAA,CAAA,EAE9BX,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhC,EAAmBiB,EAAQ,GAAID,EAAK,SAAW,CAAC,EAC/D,UAAU,iCAEV,SAAAgB,EAAAA,IAACO,EAAA,CAAM,UAAU,SAAA,CAAU,CAAA,CAAA,EAE7BP,EAAAA,IAAC,OAAA,CAAK,UAAU,sCAAuC,WAAK,SAAS,EACrEA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhC,EAAmBiB,EAAQ,GAAID,EAAK,SAAW,CAAC,EAC/D,UAAU,iCAEV,SAAAgB,EAAAA,IAACQ,EAAA,CAAK,UAAU,SAAA,CAAU,CAAA,CAAA,CAC5B,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,EA7CQxB,EAAK,EA8Cf,EAjDmB,IAmDvB,CAAC,CAAA,CACH,EAGAiB,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAD,MAAC,QAAK,UAAU,gBACb,SAAAxG,IAAa,KAAO,WAAa,eACpC,EACAyG,EAAAA,KAAC,OAAA,CAAK,UAAU,cAAe,SAAA,CAAA5F,EAAK,OAAO,CAAC0E,EAAKzF,IAAMyF,EAAMzF,EAAE,SAAU,CAAC,EAAE,KAAA,CAAA,CAAG,CAAA,EACjF,EACA2G,EAAAA,KAAC,MAAA,CAAI,UAAU,sDACb,SAAA,CAAAD,EAAAA,IAAC,OAAA,CAAM,SAAAxG,IAAa,KAAO,SAAW,QAAQ,QAC7C,OAAA,CAAK,UAAU,kBAAmB,SAAA0F,EAAYJ,EAAS,CAAA,CAAE,CAAA,CAAA,CAC5D,CAAA,EACF,EAEAkB,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM5E,EAAkB,EAAI,EACrC,UAAU,oGAET,SAAA5B,IAAa,KAAO,iBAAmB,iBAAA,CAAA,CAC1C,CAAA,CACF,CAAA,CAEJ,EAIDM,IAAc,UACbkG,EAAAA,IAAC,MAAA,CACE,SAAAZ,EAAa,SAAW,EACvBa,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAD,EAAAA,IAAC9G,EAAA,CAAQ,UAAU,sCAAA,CAAuC,QACzD,IAAA,CAAE,UAAU,qBACV,SAAAM,IAAa,KAAO,uBAAyB,wBAChD,EACAwG,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMjG,EAAa,MAAM,EAClC,UAAU,8BAET,SAAAP,IAAa,KAAO,qBAAuB,gBAAA,CAAA,CAC9C,CAAA,CACF,EAEAyG,EAAAA,KAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAAT,GAAsB,IAAI7B,GAAS,CAClC,MAAMkD,EAAoBzH,GAAmBuE,EAAM,MAAM,EACnDmD,EAAgBvH,GAAsBoE,EAAM,OAAQnE,CAAQ,EAC5DuH,EAAY,CAAC,MAAO,WAAW,EAAE,SAASpD,EAAM,MAAM,EAE5D,OACEsC,EAAAA,KAAC,MAAA,CAAmB,UAAU,6BAE5B,SAAA,CAAAD,EAAAA,IAAC,OAAI,UAAU,qFACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,0BACV,SAAA,CAAAzG,IAAa,KAAO,QAAU,WAAW,KAAGmE,EAAM,YAAA,EACrD,EACAqC,EAAAA,IAAC,IAAA,CAAE,UAAU,wBACV,SAAA,IAAI,KAAKrC,EAAM,UAAU,EAAE,mBAAmB,QAAS,CACtD,IAAK,UACL,MAAO,OACP,KAAM,UACN,OAAQ,SAAA,CACT,CAAA,CACH,CAAA,EACF,QACC,OAAA,CAAK,UAAU,4BACb,SAAAuB,EAAYvB,EAAM,YAAY,CAAA,CACjC,CAAA,CAAA,CACF,CAAA,CACF,EAGAsC,EAAAA,KAAC,MAAA,CAAI,UAAU,6BACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,kCACX,SAAAc,EAAc,MACjB,EACAd,EAAAA,IAAC,IAAA,CAAE,UAAU,wBACV,WAAc,QAAA,CACjB,CAAA,EACF,QAGC,MAAA,CAAI,UAAU,YACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,6CAEb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,4DAAA,CAA6D,EAE5EA,EAAAA,IAAC,MAAA,CACC,UAAU,mFACV,MAAO,CACL,MAAO,QAAQ,KAAK,IAAKa,GAAqB9H,EAAa,OAAS,GAAM,IAAK,GAAG,CAAC,WAAA,CACrF,CAAA,EAIDA,EAAa,IAAI,CAACiI,EAAOC,IAAU,CAClC,MAAMC,GAAcL,GAAqBI,EACnCE,GAAYN,IAAsBI,EAClCG,GAAYJ,EAAM,KAExB,OACEf,EAAAA,KAAC,MAAA,CAAmB,UAAU,2CAC5B,SAAA,CAAAD,EAAAA,IAAC,MAAA,CACC,UAAW,qFACTkB,GACIC,GACE,4DACA,2BACF,2BACN,GAEA,SAAAnB,EAAAA,IAACoB,GAAA,CAAU,UAAU,SAAA,CAAU,CAAA,CAAA,EAEjCpB,EAAAA,IAAC,OAAA,CAAK,UAAW,yEACfkB,GAAc,gBAAkB,eAClC,GACG,SAAA1H,IAAa,KAAOwH,EAAM,QAAUA,EAAM,OAAA,CAC7C,CAAA,CAAA,EAhBQA,EAAM,EAiBhB,CAEJ,CAAC,CAAA,CAAA,CACH,CAAA,CACF,EAGAf,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAD,MAAC,KAAE,UAAU,yCAA0C,SAAAxG,IAAa,KAAO,UAAY,eAAe,EACtGwG,EAAAA,IAAC,MAAA,CAAI,UAAU,YACX,YAAM,OAAS,CAAA,GAAI,IAAI,CAAChB,EAAMqC,IAC9BpB,EAAAA,KAAC,MAAA,CAAyB,UAAU,0BAClC,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,gFACZ,SAAAhB,EAAK,cACJgB,EAAAA,IAAC,MAAA,CAAI,IAAKhB,EAAK,cAAe,IAAI,GAAG,UAAU,wCAAwC,EAEvFgB,EAAAA,IAAC,QAAK,UAAU,UAAU,cAAE,CAAA,CAEhC,EACAA,MAAC,MAAA,CAAI,UAAU,iBACb,eAAC,OAAA,CAAK,UAAU,uCACb,SAAAhB,EAAK,eAAiBxF,IAAa,KAAO,QAAU,YACvD,EACF,EACAyG,EAAAA,KAAC,OAAA,CAAK,UAAU,0CACb,SAAA,CAAAjB,EAAK,SAAS,OAAKA,EAAK,YAAcA,EAAK,OAAS,GAAG,eAAA,EAAiB,MAAA,CAAA,CAC3E,CAAA,CAAA,EAfQA,EAAK,IAAMqC,CAgBrB,CACD,CAAA,CACH,EACApB,EAAAA,KAAC,MAAA,CAAI,UAAU,uEACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACZ,SAAA,EAAAtC,EAAM,OAAS,CAAA,GAAI,OAAO,CAACoB,EAAKzF,IAAMyF,EAAMzF,EAAE,SAAU,CAAC,EAAE,IAAEE,IAAa,KAAO,UAAY,UAAA,EACjG,EACAyG,EAAAA,KAAC,OAAA,CAAK,UAAU,wCACb,SAAA,CAAAtC,EAAM,aAAa,eAAA,EAAiB,MAAA,CAAA,CACvC,CAAA,EACF,EAGCoD,GACCd,EAAAA,KAAC,SAAA,CACC,QAAS,IAAM1B,GAAYZ,EAAM,EAAE,EACnC,SAAUlC,KAAsBkC,EAAM,GACtC,UAAU,4KAET,SAAA,CAAAlC,KAAsBkC,EAAM,GAC3BqC,EAAAA,IAAC,MAAA,CAAI,UAAU,6EAA6E,EAE5FA,EAAAA,IAACsB,GAAA,CAAQ,UAAU,SAAA,CAAU,EAE9B9H,IAAa,KAAO,iBAAmB,cAAA,CAAA,CAAA,CAC1C,CAAA,CAEJ,CAAA,CAAA,EA5HQmE,EAAM,EA6HhB,CAEJ,CAAC,EAGA8B,EAAkB,GACjBQ,OAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMlE,GAAc2C,GAAK,KAAK,IAAI,EAAGA,EAAI,CAAC,CAAC,EACpD,SAAU5C,IAAe,EACzB,UAAU,oFAEV,SAAAmE,EAAAA,IAACS,EAAA,CAAY,UAAU,SAAA,CAAU,CAAA,CAAA,EAEnCR,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACb,SAAA,CAAApE,EAAW,MAAI4D,CAAA,EAClB,EACAO,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMlE,GAAc2C,GAAK,KAAK,IAAIgB,EAAiBhB,EAAI,CAAC,CAAC,EAClE,SAAU5C,IAAe4D,EACzB,UAAU,oFAEV,SAAAO,EAAAA,IAACU,GAAA,CAAa,UAAU,SAAA,CAAU,CAAA,CAAA,CACpC,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CAEJ,EAID5G,IAAc,WACbkG,EAAAA,IAAC,MAAA,CACE,SAAAX,EAAc,SAAW,EACxBY,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAD,EAAAA,IAACF,GAAA,CAAQ,UAAU,sCAAA,CAAuC,QACzD,IAAA,CAAE,UAAU,qBACV,SAAAtG,IAAa,KAAO,wBAA0B,2BACjD,EACAwG,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMjG,EAAa,MAAM,EAClC,UAAU,8BAET,SAAAP,IAAa,KAAO,qBAAuB,gBAAA,CAAA,CAC9C,CAAA,CACF,EAEAyG,EAAAA,KAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAAP,GAAuB,IAAI/B,GAAS,CACnC,MAAM4D,EAAc5D,EAAM,SAAW,YAC/B6D,EAAc7D,EAAM,SAAW,YAErC,OACEsC,EAAAA,KAAC,MAAA,CAAmB,UAAU,6BAE5B,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAW,gBAAgBuB,EAAc,2BAA6B,8BAA8B,GACvG,SAAAtB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,0BACV,SAAA,CAAAzG,IAAa,KAAO,QAAU,WAAW,KAAGmE,EAAM,YAAA,EACrD,QACC,OAAA,CAAK,UAAW,oCACf4D,EAAc,0BAA4B,6BAC5C,GACG,SAAAA,EACI/H,IAAa,KAAO,UAAY,gBAChCA,IAAa,KAAO,YAAc,YAAA,CAEzC,CAAA,EACF,EACAwG,EAAAA,IAAC,IAAA,CAAE,UAAU,wBACV,SAAA,IAAI,KAAKrC,EAAM,UAAU,EAAE,mBAAmB,QAAS,CACtD,IAAK,UACL,MAAO,OACP,KAAM,SAAA,CACP,CAAA,CACH,CAAA,EACF,QACC,OAAA,CAAK,UAAU,0BACb,SAAAuB,EAAYvB,EAAM,YAAY,CAAA,CACjC,CAAA,CAAA,CACF,CAAA,CACF,QAGC,MAAA,CAAI,UAAU,YACb,SAAAsC,EAAAA,KAAC,MAAA,CAAI,UAAU,YACX,SAAA,EAAAtC,EAAM,OAAS,CAAA,GAAI,MAAM,EAAG,CAAC,EAAE,IAAI,CAACqB,EAAMqC,IAC1CpB,OAAC,MAAA,CAAyB,UAAU,0BAClC,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,gFACZ,SAAAhB,EAAK,cACJgB,EAAAA,IAAC,MAAA,CAAI,IAAKhB,EAAK,cAAe,IAAI,GAAG,UAAU,wCAAwC,EAEvFgB,EAAAA,IAAC,QAAK,UAAU,UAAU,cAAE,CAAA,CAEhC,EACAA,EAAAA,IAAC,QAAK,UAAU,wCACb,WAAK,eAAiBxG,IAAa,KAAO,QAAU,WAAA,CACvD,EACAyG,EAAAA,KAAC,OAAA,CAAK,UAAU,wBAAwB,SAAA,CAAA,IAAEjB,EAAK,QAAA,CAAA,CAAS,CAAA,CAAA,EAXhDA,EAAK,IAAMqC,CAYrB,CACD,GACC1D,EAAM,OAAS,CAAA,GAAI,OAAS,GAC5BsC,EAAAA,KAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,CAAA,KAChCtC,EAAM,OAAS,CAAA,GAAI,OAAS,EAAE,IAAEnE,IAAa,KAAO,MAAQ,MAAA,CAAA,CACjE,CAAA,CAAA,CAEJ,CAAA,CACF,EAGCgI,GAAe,CAAC7D,EAAM,QACrBqC,EAAAA,IAAC,MAAA,CAAI,UAAU,YACb,SAAAC,EAAAA,KAAC,SAAA,CACC,QAAS,IAAM,CACb5D,EAAiBsB,EAAM,EAAE,EACzBxB,EAA2B,EAAI,CACjC,EACA,UAAU,4JAEV,SAAA,CAAA6D,EAAAA,IAACyB,GAAA,CAAK,UAAU,SAAA,CAAU,EACzBjI,IAAa,KAAO,mBAAqB,sBAAA,CAAA,CAAA,EAE9C,EAIDgI,GAAe7D,EAAM,QACpBqC,EAAAA,IAAC,MAAA,CAAI,UAAU,YACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAA,CAAC,EAAG,EAAG,EAAG,EAAG,CAAC,EAAE,IAAKyB,GACpB1B,EAAAA,IAACyB,GAAA,CAEC,UAAW,WAAWC,IAAS/D,EAAM,QAAU,GAAK,kCAAoC,eAAe,EAAA,EADlG+D,CAAA,CAGR,QACA,OAAA,CAAK,UAAU,6BACb,SAAAlI,IAAa,KAAO,cAAgB,kBAAA,CACvC,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,EAxFMmE,EAAM,EA0FhB,CAEJ,CAAC,EAGAgC,EAAoB,GACnBM,OAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhE,GAAeyC,GAAK,KAAK,IAAI,EAAGA,EAAI,CAAC,CAAC,EACrD,SAAU1C,IAAgB,EAC1B,UAAU,oFAEV,SAAAiE,EAAAA,IAACS,EAAA,CAAY,UAAU,SAAA,CAAU,CAAA,CAAA,EAEnCR,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACb,SAAA,CAAAlE,EAAY,MAAI4D,CAAA,EACnB,EACAK,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhE,GAAeyC,GAAK,KAAK,IAAIkB,EAAmBlB,EAAI,CAAC,CAAC,EACrE,SAAU1C,IAAgB4D,EAC1B,UAAU,oFAEV,SAAAK,EAAAA,IAACU,GAAA,CAAa,UAAU,SAAA,CAAU,CAAA,CAAA,CACpC,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CAEJ,EAID5G,IAAc,aACbkG,EAAAA,IAAC,MAAA,CACE,SAAAvF,EAAU,SAAW,EACpBwF,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAD,EAAAA,IAACD,EAAA,CAAM,UAAU,sCAAA,CAAuC,QACvD,IAAA,CAAE,UAAU,qBACV,SAAAvG,IAAa,KAAO,wBAA0B,2BACjD,EACAwG,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMjG,EAAa,MAAM,EAClC,UAAU,8BAET,SAAAP,IAAa,KAAO,qBAAuB,gBAAA,CAAA,CAC9C,CAAA,CACF,EAEAwG,EAAAA,IAAC,MAAA,CAAI,UAAU,yBACZ,SAAA7F,EAAS,OAAOsE,GAAKhE,EAAU,SAASgE,EAAE,EAAE,CAAC,EAAE,IAAIQ,GAAW,CAC7D,MAAMqB,EAAU1B,GAAgBK,EAAQ,EAAE,EAE1C,OACEgB,EAAAA,KAAC,MAAA,CAAqB,UAAU,6BAC9B,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,sEACZ,SAAA,CAAAhB,EAAQ,UACPe,EAAAA,IAAC,MAAA,CACC,IAAKf,EAAQ,UACb,IAAKzF,IAAa,KAAOyF,EAAQ,QAAUA,EAAQ,QACnD,UAAU,4BAAA,CAAA,QAGX,OAAA,CAAK,UAAU,WACb,SAAAxF,EAAewF,EAAQ,WAAW,GAAK,IAAA,CAC1C,EAEFe,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM9B,EAAee,EAAQ,EAAE,EACxC,UAAU,+DAEV,SAAAe,EAAAA,IAACD,EAAA,CAAM,UAAU,mCAAA,CAAoC,CAAA,CAAA,CACvD,EACF,EACAE,EAAAA,KAAC,MAAA,CAAI,UAAU,MACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,8DACX,SAAAxG,IAAa,KAAOyF,EAAQ,QAAUA,EAAQ,OAAA,CACjD,QACC,IAAA,CAAE,UAAU,iCACV,SAAAC,EAAYD,EAAQ,KAAK,EAC5B,EACCqB,EAAU,EACTL,OAAC,MAAA,CAAI,UAAU,qEACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhC,EAAmBiB,EAAQ,GAAIqB,EAAU,CAAC,EACzD,UAAU,sCAEV,SAAAN,EAAAA,IAACO,EAAA,CAAM,UAAU,yBAAA,CAA0B,CAAA,CAAA,EAE7CP,EAAAA,IAAC,OAAA,CAAK,UAAU,8BAA+B,SAAAM,EAAQ,EACvDN,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhC,EAAmBiB,EAAQ,GAAIqB,EAAU,CAAC,EACzD,UAAU,sCAEV,SAAAN,EAAAA,IAACQ,EAAA,CAAK,UAAU,yBAAA,CAA0B,CAAA,CAAA,CAC5C,CAAA,CACF,EAEAP,EAAAA,KAAC,SAAA,CACC,QAAS,IAAMpC,EAAUoB,EAAQ,EAAE,EACnC,UAAU,wJAEV,SAAA,CAAAe,EAAAA,IAACQ,EAAA,CAAK,UAAU,SAAA,CAAU,EAC1BR,EAAAA,IAAC,OAAA,CAAM,SAAAxG,IAAa,KAAO,YAAc,SAAA,CAAU,CAAA,CAAA,CAAA,CACrD,CAAA,CAEJ,CAAA,CAAA,EApDQyF,EAAQ,EAqDlB,CAEJ,CAAC,EACH,CAAA,CAEJ,CAAA,EAEJ,EAGChE,SACE,MAAA,CAAI,UAAU,iEACb,SAAAgF,EAAAA,KAAC,MAAA,CAAI,UAAU,kGACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gGACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,oBACX,SAAAxG,IAAa,KAAOyB,EAAgB,QAAUA,EAAgB,OAAA,CACjE,EACA+E,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM9E,EAAmB,IAAI,EACtC,UAAU,qCAEV,SAAA8E,EAAAA,IAAC2B,GAAA,CAAE,UAAU,SAAA,CAAU,CAAA,CAAA,CACzB,EACF,EAEA1B,EAAAA,KAAC,MAAA,CAAI,UAAU,MACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,6EACZ,SAAA/E,EAAgB,UACf+E,EAAAA,IAAC,MAAA,CACC,IAAK/E,EAAgB,UACrB,IAAI,GACJ,UAAU,uCAAA,CAAA,EAGZ+E,MAAC,OAAA,CAAK,UAAU,WACb,WAAe/E,EAAgB,WAAW,GAAK,IAAA,CAClD,CAAA,CAEJ,EAEA+E,EAAAA,IAAC,KAAE,UAAU,qBACV,aAAa,KAAO/E,EAAgB,eAAiBA,EAAgB,cAAA,CACxE,EAEAgF,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAD,MAAC,KAAE,UAAU,qCACV,SAAAd,EAAYjE,EAAgB,KAAK,EACpC,EACCA,EAAgB,WACf+E,MAAC,IAAA,CAAE,UAAU,6BACV,SAAAd,EAAYjE,EAAgB,SAAS,CAAA,CACxC,CAAA,EAEJ,EACA+E,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAiB,WAAgB,IAAA,CAAK,CAAA,EACrD,EAEC/E,EAAgB,eAAiB,QAC/B,IAAA,CAAE,UAAU,8BACV,SAAAzB,IAAa,KAAO,YAAc,QAAA,CACrC,QAEC,IAAA,CAAE,UAAU,4BACV,SAAAA,IAAa,KAAO,gBAAkB,aAAA,CACzC,EAGFyG,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM9B,EAAejD,EAAgB,EAAE,EAChD,UAAU,wBAEV,SAAA+E,EAAAA,IAACD,EAAA,CACC,UAAW,WACTtF,EAAU,SAASQ,EAAgB,EAAE,EACjC,4BACA,eACN,EAAA,CAAA,CACF,CAAA,EAEFgF,EAAAA,KAAC,SAAA,CACC,QAAS,IAAM,CACbpC,EAAU5C,EAAgB,EAAE,EAC5BC,EAAmB,IAAI,CACzB,EACA,SAAUD,EAAgB,iBAAmB,EAC7C,UAAU,4LAEV,SAAA,CAAA+E,EAAAA,IAACH,EAAA,CAAa,UAAU,SAAA,CAAU,EAClCG,EAAAA,IAAC,OAAA,CAAM,SAAAxG,IAAa,KAAO,qBAAuB,kBAAA,CAAoB,CAAA,CAAA,CAAA,CACxE,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAID2B,UACE,MAAA,CAAI,UAAU,iFACb,SAAA8E,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iDACb,SAAA,CAAAD,MAAC,MAAG,UAAU,oBACX,SAAAxG,IAAa,KAAO,oBAAsB,8BAC7C,EACAwG,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM5E,EAAkB,EAAK,EACtC,UAAU,qCAEV,SAAA4E,EAAAA,IAAC2B,GAAA,CAAE,UAAU,SAAA,CAAU,CAAA,CAAA,CACzB,EACF,EAEA1B,EAAAA,KAAC,MAAA,CAAI,UAAU,MACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAD,MAAC,KAAE,UAAU,6BACV,SAAAxG,IAAa,KAAO,kBAAoB,qBAC3C,EACAyG,EAAAA,KAAC,IAAA,CAAE,UAAU,cACV,SAAA,CAAAtG,GAAM,SAAW,kBAAkB,KAAGH,IAAa,KAAO,MAAQ,UAAU,IAAEG,GAAM,WAAa,GAAA,CAAA,CACpG,CAAA,EACF,EAEAsG,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAD,MAAC,SAAM,UAAU,mCACd,SAAAxG,IAAa,KAAO,wBAA0B,mBACjD,EACAwG,EAAAA,IAAC,WAAA,CACC,MAAO3E,GACP,SAAW+E,GAAM9E,GAAgB8E,EAAE,OAAO,KAAK,EAC/C,YAAa5G,IAAa,KAAO,8CAAgD,0DACjF,UAAU,2CACV,KAAM,CAAA,CAAA,CACR,EACF,QAEC,MAAA,CAAI,UAAU,mCACb,SAAAyG,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAD,MAAC,QAAK,UAAU,gBACb,SAAAxG,IAAa,KAAO,kBAAoB,oBAC3C,QACC,OAAA,CAAK,UAAU,oCACb,SAAA0F,EAAYJ,EAAS,CAAA,CACxB,CAAA,CAAA,CACF,CAAA,CACF,EAEAkB,EAAAA,IAAC,SAAA,CACC,QAAS3B,GACT,UAAU,oGAET,SAAA7E,IAAa,KAAO,oBAAsB,uBAAA,CAAA,CAC7C,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAID0C,IAA2BE,GAC1B4D,EAAAA,IAAC,MAAA,CAAI,UAAU,sEACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,iEAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+GACb,SAAA,CAAAD,MAAC,MAAG,UAAU,+BACX,SAAAxG,IAAa,KAAO,mBAAqB,uBAC5C,EACAwG,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb7D,EAA2B,EAAK,EAChCE,EAAiB,IAAI,EACrBE,EAAkB,CAAC,EACnBE,EAAkB,EAAE,CACtB,EACA,UAAU,uDAEV,SAAAuD,EAAAA,IAAC2B,GAAA,CAAE,UAAU,oBAAA,CAAqB,CAAA,CAAA,CACpC,EACF,EAEA1B,EAAAA,KAAC,MAAA,CAAI,UAAU,MAEb,SAAA,CAAAD,EAAAA,IAAC,OAAI,UAAU,mCACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAD,EAAAA,IAAC,OAAI,UAAU,wEACb,eAAChH,GAAA,CAAY,UAAU,0BAA0B,CAAA,CACnD,SACC,MAAA,CACC,SAAA,CAAAgH,MAAC,OAAI,UAAU,wBACZ,SAAAxG,IAAa,KAAO,QAAU,WACjC,EACAyG,EAAAA,KAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,CAAA,IACzC1F,EAAO,KAAK+C,GAAKA,EAAE,KAAOlB,CAAa,GAAG,cAAgB,EAAA,CAAA,CAC9D,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAGA6D,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAD,MAAC,KAAE,UAAU,6BACV,SAAAxG,IAAa,KAAO,6BAA+B,+BACtD,EACAwG,EAAAA,IAAC,MAAA,CAAI,UAAU,iCACZ,SAAA,CAAC,EAAG,EAAG,EAAG,EAAG,CAAC,EAAE,IAAK0B,GACpB1B,EAAAA,IAAC,SAAA,CAEC,QAAS,IAAMzD,EAAkBmF,CAAI,EACrC,UAAU,8DAEV,SAAA1B,EAAAA,IAACyB,GAAA,CACC,UAAW,aACTC,GAAQpF,EACJ,kCACA,eACN,EAAA,CAAA,CACF,EAVKoF,CAAA,CAYR,EACH,EACAzB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACZ,SAAA,CAAA3D,IAAmB,IAAM9C,IAAa,KAAO,WAAa,WAC1D8C,IAAmB,IAAM9C,IAAa,KAAO,SAAW,UACxD8C,IAAmB,IAAM9C,IAAa,KAAO,YAAc,YAC3D8C,IAAmB,IAAM9C,IAAa,KAAO,QAAU,SACvD8C,IAAmB,IAAM9C,IAAa,KAAO,cAAgB,aAAA,CAAA,CAChE,CAAA,EACF,EAGAyG,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAD,MAAC,SAAM,UAAU,+CACd,SAAAxG,IAAa,KAAO,wBAA0B,oBACjD,EACAwG,EAAAA,IAAC,WAAA,CACC,MAAOxD,GACP,SAAW4D,GAAM3D,EAAkB2D,EAAE,OAAO,KAAK,EACjD,YAAa5G,IAAa,KAAO,+BAAiC,mCAClE,UAAU,6HACV,KAAM,CAAA,CAAA,CACR,EACF,EAGAwG,EAAAA,IAAC,SAAA,CACC,QAAS1B,GACT,SAAU5B,GACV,UAAU,mNAET,YACCsD,MAAC,MAAA,CAAI,UAAU,2EAAA,CAA4E,EAE3FC,EAAAA,KAAAU,EAAAA,SAAA,CACE,SAAA,CAAAX,EAAAA,IAAC/G,EAAA,CAAY,UAAU,SAAA,CAAU,EAChCO,IAAa,KAAO,mBAAqB,iBAAA,CAAA,CAC5C,CAAA,CAAA,CAEJ,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EAEJ,CAEJ"}
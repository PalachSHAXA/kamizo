import{r as m,j as e,Y as J,K as Q,H as T,h as U,I as V,b9 as W,ab as X,a9 as ee,z as $,ap as se,A as te}from"./react-vendor-1768592810918-CYG1yeJW.js";import{b as ae,u as ne}from"./index-1768592810918-CvRz1lQr.js";import"./vendor-1768592810918-Bp-G8Qa4.js";import"./qr-scanner-1768592810918-cr32YHjo.js";import"./zustand-1768592810918-wNUYBKDB.js";function xe(){const{user:h}=ae(),{rentalApartments:A,rentalRecords:b,fetchMyRentals:f}=ne(),[v,D]=m.useState(new Date),[x,H]=m.useState(null),[i,p]=m.useState(null),[E,w]=m.useState(!0);m.useEffect(()=>{(async()=>{w(!0);try{await f()}catch{}finally{w(!1)}})()},[f]);const d=A,c=b,k=s=>b.filter(a=>a.apartmentId===s).sort((a,t)=>new Date(t.checkInDate).getTime()-new Date(a.checkInDate).getTime()),g=s=>new Date(s).toLocaleDateString("ru-RU",{day:"numeric",month:"short"}),S=(s,a)=>a==="UZS"?s.toLocaleString("ru-RU")+" сум":"$"+s.toLocaleString("en-US"),F=d.reduce((s,a)=>{const t=k(a.id);return s+t.reduce((n,r)=>n+(r.currency==="UZS"?r.amount:r.amount*12500),0)},0),z=c.reduce((s,a)=>{const t=a.guestNames.split(",").length;return s+t},0),G=c.filter(s=>{const a=new Date;return new Date(s.checkInDate)<=a&&new Date(s.checkOutDate)>=a}).length,K=s=>{const a=s.getFullYear(),t=s.getMonth(),n=new Date(a,t,1),l=new Date(a,t+1,0).getDate(),u=n.getDay()||7;return{daysInMonth:l,startingDay:u,year:a,month:t}},I=s=>(i?c.filter(t=>t.apartmentId===i):c).filter(t=>{const n=new Date(t.checkInDate),r=new Date(t.checkOutDate);n.setHours(0,0,0,0),r.setHours(23,59,59,999);const l=new Date(s);return l.setHours(12,0,0,0),l>=n&&l<=r}),{daysInMonth:Y,startingDay:Z,year:j,month:N}=K(v),B=v.toLocaleDateString("ru-RU",{month:"long",year:"numeric"}),P=()=>D(new Date(j,N-1,1)),_=()=>D(new Date(j,N+1,1)),y=h?.role==="commercial_owner",C=x?I(x):[],R=c.filter(s=>{const a=new Date(s.checkInDate),t=new Date,n=new Date;return n.setDate(n.getDate()+7),a>=t&&a<=n}).slice(0,3),M=c.filter(s=>{const a=new Date;return new Date(s.checkInDate)<=a&&new Date(s.checkOutDate)>=a}),q=()=>{const s=[],a=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];for(let t=1;t<Z;t++)s.push(e.jsx("div",{className:"h-12 md:h-16"},`empty-${t}`));for(let t=1;t<=Y;t++){const n=new Date(j,N,t),r=I(n),l=n.toDateString()===new Date().toDateString(),u=x?.toDateString()===n.toDateString(),O=(i?c.filter(o=>o.apartmentId===i):c).some(o=>new Date(o.checkInDate).toDateString()===n.toDateString()),L=(i?c.filter(o=>o.apartmentId===i):c).some(o=>new Date(o.checkOutDate).toDateString()===n.toDateString());s.push(e.jsx("button",{onClick:()=>H(n),className:`h-12 md:h-16 p-1 rounded-xl border-2 transition-all relative ${u?"border-primary-500 bg-primary-50 ring-2 ring-primary-200":l?"border-primary-300 bg-primary-50/50":r.length>0?"border-green-200 bg-green-50 hover:border-green-300":"border-transparent hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("span",{className:`text-sm font-medium ${u?"text-primary-700":l?"text-primary-600":r.length>0?"text-green-700":"text-gray-700"}`,children:t}),e.jsxs("div",{className:"flex gap-0.5 mt-0.5",children:[O&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),L&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500"}),r.length>0&&!O&&!L&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]})]})},t))}return e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:P,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-semibold capitalize text-lg",children:B}),e.jsx("button",{onClick:_,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(te,{className:"w-5 h-5"})})]}),d.length>1&&e.jsxs("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide",children:[e.jsx("button",{onClick:()=>p(null),className:`px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${i?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-primary-500 text-black"}`,children:"Все квартиры"}),d.map(t=>e.jsx("button",{onClick:()=>p(t.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${i===t.id?"bg-primary-500 text-black":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.name},t.id))]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:a.map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:s}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{children:"Заезд"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),e.jsx("span",{children:"Выезд"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{children:"Занято"})]})]})]})};return E?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Мои квартиры"}),e.jsxs("p",{className:"text-gray-500",children:["Добро пожаловать, ",h?.name]})]}),e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(J,{className:"w-12 h-12 text-primary-500 mx-auto mb-4 animate-spin"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Загрузка данных..."})]})]}):d.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:y?"Моя недвижимость":"Мои квартиры"}),e.jsxs("p",{className:"text-gray-500",children:["Добро пожаловать, ",h?.name]})]}),e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(Q,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Нет назначенных квартир"}),e.jsx("p",{className:"text-gray-500",children:"Обратитесь к менеджеру для добавления квартиры"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:y?"Моя недвижимость":"Мои квартиры"}),e.jsxs("p",{className:"text-gray-500",children:["Добро пожаловать, ",h?.name,y&&e.jsx("span",{className:"ml-2 text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full",children:"Коммерческий владелец"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-xl",children:e.jsx(T,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Квартир"})]})]})}),e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-xl",children:e.jsx(U,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:G}),e.jsx("div",{className:"text-xs text-gray-500",children:"Проживают сейчас"})]})]})}),e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-xl",children:e.jsx(V,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:z}),e.jsx("div",{className:"text-xs text-gray-500",children:"Гостей всего"})]})]})}),e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-xl",children:e.jsx(W,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[(F/1e6).toFixed(1),"М"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Доход (сум)"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[q(),x&&e.jsxs("div",{className:"mt-4 glass-card p-4",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),x.toLocaleDateString("ru-RU",{weekday:"long",day:"numeric",month:"long"})]}),C.length===0?e.jsx("p",{className:"text-gray-500 text-sm py-4 text-center",children:"Нет бронирований на эту дату"}):e.jsx("div",{className:"space-y-2",children:C.map(s=>{const a=d.find(r=>r.id===s.apartmentId),t=new Date(s.checkInDate).toDateString()===x.toDateString(),n=new Date(s.checkOutDate).toDateString()===x.toDateString();return e.jsxs("div",{className:"p-3 bg-white/60 rounded-xl border border-gray-100",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.guestNames}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(ee,{className:"w-3 h-3"}),a?.name]})]}),e.jsxs("div",{className:"text-right",children:[t&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full",children:"Заезд"}),n&&e.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full",children:"Выезд"}),!t&&!n&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full",children:"Проживание"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:[g(s.checkInDate)," - ",g(s.checkOutDate)]}),e.jsx("span",{className:"font-semibold text-green-600",children:S(s.amount,s.currency)})]})]},s.id)})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-green-600"}),"Текущие гости"]}),M.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"Нет активных бронирований"}):e.jsx("div",{className:"space-y-2",children:M.map(s=>{const a=d.find(n=>n.id===s.apartmentId),t=Math.ceil((new Date(s.checkOutDate).getTime()-new Date().getTime())/(1e3*60*60*24));return e.jsxs("div",{className:"p-3 bg-green-50 rounded-xl border border-green-100",children:[e.jsx("div",{className:"font-medium text-sm",children:s.guestNames}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a?.name}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),t," ",t===1?"день":t<5?"дня":"дней"," до выезда"]}),e.jsx("span",{className:"text-xs font-semibold text-green-700",children:S(s.amount,s.currency)})]})]},s.id)})})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-600"}),"Ближайшие заезды"]}),R.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"Нет запланированных заездов"}):e.jsx("div",{className:"space-y-2",children:R.map(s=>{const a=d.find(l=>l.id===s.apartmentId),t=new Date(s.checkInDate),n=t.toDateString()===new Date().toDateString(),r=t.toDateString()===new Date(Date.now()+864e5).toDateString();return e.jsx("div",{className:"p-3 bg-blue-50 rounded-xl border border-blue-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.guestNames}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a?.name})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${n?"bg-red-100 text-red-700":r?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:n?"Сегодня":r?"Завтра":g(s.checkInDate)})]})},s.id)})})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-primary-600"}),"Мои квартиры"]}),e.jsx("div",{className:"space-y-2",children:d.map(s=>{const a=k(s.id),t=a.find(n=>new Date(n.checkOutDate)>=new Date&&new Date(n.checkInDate)<=new Date);return e.jsxs("div",{className:`p-3 rounded-xl border transition-colors cursor-pointer ${t?"bg-green-50 border-green-200 hover:bg-green-100":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,onClick:()=>p(i===s.id?null:s.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.address})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-green-200 text-green-800":"bg-gray-200 text-gray-600"}`,children:t?"Занята":"Свободна"})]}),t&&e.jsxs("div",{className:"mt-2 text-xs text-green-700",children:[t.guestNames," • до ",g(t.checkOutDate)]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:[a.length," бронирований"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[a.reduce((n,r)=>n+r.guestNames.split(",").length,0)," гостей"]})]})]},s.id)})})]})]})]})]})}export{xe as TenantDashboard};
//# sourceMappingURL=TenantDashboard-1768592810918-DpUYy4Om.js.map

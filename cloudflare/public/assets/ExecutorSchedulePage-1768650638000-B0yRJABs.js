import{r as c,C as N,F as J,j as e,ap as W,A as H,z as v,ab as Q,a9 as D,W as X,U as E,l as S,X as Z,a0 as G}from"./react-vendor-1768650638000-BuN04sTN.js";import{b as V,u as q,d as ee,P as T,c as se,S as ae}from"./index-1768650638000-whvq43RX.js";import"./vendor-1768650638000-HaoOR8eO.js";import"./qr-scanner-1768650638000-cr32YHjo.js";import"./zustand-1768650638000-wNUYBKDB.js";function de(){const{user:M}=V(),{requests:U,executors:B}=q(),{language:t}=ee(),[h,C]=c.useState(new Date),[r,$]=c.useState(null),[l,g]=c.useState(null),[y,_]=c.useState("schedule"),O=B.find(s=>s.login===M?.login),f=U.filter(s=>s.executorId===O?.id),u=c.useMemo(()=>f.filter(s=>["assigned","accepted","in_progress","pending_approval"].includes(s.status)).sort((s,a)=>new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime()),[f]),p=c.useMemo(()=>f.filter(s=>s.scheduledDate&&["assigned","accepted","in_progress"].includes(s.status)).sort((s,a)=>{const n=new Date(s.scheduledDate).getTime(),o=new Date(a.scheduledDate).getTime();return n-o}),[f]),Y=c.useMemo(()=>{const s={};return p.forEach(a=>{if(a.scheduledDate){const n=a.scheduledDate;s[n]||(s[n]=[]),s[n].push(a)}}),s},[p]),k=s=>new Date(s).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),F=[{id:"schedule",label:t==="ru"?"Расписание":"Jadval",icon:N,count:p.length},{id:"all",label:t==="ru"?"Все заявки":"Barcha arizalar",icon:J,count:u.length}];return e.jsxs("div",{className:"space-y-4 md:space-y-6 pb-20 md:pb-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold flex items-center gap-3",children:[e.jsx(N,{className:"w-7 h-7 text-blue-500"}),t==="ru"?"Расписание":"Jadval"]}),e.jsx("div",{className:"flex items-center gap-2",children:u.length>0&&e.jsxs("span",{className:"px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-sm font-medium",children:[u.length," ",t==="ru"?"активных":"faol"]})})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:F.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>_(s.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium whitespace-nowrap transition-all ${y===s.id?"bg-blue-500 text-white shadow-lg":"bg-white/50 text-gray-600 hover:bg-white/80"}`,children:[e.jsx(a,{className:"w-4 h-4"}),s.label,s.count>0&&e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${y===s.id?"bg-white/20":"bg-gray-200"}`,children:s.count})]},s.id)})}),y==="schedule"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-blue-500"}),t==="ru"?"Календарь заявок":"Arizalar kalendari"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const s=new Date(h);s.setMonth(s.getMonth()-1),C(s)},className:"p-2 hover:bg-white/30 rounded-lg",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium min-w-[140px] text-center",children:h.toLocaleDateString("ru-RU",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>{const s=new Date(h);s.setMonth(s.getMonth()+1),C(s)},className:"p-2 hover:bg-white/30 rounded-lg",children:e.jsx(H,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"].map(s=>e.jsx("div",{className:"text-xs font-medium text-gray-500 py-2",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:(()=>{const s=h.getFullYear(),a=h.getMonth(),n=new Date(s,a,1),o=new Date(s,a+1,0),w=(n.getDay()+6)%7,d=[];for(let i=0;i<w;i++)d.push(e.jsx("div",{className:"h-16 md:h-14"},`pad-${i}`));for(let i=1;i<=o.getDate();i++){const b=`${s}-${String(a+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`,j=Y[b]||[],R=j.length>0,A=j.length,L=new Date().toISOString().split("T")[0]===b,x=r===b,K=new Date(b)<new Date(new Date().toISOString().split("T")[0]),P=j.filter(m=>m.priority==="urgent").length,z=j.filter(m=>m.priority==="high").length,I=j.filter(m=>m.priority!=="urgent"&&m.priority!=="high").length;d.push(e.jsxs("div",{onClick:()=>$(b),className:`h-16 md:h-14 flex flex-col items-center justify-start pt-1 rounded-xl relative cursor-pointer transition-all border-2 ${x?"bg-blue-500 text-white shadow-lg scale-[1.02] border-blue-600":L?"bg-blue-50 border-blue-300 font-bold":R?"bg-white/70 border-transparent hover:border-blue-300 hover:shadow-md":K?"bg-gray-50/50 border-transparent text-gray-400":"hover:bg-gray-100/50 border-transparent"}`,children:[e.jsx("span",{className:`text-sm ${L&&!x?"text-blue-600":""}`,children:i}),R&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5 mt-0.5",children:[e.jsxs("div",{className:"flex gap-0.5 flex-wrap justify-center max-w-[40px]",children:[P>0&&e.jsx("div",{className:`w-2 h-2 rounded-full ${x?"bg-red-300":"bg-red-500"}`,title:`${P} urgent`}),z>0&&e.jsx("div",{className:`w-2 h-2 rounded-full ${x?"bg-orange-300":"bg-orange-500"}`,title:`${z} high`}),I>0&&e.jsx("div",{className:`w-2 h-2 rounded-full ${x?"bg-blue-300":"bg-blue-500"}`,title:`${I} normal`})]}),A>1&&e.jsx("span",{className:`text-[10px] font-bold ${x?"text-white/80":"text-gray-500"}`,children:A})]})]},i))}return d})()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-4 pt-4 border-t border-gray-200 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-50 border-2 border-blue-300 rounded"}),e.jsx("span",{children:t==="ru"?"Сегодня":"Bugun"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{children:t==="ru"?"Срочно":"Shoshilinch"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsx("span",{children:t==="ru"?"Высокий":"Yuqori"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:t==="ru"?"Обычный":"Oddiy"})]})]})]}),e.jsxs("div",{className:"glass-card p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"w-5 h-5 text-amber-500"}),r?`${t==="ru"?"Заявки на":"Arizalar"} ${new Date(r).toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}`:t==="ru"?"Предстоящие заявки":"Kelayotgan arizalar",r&&e.jsx("button",{onClick:()=>$(null),className:"ml-auto text-sm text-blue-600 hover:text-blue-800 font-normal",children:t==="ru"?"Показать все":"Hammasini ko'rsatish"})]}),(()=>{const s=r?p.filter(a=>a.scheduledDate===r):p;return s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:r?t==="ru"?"Нет заявок на выбранную дату":"Tanlangan sanada arizalar yo'q":t==="ru"?"Нет запланированных заявок":"Rejalashtirilgan arizalar yo'q"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:r?t==="ru"?"Выберите другой день в календаре":"Kalendarda boshqa kunni tanlang":t==="ru"?"Заявки с указанной датой появятся здесь":"Sanasi ko'rsatilgan arizalar bu yerda paydo bo'ladi"})]}):e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:s.map(a=>{const n=new Date(a.scheduledDate),o=new Date().toISOString().split("T")[0]===a.scheduledDate,w=(()=>{const d=new Date;return d.setDate(d.getDate()+1),d.toISOString().split("T")[0]===a.scheduledDate})();return e.jsx("div",{className:`p-4 rounded-xl border-l-4 cursor-pointer hover:shadow-md transition-shadow ${o?"bg-amber-50 border-amber-500":w?"bg-blue-50 border-blue-500":"bg-white/50 border-gray-300"}`,onClick:()=>g(a),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o&&e.jsx("span",{className:"px-2 py-0.5 bg-amber-500 text-white text-xs rounded-full",children:t==="ru"?"Сегодня":"Bugun"}),w&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full",children:t==="ru"?"Завтра":"Ertaga"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["#",a.number]})]}),e.jsx("h4",{className:"font-semibold",children:a.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-500",children:[a.scheduledTime&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-lg font-medium",children:[e.jsx(v,{className:"w-4 h-4"}),a.scheduledTime]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),a.address,", кв. ",a.apartment]})]})]}),e.jsxs("div",{className:"text-right flex flex-col gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${a.priority==="urgent"?"bg-red-100 text-red-700":a.priority==="high"?"bg-orange-100 text-orange-700":a.priority==="medium"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-700"}`,children:T[a.priority]}),!r&&e.jsx("span",{className:"text-xs text-gray-400",children:n.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})})]})]})},a.id)})})})()]})]}),y==="all"&&e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(X,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:t==="ru"?"Нет активных заявок":"Faol arizalar yo'q"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:t==="ru"?"Ваши назначенные заявки появятся здесь":"Sizga tayinlangan arizalar bu yerda paydo bo'ladi"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:u.map(s=>e.jsxs("div",{className:"glass-card p-4 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>g(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-mono text-sm text-gray-500",children:["#",s.number]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="assigned"?"bg-indigo-100 text-indigo-700":s.status==="accepted"?"bg-cyan-100 text-cyan-700":s.status==="in_progress"?"bg-amber-100 text-amber-700":s.status==="pending_approval"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:se[s.status]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.priority==="urgent"?"bg-red-100 text-red-700":s.priority==="high"?"bg-orange-100 text-orange-700":s.priority==="medium"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,children:T[s.priority]})]}),e.jsx("h4",{className:"font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3.5 h-3.5"}),s.address,", кв. ",s.apartment]}),s.scheduledDate&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium",children:[e.jsx(N,{className:"w-3 h-3"}),new Date(s.scheduledDate).toLocaleDateString("ru-RU",{day:"numeric",month:"short"}),s.scheduledTime&&` ${s.scheduledTime}`]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100 text-sm text-gray-500",children:[e.jsx(E,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:s.residentName}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsx(S,{className:"w-3.5 h-3.5"}),e.jsx("a",{href:`tel:${s.residentPhone}`,className:"text-primary-600 hover:underline",onClick:a=>a.stopPropagation(),children:s.residentPhone})]})]},s.id))})}),l&&e.jsx("div",{className:"modal-backdrop",onClick:()=>g(null),children:e.jsxs("div",{className:"modal-content p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[t==="ru"?"Заявка":"Ariza"," #",l.number]}),e.jsx("h2",{className:"text-xl font-bold",children:l.title})]}),e.jsx("button",{onClick:()=>g(null),className:"p-2 hover:bg-white/30 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[l.scheduledDate&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-medium text-blue-800 flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"w-4 h-4"}),t==="ru"?"Желаемое время выполнения":"Kerakli vaqt"]}),e.jsxs("div",{className:"flex items-center gap-4 text-blue-700",children:[e.jsx("span",{children:new Date(l.scheduledDate).toLocaleDateString("ru-RU",{weekday:"long",day:"numeric",month:"long"})}),l.scheduledTime&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),l.scheduledTime]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${l.priority==="urgent"?"text-red-600 bg-red-50":l.priority==="high"?"text-orange-600 bg-orange-50":l.priority==="medium"?"text-amber-600 bg-amber-50":"text-gray-600 bg-gray-50"}`,children:T[l.priority]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700",children:ae[l.category]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:t==="ru"?"Описание":"Tavsif"}),e.jsx("p",{className:"text-gray-900",children:l.description})]}),e.jsxs("div",{className:"bg-white/30 rounded-xl p-4 space-y-3",children:[e.jsx("h3",{className:"font-medium",children:t==="ru"?"Информация о жителе":"Yashlovchi haqida"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:l.residentName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-gray-400"}),e.jsx("a",{href:`tel:${l.residentPhone}`,className:"text-primary-600 hover:underline",children:l.residentPhone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[l.address,", кв. ",l.apartment]})]})]})]}),e.jsxs("div",{className:"bg-white/30 rounded-xl p-4 space-y-3",children:[e.jsx("h3",{className:"font-medium",children:t==="ru"?"История":"Tarix"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:t==="ru"?"Создана":"Yaratilgan"}),e.jsx("span",{children:k(l.createdAt)})]}),l.assignedAt&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:t==="ru"?"Назначена":"Tayinlangan"}),e.jsx("span",{children:k(l.assignedAt)})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs("a",{href:`tel:${l.residentPhone}`,className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),t==="ru"?"Позвонить":"Qo'ng'iroq"]}),e.jsxs("button",{onClick:()=>g(null),className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),t==="ru"?"Закрыть":"Yopish"]})]})]})})]})}export{de as ExecutorSchedulePage};
//# sourceMappingURL=ExecutorSchedulePage-1768650638000-B0yRJABs.js.map

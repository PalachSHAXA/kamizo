import{c as re,r as x,j as e,G as H,p as W,au as le,V as ne,ab as M,x as D,m as R,U as Y,av as ie,$ as oe,aP as Z,X as L,ao as ce,z as de,a9 as me,aU as xe,h as ue,aT as ge}from"./react-vendor-1768582427694-B6y3o6MK.js";import{l as J,m as B,n as P,o as he,p as X,q as K,r as T,b as V}from"./index-1768582427694-DBI_CkbW.js";import{p as pe}from"./zustand-1768582427694-wNUYBKDB.js";import"./vendor-1768582427694-CXLiVVVA.js";import"./qr-scanner-1768582427694-cr32YHjo.js";const Q=t=>({id:t.id,name:t.name,position:t.position,specialization:t.specialization,email:t.email,phone:t.phone,bio:t.bio,avatarUrl:t.avatar_url,isActive:t.is_active===1||t.is_active===!0,trainingsСonducted:t.trainings_conducted,averageRating:t.average_rating}),ye=t=>({id:t.id,proposalId:t.proposal_id,voterId:t.voter_id,voterName:t.voter_name,participationIntent:t.participation_intent,isAnonymous:t.is_anonymous===1||t.is_anonymous===!0,votedAt:t.voted_at}),be=t=>({id:t.id,proposalId:t.proposal_id,reviewerId:t.reviewer_id,reviewerName:t.reviewer_name,isAnonymous:t.is_anonymous===1||t.is_anonymous===!0,rating:t.rating,contentRating:t.content_rating,presenterRating:t.presenter_rating,usefulnessRating:t.usefulness_rating,comment:t.comment,createdAt:t.created_at}),$=t=>({id:t.id,topic:t.topic,description:t.description,authorId:t.author_id,authorName:t.author_name,isAuthorAnonymous:t.is_author_anonymous===1||t.is_author_anonymous===!0,partnerId:t.partner_id,partnerName:t.partner_name,format:t.format,preferredTimeSlots:Array.isArray(t.preferred_time_slots)?t.preferred_time_slots:t.preferred_time_slots?JSON.parse(t.preferred_time_slots):[],votes:t.votes?t.votes.map(ye):[],voteThreshold:t.vote_threshold||5,status:t.status,partnerResponse:t.partner_response,partnerResponseAt:t.partner_response_at,partnerResponseNote:t.partner_response_note,scheduledDate:t.scheduled_date,scheduledTime:t.scheduled_time,scheduledLocation:t.scheduled_location,scheduledLink:t.scheduled_link,maxParticipants:t.max_participants,registeredParticipants:t.registrations?t.registrations.map(o=>o.user_id):[],feedback:t.feedback?t.feedback.map(be):[],completedAt:t.completed_at,actualParticipantsCount:t.actual_participants_count,createdAt:t.created_at,updatedAt:t.updated_at,voteCount:t.vote_count,registeredCount:t.registered_count}),fe=t=>({id:t.id,type:t.type,proposalId:t.proposal_id,recipientId:t.recipient_id,recipientRole:t.recipient_role,title:t.title,message:t.message,isRead:t.is_read===1||t.is_read===!0,createdAt:t.created_at}),je=t=>({voteThreshold:t.vote_threshold??5,allowAnonymousProposals:t.allow_anonymous_proposals??!0,allowAnonymousVotes:t.allow_anonymous_votes??!0,allowAnonymousFeedback:t.allow_anonymous_feedback??!0,notifyAllOnNewProposal:t.notify_all_on_new_proposal??!0,autoCloseAfterDays:t.auto_close_after_days??30}),Ne={voteThreshold:5,allowAnonymousProposals:!0,allowAnonymousVotes:!0,allowAnonymousFeedback:!0,notifyAllOnNewProposal:!0,autoCloseAfterDays:30},C=re()(pe((t,o)=>({partners:[],proposals:[],notifications:[],settings:Ne,isLoadingPartners:!1,isLoadingProposals:!1,isLoadingNotifications:!1,fetchPartners:async s=>{t({isLoadingPartners:!0});try{const a=await T.getAll(s);t({partners:a.partners.map(Q)})}catch{}finally{t({isLoadingPartners:!1})}},addPartner:async s=>{const a=await T.create(s),l=Q(a.partner);return t(r=>({partners:[...r.partners,l]})),l},updatePartner:async(s,a)=>{await T.update(s,a),t(l=>({partners:l.partners.map(r=>r.id===s?{...r,...a}:r)}))},deletePartner:async s=>{await T.delete(s),t(a=>({partners:a.partners.filter(l=>l.id!==s)}))},getActivePartners:()=>o().partners.filter(s=>s.isActive),fetchProposals:async s=>{t({isLoadingProposals:!0});try{const a=await P.getAll(s);t({proposals:a.proposals.map($)})}catch{}finally{t({isLoadingProposals:!1})}},fetchProposalById:async s=>{try{const a=await P.getById(s),l=$(a.proposal);return t(r=>({proposals:r.proposals.some(i=>i.id===s)?r.proposals.map(i=>i.id===s?l:i):[...r.proposals,l]})),l}catch{return null}},addProposal:async s=>{const a=await P.create({topic:s.topic,description:s.description,partnerId:s.partnerId,format:s.format,preferredTimeSlots:s.preferredTimeSlots,isAuthorAnonymous:s.isAuthorAnonymous}),l=$(a.proposal);return t(r=>({proposals:[...r.proposals,l]})),l},updateProposal:async(s,a)=>{await P.update(s,a),t(l=>({proposals:l.proposals.map(r=>r.id===s?{...r,...a,updatedAt:new Date().toISOString()}:r)}))},deleteProposal:async s=>{await P.delete(s),t(a=>({proposals:a.proposals.filter(l=>l.id!==s)}))},getProposalById:s=>o().proposals.find(a=>a.id===s),getProposalsByStatus:s=>o().proposals.filter(a=>a.status===s),getMyProposals:s=>o().proposals.filter(a=>a.authorId===s),addVote:async(s,a)=>{await K.vote(s,a),await o().fetchProposalById(s)},removeVote:async s=>{await K.removeVote(s),await o().fetchProposalById(s)},hasVoted:(s,a)=>o().getProposalById(s)?.votes.some(r=>r.voterId===a)??!1,getVoteCount:s=>{const a=o().getProposalById(s);return a?.votes.length??a?.voteCount??0},getDefinitelyCount:s=>o().getProposalById(s)?.votes.filter(l=>l.participationIntent==="definitely").length??0,setPartnerResponse:async(s,a,l)=>{await P.update(s,{partnerResponse:a,partnerResponseNote:l,status:a==="accepted"?"approved":"rejected"}),t(r=>({proposals:r.proposals.map(i=>i.id===s?{...i,partnerResponse:a,partnerResponseAt:new Date().toISOString(),partnerResponseNote:l,status:a==="accepted"?"approved":"rejected",updatedAt:new Date().toISOString()}:i)}))},scheduleTraining:async(s,a)=>{await P.schedule(s,a),t(l=>({proposals:l.proposals.map(r=>r.id===s?{...r,...a,status:"scheduled",registeredParticipants:[],updatedAt:new Date().toISOString()}:r)}))},completeTraining:async(s,a)=>{await P.complete(s,{actualParticipantsCount:a}),t(l=>({proposals:l.proposals.map(r=>r.id===s?{...r,status:"completed",completedAt:new Date().toISOString(),actualParticipantsCount:a,updatedAt:new Date().toISOString()}:r)}))},registerForTraining:async s=>{await X.register(s),await o().fetchProposalById(s)},unregisterFromTraining:async s=>{await X.unregister(s),await o().fetchProposalById(s)},isRegistered:(s,a)=>o().getProposalById(s)?.registeredParticipants?.includes(a)??!1,getRegisteredCount:s=>{const a=o().getProposalById(s);return a?.registeredParticipants?.length??a?.registeredCount??0},addFeedback:async(s,a)=>{await he.submit(s,a),await o().fetchProposalById(s)},hasFeedback:(s,a)=>o().getProposalById(s)?.feedback?.some(r=>r.reviewerId===a)??!1,getAverageRating:s=>{const a=o().getProposalById(s);return a?.feedback?.length?a.feedback.reduce((r,i)=>r+i.rating,0)/a.feedback.length:0},changeStatus:async(s,a)=>{await P.update(s,{status:a}),t(l=>({proposals:l.proposals.map(r=>r.id===s?{...r,status:a,updatedAt:new Date().toISOString()}:r)}))},checkThreshold:s=>{const a=o().getProposalById(s);return a?(a.votes?.length??a.voteCount??0)>=a.voteThreshold:!1},fetchNotifications:async s=>{t({isLoadingNotifications:!0});try{const a=await B.getAll(s);t({notifications:a.notifications.map(fe)})}catch{}finally{t({isLoadingNotifications:!1})}},markNotificationAsRead:async s=>{await B.markAsRead(s),t(a=>({notifications:a.notifications.map(l=>l.id===s?{...l,isRead:!0}:l)}))},markAllNotificationsAsRead:async()=>{await B.markAllAsRead(),t(s=>({notifications:s.notifications.map(a=>({...a,isRead:!0}))}))},getUnreadNotifications:s=>o().notifications.filter(a=>(a.recipientId===s||a.recipientId==="all")&&!a.isRead),getNotificationsByRecipient:s=>o().notifications.filter(a=>a.recipientId===s||a.recipientId==="all"),fetchSettings:async()=>{try{const s=await J.getAll();t({settings:je(s.settings)})}catch{}},updateSettings:async s=>{const a={};s.voteThreshold!==void 0&&(a.vote_threshold=s.voteThreshold),s.allowAnonymousProposals!==void 0&&(a.allow_anonymous_proposals=s.allowAnonymousProposals),s.allowAnonymousVotes!==void 0&&(a.allow_anonymous_votes=s.allowAnonymousVotes),s.allowAnonymousFeedback!==void 0&&(a.allow_anonymous_feedback=s.allowAnonymousFeedback),s.notifyAllOnNewProposal!==void 0&&(a.notify_all_on_new_proposal=s.notifyAllOnNewProposal),s.autoCloseAfterDays!==void 0&&(a.auto_close_after_days=s.autoCloseAfterDays),await J.update(a),t(l=>({settings:{...l.settings,...s}}))},getStats:()=>{const s=o().proposals,a=s.filter(i=>i.status==="completed");let l=0,r=0;return a.forEach(i=>{i.feedback?.length&&i.feedback.forEach(h=>{l+=h.rating,r++})}),{totalProposals:s.length,votingProposals:s.filter(i=>i.status==="voting").length,scheduledTrainings:s.filter(i=>i.status==="scheduled").length,completedTrainings:a.length,totalVotes:s.reduce((i,h)=>i+(h.votes?.length??0),0),totalParticipants:s.reduce((i,h)=>i+(h.registeredParticipants?.length??0),0),averageRating:r>0?l/r:0}},getDisplayName:(s,a,l)=>l?s:a?"Аноним":s,getVotesForDisplay:(s,a)=>{const l=o().getProposalById(s);return l?a?l.votes:l.votes.map(r=>({...r,voterName:r.isAnonymous?"Аноним":r.voterName})):[]}}),{name:"training-storage",partialize:t=>({settings:t.settings})})),z={voting:"Голосование",review:"На рассмотрении",approved:"Одобрено",scheduled:"Запланировано",completed:"Завершено",rejected:"Отклонено"},ee={voting:"bg-blue-100 text-blue-800",review:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",scheduled:"bg-purple-100 text-purple-800",completed:"bg-gray-100 text-gray-800",rejected:"bg-red-100 text-red-800"},F={online:"Онлайн",offline:"Офлайн",any:"Любой формат"},E={morning:"Утро (9:00-12:00)",afternoon:"День (12:00-17:00)",evening:"Вечер (17:00-20:00)",weekend:"Выходные"},U={definitely:"Точно приду",maybe:"Возможно приду",support_only:"Поддерживаю идею"},ve={definitely:"bg-green-100 text-green-800",maybe:"bg-yellow-100 text-yellow-800",support_only:"bg-gray-100 text-gray-600"},I=({icon:t,label:o,value:s,color:a})=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${a}`,children:e.jsx(t,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s}),e.jsx("p",{className:"text-sm text-gray-500",children:o})]})]})}),we=({isOpen:t,onClose:o})=>{const{user:s}=V(),{addProposal:a,getActivePartners:l,settings:r}=C(),[i,h]=x.useState(""),[p,N]=x.useState(""),[y,u]=x.useState(""),[v,_]=x.useState("any"),[b,f]=x.useState([]),[w,S]=x.useState(!1),g=l(),A=c=>{c.preventDefault(),!(!s||!y||!g.find(j=>j.id===y))&&(a({topic:i,description:p,isAuthorAnonymous:w,partnerId:y,format:v,preferredTimeSlots:b}),h(""),N(""),u(""),_("any"),f([]),S(!1),o())},k=c=>{f(n=>n.includes(c)?n.filter(j=>j!==c):[...n,c])};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Предложить тренинг"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Тема тренинга *"}),e.jsx("input",{type:"text",value:i,onChange:c=>h(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Введите тему тренинга",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Описание"}),e.jsx("textarea",{value:p,onChange:c=>N(c.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Опишите, чему хотели бы научиться"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Предпочтительный лектор *"}),e.jsxs("select",{value:y,onChange:c=>u(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Выберите партнёра"}),g.map(c=>e.jsxs("option",{value:c.id,children:[c.name," ",c.specialization&&`(${c.specialization})`]},c.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Предпочтительный формат"}),e.jsx("div",{className:"flex gap-4",children:Object.keys(F).map(c=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"format",value:c,checked:v===c,onChange:()=>_(c),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:F[c]})]},c))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Удобное время"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(E).map(c=>e.jsxs("label",{className:`flex items-center gap-2 p-3 border rounded-lg cursor-pointer transition-colors ${b.includes(c)?"border-blue-500 bg-blue-50":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:b.includes(c),onChange:()=>k(c),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:E[c]})]},c))})]}),r.allowAnonymousProposals&&e.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg cursor-pointer active:bg-gray-100 touch-manipulation",children:[e.jsx("input",{type:"checkbox",id:"anonymous",checked:w,onChange:c=>S(c.target.checked),className:"w-5 h-5 md:w-4 md:h-4 text-blue-600 focus:ring-blue-500 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Предложить анонимно (ваше имя не будет отображаться для других сотрудников)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Отмена"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Предложить"]})]})]})]})}):null},Ae=({isOpen:t,onClose:o,proposal:s})=>{const{user:a}=V(),{addVote:l,settings:r}=C(),[i,h]=x.useState("definitely"),[p,N]=x.useState(!1),y=u=>{u.preventDefault(),!(!a||!s)&&(l(s.id,{participationIntent:i,isAnonymous:p}),o())};return!t||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Голосование"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.topic}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Лектор: ",s.partnerName]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Ваше участие"}),e.jsx("div",{className:"space-y-2",children:Object.keys(U).map(u=>e.jsxs("label",{className:`flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${i===u?"border-blue-500 bg-blue-50":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"intent",value:u,checked:i===u,onChange:()=>h(u),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:U[u]})]},u))})]}),r.allowAnonymousVotes&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"voteAnonymous",checked:p,onChange:u=>N(u.target.checked),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"voteAnonymous",className:"text-sm text-gray-700",children:"Голосовать анонимно"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Отмена"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Проголосовать"]})]})]})]})})},ke=({isOpen:t,onClose:o,proposal:s})=>{const{user:a}=V(),{getVotesForDisplay:l,getDisplayName:r,hasVoted:i,isRegistered:h,registerForTraining:p,unregisterFromTraining:N,getAverageRating:y,hasFeedback:u,addFeedback:v,settings:_}=C(),[b,f]=x.useState(!1),[w,S]=x.useState(5),[g,A]=x.useState(""),[k,c]=x.useState(!1),n=a?.role==="admin";if(!t||!s)return null;const j=l(s.id,n),d=a?i(s.id,a.id):!1,O=a?h(s.id,a.id):!1,se=a?u(s.id,a.id):!1,q=y(s.id),te=()=>{a&&(O?N(s.id):p(s.id))},ae=m=>{m.preventDefault(),a&&(v(s.id,{isAnonymous:k,rating:w,comment:g}),f(!1),S(5),A(""))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s.topic}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ee[s.status]}`,children:z[s.status]})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Автор"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[r(s.authorName,s.isAuthorAnonymous,n),n&&s.isAuthorAnonymous&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(анонимно)"})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Лектор"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.partnerName})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Формат"}),e.jsx("p",{className:"font-medium text-gray-900",children:F[s.format]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Голосов"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.votes.length," / ",s.voteThreshold]})]})]}),s.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Описание"}),e.jsx("p",{className:"text-gray-600",children:s.description})]}),s.preferredTimeSlots.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Удобное время"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.preferredTimeSlots.map(m=>e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:E[m]},m))})]}),s.status==="scheduled"&&e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("h3",{className:"font-medium text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Тренинг запланирован"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{children:[s.scheduledDate," в ",s.scheduledTime]})]}),s.scheduledLocation&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:s.scheduledLocation})]}),s.scheduledLink&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-purple-600"}),e.jsx("a",{href:s.scheduledLink,target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"Ссылка на онлайн"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{children:[s.registeredParticipants?.length||0," участников"]})]})]}),a&&e.jsx("button",{onClick:te,className:`mt-4 w-full py-2 rounded-lg font-medium transition-colors ${O?"bg-red-100 text-red-700 hover:bg-red-200":"bg-purple-600 text-white hover:bg-purple-700"}`,children:O?"Отменить регистрацию":"Зарегистрироваться"})]}),j.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:["Голоса (",j.length,")"]}),e.jsx("div",{className:"space-y-2",children:j.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[m.voterName,n&&m.isAnonymous&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(анонимно)"})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ve[m.participationIntent]}`,children:U[m.participationIntent]})]},m.id))})]}),s.status==="completed"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700",children:["Отзывы (",s.feedback?.length||0,")"]}),q>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"text-sm font-medium",children:q.toFixed(1)})]})]}),s.feedback&&s.feedback.length>0&&e.jsx("div",{className:"space-y-3 mb-4",children:s.feedback.map(m=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r(m.reviewerName,m.isAnonymous,n),n&&m.isAnonymous&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(анонимно)"})]}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((Se,G)=>e.jsx(R,{className:`w-4 h-4 ${G<m.rating?"text-yellow-500 fill-yellow-500":"text-gray-300"}`},G))})]}),m.comment&&e.jsx("p",{className:"text-sm text-gray-600",children:m.comment})]},m.id))}),a&&!se&&!b&&e.jsxs("button",{onClick:()=>f(!0),className:"w-full py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Оставить отзыв"]}),b&&e.jsxs("form",{onSubmit:ae,className:"p-4 border border-gray-200 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Оценка"}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(m=>e.jsx("button",{type:"button",onClick:()=>S(m),className:"p-1",children:e.jsx(R,{className:`w-8 h-8 transition-colors ${m<=w?"text-yellow-500 fill-yellow-500":"text-gray-300 hover:text-yellow-400"}`})},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Комментарий"}),e.jsx("textarea",{value:g,onChange:m=>A(m.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Поделитесь впечатлениями..."})]}),_.allowAnonymousFeedback&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"feedbackAnonymous",checked:k,onChange:m=>c(m.target.checked),className:"w-4 h-4 text-blue-600"}),e.jsx("label",{htmlFor:"feedbackAnonymous",className:"text-sm text-gray-700",children:"Оставить анонимно"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Отмена"}),e.jsx("button",{type:"submit",className:"flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Отправить"})]})]})]}),s.status==="voting"&&a&&!d&&e.jsx("div",{className:"pt-4 border-t",children:e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Вы ещё не голосовали за это предложение"})})]})]})})},_e=({isOpen:t,onClose:o})=>{const{getProposalsByStatus:s,setPartnerResponse:a,scheduleTraining:l,settings:r,updateSettings:i,getStats:h}=C(),[p,N]=x.useState(null),[y,u]=x.useState(""),[v,_]=x.useState(""),[b,f]=x.useState(""),[w,S]=x.useState(""),[g,A]=x.useState("review"),k=s("review"),c=s("approved"),n=h(),j=()=>{!p||!y||!v||(l(p.id,{scheduledDate:y,scheduledTime:v,scheduledLocation:b||void 0,scheduledLink:w||void 0}),N(null),u(""),_(""),f(""),S(""))};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Управление тренингами"]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>A("review"),className:`px-6 py-3 text-sm font-medium transition-colors ${g==="review"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["На рассмотрении (",k.length+c.length,")"]}),e.jsx("button",{onClick:()=>A("stats"),className:`px-6 py-3 text-sm font-medium transition-colors ${g==="stats"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Статистика"}),e.jsx("button",{onClick:()=>A("settings"),className:`px-6 py-3 text-sm font-medium transition-colors ${g==="settings"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Настройки"})]}),e.jsxs("div",{className:"p-6",children:[g==="review"&&e.jsxs("div",{className:"space-y-6",children:[k.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ожидают ответа партнёра"}),e.jsx("div",{className:"space-y-3",children:k.map(d=>e.jsx("div",{className:"p-4 border border-yellow-200 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:d.topic}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Лектор: ",d.partnerName]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Голосов: ",d.votes.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a(d.id,"accepted"),className:"px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700",children:"Принять"}),e.jsx("button",{onClick:()=>a(d.id,"rejected"),className:"px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700",children:"Отклонить"})]})]})},d.id))})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Требуют планирования"}),e.jsx("div",{className:"space-y-3",children:c.map(d=>e.jsx("div",{className:"p-4 border border-green-200 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:d.topic}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Лектор: ",d.partnerName]})]}),e.jsx("button",{onClick:()=>N(d),className:"px-3 py-1 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700",children:"Запланировать"})]})},d.id))})]}),p&&e.jsxs("div",{className:"p-4 border border-purple-200 bg-purple-50 rounded-lg",children:[e.jsxs("h3",{className:"font-medium text-purple-900 mb-4",children:["Планирование: ",p.topic]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Дата *"}),e.jsx("input",{type:"date",value:y,onChange:d=>u(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Время *"}),e.jsx("input",{type:"time",value:v,onChange:d=>_(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Место (офлайн)"}),e.jsx("input",{type:"text",value:b,onChange:d=>f(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Конференц-зал"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ссылка (онлайн)"}),e.jsx("input",{type:"url",value:w,onChange:d=>S(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"https://meet.google.com/..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>N(null),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Отмена"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Запланировать"})]})]}),k.length===0&&c.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(D,{className:"w-12 h-12 mx-auto mb-3 text-green-500"}),e.jsx("p",{children:"Нет предложений на рассмотрении"})]})]}),g==="stats"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:n.totalProposals}),e.jsx("p",{className:"text-sm text-gray-600",children:"Всего предложений"})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:n.scheduledTrainings}),e.jsx("p",{className:"text-sm text-gray-600",children:"Запланировано"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:n.completedTrainings}),e.jsx("p",{className:"text-sm text-gray-600",children:"Проведено"})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:n.averageRating.toFixed(1)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Средняя оценка"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalVotes}),e.jsx("p",{className:"text-sm text-gray-600",children:"Всего голосов"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalParticipants}),e.jsx("p",{className:"text-sm text-gray-600",children:"Участников"})]})]})]}),g==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Порог голосов для рассмотрения"}),e.jsx("input",{type:"number",value:r.voteThreshold,onChange:d=>i({voteThreshold:parseInt(d.target.value)}),min:1,max:50,className:"w-32 px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.allowAnonymousProposals,onChange:d=>i({allowAnonymousProposals:d.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Разрешить анонимные предложения"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.allowAnonymousVotes,onChange:d=>i({allowAnonymousVotes:d.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Разрешить анонимное голосование"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.allowAnonymousFeedback,onChange:d=>i({allowAnonymousFeedback:d.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Разрешить анонимные отзывы"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.notifyAllOnNewProposal,onChange:d=>i({notifyAllOnNewProposal:d.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Уведомлять всех о новых предложениях"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Автозакрытие через (дней, 0 = выкл)"}),e.jsx("input",{type:"number",value:r.autoCloseAfterDays||0,onChange:d=>i({autoCloseAfterDays:parseInt(d.target.value)||void 0}),min:0,max:365,className:"w-32 px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})]})}):null};function Fe(){const{user:t}=V(),{proposals:o,getProposalsByStatus:s,hasVoted:a,getStats:l}=C(),[r,i]=x.useState(!1),[h,p]=x.useState(!1),[N,y]=x.useState(!1),[u,v]=x.useState(!1),[_,b]=x.useState(null),[f,w]=x.useState("all"),S=t?.role==="admin",g=l(),A=f==="all"?o:s(f),k=n=>{b(n),p(!0)},c=n=>{b(n),y(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(H,{className:"w-8 h-8 text-blue-600"}),"Тренинги"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Предлагайте темы, голосуйте и развивайтесь вместе"})]}),e.jsxs("div",{className:"flex gap-3",children:[S&&e.jsxs("button",{onClick:()=>v(!0),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Управление"]}),e.jsxs("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Предложить тренинг"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(I,{icon:ne,label:"На голосовании",value:g.votingProposals,color:"bg-blue-500"}),e.jsx(I,{icon:M,label:"Запланировано",value:g.scheduledTrainings,color:"bg-purple-500"}),e.jsx(I,{icon:D,label:"Проведено",value:g.completedTrainings,color:"bg-green-500"}),e.jsx(I,{icon:R,label:"Средняя оценка",value:g.averageRating.toFixed(1),color:"bg-orange-500"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>w("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Все (",o.length,")"]}),["voting","review","scheduled","completed","rejected"].map(n=>{const j=s(n).length;return e.jsxs("button",{onClick:()=>w(n),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f===n?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[z[n]," (",j,")"]},n)})]}),e.jsx("div",{className:"space-y-4",children:A.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border border-gray-100",children:[e.jsx(H,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Нет предложений"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Будьте первым, кто предложит тему для тренинга!"})]}):A.map(n=>{const j=t?a(n.id,t.id):!1,d=n.votes.length/n.voteThreshold*100;return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n.topic}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ee[n.status]}`,children:z[n.status]})]}),n.description&&e.jsx("p",{className:"text-gray-600 mb-3",children:n.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),"Лектор: ",n.partnerName]}),e.jsx("span",{className:"flex items-center gap-1",children:F[n.format]}),n.status==="scheduled"&&e.jsxs("span",{className:"flex items-center gap-1 text-purple-600",children:[e.jsx(M,{className:"w-4 h-4"}),n.scheduledDate," в ",n.scheduledTime]})]}),n.status==="voting"&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"text-gray-600",children:["Голосов: ",n.votes.length," /"," ",n.voteThreshold]}),e.jsxs("span",{className:"text-gray-500",children:[Math.round(d),"%"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${Math.min(d,100)}%`}})})]}),n.status==="scheduled"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-gray-600",children:["Зарегистрировано:"," ",n.registeredParticipants?.length||0]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>c(n),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Подробнее",children:e.jsx(oe,{className:"w-5 h-5"})}),n.status==="voting"&&t&&!j&&e.jsxs("button",{onClick:()=>k(n),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Голосовать"]}),n.status==="voting"&&t&&j&&e.jsxs("span",{className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Вы проголосовали"]})]})]})},n.id)})}),e.jsx(we,{isOpen:r,onClose:()=>i(!1)}),e.jsx(Ae,{isOpen:h,onClose:()=>{p(!1),b(null)},proposal:_}),e.jsx(ke,{isOpen:N,onClose:()=>{y(!1),b(null)},proposal:_}),e.jsx(_e,{isOpen:u,onClose:()=>v(!1)})]})}export{Fe as default};
//# sourceMappingURL=TrainingsPage-1768582427694-uz_5MFEf.js.map

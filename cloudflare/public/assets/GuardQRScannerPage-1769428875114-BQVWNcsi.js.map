{"version":3,"mappings":"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","names":["GuardQRScannerPage","user","useAuthStore","validateGuestAccessCode","useGuestAccessCode","addGuestAccessLog","getGuestAccessLogs","guestAccessCodes","useDataStore","language","useLanguageStore","useEffect","c","isScanning","setIsScanning","useState","isCameraReady","setIsCameraReady","scanResult","setScanResult","showManualInput","setShowManualInput","manualCode","setManualCode","showHistory","setShowHistory","cameraError","setCameraError","videoRef","useRef","canvasRef","streamRef","animationRef","scanningRef","recentLogs","processQRCode","useCallback","qrData","result","message","status","scanFrame","video","canvas","ctx","imageData","jsQR","__vitePreload","n","qrCode","stopCamera","startCamera","stream","playVideo","err","errorMessage","track","handleAllowEntry","handleDenyEntry","handleManualSubmit","getVisitorIcon","type","jsx","Package","Users","Car","User","jsxs","History","X","QrCode","Camera","Keyboard","e","CheckCircle","AlertTriangle","XCircle","VISITOR_TYPE_LABELS","Phone","MapPin","Clock","log","isAllowed","isDenied"],"ignoreList":[],"sources":["../../src/pages/GuardQRScannerPage.tsx"],"sourcesContent":["import { useState, useRef, useEffect, useCallback } from 'react';\r\nimport {\r\n  QrCode, Camera, CheckCircle, XCircle, AlertTriangle, Clock,\r\n  User, MapPin, Phone, Car, Package, Users, History, X,\r\n  Keyboard\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useDataStore } from '../stores/dataStore';\r\nimport { useLanguageStore } from '../stores/languageStore';\r\nimport {\r\n  VISITOR_TYPE_LABELS,\r\n  type GuestAccessCode\r\n} from '../types';\r\n\r\ntype ScanResult = {\r\n  status: 'success' | 'expired' | 'used' | 'revoked' | 'invalid' | 'not_yet_valid';\r\n  code?: GuestAccessCode;\r\n  message: string;\r\n};\r\n\r\nexport function GuardQRScannerPage() {\r\n  const { user } = useAuthStore();\r\n  const { validateGuestAccessCode, useGuestAccessCode, addGuestAccessLog, getGuestAccessLogs, guestAccessCodes } = useDataStore();\r\n  const { language } = useLanguageStore();\r\n\r\n  // Debug: log available codes on mount\r\n  useEffect(() => {\r\n    console.log('=== GUARD QR SCANNER MOUNT ===');\r\n    console.log('Available guest access codes:', guestAccessCodes);\r\n    console.log('Codes count:', guestAccessCodes.length);\r\n    guestAccessCodes.forEach(c => {\r\n      console.log(`  Code: ${c.id}, token: ${c.qrToken}, status: ${c.status}`);\r\n    });\r\n  }, [guestAccessCodes]);\r\n\r\n  const [isScanning, setIsScanning] = useState(false);\r\n  const [isCameraReady, setIsCameraReady] = useState(false);\r\n  const [scanResult, setScanResult] = useState<ScanResult | null>(null);\r\n  const [showManualInput, setShowManualInput] = useState(false);\r\n  const [manualCode, setManualCode] = useState('');\r\n  const [showHistory, setShowHistory] = useState(false);\r\n  const [cameraError, setCameraError] = useState<string | null>(null);\r\n\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n  const animationRef = useRef<number | null>(null);\r\n  const scanningRef = useRef(false);\r\n\r\n  const recentLogs = getGuestAccessLogs().slice(0, 20);\r\n\r\n  const processQRCode = useCallback((qrData: string) => {\r\n    console.log('Processing QR code:', qrData);\r\n    const result = validateGuestAccessCode(qrData);\r\n    console.log('Validation result:', result);\r\n\r\n    if (!result.valid) {\r\n      let message = '';\r\n      let status: ScanResult['status'] = 'invalid';\r\n\r\n      switch (result.error) {\r\n        case 'expired':\r\n          status = 'expired';\r\n          message = language === 'ru' ? 'Пропуск истёк' : 'Ruxsatnoma muddati tugagan';\r\n          break;\r\n        case 'revoked':\r\n          status = 'revoked';\r\n          message = language === 'ru' ? 'Пропуск отменён' : 'Ruxsatnoma bekor qilingan';\r\n          break;\r\n        case 'already_used':\r\n        case 'max_uses_reached':\r\n          status = 'used';\r\n          message = language === 'ru' ? 'Пропуск уже использован' : 'Ruxsatnoma ishlatilgan';\r\n          break;\r\n        case 'not_yet_valid':\r\n          status = 'not_yet_valid';\r\n          message = language === 'ru' ? 'Пропуск ещё не действителен' : 'Ruxsatnoma hali amal qilmaydi';\r\n          break;\r\n        default:\r\n          status = 'invalid';\r\n          message = language === 'ru' ? 'Недействительный QR-код' : 'Noto\\'g\\'ri QR-kod';\r\n      }\r\n\r\n      setScanResult({ status, code: result.code, message });\r\n\r\n      // Log the scan attempt\r\n      if (user && result.code) {\r\n        addGuestAccessLog({\r\n          accessCodeId: result.code.id,\r\n          scannedById: user.id,\r\n          scannedByName: user.name,\r\n          scannedByRole: user.role,\r\n          action: status === 'expired' ? 'scan_expired' :\r\n                  status === 'used' ? 'scan_used' :\r\n                  status === 'revoked' ? 'scan_revoked' : 'scan_invalid',\r\n          visitorType: result.code.visitorType,\r\n          residentName: result.code.residentName,\r\n          residentApartment: result.code.residentApartment,\r\n        });\r\n      }\r\n    } else {\r\n      setScanResult({\r\n        status: 'success',\r\n        code: result.code,\r\n        message: language === 'ru' ? 'Пропуск действителен' : 'Ruxsatnoma amal qiladi'\r\n      });\r\n    }\r\n  }, [validateGuestAccessCode, addGuestAccessLog, user, language]);\r\n\r\n  const scanFrame = useCallback(async () => {\r\n    if (!scanningRef.current || !videoRef.current || !canvasRef.current) {\r\n      return;\r\n    }\r\n\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    if (!ctx || video.readyState !== video.HAVE_ENOUGH_DATA) {\r\n      animationRef.current = requestAnimationFrame(() => { scanFrame(); });\r\n      return;\r\n    }\r\n\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n    try {\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n      // Lazy load jsQR library\r\n      const { default: jsQR } = await import('jsqr');\r\n\r\n      const qrCode = jsQR(imageData.data, imageData.width, imageData.height, {\r\n        inversionAttempts: 'dontInvert'\r\n      });\r\n\r\n      if (qrCode && qrCode.data) {\r\n        scanningRef.current = false;\r\n        processQRCode(qrCode.data);\r\n        stopCamera();\r\n        return;\r\n      }\r\n    } catch (e) {\r\n      console.error('QR scan error:', e);\r\n    }\r\n\r\n    animationRef.current = requestAnimationFrame(() => { scanFrame(); });\r\n  }, [processQRCode]);\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      setCameraError(null);\r\n      setIsScanning(true);\r\n      setIsCameraReady(false);\r\n\r\n      // Check if mediaDevices is available\r\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n        throw new Error('Camera API not supported');\r\n      }\r\n\r\n      console.log('Requesting camera access...');\r\n\r\n      // Try to get camera with environment facing first\r\n      let stream: MediaStream;\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia({\r\n          video: {\r\n            facingMode: { ideal: 'environment' },\r\n            width: { ideal: 1280 },\r\n            height: { ideal: 720 }\r\n          }\r\n        });\r\n      } catch {\r\n        // Fallback to any camera\r\n        console.log('Environment camera failed, trying any camera...');\r\n        stream = await navigator.mediaDevices.getUserMedia({\r\n          video: true\r\n        });\r\n      }\r\n\r\n      console.log('Camera stream obtained:', stream.getVideoTracks().length, 'video tracks');\r\n\r\n      streamRef.current = stream;\r\n\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n\r\n        // Use both onloadedmetadata and oncanplay for better compatibility\r\n        const playVideo = async () => {\r\n          try {\r\n            if (videoRef.current) {\r\n              console.log('Playing video...');\r\n              await videoRef.current.play();\r\n              console.log('Video playing successfully');\r\n              setIsCameraReady(true);\r\n              scanningRef.current = true;\r\n              scanFrame();\r\n            }\r\n          } catch (playErr) {\r\n            console.error('Play error:', playErr);\r\n            setCameraError(language === 'ru'\r\n              ? 'Не удалось запустить видео. Нажмите на экран.'\r\n              : 'Video ishga tushmadi. Ekranga bosing.');\r\n          }\r\n        };\r\n\r\n        videoRef.current.onloadedmetadata = () => {\r\n          console.log('Video metadata loaded');\r\n          playVideo();\r\n        };\r\n\r\n        // Also try oncanplay as fallback\r\n        videoRef.current.oncanplay = () => {\r\n          if (!isCameraReady) {\r\n            console.log('Video can play');\r\n            playVideo();\r\n          }\r\n        };\r\n      }\r\n    } catch (err) {\r\n      console.error('Camera error:', err);\r\n      setIsScanning(false);\r\n\r\n      // Provide more specific error messages\r\n      let errorMessage = language === 'ru'\r\n        ? 'Не удалось получить доступ к камере.'\r\n        : 'Kameraga kirish imkoni bo\\'lmadi.';\r\n\r\n      if (err instanceof Error) {\r\n        if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {\r\n          errorMessage = language === 'ru'\r\n            ? 'Доступ к камере запрещён. Разрешите доступ в настройках браузера.'\r\n            : 'Kameraga ruxsat berilmagan. Brauzer sozlamalarida ruxsat bering.';\r\n        } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {\r\n          errorMessage = language === 'ru'\r\n            ? 'Камера не найдена на устройстве.'\r\n            : 'Qurilmada kamera topilmadi.';\r\n        } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {\r\n          errorMessage = language === 'ru'\r\n            ? 'Камера используется другим приложением.'\r\n            : 'Kamera boshqa dastur tomonidan ishlatilmoqda.';\r\n        } else if (err.message === 'Camera API not supported') {\r\n          errorMessage = language === 'ru'\r\n            ? 'Камера не поддерживается. Убедитесь, что используете HTTPS.'\r\n            : 'Kamera qo\\'llab-quvvatlanmaydi. HTTPS ishlatilayotganiga ishonch hosil qiling.';\r\n        }\r\n      }\r\n\r\n      setCameraError(errorMessage);\r\n    }\r\n  };\r\n\r\n  const stopCamera = useCallback(() => {\r\n    scanningRef.current = false;\r\n\r\n    if (animationRef.current) {\r\n      cancelAnimationFrame(animationRef.current);\r\n      animationRef.current = null;\r\n    }\r\n\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(track => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n\r\n    if (videoRef.current) {\r\n      videoRef.current.srcObject = null;\r\n    }\r\n\r\n    setIsScanning(false);\r\n    setIsCameraReady(false);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      stopCamera();\r\n    };\r\n  }, [stopCamera]);\r\n\r\n  const handleAllowEntry = () => {\r\n    if (!scanResult?.code || !user) return;\r\n\r\n    // Mark as used - pass full code for self-contained tokens\r\n    useGuestAccessCode(scanResult.code.id, scanResult.code);\r\n\r\n    // Log the entry\r\n    addGuestAccessLog({\r\n      accessCodeId: scanResult.code.id,\r\n      scannedById: user.id,\r\n      scannedByName: user.name,\r\n      scannedByRole: user.role,\r\n      action: 'entry_allowed',\r\n      visitorType: scanResult.code.visitorType,\r\n      residentName: scanResult.code.residentName,\r\n      residentApartment: scanResult.code.residentApartment,\r\n    });\r\n\r\n    setScanResult(null);\r\n  };\r\n\r\n  const handleDenyEntry = () => {\r\n    if (!scanResult?.code || !user) return;\r\n\r\n    // Log the denial\r\n    addGuestAccessLog({\r\n      accessCodeId: scanResult.code.id,\r\n      scannedById: user.id,\r\n      scannedByName: user.name,\r\n      scannedByRole: user.role,\r\n      action: 'entry_denied',\r\n      visitorType: scanResult.code.visitorType,\r\n      residentName: scanResult.code.residentName,\r\n      residentApartment: scanResult.code.residentApartment,\r\n    });\r\n\r\n    setScanResult(null);\r\n  };\r\n\r\n  const handleManualSubmit = () => {\r\n    if (!manualCode.trim()) return;\r\n    processQRCode(manualCode.trim());\r\n    setManualCode('');\r\n    setShowManualInput(false);\r\n  };\r\n\r\n  const getVisitorIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'courier': return <Package className=\"w-6 h-6\" />;\r\n      case 'guest': return <Users className=\"w-6 h-6\" />;\r\n      case 'taxi': return <Car className=\"w-6 h-6\" />;\r\n      default: return <User className=\"w-6 h-6\" />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-xl md:text-2xl font-bold text-gray-900\">\r\n            {language === 'ru' ? 'Сканер QR' : 'QR skaner'}\r\n          </h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">\r\n            {language === 'ru'\r\n              ? 'Сканируйте пропуска посетителей'\r\n              : 'Tashrif buyuruvchilar ruxsatnomalarini skanerlang'}\r\n          </p>\r\n          {/* Debug: show codes count */}\r\n          <p className=\"text-xs text-blue-500 mt-1\">\r\n            {language === 'ru' ? 'Активных пропусков' : 'Faol ruxsatnomalar'}: {guestAccessCodes.filter(c => c.status === 'active').length} / {guestAccessCodes.length}\r\n          </p>\r\n        </div>\r\n        <button\r\n          onClick={() => setShowHistory(!showHistory)}\r\n          className={`p-2.5 rounded-xl transition-colors ${\r\n            showHistory ? 'bg-primary-500 text-gray-900' : 'bg-white/50 text-gray-600 hover:bg-white'\r\n          }`}\r\n        >\r\n          <History className=\"w-5 h-5\" />\r\n        </button>\r\n      </div>\r\n\r\n      {/* Main scanner area */}\r\n      {!showHistory && !scanResult && (\r\n        <div className=\"glass-card overflow-hidden\">\r\n          {isScanning ? (\r\n            <div className=\"relative bg-black\" style={{ minHeight: '300px' }}>\r\n              <video\r\n                ref={videoRef}\r\n                className=\"w-full h-auto\"\r\n                style={{ minHeight: '300px', maxHeight: '70vh', objectFit: 'cover' }}\r\n                playsInline\r\n                muted\r\n                autoPlay\r\n              />\r\n              <canvas ref={canvasRef} className=\"hidden\" />\r\n\r\n              {/* Loading indicator */}\r\n              {!isCameraReady && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-gray-900\">\r\n                  <div className=\"text-center text-white\">\r\n                    <div className=\"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\r\n                    <p>{language === 'ru' ? 'Загрузка камеры...' : 'Kamera yuklanmoqda...'}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Scanning overlay */}\r\n              {isCameraReady && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                  <div className=\"w-64 h-64 border-2 border-white/50 rounded-2xl relative\">\r\n                    <div className=\"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-primary-500 rounded-tl-xl\" />\r\n                    <div className=\"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-primary-500 rounded-tr-xl\" />\r\n                    <div className=\"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-primary-500 rounded-bl-xl\" />\r\n                    <div className=\"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-primary-500 rounded-br-xl\" />\r\n\r\n                    {/* Scanning line animation */}\r\n                    <div className=\"absolute inset-x-2 h-0.5 bg-primary-500 animate-bounce\" style={{ top: '50%' }} />\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Stop button */}\r\n              <button\r\n                onClick={stopCamera}\r\n                className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-medium rounded-xl flex items-center gap-2 z-10\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n                {language === 'ru' ? 'Остановить' : 'To\\'xtatish'}\r\n              </button>\r\n            </div>\r\n          ) : (\r\n            <div className=\"p-8 text-center\">\r\n              <div className=\"w-24 h-24 mx-auto mb-6 bg-primary-100 rounded-full flex items-center justify-center\">\r\n                <QrCode className=\"w-12 h-12 text-primary-600\" />\r\n              </div>\r\n\r\n              {cameraError ? (\r\n                <div className=\"mb-6\">\r\n                  <div className=\"text-red-500 mb-2\">{cameraError}</div>\r\n                  <p className=\"text-sm text-gray-500\">\r\n                    {language === 'ru'\r\n                      ? 'Попробуйте снова или используйте ручной ввод кода'\r\n                      : 'Qayta urinib ko\\'ring yoki qo\\'lda kod kiriting'}\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-gray-600 mb-6\">\r\n                  {language === 'ru'\r\n                    ? 'Нажмите кнопку, чтобы начать сканирование'\r\n                    : 'Skanerlashni boshlash uchun tugmani bosing'}\r\n                </p>\r\n              )}\r\n\r\n              <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n                <button\r\n                  onClick={startCamera}\r\n                  className=\"px-6 py-4 bg-primary-500 hover:bg-primary-600 text-gray-900 font-bold rounded-xl flex items-center justify-center gap-2\"\r\n                >\r\n                  <Camera className=\"w-5 h-5\" />\r\n                  {language === 'ru' ? 'Сканировать QR' : 'QR skanerlash'}\r\n                </button>\r\n                <button\r\n                  onClick={() => setShowManualInput(true)}\r\n                  className=\"px-6 py-4 border-2 border-gray-200 hover:border-gray-300 rounded-xl font-medium flex items-center justify-center gap-2\"\r\n                >\r\n                  <Keyboard className=\"w-5 h-5\" />\r\n                  {language === 'ru' ? 'Ввести код' : 'Kod kiriting'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Manual input modal */}\r\n      {showManualInput && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white rounded-2xl max-w-md w-full p-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-lg font-bold\">\r\n                {language === 'ru' ? 'Ввод кода' : 'Kod kiriting'}\r\n              </h3>\r\n              <button onClick={() => setShowManualInput(false)} className=\"p-2 hover:bg-gray-100 rounded-xl\">\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <input\r\n              type=\"text\"\r\n              value={manualCode}\r\n              onChange={(e) => setManualCode(e.target.value)}\r\n              placeholder=\"GA-xxxxx-xxxxx-xxxxx\"\r\n              className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-0 mb-4 font-mono\"\r\n              autoFocus\r\n              onKeyDown={(e) => e.key === 'Enter' && handleManualSubmit()}\r\n            />\r\n\r\n            <button\r\n              onClick={handleManualSubmit}\r\n              disabled={!manualCode.trim()}\r\n              className=\"w-full py-3 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 text-gray-900 font-bold rounded-xl\"\r\n            >\r\n              {language === 'ru' ? 'Проверить' : 'Tekshirish'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Scan result */}\r\n      {scanResult && (\r\n        <div className=\"glass-card overflow-hidden\">\r\n          {/* Status header */}\r\n          <div className={`p-6 text-center ${\r\n            scanResult.status === 'success' ? 'bg-green-500' :\r\n            scanResult.status === 'expired' || scanResult.status === 'used' ? 'bg-amber-500' :\r\n            'bg-red-500'\r\n          }`}>\r\n            <div className=\"w-20 h-20 mx-auto mb-4 bg-white/20 rounded-full flex items-center justify-center\">\r\n              {scanResult.status === 'success' ? (\r\n                <CheckCircle className=\"w-10 h-10 text-white\" />\r\n              ) : scanResult.status === 'expired' || scanResult.status === 'used' || scanResult.status === 'not_yet_valid' ? (\r\n                <AlertTriangle className=\"w-10 h-10 text-white\" />\r\n              ) : (\r\n                <XCircle className=\"w-10 h-10 text-white\" />\r\n              )}\r\n            </div>\r\n            <h2 className=\"text-xl font-bold text-white mb-1\">{scanResult.message}</h2>\r\n            {scanResult.code && (\r\n              <p className=\"text-white/80\">\r\n                {VISITOR_TYPE_LABELS[scanResult.code.visitorType].icon}{' '}\r\n                {language === 'ru'\r\n                  ? VISITOR_TYPE_LABELS[scanResult.code.visitorType].label\r\n                  : VISITOR_TYPE_LABELS[scanResult.code.visitorType].labelUz}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          {/* Visitor details */}\r\n          {scanResult.code && (\r\n            <div className=\"p-6 space-y-4\">\r\n              <div className=\"flex items-center gap-4 p-4 bg-gray-50 rounded-xl\">\r\n                <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600\">\r\n                  {getVisitorIcon(scanResult.code.visitorType)}\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  {scanResult.code.visitorName && (\r\n                    <div className=\"font-medium text-lg\">{scanResult.code.visitorName}</div>\r\n                  )}\r\n                  {scanResult.code.visitorPhone && (\r\n                    <div className=\"text-gray-500 flex items-center gap-1\">\r\n                      <Phone className=\"w-4 h-4\" />\r\n                      {scanResult.code.visitorPhone}\r\n                    </div>\r\n                  )}\r\n                  {scanResult.code.visitorVehiclePlate && (\r\n                    <div className=\"text-gray-500 flex items-center gap-1\">\r\n                      <Car className=\"w-4 h-4\" />\r\n                      {scanResult.code.visitorVehiclePlate}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Resident info */}\r\n              <div className=\"p-4 border-2 border-gray-100 rounded-xl\">\r\n                <div className=\"text-sm text-gray-500 mb-2\">\r\n                  {language === 'ru' ? 'Идёт к жителю' : 'Quyidagi turar joy egasiga'}\r\n                </div>\r\n                <div className=\"font-medium text-lg\">{scanResult.code.residentName}</div>\r\n                <div className=\"text-gray-600 flex items-center gap-1 mt-1\">\r\n                  <MapPin className=\"w-4 h-4\" />\r\n                  {scanResult.code.residentAddress}, {language === 'ru' ? 'кв.' : 'xona'} {scanResult.code.residentApartment}\r\n                </div>\r\n                <div className=\"text-gray-500 flex items-center gap-1 mt-1\">\r\n                  <Phone className=\"w-4 h-4\" />\r\n                  {scanResult.code.residentPhone}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Time info */}\r\n              <div className=\"flex items-center gap-2 text-sm text-gray-500\">\r\n                <Clock className=\"w-4 h-4\" />\r\n                {language === 'ru' ? 'Действует до' : 'Gacha amal qiladi'}:{' '}\r\n                {new Date(scanResult.code.validUntil).toLocaleString(language === 'ru' ? 'ru-RU' : 'uz-UZ')}\r\n              </div>\r\n\r\n              {scanResult.code.notes && (\r\n                <div className=\"p-3 bg-blue-50 rounded-xl text-sm text-blue-700\">\r\n                  <strong>{language === 'ru' ? 'Примечание' : 'Izoh'}:</strong> {scanResult.code.notes}\r\n                </div>\r\n              )}\r\n\r\n              {/* Actions */}\r\n              {scanResult.status === 'success' ? (\r\n                <div className=\"flex gap-3 pt-4\">\r\n                  <button\r\n                    onClick={handleDenyEntry}\r\n                    className=\"flex-1 py-4 border-2 border-red-200 text-red-600 hover:bg-red-50 rounded-xl font-bold flex items-center justify-center gap-2\"\r\n                  >\r\n                    <XCircle className=\"w-5 h-5\" />\r\n                    {language === 'ru' ? 'Отказать' : 'Rad etish'}\r\n                  </button>\r\n                  <button\r\n                    onClick={handleAllowEntry}\r\n                    className=\"flex-1 py-4 bg-green-500 hover:bg-green-600 text-white rounded-xl font-bold flex items-center justify-center gap-2\"\r\n                  >\r\n                    <CheckCircle className=\"w-5 h-5\" />\r\n                    {language === 'ru' ? 'Пропустить' : 'O\\'tkazish'}\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <button\r\n                  onClick={() => setScanResult(null)}\r\n                  className=\"w-full py-4 bg-gray-100 hover:bg-gray-200 rounded-xl font-bold\"\r\n                >\r\n                  {language === 'ru' ? 'Сканировать ещё' : 'Yana skanerlash'}\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* No code data - just invalid */}\r\n          {!scanResult.code && (\r\n            <div className=\"p-6\">\r\n              <p className=\"text-center text-gray-600 mb-4\">\r\n                {language === 'ru'\r\n                  ? 'QR-код не является пропуском или повреждён'\r\n                  : 'QR-kod ruxsatnoma emas yoki buzilgan'}\r\n              </p>\r\n              <button\r\n                onClick={() => setScanResult(null)}\r\n                className=\"w-full py-4 bg-gray-100 hover:bg-gray-200 rounded-xl font-bold\"\r\n              >\r\n                {language === 'ru' ? 'Сканировать ещё' : 'Yana skanerlash'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* History */}\r\n      {showHistory && (\r\n        <div className=\"glass-card\">\r\n          <div className=\"p-4 border-b flex items-center justify-between\">\r\n            <h3 className=\"font-bold\">\r\n              {language === 'ru' ? 'История сканирований' : 'Skanerlash tarixi'}\r\n            </h3>\r\n            <button\r\n              onClick={() => setShowHistory(false)}\r\n              className=\"p-2 hover:bg-gray-100 rounded-xl\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          {recentLogs.length === 0 ? (\r\n            <div className=\"p-8 text-center text-gray-500\">\r\n              {language === 'ru' ? 'История пуста' : 'Tarix bo\\'sh'}\r\n            </div>\r\n          ) : (\r\n            <div className=\"divide-y\">\r\n              {recentLogs.map((log) => {\r\n                const isAllowed = log.action === 'entry_allowed' || log.action === 'scan_success';\r\n                const isDenied = log.action === 'entry_denied';\r\n\r\n                return (\r\n                  <div key={log.id} className=\"p-4 flex items-start gap-3\">\r\n                    <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${\r\n                      isAllowed ? 'bg-green-100 text-green-600' :\r\n                      isDenied ? 'bg-red-100 text-red-600' :\r\n                      'bg-amber-100 text-amber-600'\r\n                    }`}>\r\n                      {isAllowed ? <CheckCircle className=\"w-5 h-5\" /> :\r\n                       isDenied ? <XCircle className=\"w-5 h-5\" /> :\r\n                       <AlertTriangle className=\"w-5 h-5\" />}\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-lg\">{VISITOR_TYPE_LABELS[log.visitorType].icon}</span>\r\n                        <span className=\"font-medium truncate\">\r\n                          {log.residentName}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"text-sm text-gray-500\">\r\n                        {language === 'ru' ? 'кв.' : 'xona'} {log.residentApartment}\r\n                      </div>\r\n                      <div className=\"text-xs text-gray-400 mt-1\">\r\n                        {new Date(log.timestamp).toLocaleString(language === 'ru' ? 'ru-RU' : 'uz-UZ')}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"file":"GuardQRScannerPage-1769428875114-BQVWNcsi.js"}
{"version":3,"mappings":"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","names":["ResidentsPage","buildings","fetchBuildings","useCRMStore","addMockUser","additionalUsers","removeUser","updateUserPassword","getUserPassword","useAuthStore","viewLevel","setViewLevel","useState","selectedBranch","setSelectedBranch","selectedBuilding","setSelectedBuilding","selectedEntrance","setSelectedEntrance","branches","setBranches","entrances","setEntrances","isLoadingBranches","setIsLoadingBranches","isLoadingEntrances","setIsLoadingEntrances","apiResidents","setApiResidents","isLoadingResidents","setIsLoadingResidents","showUploadModal","setShowUploadModal","showAddManualModal","setShowAddManualModal","searchQuery","setSearchQuery","uploadedData","setUploadedData","uploadError","setUploadError","createdAccounts","setCreatedAccounts","showResidentCard","setShowResidentCard","editingPassword","setEditingPassword","newPassword","setNewPassword","showPassword","setShowPassword","deleteConfirm","setDeleteConfirm","deleteAllConfirm","setDeleteAllConfirm","isDeleting","setIsDeleting","isCreating","setIsCreating","progressMessage","setProgressMessage","fileInputRef","useRef","DEFAULT_PASSWORD","useEffect","fetchBranches","fetchEntrancesForBuilding","fetchResidents","response","apiRequest","buildingId","result","usersApi","filteredBuildings","b","handleBranchClick","branch","handleBuildingClick","building","handleEntranceClick","entrance","handleBack","extractBuildingFromAddress","address","buildingPattern","uzMatch","ruMatch","generatePassword","apartment","bldg","getResidentPassword","resident","storedPassword","residentBuilding","apartmentFromAddress","extractApartmentFromAddress","apartmentNumber","buildingFromAddress","bldgNum","localResidents","_","data","userLogin","allResidents","r","filteredResidents","query","lastNumberMatch","calculateEntranceAndFloor","aptNum","apartmentsPerFloor","apartmentsPerEntrance","positionInEntrance","floor","isNonResidential","handleFileUpload","useCallback","event","file","XLSX","__vitePreload","arrayBuffer","workbook","sheetName","worksheet","jsonData","rows","parseExcelData","headerRowIndex","accountCol","nameCol","addressCol","areaCol","findColumnInRow","row","names","name","idx","h","i","acc","addr","area","x","startRow","accIdx","nameIdx","addrIdx","v","personalAccount","fullName","totalArea","rawValue","areaStr","parsed","hasDecimal","createAccountsFromData","usersToCreate","skippedNonResidential","index","login","residentAddress","password","message","authApi","createdCount","updatedCount","allAccounts","u","error","manualForm","setManualForm","handleManualAdd","handleDeleteResident","apiResident","err","handleDeleteAllResidents","deletedCount","total","residentId","copyToClipboard","text","renderResidentsList","jsxs","jsx","Search","e","Trash2","Loader2","Users","RefreshCw","Upload","n","Key","Home","MapPin","ChevronRight","GitBranch","Building2","ArrowLeft","DoorOpen","UserPlus","entranceResidents","CheckCircle","Fragment","X","FileSpreadsheet","AlertCircle","Check","Copy","EyeOff","Eye","Save","Edit3","Phone"],"ignoreList":[],"sources":["../../src/pages/ResidentsPage.tsx"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\r\nimport {\r\n  Building2, Users, Upload, FileSpreadsheet, X, Check, Search,\r\n  MapPin, UserPlus, Key, Copy, Trash2, Edit3, Eye, EyeOff, Save,\r\n  AlertCircle, ChevronRight, Home, CheckCircle, Phone, Loader2, RefreshCw,\r\n  GitBranch, ArrowLeft, DoorOpen\r\n} from 'lucide-react';\r\nimport { useCRMStore } from '../stores/crmStore';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { authApi, usersApi, apiRequest } from '../services/api';\r\nimport type { BuildingFull } from '../types';\r\n\r\n// Branch type (from API)\r\ninterface Branch {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  address?: string;\r\n  phone?: string;\r\n  buildings_count: number;\r\n  residents_count: number;\r\n}\r\n\r\n// Entrance type\r\ninterface Entrance {\r\n  id: string;\r\n  building_id: string;\r\n  number: number;\r\n  floors_from?: number;\r\n  floors_to?: number;\r\n  apartments_from?: number;\r\n  apartments_to?: number;\r\n  has_elevator?: number;\r\n  intercom_type?: string;\r\n  intercom_code?: string;\r\n}\r\n\r\n// Navigation levels\r\ntype ViewLevel = 'branches' | 'buildings' | 'entrances' | 'residents';\r\n\r\n// Resident from API\r\ninterface ApiResident {\r\n  id: string;\r\n  login: string;\r\n  name: string;\r\n  phone?: string;\r\n  address?: string;\r\n  apartment?: string;\r\n  building_id?: string;\r\n  entrance?: string;\r\n  floor?: string;\r\n  created_at?: string;\r\n}\r\n\r\n// Excel parser interface\r\ninterface ExcelRow {\r\n  personalAccount: string;\r\n  fullName: string;\r\n  address: string;\r\n  totalArea?: number; // Площадь квартиры в кв.м\r\n}\r\n\r\nexport function ResidentsPage() {\r\n  const { buildings, fetchBuildings } = useCRMStore();\r\n  const { addMockUser, additionalUsers, removeUser, updateUserPassword, getUserPassword } = useAuthStore();\r\n\r\n  // Navigation state\r\n  const [viewLevel, setViewLevel] = useState<ViewLevel>('branches');\r\n  const [selectedBranch, setSelectedBranch] = useState<Branch | null>(null);\r\n  const [selectedBuilding, setSelectedBuilding] = useState<BuildingFull | null>(null);\r\n  const [selectedEntrance, setSelectedEntrance] = useState<Entrance | null>(null);\r\n\r\n  // Data\r\n  const [branches, setBranches] = useState<Branch[]>([]);\r\n  const [entrances, setEntrances] = useState<Entrance[]>([]);\r\n  const [isLoadingBranches, setIsLoadingBranches] = useState(false);\r\n  const [isLoadingEntrances, setIsLoadingEntrances] = useState(false);\r\n\r\n  // API loaded residents\r\n  const [apiResidents, setApiResidents] = useState<ApiResident[]>([]);\r\n  const [isLoadingResidents, setIsLoadingResidents] = useState(false);\r\n\r\n  const [showUploadModal, setShowUploadModal] = useState(false);\r\n  const [showAddManualModal, setShowAddManualModal] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [uploadedData, setUploadedData] = useState<ExcelRow[]>([]);\r\n  const [uploadError, setUploadError] = useState('');\r\n  const [createdAccounts, setCreatedAccounts] = useState<{login: string; name: string}[]>([]);\r\n  const [showResidentCard, setShowResidentCard] = useState<{id?: string; login: string; name: string; address?: string; apartment?: string; phone?: string; branch?: string; building?: string} | null>(null);\r\n  const [editingPassword, setEditingPassword] = useState(false);\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [deleteConfirm, setDeleteConfirm] = useState<{login: string; name: string} | null>(null);\r\n  const [deleteAllConfirm, setDeleteAllConfirm] = useState(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [isCreating, setIsCreating] = useState(false);\r\n  const [progressMessage, setProgressMessage] = useState('');\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const DEFAULT_PASSWORD = 'kamizo';\r\n\r\n  // Load branches on mount\r\n  useEffect(() => {\r\n    fetchBranches();\r\n  }, []);\r\n\r\n  // Load buildings when branch is selected\r\n  useEffect(() => {\r\n    if (selectedBranch) {\r\n      fetchBuildings();\r\n    }\r\n  }, [selectedBranch, fetchBuildings]);\r\n\r\n  // Load entrances when building is selected\r\n  useEffect(() => {\r\n    if (selectedBuilding) {\r\n      fetchEntrancesForBuilding(selectedBuilding.id);\r\n      fetchResidents(selectedBuilding.id);\r\n    }\r\n  }, [selectedBuilding]);\r\n\r\n  const fetchBranches = async () => {\r\n    setIsLoadingBranches(true);\r\n    try {\r\n      const response = await apiRequest<{ branches: Branch[] }>('/api/branches');\r\n      setBranches(response.branches || []);\r\n    } catch (error) {\r\n      console.error('Failed to fetch branches:', error);\r\n    } finally {\r\n      setIsLoadingBranches(false);\r\n    }\r\n  };\r\n\r\n  const fetchEntrancesForBuilding = async (buildingId: string) => {\r\n    setIsLoadingEntrances(true);\r\n    try {\r\n      const response = await apiRequest<{ entrances: Entrance[] }>(`/api/buildings/${buildingId}/entrances`);\r\n      setEntrances(response.entrances || []);\r\n    } catch (error) {\r\n      console.error('Failed to fetch entrances:', error);\r\n      setEntrances([]);\r\n    } finally {\r\n      setIsLoadingEntrances(false);\r\n    }\r\n  };\r\n\r\n  const fetchResidents = async (buildingId?: string) => {\r\n    setIsLoadingResidents(true);\r\n    try {\r\n      const result = await usersApi.getAll({\r\n        role: 'resident',\r\n        building_id: buildingId,\r\n        limit: 5000,\r\n      });\r\n      setApiResidents(result.users || []);\r\n    } catch (err) {\r\n      console.error('Failed to fetch residents:', err);\r\n      setApiResidents([]);\r\n    } finally {\r\n      setIsLoadingResidents(false);\r\n    }\r\n  };\r\n\r\n  // Filter buildings by selected branch\r\n  const filteredBuildings = selectedBranch\r\n    ? buildings.filter(b => b.branchCode === selectedBranch.code)\r\n    : buildings;\r\n\r\n  // Navigation handlers\r\n  const handleBranchClick = (branch: Branch) => {\r\n    setSelectedBranch(branch);\r\n    setViewLevel('buildings');\r\n    setSearchQuery('');\r\n  };\r\n\r\n  const handleBuildingClick = (building: BuildingFull) => {\r\n    setSelectedBuilding(building);\r\n    setViewLevel('entrances');\r\n    setSearchQuery('');\r\n  };\r\n\r\n  const handleEntranceClick = (entrance: Entrance) => {\r\n    setSelectedEntrance(entrance);\r\n    setViewLevel('residents');\r\n    setSearchQuery('');\r\n  };\r\n\r\n  const handleBack = () => {\r\n    if (viewLevel === 'residents') {\r\n      setSelectedEntrance(null);\r\n      setViewLevel('entrances');\r\n    } else if (viewLevel === 'entrances') {\r\n      setSelectedBuilding(null);\r\n      setEntrances([]);\r\n      setApiResidents([]);\r\n      setViewLevel('buildings');\r\n    } else if (viewLevel === 'buildings') {\r\n      setSelectedBranch(null);\r\n      setViewLevel('branches');\r\n    }\r\n    setSearchQuery('');\r\n  };\r\n\r\n  // Extract building number from address (supports formats like 93, 93A, 93/2, 93-2, 93/2A)\r\n  const extractBuildingFromAddress = (address: string): string => {\r\n    if (!address) return '';\r\n\r\n    // Pattern to match building numbers: 93, 93A, 93/2, 93-2, 93/2A, etc.\r\n    const buildingPattern = '(\\\\d+(?:[/\\\\-]\\\\d+)?[А-Яа-яA-Za-z]?)';\r\n\r\n    // Uzbek format: 93-уй, 93/2-уй, уй 93, уй 93/2\r\n    const uzMatch = address.match(new RegExp(buildingPattern + '-уй|уй\\\\s*' + buildingPattern, 'i'));\r\n    if (uzMatch) {\r\n      const num = (uzMatch[1] || uzMatch[2]).toUpperCase();\r\n      return num.replace(/Б/gi, 'B').replace(/А/gi, 'A');\r\n    }\r\n\r\n    // Russian format: дом 93, дом 93/2, д. 93, д. 93-2\r\n    const ruMatch = address.match(new RegExp('(?:дом|д\\\\.?)\\\\s*' + buildingPattern, 'i'));\r\n    if (ruMatch) {\r\n      const num = ruMatch[1].toUpperCase();\r\n      return num.replace(/Б/gi, 'B').replace(/А/gi, 'A');\r\n    }\r\n\r\n    return '';\r\n  };\r\n\r\n  // Generate password\r\n  const generatePassword = (building: BuildingFull | null, apartment: string, address?: string): string => {\r\n    if (!building?.branchCode) {\r\n      return DEFAULT_PASSWORD;\r\n    }\r\n    const branch = building.branchCode.toUpperCase();\r\n    let bldg = address ? extractBuildingFromAddress(address) : '';\r\n    if (!bldg && building?.buildingNumber) {\r\n      bldg = building.buildingNumber.toUpperCase();\r\n    }\r\n    if (!bldg) {\r\n      return DEFAULT_PASSWORD;\r\n    }\r\n    const apt = apartment || '0';\r\n    return `${branch}/${bldg}/${apt}`;\r\n  };\r\n\r\n  // Get password for resident\r\n  const getResidentPassword = (resident: { login: string; branch?: string; building?: string; apartment?: string; buildingId?: string; password?: string; address?: string }): string => {\r\n    if (resident.password) {\r\n      return resident.password;\r\n    }\r\n    const storedPassword = getUserPassword(resident.login);\r\n    if (storedPassword) {\r\n      return storedPassword;\r\n    }\r\n    const residentBuilding = buildings.find(b => b.id === resident.buildingId) || selectedBuilding;\r\n    // Try to get apartment from resident data, or extract from address if not available\r\n    const apartmentFromAddress = resident.address ? extractApartmentFromAddress(resident.address) : '';\r\n    const apartmentNumber = resident.apartment || apartmentFromAddress || '0';\r\n    const buildingFromAddress = resident.address ? extractBuildingFromAddress(resident.address) : '';\r\n\r\n    if (residentBuilding?.branchCode) {\r\n      const bldgNum = buildingFromAddress || residentBuilding?.buildingNumber?.toUpperCase() || '';\r\n      if (bldgNum) {\r\n        return `${residentBuilding.branchCode.toUpperCase()}/${bldgNum}/${apartmentNumber}`;\r\n      }\r\n    }\r\n\r\n    if (resident.branch && (buildingFromAddress || resident.building)) {\r\n      const bldgNum = buildingFromAddress || resident.building?.toUpperCase() || '';\r\n      return `${resident.branch.toUpperCase()}/${bldgNum}/${apartmentNumber}`;\r\n    }\r\n\r\n    return DEFAULT_PASSWORD;\r\n  };\r\n\r\n  // Get local residents\r\n  const localResidents = Object.entries(additionalUsers)\r\n    .filter(([_, data]) => data.user.role === 'resident')\r\n    .map(([userLogin, data]) => ({\r\n      ...data.user,\r\n      login: userLogin,\r\n      password: data.password\r\n    }));\r\n\r\n  // Use API residents as primary source\r\n  const allResidents = apiResidents.length > 0\r\n    ? apiResidents.map(r => ({\r\n        id: r.id,\r\n        login: r.login,\r\n        name: r.name,\r\n        phone: r.phone,\r\n        address: r.address,\r\n        apartment: r.apartment,\r\n        buildingId: r.building_id,\r\n        entrance: r.entrance,\r\n        floor: r.floor,\r\n        createdAt: r.created_at\r\n      }))\r\n    : localResidents;\r\n\r\n  // Filter residents by selected entrance\r\n  const buildingResidents = selectedEntrance\r\n    ? allResidents.filter(r =>\r\n        r.buildingId === selectedBuilding?.id &&\r\n        r.entrance === String(selectedEntrance.number)\r\n      )\r\n    : allResidents.filter(r => r.buildingId === selectedBuilding?.id);\r\n\r\n  // Filter by search\r\n  const filteredResidents = buildingResidents.filter(r => {\r\n    if (!searchQuery) return true;\r\n    const query = searchQuery.toLowerCase();\r\n    return (\r\n      r.name.toLowerCase().includes(query) ||\r\n      r.login.toLowerCase().includes(query) ||\r\n      r.address?.toLowerCase().includes(query) ||\r\n      r.apartment?.toLowerCase().includes(query) ||\r\n      r.phone?.toLowerCase().includes(query)\r\n    );\r\n  });\r\n\r\n  // Extract apartment from address (supports кв, kv, квартира, apt formats)\r\n  const extractApartmentFromAddress = (address: string): string => {\r\n    // Uzbek format: 5-хонадон or хонадон 5\r\n    const uzMatch = address.match(/(\\d+)-хонадон|хонадон\\s*(\\d+)/i);\r\n    if (uzMatch) {\r\n      return uzMatch[1] || uzMatch[2];\r\n    }\r\n    // Russian/Latin format: кв, кв., kv, kv., квартира, apt, apt.\r\n    const ruMatch = address.match(/(?:кв\\.?|kv\\.?|квартира|apt\\.?)\\s*(\\d+)/i);\r\n    if (ruMatch) {\r\n      return ruMatch[1];\r\n    }\r\n    // Fallback: last number after comma\r\n    const lastNumberMatch = address.match(/,\\s*(\\d+)\\s*$/);\r\n    if (lastNumberMatch) {\r\n      return lastNumberMatch[1];\r\n    }\r\n    return '';\r\n  };\r\n\r\n  // Calculate entrance and floor\r\n  const calculateEntranceAndFloor = (apartment: string): { entrance: string; floor: string } => {\r\n    const aptNum = parseInt(apartment);\r\n    if (isNaN(aptNum) || aptNum <= 0) return { entrance: '', floor: '' };\r\n\r\n    const apartmentsPerFloor = 4;\r\n    const floorsPerEntrance = 9;\r\n    const apartmentsPerEntrance = apartmentsPerFloor * floorsPerEntrance;\r\n\r\n    const entrance = Math.ceil(aptNum / apartmentsPerEntrance);\r\n    const positionInEntrance = ((aptNum - 1) % apartmentsPerEntrance);\r\n    const floor = Math.floor(positionInEntrance / apartmentsPerFloor) + 1;\r\n\r\n    return {\r\n      entrance: String(entrance),\r\n      floor: String(floor),\r\n    };\r\n  };\r\n\r\n  // Check if non-residential\r\n  const isNonResidential = (address: string): boolean => {\r\n    return /(?:неж\\.?|нежилое)/i.test(address);\r\n  };\r\n\r\n  // Parse Excel file\r\n  const handleFileUpload = useCallback(async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setUploadError('');\r\n\r\n    try {\r\n      const XLSX = await import('xlsx');\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      const workbook = XLSX.read(arrayBuffer, { type: 'array' });\r\n      const sheetName = workbook.SheetNames[0];\r\n      const worksheet = workbook.Sheets[sheetName];\r\n      const jsonData = XLSX.utils.sheet_to_json<Record<string, unknown>>(worksheet, { header: 1 });\r\n\r\n      if (jsonData.length < 2) {\r\n        setUploadError('Файл пустой или имеет неверный формат');\r\n        return;\r\n      }\r\n\r\n      const rows = parseExcelData(jsonData as unknown as string[][]);\r\n\r\n      if (rows.length === 0) {\r\n        setUploadError(`Не удалось найти данные. Проверьте формат файла.`);\r\n        return;\r\n      }\r\n\r\n      setUploadedData(rows);\r\n    } catch {\r\n      setUploadError('Ошибка при чтении файла');\r\n    }\r\n\r\n    if (event.target) {\r\n      event.target.value = '';\r\n    }\r\n  }, []);\r\n\r\n  // Parse Excel data\r\n  const parseExcelData = (data: string[][]): ExcelRow[] => {\r\n    if (data.length < 1) return [];\r\n\r\n    let headerRowIndex = -1;\r\n    let accountCol = -1;\r\n    let nameCol = -1;\r\n    let addressCol = -1;\r\n    let areaCol = -1;\r\n\r\n    const findColumnInRow = (row: string[], names: string[]): number => {\r\n      if (!row) return -1;\r\n      for (const name of names) {\r\n        const idx = row.findIndex(h => String(h || '').toLowerCase().trim().includes(name));\r\n        if (idx !== -1) return idx;\r\n      }\r\n      return -1;\r\n    };\r\n\r\n    for (let i = 0; i < Math.min(10, data.length); i++) {\r\n      const row = data[i];\r\n      if (!row) continue;\r\n\r\n      const acc = findColumnInRow(row, ['л/с', 'лицевой', 'л.с', 'лс']);\r\n      const name = findColumnInRow(row, ['фио', 'абонент']);\r\n      const addr = findColumnInRow(row, ['адрес']);\r\n      const area = findColumnInRow(row, ['площадь', 'кв.м', 'кв м', 's кв', 'sкв', 'общая площадь']);\r\n\r\n      const foundCount = [acc, name, addr].filter(x => x >= 0).length;\r\n      if (foundCount >= 2) {\r\n        headerRowIndex = i;\r\n        accountCol = acc;\r\n        nameCol = name;\r\n        addressCol = addr;\r\n        areaCol = area;\r\n        break;\r\n      }\r\n    }\r\n\r\n    const startRow = headerRowIndex >= 0 ? headerRowIndex + 1 : 0;\r\n    const accIdx = accountCol >= 0 ? accountCol : 0;\r\n    const nameIdx = nameCol >= 0 ? nameCol : 1;\r\n    const addrIdx = addressCol >= 0 ? addressCol : 2;\r\n\r\n    const rows: ExcelRow[] = [];\r\n\r\n    for (let i = startRow; i < data.length; i++) {\r\n      const row = data[i];\r\n      if (!row || row.every(v => !v)) continue;\r\n\r\n      let personalAccount = String(row[accIdx] || '').trim();\r\n      personalAccount = personalAccount.replace(/\\s+/g, '');\r\n\r\n      const fullName = String(row[nameIdx] || '').trim();\r\n      const address = String(row[addrIdx] || '').trim();\r\n\r\n      // Parse area - can be number or string with comma/dot\r\n      // Excel sometimes stores 98.39 as 9839 (multiplied by 100 without decimal)\r\n      let totalArea: number | undefined;\r\n      if (areaCol >= 0 && row[areaCol]) {\r\n        const rawValue = row[areaCol];\r\n        let areaStr = String(rawValue).replace(',', '.').replace(/[^\\d.]/g, '');\r\n        let parsed = parseFloat(areaStr);\r\n\r\n        if (!isNaN(parsed) && parsed > 0) {\r\n          // If no decimal point in original and value > 1000, it's likely scaled by 100\r\n          // Normal apartment areas are 20-300 m², so 2000+ is suspicious\r\n          const hasDecimal = String(rawValue).includes('.') || String(rawValue).includes(',');\r\n          if (!hasDecimal && parsed > 1000) {\r\n            // Divide by 100 to get real area (e.g., 9839 -> 98.39)\r\n            parsed = parsed / 100;\r\n          }\r\n          // Additional sanity check: if still > 500, might be scaled by 10\r\n          if (parsed > 500 && !hasDecimal) {\r\n            parsed = parsed / 10;\r\n          }\r\n          totalArea = Math.round(parsed * 100) / 100; // Round to 2 decimals\r\n        }\r\n      }\r\n\r\n      if (!fullName) continue;\r\n      if (fullName.toLowerCase().includes('фио') || fullName.toLowerCase().includes('абонент')) continue;\r\n\r\n      rows.push({\r\n        personalAccount,\r\n        fullName,\r\n        address: address || selectedBuilding?.address || '',\r\n        totalArea,\r\n      });\r\n    }\r\n\r\n    return rows;\r\n  };\r\n\r\n  // Create accounts from data\r\n  const createAccountsFromData = async () => {\r\n    const usersToCreate: any[] = [];\r\n    let skippedNonResidential = 0;\r\n\r\n    uploadedData.forEach((row, index) => {\r\n      if (!row.fullName) return;\r\n\r\n      if (isNonResidential(row.address)) {\r\n        skippedNonResidential++;\r\n        return;\r\n      }\r\n\r\n      const login = row.personalAccount\r\n        ? row.personalAccount.trim().replace(/\\s+/g, '')\r\n        : `${Date.now()}_${index}`;\r\n\r\n      if (additionalUsers[login]) return;\r\n\r\n      const apartment = extractApartmentFromAddress(row.address);\r\n      const { entrance, floor } = calculateEntranceAndFloor(apartment);\r\n      const buildingId = selectedBuilding?.id || '';\r\n      const residentAddress = row.address || selectedBuilding?.address || '';\r\n      const password = generatePassword(selectedBuilding, apartment, residentAddress);\r\n\r\n      usersToCreate.push({\r\n        login,\r\n        password,\r\n        name: row.fullName,\r\n        role: 'resident',\r\n        phone: '',\r\n        address: row.address || selectedBuilding?.address || '',\r\n        apartment,\r\n        building_id: buildingId,\r\n        entrance,\r\n        floor,\r\n        total_area: row.totalArea || null,\r\n      });\r\n    });\r\n\r\n    if (usersToCreate.length === 0) {\r\n      const message = skippedNonResidential > 0\r\n        ? `Нет новых пользователей для создания. Пропущено ${skippedNonResidential} нежилых помещений.`\r\n        : 'Нет новых пользователей для создания';\r\n      setUploadError(message);\r\n      return;\r\n    }\r\n\r\n    setIsCreating(true);\r\n    setProgressMessage(`Создание ${usersToCreate.length} аккаунтов...`);\r\n\r\n    try {\r\n      const result = await authApi.registerBulk(usersToCreate);\r\n      const createdCount = result.created?.length || 0;\r\n      const updatedCount = result.updated?.length || 0;\r\n\r\n      if (createdCount > 0 || updatedCount > 0) {\r\n        const allAccounts = [...(result.created || []), ...(result.updated || [])];\r\n        setCreatedAccounts(allAccounts.map((u: any) => ({ login: u.login, name: u.name })));\r\n      }\r\n\r\n      setUploadedData([]);\r\n      setShowUploadModal(false);\r\n      setProgressMessage(`Готово! Создано: ${createdCount}, Обновлено: ${updatedCount}`);\r\n\r\n      if (selectedBuilding) {\r\n        await fetchResidents(selectedBuilding.id);\r\n      }\r\n\r\n      setTimeout(() => setProgressMessage(''), 3000);\r\n    } catch (error: any) {\r\n      setUploadError(error.message || 'Ошибка при массовой регистрации');\r\n      setProgressMessage('');\r\n    } finally {\r\n      setIsCreating(false);\r\n    }\r\n  };\r\n\r\n  // Manual add resident form\r\n  const [manualForm, setManualForm] = useState({\r\n    fullName: '',\r\n    phone: '',\r\n    address: '',\r\n    personalAccount: '',\r\n  });\r\n\r\n  const handleManualAdd = async () => {\r\n    if (!manualForm.fullName) return;\r\n\r\n    const login = manualForm.personalAccount\r\n      ? manualForm.personalAccount.trim()\r\n      : `${Date.now()}`;\r\n\r\n    const apartment = extractApartmentFromAddress(manualForm.address);\r\n    const buildingId = selectedBuilding?.id || '';\r\n    const residentAddress = manualForm.address || selectedBuilding?.address || '';\r\n    const password = generatePassword(selectedBuilding, apartment, residentAddress);\r\n\r\n    setIsCreating(true);\r\n    setProgressMessage('Создание аккаунта...');\r\n\r\n    try {\r\n      await authApi.register({\r\n        login,\r\n        password,\r\n        name: manualForm.fullName,\r\n        role: 'resident',\r\n        phone: manualForm.phone,\r\n        address: manualForm.address || selectedBuilding?.address || '',\r\n        apartment: apartment,\r\n        building_id: buildingId,\r\n        entrance: '',\r\n        floor: '',\r\n        branch: selectedBuilding?.branchCode,\r\n        building: selectedBuilding?.buildingNumber,\r\n      });\r\n\r\n      addMockUser(login, password, {\r\n        id: `res_${Date.now()}`,\r\n        phone: manualForm.phone,\r\n        name: manualForm.fullName,\r\n        login,\r\n        role: 'resident',\r\n        address: manualForm.address || selectedBuilding?.address || '',\r\n        apartment: apartment,\r\n        buildingId: buildingId,\r\n        branch: selectedBuilding?.branchCode,\r\n        building: selectedBuilding?.buildingNumber,\r\n      });\r\n\r\n      setShowResidentCard({\r\n        login,\r\n        name: manualForm.fullName,\r\n        address: manualForm.address || selectedBuilding?.address || '',\r\n        apartment: apartment,\r\n        phone: manualForm.phone,\r\n      });\r\n      setShowPassword(true);\r\n\r\n      setManualForm({\r\n        fullName: '',\r\n        phone: '',\r\n        address: '',\r\n        personalAccount: '',\r\n      });\r\n      setShowAddManualModal(false);\r\n\r\n      if (selectedBuilding) {\r\n        await fetchResidents(selectedBuilding.id);\r\n      }\r\n\r\n      setProgressMessage('Аккаунт создан!');\r\n      setTimeout(() => setProgressMessage(''), 2000);\r\n    } catch (error: any) {\r\n      console.error('Manual registration error:', error);\r\n      alert('Ошибка создания: ' + (error.message || 'Неизвестная ошибка'));\r\n      setProgressMessage('');\r\n    } finally {\r\n      setIsCreating(false);\r\n    }\r\n  };\r\n\r\n  // Delete resident\r\n  const handleDeleteResident = async (login: string) => {\r\n    setIsDeleting(true);\r\n    try {\r\n      const apiResident = apiResidents.find(r => r.login === login);\r\n      if (apiResident?.id) {\r\n        await usersApi.delete(apiResident.id);\r\n      }\r\n      removeUser(login);\r\n      if (selectedBuilding) {\r\n        await fetchResidents(selectedBuilding.id);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to delete resident:', err);\r\n      alert('Ошибка при удалении: ' + (err as Error).message);\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteConfirm(null);\r\n      setShowResidentCard(null);\r\n    }\r\n  };\r\n\r\n  // Delete all residents\r\n  const handleDeleteAllResidents = async () => {\r\n    setIsDeleting(true);\r\n    setProgressMessage(`Удаление ${filteredResidents.length} жителей...`);\r\n    let deletedCount = 0;\r\n    const total = filteredResidents.length;\r\n\r\n    try {\r\n      for (let i = 0; i < filteredResidents.length; i++) {\r\n        const resident = filteredResidents[i];\r\n        setProgressMessage(`Удаление ${i + 1}/${total}: ${resident.name.split(' ')[0]}...`);\r\n\r\n        try {\r\n          let residentId = (resident as any).id;\r\n\r\n          if (!residentId) {\r\n            const apiResident = apiResidents.find(r => r.login === resident.login);\r\n            residentId = apiResident?.id;\r\n          }\r\n\r\n          if (residentId) {\r\n            await usersApi.delete(residentId);\r\n            deletedCount++;\r\n          }\r\n          removeUser(resident.login);\r\n        } catch (err) {\r\n          console.error(`Failed to delete ${resident.login}:`, err);\r\n        }\r\n      }\r\n\r\n      setProgressMessage(`Удалено ${deletedCount} жителей`);\r\n\r\n      if (selectedBuilding) {\r\n        await fetchResidents(selectedBuilding.id);\r\n      }\r\n\r\n      setTimeout(() => setProgressMessage(''), 3000);\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteAllConfirm(false);\r\n    }\r\n  };\r\n\r\n  // Copy to clipboard\r\n  const copyToClipboard = (text: string) => {\r\n    navigator.clipboard.writeText(text);\r\n  };\r\n\r\n  // Render residents list\r\n  const renderResidentsList = () => (\r\n    <div className=\"space-y-3\">\r\n      {/* Search */}\r\n      <div className=\"glass-card p-4\">\r\n        <div className=\"relative\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Поиск по имени, телефону, квартире...\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            className=\"input-field pl-10\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Residents count and actions */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"text-sm text-gray-500\">\r\n          Найдено: <strong>{filteredResidents.length}</strong> жителей\r\n        </div>\r\n        {filteredResidents.length > 0 && (\r\n          <button\r\n            onClick={() => setDeleteAllConfirm(true)}\r\n            className=\"btn-secondary flex items-center gap-2 text-red-600 border-red-200 hover:bg-red-50 text-sm\"\r\n          >\r\n            <Trash2 className=\"w-4 h-4\" />\r\n            Удалить всех\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* List */}\r\n      {isLoadingResidents ? (\r\n        <div className=\"glass-card p-8 text-center\">\r\n          <Loader2 className=\"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin\" />\r\n          <p className=\"text-gray-500\">Загрузка жителей...</p>\r\n        </div>\r\n      ) : filteredResidents.length === 0 ? (\r\n        <div className=\"glass-card p-8 text-center\">\r\n          <Users className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\r\n          <h3 className=\"text-lg font-medium text-gray-600\">Жители не найдены</h3>\r\n          <p className=\"text-gray-400 mt-1 mb-4\">\r\n            Загрузите Excel файл с данными жителей\r\n          </p>\r\n          <div className=\"flex items-center justify-center gap-3\">\r\n            <button\r\n              onClick={() => selectedBuilding && fetchResidents(selectedBuilding.id)}\r\n              className=\"btn-secondary inline-flex items-center gap-2\"\r\n            >\r\n              <RefreshCw className=\"w-4 h-4\" />\r\n              Обновить\r\n            </button>\r\n            <button\r\n              onClick={() => setShowUploadModal(true)}\r\n              className=\"btn-primary inline-flex items-center gap-2\"\r\n            >\r\n              <Upload className=\"w-4 h-4\" />\r\n              Загрузить Excel\r\n            </button>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        filteredResidents.map((resident) => (\r\n          <div\r\n            key={resident.login}\r\n            className=\"glass-card p-4 cursor-pointer hover:shadow-lg transition-shadow\"\r\n            onClick={() => {\r\n              setShowResidentCard(resident);\r\n              setEditingPassword(false);\r\n              setNewPassword('');\r\n              setShowPassword(false);\r\n            }}\r\n          >\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center text-lg font-medium text-white shadow-sm\">\r\n                  {resident.name.split(' ').map(n => n[0]).join('').slice(0, 2)}\r\n                </div>\r\n                <div className=\"min-w-0 flex-1\">\r\n                  <h3 className=\"font-semibold text-gray-900\">{resident.name}</h3>\r\n                  <div className=\"flex items-center flex-wrap gap-2 text-sm mt-1\">\r\n                    <span className=\"flex items-center gap-1 bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-mono text-xs\">\r\n                      <Key className=\"w-3 h-3\" />\r\n                      {resident.login}\r\n                    </span>\r\n                    {resident.apartment && (\r\n                      <span className=\"flex items-center gap-1 text-gray-500\">\r\n                        <Home className=\"w-3.5 h-3.5\" />\r\n                        кв. {resident.apartment}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  {resident.address && (\r\n                    <div className=\"flex items-center gap-1 text-xs text-gray-400 mt-1 truncate\">\r\n                      <MapPin className=\"w-3 h-3 flex-shrink-0\" />\r\n                      <span className=\"truncate\">{resident.address}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <ChevronRight className=\"w-5 h-5 text-gray-400\" />\r\n            </div>\r\n          </div>\r\n        ))\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Жители</h1>\r\n          <p className=\"text-gray-500 mt-1\">Управление аккаунтами жителей</p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Step 1: Branch Selection */}\r\n      {viewLevel === 'branches' && (\r\n        <div>\r\n          <h2 className=\"text-lg font-semibold mb-4\">Выберите филиал</h2>\r\n          {isLoadingBranches ? (\r\n            <div className=\"glass-card p-8 text-center\">\r\n              <Loader2 className=\"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin\" />\r\n              <p className=\"text-gray-500\">Загрузка филиалов...</p>\r\n            </div>\r\n          ) : branches.length === 0 ? (\r\n            <div className=\"glass-card p-8 text-center\">\r\n              <GitBranch className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\r\n              <h3 className=\"text-lg font-medium text-gray-600\">Филиалы не найдены</h3>\r\n              <p className=\"text-gray-400 mt-1\">\r\n                Добавьте филиалы в разделе \"Дома/Объекты\"\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {branches.map((branch) => (\r\n                <button\r\n                  key={branch.id}\r\n                  onClick={() => handleBranchClick(branch)}\r\n                  className=\"glass-card p-5 text-left hover:shadow-lg transition-shadow group\"\r\n                >\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl flex items-center justify-center\">\r\n                        <span className=\"text-white font-bold text-lg\">{branch.code}</span>\r\n                      </div>\r\n                      <div>\r\n                        <h3 className=\"font-semibold\">{branch.name}</h3>\r\n                        <div className=\"text-sm text-gray-500\">Филиал {branch.code}</div>\r\n                      </div>\r\n                    </div>\r\n                    <ChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors\" />\r\n                  </div>\r\n                  <div className=\"mt-4 flex items-center gap-4 text-sm\">\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Building2 className=\"w-4 h-4 text-gray-400\" />\r\n                      <span>{branch.buildings_count} домов</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Users className=\"w-4 h-4 text-gray-400\" />\r\n                      <span>{branch.residents_count} жителей</span>\r\n                    </div>\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Step 2: Building Selection */}\r\n      {viewLevel === 'buildings' && selectedBranch && (\r\n        <div>\r\n          {/* Branch Header */}\r\n          <div className=\"glass-card p-4 mb-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <button\r\n                onClick={handleBack}\r\n                className=\"p-2 hover:bg-white/50 rounded-lg transition-colors\"\r\n              >\r\n                <ArrowLeft className=\"w-5 h-5\" />\r\n              </button>\r\n              <div className=\"w-10 h-10 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl flex items-center justify-center\">\r\n                <span className=\"text-white font-bold\">{selectedBranch.code}</span>\r\n              </div>\r\n              <div>\r\n                <h2 className=\"font-semibold\">{selectedBranch.name}</h2>\r\n                <p className=\"text-sm text-gray-500\">Выберите дом</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {filteredBuildings.length === 0 ? (\r\n            <div className=\"glass-card p-8 text-center\">\r\n              <Building2 className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\r\n              <h3 className=\"text-lg font-medium text-gray-600\">Дома не найдены</h3>\r\n              <p className=\"text-gray-400 mt-1\">\r\n                Добавьте дома в этот филиал в разделе \"Дома/Объекты\"\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {filteredBuildings.map((building) => (\r\n                <button\r\n                  key={building.id}\r\n                  onClick={() => handleBuildingClick(building)}\r\n                  className=\"glass-card p-5 text-left hover:shadow-lg transition-shadow group\"\r\n                >\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-xl flex items-center justify-center\">\r\n                        <Home className=\"w-6 h-6 text-white\" />\r\n                      </div>\r\n                      <div>\r\n                        <h3 className=\"font-semibold\">Дом {building.buildingNumber || building.name}</h3>\r\n                        <div className=\"flex items-center gap-1 text-sm text-gray-500\">\r\n                          <MapPin className=\"w-3 h-3\" />\r\n                          {building.address}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <ChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors\" />\r\n                  </div>\r\n                  <div className=\"mt-4 flex items-center gap-4 text-sm\">\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Home className=\"w-4 h-4 text-gray-400\" />\r\n                      <span>{building.totalApartments} кв.</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <DoorOpen className=\"w-4 h-4 text-gray-400\" />\r\n                      <span>{building.entrances} подъездов</span>\r\n                    </div>\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Step 3: Entrances/Residents */}\r\n      {viewLevel === 'entrances' && selectedBuilding && (\r\n        <div>\r\n          {/* Building Header with Breadcrumb */}\r\n          <div className=\"glass-card p-4 mb-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <button\r\n                  onClick={handleBack}\r\n                  className=\"p-2 hover:bg-white/50 rounded-lg transition-colors\"\r\n                >\r\n                  <ArrowLeft className=\"w-5 h-5\" />\r\n                </button>\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <button\r\n                    onClick={() => {\r\n                      setViewLevel('branches');\r\n                      setSelectedBranch(null);\r\n                      setSelectedBuilding(null);\r\n                    }}\r\n                    className=\"text-gray-500 hover:text-primary-600\"\r\n                  >\r\n                    Филиалы\r\n                  </button>\r\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\r\n                  <button\r\n                    onClick={handleBack}\r\n                    className=\"text-gray-500 hover:text-primary-600\"\r\n                  >\r\n                    {selectedBranch?.name}\r\n                  </button>\r\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\r\n                  <span className=\"font-medium text-gray-900\">\r\n                    Дом {selectedBuilding.buildingNumber || selectedBuilding.name}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={() => setShowAddManualModal(true)}\r\n                  className=\"btn-secondary flex items-center gap-2\"\r\n                >\r\n                  <UserPlus className=\"w-4 h-4\" />\r\n                  <span className=\"hidden sm:inline\">Добавить</span>\r\n                </button>\r\n                <button\r\n                  onClick={() => setShowUploadModal(true)}\r\n                  className=\"btn-primary flex items-center gap-2\"\r\n                >\r\n                  <Upload className=\"w-4 h-4\" />\r\n                  <span className=\"hidden sm:inline\">Excel</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Entrance selection or direct residents view */}\r\n          {isLoadingEntrances ? (\r\n            <div className=\"glass-card p-8 text-center\">\r\n              <Loader2 className=\"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin\" />\r\n              <p className=\"text-gray-500\">Загрузка подъездов...</p>\r\n            </div>\r\n          ) : entrances.length > 0 ? (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {entrances.map((entrance) => {\r\n                const entranceResidents = allResidents.filter(r =>\r\n                  r.buildingId === selectedBuilding.id &&\r\n                  r.entrance === String(entrance.number)\r\n                );\r\n                return (\r\n                  <button\r\n                    key={entrance.id}\r\n                    onClick={() => handleEntranceClick(entrance)}\r\n                    className=\"glass-card p-5 text-left hover:shadow-lg transition-shadow group\"\r\n                  >\r\n                    <div className=\"flex items-start justify-between\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-12 h-12 bg-gradient-to-br from-green-400 to-teal-500 rounded-xl flex items-center justify-center\">\r\n                          <DoorOpen className=\"w-6 h-6 text-white\" />\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"font-semibold\">Подъезд {entrance.number}</h3>\r\n                          <div className=\"text-sm text-gray-500\">\r\n                            {entrance.floors_from && entrance.floors_to && (\r\n                              <span>Этажи {entrance.floors_from}-{entrance.floors_to}</span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <ChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors\" />\r\n                    </div>\r\n                    <div className=\"mt-4 flex items-center gap-4 text-sm\">\r\n                      {entrance.apartments_from && entrance.apartments_to && (\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <Home className=\"w-4 h-4 text-gray-400\" />\r\n                          <span>кв. {entrance.apartments_from}-{entrance.apartments_to}</span>\r\n                        </div>\r\n                      )}\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <Users className=\"w-4 h-4 text-gray-400\" />\r\n                        <span>{entranceResidents.length} жителей</span>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          ) : (\r\n            // No entrances - show residents directly\r\n            renderResidentsList()\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Step 4: Residents for selected entrance */}\r\n      {viewLevel === 'residents' && selectedEntrance && selectedBuilding && (\r\n        <div>\r\n          {/* Entrance Header with Breadcrumb */}\r\n          <div className=\"glass-card p-4 mb-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <button\r\n                  onClick={handleBack}\r\n                  className=\"p-2 hover:bg-white/50 rounded-lg transition-colors\"\r\n                >\r\n                  <ArrowLeft className=\"w-5 h-5\" />\r\n                </button>\r\n                <div className=\"flex items-center gap-2 text-sm flex-wrap\">\r\n                  <button\r\n                    onClick={() => {\r\n                      setViewLevel('branches');\r\n                      setSelectedBranch(null);\r\n                      setSelectedBuilding(null);\r\n                      setSelectedEntrance(null);\r\n                    }}\r\n                    className=\"text-gray-500 hover:text-primary-600\"\r\n                  >\r\n                    Филиалы\r\n                  </button>\r\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\r\n                  <button\r\n                    onClick={() => {\r\n                      setViewLevel('buildings');\r\n                      setSelectedBuilding(null);\r\n                      setSelectedEntrance(null);\r\n                    }}\r\n                    className=\"text-gray-500 hover:text-primary-600\"\r\n                  >\r\n                    {selectedBranch?.name}\r\n                  </button>\r\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\r\n                  <button\r\n                    onClick={handleBack}\r\n                    className=\"text-gray-500 hover:text-primary-600\"\r\n                  >\r\n                    Дом {selectedBuilding.buildingNumber || selectedBuilding.name}\r\n                  </button>\r\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\r\n                  <span className=\"font-medium text-gray-900\">\r\n                    Подъезд {selectedEntrance.number}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={() => setShowAddManualModal(true)}\r\n                  className=\"btn-secondary flex items-center gap-2\"\r\n                >\r\n                  <UserPlus className=\"w-4 h-4\" />\r\n                  <span className=\"hidden sm:inline\">Добавить</span>\r\n                </button>\r\n                <button\r\n                  onClick={() => setShowUploadModal(true)}\r\n                  className=\"btn-primary flex items-center gap-2\"\r\n                >\r\n                  <Upload className=\"w-4 h-4\" />\r\n                  <span className=\"hidden sm:inline\">Excel</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {renderResidentsList()}\r\n        </div>\r\n      )}\r\n\r\n      {/* Progress Indicator */}\r\n      {(isCreating || isDeleting || progressMessage) && (\r\n        <div className=\"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 z-50 glass-card p-4 max-w-sm shadow-xl animate-fade-in\">\r\n          <div className=\"flex items-center gap-3\">\r\n            {(isCreating || isDeleting) && (\r\n              <div className=\"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0\">\r\n                <Loader2 className=\"w-5 h-5 text-primary-600 animate-spin\" />\r\n              </div>\r\n            )}\r\n            {!isCreating && !isDeleting && progressMessage && (\r\n              <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\r\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\r\n              </div>\r\n            )}\r\n            <div className=\"flex-1\">\r\n              <p className=\"font-medium text-gray-900\">{progressMessage}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Created Accounts Notification */}\r\n      {createdAccounts.length > 0 && !progressMessage && (\r\n        <div className=\"fixed bottom-4 right-4 z-50 glass-card p-4 max-w-sm shadow-xl animate-fade-in\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\r\n              <CheckCircle className=\"w-5 h-5 text-green-600\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <h4 className=\"font-semibold text-green-800\">\r\n                Обработано {createdAccounts.length} аккаунтов\r\n              </h4>\r\n              <p className=\"text-sm text-gray-600 mt-1\">\r\n                {selectedBuilding?.branchCode && selectedBuilding?.buildingNumber ? (\r\n                  <>Формат пароля: <code className=\"bg-gray-100 px-1 rounded\">{selectedBuilding.branchCode}/{selectedBuilding.buildingNumber}/[кв]</code></>\r\n                ) : (\r\n                  <>Пароль по умолчанию: <code className=\"bg-gray-100 px-1 rounded\">{DEFAULT_PASSWORD}</code></>\r\n                )}\r\n              </p>\r\n              <button\r\n                onClick={() => setCreatedAccounts([])}\r\n                className=\"text-sm text-primary-600 hover:text-primary-700 mt-2\"\r\n              >\r\n                Понятно\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Upload Modal */}\r\n      {showUploadModal && (\r\n        <div className=\"modal-backdrop\">\r\n          <div className=\"modal-content p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <h2 className=\"text-xl font-bold\">Загрузка данных жителей</h2>\r\n              <button\r\n                onClick={() => {\r\n                  setShowUploadModal(false);\r\n                  setUploadedData([]);\r\n                  setUploadError('');\r\n                }}\r\n                className=\"p-2 hover:bg-white/30 rounded-lg\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            {uploadedData.length === 0 ? (\r\n              <>\r\n                <div\r\n                  className=\"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-primary-400 transition-colors cursor-pointer\"\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                >\r\n                  <FileSpreadsheet className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\r\n                  <h3 className=\"font-semibold text-gray-700 mb-2\">\r\n                    Загрузите XLS/XLSX файл\r\n                  </h3>\r\n                  <p className=\"text-sm text-gray-500 mb-4\">\r\n                    Файл должен содержать столбцы: <strong>Л/С</strong>, <strong>ФИО абонента</strong>, <strong>Адрес</strong>, <strong>Площадь (кв.м)</strong>\r\n                  </p>\r\n                  <button className=\"btn-primary\">\r\n                    Выбрать файл\r\n                  </button>\r\n                </div>\r\n\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  accept=\".csv,.xlsx,.xls\"\r\n                  onChange={handleFileUpload}\r\n                  className=\"hidden\"\r\n                />\r\n\r\n                {uploadError && (\r\n                  <div className=\"mt-4 p-3 bg-red-50 text-red-700 rounded-lg flex items-center gap-2\">\r\n                    <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\r\n                    {uploadError}\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"mt-6 p-4 bg-gray-50 rounded-xl\">\r\n                  <h4 className=\"font-medium text-gray-700 mb-2\">Пример формата файла:</h4>\r\n                  <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead>\r\n                        <tr className=\"border-b\">\r\n                          <th className=\"text-left p-2\">Л/С</th>\r\n                          <th className=\"text-left p-2\">ФИО абонента</th>\r\n                          <th className=\"text-left p-2\">Адрес</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        <tr>\r\n                          <td className=\"p-2\">12345678</td>\r\n                          <td className=\"p-2\">Иванов Иван Иванович</td>\r\n                          <td className=\"p-2\">ул. Мустакиллик, 15, кв. 42</td>\r\n                        </tr>\r\n                        <tr>\r\n                          <td className=\"p-2\">12345679</td>\r\n                          <td className=\"p-2\">Петрова Анна Сергеевна</td>\r\n                          <td className=\"p-2\">ул. Мустакиллик, 15, кв. 18</td>\r\n                        </tr>\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div className=\"mb-4\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <h3 className=\"font-semibold\">\r\n                      Найдено записей: {uploadedData.length}\r\n                    </h3>\r\n                    <button\r\n                      onClick={() => setUploadedData([])}\r\n                      className=\"text-sm text-gray-500 hover:text-gray-700\"\r\n                    >\r\n                      Загрузить другой файл\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div className=\"max-h-64 overflow-y-auto border rounded-xl\">\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead className=\"bg-gray-50 sticky top-0\">\r\n                        <tr className=\"border-b\">\r\n                          <th className=\"text-left p-3\">Л/С</th>\r\n                          <th className=\"text-left p-3\">ФИО абонента</th>\r\n                          <th className=\"text-left p-3\">Адрес</th>\r\n                          <th className=\"text-left p-3\">Площадь, м²</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {uploadedData.slice(0, 20).map((row, idx) => (\r\n                          <tr key={idx} className=\"border-b last:border-b-0\">\r\n                            <td className=\"p-3\">{row.personalAccount}</td>\r\n                            <td className=\"p-3\">{row.fullName}</td>\r\n                            <td className=\"p-3\">{row.address}</td>\r\n                            <td className=\"p-3\">{row.totalArea ? `${row.totalArea} м²` : '—'}</td>\r\n                          </tr>\r\n                        ))}\r\n                        {uploadedData.length > 20 && (\r\n                          <tr>\r\n                            <td colSpan={4} className=\"p-3 text-center text-gray-500\">\r\n                              и еще {uploadedData.length - 20} записей...\r\n                            </td>\r\n                          </tr>\r\n                        )}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-3 bg-blue-50 text-blue-700 rounded-xl mb-4 text-sm\">\r\n                  {selectedBuilding?.branchCode && selectedBuilding?.buildingNumber ? (\r\n                    <>\r\n                      <strong>Формат пароля:</strong> {selectedBuilding.branchCode}/{selectedBuilding.buildingNumber}/[номер квартиры]\r\n                      <br />\r\n                      <span className=\"text-blue-600\">\r\n                        Например: {selectedBuilding.branchCode}/{selectedBuilding.buildingNumber}/23 для квартиры 23\r\n                      </span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <strong>Пароль по умолчанию:</strong> {DEFAULT_PASSWORD}\r\n                      <br />\r\n                      <span className=\"text-blue-600\">\r\n                        Жители смогут изменить пароль в личном кабинете\r\n                      </span>\r\n                    </>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    onClick={() => setUploadedData([])}\r\n                    className=\"btn-secondary flex-1\"\r\n                  >\r\n                    Отмена\r\n                  </button>\r\n                  <button\r\n                    onClick={createAccountsFromData}\r\n                    disabled={isCreating}\r\n                    className=\"btn-primary flex-1 flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                  >\r\n                    {isCreating ? (\r\n                      <>\r\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                        Создание...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Check className=\"w-4 h-4\" />\r\n                        Создать {uploadedData.length} аккаунтов\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Manual Add Modal */}\r\n      {showAddManualModal && (\r\n        <div className=\"modal-backdrop\">\r\n          <div className=\"modal-content p-6 w-full max-w-md mx-4\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <h2 className=\"text-xl font-bold\">Добавить жителя</h2>\r\n              <button\r\n                onClick={() => setShowAddManualModal(false)}\r\n                className=\"p-2 hover:bg-white/30 rounded-lg\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Л/С (Лицевой счет)</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={manualForm.personalAccount}\r\n                  onChange={(e) => setManualForm({...manualForm, personalAccount: e.target.value})}\r\n                  className=\"input-field\"\r\n                  placeholder=\"12345678\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ФИО абонента *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={manualForm.fullName}\r\n                  onChange={(e) => setManualForm({...manualForm, fullName: e.target.value})}\r\n                  className=\"input-field\"\r\n                  placeholder=\"Иванов Иван Иванович\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Адрес</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={manualForm.address}\r\n                  onChange={(e) => setManualForm({...manualForm, address: e.target.value})}\r\n                  className=\"input-field\"\r\n                  placeholder=\"ул. Мустакиллик, 15, кв. 42\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Телефон</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  value={manualForm.phone}\r\n                  onChange={(e) => setManualForm({...manualForm, phone: e.target.value})}\r\n                  className=\"input-field\"\r\n                  placeholder=\"+998 90 123 45 67\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"p-3 bg-gray-50 rounded-xl text-sm text-gray-600\">\r\n                <strong>Пароль:</strong> {selectedBuilding?.branchCode && selectedBuilding?.buildingNumber\r\n                  ? `${selectedBuilding.branchCode}/${selectedBuilding.buildingNumber}/[кв]`\r\n                  : DEFAULT_PASSWORD}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex gap-3 mt-6\">\r\n              <button\r\n                onClick={() => setShowAddManualModal(false)}\r\n                className=\"btn-secondary flex-1\"\r\n              >\r\n                Отмена\r\n              </button>\r\n              <button\r\n                onClick={handleManualAdd}\r\n                disabled={!manualForm.fullName}\r\n                className=\"btn-primary flex-1 disabled:opacity-50\"\r\n              >\r\n                Создать аккаунт\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Resident Card Modal */}\r\n      {showResidentCard && (\r\n        <div className=\"modal-backdrop\">\r\n          <div className=\"modal-content p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <h2 className=\"text-xl font-bold\">Карточка жителя</h2>\r\n              <button\r\n                onClick={() => {\r\n                  setShowResidentCard(null);\r\n                  setEditingPassword(false);\r\n                  setNewPassword('');\r\n                }}\r\n                className=\"p-2 hover:bg-white/30 rounded-lg\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"text-center mb-6\">\r\n              <div className=\"w-20 h-20 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg\">\r\n                <span className=\"text-2xl font-bold text-white\">\r\n                  {showResidentCard.name.split(' ').map(n => n[0]).join('').slice(0, 2)}\r\n                </span>\r\n              </div>\r\n              <h3 className=\"text-xl font-bold text-gray-900\">{showResidentCard.name}</h3>\r\n            </div>\r\n\r\n            <div className=\"space-y-3 mb-6\">\r\n              <div className=\"p-4 bg-blue-50 rounded-xl\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n                      <Key className=\"w-5 h-5 text-blue-600\" />\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-xs text-blue-600 font-medium\">Л/С (Логин)</div>\r\n                      <div className=\"font-mono font-bold text-blue-900\">{showResidentCard.login}</div>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => copyToClipboard(showResidentCard.login)}\r\n                    className=\"p-2 hover:bg-blue-100 rounded-lg transition-colors\"\r\n                    title=\"Копировать\"\r\n                  >\r\n                    <Copy className=\"w-4 h-4 text-blue-600\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-4 bg-gray-50 rounded-xl\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center\">\r\n                      <Key className=\"w-5 h-5 text-gray-600\" />\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-500 font-medium\">Пароль</div>\r\n                      {!editingPassword ? (\r\n                        <div className=\"font-mono font-bold text-gray-900 flex items-center gap-2\">\r\n                          {showPassword ? getResidentPassword(showResidentCard) : '••••••••'}\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={(e) => {\r\n                              e.preventDefault();\r\n                              e.stopPropagation();\r\n                              setShowPassword(!showPassword);\r\n                            }}\r\n                            className=\"p-2 hover:bg-gray-200 active:bg-gray-300 rounded touch-manipulation z-10\"\r\n                          >\r\n                            {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\r\n                          </button>\r\n                        </div>\r\n                      ) : (\r\n                        <input\r\n                          type=\"text\"\r\n                          value={newPassword}\r\n                          onChange={(e) => setNewPassword(e.target.value)}\r\n                          placeholder=\"Новый пароль\"\r\n                          className=\"input-field text-sm py-1 px-2 w-40\"\r\n                          autoFocus\r\n                        />\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-1\">\r\n                    {!editingPassword ? (\r\n                      <>\r\n                        <button\r\n                          onClick={() => copyToClipboard(getResidentPassword(showResidentCard))}\r\n                          className=\"p-2 hover:bg-gray-200 rounded-lg transition-colors\"\r\n                          title=\"Копировать\"\r\n                        >\r\n                          <Copy className=\"w-4 h-4 text-gray-600\" />\r\n                        </button>\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingPassword(true);\r\n                            setNewPassword(getResidentPassword(showResidentCard));\r\n                          }}\r\n                          className=\"p-2 hover:bg-gray-200 rounded-lg transition-colors\"\r\n                          title=\"Изменить пароль\"\r\n                        >\r\n                          <Edit3 className=\"w-4 h-4 text-gray-600\" />\r\n                        </button>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <button\r\n                          onClick={async () => {\r\n                            if (newPassword.length >= 4 && showResidentCard.id) {\r\n                              try {\r\n                                // Save to database\r\n                                await usersApi.adminChangePassword(showResidentCard.id, newPassword);\r\n                                // Also save locally for display\r\n                                updateUserPassword(showResidentCard.login, newPassword);\r\n                                setEditingPassword(false);\r\n                                setShowPassword(true);\r\n                              } catch (err: any) {\r\n                                alert('Ошибка сохранения пароля: ' + err.message);\r\n                              }\r\n                            }\r\n                          }}\r\n                          disabled={newPassword.length < 4}\r\n                          className=\"p-2 hover:bg-green-100 rounded-lg transition-colors disabled:opacity-50\"\r\n                          title=\"Сохранить\"\r\n                        >\r\n                          <Save className=\"w-4 h-4 text-green-600\" />\r\n                        </button>\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingPassword(false);\r\n                            setNewPassword('');\r\n                          }}\r\n                          className=\"p-2 hover:bg-gray-200 rounded-lg transition-colors\"\r\n                          title=\"Отмена\"\r\n                        >\r\n                          <X className=\"w-4 h-4 text-gray-600\" />\r\n                        </button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {editingPassword && newPassword.length > 0 && newPassword.length < 4 && (\r\n                  <p className=\"text-xs text-red-500 mt-1 ml-13\">Минимум 4 символа</p>\r\n                )}\r\n              </div>\r\n\r\n              {showResidentCard.address && (\r\n                <div className=\"p-4 bg-gray-50 rounded-xl\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                      <MapPin className=\"w-5 h-5 text-gray-600\" />\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-500 font-medium\">Адрес</div>\r\n                      <div className=\"font-medium text-gray-900\">{showResidentCard.address}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {showResidentCard.apartment && (\r\n                <div className=\"p-4 bg-gray-50 rounded-xl\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center\">\r\n                      <Home className=\"w-5 h-5 text-gray-600\" />\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-500 font-medium\">Квартира / Помещение</div>\r\n                      <div className=\"font-bold text-gray-900\">{showResidentCard.apartment}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {showResidentCard.phone && (\r\n                <div className=\"p-4 bg-gray-50 rounded-xl\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center\">\r\n                      <Phone className=\"w-5 h-5 text-gray-600\" />\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-500 font-medium\">Телефон</div>\r\n                      <div className=\"font-medium text-gray-900\">{showResidentCard.phone}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => setDeleteConfirm({ login: showResidentCard.login, name: showResidentCard.name })}\r\n                className=\"btn-secondary flex-1 flex items-center justify-center gap-2 text-red-600 border-red-200 hover:bg-red-50\"\r\n              >\r\n                <Trash2 className=\"w-4 h-4\" />\r\n                Удалить\r\n              </button>\r\n              <button\r\n                onClick={() => setShowResidentCard(null)}\r\n                className=\"btn-primary flex-1\"\r\n              >\r\n                Закрыть\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {deleteConfirm && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4\">\r\n          <div className=\"bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl\">\r\n            <div className=\"flex items-center justify-center w-14 h-14 rounded-full bg-red-100 mx-auto mb-4\">\r\n              <AlertCircle className=\"w-7 h-7 text-red-600\" />\r\n            </div>\r\n            <h3 className=\"text-lg font-bold text-center mb-2\">\r\n              Удалить жителя?\r\n            </h3>\r\n            <p className=\"text-gray-500 text-center text-sm mb-2\">\r\n              {deleteConfirm.name}\r\n            </p>\r\n            <p className=\"text-gray-400 text-center text-xs mb-6\">\r\n              Это действие нельзя отменить. Житель потеряет доступ к системе.\r\n            </p>\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => setDeleteConfirm(null)}\r\n                disabled={isDeleting}\r\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50\"\r\n              >\r\n                Отмена\r\n              </button>\r\n              <button\r\n                onClick={() => handleDeleteResident(deleteConfirm.login)}\r\n                disabled={isDeleting}\r\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium text-white bg-red-500 hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\r\n              >\r\n                {isDeleting ? (\r\n                  <>\r\n                    <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                    Удаление...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                    Удалить\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete All Confirmation Modal */}\r\n      {deleteAllConfirm && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4\">\r\n          <div className=\"bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl\">\r\n            <div className=\"flex items-center justify-center w-14 h-14 rounded-full bg-red-100 mx-auto mb-4\">\r\n              <Trash2 className=\"w-7 h-7 text-red-600\" />\r\n            </div>\r\n            <h3 className=\"text-lg font-bold text-center mb-2\">\r\n              Удалить всех жителей?\r\n            </h3>\r\n            <p className=\"text-gray-500 text-center text-sm mb-2\">\r\n              Будет удалено: <strong>{filteredResidents.length}</strong> жителей\r\n            </p>\r\n            <p className=\"text-gray-400 text-center text-xs mb-6\">\r\n              Это действие нельзя отменить. Все жители потеряют доступ к системе.\r\n            </p>\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => setDeleteAllConfirm(false)}\r\n                disabled={isDeleting}\r\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50\"\r\n              >\r\n                Отмена\r\n              </button>\r\n              <button\r\n                onClick={handleDeleteAllResidents}\r\n                disabled={isDeleting}\r\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium text-white bg-red-500 hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\r\n              >\r\n                {isDeleting ? (\r\n                  <>\r\n                    <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                    Удаление...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                    Удалить всех\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"file":"ResidentsPage-1768932757711-CrFfuX0_.js"}
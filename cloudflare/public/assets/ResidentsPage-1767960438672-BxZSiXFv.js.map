{"version":3,"mappings":"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","names":["ResidentsPage","buildings","fetchBuildings","useCRMStore","addMockUser","additionalUsers","removeUser","updateUserPassword","getUserPassword","useAuthStore","viewLevel","setViewLevel","useState","selectedBranch","setSelectedBranch","selectedBuilding","setSelectedBuilding","selectedEntrance","setSelectedEntrance","branches","setBranches","entrances","setEntrances","isLoadingBranches","setIsLoadingBranches","isLoadingEntrances","setIsLoadingEntrances","apiResidents","setApiResidents","isLoadingResidents","setIsLoadingResidents","showUploadModal","setShowUploadModal","showAddManualModal","setShowAddManualModal","searchQuery","setSearchQuery","uploadedData","setUploadedData","uploadError","setUploadError","createdAccounts","setCreatedAccounts","showResidentCard","setShowResidentCard","editingPassword","setEditingPassword","newPassword","setNewPassword","showPassword","setShowPassword","deleteConfirm","setDeleteConfirm","deleteAllConfirm","setDeleteAllConfirm","isDeleting","setIsDeleting","isCreating","setIsCreating","progressMessage","setProgressMessage","fileInputRef","useRef","DEFAULT_PASSWORD","useEffect","fetchBranches","fetchEntrancesForBuilding","fetchResidents","response","apiRequest","buildingId","result","usersApi","filteredBuildings","b","handleBranchClick","branch","handleBuildingClick","building","handleEntranceClick","entrance","handleBack","extractBuildingFromAddress","address","buildingPattern","uzMatch","ruMatch","generatePassword","apartment","bldg","getResidentPassword","resident","storedPassword","residentBuilding","apartmentFromAddress","extractApartmentFromAddress","apartmentNumber","buildingFromAddress","bldgNum","localResidents","_","data","userLogin","allResidents","r","filteredResidents","query","lastNumberMatch","calculateEntranceAndFloor","aptNum","apartmentsPerFloor","apartmentsPerEntrance","positionInEntrance","floor","isNonResidential","handleFileUpload","useCallback","event","file","XLSX","__vitePreload","arrayBuffer","workbook","sheetName","worksheet","jsonData","rows","parseExcelData","headerRowIndex","accountCol","nameCol","addressCol","areaCol","findColumnInRow","row","names","name","idx","h","i","acc","addr","area","x","startRow","accIdx","nameIdx","addrIdx","v","personalAccount","fullName","totalArea","rawValue","areaStr","parsed","hasDecimal","createAccountsFromData","usersToCreate","skippedNonResidential","index","login","residentAddress","password","message","authApi","createdCount","updatedCount","allAccounts","u","error","manualForm","setManualForm","handleManualAdd","handleDeleteResident","apiResident","err","handleDeleteAllResidents","deletedCount","total","residentId","copyToClipboard","text","renderResidentsList","jsxs","jsx","Search","e","Trash2","Loader2","Users","RefreshCw","Upload","n","Key","Home","MapPin","ChevronRight","GitBranch","Building2","ArrowLeft","DoorOpen","UserPlus","entranceResidents","CheckCircle","Fragment","X","FileSpreadsheet","AlertCircle","Check","Copy","EyeOff","Eye","Save","Edit3","Phone"],"ignoreList":[],"sources":["../../src/pages/ResidentsPage.tsx"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\nimport {\n  Building2, Users, Upload, FileSpreadsheet, X, Check, Search,\n  MapPin, UserPlus, Key, Copy, Trash2, Edit3, Eye, EyeOff, Save,\n  AlertCircle, ChevronRight, Home, CheckCircle, Phone, Loader2, RefreshCw,\n  GitBranch, ArrowLeft, DoorOpen\n} from 'lucide-react';\nimport { useCRMStore } from '../stores/crmStore';\nimport { useAuthStore } from '../stores/authStore';\nimport { authApi, usersApi, apiRequest } from '../services/api';\nimport type { BuildingFull } from '../types';\n\n// Branch type (from API)\ninterface Branch {\n  id: string;\n  code: string;\n  name: string;\n  address?: string;\n  phone?: string;\n  buildings_count: number;\n  residents_count: number;\n}\n\n// Entrance type\ninterface Entrance {\n  id: string;\n  building_id: string;\n  number: number;\n  floors_from?: number;\n  floors_to?: number;\n  apartments_from?: number;\n  apartments_to?: number;\n  has_elevator?: number;\n  intercom_type?: string;\n  intercom_code?: string;\n}\n\n// Navigation levels\ntype ViewLevel = 'branches' | 'buildings' | 'entrances' | 'residents';\n\n// Resident from API\ninterface ApiResident {\n  id: string;\n  login: string;\n  name: string;\n  phone?: string;\n  address?: string;\n  apartment?: string;\n  building_id?: string;\n  entrance?: string;\n  floor?: string;\n  created_at?: string;\n}\n\n// Excel parser interface\ninterface ExcelRow {\n  personalAccount: string;\n  fullName: string;\n  address: string;\n  totalArea?: number; // Площадь квартиры в кв.м\n}\n\nexport function ResidentsPage() {\n  const { buildings, fetchBuildings } = useCRMStore();\n  const { addMockUser, additionalUsers, removeUser, updateUserPassword, getUserPassword } = useAuthStore();\n\n  // Navigation state\n  const [viewLevel, setViewLevel] = useState<ViewLevel>('branches');\n  const [selectedBranch, setSelectedBranch] = useState<Branch | null>(null);\n  const [selectedBuilding, setSelectedBuilding] = useState<BuildingFull | null>(null);\n  const [selectedEntrance, setSelectedEntrance] = useState<Entrance | null>(null);\n\n  // Data\n  const [branches, setBranches] = useState<Branch[]>([]);\n  const [entrances, setEntrances] = useState<Entrance[]>([]);\n  const [isLoadingBranches, setIsLoadingBranches] = useState(false);\n  const [isLoadingEntrances, setIsLoadingEntrances] = useState(false);\n\n  // API loaded residents\n  const [apiResidents, setApiResidents] = useState<ApiResident[]>([]);\n  const [isLoadingResidents, setIsLoadingResidents] = useState(false);\n\n  const [showUploadModal, setShowUploadModal] = useState(false);\n  const [showAddManualModal, setShowAddManualModal] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [uploadedData, setUploadedData] = useState<ExcelRow[]>([]);\n  const [uploadError, setUploadError] = useState('');\n  const [createdAccounts, setCreatedAccounts] = useState<{login: string; name: string}[]>([]);\n  const [showResidentCard, setShowResidentCard] = useState<{id?: string; login: string; name: string; address?: string; apartment?: string; phone?: string; branch?: string; building?: string} | null>(null);\n  const [editingPassword, setEditingPassword] = useState(false);\n  const [newPassword, setNewPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [deleteConfirm, setDeleteConfirm] = useState<{login: string; name: string} | null>(null);\n  const [deleteAllConfirm, setDeleteAllConfirm] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [isCreating, setIsCreating] = useState(false);\n  const [progressMessage, setProgressMessage] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const DEFAULT_PASSWORD = 'kamizo';\n\n  // Load branches on mount\n  useEffect(() => {\n    fetchBranches();\n  }, []);\n\n  // Load buildings when branch is selected\n  useEffect(() => {\n    if (selectedBranch) {\n      fetchBuildings();\n    }\n  }, [selectedBranch, fetchBuildings]);\n\n  // Load entrances when building is selected\n  useEffect(() => {\n    if (selectedBuilding) {\n      fetchEntrancesForBuilding(selectedBuilding.id);\n      fetchResidents(selectedBuilding.id);\n    }\n  }, [selectedBuilding]);\n\n  const fetchBranches = async () => {\n    setIsLoadingBranches(true);\n    try {\n      const response = await apiRequest<{ branches: Branch[] }>('/api/branches');\n      setBranches(response.branches || []);\n    } catch (error) {\n      console.error('Failed to fetch branches:', error);\n    } finally {\n      setIsLoadingBranches(false);\n    }\n  };\n\n  const fetchEntrancesForBuilding = async (buildingId: string) => {\n    setIsLoadingEntrances(true);\n    try {\n      const response = await apiRequest<{ entrances: Entrance[] }>(`/api/buildings/${buildingId}/entrances`);\n      setEntrances(response.entrances || []);\n    } catch (error) {\n      console.error('Failed to fetch entrances:', error);\n      setEntrances([]);\n    } finally {\n      setIsLoadingEntrances(false);\n    }\n  };\n\n  const fetchResidents = async (buildingId?: string) => {\n    setIsLoadingResidents(true);\n    try {\n      const result = await usersApi.getAll({\n        role: 'resident',\n        building_id: buildingId,\n        limit: 5000,\n      });\n      setApiResidents(result.users || []);\n    } catch (err) {\n      console.error('Failed to fetch residents:', err);\n      setApiResidents([]);\n    } finally {\n      setIsLoadingResidents(false);\n    }\n  };\n\n  // Filter buildings by selected branch\n  const filteredBuildings = selectedBranch\n    ? buildings.filter(b => b.branchCode === selectedBranch.code)\n    : buildings;\n\n  // Navigation handlers\n  const handleBranchClick = (branch: Branch) => {\n    setSelectedBranch(branch);\n    setViewLevel('buildings');\n    setSearchQuery('');\n  };\n\n  const handleBuildingClick = (building: BuildingFull) => {\n    setSelectedBuilding(building);\n    setViewLevel('entrances');\n    setSearchQuery('');\n  };\n\n  const handleEntranceClick = (entrance: Entrance) => {\n    setSelectedEntrance(entrance);\n    setViewLevel('residents');\n    setSearchQuery('');\n  };\n\n  const handleBack = () => {\n    if (viewLevel === 'residents') {\n      setSelectedEntrance(null);\n      setViewLevel('entrances');\n    } else if (viewLevel === 'entrances') {\n      setSelectedBuilding(null);\n      setEntrances([]);\n      setApiResidents([]);\n      setViewLevel('buildings');\n    } else if (viewLevel === 'buildings') {\n      setSelectedBranch(null);\n      setViewLevel('branches');\n    }\n    setSearchQuery('');\n  };\n\n  // Extract building number from address (supports formats like 93, 93A, 93/2, 93-2, 93/2A)\n  const extractBuildingFromAddress = (address: string): string => {\n    if (!address) return '';\n\n    // Pattern to match building numbers: 93, 93A, 93/2, 93-2, 93/2A, etc.\n    const buildingPattern = '(\\\\d+(?:[/\\\\-]\\\\d+)?[А-Яа-яA-Za-z]?)';\n\n    // Uzbek format: 93-уй, 93/2-уй, уй 93, уй 93/2\n    const uzMatch = address.match(new RegExp(buildingPattern + '-уй|уй\\\\s*' + buildingPattern, 'i'));\n    if (uzMatch) {\n      const num = (uzMatch[1] || uzMatch[2]).toUpperCase();\n      return num.replace(/Б/gi, 'B').replace(/А/gi, 'A');\n    }\n\n    // Russian format: дом 93, дом 93/2, д. 93, д. 93-2\n    const ruMatch = address.match(new RegExp('(?:дом|д\\\\.?)\\\\s*' + buildingPattern, 'i'));\n    if (ruMatch) {\n      const num = ruMatch[1].toUpperCase();\n      return num.replace(/Б/gi, 'B').replace(/А/gi, 'A');\n    }\n\n    return '';\n  };\n\n  // Generate password\n  const generatePassword = (building: BuildingFull | null, apartment: string, address?: string): string => {\n    if (!building?.branchCode) {\n      return DEFAULT_PASSWORD;\n    }\n    const branch = building.branchCode.toUpperCase();\n    let bldg = address ? extractBuildingFromAddress(address) : '';\n    if (!bldg && building?.buildingNumber) {\n      bldg = building.buildingNumber.toUpperCase();\n    }\n    if (!bldg) {\n      return DEFAULT_PASSWORD;\n    }\n    const apt = apartment || '0';\n    return `${branch}/${bldg}/${apt}`;\n  };\n\n  // Get password for resident\n  const getResidentPassword = (resident: { login: string; branch?: string; building?: string; apartment?: string; buildingId?: string; password?: string; address?: string }): string => {\n    if (resident.password) {\n      return resident.password;\n    }\n    const storedPassword = getUserPassword(resident.login);\n    if (storedPassword) {\n      return storedPassword;\n    }\n    const residentBuilding = buildings.find(b => b.id === resident.buildingId) || selectedBuilding;\n    // Try to get apartment from resident data, or extract from address if not available\n    const apartmentFromAddress = resident.address ? extractApartmentFromAddress(resident.address) : '';\n    const apartmentNumber = resident.apartment || apartmentFromAddress || '0';\n    const buildingFromAddress = resident.address ? extractBuildingFromAddress(resident.address) : '';\n\n    if (residentBuilding?.branchCode) {\n      const bldgNum = buildingFromAddress || residentBuilding?.buildingNumber?.toUpperCase() || '';\n      if (bldgNum) {\n        return `${residentBuilding.branchCode.toUpperCase()}/${bldgNum}/${apartmentNumber}`;\n      }\n    }\n\n    if (resident.branch && (buildingFromAddress || resident.building)) {\n      const bldgNum = buildingFromAddress || resident.building?.toUpperCase() || '';\n      return `${resident.branch.toUpperCase()}/${bldgNum}/${apartmentNumber}`;\n    }\n\n    return DEFAULT_PASSWORD;\n  };\n\n  // Get local residents\n  const localResidents = Object.entries(additionalUsers)\n    .filter(([_, data]) => data.user.role === 'resident')\n    .map(([userLogin, data]) => ({\n      ...data.user,\n      login: userLogin,\n      password: data.password\n    }));\n\n  // Use API residents as primary source\n  const allResidents = apiResidents.length > 0\n    ? apiResidents.map(r => ({\n        id: r.id,\n        login: r.login,\n        name: r.name,\n        phone: r.phone,\n        address: r.address,\n        apartment: r.apartment,\n        buildingId: r.building_id,\n        entrance: r.entrance,\n        floor: r.floor,\n        createdAt: r.created_at\n      }))\n    : localResidents;\n\n  // Filter residents by selected entrance\n  const buildingResidents = selectedEntrance\n    ? allResidents.filter(r =>\n        r.buildingId === selectedBuilding?.id &&\n        r.entrance === String(selectedEntrance.number)\n      )\n    : allResidents.filter(r => r.buildingId === selectedBuilding?.id);\n\n  // Filter by search\n  const filteredResidents = buildingResidents.filter(r => {\n    if (!searchQuery) return true;\n    const query = searchQuery.toLowerCase();\n    return (\n      r.name.toLowerCase().includes(query) ||\n      r.login.toLowerCase().includes(query) ||\n      r.address?.toLowerCase().includes(query) ||\n      r.apartment?.toLowerCase().includes(query) ||\n      r.phone?.toLowerCase().includes(query)\n    );\n  });\n\n  // Extract apartment from address (supports кв, kv, квартира, apt formats)\n  const extractApartmentFromAddress = (address: string): string => {\n    // Uzbek format: 5-хонадон or хонадон 5\n    const uzMatch = address.match(/(\\d+)-хонадон|хонадон\\s*(\\d+)/i);\n    if (uzMatch) {\n      return uzMatch[1] || uzMatch[2];\n    }\n    // Russian/Latin format: кв, кв., kv, kv., квартира, apt, apt.\n    const ruMatch = address.match(/(?:кв\\.?|kv\\.?|квартира|apt\\.?)\\s*(\\d+)/i);\n    if (ruMatch) {\n      return ruMatch[1];\n    }\n    // Fallback: last number after comma\n    const lastNumberMatch = address.match(/,\\s*(\\d+)\\s*$/);\n    if (lastNumberMatch) {\n      return lastNumberMatch[1];\n    }\n    return '';\n  };\n\n  // Calculate entrance and floor\n  const calculateEntranceAndFloor = (apartment: string): { entrance: string; floor: string } => {\n    const aptNum = parseInt(apartment);\n    if (isNaN(aptNum) || aptNum <= 0) return { entrance: '', floor: '' };\n\n    const apartmentsPerFloor = 4;\n    const floorsPerEntrance = 9;\n    const apartmentsPerEntrance = apartmentsPerFloor * floorsPerEntrance;\n\n    const entrance = Math.ceil(aptNum / apartmentsPerEntrance);\n    const positionInEntrance = ((aptNum - 1) % apartmentsPerEntrance);\n    const floor = Math.floor(positionInEntrance / apartmentsPerFloor) + 1;\n\n    return {\n      entrance: String(entrance),\n      floor: String(floor),\n    };\n  };\n\n  // Check if non-residential\n  const isNonResidential = (address: string): boolean => {\n    return /(?:неж\\.?|нежилое)/i.test(address);\n  };\n\n  // Parse Excel file\n  const handleFileUpload = useCallback(async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    setUploadError('');\n\n    try {\n      const XLSX = await import('xlsx');\n      const arrayBuffer = await file.arrayBuffer();\n      const workbook = XLSX.read(arrayBuffer, { type: 'array' });\n      const sheetName = workbook.SheetNames[0];\n      const worksheet = workbook.Sheets[sheetName];\n      const jsonData = XLSX.utils.sheet_to_json<Record<string, unknown>>(worksheet, { header: 1 });\n\n      if (jsonData.length < 2) {\n        setUploadError('Файл пустой или имеет неверный формат');\n        return;\n      }\n\n      const rows = parseExcelData(jsonData as unknown as string[][]);\n\n      if (rows.length === 0) {\n        setUploadError(`Не удалось найти данные. Проверьте формат файла.`);\n        return;\n      }\n\n      setUploadedData(rows);\n    } catch {\n      setUploadError('Ошибка при чтении файла');\n    }\n\n    if (event.target) {\n      event.target.value = '';\n    }\n  }, []);\n\n  // Parse Excel data\n  const parseExcelData = (data: string[][]): ExcelRow[] => {\n    if (data.length < 1) return [];\n\n    let headerRowIndex = -1;\n    let accountCol = -1;\n    let nameCol = -1;\n    let addressCol = -1;\n    let areaCol = -1;\n\n    const findColumnInRow = (row: string[], names: string[]): number => {\n      if (!row) return -1;\n      for (const name of names) {\n        const idx = row.findIndex(h => String(h || '').toLowerCase().trim().includes(name));\n        if (idx !== -1) return idx;\n      }\n      return -1;\n    };\n\n    for (let i = 0; i < Math.min(10, data.length); i++) {\n      const row = data[i];\n      if (!row) continue;\n\n      const acc = findColumnInRow(row, ['л/с', 'лицевой', 'л.с', 'лс']);\n      const name = findColumnInRow(row, ['фио', 'абонент']);\n      const addr = findColumnInRow(row, ['адрес']);\n      const area = findColumnInRow(row, ['площадь', 'кв.м', 'кв м', 's кв', 'sкв', 'общая площадь']);\n\n      const foundCount = [acc, name, addr].filter(x => x >= 0).length;\n      if (foundCount >= 2) {\n        headerRowIndex = i;\n        accountCol = acc;\n        nameCol = name;\n        addressCol = addr;\n        areaCol = area;\n        break;\n      }\n    }\n\n    const startRow = headerRowIndex >= 0 ? headerRowIndex + 1 : 0;\n    const accIdx = accountCol >= 0 ? accountCol : 0;\n    const nameIdx = nameCol >= 0 ? nameCol : 1;\n    const addrIdx = addressCol >= 0 ? addressCol : 2;\n\n    const rows: ExcelRow[] = [];\n\n    for (let i = startRow; i < data.length; i++) {\n      const row = data[i];\n      if (!row || row.every(v => !v)) continue;\n\n      let personalAccount = String(row[accIdx] || '').trim();\n      personalAccount = personalAccount.replace(/\\s+/g, '');\n\n      const fullName = String(row[nameIdx] || '').trim();\n      const address = String(row[addrIdx] || '').trim();\n\n      // Parse area - can be number or string with comma/dot\n      // Excel sometimes stores 98.39 as 9839 (multiplied by 100 without decimal)\n      let totalArea: number | undefined;\n      if (areaCol >= 0 && row[areaCol]) {\n        const rawValue = row[areaCol];\n        let areaStr = String(rawValue).replace(',', '.').replace(/[^\\d.]/g, '');\n        let parsed = parseFloat(areaStr);\n\n        if (!isNaN(parsed) && parsed > 0) {\n          // If no decimal point in original and value > 1000, it's likely scaled by 100\n          // Normal apartment areas are 20-300 m², so 2000+ is suspicious\n          const hasDecimal = String(rawValue).includes('.') || String(rawValue).includes(',');\n          if (!hasDecimal && parsed > 1000) {\n            // Divide by 100 to get real area (e.g., 9839 -> 98.39)\n            parsed = parsed / 100;\n          }\n          // Additional sanity check: if still > 500, might be scaled by 10\n          if (parsed > 500 && !hasDecimal) {\n            parsed = parsed / 10;\n          }\n          totalArea = Math.round(parsed * 100) / 100; // Round to 2 decimals\n        }\n      }\n\n      if (!fullName) continue;\n      if (fullName.toLowerCase().includes('фио') || fullName.toLowerCase().includes('абонент')) continue;\n\n      rows.push({\n        personalAccount,\n        fullName,\n        address: address || selectedBuilding?.address || '',\n        totalArea,\n      });\n    }\n\n    return rows;\n  };\n\n  // Create accounts from data\n  const createAccountsFromData = async () => {\n    const usersToCreate: any[] = [];\n    let skippedNonResidential = 0;\n\n    uploadedData.forEach((row, index) => {\n      if (!row.fullName) return;\n\n      if (isNonResidential(row.address)) {\n        skippedNonResidential++;\n        return;\n      }\n\n      const login = row.personalAccount\n        ? row.personalAccount.trim().replace(/\\s+/g, '')\n        : `${Date.now()}_${index}`;\n\n      if (additionalUsers[login]) return;\n\n      const apartment = extractApartmentFromAddress(row.address);\n      const { entrance, floor } = calculateEntranceAndFloor(apartment);\n      const buildingId = selectedBuilding?.id || '';\n      const residentAddress = row.address || selectedBuilding?.address || '';\n      const password = generatePassword(selectedBuilding, apartment, residentAddress);\n\n      usersToCreate.push({\n        login,\n        password,\n        name: row.fullName,\n        role: 'resident',\n        phone: '',\n        address: row.address || selectedBuilding?.address || '',\n        apartment,\n        building_id: buildingId,\n        entrance,\n        floor,\n        total_area: row.totalArea || null,\n      });\n    });\n\n    if (usersToCreate.length === 0) {\n      const message = skippedNonResidential > 0\n        ? `Нет новых пользователей для создания. Пропущено ${skippedNonResidential} нежилых помещений.`\n        : 'Нет новых пользователей для создания';\n      setUploadError(message);\n      return;\n    }\n\n    setIsCreating(true);\n    setProgressMessage(`Создание ${usersToCreate.length} аккаунтов...`);\n\n    try {\n      const result = await authApi.registerBulk(usersToCreate);\n      const createdCount = result.created?.length || 0;\n      const updatedCount = result.updated?.length || 0;\n\n      if (createdCount > 0 || updatedCount > 0) {\n        const allAccounts = [...(result.created || []), ...(result.updated || [])];\n        setCreatedAccounts(allAccounts.map((u: any) => ({ login: u.login, name: u.name })));\n      }\n\n      setUploadedData([]);\n      setShowUploadModal(false);\n      setProgressMessage(`Готово! Создано: ${createdCount}, Обновлено: ${updatedCount}`);\n\n      if (selectedBuilding) {\n        await fetchResidents(selectedBuilding.id);\n      }\n\n      setTimeout(() => setProgressMessage(''), 3000);\n    } catch (error: any) {\n      setUploadError(error.message || 'Ошибка при массовой регистрации');\n      setProgressMessage('');\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  // Manual add resident form\n  const [manualForm, setManualForm] = useState({\n    fullName: '',\n    phone: '',\n    address: '',\n    personalAccount: '',\n  });\n\n  const handleManualAdd = async () => {\n    if (!manualForm.fullName) return;\n\n    const login = manualForm.personalAccount\n      ? manualForm.personalAccount.trim()\n      : `${Date.now()}`;\n\n    const apartment = extractApartmentFromAddress(manualForm.address);\n    const buildingId = selectedBuilding?.id || '';\n    const residentAddress = manualForm.address || selectedBuilding?.address || '';\n    const password = generatePassword(selectedBuilding, apartment, residentAddress);\n\n    setIsCreating(true);\n    setProgressMessage('Создание аккаунта...');\n\n    try {\n      await authApi.register({\n        login,\n        password,\n        name: manualForm.fullName,\n        role: 'resident',\n        phone: manualForm.phone,\n        address: manualForm.address || selectedBuilding?.address || '',\n        apartment: apartment,\n        building_id: buildingId,\n        entrance: '',\n        floor: '',\n        branch: selectedBuilding?.branchCode,\n        building: selectedBuilding?.buildingNumber,\n      });\n\n      addMockUser(login, password, {\n        id: `res_${Date.now()}`,\n        phone: manualForm.phone,\n        name: manualForm.fullName,\n        login,\n        role: 'resident',\n        address: manualForm.address || selectedBuilding?.address || '',\n        apartment: apartment,\n        buildingId: buildingId,\n        branch: selectedBuilding?.branchCode,\n        building: selectedBuilding?.buildingNumber,\n      });\n\n      setShowResidentCard({\n        login,\n        name: manualForm.fullName,\n        address: manualForm.address || selectedBuilding?.address || '',\n        apartment: apartment,\n        phone: manualForm.phone,\n      });\n      setShowPassword(true);\n\n      setManualForm({\n        fullName: '',\n        phone: '',\n        address: '',\n        personalAccount: '',\n      });\n      setShowAddManualModal(false);\n\n      if (selectedBuilding) {\n        await fetchResidents(selectedBuilding.id);\n      }\n\n      setProgressMessage('Аккаунт создан!');\n      setTimeout(() => setProgressMessage(''), 2000);\n    } catch (error: any) {\n      console.error('Manual registration error:', error);\n      alert('Ошибка создания: ' + (error.message || 'Неизвестная ошибка'));\n      setProgressMessage('');\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  // Delete resident\n  const handleDeleteResident = async (login: string) => {\n    setIsDeleting(true);\n    try {\n      const apiResident = apiResidents.find(r => r.login === login);\n      if (apiResident?.id) {\n        await usersApi.delete(apiResident.id);\n      }\n      removeUser(login);\n      if (selectedBuilding) {\n        await fetchResidents(selectedBuilding.id);\n      }\n    } catch (err) {\n      console.error('Failed to delete resident:', err);\n      alert('Ошибка при удалении: ' + (err as Error).message);\n    } finally {\n      setIsDeleting(false);\n      setDeleteConfirm(null);\n      setShowResidentCard(null);\n    }\n  };\n\n  // Delete all residents\n  const handleDeleteAllResidents = async () => {\n    setIsDeleting(true);\n    setProgressMessage(`Удаление ${filteredResidents.length} жителей...`);\n    let deletedCount = 0;\n    const total = filteredResidents.length;\n\n    try {\n      for (let i = 0; i < filteredResidents.length; i++) {\n        const resident = filteredResidents[i];\n        setProgressMessage(`Удаление ${i + 1}/${total}: ${resident.name.split(' ')[0]}...`);\n\n        try {\n          let residentId = (resident as any).id;\n\n          if (!residentId) {\n            const apiResident = apiResidents.find(r => r.login === resident.login);\n            residentId = apiResident?.id;\n          }\n\n          if (residentId) {\n            await usersApi.delete(residentId);\n            deletedCount++;\n          }\n          removeUser(resident.login);\n        } catch (err) {\n          console.error(`Failed to delete ${resident.login}:`, err);\n        }\n      }\n\n      setProgressMessage(`Удалено ${deletedCount} жителей`);\n\n      if (selectedBuilding) {\n        await fetchResidents(selectedBuilding.id);\n      }\n\n      setTimeout(() => setProgressMessage(''), 3000);\n    } finally {\n      setIsDeleting(false);\n      setDeleteAllConfirm(false);\n    }\n  };\n\n  // Copy to clipboard\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n  };\n\n  // Render residents list\n  const renderResidentsList = () => (\n    <div className=\"space-y-3\">\n      {/* Search */}\n      <div className=\"glass-card p-4\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Поиск по имени, телефону, квартире...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"input-field pl-10\"\n          />\n        </div>\n      </div>\n\n      {/* Residents count and actions */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"text-sm text-gray-500\">\n          Найдено: <strong>{filteredResidents.length}</strong> жителей\n        </div>\n        {filteredResidents.length > 0 && (\n          <button\n            onClick={() => setDeleteAllConfirm(true)}\n            className=\"btn-secondary flex items-center gap-2 text-red-600 border-red-200 hover:bg-red-50 text-sm\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n            Удалить всех\n          </button>\n        )}\n      </div>\n\n      {/* List */}\n      {isLoadingResidents ? (\n        <div className=\"glass-card p-8 text-center\">\n          <Loader2 className=\"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin\" />\n          <p className=\"text-gray-500\">Загрузка жителей...</p>\n        </div>\n      ) : filteredResidents.length === 0 ? (\n        <div className=\"glass-card p-8 text-center\">\n          <Users className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n          <h3 className=\"text-lg font-medium text-gray-600\">Жители не найдены</h3>\n          <p className=\"text-gray-400 mt-1 mb-4\">\n            Загрузите Excel файл с данными жителей\n          </p>\n          <div className=\"flex items-center justify-center gap-3\">\n            <button\n              onClick={() => selectedBuilding && fetchResidents(selectedBuilding.id)}\n              className=\"btn-secondary inline-flex items-center gap-2\"\n            >\n              <RefreshCw className=\"w-4 h-4\" />\n              Обновить\n            </button>\n            <button\n              onClick={() => setShowUploadModal(true)}\n              className=\"btn-primary inline-flex items-center gap-2\"\n            >\n              <Upload className=\"w-4 h-4\" />\n              Загрузить Excel\n            </button>\n          </div>\n        </div>\n      ) : (\n        filteredResidents.map((resident) => (\n          <div\n            key={resident.login}\n            className=\"glass-card p-4 cursor-pointer hover:shadow-lg transition-shadow\"\n            onClick={() => {\n              setShowResidentCard(resident);\n              setEditingPassword(false);\n              setNewPassword('');\n              setShowPassword(false);\n            }}\n          >\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center text-lg font-medium text-white shadow-sm\">\n                  {resident.name.split(' ').map(n => n[0]).join('').slice(0, 2)}\n                </div>\n                <div className=\"min-w-0 flex-1\">\n                  <h3 className=\"font-semibold text-gray-900\">{resident.name}</h3>\n                  <div className=\"flex items-center flex-wrap gap-2 text-sm mt-1\">\n                    <span className=\"flex items-center gap-1 bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-mono text-xs\">\n                      <Key className=\"w-3 h-3\" />\n                      {resident.login}\n                    </span>\n                    {resident.apartment && (\n                      <span className=\"flex items-center gap-1 text-gray-500\">\n                        <Home className=\"w-3.5 h-3.5\" />\n                        кв. {resident.apartment}\n                      </span>\n                    )}\n                  </div>\n                  {resident.address && (\n                    <div className=\"flex items-center gap-1 text-xs text-gray-400 mt-1 truncate\">\n                      <MapPin className=\"w-3 h-3 flex-shrink-0\" />\n                      <span className=\"truncate\">{resident.address}</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n              <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n            </div>\n          </div>\n        ))\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Жители</h1>\n          <p className=\"text-gray-500 mt-1\">Управление аккаунтами жителей</p>\n        </div>\n      </div>\n\n      {/* Step 1: Branch Selection */}\n      {viewLevel === 'branches' && (\n        <div>\n          <h2 className=\"text-lg font-semibold mb-4\">Выберите филиал</h2>\n          {isLoadingBranches ? (\n            <div className=\"glass-card p-8 text-center\">\n              <Loader2 className=\"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin\" />\n              <p className=\"text-gray-500\">Загрузка филиалов...</p>\n            </div>\n          ) : branches.length === 0 ? (\n            <div className=\"glass-card p-8 text-center\">\n              <GitBranch className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n              <h3 className=\"text-lg font-medium text-gray-600\">Филиалы не найдены</h3>\n              <p className=\"text-gray-400 mt-1\">\n                Добавьте филиалы в разделе \"Дома/Объекты\"\n              </p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {branches.map((branch) => (\n                <button\n                  key={branch.id}\n                  onClick={() => handleBranchClick(branch)}\n                  className=\"glass-card p-5 text-left hover:shadow-lg transition-shadow group\"\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl flex items-center justify-center\">\n                        <span className=\"text-white font-bold text-lg\">{branch.code}</span>\n                      </div>\n                      <div>\n                        <h3 className=\"font-semibold\">{branch.name}</h3>\n                        <div className=\"text-sm text-gray-500\">Филиал {branch.code}</div>\n                      </div>\n                    </div>\n                    <ChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors\" />\n                  </div>\n                  <div className=\"mt-4 flex items-center gap-4 text-sm\">\n                    <div className=\"flex items-center gap-1\">\n                      <Building2 className=\"w-4 h-4 text-gray-400\" />\n                      <span>{branch.buildings_count} домов</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <Users className=\"w-4 h-4 text-gray-400\" />\n                      <span>{branch.residents_count} жителей</span>\n                    </div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Step 2: Building Selection */}\n      {viewLevel === 'buildings' && selectedBranch && (\n        <div>\n          {/* Branch Header */}\n          <div className=\"glass-card p-4 mb-4\">\n            <div className=\"flex items-center gap-3\">\n              <button\n                onClick={handleBack}\n                className=\"p-2 hover:bg-white/50 rounded-lg transition-colors\"\n              >\n                <ArrowLeft className=\"w-5 h-5\" />\n              </button>\n              <div className=\"w-10 h-10 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl flex items-center justify-center\">\n                <span className=\"text-white font-bold\">{selectedBranch.code}</span>\n              </div>\n              <div>\n                <h2 className=\"font-semibold\">{selectedBranch.name}</h2>\n                <p className=\"text-sm text-gray-500\">Выберите дом</p>\n              </div>\n            </div>\n          </div>\n\n          {filteredBuildings.length === 0 ? (\n            <div className=\"glass-card p-8 text-center\">\n              <Building2 className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n              <h3 className=\"text-lg font-medium text-gray-600\">Дома не найдены</h3>\n              <p className=\"text-gray-400 mt-1\">\n                Добавьте дома в этот филиал в разделе \"Дома/Объекты\"\n              </p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {filteredBuildings.map((building) => (\n                <button\n                  key={building.id}\n                  onClick={() => handleBuildingClick(building)}\n                  className=\"glass-card p-5 text-left hover:shadow-lg transition-shadow group\"\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-xl flex items-center justify-center\">\n                        <Home className=\"w-6 h-6 text-white\" />\n                      </div>\n                      <div>\n                        <h3 className=\"font-semibold\">Дом {building.buildingNumber || building.name}</h3>\n                        <div className=\"flex items-center gap-1 text-sm text-gray-500\">\n                          <MapPin className=\"w-3 h-3\" />\n                          {building.address}\n                        </div>\n                      </div>\n                    </div>\n                    <ChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors\" />\n                  </div>\n                  <div className=\"mt-4 flex items-center gap-4 text-sm\">\n                    <div className=\"flex items-center gap-1\">\n                      <Home className=\"w-4 h-4 text-gray-400\" />\n                      <span>{building.totalApartments} кв.</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <DoorOpen className=\"w-4 h-4 text-gray-400\" />\n                      <span>{building.entrances} подъездов</span>\n                    </div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Step 3: Entrances/Residents */}\n      {viewLevel === 'entrances' && selectedBuilding && (\n        <div>\n          {/* Building Header with Breadcrumb */}\n          <div className=\"glass-card p-4 mb-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <button\n                  onClick={handleBack}\n                  className=\"p-2 hover:bg-white/50 rounded-lg transition-colors\"\n                >\n                  <ArrowLeft className=\"w-5 h-5\" />\n                </button>\n                <div className=\"flex items-center gap-2 text-sm\">\n                  <button\n                    onClick={() => {\n                      setViewLevel('branches');\n                      setSelectedBranch(null);\n                      setSelectedBuilding(null);\n                    }}\n                    className=\"text-gray-500 hover:text-primary-600\"\n                  >\n                    Филиалы\n                  </button>\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\n                  <button\n                    onClick={handleBack}\n                    className=\"text-gray-500 hover:text-primary-600\"\n                  >\n                    {selectedBranch?.name}\n                  </button>\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\n                  <span className=\"font-medium text-gray-900\">\n                    Дом {selectedBuilding.buildingNumber || selectedBuilding.name}\n                  </span>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setShowAddManualModal(true)}\n                  className=\"btn-secondary flex items-center gap-2\"\n                >\n                  <UserPlus className=\"w-4 h-4\" />\n                  <span className=\"hidden sm:inline\">Добавить</span>\n                </button>\n                <button\n                  onClick={() => setShowUploadModal(true)}\n                  className=\"btn-primary flex items-center gap-2\"\n                >\n                  <Upload className=\"w-4 h-4\" />\n                  <span className=\"hidden sm:inline\">Excel</span>\n                </button>\n              </div>\n            </div>\n          </div>\n\n          {/* Entrance selection or direct residents view */}\n          {isLoadingEntrances ? (\n            <div className=\"glass-card p-8 text-center\">\n              <Loader2 className=\"w-8 h-8 mx-auto mb-3 text-primary-500 animate-spin\" />\n              <p className=\"text-gray-500\">Загрузка подъездов...</p>\n            </div>\n          ) : entrances.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {entrances.map((entrance) => {\n                const entranceResidents = allResidents.filter(r =>\n                  r.buildingId === selectedBuilding.id &&\n                  r.entrance === String(entrance.number)\n                );\n                return (\n                  <button\n                    key={entrance.id}\n                    onClick={() => handleEntranceClick(entrance)}\n                    className=\"glass-card p-5 text-left hover:shadow-lg transition-shadow group\"\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-12 h-12 bg-gradient-to-br from-green-400 to-teal-500 rounded-xl flex items-center justify-center\">\n                          <DoorOpen className=\"w-6 h-6 text-white\" />\n                        </div>\n                        <div>\n                          <h3 className=\"font-semibold\">Подъезд {entrance.number}</h3>\n                          <div className=\"text-sm text-gray-500\">\n                            {entrance.floors_from && entrance.floors_to && (\n                              <span>Этажи {entrance.floors_from}-{entrance.floors_to}</span>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      <ChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors\" />\n                    </div>\n                    <div className=\"mt-4 flex items-center gap-4 text-sm\">\n                      {entrance.apartments_from && entrance.apartments_to && (\n                        <div className=\"flex items-center gap-1\">\n                          <Home className=\"w-4 h-4 text-gray-400\" />\n                          <span>кв. {entrance.apartments_from}-{entrance.apartments_to}</span>\n                        </div>\n                      )}\n                      <div className=\"flex items-center gap-1\">\n                        <Users className=\"w-4 h-4 text-gray-400\" />\n                        <span>{entranceResidents.length} жителей</span>\n                      </div>\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          ) : (\n            // No entrances - show residents directly\n            renderResidentsList()\n          )}\n        </div>\n      )}\n\n      {/* Step 4: Residents for selected entrance */}\n      {viewLevel === 'residents' && selectedEntrance && selectedBuilding && (\n        <div>\n          {/* Entrance Header with Breadcrumb */}\n          <div className=\"glass-card p-4 mb-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <button\n                  onClick={handleBack}\n                  className=\"p-2 hover:bg-white/50 rounded-lg transition-colors\"\n                >\n                  <ArrowLeft className=\"w-5 h-5\" />\n                </button>\n                <div className=\"flex items-center gap-2 text-sm flex-wrap\">\n                  <button\n                    onClick={() => {\n                      setViewLevel('branches');\n                      setSelectedBranch(null);\n                      setSelectedBuilding(null);\n                      setSelectedEntrance(null);\n                    }}\n                    className=\"text-gray-500 hover:text-primary-600\"\n                  >\n                    Филиалы\n                  </button>\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\n                  <button\n                    onClick={() => {\n                      setViewLevel('buildings');\n                      setSelectedBuilding(null);\n                      setSelectedEntrance(null);\n                    }}\n                    className=\"text-gray-500 hover:text-primary-600\"\n                  >\n                    {selectedBranch?.name}\n                  </button>\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\n                  <button\n                    onClick={handleBack}\n                    className=\"text-gray-500 hover:text-primary-600\"\n                  >\n                    Дом {selectedBuilding.buildingNumber || selectedBuilding.name}\n                  </button>\n                  <ChevronRight className=\"w-4 h-4 text-gray-300\" />\n                  <span className=\"font-medium text-gray-900\">\n                    Подъезд {selectedEntrance.number}\n                  </span>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setShowAddManualModal(true)}\n                  className=\"btn-secondary flex items-center gap-2\"\n                >\n                  <UserPlus className=\"w-4 h-4\" />\n                  <span className=\"hidden sm:inline\">Добавить</span>\n                </button>\n                <button\n                  onClick={() => setShowUploadModal(true)}\n                  className=\"btn-primary flex items-center gap-2\"\n                >\n                  <Upload className=\"w-4 h-4\" />\n                  <span className=\"hidden sm:inline\">Excel</span>\n                </button>\n              </div>\n            </div>\n          </div>\n\n          {renderResidentsList()}\n        </div>\n      )}\n\n      {/* Progress Indicator */}\n      {(isCreating || isDeleting || progressMessage) && (\n        <div className=\"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 z-50 glass-card p-4 max-w-sm shadow-xl animate-fade-in\">\n          <div className=\"flex items-center gap-3\">\n            {(isCreating || isDeleting) && (\n              <div className=\"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <Loader2 className=\"w-5 h-5 text-primary-600 animate-spin\" />\n              </div>\n            )}\n            {!isCreating && !isDeleting && progressMessage && (\n              <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n              </div>\n            )}\n            <div className=\"flex-1\">\n              <p className=\"font-medium text-gray-900\">{progressMessage}</p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Created Accounts Notification */}\n      {createdAccounts.length > 0 && !progressMessage && (\n        <div className=\"fixed bottom-4 right-4 z-50 glass-card p-4 max-w-sm shadow-xl animate-fade-in\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n              <CheckCircle className=\"w-5 h-5 text-green-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <h4 className=\"font-semibold text-green-800\">\n                Обработано {createdAccounts.length} аккаунтов\n              </h4>\n              <p className=\"text-sm text-gray-600 mt-1\">\n                {selectedBuilding?.branchCode && selectedBuilding?.buildingNumber ? (\n                  <>Формат пароля: <code className=\"bg-gray-100 px-1 rounded\">{selectedBuilding.branchCode}/{selectedBuilding.buildingNumber}/[кв]</code></>\n                ) : (\n                  <>Пароль по умолчанию: <code className=\"bg-gray-100 px-1 rounded\">{DEFAULT_PASSWORD}</code></>\n                )}\n              </p>\n              <button\n                onClick={() => setCreatedAccounts([])}\n                className=\"text-sm text-primary-600 hover:text-primary-700 mt-2\"\n              >\n                Понятно\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Upload Modal */}\n      {showUploadModal && (\n        <div className=\"modal-backdrop\">\n          <div className=\"modal-content p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-xl font-bold\">Загрузка данных жителей</h2>\n              <button\n                onClick={() => {\n                  setShowUploadModal(false);\n                  setUploadedData([]);\n                  setUploadError('');\n                }}\n                className=\"p-2 hover:bg-white/30 rounded-lg\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            {uploadedData.length === 0 ? (\n              <>\n                <div\n                  className=\"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-primary-400 transition-colors cursor-pointer\"\n                  onClick={() => fileInputRef.current?.click()}\n                >\n                  <FileSpreadsheet className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\n                  <h3 className=\"font-semibold text-gray-700 mb-2\">\n                    Загрузите XLS/XLSX файл\n                  </h3>\n                  <p className=\"text-sm text-gray-500 mb-4\">\n                    Файл должен содержать столбцы: <strong>Л/С</strong>, <strong>ФИО абонента</strong>, <strong>Адрес</strong>, <strong>Площадь (кв.м)</strong>\n                  </p>\n                  <button className=\"btn-primary\">\n                    Выбрать файл\n                  </button>\n                </div>\n\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\".csv,.xlsx,.xls\"\n                  onChange={handleFileUpload}\n                  className=\"hidden\"\n                />\n\n                {uploadError && (\n                  <div className=\"mt-4 p-3 bg-red-50 text-red-700 rounded-lg flex items-center gap-2\">\n                    <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\n                    {uploadError}\n                  </div>\n                )}\n\n                <div className=\"mt-6 p-4 bg-gray-50 rounded-xl\">\n                  <h4 className=\"font-medium text-gray-700 mb-2\">Пример формата файла:</h4>\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-sm\">\n                      <thead>\n                        <tr className=\"border-b\">\n                          <th className=\"text-left p-2\">Л/С</th>\n                          <th className=\"text-left p-2\">ФИО абонента</th>\n                          <th className=\"text-left p-2\">Адрес</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        <tr>\n                          <td className=\"p-2\">12345678</td>\n                          <td className=\"p-2\">Иванов Иван Иванович</td>\n                          <td className=\"p-2\">ул. Мустакиллик, 15, кв. 42</td>\n                        </tr>\n                        <tr>\n                          <td className=\"p-2\">12345679</td>\n                          <td className=\"p-2\">Петрова Анна Сергеевна</td>\n                          <td className=\"p-2\">ул. Мустакиллик, 15, кв. 18</td>\n                        </tr>\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"mb-4\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <h3 className=\"font-semibold\">\n                      Найдено записей: {uploadedData.length}\n                    </h3>\n                    <button\n                      onClick={() => setUploadedData([])}\n                      className=\"text-sm text-gray-500 hover:text-gray-700\"\n                    >\n                      Загрузить другой файл\n                    </button>\n                  </div>\n\n                  <div className=\"max-h-64 overflow-y-auto border rounded-xl\">\n                    <table className=\"w-full text-sm\">\n                      <thead className=\"bg-gray-50 sticky top-0\">\n                        <tr className=\"border-b\">\n                          <th className=\"text-left p-3\">Л/С</th>\n                          <th className=\"text-left p-3\">ФИО абонента</th>\n                          <th className=\"text-left p-3\">Адрес</th>\n                          <th className=\"text-left p-3\">Площадь, м²</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {uploadedData.slice(0, 20).map((row, idx) => (\n                          <tr key={idx} className=\"border-b last:border-b-0\">\n                            <td className=\"p-3\">{row.personalAccount}</td>\n                            <td className=\"p-3\">{row.fullName}</td>\n                            <td className=\"p-3\">{row.address}</td>\n                            <td className=\"p-3\">{row.totalArea ? `${row.totalArea} м²` : '—'}</td>\n                          </tr>\n                        ))}\n                        {uploadedData.length > 20 && (\n                          <tr>\n                            <td colSpan={4} className=\"p-3 text-center text-gray-500\">\n                              и еще {uploadedData.length - 20} записей...\n                            </td>\n                          </tr>\n                        )}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n\n                <div className=\"p-3 bg-blue-50 text-blue-700 rounded-xl mb-4 text-sm\">\n                  {selectedBuilding?.branchCode && selectedBuilding?.buildingNumber ? (\n                    <>\n                      <strong>Формат пароля:</strong> {selectedBuilding.branchCode}/{selectedBuilding.buildingNumber}/[номер квартиры]\n                      <br />\n                      <span className=\"text-blue-600\">\n                        Например: {selectedBuilding.branchCode}/{selectedBuilding.buildingNumber}/23 для квартиры 23\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <strong>Пароль по умолчанию:</strong> {DEFAULT_PASSWORD}\n                      <br />\n                      <span className=\"text-blue-600\">\n                        Жители смогут изменить пароль в личном кабинете\n                      </span>\n                    </>\n                  )}\n                </div>\n\n                <div className=\"flex gap-3\">\n                  <button\n                    onClick={() => setUploadedData([])}\n                    className=\"btn-secondary flex-1\"\n                  >\n                    Отмена\n                  </button>\n                  <button\n                    onClick={createAccountsFromData}\n                    disabled={isCreating}\n                    className=\"btn-primary flex-1 flex items-center justify-center gap-2 disabled:opacity-50\"\n                  >\n                    {isCreating ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        Создание...\n                      </>\n                    ) : (\n                      <>\n                        <Check className=\"w-4 h-4\" />\n                        Создать {uploadedData.length} аккаунтов\n                      </>\n                    )}\n                  </button>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Manual Add Modal */}\n      {showAddManualModal && (\n        <div className=\"modal-backdrop\">\n          <div className=\"modal-content p-6 w-full max-w-md mx-4\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-xl font-bold\">Добавить жителя</h2>\n              <button\n                onClick={() => setShowAddManualModal(false)}\n                className=\"p-2 hover:bg-white/30 rounded-lg\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Л/С (Лицевой счет)</label>\n                <input\n                  type=\"text\"\n                  value={manualForm.personalAccount}\n                  onChange={(e) => setManualForm({...manualForm, personalAccount: e.target.value})}\n                  className=\"input-field\"\n                  placeholder=\"12345678\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ФИО абонента *</label>\n                <input\n                  type=\"text\"\n                  value={manualForm.fullName}\n                  onChange={(e) => setManualForm({...manualForm, fullName: e.target.value})}\n                  className=\"input-field\"\n                  placeholder=\"Иванов Иван Иванович\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Адрес</label>\n                <input\n                  type=\"text\"\n                  value={manualForm.address}\n                  onChange={(e) => setManualForm({...manualForm, address: e.target.value})}\n                  className=\"input-field\"\n                  placeholder=\"ул. Мустакиллик, 15, кв. 42\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Телефон</label>\n                <input\n                  type=\"tel\"\n                  value={manualForm.phone}\n                  onChange={(e) => setManualForm({...manualForm, phone: e.target.value})}\n                  className=\"input-field\"\n                  placeholder=\"+998 90 123 45 67\"\n                />\n              </div>\n\n              <div className=\"p-3 bg-gray-50 rounded-xl text-sm text-gray-600\">\n                <strong>Пароль:</strong> {selectedBuilding?.branchCode && selectedBuilding?.buildingNumber\n                  ? `${selectedBuilding.branchCode}/${selectedBuilding.buildingNumber}/[кв]`\n                  : DEFAULT_PASSWORD}\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => setShowAddManualModal(false)}\n                className=\"btn-secondary flex-1\"\n              >\n                Отмена\n              </button>\n              <button\n                onClick={handleManualAdd}\n                disabled={!manualForm.fullName}\n                className=\"btn-primary flex-1 disabled:opacity-50\"\n              >\n                Создать аккаунт\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Resident Card Modal */}\n      {showResidentCard && (\n        <div className=\"modal-backdrop\">\n          <div className=\"modal-content p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-xl font-bold\">Карточка жителя</h2>\n              <button\n                onClick={() => {\n                  setShowResidentCard(null);\n                  setEditingPassword(false);\n                  setNewPassword('');\n                }}\n                className=\"p-2 hover:bg-white/30 rounded-lg\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            <div className=\"text-center mb-6\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg\">\n                <span className=\"text-2xl font-bold text-white\">\n                  {showResidentCard.name.split(' ').map(n => n[0]).join('').slice(0, 2)}\n                </span>\n              </div>\n              <h3 className=\"text-xl font-bold text-gray-900\">{showResidentCard.name}</h3>\n            </div>\n\n            <div className=\"space-y-3 mb-6\">\n              <div className=\"p-4 bg-blue-50 rounded-xl\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\n                      <Key className=\"w-5 h-5 text-blue-600\" />\n                    </div>\n                    <div>\n                      <div className=\"text-xs text-blue-600 font-medium\">Л/С (Логин)</div>\n                      <div className=\"font-mono font-bold text-blue-900\">{showResidentCard.login}</div>\n                    </div>\n                  </div>\n                  <button\n                    onClick={() => copyToClipboard(showResidentCard.login)}\n                    className=\"p-2 hover:bg-blue-100 rounded-lg transition-colors\"\n                    title=\"Копировать\"\n                  >\n                    <Copy className=\"w-4 h-4 text-blue-600\" />\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"p-4 bg-gray-50 rounded-xl\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center\">\n                      <Key className=\"w-5 h-5 text-gray-600\" />\n                    </div>\n                    <div>\n                      <div className=\"text-xs text-gray-500 font-medium\">Пароль</div>\n                      {!editingPassword ? (\n                        <div className=\"font-mono font-bold text-gray-900 flex items-center gap-2\">\n                          {showPassword ? getResidentPassword(showResidentCard) : '••••••••'}\n                          <button\n                            type=\"button\"\n                            onClick={(e) => {\n                              e.preventDefault();\n                              e.stopPropagation();\n                              setShowPassword(!showPassword);\n                            }}\n                            className=\"p-2 hover:bg-gray-200 active:bg-gray-300 rounded touch-manipulation z-10\"\n                          >\n                            {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                          </button>\n                        </div>\n                      ) : (\n                        <input\n                          type=\"text\"\n                          value={newPassword}\n                          onChange={(e) => setNewPassword(e.target.value)}\n                          placeholder=\"Новый пароль\"\n                          className=\"input-field text-sm py-1 px-2 w-40\"\n                          autoFocus\n                        />\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    {!editingPassword ? (\n                      <>\n                        <button\n                          onClick={() => copyToClipboard(getResidentPassword(showResidentCard))}\n                          className=\"p-2 hover:bg-gray-200 rounded-lg transition-colors\"\n                          title=\"Копировать\"\n                        >\n                          <Copy className=\"w-4 h-4 text-gray-600\" />\n                        </button>\n                        <button\n                          onClick={() => {\n                            setEditingPassword(true);\n                            setNewPassword(getResidentPassword(showResidentCard));\n                          }}\n                          className=\"p-2 hover:bg-gray-200 rounded-lg transition-colors\"\n                          title=\"Изменить пароль\"\n                        >\n                          <Edit3 className=\"w-4 h-4 text-gray-600\" />\n                        </button>\n                      </>\n                    ) : (\n                      <>\n                        <button\n                          onClick={async () => {\n                            if (newPassword.length >= 4 && showResidentCard.id) {\n                              try {\n                                // Save to database\n                                await usersApi.adminChangePassword(showResidentCard.id, newPassword);\n                                // Also save locally for display\n                                updateUserPassword(showResidentCard.login, newPassword);\n                                setEditingPassword(false);\n                                setShowPassword(true);\n                              } catch (err: any) {\n                                alert('Ошибка сохранения пароля: ' + err.message);\n                              }\n                            }\n                          }}\n                          disabled={newPassword.length < 4}\n                          className=\"p-2 hover:bg-green-100 rounded-lg transition-colors disabled:opacity-50\"\n                          title=\"Сохранить\"\n                        >\n                          <Save className=\"w-4 h-4 text-green-600\" />\n                        </button>\n                        <button\n                          onClick={() => {\n                            setEditingPassword(false);\n                            setNewPassword('');\n                          }}\n                          className=\"p-2 hover:bg-gray-200 rounded-lg transition-colors\"\n                          title=\"Отмена\"\n                        >\n                          <X className=\"w-4 h-4 text-gray-600\" />\n                        </button>\n                      </>\n                    )}\n                  </div>\n                </div>\n                {editingPassword && newPassword.length > 0 && newPassword.length < 4 && (\n                  <p className=\"text-xs text-red-500 mt-1 ml-13\">Минимум 4 символа</p>\n                )}\n              </div>\n\n              {showResidentCard.address && (\n                <div className=\"p-4 bg-gray-50 rounded-xl\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center flex-shrink-0\">\n                      <MapPin className=\"w-5 h-5 text-gray-600\" />\n                    </div>\n                    <div>\n                      <div className=\"text-xs text-gray-500 font-medium\">Адрес</div>\n                      <div className=\"font-medium text-gray-900\">{showResidentCard.address}</div>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {showResidentCard.apartment && (\n                <div className=\"p-4 bg-gray-50 rounded-xl\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center\">\n                      <Home className=\"w-5 h-5 text-gray-600\" />\n                    </div>\n                    <div>\n                      <div className=\"text-xs text-gray-500 font-medium\">Квартира / Помещение</div>\n                      <div className=\"font-bold text-gray-900\">{showResidentCard.apartment}</div>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {showResidentCard.phone && (\n                <div className=\"p-4 bg-gray-50 rounded-xl\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center\">\n                      <Phone className=\"w-5 h-5 text-gray-600\" />\n                    </div>\n                    <div>\n                      <div className=\"text-xs text-gray-500 font-medium\">Телефон</div>\n                      <div className=\"font-medium text-gray-900\">{showResidentCard.phone}</div>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setDeleteConfirm({ login: showResidentCard.login, name: showResidentCard.name })}\n                className=\"btn-secondary flex-1 flex items-center justify-center gap-2 text-red-600 border-red-200 hover:bg-red-50\"\n              >\n                <Trash2 className=\"w-4 h-4\" />\n                Удалить\n              </button>\n              <button\n                onClick={() => setShowResidentCard(null)}\n                className=\"btn-primary flex-1\"\n              >\n                Закрыть\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {deleteConfirm && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4\">\n          <div className=\"bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl\">\n            <div className=\"flex items-center justify-center w-14 h-14 rounded-full bg-red-100 mx-auto mb-4\">\n              <AlertCircle className=\"w-7 h-7 text-red-600\" />\n            </div>\n            <h3 className=\"text-lg font-bold text-center mb-2\">\n              Удалить жителя?\n            </h3>\n            <p className=\"text-gray-500 text-center text-sm mb-2\">\n              {deleteConfirm.name}\n            </p>\n            <p className=\"text-gray-400 text-center text-xs mb-6\">\n              Это действие нельзя отменить. Житель потеряет доступ к системе.\n            </p>\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setDeleteConfirm(null)}\n                disabled={isDeleting}\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50\"\n              >\n                Отмена\n              </button>\n              <button\n                onClick={() => handleDeleteResident(deleteConfirm.login)}\n                disabled={isDeleting}\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium text-white bg-red-500 hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\n              >\n                {isDeleting ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                    Удаление...\n                  </>\n                ) : (\n                  <>\n                    <Trash2 className=\"w-4 h-4\" />\n                    Удалить\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Delete All Confirmation Modal */}\n      {deleteAllConfirm && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4\">\n          <div className=\"bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl\">\n            <div className=\"flex items-center justify-center w-14 h-14 rounded-full bg-red-100 mx-auto mb-4\">\n              <Trash2 className=\"w-7 h-7 text-red-600\" />\n            </div>\n            <h3 className=\"text-lg font-bold text-center mb-2\">\n              Удалить всех жителей?\n            </h3>\n            <p className=\"text-gray-500 text-center text-sm mb-2\">\n              Будет удалено: <strong>{filteredResidents.length}</strong> жителей\n            </p>\n            <p className=\"text-gray-400 text-center text-xs mb-6\">\n              Это действие нельзя отменить. Все жители потеряют доступ к системе.\n            </p>\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setDeleteAllConfirm(false)}\n                disabled={isDeleting}\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50\"\n              >\n                Отмена\n              </button>\n              <button\n                onClick={handleDeleteAllResidents}\n                disabled={isDeleting}\n                className=\"flex-1 py-3 px-4 rounded-xl font-medium text-white bg-red-500 hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\n              >\n                {isDeleting ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                    Удаление...\n                  </>\n                ) : (\n                  <>\n                    <Trash2 className=\"w-4 h-4\" />\n                    Удалить всех\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"file":"ResidentsPage-1767960438672-BxZSiXFv.js"}
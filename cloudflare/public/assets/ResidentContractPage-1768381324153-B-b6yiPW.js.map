{"version":3,"file":"ResidentContractPage-1768381324153-B-b6yiPW.js","sources":["../../src/components/ContractQRCode.tsx","../../src/pages/ResidentContractPage.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { Download, FileText, Eye, EyeOff, Loader2 } from 'lucide-react';\nimport { generateQRCode } from './LazyQRCode';\nimport { generateContractDocx } from '../utils/contractGenerator';\nimport { useAuthStore } from '../stores/authStore';\nimport { ContractPreview } from './ContractPreview';\n\ninterface ContractQRCodeProps {\n  language: 'ru' | 'uz';\n}\n\nexport function ContractQRCode({ language }: ContractQRCodeProps) {\n  // Use user from store directly to get updates when contract is signed\n  const { user, markContractSigned } = useAuthStore();\n  const [showContract, setShowContract] = useState(false);\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\n  const [isDownloading, setIsDownloading] = useState(false);\n\n  // Check if contract is already signed - using store user for reactivity\n  const isContractSigned = !!user?.contractSignedAt;\n\n  // Generate QR code with resident's personal data\n  useEffect(() => {\n    if (!user) return;\n\n    const generateQR = async () => {\n      // Compact format with Cyrillic - no decorative symbols\n      const residentData = [\n        `ФИО: ${user.name || 'Собственник'}`,\n        `Л/С: ${user.login}`,\n        user.address ? `Адрес: ${user.address}` : null,\n        user.apartment ? `Кв: ${user.apartment}` : null,\n        user.phone ? `Тел: ${user.phone}` : null,\n      ].filter(Boolean).join('\\n');\n\n      const url = await generateQRCode(residentData, {\n        width: 300,\n        margin: 1,\n        errorCorrectionLevel: 'M',\n        color: { dark: '#000000', light: '#ffffff' },\n      });\n      setQrCodeUrl(url);\n    };\n\n    generateQR();\n  }, [user]);\n\n  const handleDownloadContract = async () => {\n    if (!user || !qrCodeUrl || isDownloading) return;\n\n    setIsDownloading(true);\n    try {\n      await generateContractDocx(user, qrCodeUrl, language);\n      // Mark contract as signed in database (persists across devices) - only if not already signed\n      if (!isContractSigned) {\n        await markContractSigned();\n      }\n    } catch (error) {\n      console.error('Error generating contract:', error);\n      alert(language === 'ru'\n        ? 'Ошибка при генерации договора'\n        : 'Shartnoma yaratishda xatolik');\n    } finally {\n      setIsDownloading(false);\n    }\n  };\n\n  if (!user) return null;\n\n  return (\n    <div className=\"glass-card p-4 md:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center gap-3 mb-6\">\n        <div className={`w-12 h-12 bg-gradient-to-br ${isContractSigned ? 'from-green-400 to-green-500' : 'from-orange-400 to-orange-500'} rounded-xl flex items-center justify-center shadow-sm`}>\n          <FileText className=\"w-6 h-6 text-white\" />\n        </div>\n        <div>\n          <h3 className=\"font-bold text-lg text-gray-900\">\n            {language === 'ru' ? 'Договор с УК' : 'UK bilan shartnoma'}\n          </h3>\n          <p className=\"text-sm text-gray-500\">\n            {isContractSigned\n              ? (language === 'ru' ? `Подписан ${new Date(user.contractSignedAt!).toLocaleDateString('ru-RU')}` : `Imzolangan ${new Date(user.contractSignedAt!).toLocaleDateString('uz-UZ')}`)\n              : (language === 'ru' ? 'Ваш уникальный QR-код' : 'Sizning noyob QR-kodingiz')\n            }\n          </p>\n        </div>\n      </div>\n\n      {/* QR Code Display */}\n      <div className=\"bg-white border border-gray-200 rounded-xl p-6 mb-4 flex flex-col items-center\">\n        {qrCodeUrl ? (\n          <img src={qrCodeUrl} alt=\"QR Code\" className=\"w-40 h-40\" />\n        ) : (\n          <div className=\"w-40 h-40 bg-gray-100 rounded animate-pulse\" />\n        )}\n        <p className=\"text-sm text-gray-500 mt-3 text-center\">\n          {language === 'ru'\n            ? 'Сканируйте для просмотра данных'\n            : 'Ma\\'lumotlarni ko\\'rish uchun skanerlang'}\n        </p>\n      </div>\n\n      {/* Resident Info */}\n      <div className=\"bg-gray-50 rounded-xl p-3 mb-4\">\n        <div className=\"grid grid-cols-2 gap-2 text-sm\">\n          <div>\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Житель:' : 'Aholi:'}</span>\n            <p className=\"font-medium text-gray-900\">{user.name || '—'}</p>\n          </div>\n          <div>\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Адрес:' : 'Manzil:'}</span>\n            <p className=\"font-medium text-gray-900\">\n              {user.address ? (\n                user.apartment ? `${user.address}, кв. ${user.apartment}` : user.address\n              ) : (\n                user.apartment ? `кв. ${user.apartment}` : '—'\n              )}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"grid grid-cols-2 gap-3\">\n        <button\n          onClick={() => setShowContract(!showContract)}\n          className=\"flex items-center justify-center gap-2 px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl text-sm font-medium text-gray-700 transition-colors touch-manipulation\"\n        >\n          {showContract ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n          {showContract\n            ? (language === 'ru' ? 'Скрыть' : 'Yashirish')\n            : (language === 'ru' ? 'Посмотреть' : 'Ko\\'rish')\n          }\n        </button>\n        <button\n          onClick={handleDownloadContract}\n          disabled={isDownloading || !qrCodeUrl}\n          className={`flex items-center justify-center gap-2 px-4 py-3 ${isContractSigned ? 'bg-green-500 hover:bg-green-600' : 'bg-orange-400 hover:bg-orange-500'} disabled:bg-gray-300 disabled:cursor-not-allowed rounded-xl text-sm font-medium text-gray-900 transition-colors touch-manipulation`}\n        >\n          {isDownloading ? (\n            <Loader2 className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <Download className=\"w-4 h-4\" />\n          )}\n          {isDownloading\n            ? (language === 'ru' ? 'Подготовка...' : 'Tayyorlanmoqda...')\n            : isContractSigned\n              ? (language === 'ru' ? 'Скачать договор' : 'Shartnomani yuklash')\n              : (language === 'ru' ? 'Подписать и скачать' : 'Imzolash va yuklash')\n          }\n        </button>\n      </div>\n\n      {/* Full Contract Preview */}\n      {showContract && (\n        <div className=\"mt-4\">\n          <ContractPreview user={user} qrCodeUrl={qrCodeUrl} language={language} />\n        </div>\n      )}\n    </div>\n  );\n}\n","import { User } from 'lucide-react';\nimport { useAuthStore } from '../stores/authStore';\nimport { useLanguageStore } from '../stores/languageStore';\nimport { ContractQRCode } from '../components/ContractQRCode';\n\nexport function ResidentContractPage() {\n  const { user } = useAuthStore();\n  const { language } = useLanguageStore();\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"space-y-4 md:space-y-6 pb-20 md:pb-0\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-xl md:text-2xl font-bold text-gray-900\">\n          {language === 'ru' ? 'Договор с УК' : 'UK bilan shartnoma'}\n        </h1>\n        <p className=\"text-sm text-gray-500 mt-1\">\n          {language === 'ru' ? 'Ваш договор и уникальный QR-код' : 'Sizning shartnomangiz va noyob QR-kodingiz'}\n        </p>\n      </div>\n\n      {/* Contract QR Code - uses user from store directly */}\n      <ContractQRCode language={language} />\n\n      {/* User Info Card */}\n      <div className=\"glass-card p-4 md:p-6\">\n        <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n          <User className=\"w-5 h-5 text-gray-600\" />\n          {language === 'ru' ? 'Данные профиля' : 'Profil ma\\'lumotlari'}\n        </h3>\n        <div className=\"space-y-3 text-sm\">\n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-500\">{language === 'ru' ? 'ФИО' : 'F.I.O'}</span>\n            <span className=\"font-medium text-gray-900\">{user.name}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Логин' : 'Login'}</span>\n            <span className=\"font-medium text-gray-900\">{user.login}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Телефон' : 'Telefon'}</span>\n            <span className=\"font-medium text-gray-900\">{user.phone || '-'}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Адрес' : 'Manzil'}</span>\n            <span className=\"font-medium text-gray-900\">{user.address || '-'}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-500\">{language === 'ru' ? 'Квартира' : 'Xonadon'}</span>\n            <span className=\"font-medium text-gray-900\">{user.apartment || '-'}</span>\n          </div>\n          {user.branch && (\n            <div className=\"flex justify-between\">\n              <span className=\"text-gray-500\">{language === 'ru' ? 'Филиал' : 'Filial'}</span>\n              <span className=\"font-medium text-gray-900\">{user.branch}</span>\n            </div>\n          )}\n          {user.building && (\n            <div className=\"flex justify-between\">\n              <span className=\"text-gray-500\">{language === 'ru' ? 'Дом' : 'Uy'}</span>\n              <span className=\"font-medium text-gray-900\">{user.building}</span>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["ContractQRCode","language","user","markContractSigned","useAuthStore","showContract","setShowContract","useState","qrCodeUrl","setQrCodeUrl","isDownloading","setIsDownloading","isContractSigned","useEffect","residentData","url","generateQRCode","handleDownloadContract","generateContractDocx","jsxs","jsx","FileText","EyeOff","Eye","Loader2","Download","ContractPreview","ResidentContractPage","useLanguageStore","User"],"mappings":"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"}
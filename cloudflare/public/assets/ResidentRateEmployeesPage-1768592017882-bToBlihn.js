import{r as u,j as e,m as p,aP as _,k as $,U as y,a1 as A,A as L,a0 as B,h as O,ao as T,X as D}from"./react-vendor-1768592017882-CePiWY2x.js";import{b as M,u as P,d as G,S as j}from"./index-1768592017882-r6EIukz5.js";import"./vendor-1768592017882-CV536fZx.js";import"./qr-scanner-1768592017882-cr32YHjo.js";import"./zustand-1768592017882-wNUYBKDB.js";const F="resident_employee_ratings",S=()=>{try{const i=localStorage.getItem(F);return i?JSON.parse(i):[]}catch{return[]}},J=i=>{const c=S(),m=c.findIndex(o=>o.executorId===i.executorId&&o.residentId===i.residentId);m>=0?c[m]=i:c.push(i),localStorage.setItem(F,JSON.stringify(c))},U=(i,c)=>S().find(o=>o.executorId===i&&o.residentId===c)||null;function ee(){const{user:i}=M(),{executors:c,requests:m,fetchExecutors:o,fetchRequests:k}=P(),{language:l}=G(),[r,b]=u.useState(null),[W,N]=u.useState(!1),[t,n]=u.useState({quality:0,speed:0,politeness:0,comment:""}),[g,q]=u.useState([]);u.useEffect(()=>{o(),k()},[o,k]),u.useEffect(()=>{if(i){const a=S().filter(d=>d.residentId===i.id).map(d=>d.executorId);q(a)}},[i]);const z=(()=>{const s=m.filter(a=>a.residentId===i?.id&&a.status==="completed"&&a.executorId);return[...new Set(s.map(a=>a.executorId))]})(),w=[...c].sort((s,a)=>{const d=z.includes(s.id),h=z.includes(a.id);return d&&!h?-1:!d&&h?1:s.name.localeCompare(a.name)}),v=w.filter(s=>!g.includes(s.id)),I=w.filter(s=>g.includes(s.id)),f=s=>m.filter(a=>a.residentId===i?.id&&a.executorId===s&&a.status==="completed").length,R=s=>{b(s);const a=U(s.id,i?.id||"");n(a?{quality:a.quality,speed:a.speed,politeness:a.politeness,comment:a.comment}:{quality:0,speed:0,politeness:0,comment:""}),N(!0)},E=()=>{if(!r||!i)return;const s={id:Date.now().toString(),executorId:r.id,residentId:i.id,quality:t.quality,speed:t.speed,politeness:t.politeness,comment:t.comment,createdAt:new Date().toISOString()};J(s),q(a=>a.includes(r.id)?a:[...a,r.id]),N(!1),b(null)},x=({value:s,onChange:a,label:d})=>e.jsxs("div",{className:"flex items-center justify-between gap-4 py-3 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:d}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(h=>e.jsx("button",{type:"button",onClick:()=>a(h),className:"p-1 touch-manipulation",children:e.jsx(p,{className:`w-7 h-7 transition-all ${h<=s?"text-yellow-400 fill-yellow-400":"text-gray-300 hover:text-yellow-300"}`})},h))})]}),C=s=>{const a=s.quality+s.speed+s.politeness;return a>0?(a/3).toFixed(1):"0"},X=s=>{const a=U(s,i?.id||"");return a?((a.quality+a.speed+a.politeness)/3).toFixed(1):"0"};return e.jsxs("div",{className:"space-y-4 md:space-y-6 pb-20 md:pb-0",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-xl md:text-2xl font-bold flex items-center gap-3",children:[e.jsx(p,{className:"w-7 h-7 text-primary-500"}),l==="ru"?"Оценить сотрудников":"Xodimlarni baholash"]})}),e.jsx("div",{className:"glass-card p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-blue-700",children:l==="ru"?"Оцените качество работы сотрудников, которые выполнили ваши заявки. Ваши отзывы помогут улучшить качество обслуживания.":"Arizalaringizni bajargan xodimlarning ish sifatini baholang. Sizning fikrlaringiz xizmat sifatini yaxshilashga yordam beradi."})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[v.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-primary-500"}),l==="ru"?"Ожидают оценки":"Baholash kutilmoqda",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 text-sm",children:v.length})]}),v.map(s=>e.jsx("div",{className:"glass-card p-4 cursor-pointer hover:shadow-md transition-all border-2 border-yellow-200 bg-yellow-50",onClick:()=>R(s),children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-yellow-400 to-yellow-500 flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(A,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"truncate",children:j[s.specialization]||s.specialization})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l==="ru"?`${f(s.id)} выполненных заявок`:`${f(s.id)} ta bajarilgan ariza`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-yellow-700 font-medium hidden sm:inline",children:l==="ru"?"Оценить":"Baholash"}),e.jsx(L,{className:"w-5 h-5 text-yellow-600"})]})]})},s.id))]}),I.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-green-500"}),l==="ru"?"Уже оценены":"Allaqachon baholangan",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-green-100 text-green-700 text-sm",children:I.length})]}),I.map(s=>e.jsx("div",{className:"glass-card p-4 border border-green-100 bg-green-50/50 cursor-pointer hover:shadow-md transition-all",onClick:()=>R(s),children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(A,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"truncate",children:j[s.specialization]||s.specialization})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(p,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:X(s.id)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:l==="ru"?"Изменить":"O'zgartirish"})]})]})},s.id))]}),w.length===0&&e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(O,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:l==="ru"?"Пока нет сотрудников для оценки":"Hali baholash uchun xodimlar yo'q"})]})]}),e.jsx("div",{className:"hidden md:block",children:r?e.jsxs("div",{className:"glass-card p-6 sticky top-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary-400 to-primary-500 flex items-center justify-center mx-auto mb-3",children:e.jsx(y,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-xl font-bold",children:r.name}),e.jsx("p",{className:"text-gray-600",children:j[r.specialization]||r.specialization}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:l==="ru"?`${f(r.id)} выполненных заявок`:`${f(r.id)} ta bajarilgan ariza`})]}),e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsx(x,{label:l==="ru"?"Качество работы":"Ish sifati",value:t.quality,onChange:s=>n(a=>({...a,quality:s}))}),e.jsx(x,{label:l==="ru"?"Скорость выполнения":"Bajarish tezligi",value:t.speed,onChange:s=>n(a=>({...a,speed:s}))}),e.jsx(x,{label:l==="ru"?"Вежливость":"Xushmuomalalik",value:t.politeness,onChange:s=>n(a=>({...a,politeness:s}))})]}),(t.quality>0||t.speed>0||t.politeness>0)&&e.jsxs("div",{className:"flex items-center justify-center gap-2 py-3 bg-primary-50 rounded-xl mb-4",children:[e.jsx(p,{className:"w-6 h-6 text-primary-500 fill-primary-500"}),e.jsx("span",{className:"text-xl font-bold text-primary-700",children:C(t)}),e.jsx("span",{className:"text-sm text-primary-600",children:"/ 5"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l==="ru"?"Комментарий (необязательно)":"Izoh (ixtiyoriy)"}),e.jsx("textarea",{value:t.comment,onChange:s=>n(a=>({...a,comment:s.target.value})),className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-primary-200 focus:border-primary-400 outline-none resize-none",rows:3,placeholder:l==="ru"?"Поделитесь впечатлениями...":"Taassurotlaringiz bilan o'rtoqlashing..."})]}),e.jsxs("button",{onClick:E,disabled:t.quality===0||t.speed===0||t.politeness===0,className:"w-full py-4 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 bg-gradient-to-r from-primary-400 to-primary-500 hover:from-primary-500 hover:to-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx(T,{className:"w-5 h-5"}),g.includes(r.id)?l==="ru"?"Обновить оценку":"Baholashni yangilash":l==="ru"?"Отправить оценку":"Baholashni yuborish"]})]}):e.jsxs("div",{className:"glass-card p-8 text-center sticky top-4",children:[e.jsx(O,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:l==="ru"?"Выберите сотрудника слева для оценки":"Baholash uchun chap tomondan xodimni tanlang"})]})})]}),W&&r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:hidden justify-center",children:e.jsxs("div",{className:"w-full bg-white rounded-t-2xl overflow-hidden max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold",children:l==="ru"?"Оценить сотрудника":"Xodimni baholash"}),e.jsx("button",{onClick:()=>{N(!1),b(null)},className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-primary-400 to-primary-500 flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600",children:j[r.specialization]||r.specialization})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{label:l==="ru"?"Качество работы":"Ish sifati",value:t.quality,onChange:s=>n(a=>({...a,quality:s}))}),e.jsx(x,{label:l==="ru"?"Скорость выполнения":"Bajarish tezligi",value:t.speed,onChange:s=>n(a=>({...a,speed:s}))}),e.jsx(x,{label:l==="ru"?"Вежливость":"Xushmuomalalik",value:t.politeness,onChange:s=>n(a=>({...a,politeness:s}))})]}),(t.quality>0||t.speed>0||t.politeness>0)&&e.jsxs("div",{className:"flex items-center justify-center gap-2 py-3 bg-primary-50 rounded-xl",children:[e.jsx(p,{className:"w-6 h-6 text-primary-500 fill-primary-500"}),e.jsx("span",{className:"text-xl font-bold text-primary-700",children:C(t)}),e.jsx("span",{className:"text-sm text-primary-600",children:"/ 5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l==="ru"?"Комментарий (необязательно)":"Izoh (ixtiyoriy)"}),e.jsx("textarea",{value:t.comment,onChange:s=>n(a=>({...a,comment:s.target.value})),className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-primary-200 focus:border-primary-400 outline-none resize-none",rows:3,placeholder:l==="ru"?"Поделитесь впечатлениями...":"Taassurotlaringiz bilan o'rtoqlashing..."})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-100 bg-white safe-area-bottom",children:e.jsxs("button",{onClick:E,disabled:t.quality===0||t.speed===0||t.politeness===0,className:"w-full py-4 px-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 bg-gradient-to-r from-primary-400 to-primary-500 hover:from-primary-500 hover:to-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx(T,{className:"w-5 h-5"}),g.includes(r.id)?l==="ru"?"Обновить оценку":"Baholashni yangilash":l==="ru"?"Отправить оценку":"Baholashni yuborish"]})})]})})]})}export{ee as ResidentRateEmployeesPage};
//# sourceMappingURL=ResidentRateEmployeesPage-1768592017882-bToBlihn.js.map

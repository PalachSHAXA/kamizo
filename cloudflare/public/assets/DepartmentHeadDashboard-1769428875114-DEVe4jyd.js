import{r as y,j as e,W as w,$ as C,L as r,F as L,A,y as R,h as S,D as h,m as E}from"./react-vendor-1769428875114-t_MJ7TI5.js";import{R as o,P as k,b as P,c as T,T as g,B as $,C as _,X as B,Y as D,a as I}from"./LazyCharts-1769428875114-WGEgmUHK.js";import{b as z,u as F,c as O,P as K,S as Y}from"./index-1769428875114-CG_16j_e.js";import"./vendor-1769428875114-wOrLRiCI.js";import"./qr-scanner-1769428875114-B_vB3SDT.js";import"./zustand-1769428875114-wNUYBKDB.js";import"./charts-1769428875114--rEkoR91.js";function M(){const{user:p}=z(),{executors:j,requests:u,fetchRequests:d,fetchExecutors:m,isLoadingRequests:f,isLoadingExecutors:N}=F();y.useEffect(()=>{d(),m()},[d,m]);const n=p?.specialization||"plumber",i=u.filter(s=>s.category===n),l=j.filter(s=>s.specialization===n),t={total:i.length,new:i.filter(s=>s.status==="new").length,inProgress:i.filter(s=>["assigned","accepted","in_progress"].includes(s.status)).length,completed:i.filter(s=>s.status==="completed").length,pendingApproval:i.filter(s=>s.status==="pending_approval").length,avgRating:l.length>0?l.reduce((s,a)=>s+a.rating,0)/l.length:0,executorsOnline:l.filter(s=>s.status==="available").length,executorsTotal:l.length},c=[{name:"Новые",value:t.new,color:"#3b82f6"},{name:"В работе",value:t.inProgress,color:"#f59e0b"},{name:"Ожидают",value:t.pendingApproval,color:"#8b5cf6"},{name:"Завершены",value:t.completed,color:"#10b981"}],v=l.map(s=>({name:s.name.split(" ")[0],completed:s.completedCount,rating:s.rating})),b=()=>Y[n]||"Специалисты",x=f||N;return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:["Отдел: ",b()]}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Глава отдела"})]})]})})}),x&&e.jsxs("div",{className:"glass-card p-8 flex flex-col items-center justify-center",children:[e.jsx(C,{className:"w-8 h-8 animate-spin text-blue-500 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Загрузка данных отдела..."})]}),!x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[e.jsx(r,{to:"/requests",className:"glass-card p-3 md:p-5 hover:scale-[1.02] transition-transform",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-blue-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(L,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold",children:t.new}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"Новые заявки"})]})]})}),e.jsx("div",{className:"glass-card p-3 md:p-5",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-amber-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(A,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold",children:t.inProgress}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"В работе"})]})]})}),e.jsx("div",{className:"glass-card p-3 md:p-5",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-green-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(R,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold",children:t.completed}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"Завершено"})]})]})}),e.jsx(r,{to:"/executors",className:"glass-card p-3 md:p-5 hover:scale-[1.02] transition-transform",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-purple-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(S,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-2xl md:text-3xl font-bold",children:[t.executorsOnline,"/",t.executorsTotal]}),e.jsx("div",{className:"text-xs md:text-sm text-gray-500 truncate",children:"Сотрудники"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"glass-card p-4 md:p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Распределение заявок"}),e.jsx("div",{className:"h-[200px]",children:c.some(s=>s.value>0)?e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(k,{children:[e.jsx(P,{data:c,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:s,value:a})=>`${s}: ${a}`,children:c.map((s,a)=>e.jsx(T,{fill:s.color},`cell-${a}`))}),e.jsx(g,{})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400",children:"Нет заявок для отображения"})})]}),e.jsxs("div",{className:"glass-card p-4 md:p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Производительность сотрудников"}),e.jsx("div",{className:"h-[200px]",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs($,{data:v,children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"name"}),e.jsx(D,{}),e.jsx(g,{}),e.jsx(I,{dataKey:"completed",fill:"#3b82f6",name:"Завершено"})]})})})]})]}),e.jsxs("div",{className:"glass-card p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Последние заявки"}),e.jsxs(r,{to:"/requests",className:"text-primary-600 text-sm hover:underline flex items-center gap-1",children:["Все заявки ",e.jsx(h,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"space-y-3",children:[i.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${s.status==="new"?"bg-blue-500":s.status==="in_progress"?"bg-amber-500":s.status==="completed"?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-medium truncate",children:["#",s.number," ",s.title]}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.residentName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="new"?"bg-blue-100 text-blue-700":s.status==="in_progress"?"bg-amber-100 text-amber-700":s.status==="pending_approval"?"bg-purple-100 text-purple-700":s.status==="completed"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:O[s.status]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.priority==="urgent"?"bg-red-100 text-red-700":s.priority==="high"?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-600"}`,children:K[s.priority]})]})]},s.id)),i.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Нет заявок по вашему отделу"})]})]}),e.jsxs("div",{className:"glass-card p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Лучшие сотрудники"}),e.jsxs(r,{to:"/executors",className:"text-primary-600 text-sm hover:underline flex items-center gap-1",children:["Все сотрудники ",e.jsx(h,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"space-y-3",children:[l.sort((s,a)=>a.completedCount-s.completedCount).slice(0,5).map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/50 rounded-xl",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold ${a===0?"bg-orange-500":a===1?"bg-gray-400":a===2?"bg-amber-600":"bg-gray-300"}`,children:a+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.completedCount," выполнено"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="available"?"bg-green-100 text-green-700":s.status==="busy"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,children:s.status==="available"?"Свободен":s.status==="busy"?"Занят":"Офлайн"}),e.jsxs("div",{className:"flex items-center gap-1 text-amber-500",children:[e.jsx(E,{className:"w-4 h-4 fill-current"}),e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)})]})]})]},s.id)),l.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Нет сотрудников в вашем отделе"})]})]})]})]})}export{M as DepartmentHeadDashboard};
//# sourceMappingURL=DepartmentHeadDashboard-1769428875114-DEVe4jyd.js.map
